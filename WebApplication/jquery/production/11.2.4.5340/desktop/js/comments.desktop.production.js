bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(t,e,i){var s=this;s.params=i||{},s._super(t,e,i),s.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.params.contextsLeftSidebarCaseDashboard.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this;i.params=$.extend(i.params,e.args),i.params.plan.idActivitySelected=void 0,i.clean();var s=i.getContent().empty();void 0!==t.type&&(i.params.showContextByMenuDashboard=t.type);var a={showFormOverview:i.params.menuDashboard.showFormOverview,showFormActivity:i.params.menuDashboard.showFormActivity,showCommentsOptionMenu:i.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:i.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:i.params.menuDashboard.showTimeLineOptionMenu&&(!i.params.isAdhocProcess||i.params.isAdhocProcess&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")),showPlanOptionMenu:i.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:i.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:i.params.menuDashboard.contextFormActivityOptionMenu};i.getTemplate("project-dashboard-menu").render(a).appendTo(s),i.params.showContextByMenuDashboard&&$("li[data-context='"+i.params.showContextByMenuDashboard.toUpperCase()+"']",i.content).addClass("active").siblings().removeClass("active"),i.handlerEvents()},loadContentById:function(t){var e=this;t.preventDefault();var i=$(t.target).closest("li");if(!i.hasClass("active")){var s=i.data("context");if(s){var a=e.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),o=parseInt(a[0],10),n="",r=o;"PLANACTIVITIES"==s&&(r=o+1,n=bizagi.localization.getResource("workportal-project-casedashboard-plan")),e.params.refreshLastItemBreadcrumb=!1,e.pub("notify",{type:s.toUpperCase(),args:$.extend(e.params,{showContextByMenuDashboard:s,histName:n,level:r})}),$("li[data-context='"+e.params.showContextByMenuDashboard.toUpperCase()+"']",e.content).addClass("active").siblings().removeClass("active")}}},subMenuHandler:function(){var t=this.getContent(),e=$("[data-context='COMMENTS']",t),i=$("[data-context='FILES']",t),s=$("[data-context='TIMELINE']",t);$(".ui-bizagi-wp-project-tab-submenu a",t).on("click",function(){e.toggle(),i.toggle(),s.toggle()})},handlerEvents:function(){var t=this,e=t.getContent();t.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",e).on("click",$.proxy(t.loadContentById,t)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",e).on("click",function(){var e={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.params.idCase,idTask:t.params.idTask,idWorkflow:t.params.idWorkflow,idWorkItem:t.params.idWorkitem,referrer:t.params.referrer||"inboxGrid"};t.publish("executeAction",e)})},clean:function(){var t=this,e=t.getContent();t.params&&t.params.contextsLeftSidebarCaseDashboard&&t.params.contextsLeftSidebarCaseDashboard.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))}),$(".ui-bizagi-wp-project-tab-links a",e).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",e).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(t,e,i){this._super(t,e,i),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var t=this,e=t.getTemplate("project-content-dashboard");return t.content=e.render({}),t.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),function(t){var e=window.kendo.ui,i=e.Widget,s=i.extend({init:function(t,e){var s=this;i.fn.init.call(s,t,e),s._maxFilesSize=e.maxSize,s._fileList=[],s._onlyValidateServerFileExtension=e.onlyValidateServerFileExtension||!0,s._supportFileExt=e.extensions,s._uploadMaxFilesSize=e.maxSize,s.upload=s._initUpload(),s.loadNotifier=s._initLoadNotifier(),s.notification=s._initNotification(),s._eventsHandler(),s._initLocalization(s.options.localization)},options:{name:"ProjectAttachments",wrapper:t('<div class="project-attachments"></div>'),multiple:!0,dropZone:!0,maxFilesSize:bizagi.currentUser?bizagi.currentUser.uploadMaxFileSize:25e3,enabled:!0,localization:{}},_initUpload:function(){var t=this,e=t.options,i=e.localization||{},s=0;return t._initLocalization(i),this.element.kendoUpload({async:{saveUrl:e.saveUrl+"?xsrf="+bizagi.getXSRFToken(),autoUpload:!0},select:function(e){t._filterMaxFilesSize(e),s=0},complete:function(){var e=setInterval(function(){0===t.loadNotifier.wrapper.find("li.k-file-progress").length&&(t._showNotificationCompleteUpload(t.loadNotifier.wrapper,s),clearInterval(e))},300)},upload:e.upload,progress:function(e){t._onProgressFile(e)},success:function(i){t._fileList.push(i.files[0]),s+=1,e.success(i)},error:function(e){t.onErrorFile(e)},localization:{select:i.selectFiles,dropFilesHere:i.dropFilesHere},multiple:e.multiple,enabled:e.enabled,dropZone:e.dropZone,showFileList:!1}).data("kendoUpload")},_initNotification:function(){return t("<div></div>").kendoNotification({position:{pinned:!0}}).data("kendoNotification")},_initLoadNotifier:function(){var t=this.options.localization;return this.options.wrapper.kendoWindow({title:t.notifierTitle,actions:["Close"],animation:{open:{duration:100},close:{duration:100}},open:function(){this.wrapper.addClass("project-attachments-wrapper-window")},visible:!1,resizable:!1,draggable:!1,maxHeight:"300px",minWidth:"430px"}).data("kendoWindow")},_initLocalization:function(e){var i={selectFiles:bizagi.localization.getResource("workportal-project-attachments-addfiles"),notifierTitle:bizagi.localization.getResource("workportal-project-attachments-notifiertitle"),errorUpload:bizagi.localization.getResource("workportal-project-attachments-file-error-type"),errorSecurity:bizagi.localization.getResource("workportal-project-attachments-blockedext"),errorSize:bizagi.localization.getResource("workportal-project-attachments-blockedsize"),errorMaxFilesSize:bizagi.localization.getResource("workportal-project-discussion-maxfilessize").replace("%s",Math.round(this._maxFilesSize/1e6,-1)),dropFilesHere:bizagi.localization.getResource("workportal-project-attachments-drophere"),cancel:bizagi.localization.getResource("workportal-widget-reports-confirm-cancel"),retry:bizagi.localization.getResource("workportal-project-attachments-retry"),close:bizagi.localization.getResource("workportal-widget-dialog-box-close")};t.extend(e,i)},_onProgressFile:function(e){var i=this._getFileItemByUID(e.files[0].uid),s=e.percentComplete;t(".k-progress",i).css({width:s+"%"}),t(".k-upload-pct",i).removeClass("k-icon k-loading").text(s+"%"),100===s&&t(".k-upload-action .k-icon",i).hide()},_onShowUploadNotifier:function(t){var e=t.files,i=this.options.template;this.loadNotifier.content(i.render({files:e})),this.loadNotifier.wrapper.css({top:"auto",left:"auto",bottom:"1em",right:"1em"}),this.loadNotifier.open()},_showNotificationCompleteUpload:function(t,e){t.find("li.k-file-success").length===e&&0===t.find("li.k-file-error").length&&this._autoHideMessage(t)},_autoHideMessage:function(t){var e=this;setTimeout(function(){t.fadeOut(function(){e.loadNotifier.close()})},2e3)},_onCancelFile:function(t){var e=t.closest("li"),i=this.upload.wrapper,s=e.data("guid");i.find("li[data-uid="+s+"] .k-upload-action").trigger("click"),e.remove()},_onRemoveFile:function(t){t.closest("li").remove()},_onRetryFile:function(e){var i=e.closest("li").data("guid"),s=t.grep(this._fileList,function(t){return t.uid===i});this.options.retry(s[0])},onErrorFile:function(t){var e=this.options.localization,i=t.files[0],s=this._isValidFile(i),a=""!==s.message?s.message:e.errorUpload;this.setStatus("ERROR",i.uid,a)},_isValidFile:function(e){var i=this.options.localization,s=!0,a="";return(e.size>this._uploadMaxFilesSize||null==e.size||0==e.size)&&(a=i.errorSize,s=!1),this._onlyValidateServerFileExtension||-1===t.inArray(e.extension,this._supportFileExt)&&(a=i.errorSecurity,s=!1),{valid:s,message:a}},_filterMaxFilesSize:function(t){for(var e=0,i=0,s=t.files.length;i<s;i++)e+=t.files[i].size;e>this._maxFilesSize?(this._notifySizeExceeded(),t.preventDefault()):this._onShowUploadNotifier(t)},_notifySizeExceeded:function(){this.notification.show(this.options.localization.errorMaxFilesSize,"error")},_getFileItemByUID:function(e){return t("li[data-guid="+e+"]",this.loadNotifier.element)},_switchEvents:function(e){var i=t(".k-icon",e.currentTarget);i.hasClass("k-update")||i.hasClass("k-remove")?this._onRemoveFile(i):i.hasClass("k-retry")?this._onRetryFile(i):i.hasClass("k-cancel")&&this._onCancelFile(i)},_eventsHandler:function(){var t=this;t.loadNotifier.element.on("click","button.k-upload-action",function(e){t._switchEvents(e)})},cancelFilesUpload:function(){this.upload.wrapper.find("li .k-upload-action").trigger("click"),this.close()},close:function(){this.loadNotifier.close()},destroy:function(){this.loadNotifier.destroy(),this.upload.destroy()},setStatus:function(e,i,s){var a=this._getFileItemByUID(i),o=this.options.localization;switch(e){case"SUCCESS":a.removeClass("k-file-progress k-file-error").addClass("k-file-success"),t(".k-upload-action .k-icon",a).removeClass("k-cancel k-i-refresh k-retry").addClass("k-update").prop("title",o.close).show(),t(".k-errormsg",a).text("");break;case"ERROR":a.removeClass("k-file-progress").addClass("k-file-error"),t(".k-upload-action .k-icon",a).removeClass("k-i-refresh k-retry").addClass("k-remove").show(),t(".k-upload-status .k-upload-pct",a).removeClass("k-upload-pct k-loading").addClass("k-icon k-warning"),t(".k-errormsg",a).text(s).prop("title",s);break;case"RETRY":a.removeClass("k-file-progress").addClass("k-file-error"),t(".k-upload-status .k-upload-pct",a).removeClass("k-upload-pct k-loading").addClass("k-warning").text(""),t(".k-upload-action .k-icon",a).removeClass("k-cancel k-remove").addClass("k-i-refresh k-retry").prop("title",o.retry).show(),t(".k-errormsg",a).text(o.errorUpload).prop("title",o.errorUploadiis)}}});e.plugin(s)}(jQuery),bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.discussions",{},{init:function(t,e,i,s){var a=this;a.typeResource="DiscussionGuid",a.plugins={},a.dialogBoxDiscussion={},a.attchComments={},a.attchDiscussions={remove:[],addition:[]},a.listDataDiscussion=[],a.userPictures=[],a.commentsList={},a.globalTags=[],a.tempTagsBeforeDelete=[],a.tempTagsToDelete=[],a.keySentenceAddTag=bizagi.localization.getResource("workportal-project-discussion-add-new-tag")+": ",a.notifier=i,a._super(t,e,s),a.loadTemplates({"project-discussions":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.discussions").concat("#project-discussions-wrapper"),"project-discussions-popup":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.discussions").concat("#project-discussions-popup-wrapper"),"project-discussions-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.discussions").concat("#project-discussions-list-wrapper"),"project-discussions-comments":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.discussions").concat("#project-discussions-comments-list"),"project-discussions-attachments":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.discussions").concat("#project-discussions-attachments-list"),"project-attachments":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.attachments").concat("#project-attachments")})},renderContent:function(){var t=this.getTemplate("project-discussions");return this.content=t.render({}),this.content},postRender:function(){var t=this,e=t.getContent();t.plugins.popupDiscussion=t.initPluginPopupDiscussion();var i=t.plugins.popupDiscussion;t.form={buttonShowFormNewDiscussion:$(".ui-bizagi-wp-action-new",e),title:$(".ui-bizagi-wp-project-popupform-h4",i),subject:$("#ui-bizagi-wp-project-discussions-popup-subject-input",i),description:$("#ui-bizagi-wp-project-discussions-popup-description-textarea",i),buttonShowPopupDiscussionToAdd:$("#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add",e),buttonAddDiscussion:$("#ui-bizagi-wp-project-discussions-popup-action-add-discussion",i),buttonCancel:$("#ui-bizagi-wp-project-popupform-action-cancel",i),formDiscussion:$(".ui-bizagi-wp-project-discussions-popup",i),attachments:$(".ui-bizagi-wp-project-discussions-attachments-cmnwrapper",i),edition:!1},t.plugins.tagsFilter=t.initPluginTagsFilter(),t.plugins.tagsMultiSelect=t.initPluginTagsMultiSelect(i),t.getDiscussions(),t.eventsHandler(),t.restrictedEventsHandler()},getDiscussions:function(){var t=this;t.getDataDiscussions().done(function(){var e=$.map(t.listDataDiscussion,function(t){return t.user}),i=$.map(t.commentsList,function(t){return $.map(t.comments,function(t){return t.user})});var s=function(t){for(var e={},i=[],s=t.length,a=0,o=0;o<s;o++){var n=t[o];1!==e[n]&&(e[n]=1,i[a++]=n)}return i}(e.concat(i).concat(bizagi.currentUser.idUser)).join(",");t.getDataUsers(s).then(function(){t.renderUserProfilesAndImages()}),t.setClassesTagsByDiscussion()})},onNotifyOpenPopup:function(){this.form.edition=!1,this.showFormAddDiscussion("workportal-project-discussion-adddiscussion"),this.renderUserProfile()},initPluginPopupDiscussion:function(){var t=this.getTemplate("project-discussions-popup");return this.dialogBoxDiscussion.formContent=t.render({attachments:[]}),this.dialogBoxDiscussion.formContent},initPluginTagsMultiSelect:function(t){var e,i=this,s=t.find("#ui-bizagi-wp-project-discussions-options-multiselect-tags"),a=!1,o=!1;return s.kendoMultiSelect({change:function(){var t=this.value().slice(0),e=this.dataSource.data();t.length>0&&-1!==e[0].tag.replace(i.keySentenceAddTag,"").indexOf(t[t.length-1])&&(t[t.length-1]=e[0].tag.replace(i.keySentenceAddTag,"")),t=(t=t.filter(Boolean)).filter(function(t,e,i){return i.indexOf(t)===e});var s="";if(e.length>0&&-1!==e[0].tag.indexOf(i.keySentenceAddTag)){s=e[0].tag.replace(i.keySentenceAddTag,"");var n={};-1!==t.indexOf(s)?(n=this.dataSource.at(0),a=!0,this.dataSource.remove(n),a=!1,this.refresh(),o=!0):s&&($("li:first",this.list).hasClass("k-state-focused")&&(o=!0,t.push(s)),n=this.dataSource.at(0),a=!0,this.dataSource.remove(n),a=!1)}s&&(o&&(0===this.dataSource.data().filter(function(t){return t.tag===s}).length&&this.dataSource.add({guid:s,tag:s}),o=!1));this.dataSource.filter({}),this.value(t)},dataBound:function(){if((e||this._prev)&&e!==this._prev&&!a){e=this._prev;var t=this.dataSource.data(),s=!1;t.length>0&&-1!==t[0].tag.indexOf(i.keySentenceAddTag)&&(t[0].tag=i.keySentenceAddTag+e,this.refresh(),s=!0,$("li",this.list).removeClass("k-state-focused"),$("li:first",this.list).addClass("k-state-focused")),s||this.dataSource.insert(0,{tag:i.keySentenceAddTag+e,guid:e}),0==this.dataSource.total()&&(this.search(),this.open(),this.refresh(),$("li",this.list).removeClass("k-state-focused"),$("li:first",this.list).addClass("k-state-focused"))}},dataSource:[],dataTextField:"tag",dataValueField:"guid",filter:"contains",animation:!1}).data("kendoMultiSelect")},initPluginTagsFilter:function(){var t=this,e=t.getContent();return $("#ui-bizagi-wp-project-discussions-options-tags-filter",e).kendoMultiSelect({change:function(){t.hideOrShowDiscussionsByFilter()},autoClose:!1,tagMode:"single",dataTextField:"tag",dataValueField:"guid"}).data("kendoMultiSelect")},hideOrShowDiscussionsByFilter:function(){var t=this,e=t.plugins.tagsFilter.value();e.length>0?($(".ui-bizagi-wp-project-discussions-item",t.getContent()).hide(),e.forEach(function(e){$(".ui-bizagi-wp-project-discussions-item."+e,t.getContent()).show()})):$(".ui-bizagi-wp-project-discussions-item",t.getContent()).show()},validateAddCommentForm:function(t){var e=!1,i=$("textarea",t);if(""===i.val().trim()){var s=bizagi.localization.getResource("workportal-project-discussion-requiredcomment");i.parent().next().find("span").html(s)}else i.parent().next().find("span").empty(),e=!0;return e},validateAddDiscussionForm:function(t){var e=!1,i=$("#ui-bizagi-wp-project-discussions-popup-subject-input",t),s=$("#ui-bizagi-wp-project-discussions-popup-description-textarea",t);if(""!==i.val().trim()&&""!==s.val().trim()&&(e=!0),""===i.val().trim()){var a=bizagi.localization.getResource("workportal-project-discussion-subjectrequired");i.parent().find("span").html(a)}else i.parent().find("span").empty();if(""===s.val().trim()){var o=bizagi.localization.getResource("workportal-project-discussion-requireddescription");s.parent().next().find("span").html(o)}else s.parent().next().find("span").empty();return e},applyFileAttachments:function(t){var e=this,i="DISCUSSIONS"===t?e.plugins.popupDiscussion:e.getContent();return $(".ui-bizagi-wp-project-discussions-attachment-upload",i).kendoProjectAttachments({saveUrl:e.dataService.serviceLocator.getUrl("project-comments-uploadfiles"),template:e.getTemplate("project-attachments"),success:function(i){e.onSuccessFile(i,t)},upload:$.proxy(e.addFileData,e),dropZone:!1,extensions:e.supportFileExt,maxSize:e.uploadMaxFilesSize}).data("kendoProjectAttachments")},addFileData:function(t){var e=t.files[0].uid;t.files[0].guid=e,t.data={guid:e}},getDataDiscussions:function(){var t=this,e=$.Deferred(),i={globalParent:t.radNumber,typeResource:t.typeResource};return"FLOW-DECONTEXTUALIZED-PLANS"===t.params.flowContext&&(i.globalParent=t.params.plan.id),t.dataService.getDiscussionsData(i).pipe(function(e){return t.callForListComments(e)}).done(function(i){t.listDataDiscussion=t.sortDiscussions(i),t.updateTemplateListDiscussion(),e.resolve()}),e.promise()},getDataUsers:function(t){var e=this,i=$.Deferred(),s={usersGuids:t,width:50,height:50};return s.usersGuids?e.dataService.getUsersData(s).always(function(t){e.userPictures=function(t){for(var e=t.concat(),i=0;i<e.length;++i)for(var s=i+1;s<e.length;++s)e[i]===e[s]&&e.splice(s--,1);return e}(e.userPictures.concat(t)),i.resolve()}):i.resolve(),i.promise()},callForListComments:function(t){for(var e=this,i=$.Deferred(),s=[],a=0,o=t.length-1;a<=o;a++){e.addGlobalTags(t[a].tags,!1);var n={idParent:t[a].guid,dateTime:e.getDateServer(),count:6};e.commentsList[n.idParent]={comments:[],count:0,total:0};var r=$.when(e.dataService.getCommentsData(n)).done(function(t){t.length>0&&(e.commentsList[t[0].parent]={comments:t,count:t.length,total:0})});s.push(r)}return $.when.apply($,s).done(function(){i.resolve(t)}),i.promise()},sortDiscussions:function(t){var e=[];return t.length&&(e=t.sort(function(t,e){var i=t.date;return e.date-i})).length>0&&e.unshift(e.pop()),e},resetDiscussionAttachments:function(){var t=this,e=t.plugins.popupDiscussion;$(".ui-bizagi-wp-project-attachments-list",e).empty(),t.plugins.tagsMultiSelect.value([]),t.attchDiscussions.addition=[],t.attchDiscussions.remove=[],t.getDiscussions()},sendDataUpdateDiscussion:function(t){var e=this,i=e.prepareFilesToSave();e.form.buttonAddDiscussion.prop("disabled",!0);var s=e.getTagsDiscussionBySave(),a=e.getGuidsTagsDiscussionToDelete(),o={content:{name:e.form.subject.val(),description:e.form.description.val(),globalParent:e.radNumber.toString(),user:bizagi.currentUser.idUser,attachments:i.attachments,guid:t,tags:s,typeResource:"DiscussionGuid",general:!1,date:e.getDateServer()},attachmentsToCreate:i.attachmentsToCreate,attachmentsToDelete:i.attachmentsToDelete};e.plugins.attchDiscussions.close(),e.dataService.editDiscussion(o).always(function(i){if(200===i.status||201===i.status||void 0===i.status){e.addGlobalTags(s,!0);var n=e.getDiscussionDataByGUID(t);n.name=o.content.name,n.description=o.content.description,n.attachments=o.content.attachments,n.tags=o.content.tags,e.onClosePopupDiscussion(),e.resetDiscussionAttachments(),e.updateTemplateListDiscussion(),e.removeGlobalTags(a),e.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-project-discussion-edited"),""))}else e.form.buttonAddDiscussion.prop("disabled",!1),e.onClosePopupDiscussion(),e.notifier.showErrorMessage(printf(bizagi.localization.getResource("workportal-project-discussion-error-edition"),""));e.renderUserProfilesAndImages(),e.setClassesTagsByDiscussion(),e.hideOrShowDiscussionsByFilter()})},validateStringIsGuid:function(t){return/^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/.test(t)&&!/^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/.test(t)},sendDataInsertDiscussion:function(t){var e=this,i=e.prepareFilesToSave();e.form.buttonAddDiscussion.prop("disabled",!0);var s=e.getTagsDiscussionBySave(),a={content:{name:e.form.subject.val(),description:e.form.description.val(),globalParent:e.radNumber.toString(),user:bizagi.currentUser.idUser,attachments:i.attachments,guid:t,tags:s,typeResource:"DiscussionGuid",general:!1,date:e.getDateServer()},attachmentsToCreate:i.attachmentsToCreate,attachmentsToDelete:i.attachmentsToDelete};e.plugins.attchDiscussions.close(),e.dataService.postDiscussion(a).always(function(t){if(200===t.status||201===t.status||void 0===t.status){e.addGlobalTags(s,!0),e.form.buttonAddDiscussion.prop("disabled",!1);var i={name:a.content.name,description:a.content.description,date:a.content.date,user:a.content.user,attachments:a.content.attachments,radNumber:a.content.globalParent,general:a.content.general,guid:a.content.guid,tags:a.content.tags,typeResource:a.content.typeResource};e.commentsList[a.content.guid]={comments:[],count:0,total:0},0===e.listDataDiscussion.length?e.listDataDiscussion.push(i):e.listDataDiscussion.splice(1,0,i),e.resetDiscussionAttachments(),e.onClosePopupDiscussion(),e.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-project-discussion-created"),"")),e.updateTemplateListDiscussion()}else e.form.buttonAddDiscussion.prop("disabled",!1),e.onClosePopupDiscussion(),e.notifier.showErrorMessage(printf(bizagi.localization.getResource("workportal-project-discussion-error-creation"),""));e.renderUserProfilesAndImages(),e.setClassesTagsByDiscussion(),e.hideOrShowDiscussionsByFilter()})},getTagsDiscussionBySave:function(){var t=this,e=t.plugins.tagsMultiSelect.value(),i=t.plugins.tagsMultiSelect.dataSource.data(),s=[];return e.forEach(function(e){var a,o=t.validateStringIsGuid(e);1===(a=o?i.filter(function(t){return t.guid===e}):i.filter(function(i){var s=t.validateStringIsGuid(i.guid);return i.tag===e&&!s})).length&&s.push({guid:o?a[0].guid:a[0].uid,tag:a[0].tag})}),s},differenceArrays:function(t,e){return t.filter(function(t){return e.indexOf(t)<0})},getGuidsTagsDiscussionToDelete:function(){var t=this.plugins.tagsMultiSelect.value();return this.differenceArrays(this.tempTagsBeforeDelete,t)},setStateUIShowMoreComments:function(t,e){var i=t.siblings(".ui-bizagi-wp-project-discussion-showmore-comments"),s=i.find(".ui-bizagi-wp-project-discussion-showmore-comments-button"),a=i.find(".ui-bizagi-wp-project-discussion-showmore-no-more-comments"),o=i.find(".ui-bizagi-wp-project-discussion-showmore-loading-comments");"ALLOW_MORE_COMMENTS"===e&&(s.show(),a.hide(),o.hide()),"LOADING_MORE_COMMENTS"===e&&(s.hide(),a.hide(),o.show()),"NO_MORE_COMMENTS"===e&&(s.hide(),a.show(),o.hide())},getCurrentUserInfo:function(){return{name:bizagi.currentUser.userName,id:bizagi.currentUser.idUser,picture:""}},addGlobalTags:function(t,e){for(var i=this,s=0;s<t.length;s+=1){0===i.globalTags.filter(function(e){return e.tag===t[s].tag}).length&&(t[s].globalParent=i.radNumber,i.globalTags.push(t[s]),e&&i.dataService.postTag(t[s]))}i.plugins.tagsFilter.dataSource.data(i.globalTags),i.plugins.tagsMultiSelect.dataSource.data(i.globalTags)},removeGlobalTags:function(t){var e=this,i=$.map(e.listDataDiscussion,function(t){return $.map(t.tags,function(t){return t.guid})}).concat(t),s=[];t.forEach(function(t){1===i.filter(function(e){return e===t}).length&&s.push(t)}),s.forEach(function(t){var i={idTag:t};e.dataService.deleteTag(i);for(var s=e.globalTags.length-1;s>=0;s-=1)e.globalTags[s].guid===t&&e.globalTags.splice(s,1)}),e.plugins.tagsFilter.dataSource.data(e.globalTags),e.plugins.tagsMultiSelect.dataSource.data(e.globalTags)},setClassesTagsByDiscussion:function(){for(var t=0;t<this.listDataDiscussion.length;t+=1){var e=$.map(this.listDataDiscussion[t].tags,function(t){return t.guid}).join(" ");$(".ui-bizagi-wp-project-discussions-item[data-guid='"+this.listDataDiscussion[t].guid+"']",this.getContent()).addClass(e)}},updateTemplateListDiscussion:function(){for(var t=this,e=t.getContent(),i=t.getTemplate("project-discussions-list"),s=t.getCurrentUserInfo(),a=i.render({listDataDiscussions:t.listDataDiscussion,user:s,isOpen:!bizagi.util.parseBoolean(t.params.isClosedForAllUsers),returnServedCommentByParentId:function(e){return t.returnServedCommentByParentId(e)}}),o=0;o<this.listDataDiscussion.length;o++)this.mapTempComments($("#ui-bizagi-wp-project-discussions-list-wrapper",e).find(".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid="+this.listDataDiscussion[o].guid+"]"),a.find(".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid="+this.listDataDiscussion[o].guid+"]"));$("#ui-bizagi-wp-project-discussions-list-wrapper",e).empty().append(a),t.plugins.attchComments=t.applyFileAttachments("COMMENTS")},showFormAddDiscussion:function(t){var e=this;e.plugins.attchComments&&e.plugins.attchComments.close(),e.dialogBoxDiscussion.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"650px",modal:!0,zIndex:1,title:bizagi.localization.getResource(t),maximize:!0,open:$.proxy(e.onOpenPopupDiscussion,e),close:function(){e.resetDiscussionAttachments(),e.onClosePopupDiscussion()}})},resetFormDiscussion:function(){var t=this;t.form.buttonAddDiscussion.prop("disabled",!1),t.form.subject.val(""),t.form.description.val("");var e=$("#ui-bizagi-wp-project-discussions-popup-subject-input",t.dialogBoxDiscussion.formContent),i=$("#ui-bizagi-wp-project-discussions-popup-description-textarea",t.dialogBoxDiscussion.formContent);e.parent().find("span").empty(),i.parent().next().find("span").empty()},renderUserProfile:function(){var t=$.grep(this.userPictures,function(t){return t.id===bizagi.currentUser.idUser})[0],e=$(".ui-bizagi-wp-project-popupform-user"),i=e.find(".bz-wp-avatar-img"),s=e.find(".bz-wp-avatar-label");t&&(t.picture?i.attr("src","data:image/png;base64,"+t.picture):(i.hide(),s.html(t.name.getInitials()).show()))},renderUserProfilesAndImages:function(){var t=this,e=$.grep(t.userPictures,function(t){return t.id===bizagi.currentUser.idUser})[0],i="data:image/png;base64,";e&&($(".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username").html(e.name),e.picture?($(".ui-bizagi-wp-project-discussions-item-user img").attr("src",i+e.picture),$(".ui-bizagi-wp-project-popupform-image-current-user").attr("src",i+e.picture)):($(".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label").html(e.name.getInitials()).show(),$(".ui-bizagi-wp-project-discussions-item-user img").hide()));for(var s=0;s<t.userPictures.length;s++)$("div[data-iduser='"+t.userPictures[s].id+"'] .bz-wp-discussion-username").html(t.userPictures[s].name),t.userPictures[s].picture?$("div[data-iduser='"+t.userPictures[s].id+"'] .bz-wp-avatar-img").attr("src",i+t.userPictures[s].picture):($("div[data-iduser='"+t.userPictures[s].id+"'] .bz-wp-avatar-img").hide(),$("div[data-iduser='"+t.userPictures[s].id+"'] label.bz-wp-avatar-label").html(t.userPictures[s].name.getInitials()))},switchCommentsEvents:function(t){var e=this,i=$(t.target),s=i.parent();if(i.is("textarea"))e.onShowButtonsPanel(i);else if(i.hasClass("ui-bizagi-wp-project-discussions-comment-buttons-cancel"))e.onCancelComment(i);else if(i.hasClass("ui-bizagi-wp-project-discussions-comment-buttons-share")){var a=i.closest(".ui-bizagi-wp-project-discussions-add-comment");if(e.validateAddCommentForm(a)){var o=Math.guid();e.onCreateComment(i,o)}}else i.hasClass("ui-bizagi-wp-project-discussions-comment-view")?e.onViewComment(i):i.hasClass("ui-bizagi-wp-project-discussion-showmore-comments-button")?e.onViewMoreComments(i):i.hasClass("bz-bizagi-wp-project-discussions-attachment-delete")?e.onRemoveFiles(i):s.hasClass("biz-wp-user-icon-admin")&&s.hasClass("biz-wp-action-edit-discussion")?e.onEditDiscussion(i):s.hasClass("ui-bizagi-wp-project-discussion-delete")?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-project-discussion-querydelete"),"","info")).done(function(){e.onDeleteComment(s)}):s.hasClass("bz-bizagi-wp-project-discussions-attachment-itemwrapper")&&e.onDownloadAttachment(i.closest("li"));t.stopPropagation()},onEditDiscussion:function(t){var e=t.closest(".ui-bizagi-wp-project-discussions-item").data("guid");this.setDiscussionsDataByGUID(e),this.showFormAddDiscussion("workportal-project-discussion-edit")},setDiscussionsDataByGUID:function(t){var e=this,i=e.getDiscussionDataByGUID(t),s=$(".ui-bizagi-wp-project-attachments-list",e.form.attachments);e.form.edition={guid:t},e.attchDiscussions={addition:i.attachments,remove:[]},e.form.title.text(bizagi.localization.getResource("workportal-project-discussion-edit")),e.form.subject.val(i.name),e.form.description.val(i.description);var a=$.map(i.tags,function(t){return t.guid});e.plugins.tagsMultiSelect.value(a),e.tempTagsBeforeDelete=[],e.tempTagsBeforeDelete=e.tempTagsBeforeDelete.concat(e.plugins.tagsMultiSelect.value()),e.renderAttachments(i.attachments,"DISCUSSIONS",s)},getDiscussionDataByGUID:function(t){for(var e,i=this.listDataDiscussion.length-1;i>=0;i--)this.listDataDiscussion[i].guid===t&&(e=this.listDataDiscussion[i],i=0);return e},onViewComment:function(t){var e=t.closest(".ui-bizagi-wp-project-discussions-comment-truncatewrapper");e.toggleClass("ui-bizagi-wp-project-discussions-comment-shortcomment"),e.toggleClass("ui-bizagi-wp-project-discussions-comment-longcomment")},onViewMoreComments:function(t){var e=this,i=t.closest(".ui-bizagi-wp-project-discussion-showmore-comments").siblings(".ui-bizagi-wp-project-discussion-comment-list"),s=i.closest(".ui-bizagi-wp-project-discussions-container-description-and-comments").data("guid");e.commentsList[s].total?e.getMoreComments(s,i):e.dataService.getCommentsCountByParent(s).done(function(t){e.commentsList[s].total=t.count,e.getMoreComments(s,i)})},getMoreComments:function(t,e){var i,s=this;s.commentsList[t].total>s.commentsList[t].comments.length?(s.setStateUIShowMoreComments(e,"LOADING_MORE_COMMENTS"),i=0===s.commentsList[t].comments.length?s.getDateServer():s.commentsList[t].comments[s.commentsList[t].comments.length-1].date,i-=1,s.dataService.getCommentsData({dateTime:i,idParent:t,count:6}).done(function(i){if(i.length){Array.prototype.push.apply(s.commentsList[t].comments,i),s.commentsList[t].count+=i.length,s.renderCommentByDiscussion(e,t,i),s.renderUserProfilesAndImages(),i.length>5?s.setStateUIShowMoreComments(e,"ALLOW_MORE_COMMENTS"):s.setStateUIShowMoreComments(e,"NO_MORE_COMMENTS");var a=$.map(s.userPictures,function(t){return t.id}),o=$.map(s.commentsList,function(t){return $.map(t.comments,function(t){return t.user})}),n=$(o).not(a).get().join(",");s.getDataUsers(n).then(function(){s.renderUserProfilesAndImages()})}else s.setStateUIShowMoreComments(e,"NO_MORE_COMMENTS")}).fail(function(){s.setStateUIShowMoreComments(e,"ALLOW_MORE_COMMENTS")})):s.setStateUIShowMoreComments(e,"NO_MORE_COMMENTS")},renderCommentByDiscussion:function(t,e,i){var s,a=this.getTemplate("project-discussions-comments"),o={comments:[],user:this.getCurrentUserInfo(),isOpen:!bizagi.util.parseBoolean(this.params.isClosedForAllUsers)};i.length?(o.comments=i,s=a.render(o),t.append(s)):(o.comments=this.commentsList[e].comments,s=a.render(o),t.html(s))},getCommentByGuid:function(t,e){for(var i=this.commentsList[t].comments,s=0,a=i.length;s<a;s++)if(i[s].guid===e){for(var o=[],n=0,r=i[s].attachments.length;n<r;n++)o.push(i[s].attachments[n].guid);return{attachments:o,index:s}}return{}},returnServedCommentByParentId:function(t){if(void 0!==this.commentsList[t])return this.commentsList[t]},onShowButtonsPanel:function(t){t.closest(".ui-bizagi-wp-project-discussions-add-comment").find(".ui-bizagi-wp-project-discussions-comment-buttons-wrapper").show()},onRemoveFiles:function(t){var e,i,s,a=t.closest("li"),o=a.closest(".ui-bizagi-wp-project-attachments-list").data("type"),n=a.data("fileguid");if("COMMENT"===o){var r=a.closest(".ui-bizagi-wp-project-discussions-add-comment").data("guid");e=this.attchComments[r].addition,i=this.attchComments[r].remove}else e=this.attchDiscussions.addition,i=this.attchDiscussions.remove;for(var c=0,u=e.length-1;c<=u;c++)e[c].guid===n&&(s=e.splice(c,1),i.push(s[0].guid),c=u);a.remove()},onDeleteComment:function(t){var e=this,i=t.closest(".ui-bizagi-wp-project-discussions-item-comment"),s=i.data("cmmtguid"),a=i.closest(".ui-bizagi-wp-project-discussions-container-description-and-comments").data("guid"),o=e.getCommentByGuid(a,s),n={content:{guid:s},attachmentsToDelete:o.attachments};$.when(e.dataService.deleteComment(n)).always(function(t){200===t.status||void 0===t.status?(e.commentsList[a].comments.splice(o.index,1),i.remove()):e.notifier.showErrorMessage(printf(bizagi.localization.getResource("workportal-project-discussion-errordelete"),""))})},onSuccessFile:function(t,e){var i=this,s=t.files;if((t.XMLHttpRequest.response?JSON.parse(t.XMLHttpRequest.response):{}).error)"DISCUSSIONS"===e?i.plugins.attchDiscussions.onErrorFile(t):i.plugins.attchComments.onErrorFile(t);else{var a=$(t.sender.element).closest(".ui-bizagi-wp-project-discussion-textwrapper"),o=a.find(".ui-bizagi-wp-project-attachments-list");if("DISCUSSIONS"===e)i.plugins.attchDiscussions.setStatus("SUCCESS",s[0].guid),Array.prototype.push.apply(i.attchDiscussions.addition,s);else{i.plugins.attchComments.setStatus("SUCCESS",s[0].guid);var n=a.data("guid");i.attchComments[n]?Array.prototype.push.apply(i.attchComments[n].addition,s):i.attchComments[n]={addition:s,remove:[]},i.onShowButtonsPanel(o.parent())}i.renderAttachments(s,e,o)}},onDownloadAttachment:function(t){var e=t.data("fileguid");if(""!==e){var i=t.find(".bz-bizagi-wp-project-discussions-attachment-filename").text();this.dataService.getDownloadAttachment(e,i)}},onCancelComment:function(t){var e=t.closest(".ui-bizagi-wp-project-discussions-add-comment"),i=e.find(".ui-bizagi-wp-project-discussions-comment-buttons-wrapper"),s=e.find("textarea"),a=e.find(".ui-bizagi-wp-project-discussions-add-attachments form"),o=e.find(".k-tooltip-validation"),n=e.find(".ui-bizagi-wp-project-attachments-list"),r=e.data("guid");this.attchComments[r]={addition:[],remove:[]},this.plugins.attchComments.cancelFilesUpload(),a[0].reset(),n.empty(),s.val(""),o.hide(),i.hide()},onCreateComment:function(t,e){var i=this,s=t.closest(".ui-bizagi-wp-project-discussions-item-comment"),a=t.closest(".ui-bizagi-wp-project-discussions-comment-buttons-wrapper"),o=t.closest(".ui-bizagi-wp-project-discussions-add-comment"),n=o.find("textarea"),r=o.find(".ui-bizagi-wp-project-attachments-list"),c=o.data("guid"),u=i.prepareFilesToSave("COMMENTS",c),p={content:{guid:e,attachments:u.attachments,text:n.val(),parent:c,date:i.getDateServer(),user:bizagi.currentUser.idUser},attachmentsToCreate:u.attachmentsToCreate,attachmentsToDelete:u.attachmentsToDelete};$.when(i.dataService.postComment(p)).always(function(t){if(200===t.status||201===t.status||void 0===t.status){var e=s.siblings(".ui-bizagi-wp-project-discussion-comment-list"),o={user:p.content.user,attachments:p.content.attachments,text:p.content.text,guid:p.content.guid,parent:p.content.parent,date:p.content.date};i.attchComments[p.content.parent]={addition:[],remove:[]},n.val(""),r.empty(),a.hide(),i.commentsList[o.parent].comments.unshift(o),i.renderCommentByDiscussion(e,o.parent,[]),i.plugins.attchComments.close(),i.renderUserProfilesAndImages()}})},renderAttachments:function(t,e,i){var s=this.getTemplate("project-discussions-attachments").render({attachments:t,type:e});i.append(s),bizagi.util.isIE()&&$(".ui-bizagi-wp-project-attachments-list li").hide(10,function(){$(this).show()})},prepareFilesToSave:function(t,e){for(var i=[],s="COMMENTS"===t?this.attchComments[e]:this.attchDiscussions,a=[],o=0,n=(s=s||{addition:[],remove:[]}).addition.length-1;o<=n;o++)i.push({guid:s.addition[o].guid,name:s.addition[o].name}),a.push(s.addition[o].guid);return{attachments:i,attachmentsToCreate:a,attachmentsToDelete:s.remove}},onClickCancel:function(t){t.preventDefault();this.resetDiscussionAttachments(),this.onClosePopupDiscussion(),this.plugins.attchDiscussions.cancelFilesUpload()},onClosePopupDiscussion:function(){this.resetFormDiscussion(),this.plugins.attchDiscussions.destroy(),this.dialogBoxDiscussion.formContent.dialog("destroy"),this.dialogBoxDiscussion.formContent.detach()},onOpenPopupDiscussion:function(){var t=this;t.plugins.attchDiscussions=t.applyFileAttachments("DISCUSSIONS"),t.dialogBoxDiscussion.formContent.parent().css("z-index",10001),t.dialogBoxDiscussion.formContent.parent().parent().find(".ui-widget-overlay").css("z-index",10001),setTimeout(function(){t.form.subject.focus()},50)},onSubmitFormDiscussion:function(t){t.preventDefault();var e,i=this;i.validateAddDiscussionForm(i.dialogBoxDiscussion.formContent)&&(i.form.edition.guid?(e=i.form.edition.guid,$.proxy(i.sendDataUpdateDiscussion(e),i)):(e=Math.guid(),$.proxy(i.sendDataInsertDiscussion(e),i)))},restrictedEventsHandler:function(){var t=this.getContent();$("#ui-bizagi-wp-project-discussions-list-wrapper",t).on("click",".bz-bizagi-wp-project-discussions-attachment-itemwrapper",$.proxy(this.switchCommentsEvents,this))},eventsHandler:function(){var t=this,e=t.getContent();t.form.buttonShowFormNewDiscussion.on("click",$.proxy(t.onNotifyOpenPopup,t)),t.form.buttonCancel.on("click",$.proxy(t.onClickCancel,t)),t.form.buttonAddDiscussion.on("click",$.proxy(t.onSubmitFormDiscussion,t)),t.form.attachments.on("click",".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper",function(e){$(e.target).hasClass("bz-bizagi-wp-project-discussions-attachment-delete")?t.onRemoveFiles($(e.target)):t.onDownloadAttachment($(e.target).closest("li")),e.stopPropagation()}),$("#ui-bizagi-wp-project-discussions-list-wrapper",e).on("click",".ui-bizagi-wp-project-discussions-add-comment textarea, .ui-bizagi-wp-project-discussions-comment-buttons-cancel, .ui-bizagi-wp-project-discussions-comment-buttons-share, .ui-bizagi-wp-project-discussion-showmore-comments button, .bz-bizagi-wp-project-discussions-attachment-delete, .ui-bizagi-wp-project-discussion-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper, .ui-bizagi-wp-project-discussions-comment-view, .ui-bizagi-wp-project-discussions-items-edition, .biz-wp-action-edit-discussion",$.proxy(t.switchCommentsEvents,t)),t.sub("changeProjectWidget",function(){t.resetWidget()}),t.sub("OPEN_POPUP_DISCUSSION",$.proxy(t.onNotifyOpenPopup,t))},resetWidget:function(){this.userPictures=[],this.plugins.attchComments&&this.plugins.attchComments.close()},clean:function(){var t=this;for(var e in t.resetWidget(),t.form&&t.form.buttonShowFormNewDiscussion&&t.form.buttonShowFormNewDiscussion.off("click",$.proxy(t.onNotifyOpenPopup,t)),t.plugins)t.plugins[e]&&t.plugins[e].hasOwnProperty("destroy")&&t.plugins[e].destroy&&t.plugins[e].destroy()},mapTempComments:function(t,e){var i=t.find("textarea"),s=e.find("textarea"),a=t.find(".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]").first(),o=e.find(".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]").first();s.val(i.val()),o.empty().append(a.html())}}),bizagi.injector.register("bizagi.workportal.widgets.project.discussions",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.discussions],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.discussion.sidebar",{},{init:function(t,e,i){this._super(t,e,i),(i=i||{}).supportNav=!1,this.loadTemplates({"project-discussion-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.discussion.sidebar").concat("#project-discussion-sidebar")})},renderContent:function(){var t=this.getTemplate("project-discussion-sidebar");return this.content=t.render({isOpen:!bizagi.util.parseBoolean(this.params.isClosedForAllUsers)}),this.content},postRender:function(){var t=this.getContent();$(".ui-bizagi-wp-project-discussions-sidebar-action-add > a",t).on("click",$.proxy(this.onShowPopupDiscussion,this))},onShowPopupDiscussion:function(){this.pub("notify",{type:"OPEN_POPUP_DISCUSSION",args:{}})}}),bizagi.injector.register("bizagi.workportal.widgets.project.discussion.sidebar",["workportalFacade","dataService",bizagi.workportal.widgets.project.discussion.sidebar],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;(t.contextsSidebarActivity||[]).forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this;$.extend(i.params,e.args);var s=e.args;i.getContent().empty();var a={isFavoriteCase:"off"};if(s.isFavorite&&JSON.parse(s.isFavorite)?a.isFavoriteCase="bz-icon-star":a.isFavoriteCase="bz-icon-star-outline",i.showCaseNumber(s,a),s.creationDate){var o="MM/dd/yyyy H:mm",n=s.creationDate,r=bizagi.util.dateFormatter.getDateFromFormat(n,o);a.creationDateFormat=i.getFormattedDate(r);var c=bizagi.util.dateFormatter.getDateFromFormat(s.solutionDate,o);a.solutionDateFormat=i.getFormattedDate(c);var u=new Date;i.calculateDataForTemplate(a,r,u,c,s)}$(i.getContent()).on("click",".show-diagram-case",function(){!(!i.params.isAdhocProcess||void 0===i.params.isAdhocProcess)?i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkFlow,isAdhoc:!0,idProcess:i.params.idAdhocProcess}):i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkflow})}),$(i.getContent()).on("click",".show-process-help",function(){i.showHelpUrl(i.params.helpUrl)})},calculateDataForTemplate:function(t,e,i,s,a){var o=this.getContent(),n={};n.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(a.isOpen)?(n.fromDate=e.getTime(),n.toDate=i.getTime()):(n.fromDate=s.getTime(),n.toDate=i.getTime());var r=n.toDate-n.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-r),null,!1);bizagi.util.parseBoolean(a.isOpen)?(t.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),t.colorStateCase="Opened"):(t.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),t.colorStateCase="Closed"),t.percentCompleteBar=100,t.isOpen=bizagi.util.parseBoolean(a.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(a,t)).appendTo($("#ui-bizagi-remaining",o))},showCaseNumber:function(t,e){var i=this,s=i.getContent(),a=i.getTemplate("project-caseState"),o=!1;o=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,i.params.helpUrl=bizagi.util.validateUrlWellFormed(i.params.helpUrl),a.render($.extend(t,e,{security:bizagi.menuSecurity,isAdhocProcess:o,urlHelp:!bizagi.util.isEmpty(i.params.helpUrl)})).appendTo(s),$(".case-summary-favorite",s).on("click",$.proxy(i.onClickFavorite,i)),$(".case-summary-back",i.content).on("click",$.proxy(i.goToCase,i,"back")),$(".case-summary-next",i.content).on("click",$.proxy(i.goToCase,i,"next")),i.showBackNextNavigation()},getFormattedDate:function(t){var e=this.datePickerRegional.monthNames,i=t.getMonth(),s=BIZAGI_LANGUAGE;return null!=s&&null!=s&&s.length>0&&"fr"==s.substring(0,2)?$.datepicker.formatDate("dd",t)+" "+e[i]:e[i]+" "+$.datepicker.formatDate("dd",t)},onClickFavorite:function(t){t.preventDefault();var e=this,i={};$(t.target).hasClass("bz-icon-star-outline")?(i={idObject:e.params.idCase,favoriteType:"CASES"},$.when(e.dataService.addFavorite(i)).done(function(i){e.params.guidFavorite=i.idFavorites,$(t.target).removeClass("bz-icon-star-outline"),$(t.target).addClass("bz-icon-star")})):(i={idObject:e.params.guidFavorite,favoriteType:"CASES"},$.when(e.dataService.delFavorite(i)).done(function(){$(t.target).addClass("bz-icon-star-outline"),$(t.target).removeClass("bz-icon-star")}))},showHelpUrl:function(t){window.open(t)},callGetEffectiveDuration:function(t){var e=$.Deferred();return t.fromDate?$.when(this.dataService.getEffectiveDuration(t)).done(function(t){e.resolve(t)}):e.resolve(null),e.promise()},clean:function(){var t=this;$(".show-diagram-case",t.getContent()).off();var e=t.contextsSidebarActivity||[];this.params={},e.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})},goToCase:function(t){var e="back"==t?this.getBackCase():this.getNextCase();e>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var t=0;t<bizagi.lstIdCases.length;t++)if(this.params.idCase==bizagi.lstIdCases[t])return t;return-1},getNextCase:function(){var t=this.getListKey();return bizagi.lstIdCases.length==t+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[t+1]},getBackCase:function(){var t=this.getListKey();return 0==t?-1:bizagi.lstIdCases[t-1]||-1},showBackNextNavigation:function(){var t=this,e=t.getNextCase(),i=t.getBackCase();e<=0?$(".case-summary-next",t.content).hide():$(".case-summary-next",t.content).show(),i<=0?$(".case-summary-back",t.content).hide():$(".case-summary-back",t.content).show(),e<=0&&i<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,s=e.args;i.params=s,i.getContent();var a={},o=s.currentState||[],n=o.filter(function(t){return t.idWorkItem==s.idWorkitem})[0];if(n){a.activityName=n.state,a.activityIsEvent=bizagi.util.parseBoolean(n.isEvent);var r="MM/dd/yyyy H:mm",c=bizagi.util.dateFormatter.getDateFromFormat(n.entryDateWorkItem,r);c.getTime&&(a.initDateFormat=i.getFormattedDate(c));var u=new Date,p=bizagi.util.dateFormatter.getDateFromFormat(n.estimatedSolutionDate,r);a.estimatedSolutionDateFormat="",c.getTime&&p.getTime&&n?i.calculateDataForTemplate(n,a,c,u,p,o):i.updateTemplateWidget(a,o)}},initilizeActionMenu:function(t){var e=this,i=!1;if(t&&t.length>0)for(j=0;j<t.length;++j)t[j]&&e.params&&t[j].idWorkItem==e.params.idWorkitem&&(i=bizagi.util.parseBoolean(t[j].allowsReassign)||!1);var s=$("#bt-case-action-reassing",e.content),a=$("#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)",e.content);i&&s.show(),s.on("click",function(){e.onClickMenuReasign()}),a.on("click",function(){e.onClickShareActivity()})},onClickMenuReasign:function(){var t=this,e=t.params.idCase,i=t.params.idWorkitem,s=function(){t.publish("closeCurrentDialog")};bizagi.loader.startAndThen("admin").then(function(){$.when(t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:i,closeDialogWidget:s},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))})},onClickShareActivity:function(){var t={idWorkItem:this.params.idWorkitem},e=$("#ui-bizagi-wp-project-activity-button",this.content);e.attr("disabled",!0),$.when(this.dataService.getShareActivity(t)).done(function(t){var i=window.parent.bizagi.injector.get("notifier");!0===t.value?(e.addClass("ui-bizagi-wp-project-activity-shared").unbind("click"),i.showSucessMessage(bizagi.localization.getResource("workportal-project-activity-success-message"),"")):i.showErrorMessage(bizagi.localization.getResource("workportal-project-activity-error-message"),"")}).always(function(){e.attr("disabled",!1)})},calculateDataForTemplate:function(t,e,i,s,a,o){new Date(Date.now()-i.getTime());var n=s.getTime()-a.getTime(),r=i.getTime()-a.getTime(),c=(bizagi.currentUser.idUser,i.getTime()),u=Date.now(),p=!1,d={idUser:bizagi.currentUser.idUser,fromDate:s.getTime(),toDate:a.getTime()},l={};n>0?(d.fromDate=a.getTime(),d.toDate=s.getTime(),p=!0):(l.idUser=bizagi.currentUser.idUser,l.fromDate=i.getTime(),l.toDate=a.getTime());var g=u-c,m=d.toDate-d.fromDate,h=n>0?0:l.toDate-l.fromDate,f=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-g),null,!1);if(e.colorState=t.colorState,e.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",f),e.percentCompleteBar=100,0===r)e.showEstimatedSolutionDate=!1;else if(e.showEstimatedSolutionDate=!0,!1===p){var b=this.getPercentBar(h/1e3/60,m/1e3/60);e.percentCompleteBar=b.percent}t&&(e.isEvent=bizagi.util.parseBoolean(t.isEvent),e.canShareActivity=t.canShareActivity,e.isShared=t.isShared),e.estimatedSolutionDateFormat=this.getFormattedDate(a),this.updateTemplateWidget(e,o)},getPercentBar:function(t,e){var i={};return i.percent=Math.round(100*(1-e/t)),i},updateTemplateWidget:function(t,e){var i=this.getContent().empty();!1===bizagi.override.enableShareActivity&&(t.canShareActivity=!1,t.isShared=!1),this.getTemplate("project-activityState-wrapper").render(t).appendTo(i),e.length>0&&this.initilizeActionMenu(e),this.shareActivityTooltip()},shareActivityTooltip:function(){var t=$("#ui-bizagi-wp-project-activity-button",this.content);t.on("mouseenter",function(){var e=t.hasClass("ui-bizagi-wp-project-activity-shared")?"workportal-project-activity-shared":"workportal-project-activity-share";t.attr("title",bizagi.localization.getResource(e))}),t.tooltip({tooltipClass:"custom-tooltip-styling-bottom-bar",position:{my:"right top",at:"left top",of:t,collision:"flip"}})},getFormattedDate:function(t){var e=this.datePickerRegional.monthNames,i=t.getMonth(),s=BIZAGI_LANGUAGE;return null!=s&&null!=s&&s.length>0&&"fr"==s.substring(0,2)?$.datepicker.formatDate("dd",t)+" "+e[i]:e[i]+" "+$.datepicker.formatDate("dd",t)},clean:function(){var t=this,e=t.contextsSidebarActivity||[];this.params={},e.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})},callGetEffectiveDuration:function(t){var e=this,i=$.Deferred();return setTimeout(function(){t.fromDate?$.when(e.dataService.getEffectiveDuration(t)).done(function(t){i.resolve(t)}):i.resolve(null)},200),i.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var t=this.getTemplate("project-process-state");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,s=e.args,a=i.getContent().empty();i.params=s;var o={};o.showParentProcess=s.idParentCase>=1,o.parentProcess={displayName:s.parentDisplayName,idCase:s.idParentCase,idWorkItem:s.idWorkItem,idTask:"0"==s.idTask?"":s.idTask,idWorkflow:s.idWorkflowParentCase},i.getTemplate("project-process-state").render($.extend(s,o)).appendTo(a),$("#go-to-parent-case",a).on("click",$.proxy(i.onClickGoToParentCase,i))},onClickGoToParentCase:function(t){t.preventDefault();this.routingExecute($(t.target).closest("#go-to-parent-case"))},clean:function(){var t=this;t.params={},t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(t,e,i,s){var a=this;a.relatedusers=i,a._super(t,e,s),a.contextsSidebarActivity=s.contextsSidebarActivity,a.plugins={},a.users=[],a.loadedUsers=!1,a.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))}),t.sub("ON_RENDER_FINISH",$.proxy(t.onRenderFinish,t))},updateView:function(t,e){var i=this;i.params=e,setTimeout(function(){!1===i.loadedUsers&&i.onRenderFinish()},500)},onRenderFinish:function(){var t=this,e=t.params.args,i=t.getContent().empty();t.loadedUsers=!0,t.getTemplate("project-users").render().appendTo(i),t.showCreatorInformation(i);var s=[{id:e.createdBy.userId,typeName:"owner"}];e.idCase>0&&t.relatedusers.render(t.content,".relatedusers-wrapper",e.idCase,s)},showCreatorInformation:function(t){var e=this,i={userIds:e.params.args.createdBy.userId,width:50,height:50};e.dataService.getUsersData(i).done(function(i){var s=usersAdapter.createJsonUserInfo(i[0].id,i[0].name,i[0].username,i[0].picture?"data:image/png;base64,"+i[0].picture:void 0,i[0].email,i[0].name.getInitials(),!1,!0,[],[]);t.find("#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info").userinformation(e,{user:s})})},clean:function(){var t=this;t.loadedUsers=!1,t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(t){return t&&(responseSubprocessState=t),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(t){return t?jQuery.isArray(t)&&0===t.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(t):this.auxArrayListSubprocessesState}},{init:function(t,e,i){this._super(t,e,i),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(t){var e=this,i=e.getContent();$(t,i).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var t,i,s,a=$(this).closest("li").find("#idCase").val(),o=e.Class.auxArrayListSubprocesses().filter(function(t){return t.idCase==a});if(o.length>0)return t=o[0].indexSubprocess,i=o[0].idCustData,s=$(this).text(),e.getContentTooltip(t,i,s,e.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(t,e){if(void 0===t.originalEvent)return!1;var i=$(e.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(t,e){e.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(t,e,i,s){"-1"==e&&(e="0");var a=function(t,e){return{nameProperty:t,valueProperty:e}},o=[],n="",r=this.getSubprocessData(t,e),c=r.custData,u=r.custDataTypes,p=r.custFields,d=r.displayName;if(o.push(new a(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),d)),c.length)for(var l=0;l<c.length;l+=1)n=c[l],u&&("Money"==u[l]?n=bizagi.util.formatMonetaryCell(n):"Boolean"==u[l]?n=bizagi.util.formatBoolean(n):"Float"==u[l]||"Real"==u[l]?n=bizagi.util.formatDecimalCell(n):"function"==typeof n&&(n="")),o.push(new a(p[l],n));var g={};g.arrayCustomsProperties=o,g.nameSubprocess=i;var m=s,h=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(g).appendTo(h),h.html()},getSubprocessData:function(t,e){var i={},s=this.Class.responseSubprocess().subProcesses,a=this.Class.responseSubprocess().subProcPersonalized;if(s&&s.length>0){i.custData=s[t].custData,i.custDataTypes=s[t].custDataTypes;var o=this.Class.responseSubprocess().CustFields[e];i.custFields=o[Object.keys(o)[0]],i.displayName=s[t].displayName}else a&&Object.keys(a).length>0&&(i.custData=a[0].subProcesses[t].custData,i.custDataTypes=a[0].subProcesses[t].custDataTypes,i.custFields=a[0].CustFields[0],i.displayName=a[0].subProcesses[t].displayName);return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var t=this.getTemplate("project-events");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,s=e.args,a=i.getContent().empty();i.params=s,$.when(i.getArgsTemplate(s)).done(function(t){i.getTemplate("project-events").render($.extend(s,t)).appendTo(a),$(".list-events li.event a",a).on("click",$.proxy(i.onClickGoEvent,i)),i.initializeTooltip(".list-events li")})},getArgsTemplate:function(t){var e=$.Deferred(),i={};if(t.countEvents>=1)for(var s=0;s<t.currentState.length;s++)"true"==t.currentState[s].isEvent&&t.currentState[s].idWorkItem==t.idWorkitem&&(t.countEvents=t.countEvents-1);return i.showEvents=t.countEvents>=1,i.showEvents?$.when(this.callSummaryCaseEvents(t.idCase)).done(function(s){t.showEvents=s.events.length>=1,t.showEvents&&(i.events=[],s.events.forEach(function(t){i.events.push($.extend(t[Object.keys(t)[0]],{idWorkFlow:s.idWorkFlow}))})),e.resolve(i)}):e.resolve(i),e.promise()},onClickGoEvent:function(t){t.preventDefault();var e=this;$.when(bizagi.util.autoSave()).done(function(){e.routingExecute($(t.target).closest("li"))})},callSummaryCaseEvents:function(t){var e=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:t})).done(function(t){e.resolve(t)}),e.promise()},clean:function(){var t=this;this.params={},t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(t){return this._super(t)},auxArrayListSubprocesses:function(t){return this._super(t)}},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,s=e.args;i.getContent().empty();i.params=s,i.params.idCase>0&&$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done(function(t){i.Class.responseSubprocess(t),i.organizeDataForSubprocesses(i.params)})},organizeDataForSubprocesses:function(t){var e=this;if(e.Class.responseSubprocess().showSubProcess){$.each(e.Class.responseSubprocess().subProcesses,function(t){var i=e.Class.responseSubprocess().subProcesses[t].custData;if(i&&i.length)for(var s=0;s<i.length;s+=1)null===i[s]&&(i[s]="")});var i=e.Class.responseSubprocess().subProcesses||e.Class.responseSubprocess().subProcPersonalized;e.Class.auxArrayListSubprocesses([]);for(var s=0;s<Object.keys(i).length;s+=1){var a=i[s];e.Class.auxArrayListSubprocesses({isOpen:a.isOpen,radNumber:a.radNumber,displayName:a.displayName,idCase:a.idCase,indexSubprocess:s,idCustData:a.idCustData}),a.subProcesses&&Object.keys(a).forEach(function(t){e.Class.auxArrayListSubprocesses({isOpen:a[t].isOpen,radNumber:a[t].radNumber,displayName:a[t].displayName,idCase:a[t].idCase,indexSubprocess:s,idCustData:a[t].idCustData})})}e.renderWidget()}},renderWidget:function(){var t=this,e=t.getContent();t.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:t.Class.auxArrayListSubprocesses()}).appendTo(e),$(".list-subprocesses a",e).on("click",$.proxy(t.onClickGoSubprocess,t)),t.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(t){t.preventDefault();this.routingExecute($(t.target).closest("li"))},clean:function(){var t=this;t.params={},t.pluginTooltip=null,t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(t,e,i){this._super(t,e,i),i=i||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var t=this,e=t.getTemplate("project-activity-description"),i=t.getWorkitemDescription();return t.content=i?e.render({description:i}):$("<div />"),t.content},postRender:function(){},getWorkitemDescription:function(){for(var t=this.params||{},e=t.idWorkitem||0,i=t.currentState||[],s="",a=0;a<i.length;a++)if(e==i[a].idWorkItem){s=i[a].tskDescription;break}return s},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/comments.desktop.production.js.map
