bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(t,e,i){var a=this;a.params=i||{},a._super(t,e,i),a.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.params.contextsLeftSidebarCaseDashboard.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this;i.params=$.extend(i.params,e.args),i.params.plan.idActivitySelected=void 0,i.clean();var a=i.getContent().empty();void 0!==t.type&&(i.params.showContextByMenuDashboard=t.type);var r={showFormOverview:i.params.menuDashboard.showFormOverview,showFormActivity:i.params.menuDashboard.showFormActivity,showCommentsOptionMenu:i.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:i.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:i.params.menuDashboard.showTimeLineOptionMenu&&(!i.params.isAdhocProcess||i.params.isAdhocProcess&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")),showPlanOptionMenu:i.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:i.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:i.params.menuDashboard.contextFormActivityOptionMenu};i.getTemplate("project-dashboard-menu").render(r).appendTo(a),i.params.showContextByMenuDashboard&&$("li[data-context='"+i.params.showContextByMenuDashboard.toUpperCase()+"']",i.content).addClass("active").siblings().removeClass("active"),i.handlerEvents()},loadContentById:function(t){var e=this;t.preventDefault();var i=$(t.target).closest("li");if(!i.hasClass("active")){var a=i.data("context");if(a){var r=e.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),o=parseInt(r[0],10),s="",n=o;"PLANACTIVITIES"==a&&(n=o+1,s=bizagi.localization.getResource("workportal-project-casedashboard-plan")),e.params.refreshLastItemBreadcrumb=!1,e.pub("notify",{type:a.toUpperCase(),args:$.extend(e.params,{showContextByMenuDashboard:a,histName:s,level:n})}),$("li[data-context='"+e.params.showContextByMenuDashboard.toUpperCase()+"']",e.content).addClass("active").siblings().removeClass("active")}}},subMenuHandler:function(){var t=this.getContent(),e=$("[data-context='COMMENTS']",t),i=$("[data-context='FILES']",t),a=$("[data-context='TIMELINE']",t);$(".ui-bizagi-wp-project-tab-submenu a",t).on("click",function(){e.toggle(),i.toggle(),a.toggle()})},handlerEvents:function(){var t=this,e=t.getContent();t.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",e).on("click",$.proxy(t.loadContentById,t)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",e).on("click",function(){var e={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.params.idCase,idTask:t.params.idTask,idWorkflow:t.params.idWorkflow,idWorkItem:t.params.idWorkitem,referrer:t.params.referrer||"inboxGrid"};t.publish("executeAction",e)})},clean:function(){var t=this,e=t.getContent();t.params&&t.params.contextsLeftSidebarCaseDashboard&&t.params.contextsLeftSidebarCaseDashboard.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))}),$(".ui-bizagi-wp-project-tab-links a",e).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",e).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(t,e,i){this._super(t,e,i),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var t=this,e=t.getTemplate("project-content-dashboard");return t.content=e.render({}),t.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processMap",{},{init:function(t,e,i){var a=this;a._super(t,e,i),a.instanceBizagiProcessMap=new bizagi.processMap(this),a.loadTemplates({"project-processmap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-wrapper"),"project-process-diagram":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-process-diagram"),"project-activity-map":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-activity-map"),"project-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-subprocess")})},renderContent:function(){var t=this,e=t.instanceBizagiProcessMap.renderContent();return t.content=e.render(t.viewOptions),t.content},postRender:function(){this.instanceBizagiProcessMap.postRender()},configureHandlers:function(){this.instanceBizagiProcessMap.configureHandlers()},onProcessDiagram:function(){this.instanceBizagiProcessMap.onProcessDiagram()},onActivityMap:function(){this.instanceBizagiProcessMap.onActivityMap()},onSupprocess:function(){this.instanceBizagiProcessMap.onSupprocess()},navigationManager:function(t){var e=this.instanceBizagiProcessMap.navigationManager(t);e.container.append(e.template.render(e.viewOptions))},renderProcessDiagram:function(){this.instanceBizagiProcessMap.renderProcessDiagram()},resize:function(){this.instanceBizagiProcessMap.resize()},renderActivityMap:function(){this.instanceBizagiProcessMap.renderActivityMap()},renderSubProcessMap:function(){this.instanceBizagiProcessMap.renderSubProcessMap()},appendActivityMapZoom:function(){this.instanceBizagiProcessMap.appendActivityMapZoom()},appendProcessMapZoom:function(){this.instanceBizagiProcessMap.appendProcessMapZoom()},appendSubprocessZoom:function(){this.instanceBizagiProcessMap.appendSubprocessZoom()},appendSubprocessDragScroll:function(){this.instanceBizagiProcessMap.appendSubprocessDragScroll()},bindTooltip:function(t){this.instanceBizagiProcessMap.bindTooltip(t)}}),bizagi.injector.register("bizagi.workportal.widgets.project.processMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.processMap]),bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.project.processDiagram.helper",{},{getPVHeight:function(){var t=$(window).height()-50,e=this.$header.height()+180;return($(".ui-bizagi-wp-project-tab-content").height()||t)-e}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;(t.contextsSidebarActivity||[]).forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this;$.extend(i.params,e.args);var a=e.args;i.getContent().empty();var r={isFavoriteCase:"off"};if(a.isFavorite&&JSON.parse(a.isFavorite)?r.isFavoriteCase="bz-icon-star":r.isFavoriteCase="bz-icon-star-outline",i.showCaseNumber(a,r),a.creationDate){var o="MM/dd/yyyy H:mm",s=a.creationDate,n=bizagi.util.dateFormatter.getDateFromFormat(s,o);r.creationDateFormat=i.getFormattedDate(n);var c=bizagi.util.dateFormatter.getDateFromFormat(a.solutionDate,o);r.solutionDateFormat=i.getFormattedDate(c);var p=new Date;i.calculateDataForTemplate(r,n,p,c,a)}$(i.getContent()).on("click",".show-diagram-case",function(){!(!i.params.isAdhocProcess||void 0===i.params.isAdhocProcess)?i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkFlow,isAdhoc:!0,idProcess:i.params.idAdhocProcess}):i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkflow})}),$(i.getContent()).on("click",".show-process-help",function(){i.showHelpUrl(i.params.helpUrl)})},calculateDataForTemplate:function(t,e,i,a,r){var o=this.getContent(),s={};s.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(r.isOpen)?(s.fromDate=e.getTime(),s.toDate=i.getTime()):(s.fromDate=a.getTime(),s.toDate=i.getTime());var n=s.toDate-s.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n),null,!1);bizagi.util.parseBoolean(r.isOpen)?(t.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),t.colorStateCase="Opened"):(t.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),t.colorStateCase="Closed"),t.percentCompleteBar=100,t.isOpen=bizagi.util.parseBoolean(r.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(r,t)).appendTo($("#ui-bizagi-remaining",o))},showCaseNumber:function(t,e){var i=this,a=i.getContent(),r=i.getTemplate("project-caseState"),o=!1;o=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,i.params.helpUrl=bizagi.util.validateUrlWellFormed(i.params.helpUrl),r.render($.extend(t,e,{security:bizagi.menuSecurity,isAdhocProcess:o,urlHelp:!bizagi.util.isEmpty(i.params.helpUrl)})).appendTo(a),$(".case-summary-favorite",a).on("click",$.proxy(i.onClickFavorite,i)),$(".case-summary-back",i.content).on("click",$.proxy(i.goToCase,i,"back")),$(".case-summary-next",i.content).on("click",$.proxy(i.goToCase,i,"next")),i.showBackNextNavigation()},getFormattedDate:function(t){var e=this.datePickerRegional.monthNames,i=t.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",t)+" "+e[i]:e[i]+" "+$.datepicker.formatDate("dd",t)},onClickFavorite:function(t){t.preventDefault();var e=this,i={};$(t.target).hasClass("bz-icon-star-outline")?(i={idObject:e.params.idCase,favoriteType:"CASES"},$.when(e.dataService.addFavorite(i)).done(function(i){e.params.guidFavorite=i.idFavorites,$(t.target).removeClass("bz-icon-star-outline"),$(t.target).addClass("bz-icon-star")})):(i={idObject:e.params.guidFavorite,favoriteType:"CASES"},$.when(e.dataService.delFavorite(i)).done(function(){$(t.target).addClass("bz-icon-star-outline"),$(t.target).removeClass("bz-icon-star")}))},showHelpUrl:function(t){window.open(t)},callGetEffectiveDuration:function(t){var e=$.Deferred();return t.fromDate?$.when(this.dataService.getEffectiveDuration(t)).done(function(t){e.resolve(t)}):e.resolve(null),e.promise()},clean:function(){var t=this;$(".show-diagram-case",t.getContent()).off();var e=t.contextsSidebarActivity||[];this.params={},e.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})},goToCase:function(t){var e="back"==t?this.getBackCase():this.getNextCase();e>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var t=0;t<bizagi.lstIdCases.length;t++)if(this.params.idCase==bizagi.lstIdCases[t])return t;return-1},getNextCase:function(){var t=this.getListKey();return bizagi.lstIdCases.length==t+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[t+1]},getBackCase:function(){var t=this.getListKey();return 0==t?-1:bizagi.lstIdCases[t-1]||-1},showBackNextNavigation:function(){var t=this,e=t.getNextCase(),i=t.getBackCase();e<=0?$(".case-summary-next",t.content).hide():$(".case-summary-next",t.content).show(),i<=0?$(".case-summary-back",t.content).hide():$(".case-summary-back",t.content).show(),e<=0&&i<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,a=e.args;i.params=a,i.getContent();var r={},o=a.currentState||[],s=o.filter(function(t){return t.idWorkItem==a.idWorkitem})[0];if(s){r.activityName=s.state,r.activityIsEvent=bizagi.util.parseBoolean(s.isEvent);var n="MM/dd/yyyy H:mm",c=bizagi.util.dateFormatter.getDateFromFormat(s.entryDateWorkItem,n);c.getTime&&(r.initDateFormat=i.getFormattedDate(c));var p=new Date,d=bizagi.util.dateFormatter.getDateFromFormat(s.estimatedSolutionDate,n);r.estimatedSolutionDateFormat="",c.getTime&&d.getTime&&s?i.calculateDataForTemplate(s,r,c,p,d,o):i.updateTemplateWidget(r,o)}},initilizeActionMenu:function(t){var e=this,i=!1;if(t&&t.length>0)for(j=0;j<t.length;++j)t[j]&&e.params&&t[j].idWorkItem==e.params.idWorkitem&&(i=bizagi.util.parseBoolean(t[j].allowsReassign)||!1);var a=$("#bt-case-action-reassing",e.content),r=$("#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)",e.content);i&&a.show(),a.on("click",function(){e.onClickMenuReasign()}),r.on("click",function(){e.onClickShareActivity()})},onClickMenuReasign:function(){var t=this,e=t.params.idCase,i=t.params.idWorkitem,a=function(){t.publish("closeCurrentDialog")};bizagi.loader.startAndThen("admin").then(function(){$.when(t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:i,closeDialogWidget:a},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))})},onClickShareActivity:function(){var t={idWorkItem:this.params.idWorkitem},e=$("#ui-bizagi-wp-project-activity-button",this.content);e.attr("disabled",!0),$.when(this.dataService.getShareActivity(t)).done(function(t){var i=window.parent.bizagi.injector.get("notifier");!0===t.value?(e.addClass("ui-bizagi-wp-project-activity-shared").unbind("click"),i.showSucessMessage(bizagi.localization.getResource("workportal-project-activity-success-message"),"")):i.showErrorMessage(bizagi.localization.getResource("workportal-project-activity-error-message"),"")}).always(function(){e.attr("disabled",!1)})},calculateDataForTemplate:function(t,e,i,a,r,o){new Date(Date.now()-i.getTime());var s=a.getTime()-r.getTime(),n=i.getTime()-r.getTime(),c=(bizagi.currentUser.idUser,i.getTime()),p=Date.now(),d=!1,u={idUser:bizagi.currentUser.idUser,fromDate:a.getTime(),toDate:r.getTime()},l={};s>0?(u.fromDate=r.getTime(),u.toDate=a.getTime(),d=!0):(l.idUser=bizagi.currentUser.idUser,l.fromDate=i.getTime(),l.toDate=r.getTime());var g=p-c,m=u.toDate-u.fromDate,h=s>0?0:l.toDate-l.fromDate,b=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-g),null,!1);if(e.colorState=t.colorState,e.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",b),e.percentCompleteBar=100,0===n)e.showEstimatedSolutionDate=!1;else if(e.showEstimatedSolutionDate=!0,!1===d){var v=this.getPercentBar(h/1e3/60,m/1e3/60);e.percentCompleteBar=v.percent}t&&(e.isEvent=bizagi.util.parseBoolean(t.isEvent),e.canShareActivity=t.canShareActivity,e.isShared=t.isShared),e.estimatedSolutionDateFormat=this.getFormattedDate(r),this.updateTemplateWidget(e,o)},getPercentBar:function(t,e){var i={};return i.percent=Math.round(100*(1-e/t)),i},updateTemplateWidget:function(t,e){var i=this.getContent().empty();!1===bizagi.override.enableShareActivity&&(t.canShareActivity=!1,t.isShared=!1),this.getTemplate("project-activityState-wrapper").render(t).appendTo(i),e.length>0&&this.initilizeActionMenu(e),this.shareActivityTooltip()},shareActivityTooltip:function(){var t=$("#ui-bizagi-wp-project-activity-button",this.content);t.on("mouseenter",function(){var e=t.hasClass("ui-bizagi-wp-project-activity-shared")?"workportal-project-activity-shared":"workportal-project-activity-share";t.attr("title",bizagi.localization.getResource(e))}),t.tooltip({tooltipClass:"custom-tooltip-styling-bottom-bar",position:{my:"right top",at:"left top",of:t,collision:"flip"}})},getFormattedDate:function(t){var e=this.datePickerRegional.monthNames,i=t.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",t)+" "+e[i]:e[i]+" "+$.datepicker.formatDate("dd",t)},clean:function(){var t=this,e=t.contextsSidebarActivity||[];this.params={},e.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})},callGetEffectiveDuration:function(t){var e=this,i=$.Deferred();return setTimeout(function(){t.fromDate?$.when(e.dataService.getEffectiveDuration(t)).done(function(t){i.resolve(t)}):i.resolve(null)},200),i.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var t=this.getTemplate("project-process-state");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,a=e.args,r=i.getContent().empty();i.params=a;var o={};o.showParentProcess=a.idParentCase>=1,o.parentProcess={displayName:a.parentDisplayName,idCase:a.idParentCase,idWorkItem:a.idWorkItem,idTask:"0"==a.idTask?"":a.idTask,idWorkflow:a.idWorkflowParentCase},i.getTemplate("project-process-state").render($.extend(a,o)).appendTo(r),$("#go-to-parent-case",r).on("click",$.proxy(i.onClickGoToParentCase,i))},onClickGoToParentCase:function(t){t.preventDefault();this.routingExecute($(t.target).closest("#go-to-parent-case"))},clean:function(){var t=this;t.params={},t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(t,e,i,a){var r=this;r.relatedusers=i,r._super(t,e,a),r.contextsSidebarActivity=a.contextsSidebarActivity,r.plugins={},r.users=[],r.loadedUsers=!1,r.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))}),t.sub("ON_RENDER_FINISH",$.proxy(t.onRenderFinish,t))},updateView:function(t,e){var i=this;i.params=e,setTimeout(function(){!1===i.loadedUsers&&i.onRenderFinish()},500)},onRenderFinish:function(){var t=this,e=t.params.args,i=t.getContent().empty();t.loadedUsers=!0,t.getTemplate("project-users").render().appendTo(i),t.showCreatorInformation(i);var a=[{id:e.createdBy.userId,typeName:"owner"}];e.idCase>0&&t.relatedusers.render(t.content,".relatedusers-wrapper",e.idCase,a)},showCreatorInformation:function(t){var e=this,i={userIds:e.params.args.createdBy.userId,width:50,height:50};e.dataService.getUsersData(i).done(function(i){var a=usersAdapter.createJsonUserInfo(i[0].id,i[0].name,i[0].username,i[0].picture?"data:image/png;base64,"+i[0].picture:void 0,i[0].email,i[0].name.getInitials(),!1,!0,[],[]);t.find("#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info").userinformation(e,{user:a})})},clean:function(){var t=this;t.loadedUsers=!1,t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(t){return t&&(responseSubprocessState=t),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(t){return t?jQuery.isArray(t)&&0===t.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(t):this.auxArrayListSubprocessesState}},{init:function(t,e,i){this._super(t,e,i),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(t){var e=this,i=e.getContent();$(t,i).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var t,i,a,r=$(this).closest("li").find("#idCase").val(),o=e.Class.auxArrayListSubprocesses().filter(function(t){return t.idCase==r});if(o.length>0)return t=o[0].indexSubprocess,i=o[0].idCustData,a=$(this).text(),e.getContentTooltip(t,i,a,e.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(t,e){if(void 0===t.originalEvent)return!1;var i=$(e.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(t,e){e.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(t,e,i,a){"-1"==e&&(e="0");var r=function(t,e){return{nameProperty:t,valueProperty:e}},o=[],s="",n=this.getSubprocessData(t,e),c=n.custData,p=n.custDataTypes,d=n.custFields,u=n.displayName;if(o.push(new r(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),u)),c.length)for(var l=0;l<c.length;l+=1)s=c[l],p&&("Money"==p[l]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==p[l]?s=bizagi.util.formatBoolean(s):"Float"==p[l]||"Real"==p[l]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),o.push(new r(d[l],s));var g={};g.arrayCustomsProperties=o,g.nameSubprocess=i;var m=a,h=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(g).appendTo(h),h.html()},getSubprocessData:function(t,e){var i={},a=this.Class.responseSubprocess().subProcesses,r=this.Class.responseSubprocess().subProcPersonalized;if(a&&a.length>0){i.custData=a[t].custData,i.custDataTypes=a[t].custDataTypes;var o=this.Class.responseSubprocess().CustFields[e];i.custFields=o[Object.keys(o)[0]],i.displayName=a[t].displayName}else r&&Object.keys(r).length>0&&(i.custData=r[0].subProcesses[t].custData,i.custDataTypes=r[0].subProcesses[t].custDataTypes,i.custFields=r[0].CustFields[0],i.displayName=r[0].subProcesses[t].displayName);return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var t=this.getTemplate("project-events");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,a=e.args,r=i.getContent().empty();i.params=a,$.when(i.getArgsTemplate(a)).done(function(t){i.getTemplate("project-events").render($.extend(a,t)).appendTo(r),$(".list-events li.event a",r).on("click",$.proxy(i.onClickGoEvent,i)),i.initializeTooltip(".list-events li")})},getArgsTemplate:function(t){var e=$.Deferred(),i={};if(t.countEvents>=1)for(var a=0;a<t.currentState.length;a++)"true"==t.currentState[a].isEvent&&t.currentState[a].idWorkItem==t.idWorkitem&&(t.countEvents=t.countEvents-1);return i.showEvents=t.countEvents>=1,i.showEvents?$.when(this.callSummaryCaseEvents(t.idCase)).done(function(a){t.showEvents=a.events.length>=1,t.showEvents&&(i.events=[],a.events.forEach(function(t){i.events.push($.extend(t[Object.keys(t)[0]],{idWorkFlow:a.idWorkFlow}))})),e.resolve(i)}):e.resolve(i),e.promise()},onClickGoEvent:function(t){t.preventDefault();var e=this;$.when(bizagi.util.autoSave()).done(function(){e.routingExecute($(t.target).closest("li"))})},callSummaryCaseEvents:function(t){var e=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:t})).done(function(t){e.resolve(t)}),e.promise()},clean:function(){var t=this;this.params={},t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(t){return this._super(t)},auxArrayListSubprocesses:function(t){return this._super(t)}},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach(function(e){t.sub(e,$.proxy(t.updateView,t))})},updateView:function(t,e){var i=this,a=e.args;i.getContent().empty();i.params=a,i.params.idCase>0&&$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done(function(t){i.Class.responseSubprocess(t),i.organizeDataForSubprocesses(i.params)})},organizeDataForSubprocesses:function(t){var e=this;if(e.Class.responseSubprocess().showSubProcess){$.each(e.Class.responseSubprocess().subProcesses,function(t){var i=e.Class.responseSubprocess().subProcesses[t].custData;if(i&&i.length)for(var a=0;a<i.length;a+=1)null===i[a]&&(i[a]="")});var i=e.Class.responseSubprocess().subProcesses||e.Class.responseSubprocess().subProcPersonalized;e.Class.auxArrayListSubprocesses([]);for(var a=0;a<Object.keys(i).length;a+=1){var r=i[a];e.Class.auxArrayListSubprocesses({isOpen:r.isOpen,radNumber:r.radNumber,displayName:r.displayName,idCase:r.idCase,indexSubprocess:a,idCustData:r.idCustData}),r.subProcesses&&Object.keys(r).forEach(function(t){e.Class.auxArrayListSubprocesses({isOpen:r[t].isOpen,radNumber:r[t].radNumber,displayName:r[t].displayName,idCase:r[t].idCase,indexSubprocess:a,idCustData:r[t].idCustData})})}e.renderWidget()}},renderWidget:function(){var t=this,e=t.getContent();t.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:t.Class.auxArrayListSubprocesses()}).appendTo(e),$(".list-subprocesses a",e).on("click",$.proxy(t.onClickGoSubprocess,t)),t.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(t){t.preventDefault();this.routingExecute($(t.target).closest("li"))},clean:function(){var t=this;t.params={},t.pluginTooltip=null,t.contextsSidebarActivity.forEach(function(e){t.unsub(e,$.proxy(t.updateView,t))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap",{},{init:function(t,e,i){this.radNumber=i.radNumber,this._super(t,e,i),this.loadTemplates({"project-activityMap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityMap").concat("#project-activityMap-wrapper")})},renderContent:function(){var t=this.getTemplate("project-activityMap");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.sub("HOME",$.proxy(t.updateView,t)),t.sub("OVERVIEW",$.proxy(t.updateView,t)),t.sub("COMMENTS",$.proxy(t.updateView,t)),t.sub("PROCESSMAP",$.proxy(t.updateView,t)),t.sub("LOG",$.proxy(t.updateView,t)),t.sub("PLANCREATE",$.proxy(t.updateView,t)),t.sub("PLANCOMMENTS",$.proxy(t.updateView,t))},updateView:function(t,e){var i=e.args,a=this.getContent().empty(),r={actualState:""};i.currentState[0]&&(r.actualState=i.currentState[0].state),this.getTemplate("project-activityMap").render($.extend(i,r)).appendTo(a),this.params=i}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityMap],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap.tooltip",{},{init:function(t,e,i){this._super(t,e,i),this.loadTemplates({"project-tooltip":bizagi.getTemplate("bizagi.workportal.desktop.widget.activityMap.tooltip").concat("#project-processmap-tooltip")}),this.cache={},this.radNumber=i.radNumber},renderContent:function(){},postRender:function(){this.dateFormat=this.getResource("dateFormat")+" "+this.getResource("timeFormat")},configureHandlers:function(t,e){t.find(".ui-bizagi-wp-project-processmap-process").on("click",$.proxy(this.onProcess,this,e)),t.find(".ui-bizagi-wp-project-processmap-tooltip-title").on("click",$.proxy(this.onIdCase,this,e))},onProcess:function(t,e){this.showGraphicQuery(t)},onIdCase:function(t,e){var i=$(e.currentTarget).data("idcase"),a=$(e.currentTarget).data("idworkitem"),r=$(e.currentTarget).data("idtask"),o=$(e.currentTarget).data("idworkflow");this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkItem:a,idTask:r,idWorkflow:o})},bindTooltip:function(t){var e=this;e.tooltipClass=t.tooltipClass,t.$container.tooltip({items:t.items,content:function(i){if(!(t.$container.data("clicked")||!1)){if("activityMap"==t.diagram){if(!$(this).is("circle"))return;if(this.className.baseVal.indexOf("activity-map-activity-highlight")<0)return;$.when(e.getActivityMapTooltipContent($(this))).done(function(t){i(t)})}else{var a=e.getSubprocessTooltipContent($(this));i(a)}return"loading.."}},open:function(t,e){for(var i=0;i<$(".ui-tooltip").length-1;i++)$("#"+$(".ui-tooltip")[i].id).remove()},show:{duration:60,effect:"none"},tooltipClass:e.tooltipClass,hide:{delay:60,duration:60},position:{my:"left+20 top+20"},close:function(t,e){e.tooltip.hover(function(){$(this).stop(!0).fadeTo(120,1)},function(){$(this).fadeOut(20,function(){$(this).remove()})})}})},getActivityMapTooltipContent:function(t){var e=this,i=new $.Deferred,a=t.data("guidWorkitem"),r={guidWorkitem:a,gqData:{idCase:t.data("idCase"),idWorkflow:t.data("idWorkflow")}};if(e.guidWorkitem=a,e.isCached(r.guidWorkitem)){var o=e.cache[r.guidWorkitem];i.resolve(e.buildContent(o,r.gqData))}else $.when(e.dataService.getActivitySummary(r)).done(function(t){i.resolve(e.buildContent(t,r.gqData)),e.appendToCache(r.guidWorkitem,t)});return i.promise()},getSubprocessTooltipContent:function(t){var e={gqData:{idCase:t.data("idcase"),idWorkflow:t.data("idworkflow")}},i={endDate:t.data("enddate"),startDate:t.data("startdate"),process:t.data("process"),idCase:t.data("idcase")};return this.buildContent(i,e.gqData)},appendToCache:function(t,e){this.cache[t]=e},isCached:function(t){return void 0!==this.cache[t]},buildContent:function(t,e){var i=this,a=$("<div></div>"),r=i.getTemplate("project-tooltip"),o=void 0!==t.assigneeName;return t.assignee=o,t.radNumber=i.radNumber,t.idWorkflow=e.idWorkflow,t.idTask=t.idTask||0,t.idWorkitem=t.idWorkItem||0,t.graphicQuery=bizagi.menuSecurity.GraphicQuery,a=r.render(t),$("."+i.tooltipClass).html(a),bizagi.util.formatInvariantDate(a,i.dateFormat),i.configureHandlers(a,e),a}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(t,e,i){this._super(t,e,i),i=i||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var t=this,e=t.getTemplate("project-activity-description"),i=t.getWorkitemDescription();return t.content=i?e.render({description:i}):$("<div />"),t.content},postRender:function(){},getWorkitemDescription:function(){for(var t=this.params||{},e=t.idWorkitem||0,i=t.currentState||[],a="",r=0;r<i.length;r++)if(e==i[r].idWorkItem){a=i[r].tskDescription;break}return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/processmap.desktop.production.js.map
