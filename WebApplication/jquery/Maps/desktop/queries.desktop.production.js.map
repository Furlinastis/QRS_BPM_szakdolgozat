{"version":3,"sources":["jquery/workportal/js/base/widget/bizagi.workportal.widgets.queries.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.listCases.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.queryform.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queries.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queries.definition.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queries.shortcut.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queryform.js","jquery/workportal/desktop/widget/queries.management/bizagi.workportal.desktop.widgets.queries.management.js"],"names":["bizagi","workportal","widgets","widget","extend","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_QUERIES","renderContent","self","this","template","getTemplate","content","$","tmpl","loadtemplates","BIZAGI_WORKPORTAL_WIDGET_LISTCASES","setTableHeadFixed","params","TableElement","floatThead","floatOptions","groupByCaseNumber","util","isIE","find","hide","listCases","BIZAGI_WORKPORTAL_WIDGET_QUERYFORM","parseBoolean","override","disableFrankensteinQueryForms","notMigratedUrl","modifiedRender","frankensteinRenderContent","url","idQueryForm","idStoredQuery","idCube","queryFormAction","dataService","getUrl","endPoint","lastQueryFullKey","queryFormURL","queries","init","workportalFacade","_super","loadTemplates","concat","queries-elements","queries-empty-elements","queries-query-tree","queries-query-confirm","useNewEngine","postRender","configureTreeNavigation","configureBackButton","renderQueries","scrollVertical","autohide","idParentQuery","appendElement","queryContent","mergeData","getContent","emptyTemplate","queriesContainer","when","getQueries","idElement","done","data","empty","length","undefined","merge","checkChildNode","appendTo","configureNavTree","confirm","click","children","val","queryId","prefix","nodesLength","id","queryDisplayName","headerTemplate","categoryTree","idParent","nodes","categoryWithLink","desktop","popup","closePopupInstance","title","showQueryFormPopup","idQuery","e","stopPropagation","parent","dialog","resizable","modal","getResource","buttons","text","ajax","destroy","btnBack","remove","nextAll","bizagiScrollbar","arg","currentPopup","publish","widgetName","modalParameters","queries-definition-elements","queries-definition-manage-elements","queries-liveprocesses-query-element","queries-flat-list","queries-query-message-error","mainTemplate","mainTemplateManage","mainTemplateLiveProcessesQuery","flatListTemplate","confirmTemplate","messageErrorTemplate","showManageQueries","templateManage","isManageQueries","menuSecurity","QueriesPermissionManager","isEnableFeature","manageContent","getLiveProcessesQuery","hasLiveProcessesQuery","AdhocUserGroupReport","mergeQueryWithLpContent","lpContent","beforeSavedQueriesContent","manage","tmplRendered","validateMenu","append","addEventToMangeQueries","BIZAGI_WORKPORTAL_WIDGET_QUERIES_MANAGEMENT","maximize","closeVisible","localization","width","height","refreshInbox","addEventToLPQuery","document","contentWindow","location","href","indexOf","liveProcessesEvents","routeEvents","route","dispatchEvent","BIZAGI_WORKPORTAL_WIDGET_PROFLY","module","getQueriesDefinitions","securityBizagiQueries","idNode","defer","Deferred","resolve","promise","getStoredQueryFormList","storedQueryForms","BizagiQueries","storedQueryForm","stored","queryType","guidForm","renderStoredQueries","guidContext","guidEntity","confirmContent","confirmContentParams","notMigratedUrlDelete","container","paramsStoredQuery","guid","result","grep","definition","name","execute","edit","messageErrorForm","replace","loader","productBuildToAbout","cookie","messageError","get","deleteStoredQueryForm","idStoredQueryForm","maximizeOnly","editQueryForm","showPopUpEditQueryForm","executeQueryForm","showPopUpResultsQueryForm","response","getParamsStoredQuery","queries-shortcut","queries-shortcut-flat-list","queries-shortcut-query-confirm","queries-shortcut-query-message-error","handleEvents","shortcut","instance","show","queryFormShortcut","arrow","is","removeClass","addClass","closest","queryform","queryform-wrapper","queryform-container","queryform-buttons","queryform-graphic-analysis","queryform-result-set","queryform-search-result","queryform-pagination","queryform-admin-result","queryform-share-selection","queryform-select-user","queryform-select-group","queryform-save-as","queryform-message-error","referrerParams","referrer","Boolean","modifiedPostRender","frankensteinPostRender","graphicalAnalysisContainer","resultSet","searchResult","paginationTmpl","adminResult","selectUser","selectGroup","shareSelection","dialogSaveAsTmpl","maxElemShow","maxPageToShow","atLeastOneChecked","selectedItemsToShare","users","groups","readyToSave","includeAllUsers","saveAs","sortedField","storedQueryFormParameters","dialogSaveAs","orderType","ASC","DESC","NONE","queryFormContextTypes","CASES","ENTITY","queryFormTypes","htmlMessage","html","queryParams","ownerQuery","showSaveResultsForm","prop","entityGuid","queryFormType","type","renderQueryForm","previousValues","parameters","JSON","parse","initialSearchParams","pageToShow","contextType","queryForm","findResults","actionSubmitQueryForm","actionForm","searchParams","numberOfRows","pageNumber","queryFormGuid","owner","stringify","queryFormParams","h_action","h_contexttype","h_idForm","getQueryForm","queryFormElements","form","elements","actionExecute","values","h_idqueryform","renderContainer","renderingParams","canvas","startAndThen","then","rendering","facade","properties","validateRequireField","keyup","css","setXpathValuesToQueryForm","parentName","parentQueryForm","control","searchParameters","each","key","parameter","getRender","xpath","setValue","value","setDisplayValue","console","log","pageResultsData","I_PROCESSSTATE","h_idEnt","h_idQueryForm","enableButton","dialogContent","originalHeight","recalculateQueryForm","request","getSearchParams","submitQueryForm","disableButton","tooltip","createStoredQueryForm","updateStoredQueryForm","fromExec","paramsStored","description","displayName","htmlGraphicalAnalysis","h_guidQueryForm","h_idStoredQuery","h_definition","delay","submit","iframe","dialogHeight","calculateHeight","on","sortParameter","sorted","newParameters","i","item","push","included","searchType","requestForSearch","refactorParameters","p_sessionId","getQueryFormExportExcel","button","size","attr","removeAttr","onlyLocalResults","throwMessageAtLeastOneCheck","showMessageBox","validateTypeAndOneCheck","loadingGetQueryForm","bizagiConfig","group","security","command","deferResults","getQueryFormResponse","bind","checkSecurityPerm","resultList","graphicQuery","timeline","enabledIcons","validateSecurityOptionIcons","totalRecords","records","totalPages","total","rows","showSearchResultFrame","fail","error","tmpTL","enableFeatureShowTimelineButton","radNumerIndex","findIndex","el","radNumber","forEach","row","header","dataType","splice","checkDisplayedNames","foundDisplayName","getRenderElementDisplayByXpath","searchParameter","storedQueryFormParameter","fullParameterXpath","displayXpath","storedDefinition","displayHeader","l","element","includePreference","render","elementXpath","fullEelementXpath","_formatValue","enableFormatMoneyColumnQueryResult","formatValueByDataType","cleanEmptyColorState","paginationHtml","resultTemplate","headers","securityGraphicQuery","GraphicQuery","getRadNumberColumnIndex","index","fieldName","showColumn","columnIndex","createGroupedHeader","rowIndex","getRadNumber","formatValue","isIEAndFirstRowAndGroupCases","pageToshow","summaryWrapper","pagerData","pagination","page","pages","permissions","canExportData","canAnalizeData","bizagiPagination","actualPage","listElement","clickCallBack","options","target","first","paramXpath","findSortedResults","currentTarget","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","getAttribute","idWorkItem","idTask","idWorkflow","showGraphicQuery","caseNumber","showTimeLine","position","scrollContainer","applyFomatNumbers","elementsDataType","userLocalization","numberHeaders","formatInvariantNumber","map","col","Array","isArray","filter","colorState","clonedParams","buildStoredQueryFormParams","saveStoredQueryForm","has","getWidget","pipe","closeQueryForm","unique","alert","nameSaveAs","nameSave","trim","validationController","validateForm","next","initShareSelection","change","searchGroupToShare","shareSlection","tabs","test","searchUserToShare","removeItem","addItem","searchSavedUser","filterData","userName","domain","fullName","searchUsersSharedQuery","filteredUsers","inArray","idUser","showDataToShare","shareType","searchUsersByID","addPrevious","searchProfiles","profileType","filteredGroups","groupsSelected","items","itemSelected","selectData","elementList","replaceWith","Option","auxUsers","toArray","arrayUserValues","userId","HTMLEncodeText","strText","strNew","cssList","injectCss","getStyle","load","iframeContent","contents","siblings","callBack","openBACase","sHref","workitem","workflow","substring","controller","routingAction","getElementById","lstCasesElement","bizagireference","lstIdCases","split","dialogStack","ShowCaseSumary","getCaseFormsRenderVersion","version","formsRenderVersion","BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME","widgetURL","serviceLocator","resources","afterLoad","afterLoadParams","genericIframe","callInside","jQuery","selectedUsers","queries-management","queries-management-loader","queries-management-table","setupSearchusersButton","loaderTmpl","fixedHeadTable","fixedHeadTableElement","zIndex","onResizeModalEvent","clean","parents","trigger","setupUsersSearchForm","input","user","def","usersTable","userstable","userLinkLabel","parentDef","showBackButton","getApplicationCategoriesList","applicationList","allProcess","haveProcess","showHideClearIcon","showNotifier","message","window","injector","showSucessMessage","showLoading","endLoading","clearInput","display","guidUser","getManagementQueries","dataTable","renderTable","contentTable","validateUsers","resp","transferQueries","label","showConfirmationBox","dialogClass","minWidth","guidUserSource","guidUserTarget","register","management"],"mappings":"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","sourcesContent":["/*\r\n*   Name: BizAgi Workportal New Case Widget Controller\r\n*   Author: Edward Morales\r\n*   Comments:\r\n*   -   This script will define a base class to to define the new case widget\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.queries\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function(){  \r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES;\r\n    },\r\n    \r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queries\");\r\n        var content = self.content = $.tmpl(template);\r\n        self.loadtemplates();\r\n        return content;\r\n    },\r\n    /*\r\n     * this will be implemented on each device\r\n     */\r\n    loadtemplates: function () { }\r\n});\r\n","/*\r\n*   Name: BizAgi Desktop List Cases implementation\r\n*   Author: Kevin Alvarado\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.listCases\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES;\r\n    },\r\n    \r\n    /**\r\n    * Set the table with the fixed thead\r\n    * @param {Json} params TableElement,groupByCaseNumber,floatOptions\r\n    */\r\n    setTableHeadFixed:function(params) {\r\n        params.TableElement.floatThead(params.floatOptions);\r\n        \r\n        if(params.groupByCaseNumber && bizagi.util.isIE()){\r\n            params.TableElement.find(\"tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide\").hide();\r\n        }\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Desktop Queries Dialog implementation\r\n*   Author: Juan Pablo Crossley\r\n*   Comments:\r\n*   -   ???\r\n*/\r\n\r\n// Extends itself\r\nbizagi.workportal.widgets.listCases.extend(\"bizagi.workportal.widgets.queryform\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM;\r\n    },\r\n\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        if (bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms) && !self.params.notMigratedUrl) {\r\n            self.modifiedRender();\r\n        }\r\n        else {\r\n            self.frankensteinRenderContent();\r\n        }\r\n    },\r\n\r\n    modifiedRender: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queryform-wrapper\");\r\n        var content;\r\n        content = self.content = $.tmpl(template, {});\r\n        self.loadtemplates();\r\n        return content;\r\n    },\r\n\r\n    /*\r\n    * this will be implemented on each device\r\n    */\r\n    loadtemplates: function () { },\r\n\r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    frankensteinRenderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queryform\");\r\n        var url = \"\";\r\n\r\n        var idQueryForm = self.params.idQueryForm || \"\";\r\n        var idStoredQuery = self.params.idStoredQuery || \"\";\r\n        var idCube = self.params.idCube || \"\";\r\n\r\n        // Define actions of queryform\r\n        switch (self.params.queryFormAction) {\r\n            case \"edit\":\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form-edit\"\r\n                }) + \"?idStoredQuery=\" + idStoredQuery + \"&idQueryForm=\" + idQueryForm;\r\n                break;\r\n\r\n            case \"loadPrevious\":\r\n                url = \"App/ListaDetalle/listaitems.aspx?\" + self.dataService.lastQueryFullKey; //bizagi.referrerParams; //\r\n                break;\r\n            default:\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form\"\r\n                }) + \"?idQueryForm=\" + idQueryForm;\r\n                // check children query\r\n                url = (idStoredQuery != \"\") ? url + \"&idStoredQuery=\" + idStoredQuery : url;\r\n                url = (idCube != \"\") ? url + \"&idCube=\" + idCube : url;\r\n                break;\r\n        }\r\n        if (self.params.notMigratedUrl) {\r\n            //url returned by the service with the operations and actions to execute\r\n            url = 'App/' + self.params.notMigratedUrl;\r\n        }\r\n\r\n        //gets the content template adapted to use an iframe\r\n        var content = self.content = $.tmpl(template,\r\n        {\r\n            queryFormURL: url\r\n        });\r\n\r\n        // Return content\r\n        return content;\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal Desktop New Case Widget Controller\r\n *   Author: Juan Pablo Crossley\r\n *   Comments:\r\n *   -   This script will provide desktop overrides to implement the new case widget\r\n */\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.queries.extend(\"bizagi.workportal.widgets.queries\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queries\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries\"),\r\n            \"queries-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-elements\"),\r\n            \"queries-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-empty-elements\"),\r\n            \"queries-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-query-tree\"),\r\n            \"queries-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-confirm\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        // Set bind event for last element\r\n        self.configureTreeNavigation();\r\n\r\n        // Bind back button\r\n        self.configureBackButton();\r\n\r\n        // Render base categories\r\n        self.renderQueries();\r\n\r\n        // set vertical scroll\r\n        self.scrollVertical({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Render List categories for each idCategory\r\n    */\r\n    renderQueries: function (idParentQuery, appendElement) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var template = self.getTemplate(\"queries-elements\");\r\n        var emptyTemplate = self.getTemplate(\"queries-empty-elements\");\r\n        var queriesContainer = $(\"#queries\", content);\r\n        var queryContent;\r\n        var mergeData;\r\n\r\n        $.when(self.dataService.getQueries({\r\n            idElement: idParentQuery\r\n        })).done(function (data) {\r\n\r\n            queriesContainer.empty();\r\n\r\n            // check if service have nodes\r\n            data = data || {};\r\n\r\n            if (data.length >= 1) {\r\n                // Check if have appendElement\r\n                if (appendElement != undefined) {\r\n                    mergeData = $.merge(appendElement, data);\r\n                } else {\r\n                    mergeData = data;\r\n                }\r\n\r\n                queryContent = $.tmpl(template, mergeData, {\r\n                    checkChildNode: self.checkChildNode\r\n                });\r\n            } else {\r\n                queryContent = $.tmpl(emptyTemplate, mergeData);\r\n            }\r\n            queryContent.appendTo(queriesContainer);\r\n\r\n            // set actions to rendered html \r\n            self.configureNavTree(queriesContainer);\r\n        });\r\n    },\r\n\r\n\r\n    configureNavTree: function (queriesContainer) {\r\n        var self = this;\r\n        var confirm = self.getTemplate(\"queries-query-confirm\");\r\n\r\n        // Bind for list elements\r\n        $(\"li\", \"#queries\").click(function () {\r\n            var idCube = $(this).children(\"#idCube\").val();\r\n            var queryId = $(this).children(\"#queryId\").val();\r\n            var prefix = $(this).children(\"#prefix\").val();\r\n            var nodesLength = $(this).children(\"#nodesLength\").val();\r\n            var idStoredQuery = $(this).children(\"#idStoredQuery\").val();\r\n            var id = $(this).children(\"#id\").val();\r\n            var queryDisplayName = $(this).children(\"#queryDisplayName\").val();\r\n            var headerTemplate = self.getTemplate(\"queries-query-tree\");\r\n            var categoryTree = $(\"#categoryTree\");\r\n\r\n            // If the node is not a query node then render the children            \r\n            if (queryId == \"-1\") {\r\n                // Is category\r\n                // Append query header\r\n\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: id,\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation();\r\n\r\n                // Render sub-categories\r\n                self.renderQueries(id);\r\n            } else if (nodesLength > 0) {\r\n                // Is category with link\r\n\r\n                // Add element for tree navigation\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: id,\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation();\r\n\r\n                // Append this object to children\r\n                self.renderQueries(id,\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t    \"queryDisplayName\": queryDisplayName,\r\n\t\t\t\t\t    \"idStoredQuery\": idStoredQuery,\r\n\t\t\t\t\t    \"id\": id,\r\n\t\t\t\t\t    \"idParent\": '',\r\n\t\t\t\t\t    \"queryId\": queryId,\r\n\t\t\t\t\t    \"prefix\": prefix,\r\n\t\t\t\t\t    \"nodes\": [],\r\n\t\t\t\t\t    \"idCube\": $(this).data(\"idcube\"),\r\n\t\t\t\t\t    \"categoryWithLink\": \"true\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t\t);\r\n            } else {\r\n                // Is Process\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                var title = this.data(\"queryDisplayName\");\r\n                self.showQueryFormPopup({\r\n                    \"idQuery\": queryId,\r\n                    \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                    \"title\": title,\r\n                    \"idCube\": idCube\r\n                });\r\n            }\r\n        });\r\n\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".editButton\", \"#queries\").click(function (e) {\r\n            e.stopPropagation();\r\n\r\n            var queryId = \"-1\";\r\n            var idStoredQuery = $(this).parent().find(\"#idStoredQuery\").val();\r\n\r\n            self.showQueryFormPopup({\r\n                \"queryFormAction\": \"edit\",\r\n                \"idQuery\": queryId,\r\n                \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                \"title\": $(\"#queryDisplayName\", $(this).parent()).val()\r\n            });\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n        });\r\n\r\n        $(\".deleteButton\", \"#queries\").click(function (e) {\r\n            e.stopPropagation();\r\n\r\n            var queryId = \"-1\";\r\n            var idStoredQuery = $(this).parent().find(\"#idStoredQuery\").val();\r\n            var prefix = $(this).parent().find(\"#prefix\").val();\r\n            var idCube = $(this).parent().find(\"#idCube\").val();\r\n            var content = $.tmpl(confirm);\r\n            var url;\r\n\r\n            if (prefix == \"prefix_MyStoredQuery\") {\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form-delete\"\r\n                }) + \"?idStoredQueryDel=\" + idStoredQuery + \"&idQueryForm=\" + queryId;\r\n            } else if (prefix == \"prefix_Cube\") {\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form-delete-cube\"\r\n                });\r\n            }\r\n\r\n            // Open dialog with confirm message\r\n            $(content).dialog({\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                buttons: [\r\n\t\t\t\t{\r\n\t\t\t\t    text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n\t\t\t\t    click: function () {\r\n\t\t\t\t        if (prefix == \"prefix_MyStoredQuery\") {\r\n\t\t\t\t            $.ajax({\r\n\t\t\t\t                url: url\r\n\t\t\t\t            });\r\n\t\t\t\t        } else if (prefix == \"prefix_Cube\") {\r\n\t\t\t\t            $.destroy(\r\n\t\t\t\t                url,\r\n\t\t\t\t                { idCube: idCube }\r\n                            );\r\n\t\t\t\t        }\r\n\r\n\t\t\t\t        $(this).dialog(\"close\");\r\n\t\t\t\t        bizagi.workportal.desktop.popup.closePopupInstance();\r\n\t\t\t\t    }\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t    text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n\t\t\t\t    click: function () {\r\n\t\t\t\t        $(this).dialog(\"close\");\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t]\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   Binds the back buttons so we can navigate back\r\n    */\r\n    configureBackButton: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var btnBack = $(\"#bt-back\", content);\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n\r\n        // Bind click\r\n        btnBack.click(function () {\r\n            if ($(\"li\", categoryTree).length > 1) {\r\n                // Removes last child                    \r\n                $(\"li:last-child\", categoryTree).remove();\r\n                var idParentQuery = $(\"li:last-child\").children(\"#idParent\").val();\r\n\r\n                // Render Querie again\r\n                self.renderQueries(idParentQuery);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Bind tree navigation\r\n    */\r\n    configureTreeNavigation: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n\r\n        // Bind header events\r\n        $(\"li:last-child\", categoryTree).click(function () {\r\n            // Remove all elements\r\n            $(this).nextAll().remove();\r\n            var idParent = $(this).children(\"#idParent\").val();\r\n            // Render query tree again\r\n            self.renderQueries(idParent);\r\n        });\r\n    },\r\n\r\n    scrollVertical: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $(\"#queries\", content).bizagiScrollbar({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Show new case popup to create a case\r\n    */\r\n    showQueryFormPopup: function (arg) {\r\n        var self = this;\r\n\r\n        var idQuery = arg.idQuery || \"\";\r\n        var idStoredQuery = arg.idStoredQuery || \"\";\r\n        var queryFormAction = arg.queryFormAction || \"\";\r\n        var title = arg.title || \"\";\r\n        var idCube = arg.idCube || \"\";\r\n\r\n        // If the same popup is opened close it\r\n        if (self.currentPopup == \"queryform\") {\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            return;\r\n        }\r\n\r\n        // Shows a popup widget\r\n        self.currentPopup = \"queryform\";\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,\r\n            idQueryForm: idQuery,\r\n            idStoredQuery: idStoredQuery,\r\n            queryFormAction: queryFormAction,\r\n            idCube: idCube,\r\n            modalParameters: {\r\n                title: title,\r\n                id: \"Queries\"\r\n            }\r\n        });\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Workportal Desktop New Case Widget Controller\r\n*   Author: Juan Pablo Crossley\r\n*   Comments:\r\n*   -   This script will provide desktop overrides to implement the new case widget\r\n*/\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.queries.extend(\"bizagi.workportal.widgets.queries.definition\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queries\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries\"),\r\n            \"queries-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-elements\"),\r\n            \"queries-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-empty-elements\"),\r\n            \"queries-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-query-tree\"),\r\n            \"queries-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-confirm\"),\r\n\r\n            \"queries-definition-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-elements\"),\r\n            \"queries-definition-manage-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-manage-menu\"),\r\n            \"queries-liveprocesses-query-element\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-liveprocesses-menu\"),\r\n            \"queries-flat-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-flat-list\"),\r\n            \"queries-query-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-message-error\"),\r\n\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    loadtemplates: function () {\r\n        var self = this;\r\n        self.mainTemplate = self.getTemplate(\"queries-definition-elements\");\r\n        self.mainTemplateManage = self.getTemplate(\"queries-definition-manage-elements\");\r\n        self.mainTemplateLiveProcessesQuery = self.getTemplate(\"queries-liveprocesses-query-element\");\r\n        self.emptyTemplate = self.getTemplate(\"queries-empty-elements\");\r\n        self.flatListTemplate = self.getTemplate(\"queries-flat-list\");\r\n        self.confirmTemplate = self.getTemplate(\"queries-query-confirm\");\r\n        self.messageErrorTemplate = self.getTemplate(\"queries-query-message-error\");\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        // Set bind event for last element\r\n        self.configureTreeNavigation(\"#queries\");\r\n        // Render base categories\r\n        self.renderQueries();\r\n        // set vertical scroll\r\n        self.scrollVertical({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /**\r\n     * return the new button for manageQueries if the user has permission\r\n     */\r\n    showManageQueries: function () {\r\n        var self = this;\r\n        var templateManage = self.mainTemplateManage;\r\n        var content;\r\n        var isManageQueries = bizagi.menuSecurity.QueriesPermissionManager===true && bizagi.util.isEnableFeature(\"enableTransferQueryOwnership\");\r\n        if (isManageQueries) {\r\n            content = $.tmpl(templateManage, {});\r\n        }\r\n        return {\r\n            manageContent: content,\r\n            isManageQueries: isManageQueries\r\n        };\r\n    },\r\n\r\n    /**\r\n     * return the new button for liveProcessesQuery if the user has permission\r\n     */\r\n    getLiveProcessesQuery: function () {\r\n        var self = this;\r\n        return self.hasLiveProcessesQuery()?$.tmpl(self.mainTemplateLiveProcessesQuery, {}):undefined;\r\n    },\r\n\r\n    /**\r\n     * validate if the user has access to LP query\r\n     */\r\n    hasLiveProcessesQuery: function () {\r\n        return bizagi.menuSecurity.AdhocUserGroupReport===true;\r\n    },\r\n\r\n    /**\r\n     * merge templates and verify content undefined\r\n     */\r\n    mergeQueryWithLpContent: function (queryContent, lpContent) {\r\n        var content = queryContent;\r\n        if (queryContent!==undefined && lpContent!==undefined) {\r\n            content = $.merge(queryContent, lpContent);\r\n        }else if (lpContent!==undefined) {\r\n            content = lpContent;\r\n        }\r\n        return content;\r\n    },\r\n\r\n    /**\r\n     * return query menu options before saved query\r\n     */\r\n    beforeSavedQueriesContent: function (data, appendElement, idParentQuery) {\r\n        var self = this;\r\n        var manage = self.showManageQueries();\r\n        var queryContent = manage.manageContent;\r\n        var mergeData;\r\n        if (data.length >= 1) {\r\n            // Check if have appendElement\r\n            mergeData = appendElement !== undefined?$.merge(appendElement, data):data;\r\n            var tmplRendered = $.tmpl(self.mainTemplate, mergeData, {\r\n                checkChildNode: self.checkChildNode\r\n            });\r\n            if (self.validateMenu(queryContent, idParentQuery)) {\r\n                queryContent = tmplRendered;\r\n            } else {\r\n                queryContent.append(tmplRendered);\r\n            }\r\n        }else if (!manage.isManageQueries && !self.hasLiveProcessesQuery()) {\r\n            queryContent = $.tmpl(self.emptyTemplate, mergeData);\r\n        }\r\n        return queryContent;\r\n    },\r\n\r\n    /**\r\n     * return the new button for manageQueries if the user has permission\r\n     */\r\n    addEventToMangeQueries: function (self) {\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES_MANAGEMENT,\r\n            data: {},\r\n            maximize: true,\r\n            closeVisible: false,\r\n            modalParameters: {\r\n                title: bizagi.localization.getResource(\"workportal-widget-queries-management-title\"),\r\n                width: 790,\r\n                height: 540,\r\n                refreshInbox: false\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * go to Reports (LP query) in quickprocess\r\n     */\r\n    addEventToLPQuery: function (self) {\r\n        if ($(document).find('iframe').length > 0 && $(document).find('iframe')[0].contentWindow.location.href.indexOf('quickprocess') !== -1) {\r\n            bizagi.util.liveProcessesEvents.routeEvents.route = '/reports';\r\n            document.dispatchEvent(bizagi.util.liveProcessesEvents.routeEvents);\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n        }else{\r\n            self.publish(\"changeWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROFLY,\r\n                data: {\r\n                    route: \"reports\",\r\n                    params: { module: 'none' }\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    validateMenu: function (queryContent, idParentQuery) {\r\n        var enterToFolder = (queryContent == undefined || idParentQuery !== undefined) && idParentQuery !== \"-1\";\r\n        var leaveFolder = queryContent == undefined && idParentQuery === \"-1\";\r\n        return enterToFolder || leaveFolder;\r\n    },\r\n\r\n    /**\r\n     * Check if user has permission to BizagiQueries and do request to obtain QueriesDefinitions\r\n     * If the user do not have permission return an empty array in a promise \r\n     * @param idParentQuery \r\n     * @param securityBizagiQueries flag permission to BizagiQueries\r\n     */\r\n    getQueriesDefinitions: function (idParentQuery, securityBizagiQueries) {\r\n        var self = this,\r\n            request = function() {\r\n                return self.dataService.getQueriesDefinitions({\r\n                    idNode: idParentQuery\r\n                });\r\n            },\r\n            noRequest = function() {\r\n                var defer = new $.Deferred();\r\n                defer.resolve([]);\r\n                return defer.promise();\r\n            }\r\n        var call = securityBizagiQueries ? request : noRequest;\r\n        return call();\r\n    },\r\n\r\n    /**\r\n     * Check if user has permission to BizagiQueries and do request to obtain StoredQueries\r\n     * If the user do not have permission return an empty array in a promise \r\n     * @param securityBizagiQueries flag permission to BizagiQueries\r\n     */\r\n    getStoredQueryFormList: function (securityBizagiQueries) {\r\n        var self = this,\r\n            request = function() {\r\n                return self.dataService.getStoredQueryFormList();\r\n            },\r\n            noRequest = function() {\r\n                var defer = new $.Deferred();\r\n                defer.resolve({ storedQueryForms : [] });\r\n                return defer.promise();\r\n            }\r\n        var call = securityBizagiQueries ? request : noRequest;\r\n        return call();\r\n    },\r\n\r\n    /**\r\n    * Render List categories for each idCategory\r\n    */\r\n    renderQueries: function (idParentQuery, appendElement) {\r\n        var self = this;\r\n        var securityBizagiQueries = bizagi.menuSecurity.BizagiQueries;\r\n        var content = self.getContent();\r\n        var queriesContainer = $(\"#queries\", content);\r\n        var queryContent;\r\n\r\n        $.when(self.getQueriesDefinitions(idParentQuery, securityBizagiQueries )).done(function (data) {\r\n            queriesContainer.empty();\r\n            queryContent = self.beforeSavedQueriesContent(data || [], appendElement, idParentQuery);\r\n        \r\n            //if ((typeof idParentQuery === \"undefined\" || idParentQuery === \"-1\") && bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms)) {\r\n            if ((typeof idParentQuery === \"undefined\" || idParentQuery === \"-1\")) {\r\n                $.when(self.getStoredQueryFormList(securityBizagiQueries)).done(function (storedQueryForm) {\r\n                    if (storedQueryForm.storedQueryForms.length > 0) {\r\n                        var stored = $.tmpl(self.mainTemplate, {\r\n                            queryType: \"-2\",\r\n                            queryDisplayName: self.getResource(\"workportal-widget-queries-stored-query-forms\"),\r\n                            nodes: [],\r\n                            guidForm: \"stored\"\r\n                        });\r\n                        queryContent = $.merge(queryContent, stored);\r\n                        self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n                    }\r\n                    queriesContainer.append(self.mergeQueryWithLpContent(queryContent, self.getLiveProcessesQuery()));\r\n                    self.configureNavTree(queriesContainer);\r\n                });\r\n            } else {\r\n                queryContent.appendTo(queriesContainer);\r\n            }\r\n            // set actions to rendered html \r\n            self.configureNavTree(queriesContainer);\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Render List stored query Form\r\n    */\r\n    renderStoredQueries: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var flatListTemplate = self.flatListTemplate;\r\n        var queriesContainer = $(\"#queries\", content);\r\n        var storedQueryFormContent;\r\n        storedQueryFormContent = $.tmpl(flatListTemplate, { storedQueryForm: self.storedQueryForm });\r\n        storedQueryFormContent.appendTo(queriesContainer);\r\n    },\r\n\r\n    configureNavTree: function (queriesContainer) {\r\n        var self = this;\r\n        var confirm = self.getTemplate(\"queries-query-confirm\");\r\n\r\n        //Bind for manage queries\r\n        $(\"li#manageQueries\", queriesContainer).click(function () {\r\n            self.addEventToMangeQueries(self);\r\n        });\r\n\r\n        //Bind for manage queries\r\n        $(\"li#manageLiveProcessesQuery\", queriesContainer).click(function () {\r\n            self.addEventToLPQuery(self);\r\n        });\r\n\r\n        // Bind for list elements\r\n        $(\"li:not(#manageQueries,#manageLiveProcessesQuery)\", queriesContainer).click(function () {\r\n            var idNode = $(this).children(\"#idNode\").val();\r\n            var guidQueryForm = $(this).children(\"#guidQueryForm\").val();\r\n            var guidForm = $(this).children(\"#guidForm\").val();\r\n            var guidContext = $(this).children(\"#guidContext\").val();\r\n            var queryType = $(this).children(\"#queryType\").val();\r\n            var nodesLength = $(this).children(\"#nodesLength\").val();\r\n            var queryDisplayName = $(this).children(\"#queryDisplayName\").val();\r\n            var headerTemplate = self.getTemplate(\"queries-query-tree\");\r\n            var categoryTree = $(\"#categoryTree\");\r\n            var notMigratedUrl = $(this).children(\"#notMigratedUrl\").val();\r\n\r\n            if (queryType == \"-2\") {\r\n                self.renderStoredQueries();\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: \"-2\",\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n                self.configureTreeNavigation(\"#queries\");\r\n            }\r\n            else if (nodesLength > 0) {\r\n                // Is category with link\r\n                // Add element for tree navigation\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: idNode,\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation(\"#queries\");\r\n                self.renderQueries(idNode);\r\n            } else {\r\n                // Is Process\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                var title = $(\"#queryDisplayName\", this).val();\r\n                self.showQueryFormPopup({\r\n                    \"guidForm\": guidForm,\r\n                    \"guidEntity\": guidContext,\r\n                    \"title\": title,\r\n                    \"queryFormAction\": \"renderQueryForm\",\r\n                    \"queryType\": queryType,\r\n                    \"notMigratedUrl\": notMigratedUrl\r\n                });\r\n            }\r\n        });\r\n\r\n        $(\".deleteGAButton\").click(function (e) {\r\n            e.stopPropagation();\r\n            var confirmContent = $.tmpl(self.confirmTemplate);\r\n            var confirmContentParams = {\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                buttons: []\r\n            };\r\n            var notMigratedUrlDelete = $(\"#notMigratedUrlDelete\", $(this).parent()).val();\r\n\r\n            confirmContentParams.buttons = [\r\n                {\r\n                    text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                    click: function () {\r\n                        $(this).dialog(\"close\");\r\n                        //checks if it should use the url based method to delete the query\r\n                        if (notMigratedUrlDelete) {\r\n                            $.destroy(notMigratedUrlDelete);\r\n                        }\r\n                        bizagi.workportal.desktop.popup.closePopupInstance();\r\n                    }\r\n                },\r\n                {\r\n                    text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                    click: function () {\r\n                        $(this).dialog(\"close\");\r\n                    }\r\n                }\r\n            ];\r\n            $(confirmContent).dialog(confirmContentParams);\r\n\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Bind tree navigation\r\n    */\r\n    configureTreeNavigation: function (container) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n        var queriesContainer = $(container, content);\r\n        // Bind header events\r\n        $(\"li:last-child\", categoryTree).click(function () {\r\n            // Remove all elements\r\n            $(this).nextAll().remove();\r\n            var idParent = $(this).children(\"#idParent\").val();\r\n            // Render query tree again\r\n            if (idParent == \"-2\") {\r\n                self.renderStoredQueries();\r\n            } else {\r\n                self.renderQueries(idParent);\r\n            }\r\n        });\r\n\r\n        $(\"li.storedQuery\", queriesContainer).click(function () {\r\n            var guid = $(this).data(\"guid\");\r\n            var id = $(this).data(\"id\");\r\n            var idNode = $(this).data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n\r\n                self.showQueryFormPopup({\r\n                    \"idStoredQuery\": guid,\r\n                    \"idQuery\": 1,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"paramsStoredQuery\": paramsStoredQuery,\r\n                    \"queryFormAction\": \"execute\",\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.execute : \"\"\r\n                });\r\n            }\r\n        });\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".editButton\", container).click(function (e) {\r\n            e.stopPropagation();\r\n            var queryId = \"-1\";\r\n            var guid = $(this).parent().data(\"guid\");\r\n            var idStoredQuery = $(this).parent().data(\"id\");\r\n            var idNode = $(this).parent().data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n                self.showQueryFormPopup({\r\n                    \"queryFormAction\": \"edit\",\r\n                    \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                    \"paramsStoredQuery\": paramsStoredQuery,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.edit : \"\"\r\n                });\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n            }\r\n        });\r\n        $(\".deleteButton\", container).click(function (e) {\r\n            e.stopPropagation();\r\n            var queryId = \"-1\";\r\n            var guid = $(this).parent().data(\"guid\");\r\n            var idStoredQuery = $(this).parent().data(\"id\");\r\n            var idNode = $(this).parent().data(\"idnode\");\r\n            var confirmContent, paramsStoredQuery, confirmContentParams;\r\n\r\n            var messageErrorForm = self.getResource(\"workportal-widget-admin-entities-message-migrate\");\r\n            messageErrorForm = messageErrorForm.replace(\"{build}\", bizagi.loader.productBuildToAbout);\r\n\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n\r\n                confirmContentParams = {\r\n                    resizable: true,\r\n                    modal: true,\r\n                    title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                    buttons: []\r\n                };\r\n                var p_sessionId = bizagi.cookie(\"JSESSIONID\");\r\n                if (p_sessionId !== null && paramsStoredQuery.notMigratedUrl) {\r\n                    confirmContent = $.tmpl(self.messageErrorTemplate, { messageError: messageErrorForm });\r\n                }\r\n                else {\r\n                    confirmContent = $.tmpl(self.confirmTemplate);\r\n\r\n                    confirmContentParams.buttons = [\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                                //checks if it should use the url based method to delete the query\r\n                                if (paramsStoredQuery.notMigratedUrl && paramsStoredQuery.notMigratedUrl[\"delete\"]) {\r\n                                    $.get(\"App/\" + paramsStoredQuery.notMigratedUrl[\"delete\"]);\r\n                                } else {\r\n                                    self.dataService.deleteStoredQueryForm({ idStoredQueryForm: idStoredQuery });\r\n                                }\r\n                                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                                self.publish(\"refreshQueryFormShortCut\");\r\n                            }\r\n                        },\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                            }\r\n                        }\r\n                    ];\r\n                }\r\n\r\n                // Open dialog with confirm message\r\n                $(confirmContent).dialog(confirmContentParams);\r\n            }\r\n        });\r\n    },\r\n\r\n    scrollVertical: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        $(\"#queries\", content).bizagiScrollbar({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Show new case popup to create a case\r\n    */\r\n    showQueryFormPopup: function (arg) {\r\n        var self = this;\r\n        var queryFormAction = arg.queryFormAction || \"\";\r\n        var title = arg.title || \"\";\r\n        var queryType = arg.queryType || \"\";\r\n        var guidForm = arg.guidForm || \"\";\r\n        var guidEntity = arg.guidEntity || \"\";\r\n        var paramsStoredQuery = arg.paramsStoredQuery || {};\r\n        // If the same popup is opened close it\r\n        if (self.currentPopup == \"queryform\") {\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            return;\r\n        }\r\n        // Shows a popup widget\r\n        self.currentPopup = \"queryform\";\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,\r\n            queryFormAction: queryFormAction,\r\n            queryType: queryType,\r\n            paramsStoredQuery: paramsStoredQuery,\r\n            modalParameters: {\r\n                title: title,\r\n                id: \"Queries\"\r\n            },\r\n            closeVisible: false,\r\n            guidForm: guidForm,\r\n            guidEntity: guidEntity,\r\n            notMigratedUrl: arg.notMigratedUrl || \"\",\r\n            maximizeOnly: true,\r\n            editQueryForm: function (params) {\r\n                self.currentPopup = undefined;\r\n                self.showPopUpEditQueryForm(params);\r\n\r\n            },\r\n            executeQueryForm: function (params) {\r\n                self.currentPopup = undefined;\r\n                self.showPopUpResultsQueryForm(params);\r\n            }\r\n        });\r\n    },\r\n\r\n    showPopUpEditQueryForm: function (params) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n            self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n            self.publish(\"refreshQueryFormShortCut\");\r\n            if (params && params.response) {\r\n                var idQueryForm = params.response;\r\n                self.editQueryForm(idQueryForm);\r\n            }\r\n        });\r\n    },\r\n\r\n    showPopUpResultsQueryForm: function (params) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n            self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n            self.publish(\"refreshQueryFormShortCut\");\r\n            if (params && params.response) {\r\n                var idQueryForm = params.response;\r\n                self.executeQueryForm(idQueryForm);\r\n            }\r\n        });\r\n    },\r\n\r\n    editQueryForm: function (idQueryForm) {\r\n        var self = this;\r\n        var paramsStoredQuery = self.getParamsStoredQuery(idQueryForm);\r\n        if (paramsStoredQuery.length == 1) {\r\n            paramsStoredQuery = paramsStoredQuery[0];\r\n            self.showQueryFormPopup({\r\n                \"queryFormAction\": \"edit\",\r\n                \"idStoredQuery\": (idQueryForm == \"-1\") ? \"\" : idQueryForm,\r\n                \"paramsStoredQuery\": paramsStoredQuery,\r\n                \"title\": paramsStoredQuery.definition.name,\r\n                \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.edit : \"\"\r\n            });\r\n        }\r\n    },\r\n    executeQueryForm: function (idQueryForm) {\r\n        var self = this;\r\n        var paramsStoredQuery = self.getParamsStoredQuery(idQueryForm);\r\n        if (paramsStoredQuery.length == 1) {\r\n            paramsStoredQuery = paramsStoredQuery[0];\r\n            self.showQueryFormPopup({\r\n                \"idStoredQuery\": paramsStoredQuery.guid,\r\n                \"idQuery\": 1,\r\n                \"title\": paramsStoredQuery.definition.name,\r\n                \"paramsStoredQuery\": paramsStoredQuery,\r\n                \"queryFormAction\": \"execute\",\r\n                \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.execute : \"\"\r\n            });\r\n        }\r\n    },\r\n\r\n    getParamsStoredQuery: function (idQueryForm) {\r\n        var self = this;\r\n        return $.grep(self.storedQueryForm, function (e) {\r\n            return e.id == idQueryForm;\r\n        });\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal Desktop stored queries shortcut\r\n *   Author: Iván Ricardo Taimal Narváez\r\n *   Comments:\r\n *   -   This script will provide behavior to stored queries shortcut\r\n */\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.queries.definition.extend(\"bizagi.workportal.widgets.queries.shortcut\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queries\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries\"),\r\n            \"queries-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-elements\"),\r\n            \"queries-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-empty-elements\"),\r\n            \"queries-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-query-tree\"),\r\n            \"queries-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-confirm\"),\r\n\r\n            \"queries-definition-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-elements\"),\r\n            \"queries-flat-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-flat-list\"),\r\n            \"queries-query-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-message-error\"),\r\n\r\n            \"queries-shortcut\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-shortcut\"),\r\n            \"queries-shortcut-flat-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-flat-list-shortcut\"),\r\n            \"queries-shortcut-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-confirm-shortcut\"),\r\n            \"queries-shortcut-query-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-message-error-shortcut\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /**\r\n     *   To be overriden in each device to apply layouts\r\n     */\r\n    loadtemplates: function () {\r\n        var self = this;\r\n        self.flatListTemplate = self.getTemplate(\"queries-shortcut-flat-list\");\r\n        self.confirmTemplate = self.getTemplate(\"queries-shortcut-query-confirm\");\r\n        self.messageErrorTemplate = self.getTemplate(\"queries-shortcut-query-message-error\");\r\n    },\r\n    postRender: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queries-shortcut\");\r\n        var content = self.content = $.tmpl(template);\r\n        self.handleEvents();\r\n        bizagi.workportal.widgets.queries.shortcut.instance = this;\r\n    },\r\n\r\n    handleEvents: function() {\r\n        var self = this;\r\n        $(\"#queryFormShortcutContainer\").show();\r\n        $(\"#queryFormShortcutContainer\").click(function () {\r\n            var queryFormShortcut =  $(\"#queryFormShortcut\");\r\n            var arrow = $(this).find(\"span\");\r\n            var isHidden = (queryFormShortcut.is(\":hidden\")) ? true : false;\r\n            if (isHidden) {\r\n                queryFormShortcut.show();\r\n                arrow.removeClass(\"Right\");\r\n                arrow.addClass(\"Down\");\r\n                self.renderStoredQueries();\r\n            } else {\r\n                queryFormShortcut.hide();\r\n                arrow.removeClass(\"Down\");\r\n                arrow.addClass(\"Right\");\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Bind tree navigation\r\n     */\r\n    configureTreeNavigation: function () {\r\n        var self = this;\r\n        var categoryTree = $(\"#categoryTree\", self.content);\r\n        var queriesContainer = $(\"#queries-shortcut\", self.content);\r\n        $(\"li.storedQuery\",queriesContainer).click(function () {\r\n            var guid    =   $(this).data(\"guid\");\r\n            var id      =   $(this).data(\"id\");\r\n            var idNode =    $(this).data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result  =  $.grep(self.storedQueryForm, function(e){ return e.idNode == idNode; });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery =   result[0];\r\n                self.showQueryFormPopup({\r\n                    \"idStoredQuery\": guid,\r\n                    \"idQuery\":1,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"paramsStoredQuery\":paramsStoredQuery,\r\n                    \"queryFormAction\":\"execute\",\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.execute : \"\"\r\n                });\r\n            }\r\n            self.currentPopup=undefined;\r\n           // self.renderQueries();\r\n        });\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".bz-icon-pencil-outline\", \"#queries-shortcut\").click(function (e) {\r\n            var queryId = \"-1\";\r\n            var guid = $(this).closest(\".storedQuery\").data(\"guid\");\r\n            var idStoredQuery = $(this).closest(\".storedQuery\").data(\"id\");\r\n            var idNode = $(this).closest(\".storedQuery\").data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n                self.showQueryFormPopup({\r\n                    \"queryFormAction\": \"edit\",\r\n                    \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                    \"paramsStoredQuery\": paramsStoredQuery,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.edit : \"\"\r\n                });\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n            }\r\n        });\r\n\r\n        $(\".bz-icon-close\", \"#queries-shortcut .bz-shorcut__icons\").click(function (e) {\r\n            e.stopPropagation();\r\n            var queryId = \"-1\";\r\n            var guid = $(this).closest(\".storedQuery\").data(\"guid\");\r\n            var idStoredQuery = $(this).closest(\".storedQuery\").data(\"id\");\r\n            var idNode =   $(this).closest(\".storedQuery\").data(\"idnode\");\r\n            var confirmContent, paramsStoredQuery, confirmContentParams;\r\n\r\n            var messageErrorForm    = self.getResource(\"workportal-widget-admin-entities-message-migrate\");\r\n            messageErrorForm        = messageErrorForm.replace(\"{build}\", bizagi.loader.productBuildToAbout);\r\n\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n\r\n                confirmContentParams ={\r\n                    resizable: true,\r\n                    modal: true,\r\n                    title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                    buttons: []\r\n                };\r\n\r\n                var p_sessionId = bizagi.cookie(\"JSESSIONID\");\r\n                if(p_sessionId!==null && paramsStoredQuery.notMigratedUrl){\r\n                    confirmContent = $.tmpl(self.messageErrorTemplate, { messageError: messageErrorForm });\r\n                }\r\n                else{\r\n                    confirmContent = $.tmpl(self.confirmTemplate);\r\n\r\n                    confirmContentParams.buttons = [\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                                if (paramsStoredQuery.notMigratedUrl && paramsStoredQuery.notMigratedUrl[\"delete\"]) {\r\n                                    $.get(\"App/\" + paramsStoredQuery.notMigratedUrl[\"delete\"]);\r\n                                }else{\r\n                                    $.when(self.dataService.deleteStoredQueryForm({idStoredQueryForm: idStoredQuery})).done(function () {\r\n                                        bizagi.workportal.desktop.popup.closePopupInstance();\r\n                                        self.renderStoredQueries();\r\n                                    });\r\n                                }\r\n                                self.renderStoredQueries();\r\n                                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                            }\r\n                        },\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                            }\r\n                        }\r\n                    ];\r\n                }\r\n\r\n                // Open dialog with confirm message\r\n                $(confirmContent).dialog(confirmContentParams);\r\n            }\r\n        });\r\n    },\r\n    renderStoredQueries: function(params) {\r\n        var self = this;\r\n        var flatListTemplate = self.flatListTemplate;\r\n        var queriesContainer = $(\"#queries-shortcut\", self.content);\r\n        var storedQueryFormContent;\r\n        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n            self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n            storedQueryFormContent = $.tmpl(flatListTemplate, {storedQueryForm: self.storedQueryForm});\r\n            storedQueryFormContent.appendTo(queriesContainer);\r\n            self.configureTreeNavigation();\r\n            if(self.storedQueryForm.length <= 0){\r\n                $(\"#queryFormShortcutContainer\").hide()\r\n            }else{\r\n                $(\"#queryFormShortcutContainer\").show()\r\n            }\r\n        });\r\n    }\r\n\r\n});","/*\r\n*   Name: BizAgi Desktop Queries Dialog implementation\r\n*   Author: Juan Pablo Crossley\r\n*   Modifications:\r\n*   modifiedPostRender\r\n*   -    Paola Herrera\r\n*   -    Andres Fernando Muñoz\r\n*   -    Iván Ricardo Taimal\r\n*\r\n*  added checkDisplayedNames, getRenderElementDisplayByXpath\r\n*  -    Carlos I Mercado\r\n*/\r\n\r\n// Extends itself\r\nbizagi.workportal.widgets.queryform.extend(\"bizagi.workportal.widgets.queryform\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queryform\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-frankenstein-queryform-wrapper\"),\r\n            \"queryform-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-wrapper\"),\r\n            \"queryform-container\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-container\"),\r\n            \"queryform-buttons\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-buttons\"),\r\n            \"queryform-graphic-analysis\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-graphic-analysis\"),\r\n            \"queryform-result-set\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-result-set\"),\r\n            \"queryform-search-result\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-search-result\"),\r\n            \"queryform-pagination\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-pagination\"),\r\n            \"queryform-admin-result\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-admin-result\"),\r\n            \"queryform-share-selection\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-share-selection\"),\r\n            \"queryform-select-user\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-select-user\"),\r\n            \"queryform-select-group\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-select-group\"),\r\n            \"queryform-save-as\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-save-as\"),\r\n            \"queryform-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform--message-error\"),\r\n            useNewEngine: false\r\n        });\r\n\r\n        if(!bizagi.referrerParams)\r\n            bizagi.referrerParams = {};\r\n        bizagi.referrerParams.referrer = bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM;\r\n    },\r\n    /*\r\n     *   To be overriden in each device to apply layouts\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        if (self.params.notMigratedUrl == \"true\") {\r\n            self.params.notMigratedUrl = Boolean(self.params.notMigratedUrl);\r\n        }\r\n\r\n        //if (bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms) == true && (self.params.notMigratedUrl == \"\" || self.params.notMigratedUrl == true)) {\r\n        if ((self.params.notMigratedUrl == \"\" || self.params.notMigratedUrl == true)) {\r\n            self.modifiedPostRender();\r\n        }\r\n        else {\r\n            self.frankensteinPostRender();\r\n        }\r\n    },\r\n\r\n    loadtemplates: function () {\r\n        var self = this;\r\n        self.container = self.getTemplate(\"queryform-container\");\r\n        self.buttons = self.getTemplate(\"queryform-buttons\");\r\n        self.graphicalAnalysisContainer = self.getTemplate(\"queryform-graphic-analysis\");\r\n        self.resultSet = self.getTemplate(\"queryform-result-set\");\r\n        self.searchResult = self.getTemplate(\"queryform-search-result\");\r\n        self.paginationTmpl = self.getTemplate(\"queryform-pagination\");\r\n        self.adminResult = self.getTemplate(\"queryform-admin-result\");\r\n        self.selectUser = self.getTemplate(\"queryform-select-user\");\r\n        self.selectGroup = self.getTemplate(\"queryform-select-group\");\r\n        self.shareSelection = self.getTemplate(\"queryform-share-selection\");\r\n        self.dialogSaveAsTmpl = self.getTemplate(\"queryform-save-as\");\r\n    },\r\n\r\n    /*\r\n     *  New Query Forms implementation\r\n     */\r\n    modifiedPostRender: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        self.maxElemShow = 10;\r\n        self.maxPageToShow = 5;\r\n        self.atLeastOneChecked = false;\r\n        self.selectedItemsToShare = {\r\n            users: [],\r\n            groups: []\r\n        };\r\n        self.readyToSave = false;\r\n        self.includeAllUsers = false;\r\n        self.saveAs = false;\r\n        self.sortedField = {};\r\n        self.storedQueryFormParameters = {};\r\n        self.dialogSaveAs = $.tmpl(self.dialogSaveAsTmpl);\r\n        self.orderType = {\r\n            ASC: \"ASC\",\r\n            DESC: \"DESC\",\r\n            NONE: \"NONE\"\r\n        };\r\n        self.queryFormContextTypes = {\r\n            CASES: \"metadata\",\r\n            ENTITY: \"entity\"\r\n        };\r\n        self.queryFormTypes = {\r\n            CASES: \"CASES\",\r\n            ENTITY: \"ENTITIES\"\r\n        };\r\n\r\n        if (self.params.notMigratedUrl == true || self.params.paramsStoredQuery.notMigratedUrl == true) {\r\n            var messageErrorForm = self.getResource(\"workportal-widget-admin-entities-message-migrate\");\r\n            messageErrorForm = messageErrorForm.replace(\"{build}\", bizagi.loader.productBuildToAbout);\r\n            var htmlMessage = $.tmpl(self.getTemplate(\"queryform-message-error\"), { messageError: messageErrorForm });\r\n            $(content).html(htmlMessage);\r\n            return false;\r\n        }\r\n\r\n        var actionEdit = function () {\r\n            if(self.params.queryParams && !self.params.queryParams.ownerQuery){\r\n                self.showSaveResultsForm();\r\n                $(\"#tab_share\", content).hide();\r\n                $(\"#query-form-buttons\", content).hide();\r\n                $(\"#query-form\").hide();\r\n                $(\"#queryFormName\").prop(\"disabled\", true);\r\n                $(\"#queryFormDescription\").prop(\"disabled\", true);\r\n                $(\"#input-name-ui-bizagi-input-required\").hide();\r\n            } else {\r\n                self.guidEntity = self.params.paramsStoredQuery.definition.entityGuid;\r\n                self.guidForm = self.params.paramsStoredQuery.guid;\r\n                self.queryFormType = self.params.paramsStoredQuery.definition.type;\r\n                self.idQueryForm = self.params.paramsStoredQuery.id;\r\n                self.renderQueryForm();\r\n                self.showSaveResultsForm();\r\n            }\r\n            self.previousValues(self.params.paramsStoredQuery);\r\n        }\r\n\r\n        var actionRenderQueryForm = function () {\r\n            self.guidForm = self.params.guidForm;\r\n            self.guidEntity = self.params.guidEntity;\r\n            if (self.params.queryType == 1) {\r\n                self.queryFormType = self.queryFormTypes.CASES;\r\n            } else if (self.params.queryType == 2) {\r\n                self.queryFormType = self.queryFormTypes.ENTITY;\r\n            }\r\n            self.renderQueryForm();\r\n        }\r\n\r\n        var actionSubmitQueryForm = function () {\r\n            if (typeof (self.params.queryParams.parameters) == \"string\") {\r\n                self.params.queryParams.parameters = JSON.parse(self.params.queryParams.parameters);\r\n            }\r\n            self.initialSearchParams = self.params.queryParams;\r\n            var pageToShow = self.params.pageToShow || 1;\r\n            //builds the params\r\n\r\n            self.contextType = self.params.widget.contextType;\r\n            self.guidForm = self.params.widget.guidForm;\r\n            self.guidEntity = self.params.widget.guidEntity;\r\n            self.queryForm = self.params.queryForm;\r\n\r\n            if (self.params.queryType == 1) {\r\n                self.queryFormType = self.queryFormTypes.CASES;\r\n            } else if (self.params.queryType == 2) {\r\n                self.queryFormType = self.queryFormTypes.ENTITY;\r\n            }\r\n\r\n            self.handleEvents();\r\n            self.findResults(self.getContent(), self.params.queryParams, pageToShow);\r\n\r\n            $(\"#copy-as-new-stored-queryform\", content).hide();\r\n            $(\"#update-stored-queryform\", content).hide();\r\n            $('#edit-stored-queryform', content).hide();\r\n        }\r\n\r\n        var actionExecute = function () {\r\n            //Store data in order to initialize a query form from a render widget            \r\n            bizagi.referrerParams.queryForm = {\r\n                actionForm: \"execute\",\r\n                data: self.params\r\n            };\r\n\r\n            self.guidEntity = self.params.paramsStoredQuery.definition.entityGuid;\r\n            self.guidForm = self.params.paramsStoredQuery.guid;\r\n            self.queryFormType = self.params.paramsStoredQuery.definition.type;\r\n            self.includeAllUsers = self.params.paramsStoredQuery.definition.includeAllUsers;\r\n            self.idQueryForm = self.params.paramsStoredQuery.id\r\n            var searchParams = {\r\n                \"numberOfRows\": 10,\r\n                \"pageNumber\": 1,\r\n                \"queryFormGuid\": self.params.paramsStoredQuery.guid,\r\n                \"entityGuid\": self.params.paramsStoredQuery.definition.entityGuid,\r\n                \"type\": self.params.paramsStoredQuery.definition.type,\r\n                \"parameters\": self.params.paramsStoredQuery.definition.parameters,\r\n                \"ownerQuery\": self.params.paramsStoredQuery.owner,\r\n                \"includeAllUsers\": self.params.paramsStoredQuery.definition.includeAllUsers\r\n            };\r\n            self.handleEvents();\r\n            self.initialSearchParams = JSON.parse(JSON.stringify(searchParams));\r\n\r\n            //parses the type\r\n            if (self.queryFormType == self.queryFormTypes.CASES) {\r\n                self.contextType = self.queryFormContextTypes.CASES;\r\n            } else if (self.queryFormType == self.queryFormTypes.ENTITY) {\r\n                self.contextType = self.queryFormContextTypes.ENTITY;\r\n            }\r\n            //builds the params\r\n            var queryFormParams = {\r\n                h_action: \"QUERYFORM\",\r\n                h_contexttype: self.contextType,\r\n                h_idForm: self.guidForm\r\n            };\r\n            $(\"#query-form-buttons\", content).hide();\r\n\r\n            //request to queryForm definition service\r\n            self.dataService.getQueryForm(queryFormParams).done(function (data) {\r\n\r\n                //stores the elements to check their values later\r\n                self.queryFormElements = data.form.elements;\r\n\r\n                //find the results directly, no need to enter any value\r\n                self.findResults(content, searchParams);            \r\n            });\r\n\r\n            $(\"#copy-as-new-stored-queryform\", content).hide();\r\n            $(\"#update-stored-queryform\", content).hide();\r\n            $('#edit-stored-queryform', content).show();\r\n        }\r\n\r\n        switch (self.params.queryFormAction) {\r\n            case \"edit\":\r\n                actionEdit();\r\n                break;\r\n\r\n            case \"renderQueryForm\":\r\n                actionRenderQueryForm();\r\n                break;\r\n\r\n            case \"submitQueryForm\":\r\n            case \"graphicalAnalysis\":\r\n                actionSubmitQueryForm();\r\n                break;\r\n\r\n            case \"execute\":\r\n                actionExecute();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n\r\n    /*\r\n    *  Render queryForm\r\n    * */\r\n    renderQueryForm: function (values) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        if (self.queryFormType == self.queryFormTypes.CASES) {\r\n            self.contextType = self.queryFormContextTypes.CASES;\r\n        } else if (self.queryFormType == self.queryFormTypes.ENTITY) {\r\n            self.contextType = self.queryFormContextTypes.ENTITY;\r\n        }\r\n        var queryFormParams = {\r\n            h_action: \"QUERYFORM\",\r\n            h_contexttype: self.contextType,\r\n            h_idForm: self.guidForm\r\n        };\r\n        if (self.idQueryForm && self.idQueryForm != \"\") {\r\n            queryFormParams.h_idqueryform = self.idQueryForm;\r\n        }\r\n\r\n        var renderContainer = $.tmpl(self.container);\r\n        //request to queryForm definition service\r\n        self.dataService.getQueryForm(queryFormParams).done(function (data) {\r\n            var renderingParams = { canvas: renderContainer,\r\n                data: data,\r\n                type: \"queryForm\" };\r\n\r\n            //stores the elements to validate them later\r\n            self.queryFormElements = data.form.elements;\r\n\r\n            bizagi.loader.startAndThen(\"rendering\").then(function () {\r\n                var rendering = new bizagi.rendering.facade();\r\n                rendering.execute(renderingParams).done(function () {\r\n                    self.queryForm = rendering.form;\r\n                    // bizagi.referrerParams.queryform.queryform = rendering.form;\r\n\r\n\r\n                    if (self.queryForm.properties && typeof (self.queryForm.properties.includeAllUsers) != \"undefined\") {\r\n                        self.includeAllUsers = self.queryForm.properties.includeAllUsers;\r\n                    }\r\n                    $(\"#query-form\", content).html(renderContainer);\r\n                    //To validate if the input contains a value and depends on that show or hide the div that indicates the required field\r\n                    self.validateRequireField();\r\n                    $(\"#queryFormName\", content).keyup(function () {\r\n                        self.validateRequireField();\r\n                    });\r\n\r\n                    self.handleEvents();\r\n                    $(\"#query-form\", content).show();\r\n                    $(\"#query-form-result\", content).hide();\r\n                    $(\"#mainButtons\", content).css(\"width\", \"100%\");\r\n                    $(\"#exportExcel\", content).hide();\r\n                    $(\"#graphicalAnalysis\", content).hide();\r\n                    $(\"#back-to-queryform\", content).hide();\r\n                    $(\"#save-queryform\", content).hide();\r\n                    $('#queryFormName').prop(\"disabled\", false);\r\n                    $('#queryFormDescription').prop(\"disabled\", false);\r\n\r\n                    if (values) {\r\n                        self.setXpathValuesToQueryForm(self.queryForm, values);\r\n                        $(\"#query-form-admin-result\", content).hide();\r\n                        $(\"#copy-as-new-stored-queryform\", content).hide();\r\n                        $(\"#update-stored-queryform\", content).hide();\r\n                        $('#edit-stored-queryform', content).hide();\r\n                    }\r\n\r\n                    if (self.params.queryFormAction == 'renderQueryForm') {\r\n\r\n                        $(\"#query-form-admin-result\", content).hide();\r\n                        $(\"#copy-as-new-stored-queryform\", content).hide();\r\n                        $(\"#update-stored-queryform\", content).hide();\r\n                        $('#edit-stored-queryform', content).hide();\r\n                    }\r\n                    else if (self.params.queryFormAction == 'edit') {\r\n                        var parentName = self.params.paramsStoredQuery.definition.parentQueryForm || self.params.paramsStoredQuery.definition.name;\r\n                        $(\"#queryFormFieldsContainerName span\", content).html(parentName);\r\n                        $(\"#queryFormFieldsContainer\", content).html(renderContainer);\r\n                        $(\"#submit-for-search\", content).hide();\r\n                        $(\"#clear-queryform\", content).hide();\r\n                        $(\"#copy-as-new-stored-queryform\", content).show();\r\n                        $(\"#update-stored-queryform\", content).show();\r\n                        $('#edit-stored-queryform', content).hide();\r\n                        $(\"#query-form-buttons\", content).show();\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    },\r\n\r\n    setXpathValuesToQueryForm: function (form, values) {\r\n        values = values || {};\r\n        var control;\r\n        //decode parameters\r\n\r\n        try {\r\n            var searchParameters = (typeof values.parameters == \"string\") ? JSON.parse(values.parameters) : values.parameters;\r\n            $.each(searchParameters, function (key, parameter) {\r\n                control = form.getRender(parameter.xpath);\r\n                control.setValue(parameter.value);\r\n                control.setDisplayValue(parameter.value);\r\n            });\r\n        } catch (e) {\r\n            console.log(\"Error:\", e);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *  Buttons for query Form actions\r\n    */\r\n    handleEvents: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var pageResultsData = {};\r\n\r\n        // PARAMS TO EXPORT EXCEL\r\n        pageResultsData.I_PROCESSSTATE = \"ALL\";\r\n        pageResultsData.h_idEnt = 10001;\r\n        pageResultsData.h_idQueryForm = self.idQueryForm;\r\n\r\n        $(\"#query-form-buttons\", content).html($.tmpl(self.buttons, pageResultsData));\r\n        $(\"#back-to-queryform\", content).click(function () {\r\n            if (self.params.queryFormAction == 'execute') {\r\n                self.renderQueryForm();\r\n            } else {\r\n                $(\"#iframeGraphicalAnalysis\", content).hide();\r\n                $(\"#query-form-admin-result\", content).hide();\r\n                if (self.params.queryFormAction == 'saveQueryForm') {\r\n                    self.params.queryFormAction = 'renderQueryForm';\r\n                    $(\"#query-form-result\", content).show();\r\n                    $(\"#back-to-queryform\", content).show();\r\n                    $(\"#save-queryform\", content).show();\r\n                    $(\"#exportExcel\", content).show();\r\n                    $(\"#graphicalAnalysis\", content).show();\r\n                } else {\r\n                    self.sortedField = {};\r\n                    $(\"#query-form-result\", content).hide();\r\n                    $(\"#query-form\", content).show();\r\n                    self.enableButton($(\"#submit-for-search\", self.getContent()));\r\n\r\n                    var dialog = $(this).closest(\".ui-dialog\");\r\n                    var dialogContent = dialog.length ? dialog.find(\".ui-dialog-content\") : [];\r\n\r\n                    if (dialog.height() === dialogContent.height()) {\r\n                        dialogContent.height(440);\r\n                    }\r\n\r\n                    if (self.originalHeight) {\r\n                        content.parent().height(self.originalHeight);\r\n                    }\r\n\r\n                    $(\"#back-to-queryform\", content).hide();\r\n                    $(\"#submit-for-search\", content).show();\r\n                    $(\"#clear-queryform\", content).show();\r\n                    $(\"#save-queryform\", content).hide();\r\n                    $(\"#exportExcel\", content).hide();\r\n                    $(\"#graphicalAnalysis\", content).hide();\r\n\r\n                    if (self.params.queryFormAction == 'submitQueryForm' && self.params.widget && self.params.recalculateQueryForm) {\r\n                        // get query form and show\r\n                        self.params.widget.searchParams = self.params.widget.searchParams || {};\r\n                        self.renderQueryForm(self.params.widget.searchParams);\r\n                    } else if (self.params.queryFormAction == 'graphicalAnalysis') {\r\n                        self.params.queryFormAction = 'submitQueryForm';\r\n                        var request = {\r\n                            \"queryFormGuid\": self.guidForm,\r\n                            \"numberOfRows\": 10,\r\n                            \"pageNumber\": 1,\r\n                            \"entityGuid\": self.guidEntity,\r\n                            \"type\": self.queryFormType,\r\n                            \"includeAllUsers\": self.includeAllUsers,\r\n                            \"parameters\": []\r\n                        };\r\n                        var searchParams = self.queryForm.getSearchParams(request);\r\n                        self.submitQueryForm(searchParams);\r\n                    }\r\n                }\r\n            }\r\n            self.readyToSave = false;\r\n        });\r\n        $(\"#clear-queryform\", content).click(function () {\r\n            self.params.queryFormAction = 'renderQueryForm';\r\n            self.renderQueryForm();\r\n        });\r\n        $(\"#submit-for-search\", content).click(function () {\r\n            //collects data in a structure to search Cases Data or Entity Data\r\n            self.params.queryFormAction = 'submitQueryForm';\r\n            var searchParams = self.getSearchParams();\r\n            if (searchParams !== null) {\r\n                self.disableButton($(this));\r\n                self.submitQueryForm(searchParams);\r\n            }\r\n        });\r\n        $(\".ui-bizagi-render-control-included\", content).tooltip({ content: bizagi.localization.getResource(\"workportal-widget-query-form-included-tooltip\") });\r\n\r\n        $(\"#save-queryform\", content).click(function () {\r\n            if (self.readyToSave) {\r\n                self.createStoredQueryForm();\r\n            } else {\r\n                self.showSaveResultsForm();\r\n            }           \r\n            self.params.queryFormAction = 'saveQueryForm';\r\n            $(\"#exportExcel\", content).hide();\r\n            $(\"#graphicalAnalysis\", content).hide();\r\n            $(\"#mainButtons\", content).css(\"width\", \"100%\");            \r\n        });\r\n\r\n        $(\"#copy-as-new-stored-queryform\", content).click(function () {\r\n            // Open dialog with confirm message\r\n            self.saveAs = true;\r\n            $(self.dialogSaveAs).dialog({\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-query-form-copy-as-new\"),\r\n                buttons: [\r\n                    {\r\n                        text: self.getResource(\"workportal-general-button-label-ok\"),\r\n                        click: function () {\r\n                            if (self.createStoredQueryForm()) {\r\n                                $(this).dialog(\"destroy\");\r\n                                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                        click: function () {\r\n                            self.saveAs = false;\r\n                            $(this).dialog(\"destroy\");\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n        });\r\n\r\n        $(\"#update-stored-queryform\", content).click(function () {\r\n            self.updateStoredQueryForm();\r\n        });\r\n\r\n        $(\"#edit-stored-queryform\", content).click(function () {\r\n            self.publish(\"closeCurrentDialog\");\r\n            self.params.editQueryForm({ response: self.params.paramsStoredQuery.id,\r\n                fromExec: true });\r\n        });\r\n\r\n        $(\".biz-wp-form-queryForm-graphicalAnalysisLink\", content).click(function () {\r\n            self.params.queryFormAction = \"graphicalAnalysis\";\r\n            if (typeof (self.searchParams.parameters) == \"string\") {\r\n                self.searchParams.parameters = JSON.parse(self.searchParams.parameters);\r\n            }\r\n            var paramsStored;\r\n            if (self.params.paramsStoredQuery.definition) {\r\n                paramsStored = JSON.stringify(self.params.paramsStoredQuery.definition);\r\n            } else {\r\n                paramsStored = JSON.stringify({\r\n                    name: \"name\",\r\n                    description: \"desc\",\r\n                    parameters: self.searchParams.parameters,\r\n                    type: self.queryFormType,\r\n                    entityGuid: self.guidEntity,\r\n                    includeAllUsers: self.includeAllUsers,\r\n                    parentQueryForm: self.queryForm.properties.displayName\r\n                });\r\n            }\r\n            var guidForm = self.params.paramsStoredQuery.id ? self.params.paramsStoredQuery.guid : self.params.guidForm;\r\n            var htmlGraphicalAnalysis = $.tmpl(self.graphicalAnalysisContainer, { h_guidQueryForm: guidForm,\r\n                h_idStoredQuery: self.params.paramsStoredQuery.id,\r\n                h_definition: paramsStored });\r\n            $(\"#query-form-result\", content).html(htmlGraphicalAnalysis);\r\n            $(\"#exportExcel\", content).hide();\r\n            $(\"#graphicalAnalysis\", content).hide();\r\n            $(\"#mainButtons\", content).show();\r\n            $(\"#mainButtons\", content).css(\"width\", \"99%\");\r\n            $(\"#save-queryform\", content).hide();\r\n            self.originalHeight = content.parent().height();\r\n            content.parent().height(\"auto\");\r\n            $(\"#formGraphicalAnalysis\").delay(800).submit();\r\n\r\n            // adjust iframe height\r\n            var iframe = $(\"#iframeGraphicalAnalysis\");\r\n            var dialog = iframe.length ? iframe.closest(\".ui-dialog\") : [];\r\n            var dialogHeight = dialog.length ? dialog.height() : 0;\r\n            if (dialogHeight > 550) {\r\n                iframe.height(dialogHeight - 100);\r\n            }\r\n\r\n            dialog.on(\"dialogmaximize\", calculateHeight);\r\n            dialog.on(\"dialogunmaximize\", calculateHeight);\r\n\r\n            function calculateHeight() {\r\n                var iframe = $(\"#iframeGraphicalAnalysis\");\r\n                var dialog = $(this);\r\n                var dialogHeight = dialog.length ? dialog.height() : 0;\r\n                if (dialogHeight > 550) {\r\n                    iframe.height(dialogHeight - 100);\r\n                } else {\r\n                    iframe.height(400);\r\n                    dialog.find(\".ui-dialog-content\").height(\"auto\");\r\n                }\r\n            }\r\n        });\r\n\r\n        $(\".biz-wp-form-queryForm-exportExcelLink\", content).click(function () {\r\n            var request = {\r\n                \"queryFormGuid\": self.guidForm,\r\n                \"entityGuid\": self.guidEntity,\r\n                \"type\": self.queryFormType,\r\n                \"includeAllUsers\": self.includeAllUsers,\r\n                \"parameters\": []\r\n            };\r\n\r\n            var sortParameter = self.sortedField.xpath;\r\n            var orderType = self.sortedField.orderType;\r\n            var sorted = false;\r\n\r\n            var newParameters = JSON.parse(JSON.stringify(self.initialSearchParams.parameters));\r\n            newParameters = $.type(newParameters) === \"array\" ? newParameters : JSON.parse(newParameters);\r\n            if (newParameters.length > 0 && typeof sortParameter != \"undefined\") {\r\n                $.each(newParameters, function (i, item) {\r\n                    var itemXpath = item.xpath;\r\n                    if (itemXpath == sortParameter) {\r\n                        item.orderType = orderType;\r\n                        sorted = true;\r\n                    }\r\n                });\r\n            }\r\n            if (!sorted && sortParameter != \"\" && typeof sortParameter != \"undefined\") {\r\n                newParameters.push({\r\n                    \"value\": null,\r\n                    \"included\": true,\r\n                    \"xpath\": sortParameter,\r\n                    \"searchType\": \"NONE\",\r\n                    \"orderType\": orderType\r\n                });\r\n            }\r\n            request.parameters = newParameters;\r\n\r\n            var requestForSearch = self.refactorParameters(request);\r\n            var p_sessionId = bizagi.cookie(\"JSESSIONID\");\r\n            if (p_sessionId != null) {\r\n                requestForSearch.p_sessionId = p_sessionId;\r\n            }\r\n            self.dataService.getQueryFormExportExcel(requestForSearch).done(function () { });\r\n        });\r\n    },\r\n\r\n    disableButton: function (button) {\r\n        var self = this, content = self.getContent();\r\n        var included = $(\".ui-bizagi-render-control-included:checked\", content).size();\r\n        var atLeastOneChecked = (included > 0);\r\n        if ((self.queryFormType == self.queryFormTypes.ENTITY && self.atLeastOneChecked) || self.queryFormType == self.queryFormTypes.CASES) {\r\n            button.attr(\"disabled\", true).addClass(\"ui-button-disabled\");\r\n        }\r\n    },\r\n\r\n    enableButton: function (button) {\r\n        button.removeAttr(\"disabled\").removeClass(\"ui-button-disabled\");\r\n    },\r\n\r\n    /*\r\n     * return default params for search and saved queries\r\n     */\r\n    getSearchParams: function () {\r\n        var self = this,\r\n            request = {\r\n            \"queryFormGuid\": self.guidForm,\r\n            \"numberOfRows\": 10,\r\n            \"pageNumber\": 1,\r\n            \"entityGuid\": self.guidEntity,\r\n            \"type\": self.queryFormType,\r\n            \"includeAllUsers\": self.includeAllUsers,\r\n            \"parameters\": [],\r\n            \"onlyLocalResults\": true\r\n        };\r\n        return self.queryForm.getSearchParams(request);\r\n    },\r\n\r\n    /*\r\n     * throw message exception when the user has not select any checkbox and it's required\r\n     */\r\n    throwMessageAtLeastOneCheck: function (content) {\r\n        var self = this;\r\n        bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-query-form-at-least-one-checked\"), \"Bizagi\", \"warning\");\r\n        self.enableButton($(\"#submit-for-search\", content));\r\n    },\r\n\r\n    /*\r\n     * validate if the user has not select any checkbox and it's required\r\n     */\r\n    validateTypeAndOneCheck: function (searchParams) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var included = $(\".ui-bizagi-render-control-included:checked:visible\", content).size();\r\n        self.atLeastOneChecked = (included > 0);\r\n        return ( self.queryFormType == self.queryFormTypes.ENTITY && self.atLeastOneChecked\r\n                || self.queryFormType == self.queryFormTypes.CASES\r\n                ) && searchParams !== null;\r\n    },\r\n\r\n    /*\r\n     * Validation before submit\r\n     */\r\n    submitQueryForm: function (searchParams) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        if (searchParams !== null) {\r\n            if (self.validateTypeAndOneCheck(searchParams)) {\r\n                self.initialSearchParams = JSON.parse(JSON.stringify(searchParams));\r\n                self.findResults(content, searchParams);\r\n            }\r\n            else {\r\n                self.throwMessageAtLeastOneCheck(content);\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Find cases for App query Form\r\n     */\r\n    findResults: function (content, params, pageToShow) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var loadingGetQueryForm = $(\".js-mini-loading\", content);\r\n        var buttons = $(\"#save-queryform, #back-to-queryform\", content);\r\n        //Store data in order to initialize a query form from a render widget\r\n        if (pageToShow) {\r\n            self.params.pageToShow = pageToShow;\r\n        }\r\n        // Override the query params\r\n        self.params.queryParams = params;\r\n\r\n        bizagi.referrerParams.queryForm = {\r\n            actionForm: self.params.queryFormAction,\r\n            data: self.params,\r\n            queryParams: params,\r\n            pageToShow: pageToShow,\r\n            queryForm: self.queryForm\r\n        };\r\n\r\n\r\n        self.searchParams = JSON.parse(JSON.stringify(params));\r\n        params = self.refactorParameters(params);\r\n        params.pageNumber = pageToShow ? pageToShow : 1;\r\n        if (bizagiConfig.groupByCaseNumber) {\r\n            params.group = \"T_RADNUMBER\";\r\n        }\r\n\r\n        loadingGetQueryForm.show();\r\n        self.disableButton(buttons);\r\n        var security = new bizagi.workportal.command.security(self.dataService),\r\n            deferResults = self.dataService.getQueryFormResponse(params);\r\n        deferResults.done(self.enableButton.bind(self, buttons));\r\n        $.when(\r\n            deferResults,\r\n            security.checkSecurityPerm(\"GraphicQuery\"),\r\n            security.checkSecurityPerm(\"TimeLine\")\r\n        ).done(function (resultList, graphicQuery, timeline) {\r\n            // Mapping Response into result object\r\n            resultList = resultList[0];\r\n\r\n            loadingGetQueryForm.hide();\r\n\r\n            var enabledIcons = self.validateSecurityOptionIcons(resultList, graphicQuery, timeline);\r\n\r\n            //clean old results\r\n            $(\".biz-wp-table\").remove();\r\n            $(\"#biz-wp-table-summary-wrapper\").remove();\r\n\r\n            //Keep in track the total Records\r\n            self.totalRecords = resultList.records;\r\n\r\n            //keep in track the total pages\r\n            self.totalPages = resultList.total;\r\n            \r\n            if (resultList.rows.length > 0) {\r\n                self.showSearchResultFrame(content, resultList, params, enabledIcons);\r\n                $(\"#query-form-buttons\", content).show();\r\n            } else {\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-query-form-no-records-found\"), \"Bizagi\", \"warning\");\r\n                self.enableButton($(\"#submit-for-search\", self.getContent()));\r\n                if (self.params.queryFormAction === \"execute\") {\r\n                    self.params.queryFormAction = \"edit\";\r\n                    self.modifiedPostRender();\r\n                }\r\n            }\r\n        }).fail(function (error) {\r\n            loadingGetQueryForm.hide();\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Validate if show or not graphic query icon.\r\n     * @param resultList\r\n     */\r\n    // validateSecurityGraphicQuery: function (resultList){\r\n    validateSecurityOptionIcons: function (resultList, graphicQuery, timeline) {\r\n        var tmpTL = bizagi.override.enableFeatureShowTimelineButton && timeline;\r\n        var radNumerIndex = -1;\r\n\r\n        if (!graphicQuery && !tmpTL) {\r\n            if (resultList.header && resultList.header.length && resultList.header[resultList.header.length - 1].dataType === 0) {\r\n                resultList.header.splice(-1, 1); //Remove last item\r\n                resultList.rows.forEach(function (row) {\r\n                    row.splice(-1, 1);\r\n                });\r\n            }\r\n        } else {\r\n            if (tmpTL && resultList.rows.length > 0) {\r\n                radNumerIndex = resultList.rows[0].findIndex(function (el) {\r\n                    if (el && typeof el === \"object\" && el.radNumber) {\r\n                        return true;\r\n                    }\r\n                    return false\r\n                });\r\n                if (radNumerIndex > -1) {\r\n                    resultList.rows.forEach(function (row) {\r\n                        if (row[row.length - 1] != null)\r\n                            row[row.length - 1]['radNumber'] = row[radNumerIndex]['radNumber']\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            graphicQuery: graphicQuery,\r\n            timeline: tmpTL\r\n        };\r\n    },\r\n\r\n    /*\r\n    * Checks that all the header displayed names are the same shown in the form\r\n    */\r\n    checkDisplayedNames: function (resultList) {\r\n        var self = this;\r\n        if (typeof (self.initialSearchParams.parameters) == \"string\") {\r\n            self.initialSearchParams.parameters = JSON.parse(self.initialSearchParams.parameters);\r\n        }\r\n        if (typeof (self.searchParams.parameters) == \"string\") {\r\n            self.searchParams.parameters = JSON.parse(self.searchParams.parameters);\r\n        }\r\n        //goes for each item and checks them one by one\r\n        $.each(resultList.header, function (i, header) {\r\n\r\n            //cheks if display name, it should get the display name from the form values\r\n            if (header.xpath) {\r\n                var foundDisplayName = self.getRenderElementDisplayByXpath(header.xpath, self.queryFormElements);\r\n                //if it founds it, it sets the displayName\r\n                if (foundDisplayName) {\r\n                    if (self.initialSearchParams && self.initialSearchParams.parameters) {\r\n                        for (var i = 0; i < self.initialSearchParams.parameters.length; i++) {\r\n                            var searchParameter = self.initialSearchParams.parameters[i];\r\n                            var storedQueryFormParameter = self.searchParams.parameters[i];\r\n                            var fullParameterXpath = searchParameter.xpath + \".\" + searchParameter.displayXpath;\r\n                            var storedDefinition = {};\r\n                            if (self.params.paramsStoredQuery.definition && self.params.paramsStoredQuery.definition.parameters[i] !== undefined) {\r\n                                storedDefinition = self.params.paramsStoredQuery.definition.parameters[i];\r\n                            }\r\n\r\n                            if (searchParameter.xpath === header.xpath || fullParameterXpath === header.xpath) {\r\n                                storedQueryFormParameter.displayHeader = foundDisplayName;\r\n                                searchParameter.displayHeader = foundDisplayName;\r\n                                storedDefinition.displayHeader = foundDisplayName;\r\n                                self.searchParams.parameters[i].displayName = foundDisplayName;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    header.displayName = foundDisplayName;\r\n                }\r\n            }\r\n        });\r\n\r\n        return resultList;\r\n    },\r\n    /*\r\n     *Gets the display name that the xpath provided should show in the results\r\n     */\r\n    getRenderElementDisplayByXpath: function (xpath, elements) {\r\n        var self = this;\r\n        if (elements && elements.length > 0) {\r\n            for (var i = 0, l = elements.length; i < l; i++) {\r\n                var element = elements[i];\r\n                if (typeof (element.render) !== 'undefined') {\r\n                    var includePreference = typeof (element.render.properties.included) === 'undefined' || element.render.properties.included;\r\n                    var elementXpath = element.render.properties.xpath;\r\n                    var fullEelementXpath = element.render.properties.xpath + \".\" + element.render.properties.displayXpath;\r\n\r\n                    if (includePreference && (elementXpath === xpath || fullEelementXpath === xpath)) {\r\n                        return element.render.properties.displayName\r\n                    }\r\n                } else if (typeof (element.container) !== 'undefined') {\r\n                    var result = self.getRenderElementDisplayByXpath(xpath, element.container.elements);\r\n                    if (result != undefined)\r\n                        return result;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    refactorParameters: function (params) {\r\n        var parameters = [];\r\n        if (typeof (params.parameters) == \"string\") {\r\n            params.parameters = JSON.parse(params.parameters);\r\n        }\r\n        $.each(params.parameters, function (i, item) {\r\n            if (item.value != null && typeof (item.value) == \"object\" && item.value[0] && typeof (item.value[0].id) != \"undefined\") {\r\n                item.value = item.value[0].id;\r\n            }\r\n            parameters.push(item);\r\n        });\r\n        params.parameters = JSON.stringify(parameters);\r\n        return params;\r\n    },\r\n\r\n    /**\r\n     * format value depend of the type\r\n     * @param {string} value \r\n     * @param {number | string} dataType \r\n     */\r\n    _formatValue: function (value, dataType) {\r\n        if(bizagi.override.enableFormatMoneyColumnQueryResult === true || [8, \"Money\"].indexOf(dataType) === -1  || value === null)\r\n            value = bizagi.util.formatValueByDataType(value, dataType);\r\n        return value;\r\n    },\r\n    /*\r\n    * Show search result frames\r\n    */\r\n    showSearchResultFrame: function (content, resultList, params, enabledIcons) {\r\n        var self = this;\r\n        self.queryFormElements = self.queryFormElements ? self.queryFormElements : bizagi.referrerParams.queryForm.queryForm.params.data.elements;\r\n\r\n        if(bizagi.referrerParams && bizagi.referrerParams.queryForm && bizagi.referrerParams.queryForm.queryForm\r\n            && bizagi.referrerParams.queryForm.queryForm.params && bizagi.referrerParams.queryForm.queryForm.params.data){\r\n            bizagi.referrerParams.queryForm.queryForm.params.data.elements = self.queryFormElements;\r\n        }\r\n\r\n        //goes for the result list and checks that the displayed names in the grid match with the rendered form\r\n        resultList = self.checkDisplayedNames(resultList);\r\n        resultList.rows = self.cleanEmptyColorState(resultList.rows);\r\n\r\n        var resultTemplate = $.tmpl(\r\n            self.searchResult,\r\n            {\r\n                headers: resultList.header,\r\n                rows: resultList.rows,\r\n                sortedField: self.sortedField.xpath ? self.sortedField : null,\r\n                records: resultList.records,\r\n                groupByCaseNumber: bizagiConfig.groupByCaseNumber,\r\n                securityGraphicQuery: bizagi.menuSecurity.GraphicQuery,\r\n                resultList: resultList,\r\n                enabledIcons: enabledIcons\r\n            },\r\n            {\r\n                getRadNumberColumnIndex: function () {\r\n                    var data = this.data;\r\n                    var index = -1;\r\n                    for (var i = 0, l = data.headers.length; i < l; i++) {\r\n                        if (data.headers[i].fieldName == \"radnumber\") {\r\n                            index = i;\r\n                        }\r\n                    }\r\n                    return index;\r\n                },\r\n                showColumn: function (columnIndex) {\r\n                    var index = this.getRadNumberColumnIndex();\r\n                    return (this.data.groupByCaseNumber && index == columnIndex) ? ' hidden ' : \"\";\r\n                },\r\n                createGroupedHeader: function (rowIndex) {\r\n                    var data = this.data.resultList;\r\n                    var result = false;\r\n                    var radNumber = this.getRadNumber(data.rows[rowIndex]);\r\n                    if (this.data.groupByCaseNumber) {\r\n                        if (rowIndex == 0 && radNumber != \"\") {\r\n                            result = true;\r\n                        } else {\r\n                            var previousRadNumber = this.getRadNumber(data.rows[rowIndex - 1]);\r\n                            if (radNumber != previousRadNumber && radNumber != \"\") {\r\n                                result = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    return result;\r\n                },\r\n                getRadNumber: function (row) {\r\n                    var index = this.getRadNumberColumnIndex();\r\n                    return (index >= 0) ? row[index].radNumber : \"\";\r\n                },\r\n                formatValue: self._formatValue,\r\n                /**\r\n                 * validate if in the first row and group by cases and if is IE necesary for bug QAF-1883 fixed head table\r\n                 * @param {Int} rowIndex row index item of case\r\n                 */\r\n                isIEAndFirstRowAndGroupCases: function (rowIndex) {\r\n                    return rowIndex == 0 && this.data.groupByCaseNumber && bizagi.util.isIE();\r\n                }\r\n            }\r\n        );\r\n\r\n        var pageToshow = (self.maxPageToShow > self.totalPages) ? self.totalPages : self.maxPageToShow;\r\n        var summaryWrapper = $(\"#biz-wp-table-pager-wrapper\", resultTemplate);\r\n        var pagerData = {};\r\n        var paginationHtml;\r\n\r\n        // show or hide \"load more\" button\r\n        pagerData.pagination = (self.totalPages > 1) ? true : false;\r\n        pagerData.page = resultList.page;\r\n        pagerData.pages = {};\r\n\r\n        for (var i = 1; i <= pageToshow; i++) {\r\n            pagerData.pages[i] = {\r\n                \"pageNumber\": i\r\n            };\r\n        }\r\n\r\n        //load and append the paginator to the result table\r\n        paginationHtml = $.tmpl(self.paginationTmpl, pagerData).html();\r\n        summaryWrapper.append(paginationHtml);\r\n\r\n        $(\"#submit-for-search\", content).hide();\r\n        $(\"#clear-queryform\", content).hide();\r\n        $(\"#save-queryform\", content).show();\r\n\r\n        //checks if user has permissions to see the export button\r\n        if (resultList.permissions && resultList.permissions.canExportData) {\r\n            $(\"#exportExcel\", content).show();\r\n        }\r\n        else {\r\n            $(\"#exportExcel\", content).hide();\r\n        }\r\n\r\n        $(\"#mainButtons\", content).css(\"width\", \"100%\");\r\n        $(\"#query-form\", content).hide();\r\n        $(\"#query-form-result\", content).show();\r\n        $(\"#query-form-result\", content).html(resultTemplate);\r\n        $(\"#back-to-queryform\", content).show();\r\n\r\n        //checks if user has permissions to see the graphical button\r\n        if (resultList.permissions && resultList.permissions.canAnalizeData) {\r\n            $(\"#graphicalAnalysis\", content).show();\r\n        }\r\n        else {\r\n            $(\"#graphicalAnalysis\", content).remove();\r\n        }\r\n\r\n        if (self.params.queryFormAction == \"execute\") {\r\n            $(\"#back-to-queryform\", content).hide();\r\n            $(\"#save-queryform\", content).hide();\r\n        }\r\n\r\n        if (params.ownerQuery == false) {\r\n            $(\"#edit-stored-queryform\", content).hide();\r\n        }\r\n\r\n        //add data and behaviour to pager\r\n        $(\"ul\").bizagiPagination({\r\n            maxElemShow: self.maxElemShow,\r\n            totalPages: self.totalPages,\r\n            actualPage: resultList.page,\r\n            listElement: $(\"#biz-wp-table-pager-wrapper\"),\r\n            clickCallBack: function (options) {\r\n                var target = $('.sortColumnsDataUpIcon, .sortColumnsDataDownIcon').closest(\"th\").first();\r\n\r\n                if (target.length == 0) {\r\n                    self.findResults(content, self.initialSearchParams, options.page);\r\n                }\r\n\r\n                else {\r\n                    var paramXpath = target.data(\"xpath\");\r\n                    var orderType = null;\r\n                    if (typeof self.sortedField.xpath != undefined && self.sortedField.xpath == paramXpath) {\r\n                        orderType = self.sortedField.orderType\r\n                    }\r\n                    if (orderType == null || orderType == self.orderType.DESC) {\r\n                        self.findSortedResults(content, paramXpath, self.orderType.DESC, options.page);\r\n                    } else {\r\n                        self.findSortedResults(content, paramXpath, self.orderType.ASC, options.page);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        $(\".cases-column-header\", content).click(function (e) {\r\n            var target = $(e.currentTarget);\r\n            var paramXpath = target.data(\"xpath\");\r\n            var orderType = null;\r\n            if (typeof self.sortedField.xpath != undefined && self.sortedField.xpath == paramXpath) {\r\n                orderType = self.sortedField.orderType\r\n            }\r\n            if (orderType == null || orderType == self.orderType.DESC) {\r\n                self.findSortedResults(content, paramXpath, self.orderType.ASC, params.pageNumber);\r\n            } else {\r\n                self.findSortedResults(content, paramXpath, self.orderType.DESC, params.pageNumber);\r\n            }\r\n\r\n        });\r\n\r\n        // Add click event to case link\r\n        $(\".caseClicked\", content).click(function () {\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: $(this)[0].getAttribute(\"data-idcase\"),\r\n                idWorkItem: $(this)[0].getAttribute(\"data-idworkitem\"),\r\n                idTask: $(this)[0].getAttribute(\"data-idtask\"),\r\n                idWorkflow: $(this)[0].getAttribute(\"data-idworkflow\")\r\n            });\r\n            self.publish(\"closeCurrentDialog\");\r\n        });\r\n\r\n\r\n        $(\".ui-bizagi-wp-app-inbox-grouped\", content).bind(\"click\", function () {\r\n            var idCase = $(this).find(\"#idCase\").val();\r\n\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: idCase\r\n            });\r\n            self.publish(\"closeCurrentDialog\");\r\n        });\r\n\r\n\r\n        // Add click event to view workflow\r\n        $(\".js-show-graphic-query\", content).click(function () {\r\n            var idCase = $(this).data(\"idcase\");\r\n            var idWorkflow = $(this).data('idworkflow');\r\n            self.showGraphicQuery({ idCase: idCase,\r\n                idWorkflow: idWorkflow });\r\n        });\r\n\r\n        // Add click to timeline icon\r\n        $(\".js-show-timeline\", content).click(function () {\r\n            var idCase = $(this).data(\"idcase\");\r\n            var caseNumber = $(this).data('radnumber');\r\n            self.showTimeLine({ radNumber: caseNumber,\r\n                idCase: idCase });\r\n        });\r\n\r\n        self.setTableHeadFixed({\r\n            TableElement: $(\"table\", resultTemplate),\r\n            groupByCaseNumber: bizagiConfig.groupByCaseNumber,\r\n            floatOptions: {\r\n                position: 'fixed',\r\n                scrollContainer: function () {\r\n                    return $(\"#result-set-queryForm\");\r\n                }\r\n            }\r\n        });\r\n    },\r\n    /**\r\n     * Add class to format the number\r\n     * */\r\n    applyFomatNumbers: function (elementsDataType, resultTemplate, userLocalization) {\r\n        var numberHeaders = $(\"th[data-type='\" + elementsDataType + \"']\", resultTemplate);\r\n        $.each(numberHeaders, function (i, item) {\r\n            var index = item.getAttribute('data-index');\r\n            $(\".biz-wp-table tr\", resultTemplate).find(\"td:eq(\" + index + \")\").find(\"span\").addClass(\"formatMoney\");\r\n        });\r\n        bizagi.util.formatInvariantNumber(resultTemplate, userLocalization);\r\n    },\r\n\r\n    /**\r\n     * if the column has list items with a json property colorstate empty, the item is removed\r\n     * @param {JSON} rows with columns and with list items with posible colorState\r\n     */\r\n    cleanEmptyColorState: function (rows) {\r\n        return rows.map(function(row) {\r\n            return row.map(function (col) {\r\n               if (Array.isArray(col)) {//is a list items\r\n                   return col.filter(function (item) { //remove the item if it has a colorState json property empty\r\n                       return item === undefined || item === null || item.colorState !== \"\" ;\r\n                   });\r\n               } \r\n               return col;\r\n            });\r\n        });\r\n    },\r\n\r\n    /*\r\n     * order by\r\n     */\r\n    findSortedResults: function (content, sortParameter, orderType, pageToShow) {\r\n        var self = this;\r\n        var sorted = false;\r\n        var clonedParams = JSON.parse(JSON.stringify(self.initialSearchParams));\r\n        if (clonedParams) {\r\n            var newParameters = clonedParams.parameters;\r\n            newParameters = $.type(newParameters) === \"array\" ? newParameters : JSON.parse(newParameters);\r\n            if (newParameters.length > 0) {\r\n                $.each(newParameters, function (i, item) {\r\n                    var itemXpath = item.xpath;\r\n                    if (itemXpath == sortParameter) {\r\n                        item.orderType = orderType;\r\n                        sorted = true;\r\n                    }\r\n                });\r\n            }\r\n            if (!sorted && sortParameter != \"\" && typeof sortParameter != \"undefined\") {\r\n                newParameters.push({\r\n                    \"value\": null,\r\n                    \"included\": true,\r\n                    \"xpath\": sortParameter,\r\n                    \"searchType\": \"NONE\",\r\n                    \"orderType\": orderType\r\n                });\r\n            }\r\n            self.sortedField = { \"xpath\": sortParameter,\r\n                \"orderType\": orderType };\r\n            clonedParams.parameters = newParameters;\r\n            self.findResults(content, clonedParams, pageToShow);\r\n        }\r\n    },\r\n\r\n    previousValues: function (previousValues) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        $(\"#queryFormName\", content).val(previousValues.definition.name);\r\n        $(\"#queryFormDescription\", content).val(previousValues.definition.description);\r\n        self.selectedItemsToShare.users = (previousValues && previousValues.users) ? previousValues.users : [];\r\n        self.selectedItemsToShare.groups = (previousValues && previousValues.groups) ? previousValues.groups : [];\r\n    },\r\n\r\n    /*\r\n     *Collect parameters and save query form results\r\n     */\r\n    createStoredQueryForm: function () {\r\n        var self = this;\r\n        var params = self.buildStoredQueryFormParams();\r\n        if (params != null) {\r\n            $.when(self.dataService.saveStoredQueryForm(params)).done(function (response) {\r\n                self.publish(\"closeCurrentDialog\");\r\n                self.readyToSave = false;\r\n                self.params.queryFormAction = 'renderQueryForm';\r\n\r\n                if ($(\"#queryFormShortcut\").has(\"#modalMenuBtList\").length == 0) {\r\n                    $.when(self.workportalFacade.getWidget(\"queriesShortcut\", {}))\r\n                        .pipe(function (result) {\r\n                            widget = result;\r\n                            return widget.render();\r\n                        }).done(function () {\r\n                        try{\r\n                            var content = widget.getContent();\r\n                            $(\"#queryFormShortcut\").html(content);\r\n                            self.params.executeQueryForm(response);\r\n                        } catch (e) {\r\n                            // error\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    self.params.executeQueryForm(response);\r\n                }\r\n\r\n            }).fail(function (error) {\r\n                bizagi.log(error);\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    closeQueryForm: function () {\r\n        //$($('.ui-dialog .ui-dialog-titlebar-close')[0]).click();\r\n    },\r\n\r\n    /*\r\n    *Collect parameters and save query form results\r\n    */\r\n    updateStoredQueryForm: function () {\r\n        var self = this;\r\n        var params = self.buildStoredQueryFormParams();\r\n        if (params != null) {\r\n            if (self.validateTypeAndOneCheck(self.getSearchParams())) {\r\n                params.id = self.idQueryForm;\r\n                $.when(self.dataService.updateStoredQueryForm(params)).done(function () {\r\n                    self.readyToSave = false;\r\n                    self.params.queryFormAction = 'renderQueryForm';\r\n                    self.renderQueryForm();\r\n                    self.publish(\"refreshQueryFormShortCut\");\r\n                }).fail(function (error) {\r\n                    bizagi.log(error);\r\n                });\r\n            } else {\r\n                self.throwMessageAtLeastOneCheck(self.getContent());\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    buildStoredQueryFormParams: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var storedQueryFormParameters = {};\r\n        storedQueryFormParameters.users = JSON.stringify($.unique(self.selectedItemsToShare.users));\r\n        storedQueryFormParameters.groups = JSON.stringify($.unique(self.selectedItemsToShare.groups));\r\n        if (self.params.queryFormAction == 'edit') {\r\n            var request = {\r\n                \"parameters\": []\r\n            };\r\n            self.searchParams = self.queryForm.getSearchParams(request);\r\n        }\r\n        storedQueryFormParameters.guid = self.guidForm;\r\n        var nameSaveAs = $(\"#queryFormNameSaveAs\", self.dialogSaveAs).val();\r\n        var nameSave = $(\"#queryFormName\", content).val().trim();\r\n        var alert;\r\n        if (self.saveAs && (nameSaveAs == null || nameSaveAs == \"\")) {\r\n            alert = $(\"#queryFormNameSaveAs\").next(\".ui-bizagi-input-icon-error\");\r\n            alert.show();\r\n            alert.tooltip({ content: bizagi.localization.getResource(\"workportal-general-error-required\") });\r\n            return null;\r\n        }\r\n\r\n        // If the text is not set show an error\r\n        if (!self.saveAs && (nameSave == null || nameSave == \"\")) {\r\n            alert = $(\"#queryFormName\", content).next(\".ui-bizagi-input-icon-error\");\r\n            alert.show();\r\n            alert.tooltip({ content: bizagi.localization.getResource(\"workportal-general-error-required\") });\r\n            return null;\r\n        }\r\n        \r\n        if ((self.validationController && self.queryForm.validateForm()) || self.queryForm ) {\r\n            if (typeof (self.searchParams.parameters) == \"string\") {\r\n                self.searchParams.parameters = JSON.parse(self.searchParams.parameters);\r\n            }\r\n                storedQueryFormParameters.definition = JSON.stringify({\r\n                    name: nameSaveAs ? nameSaveAs : nameSave,\r\n                    description: ($(\"#queryFormDescriptionSaveAs\", self.dialogSaveAs).val()) ? $(\"#queryFormDescriptionSaveAs\", self.dialogSaveAs).val() : $(\"#queryFormDescription\", content).val(),\r\n                    parameters: self.searchParams.parameters,\r\n                    type: self.queryFormType,\r\n                    entityGuid: self.guidEntity,\r\n                    includeAllUsers: self.includeAllUsers,\r\n                    parentQueryForm: self.queryForm.properties.displayName\r\n                });\r\n                return storedQueryFormParameters;\r\n        }\r\n    },\r\n\r\n    /*\r\n    * saveResults,  show the form to save the current query result\r\n    */\r\n    showSaveResultsForm: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        self.readyToSave = true;\r\n        var adminResult = $.tmpl(self.adminResult, {});\r\n\r\n        $(\"#tab_share\", adminResult).click(function () {\r\n            self.initShareSelection();\r\n            $(\"#query-form\").hide();\r\n        });\r\n        $(\"#tab_definition\", adminResult).click(function () {\r\n            if (self.params.queryFormAction === \"edit\") {\r\n                $(\"#query-form\").show();\r\n            }\r\n        });\r\n        $(\"input[type=radio][name=shareType]\", adminResult).change(function () {\r\n            if (this.value == 'users') {\r\n                self.initShareSelection();\r\n            }\r\n            else if (this.value == 'groups') {\r\n                $.when(self.searchGroupToShare())\r\n                    .done(function () {\r\n                        $(\"#userShare\", self.shareSlection).hide();\r\n                    })\r\n            }\r\n        });\r\n        $(\"#query-form\", content).hide();\r\n        $(\"#query-form-result\", content).hide();\r\n        $(\"#query-form-admin-result\", content).show();\r\n        $(\"#query-form-admin-result\", content).html(adminResult);\r\n        $(\"#admin-stored-query-form-wrapper\", content).tabs();\r\n\r\n        //To validate if the input contains a value and depends on that show or hide the div that indicates the required field\r\n        $(\"#queryFormName\", content).keyup(function () {\r\n            self.validateRequireField();\r\n        });\r\n\r\n    },\r\n\r\n    validateRequireField: function () {\r\n\r\n        var name = $(\"#queryFormName\").val();\r\n        if (/([^\\s])/.test(name)) {\r\n            $(\"#input-name-ui-bizagi-input-required\").hide();\r\n        } else {\r\n            $(\"#input-name-ui-bizagi-input-required\").show();\r\n        }\r\n\r\n    },\r\n\r\n    initShareSelection: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareSelection = $.tmpl(self.shareSelection, {});\r\n        var users = self.selectedItemsToShare.users;\r\n        $(\"#shareUsers\", content).prop('checked', true);\r\n        $(\"#search_user\", shareSelection).click(function () {\r\n            self.searchUserToShare();\r\n        });\r\n        $(\"#shareSelectionPanel\", content).html(shareSelection);\r\n        $(\"#move_left\", content).click(function () {\r\n            self.removeItem();\r\n        });\r\n        $(\"#move_right\", content).click(function () {\r\n            self.addItem();\r\n        });\r\n        if (users.length > 0) {\r\n            self.searchSavedUser();\r\n        }\r\n    },\r\n\r\n    searchUserToShare: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var filterData = {\r\n            userName: $(\"#userName\", content).val(),\r\n            domain: $(\"#domain\", content).val(),\r\n            fullName: $(\"#fullName\", content).val()\r\n        };\r\n        $.when(self.dataService.searchUsersSharedQuery(filterData)).done(function (response) {\r\n            var filteredUsers = [];\r\n            $.each(response.users, function (index, item) {\r\n                var dupIndex;\r\n                if (item) {\r\n                    dupIndex = $.inArray(item.idUser, self.selectedItemsToShare.users);\r\n                    if (dupIndex < 0) {\r\n                        filteredUsers.push(item);\r\n                    }\r\n                }\r\n            });\r\n            self.showDataToShare(filteredUsers, []);\r\n        }).fail(function (error) {\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    searchSavedUser: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        $.when(self.dataService.searchUsersByID(self.selectedItemsToShare.users)).done(function (response) {\r\n            $(\"#ListBoxResult\", content).empty();\r\n            self.addPrevious(response, shareType);\r\n        }).fail(function (error) {\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    searchGroupToShare: function () {\r\n        var self = this;\r\n        var params = { profileType: 11 };\r\n        return self.dataService.searchProfiles(params)\r\n            .pipe(function (groups) {\r\n                var filteredGroups = [], groupsSelected = [];\r\n                $.each(groups.response, function (index, item) {\r\n                    var dupIndex;\r\n                    if (item) {\r\n                        dupIndex = $.inArray(item.id, self.selectedItemsToShare.groups);\r\n                        if (dupIndex < 0) {\r\n                            filteredGroups.push(item);\r\n                        }\r\n                        else {\r\n                            groupsSelected.push(item);\r\n                        }\r\n                    }\r\n                });\r\n                self.showDataToShare(filteredGroups, groupsSelected);\r\n            });\r\n    },\r\n\r\n    showDataToShare: function (items, itemSelected) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        var selectData;\r\n        if (shareType == \"users\") {\r\n            selectData = $.tmpl(self.selectUser, { elementList: items });\r\n        }\r\n        else {\r\n            selectData = $.tmpl(self.selectGroup, { elementList: items });\r\n\r\n            $(\"#ListBoxResult\", content).empty();\r\n            if (itemSelected.length > 0) {\r\n                self.addPrevious(itemSelected, shareType);\r\n            }\r\n        }\r\n\r\n        $(\"#ListBoxSource\", content).replaceWith(selectData);\r\n    },\r\n\r\n    addPrevious: function (items, shareType) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        if (shareType == \"users\") {\r\n            $.each(items.users, function (i, item) {\r\n                $(\"#ListBoxResult\", content).append(new Option(item.userName, item.idUser));\r\n            });\r\n        }\r\n        else {\r\n            $.each(items, function (i, item) {\r\n                $(\"#ListBoxResult\", content).append(new Option(item.displayName, item.id));\r\n            });\r\n        }\r\n    },\r\n\r\n    addItem: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        var users = $(\"#ListBoxSource option:selected\", content);\r\n\r\n        $.each(users, function (i, item) {\r\n            if ($.inArray(item.value, self.selectedItemsToShare) == -1) {\r\n                //Persist user information\r\n                self.selectedItemsToShare[shareType].push(item.value);\r\n                $(\"#ListBoxSource option[value='\" + item.value + \"']\", content).appendTo(\"#ListBoxResult\"); //visual behavior\r\n            } else {\r\n                //remove only selected users\r\n                $(\"#ListBoxSource option[value='\" + item.value + \"']\", content).remove(); //visual behavior\r\n            }\r\n        });\r\n        $(\"#ListBoxResult option:selected\").prop(\"selected\", false);\r\n    },\r\n\r\n    removeItem: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        var users = $(\"#ListBoxResult option:selected\", content);\r\n        var auxUsers = $(\"#ListBoxSource option\").toArray();\r\n        var arrayUserValues = [];\r\n        $.each(auxUsers, function (i, item) {\r\n            arrayUserValues.push(item.value);\r\n        });\r\n\r\n        $.each(users, function (i, item) {\r\n            var userId = item.value;\r\n            if ($.inArray(userId, arrayUserValues) == -1) {\r\n                $(\"#ListBoxResult option[value='\" + userId + \"']\", content).appendTo(\"#ListBoxSource\"); //visual behavior\r\n            }\r\n            else {\r\n                $(\"#ListBoxResult option[value='\" + userId + \"']\", content).remove(); //visual behavior\r\n            }\r\n            self.selectedItemsToShare[shareType].splice($.inArray(userId, self.selectedItemsToShare[shareType]), 1);\r\n        });\r\n        $(\"#ListBoxSource option:selected\").prop(\"selected\", false);\r\n    },\r\n\r\n    HTMLEncodeText: function (strText) {\r\n        var strNew = strText;\r\n\r\n        strNew = strNew.replace(\"á\", \"&aacute;\");\r\n        strNew = strNew.replace(\"é\", \"&eacute;\");\r\n        strNew = strNew.replace(\"í\", \"&iacute;\");\r\n        strNew = strNew.replace(\"ó\", \"&oacute;\");\r\n        strNew = strNew.replace(\"ú\", \"&uacute;\");\r\n        strNew = strNew.replace(\"ñ\", \"&ntilde;\");\r\n\r\n        strNew = strNew.replace(\"Á\", \"&Aacute;\");\r\n        strNew = strNew.replace(\"É\", \"&Eacute;\");\r\n        strNew = strNew.replace(\"Í\", \"&Iacute;\");\r\n        strNew = strNew.replace(\"Ó\", \"&Oacute;\");\r\n        strNew = strNew.replace(\"Ú\", \"&Uacute;\");\r\n        strNew = strNew.replace(\"Ñ\", \"&Ntilde;\");\r\n\r\n        return strNew;\r\n    },\r\n\r\n\r\n    /*\r\n    * *********************\r\n    * aspx query forms\r\n    * ********************\r\n    */\r\n    frankensteinPostRender: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var iframe = $(\"#queryFormIFrame\", content);\r\n        var css = \"\";\r\n        var cssList = \"\";\r\n        var injectCss = [\".ui-bizagi-old-render*\", \"@font-face\"];\r\n\r\n\r\n        iframe.attr('frameborder', 0);\r\n\r\n        if (typeof injectCss == \"object\") {\r\n            $.each(injectCss, function (key, value) {\r\n                css += bizagi.getStyle(value);\r\n                cssList += value.replace(\".\", \"\") + \" \";\r\n            });\r\n        } else {\r\n            css += bizagi.getStyle(injectCss);\r\n            cssList += injectCss.replace(\".\", \"\");\r\n        }\r\n        // Wait until the iframe has been loadedpip\r\n        iframe.load(function () {\r\n            // inject css\r\n            var iframeContent = $(this).contents();\r\n            var resetCSS = 'body, .ui-bizagi-old-render { overflow-y: visible;};';\r\n            iframeContent.find('input[name=\"btnReturn\"]').css('display', 'none');\r\n            // Append css\r\n            $('head', iframeContent).append(\"<style type='text/css'>\" + css + resetCSS + \"</style>\");\r\n            $('body', iframeContent).addClass(cssList.replace(\"*\", \"\"));\r\n            // Remove borders buttons\r\n            $('body a.WPButton', iframeContent).parent().siblings().remove();\r\n            var callBack = function (params) {\r\n                // This script will execute inside the iframe context\r\n                this.openBACase = function (idCase, sHref) {\r\n                    var workitem = null, workflow = null;\r\n                    if (sHref.indexOf(\"idWorkitem=\") > -1) {\r\n                        workitem = sHref.substring(sHref.indexOf(\"idWorkitem=\") + 11);\r\n                        workitem = workitem.substring(0, workitem.indexOf(\"&\"));\r\n                    }\r\n                    if (sHref.indexOf(\"idWorkflow=\") > -1) {\r\n                        workflow = sHref.substring(sHref.indexOf(\"idWorkflow=\") + 11);\r\n                    }\r\n                    // Executes thepw act on\r\n                    params.controller.publish(\"executeAction\", {\r\n                        action: params.routingAction,\r\n                        idCase: idCase,\r\n                        idWorkItem: workitem,\r\n                        idWorkflow: workflow,\r\n                        referrer: 'queryform'\r\n                    });\r\n\r\n                    var lastQueryFullKey = document.getElementById('h_lastFullKey');\r\n                    var lstCasesElement = document.getElementById('h_lstCases');\r\n                    //bizagi.referrerParams = lastQueryFullKey.value;\r\n                    // Lista de casos bizagi.lstIdCases\r\n                    try {\r\n                        params.controller.dataService.lastQueryFullKey = lastQueryFullKey.value;\r\n                        params.bizagireference.referrerParams.referrer = 'queryform';\r\n                        params.bizagireference.lstIdCases = lstCasesElement.value.split(',');\r\n                        // close dialog\r\n                    } catch (e) {\r\n                        // se produjo un error\r\n                    }\r\n                    for (var i = 0; i < params.bizagireference.workportal.desktop.dialogStack.length; i++) {\r\n                        params.controller.publish(\"closeCurrentDialog\");\r\n                    }\r\n                };\r\n\r\n                this.ShowCaseSumary = function (idCase) {\r\n                    // Verify render version\r\n                    var $ = params.$;\r\n                    $.when(params.controller.dataService.getCaseFormsRenderVersion({ idCase: idCase })).done(function (version) {\r\n                        if (version.formsRenderVersion == 1) {\r\n                            params.controller.publish(\"showDialogWidget\", {\r\n                                widgetName: params.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,\r\n                                widgetURL: params.controller.dataService.serviceLocator.getUrl(\"old-render\") + \"?idCase=\" + idCase + \"&isSummary=1\",\r\n                                modalParameters: {\r\n                                    title: params.controller.resources.getResource(\"workportal-widget-navigation-summary-case\")\r\n                                },\r\n                                afterLoad: params.callBack,\r\n                                afterLoadParams: {\r\n                                    routingAction: params.bizagireference.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                                    genericIframe: params.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,\r\n                                    bizagi: params.bizagireference\r\n                                }\r\n                            });\r\n                        } else {\r\n                            // new version\r\n                            /*var summary = params.bizagireference.workportal.widgets.search.prototype;\r\n                            summary.caseSummaryTemplate = params.controller.workportalFacade.getTemplate(\"inbox-common-case-summary\");\r\n                            summary.dataService = params.controller.dataService;\r\n                            try{\r\n                            summary.showCase.apply(summary,[idCase]);\r\n                            }catch(e){\r\n                            }*/\r\n                        }\r\n                    });\r\n                };\r\n            };\r\n\r\n            iframe.callInside(callBack, {\r\n                controller: self,\r\n                routingAction: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                bizagireference: bizagi,\r\n                callBack: callBack,\r\n                $: jQuery\r\n            });\r\n        });\r\n\r\n    }\r\n});\r\n","/**\r\n * Name: Bizagi Workportal Users Modal\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.queries.management\", {}, {\r\n    /**\r\n     * Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.selectedUsers = [\"\", \"\"];\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load template\r\n        self.loadTemplates({\r\n            \"queries-management\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.queries.management\").concat(\"#queries-management\"),\r\n            \"queries-management-loader\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.queries.management\").concat(\"#ui-bizagi-workportal-widget-queries-management-loader\"),\r\n            \"queries-management-table\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.queries.management\").concat(\"#ui-bizagi-workportal-widget-queries-management-table\"),\r\n        });\r\n\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate('queries-management');\r\n        self.content = template.render();\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.setupSearchusersButton();\r\n        self.loaderTmpl = self.getTemplate(\"queries-management-loader\");\r\n        self.loader = self.loaderTmpl.render();\r\n    },\r\n\r\n    /**\r\n     * Set the fixed head table of the reporting details\r\n     */\r\n    fixedHeadTable: function () {\r\n        var self = this;\r\n        var fixedHeadTableElement = $(\".ui-bizagi-wp-queries-management-content-parent-tableHeadFixed > .ui-bizagi-wp-queries-management-content-tableHeadFixed\", self.content);\r\n        fixedHeadTableElement.find(\"table:first\").floatThead({\r\n            position: 'fixed',\r\n            zIndex: 1,\r\n            scrollContainer: function () {\r\n                return fixedHeadTableElement;\r\n            }\r\n        });\r\n\r\n        self.onResizeModalEvent();\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n    },\r\n\r\n    /**\r\n     * find the maximize button and when the user clicks it the body trigger resize, this is necesary for fixedHeadTable, and recall again\r\n     */\r\n    onResizeModalEvent: function () {\r\n        var self = this;\r\n        self.getContent().parents(\".ui-dialog\").find(\".ui-dialog-titlebar-maximize\").click(function () {\r\n            $(\"body\").trigger(\"resize\");\r\n            self.onResizeModalEvent();\r\n        });\r\n    },\r\n\r\n    /*\r\n    * initialize the users search form widget\r\n    */\r\n    setupUsersSearchForm: function (input, user) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var def = $.Deferred();\r\n        $(\".queries-management-content\", content).hide();\r\n\r\n\r\n        self.usersTable = new bizagi.workportal.widgets.userstable(self.workportalFacade, self.dataService, $.extend(self.params, {\r\n            canvas: $(\"#dinamicContent\", content),\r\n            userLinkLabel: [bizagi.localization.getResource(\"workportal-widget-admin-defaults-assignation-select-link\")],\r\n            parentDef: def,\r\n            showBackButton: true\r\n        }));\r\n        self.usersTable.render();\r\n\r\n        $.when(def).done(function (userId, userName, guid) {\r\n            var params = {\r\n                action: \"Applications\",\r\n                userId: userId\r\n            }\r\n            if (user == 0) {\r\n                self.dataService.getApplicationCategoriesList(params)\r\n                    .done(function (applicationList) {\r\n                        if (applicationList.items.length > 0) {\r\n                            self.allProcess = true;\r\n                            self.haveProcess = true;\r\n                            if (guid !== undefined) {\r\n                                self.getQueries(guid);\r\n                            }\r\n                        }\r\n\r\n                    }).fail(function () {\r\n                    });\r\n            }\r\n            $(\"#dinamicContent\", content).html(\"\");\r\n            $(\".queries-management-content\", content).show();\r\n            if (userName) {\r\n                $(input, content).val(userName);\r\n                self.showHideClearIcon(input, 'block')\r\n            }\r\n            if (guid) {\r\n                self.selectedUsers[user] = guid;\r\n            }\r\n        });\r\n    },\r\n    showNotifier: function (message) {\r\n        var self = this;\r\n        var notifier = window.parent.bizagi.injector.get('notifier');\r\n        notifier.showSucessMessage(message, '');\r\n        //bizagi.util.hideOrShowXToCloseDialog(self.getContent().parents(\".ui-dialog\"), true);\r\n    },\r\n    showLoading: function () {\r\n        var self = this;\r\n        $(\".queries-management-container\").append(self.loader);\r\n    },\r\n    endLoading: function () {\r\n        var self = this;\r\n        $(self.loader).remove();\r\n    },\r\n    clearInput: function (input, content) {\r\n        var self = this;\r\n        var position = (input == \"#txtTextUserSource\") ? 0 : 1;\r\n        self.showHideClearIcon(input, 'none');\r\n        $(input, content).val(\"\");\r\n        self.selectedUsers[position] = \"\";\r\n    },\r\n    showHideClearIcon: function (id, display) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        $(id + \" ~ span\", content).css(\"display\", display);\r\n    },\r\n    getQueries: function (guid) {\r\n        var self = this;\r\n        var params = {};\r\n        params.guidUser = guid;\r\n        self.showLoading();\r\n        self.dataService.getManagementQueries(params)\r\n            .done(function (response) {\r\n                self.queries = response.storedQueryForms;\r\n                self.endLoading();\r\n                if (self.queries.length > 0) {\r\n                    var dataTable = $.map(response.storedQueryForms, function (value) {\r\n                        var name = value.definition.name;\r\n                        var description = value.definition.description;\r\n                        return {\r\n                            name: name,\r\n                            description: description\r\n                        };\r\n                    });\r\n                    $(\".emptyQueries\", self.content).hide();\r\n                    $(\".queries-content\", self.content).show();\r\n                    self.renderTable(dataTable);\r\n                }\r\n                else {\r\n                    $(\".emptyQueriesText\").text(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-queries\"));\r\n                }\r\n            })\r\n            .fail(function (error) {\r\n                self.endLoading();\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admin-transfers-case-security-permissions-assign-fail\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n                bizagi.log(error);\r\n            });\r\n    },\r\n    renderTable: function (dataTable) {\r\n\r\n        var self = this;\r\n        var template = self.getTemplate('queries-management-table');\r\n        var data = {\r\n            data: dataTable\r\n        };\r\n        var contentTable = template.render(data);\r\n        $(\".queries-content.ui-bizagi-wp-queries-management-content-tableHeadFixed\").html(contentTable);\r\n        self.fixedHeadTable();\r\n    },\r\n    validateUsers: function () {\r\n        var self = this;\r\n        var resp = true\r\n        if (self.selectedUsers[0] == \"\" || self.selectedUsers[1] == \"\") {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-both-users-to-continue\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n            resp = false\r\n        } else if (self.selectedUsers[0] == self.selectedUsers[1]) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admin-transfers-case-security-permissions-fail-users-must-be-different\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n            resp = false\r\n        }\r\n        else if (self.queries.length == 0) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-queries\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n            resp = false\r\n        }\r\n        return resp;\r\n    },\r\n\r\n    transferQueries: function () {\r\n        var self = this;\r\n        if (self.validateUsers()) {\r\n            var buttons = [\r\n                {\r\n                    label: bizagi.localization.getResource(\"workportal-widget-queries-management-transfer-confirmation-modal-no-button\"),\r\n                    action: \"reject\"\r\n                },\r\n                {\r\n                    label: bizagi.localization.getResource(\"workportal-widget-queries-management-transfer-confirmation-modal-button\"),\r\n                    action: \"resolve\"\r\n                }\r\n            ];\r\n            var customOptions = {\r\n                dialogClass: \"widget-queries-management-transfer-confirm\",\r\n                width: 400,\r\n                minWidth: 400\r\n            };\r\n            \r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-widget-queries-management-transfer-confirmation-modal-description\"), bizagi.localization.getResource(\"workportal-general-word-information\"), false, buttons, customOptions))\r\n                .done(function () {\r\n                    self.showLoading();\r\n                    var params = {\r\n                        guidUserSource: self.selectedUsers[0],\r\n                        guidUserTarget: self.selectedUsers[1]\r\n                    }\r\n                    self.dataService.transferQueries(params)\r\n                        .done(function () {\r\n                            self.endLoading();\r\n                            $(\".emptyQueriesText\").text(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-queries\"));\r\n                            $(\".queries-content\", self.content).hide();\r\n                            $(\".emptyQueries\", self.content).show();\r\n                            self.showNotifier(bizagi.localization.getResource(\"workportal-widget-queries-management-queries-transferred-successfully\"));\r\n                        })\r\n                        .fail(function (error) {\r\n                            self.endLoading();\r\n                            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-queries-management-queries-transferred-fail\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n                            bizagi.log(error);\r\n                        });\r\n\r\n                });\r\n        }\r\n    },\r\n\r\n    /****************** EVENTS ***********************/\r\n\r\n\r\n    setupSearchusersButton: function () {\r\n        var self = this,\r\n            content = self.getContent();\r\n\r\n        $(\"#btn-searchUserSource\", content).click(function () {\r\n            self.setupUsersSearchForm(\"#txtTextUserSource\", 0);\r\n        });\r\n        $(\"#btn-searchUserTarget\", content).click(function () {\r\n            self.setupUsersSearchForm(\"#txtTextUserTarget\", 1);\r\n        });\r\n\r\n        $(\"#btn-clearUserSource\", content).click(function () {\r\n            self.clearInput(\"#txtTextUserSource\", content);\r\n            $(\".emptyQueriesText\").text(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-selected-user\"));\r\n            $(\".queries-content\", self.content).hide();\r\n            $(\".emptyQueries\", self.content).show();\r\n        });\r\n        $(\"#btn-clearUserTarget\", content).click(function () {\r\n            self.clearInput(\"#txtTextUserTarget\", content);\r\n        });\r\n\r\n        $(\"#btn-transferQueries\", content).click(function () {\r\n            self.transferQueries();\r\n        });\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.queries.management', ['workportalFacade', 'dataService', bizagi.workportal.widgets.queries.management]); "]}