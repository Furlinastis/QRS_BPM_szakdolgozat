{"version":3,"sources":["jquery/workportal/desktop/widget/casesTemplate/bizagi.workportal.desktop.widgets.casestemplate.js","jquery/workportal/desktop/widget/filtercases/bizagi.workportal.desktop.widgets.filtercases.js","jquery/workportal/desktop/widget/paginator/bizagi.workportal.desktop.widgets.paginator.js","jquery/workportal/desktop/widget/sortbar/bizagi.workportal.desktop.widgets.sortbar.js","jquery/workportal/desktop/widget/processeslist/bizagi.workportal.desktop.widgets.processeslist.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","actionService","casetoolbar","usersCasesService","actionsEventsService","accumulatedcontext","params","self","this","_super","loadTemplates","casestemplate-container","getTemplate","concat","casestemplate-item","casestemplate-empty-data","selectorCheckboxItems","hasBatchActions","sequenceCall","renderContent","templateContainer","content","render","postRender","$content","getContent","sub","$","proxy","updateCases","getCommonActions","ev","setValues","subscribe","onFormActionExecuted","onFormRuleExecuted","find","on","onCaseChecked","clean","checkAll","unsubscribe","unsub","off","data","sequence","args","defer","Deferred","$dataViewList","empty","casesSelected","page","idworkflow","undefined","route","filter","pageSize","when","getCasesData","pipe","casesData","resolve","pub","type","event","getCasesTemplates","done","templates","templateString","casesLength","length","getEmptyDataMessage","$templateCase","$elementsTmpl","i","l","renderCase","push","apply","append","commonActions","value","promise","caseData","isRefresh","actionData","idCase","surrogateKey","guidEntity","templateCase","security","command","tmpl","checkSecurityPerm","graphicQuery","casetoolbarData","setTimeout","$casetoolbar","getCaseToolbar","referrer","$case","$footer","startLoading","delay","overlay","getActionsView","loadEvents","responseActions","$actionsView","actionsView","actionsData","batchActions","getCheckBox","showCheckItem","removeCheckItem","endLoading","getAssignees","$assignees","$item","closest","remove","show","refresh","refreshCase","idBox","$templateBox","isChecked","is","then","caseTemplate","replaceWith","prop","getActivitiesData","getPendingsData","taskState","result","getTemplateEngine","engine","map","entities","cases","casesTemplates","makeArray","arguments","idCases","guidFavorite","idcase","idWorkflow","radNumber","guid","templateEngine","proxyPrefix","RPproxyPrefix","renderDataService","services","service","renderFactory","rendering","desktop","factory","initAsyncStuff","cache","forcePersonalizedColumns","reference","referenceType","fromActionLauncher","histName","displayName","guidEntityCurrent","xpath","pubDeadLockDetection","outerHTML","$target","target","model","actions","surrogateKeys","parentsid","itemsSelected","$inputs","input","guidentity","injector","register","casestemplate","lastIdworkflow","filtercases","template","$contentWidget","onClickButtonFilter","updateUI","currentTarget","hasClass","attr","addClass","siblings","removeClass","resourceLocalization","toLowerCase","localization","getResource","refreshLastItemBreadcrumb","hide","paginator","getSuffixWidget","updateView","configureHandlers","renderTemplate","totalRecords","totalPages","currentPage","appendTo","setModel","action","guidSearch","getModel","stopNavigation","onPageBreak","disabledPaginatorButtonsByLimits","text","$buttonFastRewind","$buttonRewind","$buttonFordward","$buttonFastFordward","processActionService","sortbar","right-content","addButton","sortMenu","recordsPerPage","recordsMenu","enableFilter","$checkAll","configureAfterPaintHandlers","initializeAndProcessFilterButton","setFiltersSortData","hideFilterButtonAndBar","hideSortButtons","enableBatchActions","updateCounterByFilterApplied","showingFiltering","setVisibleCheckAll","behaviorVisibleSortbar","validActions","tooltip","onCheckUncheck","showSortMenu","showRecordsMenu","sortSelection","attribute","setIconSortType","_sortType","properties","orderType","typeSearch","onRemoveSelectedItemsCollections","showingSorting","showingCheckAll","_haveAddButton","setVisibleSortbar","visible","showSelectedItems","numberCheckedItems","keywordSelected","button","sortTypeBeforeChanged","onClickBatchAction","$buttonLI","guidAction","getAction","requestsInProgressActionGuid","addLoadingButtonAction","executeBatchAction","commonActionsmodel","always","$button","prepend","$parent","filters","_filters","displayValue","val","click","e","stopPropagation","document","one","index","display","split","pop","Number","util","trim","textContent","restoreOrderSelected","processAddButton","$buttonContainer","_lastReferenceEntity","children","getProcessAddAction","referenceEntity","Object","getOwnPropertyNames","id","renderButton","$addButton","clickAddButton","getMapping","accumulatedContext","getContext","xpathContext","mappingData","onExecuteProcess","onExecuteForm","commonActionsModel","showBatchActions","typeActions","keys","moreActions","slice","$actions","tooltipClass","items","html","open","ui","uiTooltip","$id","keyActionGuid","not","$buttonAction","close","hover","stop","fadeTo","fadeOut","filtersAppliedCounter","calculateFilters","a","filterCounter","sortCounter","defaultValues","min","max","showFilterButton","hideFilterButton","showSortButtons","updateCounter","$sortbarIcon","filtersApplied","counter","$counter","showingFilter","startForm","hasStartForm","executeProcessAction","refreshTemplateData","loadTemplateData","executeFormAction","grep","multiplicity","mode","isEvent","processeslist","processeslistEmptyData","getData","processes","setSelectedList","getIdworkflow","getHistname","onClickProcess","$args","$route","myPendings","myActivities","onlyFavorites","getAllProcesses","getInfoToProcessesList","allProcesses","categories","j","k","workflows","process","name","clone","level","item"],"mappings":"AAAAA,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,8CAIpCC,KAAM,SAAUC,EAAkBC,EAAaC,EAAeC,EAAaC,EAAmBC,EAAsBC,EAAoBC,GACpI,IAAIC,EAAOC,KAGXD,EAAKE,OAAOV,EAAkBC,EAAaM,GAG3CC,EAAKG,eACDC,0BAA2BlB,OAAOmB,YAAY,kDAAkDC,OAAO,0BACvGC,qBAAsBrB,OAAOmB,YAAY,kDAAkDC,OAAO,uBAClGE,2BAA4BtB,OAAOmB,YAAY,kDAAkDC,OAAO,kCAG5GN,EAAKS,sBAAwB,kDAC7BT,EAAKN,cAAgBA,EACrBM,EAAKL,YAAcA,EACnBK,EAAKJ,kBAAoBA,EACzBI,EAAKH,qBAAuBA,EAC5BG,EAAKU,iBAAkB,EAEvBV,EAAKW,aAAe,EACpBX,EAAKF,mBAAqBA,GAM9Bc,cAAe,WACX,IAAIZ,EAAOC,KACPY,EAAoBb,EAAKK,YAAY,2BAGzC,OADAL,EAAKc,QAAUD,EAAkBE,WAC1Bf,EAAKc,SAMhBE,WAAY,WACR,IAAIhB,EAAOC,KACPgB,EAAWjB,EAAKkB,aAEpBlB,EAAKmB,IAAI,sBAAuBC,EAAEC,MAAMrB,EAAKsB,YAAatB,IAC1DA,EAAKmB,IAAI,2BAA4BC,EAAEC,MAAMrB,EAAKsB,YAAatB,IAC/DA,EAAKmB,IAAI,qBAAsBC,EAAEC,MAAMrB,EAAKuB,iBAAkBvB,IAC9DA,EAAKmB,IAAI,cAAeC,EAAEC,MAAMrB,EAAKsB,YAAatB,IAClDA,EAAKmB,IAAI,aAAc,SAAUK,EAAIzB,GAAU,OAAOC,EAAKyB,UAAU1B,KACrEC,EAAKN,cAAcgC,UAAU,uBAAwBN,EAAEC,MAAMrB,EAAK2B,qBAAsB3B,IACxFA,EAAKN,cAAcgC,UAAU,qBAAsBN,EAAEC,MAAMrB,EAAK4B,mBAAoB5B,IACpFiB,EAASY,KAAK,kCAAkCC,GAAG,QAAS9B,EAAKS,sBAAuBW,EAAEC,MAAMrB,EAAK+B,cAAe/B,KAMxHgC,MAAO,WACH,IAAIhC,EAAOC,KACPgB,EAAWjB,EAAKkB,aAEpBlB,EAAKiC,UAAW,EAChBjC,EAAKW,aAAe,EAEhBM,IACAjB,EAAKN,cAAcwC,YAAY,wBAC/BlC,EAAKN,cAAcwC,YAAY,sBAC/BlC,EAAKmC,MAAM,uBACXnC,EAAKmC,MAAM,4BACXnC,EAAKmC,MAAM,sBACXnC,EAAKmB,IAAI,cACTF,EAASY,KAAK,kCAAkCO,IAAI,QAASpC,EAAKS,yBAO1Ea,YAAc,SAASE,EAAIa,GACvB,IAgBWC,EAhBPtC,EAAOC,KACPsC,EAAOF,EAAKE,KACZC,EAAQ,IAAIpB,EAAEqB,SACdC,EAAgBtB,EAAE,iCAAkCpB,EAAKkB,cA8D7D,OA5DAwB,EAAcC,QACd3C,EAAKN,cAAcH,OACnBS,EAAK4C,iBACL5C,EAAKW,eAELX,EAAK6C,KAAON,EAAKM,MAAQ7C,EAAK6C,KAC9B7C,EAAK8C,WAAiCC,MAAnBR,EAAKO,WAA2B9C,EAAK8C,WAAaP,EAAKO,WAC1E9C,EAAKgD,MAAQT,EAAKS,OAAShD,EAAKgD,MAChChD,EAAKiD,OAASV,EAAKU,QAAUjD,EAAKiD,OAClCjD,EAAKkD,SAAWX,EAAKW,UAAYlD,EAAKkD,SAE3BZ,EA+CRtC,EAAKW,aA9CJS,EAAE+B,KAAKnD,EAAKoD,cAAeP,KAAM7C,EAAK6C,KAAMC,WAAY9C,EAAK8C,WAAYI,SAAUlD,EAAKkD,YACnFG,KAAK,SAAUC,GACZ,OAAItD,EAAKW,eAAiB2B,GACtBE,EAAMe,UACC,OAEXvD,EAAKwD,IAAI,UAAYC,KAAM,mBAAoBlB,KAAMnB,EAAE9B,OAAOiD,EAAMe,GAAaI,MAAOrB,EAAKoB,SACtFzD,EAAK2D,kBAAkBL,MAEjCM,KAAK,SAAUC,GACZ,GAAiB,OAAdA,EAAmB,CAClB,IACIC,GADc9D,EAAK+D,YAAcF,EAAUG,QACZ,EAAI,GAAKhE,EAAKiE,sBAC7CC,EAAgB,KAChBC,EAAgB/C,IAEpBpB,EAAKU,iBAAkB,EACvB,IAAK,IAAI0D,EAAI,EAAGC,EAAIR,EAAUG,OAAQI,EAAIC,EAAGD,IAAK,CAC9C,GAAIpE,EAAKW,eAAiB2B,EAEtB,YADAE,EAAMe,UAGVW,EAAgBlE,EAAKsE,WAAWT,EAAUO,IAAI,EAAO9B,GACrD6B,EAAcI,KAAKC,MAAML,EAAeD,GAEvClE,EAAKU,iBACNV,EAAKwD,IAAI,UACLC,KAAM,iBACNlB,UAIJ4B,EAAcH,OAAS,EACvBtB,EAAc+B,OAAON,GAGrBzB,EAAc+B,OAAOX,GAGzB9D,EAAKiC,UAAW,EAEhBjC,EAAKwD,IAAI,UAAYC,KAAM,wBAAyBlB,MAAQmC,cAAe1E,EAAKyB,WAAYc,MAAQoC,MAAO3E,EAAKiC,eAChHO,EAAMe,QAAQM,MAMvBrB,EAAMoC,WAOjBN,WAAa,SAASO,EAAUC,EAAWxC,GACvC,IAAItC,EAAOC,KACP8E,EAAaF,EAASE,WACtBC,EAASD,EAAWC,OACpBC,EAAeF,EAAWE,aAC1BC,EAAaH,EAAWG,WACxBC,EAAenF,EAAKK,YAAY,sBAChC+E,EAAW,IAAIlG,OAAOC,WAAWkG,QAAQD,SAASpF,EAAKP,aACvDyE,EAAgBiB,EAAapE,QAC7BiE,OAAQA,EACRE,WAAYA,EACZD,aAAcA,IAyElB,OAtEAf,EAAcrC,KAAK,aAAa4C,OAAOI,EAASS,MAEhDlE,EAAE+B,KAAKiC,EAASG,kBAAkB,iBAAiB3B,KAAK,SAAS4B,GAC7DX,EAASY,gBAA8B,aAAID,EAE3CE,WAAW,WACP,IAAIC,EAAe3F,EAAKL,YAAYiG,gBAAiBH,gBAAiBrE,EAAE9B,OAAOuF,EAASY,iBAAkBI,SAAU,oBAChHC,EAAQ9F,EAAKkB,aAAaW,KAAK,6BAA+BmD,EAAS,8BAEvE1C,IAAatC,EAAKW,cAClBmF,EAAMrB,OAAOkB,IAElB,KAIPD,WAAW,WACP,IAAIK,EAAU/F,EAAKkB,aAAaW,KAAK,6BAA+BmD,EAAS,6BAE7Ee,EAAQC,cAAeC,MAAO,EAAGC,SAAS,IAC1C9E,EAAE+B,KAAKnD,EAAKN,cAAcyG,gBAClBpB,WAAYF,EAASE,WACrBqB,YAAY,EACZtB,UAAWA,KAEdlB,KAAK,SAAUyC,GACZ,IAAIC,EAAeD,EAAgBE,YAC/BC,EAAcH,EAAgBG,YAG9BC,EAAsC,IAAvBD,EAAYxC,UAAoBhE,EAAKwD,IAAI,UACxDC,KAAM,gBACNlB,MAAOiE,YAAaA,KACrB,GACCV,EAAQ9F,EAAKkB,aACZW,KAAK,6BAA+BmD,EAAS,uDAC9CsB,GAAiBhE,IAAatC,EAAKW,cACnCmF,EAAMrB,OAAO6B,GAGVG,EAAazC,OAAS,IAAsD,GAAjDhE,EAAK0G,YAAYZ,GAAOzD,KAAK,iBACvDrC,EAAKU,iBAAkB,EACvBV,EAAK2G,cAAcb,GACnB9F,EAAKwD,IAAI,UACLC,KAAM,yBACNlB,WAIJvC,EAAK4G,gBAAgBd,IAIzB9F,EAAK4G,gBAAgBd,GAEzBC,EAAQc,gBAEjB,GAEHnB,WAAW,WACPtE,EAAE+B,KAAKnD,EAAKJ,kBAAkBkH,aAAa9B,IACtCpB,KAAK,SAAUmD,GACRA,GAAezE,IAAatC,EAAKW,cACrBX,EAAKkB,aACZW,KAAK,6BAA+BmD,EAAS,uDAC5CP,OAAOsC,MAG1B,GAEI7C,GAOXwC,YAAa,SAASM,GAElB,OAAOA,EAAMC,QAAQ,6BAA6BpF,KADvC5B,KACiDQ,wBAOhEmG,gBAAiB,SAASI,GACX/G,KACNyG,YAAYM,GAAOE,UAO5BP,cAAe,SAASK,GACT/G,KACNyG,YAAYM,GAAOG,QAM5BxF,qBAAuB,SAASH,EAAIa,IAEhCA,EAAOA,OAEE+E,SAHEnH,KAIFoH,YAAYhF,EAAK2C,SAO9BpD,mBAAoB,SAAUJ,EAAIa,IAE9BA,EAAOA,OAEE+E,SAHEnH,KAIFoH,YAAYhF,EAAK2C,SAO9BqC,YAAa,SAAUrC,GACnB,IAAIhF,EAAOC,KAEPqH,EAAQ,6BAA+BtC,EACvCuC,EAAenG,EAAEkG,GACjBE,EAAYD,EACX1F,KAAK,4CACL4F,GAAG,YAERF,EAAavB,cAAeC,MAAO,IAAKC,SAAS,IAEjD9E,EAAE+B,KAAKnD,EAAKoD,cAAe4B,OAAQA,KAC9B0C,KAAK,SAAU7C,GACZ,OAAO7E,EAAK2D,kBAAkBkB,GAAU,KAE3CjB,KAAK,SAAU+D,GAEZ,IAAIzD,EAAgB,KAEGnB,MAAnB4E,EAAa,IAAsC,MAAnBA,EAAa,KAC7CzD,EAAgBlE,EAAKsE,WAAWqD,EAAa,IAAI,EAAM3H,EAAKW,cAC5D4G,EAAaK,YAAY1D,IAG7BqD,EAAaV,aAGTW,IACAD,EAAenG,EAAEkG,IACJzF,KAAK,4CAA4CgG,KAAK,WAAW,MAQ9FzE,aAAc,SAAUrD,GACpB,IAAIC,EAAOC,KAEX,MAAkB,aAAdD,EAAKgD,MACEhD,EAAKP,YAAYqI,kBAAkB/H,GAG5B,YAAdC,EAAKgD,MACEhD,EAAKP,YAAYsI,gBAAgBhI,GAGzB,SAAdC,EAAKgD,OACQ,UAAdhD,EAAKgD,OACS,OAAdhD,EAAKgD,OACL5B,EAAE9B,OAAOS,GAAUiI,UAAWhI,EAAKgD,QAC5BhD,EAAKP,YAAYsI,gBAAgBhI,SAJ5C,GAWJ4D,kBAAoB,SAASL,EAAW+D,GACpC,IAAIrH,EAAOC,KACPgI,KACAzF,EAAQ,IAAIpB,EAAEqB,SA0ClB,OAxCIrB,EAAE+B,KAAKnD,EAAKkI,qBACPR,KAAK,SAAUS,GACZ,OAAO/G,EAAE+B,KAAKqB,MAAMpD,EAAGA,EAAEgH,IAAI9E,EAAU+E,SAAU,SAAUC,GACvD,OAAOH,EAAOpH,OAAOuH,QAG5B1E,KAAK,WAKF,IAJA,IAAI2E,EAAiBnH,EAAEoH,UAAUC,WAC7BC,KACAJ,EAAQhF,EAAU+E,SAASrE,OAEtBI,EAAI,EAAGA,EAAIkE,EAAOlE,IAAK,CAC5B,IAAIkB,EAAkB,IAAVgD,EAAeC,EAAenE,GAAKmE,EAAenE,GAAG,GAC7DS,EAAWvB,EAAU+E,SAASjE,GAClC6D,EAAO1D,MACHe,KAAMA,EACNG,iBACIkD,aAAcrF,EAAU+E,SAASjE,GAAGuE,aACpCC,OAAQtF,EAAU+E,SAASjE,GAAGY,OAC9B6D,WAAYvF,EAAU+E,SAASjE,GAAGyE,WAClCC,UAAWxF,EAAU+E,SAASjE,GAAG0E,WAAaxF,EAAU+E,SAASjE,GAAGY,QAExED,YACIG,WAAYL,EAASkE,KACrB/D,OAAQH,EAASG,OACjB8D,UAAWjE,EAASiE,UACpB7D,aAAcJ,EAASI,gBAG/ByD,EAAQnE,KAAKM,EAASG,QAGrBqC,IACDrH,EAAKJ,kBAAkBmB,OAAO2H,GAC9B1I,EAAKH,qBAAqBkB,OAAO2H,IAGrClG,EAAMe,QAAQ0E,KAGnBzF,EAAMoC,WAMjBsD,kBAAmB,WACf,IAAIlI,EAAOC,KAEX,GAAID,EAAKgJ,eACL,OAAOhJ,EAAKgJ,eAGhB,IAAIjJ,KAEJA,EAAOkJ,YAAc/J,OAAOgK,cAC5B,IAAIC,EAAoB,IAAIjK,OAAO6B,OAAOqI,SAASC,QAAQtJ,GACvDuJ,EAAgB,IAAIpK,OAAOqK,UAAUC,QAAQC,QAAQN,GACrD3G,EAAQ,IAAIpB,EAAEqB,SA8BlB,OA5BArB,EAAE+B,KAAKmG,EAAcI,kBAChB9F,KAAK,WACF5D,EAAKgJ,eAAiB,IAAI9J,OAAO8J,gBAAiBM,cAAeA,EAAeK,OAAO,EAAMC,0BAA0B,IACvH5J,EAAKgJ,eAAetH,UAAU,uBAAwB,SAAUF,EAAIzB,GAChE,IAAIsC,EAAOtC,EAAOsC,SACdE,GACAsH,UAAWxH,EAAKwH,UAChB5E,aAAc5C,EAAK4C,aACnB6E,cAAezH,EAAKyH,cACpBC,oBAAoB,EACpBC,SAAU3H,EAAK4H,YACfC,kBAAmB7H,EAAK6H,kBACxBrH,KAAM,QAGgB,IAAfR,EAAK8H,OAAyB9H,EAAK8H,QAC1C5H,EAAK4H,MAAQ9H,EAAK8H,OAGtBnK,EAAKF,mBAAmBkC,QACxBhC,EAAKoK,qBAAqB,UACtB3G,KAAM,sBACNlB,KAAMA,MAGdC,EAAMe,QAAQvD,EAAKgJ,kBAGpBxG,EAAMoC,WAMjBX,oBAAqB,WAIjB,OAHWhE,KACuBI,YAAY,4BAEhBU,SAAS,GAAGsJ,WAM9CtI,cAAe,SAAUP,GACrB,IACI8I,EAAUlJ,EAAEI,EAAG+I,QACftF,EAAeqF,EAAQjI,KAAK,gBAC5B2C,EAASsF,EAAQjI,KAAK,UACtB6C,EAAaoF,EAAQjI,KAAK,cAC1BmF,EAAY8C,EAAQ7C,GAAG,YALhBxH,KAON2C,cAAcoC,IACfC,aAAcA,EACdC,WAAYA,EACZF,OAAQA,GAGPwC,UAbMvH,KAcK2C,cAAcoC,GAdnB/E,KAgBNuD,IAAI,UAAYC,KAAM,wBAAyBlB,MAAQmC,cAhBjDzE,KAgBqEsB,uBAOpFA,iBAAkB,WACd,IAAIvB,EAAOC,KACPuK,KAMJ,IAAK,IAAI5B,KAJT4B,EAAMC,QAAUzK,EAAKN,cAAc6B,iBAAiBvB,EAAK4C,eACzD4H,EAAME,iBACNF,EAAMG,aAEa3K,EAAK4C,cAAe,CACnC,IAAIP,EAAOrC,EAAK4C,cAAcgG,IACH,IAAvBvG,EAAK4C,eACLuF,EAAME,cAAcnG,KAAKlC,EAAK4C,cAC9BuF,EAAMG,UAAUpG,KAAKlC,EAAK2C,SAiBlC,OAbAwF,EAAMtF,gBAAyBnC,IAAX6F,EAAwB5I,EAAK4C,cAAcgG,GAAQ1D,WAAa,GAElD,GAA9BsF,EAAME,cAAc1G,QACpBhE,EAAKiC,UAAW,EAChBuI,EAAMvI,UAAW,GAEZuI,EAAME,cAAc1G,QAAUhE,EAAK+D,cACxC/D,EAAKiC,UAAW,EAChBuI,EAAMvI,UAAW,GAGrBuI,EAAMI,cAAgB5K,EAAK4C,cAEpB4H,GAMX/I,UAAW,SAAU1B,GACjB,IAAIC,EAAOC,KACPgB,EAAWjB,EAAKkB,aAEhBsG,GADOzH,EAAOwC,UACGoC,MAErB,GAAI1D,EAAU,CACVjB,EAAK4C,iBACL,IAAIiI,EAAU5J,EAASY,KAAK7B,EAAKS,uBAmBjC,OAlBAW,EAAEgH,IAAIyC,EAAS,SAAUC,GAGrB,GAFA1J,EAAE0J,GAAOjD,KAAK,UAAWL,GAErBA,EAAW,CACX,IAAIvC,EAAe7D,EAAE0J,GAAOzI,KAAK,gBAC7B2C,EAAS5D,EAAE0J,GAAOzI,KAAK,UACvB0I,EAAa3J,EAAE0J,GAAOzI,KAAK,cAE/BrC,EAAK4C,cAAcoC,IACfC,aAAcA,EACdC,WAAY6F,EACZ/F,OAAQA,MAKpBhF,EAAKiC,SAAWuF,EAETxH,EAAKuB,uBAKxBrC,OAAO8L,SAASC,SAAS,2CAA4C,mBAAoB,cAAe,gBAAiB,cAAe,oBAAqB,uBAAwB,qBAAsB/L,OAAOC,WAAWC,QAAQ8L,gBCriBrOhM,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,4CAKpCC,KAAM,SAAUC,EAAkBC,EAAaM,GAChCE,KAGNC,OAAOV,EAAkBC,EAAaM,GAHhCE,KAKNkL,eALMlL,KAQNE,eACDiL,YAAelM,OAAOmB,YAAY,gDAAgDC,OAAO,2BAOjGM,cAAe,SAAU8C,EAAO3D,GAC5B,IACIsL,EADOpL,KACSI,YAAY,eAEhC,OAHWJ,KAENa,QAAUuK,EAAStK,WAFbd,KAGCa,SAMhBE,WAAY,SAAU0C,EAAO3D,GACzB,IAAIC,EAAOC,KACPqL,EAAiBtL,EAAKkB,aAC1BE,EAAE,gCAAiCkK,GAAgBxJ,GAAG,QAASV,EAAEC,MAAMrB,EAAKuL,oBAAqBvL,IACjGA,EAAKmB,IAAI,sBAAuBC,EAAEC,MAAMrB,EAAKwL,SAAUxL,KAO3DuL,oBAAqB,SAAS7H,GAC1B,IACI4G,EAAUlJ,EAAEsC,EAAM+H,eAEtB,IAAInB,EAAQoB,SAAS,UAAU,CAC3B,IAGI1B,EAFAhH,EAAQsH,EAAQqB,KAAK,MACrB7I,EANG7C,KAMeuD,IAAI,UAAYC,KAAM,qCAAqC,GAKjF,GAFA6G,EAAQsB,SAAS,UAAUC,WAAWC,YAAY,UAErC,aAAV9I,EACCgH,EAZG/J,KAYauD,IAAI,UAAYC,KAAM,mCAAmC,OAEzE,CACA,IAAIsI,EAX8B,wCAW2B/I,EAAMgJ,cACnEhC,EAAW9K,OAAO+M,aAAaC,YAAYH,GAhBxC9L,KAmBFkL,eAAiBrI,EAnBf7C,KAqBFuD,IAAI,UACLC,KAAM,sBACNlB,MACIyH,SAAUA,EACVnH,KAAM,EACNsJ,2BAA2B,EAC3BnJ,MAAQA,EACRF,WAAaA,GAAc,QAY3C0I,SAAU,SAAS9H,EAAO3D,GAGG,cAAtBA,EAAOwC,KAAKS,MACX5B,EAHOnB,KAGAa,SAASsL,OAGhBhL,EANOnB,KAMAa,SAASqG,OAEjBpH,EAAOwC,KAAKO,aARJ7C,KAQwBkL,gBAAkB,KACjD/J,EAAE,2CAA2CwK,SAAS,UAAUC,WAAWC,YAAY,WAO/F9J,MAAO,WACQ/B,KACNkC,MAAM,0BAInBjD,OAAO8L,SAASC,SAAS,yCAA0C,mBAAoB,cAAe/L,OAAOC,WAAWC,QAAQgM,cC3GhIlM,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,0CAKpCC,KAAM,SAAUC,EAAkBC,EAAaM,GAChCE,KAGNC,OAAOV,EAAkBC,EAAaM,GAHhCE,KAKNE,eACDkM,UAAanN,OAAOmB,YAAY,8CAA8CC,OAAO,sBACrFQ,QAAW5B,OAAOmB,YAAY,8CAA8CC,OAAO,yBAO3FM,cAAe,WACX,IAAIZ,EAAOC,KACPmM,EAAqC,WAA9BpM,EAAKD,OAAO+J,cACnBuB,EAAWrL,EAAKK,YAAY,YAAcL,EAAKsM,mBAGnD,OAFAtM,EAAKc,QAAUuK,EAAStK,QAAQqL,KAAKA,IAE9BpM,EAAKc,SAMhBE,WAAY,WACGf,KAENkB,IAAI,mBAAoBC,EAAEC,MAFpBpB,KAE+BsM,WAF/BtM,OAAAA,KAGNuM,qBAOTF,gBAAiB,WACb,MAAO,IASXC,WAAY,SAAU/K,EAAIzB,GACtB,IAAIC,EAAOC,KACPsC,EAAOxC,EAAOwC,KACd6J,EAA8B,WAAvB7J,EAAKuH,cACZ7I,EAAWjB,EAAKkB,aAoBpB,SAASuL,IACiBzM,EAAKK,YAAY,UAAYL,EAAKsM,mBAExCvL,QACZ2L,aAAc1M,EAAK0M,aACnBC,WAAY3M,EAAK2M,WACjB1C,YAAajK,EAAKiK,YAClB2C,YAAa5M,EAAK4M,YAClBR,KAAMA,IACPS,SAAS5L,GA3BhBjB,EAAK8M,SAASvK,GACdtB,EAAS0B,QAELJ,EAAKwH,mBACD/J,EAAK0M,aAAe,EACpBD,IAGAzM,EAAKgC,QAITyK,KAsBRK,SAAU,SAAUvK,GAChB,IAAIvC,EAAOC,KAEXD,EAAK0M,kBAA4C,IAAtBnK,EAAiB,aAAoBvC,EAAK0M,aAAenK,EAAKmK,aACzF1M,EAAK2M,WAAapK,EAAKoK,YAAc3M,EAAK2M,WAC1C3M,EAAKiK,YAAc1H,EAAKyH,UAAYhK,EAAKiK,YACzCjK,EAAK4M,YAAcrK,EAAKqK,aAAe5M,EAAK4M,YAC5C5M,EAAK+M,OAASxK,EAAKwK,OACnB/M,EAAK6J,UAAYtH,EAAKsH,WAAa7J,EAAK6J,UACxC7J,EAAKiF,aAAe1C,EAAK0C,cAAgBjF,EAAKiF,aAC9CjF,EAAK8J,cAAgBvH,EAAKuH,cAC1B9J,EAAK0D,MAAQnB,EAAKmB,MAClB1D,EAAKgN,WAAazK,EAAKyK,YAM3BC,SAAU,WACN,IAAIjN,EAAOC,KAEX,OACI4C,KAAM7C,EAAK4M,YACXF,aAAc1M,EAAK0M,aACnBK,OAAQ/M,EAAK+M,OACblD,UAAW7J,EAAK6J,UAChB5E,aAAcjF,EAAKiF,aACnB6E,cAAe9J,EAAK8J,cACpBoD,gBAAiB,EACjBF,WAAYhN,EAAKgN,aAOzBR,kBAAmB,WACJvM,KACSiB,aAEXY,GAAG,QAASV,EAAEC,MAHZpB,KAGuBkN,YAHvBlN,QASfkN,YAAa,SAAU3L,GACnB,IAAIxB,EAAOC,KACPqK,EAAUlJ,EAAEI,EAAG+I,QACftJ,EAAWjB,EAAKkB,aAEpB,GAAIoJ,EAAQoB,SAAS,kBAAoBpB,EAAQoB,SAAS,qBAAsB,CAC5E,IAAIjI,EAAO6G,EAAQjI,KAAK,QAEZ,WAARoB,EACAzD,EAAK4M,aAAe,EAEP,UAARnJ,EACLzD,EAAK4M,aAAe,EAGpB5M,EAAK4M,YADQ,cAARnJ,EACc,EAGAzD,EAAK2M,WAG5B3M,EAAKoN,mCACLnM,EAASY,KAAK,oCAAoCwL,KAAKrN,EAAK4M,aAE5D5M,EAAKwD,IAAI,UAAYC,KAAM,2BAA4BlB,KAAMvC,EAAKiN,eAI1EG,iCAAkC,WAC9B,IAAIpN,EAAOC,KACPqN,EAAoBlM,EAAE,2BAA4BpB,EAAKc,SACvDyM,EAAgBnM,EAAE,uBAAwBpB,EAAKc,SAC/C0M,EAAkBpM,EAAE,wBAAyBpB,EAAKc,SAClD2M,EAAsBrM,EAAE,4BAA6BpB,EAAKc,SAEvC,IAApBd,EAAK2M,YACJW,EAAkB1B,SAAS,qBAC3B2B,EAAc3B,SAAS,qBACvB4B,EAAgB5B,SAAS,qBACzB6B,EAAoB7B,SAAS,sBAGL,IAArB5L,EAAK4M,aACJU,EAAkB1B,SAAS,qBAC3B2B,EAAc3B,SAAS,qBACvB4B,EAAgB1B,YAAY,qBAC5B2B,EAAoB3B,YAAY,sBAG5B9L,EAAK4M,cAAgB5M,EAAK2M,YAC9BW,EAAkBxB,YAAY,qBAC9ByB,EAAczB,YAAY,qBAC1B0B,EAAgB5B,SAAS,qBACzB6B,EAAoB7B,SAAS,uBAI7B0B,EAAkBxB,YAAY,qBAC9ByB,EAAczB,YAAY,qBAC1B0B,EAAgB1B,YAAY,qBAC5B2B,EAAoB3B,YAAY,uBAQ5C9J,MAAO,WACH,IACIf,EADOhB,KACSiB,aAEjBD,GACCA,EAAS0B,WAKrBzD,OAAO8L,SAASC,SAAS,uCAAwC,mBAAoB,cAAe/L,OAAOC,WAAWC,QAAQiN,YCzN9HnN,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,wCASpCC,KAAM,SAAUC,EAAkBC,EAAaiO,EAAsB5N,EAAoBC,GAC1EE,KAGNC,OAAOV,EAAkBC,EAAaM,GAHhCE,KAMNE,eACDwN,QAAWzO,OAAOmB,YAAY,4CAA4CC,OAAO,oBACjFQ,QAAW5B,OAAOmB,YAAY,4CAA4CC,OAAO,oBACjFsN,gBAAiB1O,OAAOmB,YAAY,4CAA4CC,OAAO,kBACvFuN,UAAa3O,OAAOmB,YAAY,4CAA4CC,OAAO,+BACnFwN,SAAY5O,OAAOmB,YAAY,4CAA4CC,OAAO,sBAClFmK,QAAWvL,OAAOmB,YAAY,4CAA4CC,OAAO,4BACjFyN,eAAkB7O,OAAOmB,YAAY,4CAA4CC,OAAO,6BACxF0N,YAAe9O,OAAOmB,YAAY,4CAA4CC,OAAO,2BAd9EL,KAiBNyN,qBAAuBA,EAjBjBzN,KAkBNH,mBAAqBA,GAM9Bc,cAAe,WACX,IAAIZ,EAAOC,KACPoL,EAAWrL,EAAKK,YAAY,WAIhC,OAHAL,EAAKc,QAAUuK,EAAStK,QAASkN,cAAc,IAC/CjO,EAAKkO,UAAYlO,EAAKc,QAAQe,KAAK,qCAE5B7B,EAAKc,SAMhBE,WAAY,WACR,IAEIqK,EAFOpL,KAESI,YAAY,iBAFrBJ,KAGNuM,oBACLpL,EAAE,iBAJSnB,KAIca,SAAS2D,OAAO4G,EAAStK,UAJvCd,KAKNkO,+BAMT3B,kBAAmB,WACf,IAAIxM,EAAOC,KACPgB,EAAWjB,EAAKkB,aAEpBlB,EAAKmB,IAAI,sBAAuBC,EAAEC,MAAMrB,EAAKoO,iCAAkCpO,IAC/EA,EAAKmB,IAAI,qBAAsBC,EAAEC,MAAMrB,EAAKoO,iCAAkCpO,IAC9EA,EAAKmB,IAAI,mBAAoBC,EAAEC,MAAMrB,EAAKqO,mBAAoBrO,IAC9DA,EAAKmB,IAAI,2BAA4BC,EAAEC,MAAMrB,EAAKsO,uBAAwBtO,IAC1EA,EAAKmB,IAAI,oBAAqBC,EAAEC,MAAMrB,EAAKuO,gBAAiBvO,IAC5DA,EAAKmB,IAAI,wBAAyB,SAASK,EAAIe,GAAQ,OAAOvC,EAAKwO,mBAAmBjM,KACtFvC,EAAKmB,IAAI,iCAAkC,SAASK,EAAIe,GAAQ,OAAOvC,EAAKyO,6BAA6BlM,KACzGvC,EAAKmB,IAAI,sBAAuB,SAASK,EAAIe,GAAOvC,EAAK0O,kBAAmB,EAAO1O,EAAK2O,oBAAmB,GAAO3O,EAAK4O,2BACvH5O,EAAKmB,IAAI,yBAA0B,SAASK,EAAIe,GAAOvC,EAAK2O,oBAAmB,GAAM3O,EAAK4O,2BAC1F5O,EAAKmB,IAAI,iBAAkB,SAASK,EAAIe,GAAOvC,EAAK2O,oBAAmB,KACvE3O,EAAKmB,IAAI,gBAAiB,SAASK,EAAIe,GAAO,OAAOvC,EAAK6O,aAAatM,EAAKA,KAAKiE,eAEjFvF,EAASY,KAAK,2BAA2BiN,UACzC9O,EAAKkO,UAAUpM,GAAG,QAASV,EAAEC,MAAMrB,EAAK+O,eAAgB/O,KAM5DmO,4BAA6B,WACzB,IAAInO,EAAOC,KACPgB,EAAWjB,EAAKkB,aAGpBD,EAASY,KAAK,eAAeC,GAAG,QAAS,SAAUN,GAC/CxB,EAAKgP,aAAaxN,EAAIJ,EAAEnB,SAI5BgB,EAASY,KAAK,iBAAiBC,GAAG,QAAS,SAAUN,GACjDxB,EAAKiP,gBAAgBzN,EAAIJ,EAAEnB,SAI/BgB,EAASY,KAAK,eAAeC,GAAG,QAAS,WAClC9B,EAAKkP,cAAcC,YAClBnP,EAAKoP,gBAAgBhO,EAAEnB,MAAOD,EAAKqP,WAEnCrP,EAAKwD,IAAI,UAAYC,KAAM,cAAelB,MACtC+M,YACInF,MAAOnK,EAAKkP,cAAcC,UAC1BI,UAAWvP,EAAKqP,UAChBG,WAAY,cAM5BvO,EAASY,KAAK,gBAAgBC,GAAG,QAAS,WACtC9B,EAAKwD,IAAI,UAAYC,KAAM,2BAA4BlB,MAAOyK,WAAYhN,EAAKD,OAAOiN,WAAYzC,OAAQnJ,EAAEnB,WAGhHmB,EAAE,qCAAsCH,GAAUa,GAAG,QAASV,EAAEC,MAAMrB,EAAKyP,iCAAkCzP,KAMjH4O,uBAAwB,WACpB,IAAI5O,EAAOC,KACRD,EAAK0O,kBAAoB1O,EAAK0P,gBAAkB1P,EAAK2P,iBAAmB3P,EAAK4P,eAC5E5P,EAAK6P,mBAAkB,GAGvB7P,EAAK6P,mBAAkB,IAQ/BA,kBAAmB,SAASC,GACxB,IACI7O,EADOhB,KACSiB,aACjB4O,EACC7O,EAASkG,OAGTlG,EAASmL,QAQjBuC,mBAAoB,SAASmB,GAEtBA,GADQ7P,KAEFiO,UAAUjH,QAAQ,yBAAyBE,OAFzClH,KAGF0P,iBAAkB,IAHhB1P,KAMFiO,UAAUjH,QAAQ,yBAAyBmF,OANzCnM,KAOF0P,iBAAkB,IAQ/BI,kBAAmB,SAASC,GACxB,IAAIhQ,EAAOC,KACX,GAAG+P,GAAsBA,EAAqB,EAAE,CAC5ChQ,EAAKc,QAAQ8K,SAAS,qBAEtB,IAAIqE,EAAkBjQ,EAAKkM,YAAY,6CACpC8D,EAAqB,IACpBC,EAAkBjQ,EAAKkM,YAAY,4CAEvC9K,EAAE,0BAA2BpB,EAAKc,SAASuM,KAAK2C,EAAqB,IAAMC,EAAkB,UAG7FjQ,EAAKc,QAAQgL,YAAY,sBASjCsD,gBAAiB,SAASc,EAAQC,GAEA,QAA1BA,GADOlQ,KAEFoP,UAAW,OAChBa,EAAOpE,YAAY,mCAAmCF,SAAS,sCAHxD3L,KAMFoP,UAAW,MAChBa,EAAOpE,YAAY,oCAAoCF,SAAS,qCAQxEwE,mBAAoB,SAAS1M,GACzB,IAAI1D,EAAOC,KACPoQ,EAAYjP,EAAEsC,EAAM6G,QAAQtD,QAAQ,MACpCqJ,EAAaD,EAAUhO,KAAK,QAC5B0K,EAAS/M,EAAKuQ,UAAUD,GAExBtQ,EAAKwQ,6BAA6BF,KAClCtQ,EAAKwQ,6BAA6BF,IAAc,EAEhDtQ,EAAKyQ,uBAAuBJ,GAE5BjP,EAAE+B,KAAKnD,EAAK0N,qBAAqBgD,oBAC7B3D,OAAQA,EACR4D,mBAAoB3Q,EAAK2Q,sBACzBC,OAAO,WACPP,EAAUxO,KAAK,oBAAoBiK,YAAY,iBAC/CuE,EAAUxO,KAAK,6BAA6BqF,SAC5CmJ,EAAUxO,KAAK,KAAKsF,OAEpBnH,EAAKwQ,6BAA6BF,QAAcvN,MAQ5D0N,uBAAwB,SAASI,GAC7BA,EAAQhP,KAAK,oBAAoB+J,SAAS,iBAC1CiF,EAAQhP,KAAK,oBAAoBiP,QAAQ,uEAAyEjP,KAAK,KAAKuK,QAMhIqD,iCAAkC,WAC9B,IACI/K,EADOzE,KACcuD,IAAI,UAAWC,KAAM,aAAclB,MAAOoC,OAAO,KAAS,GADxE1E,KAENuO,oBAAqBjM,MAAQmC,cAAeA,MAQrDsK,aAAc,SAAUxN,EAAIuP,GACxB,IAAI/Q,EAAOC,KACPgB,EAAWjB,EAAKkB,aAEhB4N,EADW9O,EAAKK,YAAY,YACTU,QAAQiQ,QAAShR,EAAKiR,WACzCC,aAAc,SAAUC,GACpB,OAAOA,KAGX/P,EAAE,oBAAqB2P,GAAS/M,QAChC5C,EAAE,oBAAqB2P,GAAS7J,SAGpC6J,EAAQtM,OAAOqK,GACfA,EAAQ3H,KAAK,OAAQ,WACjB2H,EAAQsC,MAAM,SAAUC,GACpBA,EAAEC,oBAENlQ,EAAEmQ,UAAUC,IAAI,QAAS,WACrB1C,EAAQ1C,KAAK,QACb0C,EAAQ5H,aAKhBjG,EAASY,KAAK,mBAAmBC,GAAG,QAAS,SAAUN,GACnD,IAAIa,EAAOjB,EAAEI,EAAGiK,eAAepJ,OAC3B6M,EAAgBlP,EAAKiR,SAAS5O,EAAKoP,OACvCxQ,EAASY,KAAK,eAAeiK,YAAY,YAEtC9L,EAAKkP,eAAiBA,IACrBlP,EAAKkP,cAAgBA,EACrB9N,EAAE,oBAAqB2P,GAAS1D,KAAKrN,EAAKkP,cAAcwC,QAAQC,MAAM,KAAKC,OAC3E5R,EAAKwD,IAAI,UAAYC,KAAM,cAAelB,MACtC+M,YACInF,MAAO+E,EAAcC,UACrBI,UAAWvP,EAAKqP,UAChBG,WAAY,YAIxBV,EAAQ1C,KAAK,WAIrB6C,gBAAiB,SAAUzN,EAAIuP,GAC3B,IAAI/Q,EAAOC,KACPgB,EAAWjB,EAAKkB,aAEhB4N,EADW9O,EAAKK,YAAY,eACTU,WAEnBK,EAAE,4BAA6B2P,GAAS/M,QACxC5C,EAAE,4BAA6B2P,GAAS7J,SAG5C6J,EAAQtM,OAAOqK,GACfA,EAAQ3H,KAAK,OAAQ,WACjB2H,EAAQsC,MAAM,SAAUC,GACpBA,EAAEC,oBAENlQ,EAAEmQ,UAAUC,IAAI,QAAS,WACrB1C,EAAQ1C,KAAK,QACb0C,EAAQ5H,aAKhBjG,EAASY,KAAK,2BAA2BC,GAAG,QAAS,SAAUN,GAE3D,IAAI0B,EAAW2O,OAAO3S,OAAO4S,KAAKC,KAAK9R,KAAK+R,cAE5C5Q,EAAE,4BAA6B2P,GAAS1D,KAAKnK,GAE7ClD,EAAKwD,IAAI,UACLC,KAAM,cAAelB,MACjBW,SAAUA,KAIlB4L,EAAQ1C,KAAK,WASrBgC,iCAAkC,SAAUiD,EAAGtR,GAC3C,IAAIC,EAAOC,KAEXD,EAAK0O,kBAAmB,EACxB1O,EAAK2O,oBAAmB,GACxB3O,EAAK4O,yBAEL5O,EAAKiS,uBACLjS,EAAKoP,gBAAgBhO,EAAE,cAAepB,EAAKc,SAAU,QACrDd,EAAKD,OAASA,EAAOwC,KACrBvC,EAAKkP,iBAELlP,EAAKkS,iBAAiBb,EAAGtR,IAM7BmS,iBAAkB,SAAU1Q,EAAIzB,GAC5B,IAAIC,EAAOC,KACPgB,EAAWjB,EAAKkB,aAChBqB,EAAOxC,EAAOwC,KACdwK,EAASxK,EAAKwK,OACdoF,EAAmBlR,EAASY,KAAK,6BACrC7B,EAAKoS,qBAAuB7P,EAAKsH,UACjCsI,EAAiBE,WAAWnL,SAC5B9F,EAAE,2BAA4BH,GAAUiG,SACxClH,EAAK4P,gBAAiB,EAClBrN,EAAKsH,WAAoC,WAAvBtH,EAAKuH,eACvBqI,EAAiBnM,cAAeC,MAAO,EAAGC,SAAS,IACnDlG,EAAKP,YAAY6S,oBAAoBvS,GAAQ6D,KAAK,SAAUvB,GACrDrC,EAAKoS,uBAAyB/P,EAAKkQ,sBACd,IAATlQ,GAAwBmQ,OAAOC,oBAAoBpQ,GAAM2B,OAAS,GAAK3B,EAAK6C,YAAc7C,EAAKqQ,IACtG1S,EAAK2S,aAAaR,EAAkB9P,KAG7CuO,OAAO,WACNuB,EAAiBtL,gBAGhBkG,GACL/M,EAAK2S,aAAaR,EAAkBpF,IAO5C4F,aAAc,SAAUR,EAAkBpF,GACtC,IAAI/M,EAAOC,KAEP2S,EADW5S,EAAKK,YAAY,aACNU,QAASgM,OAAQA,IAE3CoF,EAAiBxP,QACjBiQ,EAAW/F,SAASsF,GACpBnS,EAAK4P,gBAAiB,EACtB5P,EAAK4O,yBACLgE,EAAW9Q,GAAG,QAAS,WAAc9B,EAAK6S,eAAe9F,MAM7D8F,eAAgB,SAAU9F,GACtB,IAAI/M,EAAOC,KAEXmB,EAAE+B,KAAKnD,EAAKP,YAAYqT,YACpB5N,WAAY6H,EAAO7H,WACnB6N,mBAAoB/S,EAAKF,mBAAmBkT,eAC5CC,aAA+B,YAAhBlG,EAAOtJ,KAAsBsJ,EAAOkG,aAAe,MAClErP,KAAK,SAAUsP,GACK,YAAhBnG,EAAOtJ,KACPzD,EAAKmT,iBAAiBpG,EAAQmG,GAG9BlT,EAAKoT,cAAcrG,EAAQmG,MAQvCnE,eAAgB,SAASvN,GACrB,IAEIgG,EADUpG,EAAEI,EAAG+I,QACK9C,GAAG,YACvB/C,EAHOzE,KAGcuD,IAAI,UAAWC,KAAM,aAAclB,MAAOoC,MAAO6C,KAAa,GAH5EvH,KAKNuO,oBAAqBjM,MAAQmC,cAAeA,MAMrD8J,mBAAoB,SAAUzO,GAC1B,IAAIC,EAAOC,KACPsC,EAAOxC,EAAOwC,KACd8Q,EAAqBrT,EAAK2Q,mBAAqBpO,EAAKmC,cACpD+F,EAAUzK,EAAK6O,aAAawE,EAAmB5I,UAChDA,EAAQzG,OAAS,GAAKhE,EAAK4P,iBAC1BxO,EAAEpB,EAAKkB,cAAciG,OAEzBnH,EAAKsT,iBAAiB7I,EAAS4I,EAAoB,oBAEftQ,IAAhCsQ,EAAmBpR,UACnBjC,EAAKkO,UAAUrG,KAAK,UAAWwL,EAAmBpR,WAU1DqR,iBAAkB,SAAU7I,EAAS4I,EAAoBE,GACrD,IAAIvT,EAAOC,KACPgB,EAAWjB,EAAKkB,aAChBmK,EAAWrL,EAAKK,YAAY,WAEhCL,EAAK+P,kBAAkByC,OAAOgB,KAAKH,EAAmBzI,eAAe5G,QAErE,IAAIyP,EAAchJ,EAAQiJ,MAAM,EAAG,MAE/BC,EAAWtI,EAAStK,QAAQ0J,QAASA,EAAQiJ,MAAM,EAAG,GAAID,YAAaA,EAAaF,YAAaA,IAErGnS,EAAE,+BAAgCpB,EAAKc,SAASsB,IAAI,QAAShB,EAAEC,MAAMrB,EAAKoQ,mBAAoBpQ,IAE9FoB,EAAE,2BAA4BH,GAAUiG,SACxC9F,EAAE,8BAA+BH,GAAUwD,OAAOkP,GAElDvS,EAAE,+BAAgCpB,EAAKc,SAASgB,GAAG,QAASV,EAAEC,MAAMrB,EAAKoQ,mBAAoBpQ,IAE1FyT,EAAYzP,OAAS,IACjBhE,EAAKc,QAAQuB,KAAK,eACjBjB,EAAEpB,EAAKc,SAASgO,QAAQ,WAG5B1N,EAAEpB,EAAKc,SAASgO,SACZ8E,aAAc,+BACdC,MAAO,uBACP/S,QAASM,EAAE,wBAAyBpB,EAAKc,SAASgT,OAClDC,KAAM,SAASrQ,EAAOsQ,GAElB5S,EAAE,+BAAgC4S,EAAGlF,SAAShN,GAAG,QAASV,EAAEC,MAAMrB,EAAKoQ,mBAAoBpQ,IAE3F,IAAIiU,EAAY7S,EAAE,kBAElB,QAAoC,IAAzBsC,EAAmB,cAG1B,OADAuQ,EAAU/M,UACH,EAEX,IAAIgN,EAAM9S,EAAE4S,EAAGlF,SAASnD,KAAK,MAK7B,IAAI,IAAIwI,KAHRF,EAAUG,IAAI,IAAMF,GAAKhN,SAGAlH,EAAKwQ,6BAC1B,GAAGxQ,EAAKwQ,6BAA6B2D,GAAe,CAChD,IAAIE,EAAgBjT,EAAE,iBAAmB+S,EAAgB,KAAMH,EAAGlF,SAClE9O,EAAKyQ,uBAAuB4D,KAIxCC,MAAO,SAAS5Q,EAAOsQ,GAEnBA,EAAGlF,QAAQyF,MAAM,WAETnT,EAAEnB,MAAMuU,MAAK,GAAMC,OAAO,IAAK,IAEnC,WAEIrT,EAAEnB,MAAMyU,QAAQ,MAAO,WAEnBtT,EAAE,+BAAgCnB,MAAMmC,IAAI,QAAShB,EAAEC,MAAMrB,EAAKoQ,mBAAoBpQ,IACtFoB,EAAEnB,MAAMiH,kBAapCmH,mBAAoB,SAAU7M,EAAIzB,GAC9B,IAAIC,EAAOC,KACP0U,EAAwB5U,EAAOwC,KAAKoS,sBACpCjI,EAAe3M,EAAOwC,KAAKmK,aAG/B,GAFA1M,EAAKiR,SAAWlR,EAAOwC,KAAKqS,iBAAmB7U,EAAOwC,KAAKyO,QAAUhR,EAAKiR,SAEtElR,EAAOwC,KAAKqS,iBAAkB,CAE9B,IADA,IAAYC,EAARzQ,GAAK,EAAM0Q,EAAgB,EAAGC,EAAc,EACzCF,EAAI7U,EAAKiR,WAAW7M,IACT,QAAVyQ,EAAEpR,MAA6B,SAAXoR,EAAEpR,MAAmBoR,EAAExS,OAAUwS,EAAExS,KAAK2S,eAAiBH,EAAExS,KAAK2S,cAAchR,OAAS,GAAO6Q,EAAExS,KAAK4S,KAAOJ,EAAExS,KAAK6S,MACvIJ,IAEc,KAAdD,EAAEnD,SACFqD,IAIJrI,EAAe,GAEXoI,EAAgB,EAChB9U,EAAKmV,mBAGLnV,EAAKoV,mBAGLL,EAAc,EACd/U,EAAKqV,kBAGLrV,EAAKuO,mBAKsB,IAA1BoG,IACL3U,EAAKoV,mBACLpV,EAAKuO,mBAGbvO,EAAKsV,cAAcX,IAMvBQ,iBAAkB,WAEd/T,EAAE,eADSnB,KACYiB,cAAciG,QAMzCiO,iBAAkB,WAEdhU,EAAE,eADSnB,KACYiB,cAAckL,OAD1BnM,KAENyO,kBAAmB,EAFbzO,KAGN2O,0BAMTyG,gBAAiB,WACb,IAAIrV,EAAOC,KACXmB,EAAE,gBAAiBpB,EAAKkB,cAAciG,OACtC/F,EAAE,gBAAiBpB,EAAKkB,cAAciG,OACtC/F,EAAE,cAAepB,EAAKkB,cAAciG,OAEpCnH,EAAK0P,gBAAiB,EACtB1P,EAAK0O,kBAAmB,EACxB1O,EAAK4O,0BAMTL,gBAAiB,WACb,IACIgH,EAAenU,EAAE,cADVnB,KAC8BiB,cAGzCE,EAAE,gBAJSnB,KAIaiB,cAAckL,OAEtCmJ,EAAa3J,SAAS,YACtB2J,EAAazJ,YAAY,mCACzByJ,EAAazJ,YAAY,oCACzByJ,EAAa3J,SAAS,mCACtB2J,EAAanJ,OAVFnM,KAYNyP,gBAAiB,EAZXzP,KAaN2O,0BAMTqD,qBAAsB,WAElB7Q,EAAE,oBADSnB,KACiBiB,cAAcmM,KAD/BpN,KACyCiM,YAAY,mCAOpEuC,6BAA8B,SAAS1O,GAEhCA,EAAOwC,KAAKiT,gBADJvV,KAEFqV,cAAcvV,EAAOwC,KAAKiT,eAAexR,SAQtDsR,cAAe,SAAUG,GACrB,IACIxU,EADOhB,KACSiB,aAChBwU,EAAWtU,EAAE,2BAA4BH,GAEzCwU,EAAU,GACVC,EAAS5B,KAAK2B,GACdC,EAASvO,QAGTuO,EAAStJ,QAOjBkC,uBAAwB,WACTrO,KACN0V,eAAgB,EACrBvU,EAAE,eAFSnB,KAEYiB,cAAckL,OAF1BnM,KAGNuD,IAAI,UAAYC,KAAM,uBAAwBlB,MAAO4E,MAAQ,EAAOmD,QAAW,SAMxF6I,iBAAkB,SAAUpG,EAAQmG,GAChC,IAAIlT,EAAOC,KAEP8M,EAAO6I,YACP7I,EAAO8I,aAAe9I,EAAO6I,WAGjCxU,EAAE+B,KAAKnD,EAAK0N,qBAAqBoI,sBAC7B/I,OAAQA,EACRmG,YAAaA,KACbtP,KAAM,SAAU7D,IACZA,EAASA,SAEiC,IAA/BA,EAAOgW,qBAClB/V,EAAKgW,iBAAiBjJ,MASlCiJ,iBAAkB,SAAUjJ,GACb9M,KACNuD,IAAI,UAAYC,KAAM,sBAAuBlB,MAAOwK,OAAQA,EAAQjI,WAAW,MAMxFsO,cAAe,SAAUrG,EAAQmG,GAC7B,IAAIlT,EAAOC,KAEXmB,EAAE+B,KAAKnD,EAAK0N,qBAAqBuI,mBAC7BlJ,OAAQA,EACRmG,YAAaA,KACbtP,KAAK,SAAUvB,GACXA,EAAK+E,SACLpH,EAAKwD,IAAI,UAAYC,KAAM,2BAA4BlB,MAAQwK,OAAQA,EAAQjI,WAAW,EAAM8P,kBAAkB,QAQ9HrE,UAAW,SAAUD,GAEjB,OADWrQ,KACC0Q,mBAAmBlG,QAAQxH,OAAQ,SAAU8J,GACrD,OAAOA,EAAO2F,IAAMpC,IACrB,IAQPzB,aAAc,SAAUpE,GACpB,OAAOrJ,EAAE8U,KAAKzL,EAAS,SAAUsC,GAC7B,OAA2B,GAAvBA,EAAOoJ,cACQ,cAAfpJ,EAAOqJ,OACQ,QAAfrJ,EAAOtJ,QACPsJ,EAAOsJ,UACQ,WAAftJ,EAAOtJ,OAAqBsJ,EAAO8I,mBAQ/C7T,MAAO,WACH,IAAIhC,EAAOC,KACPgB,EAAWjB,EAAKkB,aACpBlB,EAAKwQ,gCAEDvP,IACAjB,EAAKmC,MAAM,uBACXnC,EAAKmC,MAAM,yBACXnC,EAAKmC,MAAM,sBACXnC,EAAKmC,MAAM,oBACXnC,EAAKmC,MAAM,4BACXnC,EAAKmC,MAAM,qBAEXnC,EAAKkO,UAAU9L,IAAI,SACnBnB,EAASY,KAAK,eAAeO,IAAI,SACjCnB,EAASY,KAAK,eAAeO,IAAI,SACjCnB,EAASY,KAAK,gBAAgBO,IAAI,SAClCnB,EAASY,KAAK,mBAAmBO,IAAI,SACrChB,EAAE,+BAAgCH,GAAUmB,IAAI,QAAShB,EAAEC,MAAMrB,EAAKoQ,mBAAoBpQ,IAC1FoB,EAAE,qCAAsCH,GAAUmB,IAAI,QAAShB,EAAEC,MAAMrB,EAAKyP,iCAAkCzP,QAM1Hd,OAAO8L,SAASC,SAAS,qCAAsC,mBAAoB,cAAe,uBAAwB,qBAAsB/L,OAAOC,WAAWC,QAAQuO,UCjwB1KzO,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,8CAQpCC,KAAM,SAAUC,EAAkBC,EAAaM,GAC3C,IAAIC,EAAOC,KACXD,EAAKD,OAASA,EAEdC,EAAKE,OAAOV,EAAkBC,EAAaM,GAE3CC,EAAK8C,WAAa/C,EAAO+C,WACzB9C,EAAKgK,SAAWjK,EAAOiK,SAGvBhK,EAAKG,eACDmW,cAAiBpX,OAAOmB,YAAY,kDAAkDC,OAAO,0BAC7FiW,uBAA0BrX,OAAOmB,YAAY,kDAAkDC,OAAO,mCAQ9GM,cAAe,WACX,IAAIZ,EAAOC,KACPoL,EAAWrL,EAAKK,YAAY,iBAEhC,OAAOe,EAAE+B,KAAKnD,EAAKwW,WAAW5S,KAAK,SAASvB,GACxCrC,EAAKc,QAAUuB,EAAK2B,OAAS,EAAIqH,EAAStK,QAAS0V,UAAWpU,IAAUrC,EAAKiE,sBAAsBlD,WACnGf,EAAK0W,gBAAgBtV,EAAE,0BAA2BpB,EAAKkB,kBAO/DF,WAAY,WACR,IAAIhB,EAAOC,KACXD,EAAKwM,oBAELxM,EAAKmB,IAAI,mCAAoC,WACzC,OAAOnB,EAAK2W,kBAEhB3W,EAAKmB,IAAI,iCAAkC,WACvC,OAAOnB,EAAK4W,iBAOpBpK,kBAAmB,WACf,IACIvL,EADOhB,KACSiB,aACpBE,EAAE,oBAAqBH,GAAUa,GAAG,QAASV,EAAEC,MAFpCpB,KAE+C4W,eAF/C5W,QASfuW,QAAS,WACL,IAAIxW,EAAOC,KACP6W,KACAC,EAAS/W,EAAKD,OAAOiD,MAEzB,OAAQ+T,GACJ,IAAK,WACDD,GACI9O,UAAa,MACbgP,YAAc,GAElB,MACJ,IAAK,YACDF,GACI9O,UAAa,MACbiP,cAAgB,EAChBC,eAAiB,GAErB,MACJ,IAAK,QACL,IAAK,MACL,IAAK,SACDJ,GACI9O,UAAa+O,GAIzB,OAAO/W,EAAKP,YAAY0X,gBAAgBL,GAAOpP,KAAK,SAAUrF,GAC1D,OAAOrC,EAAKoX,uBAAuB/U,MAS3C+U,uBAAwB,SAAU/U,GAK9B,IAJA,IAAIgV,EAAehV,EAAKiV,WACpBb,KACAnO,KAEKlE,EAAI,EAAGC,EAAIgT,EAAarT,OAAQI,EAAIC,EAAGD,IAE5C,IAAK,IAAImT,EAAI,EAAGC,GADhBf,EAAYY,EAAajT,GAAGqT,WACEzT,OAAQuT,EAAIC,EAAGD,IACzCjP,EAAM/D,MACFmT,QAASjB,EAAUc,GAAGI,KACtB7U,WAAY2T,EAAUc,GAAGzU,aAIrC,OAAOwF,GAOXuO,eAAgB,SAAUrV,GACtB,IAAIxB,EAAOC,KACPF,EAASb,OAAO0Y,MAAM5X,EAAKD,QAC3BuK,EAAUlJ,EAAEI,EAAG+I,QAAQtD,QAAQ,qBACnCjH,EAAK0W,gBAAgBpM,GAErBtK,EAAK8C,WAAawH,EAAQjI,KAAK,cAC/BrC,EAAKgK,SAAWM,EAAQjI,KAAK,SAE7BrC,EAAKoK,qBAAqB,UACtB3G,KAAM,sBACNlB,KAAMnB,EAAE9B,OAAOS,GACXiK,SAAUhK,EAAKgK,SACf6N,MAAO,EACP/U,WAAY9C,EAAK8C,gBAS7B6T,cAAe,WAEX,OADW1W,KACC6C,YAOhB8T,YAAa,WAET,OADW3W,KACC+J,UAOhB0M,gBAAiB,SAASoB,GAEtB1W,EAAE0W,GAAMlM,SAAS,qBAAqBC,WAAWC,YAAY,sBAOhE7H,oBAAqB,WAIlB,OAHWhE,KACuBI,YAAY,2BAQlD2B,MAAO,WACH,IACIf,EADOhB,KACSiB,aAEhBD,GACAG,EAAE,oBAAqBH,GAAUmB,IAAI,SAJ9BnC,KAONkC,MAAM,oCAPAlC,KAQNkC,MAAM,qCAInBjD,OAAO8L,SAASC,SAAS,2CAA4C,mBAAoB,cAAe/L,OAAOC,WAAWC,QAAQkX,gBAAgB","sourcesContent":["bizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.casestemplate\", {}, {\r\n    /**\r\n     * Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, actionService, casetoolbar, usersCasesService, actionsEventsService, accumulatedcontext, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"casestemplate-container\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.casestemplate\").concat(\"#casestemplate-wrapper\"),\r\n            \"casestemplate-item\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.casestemplate\").concat(\"#casestemplate-item\"),\r\n            \"casestemplate-empty-data\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.casestemplate\").concat(\"#casestemplate-empty-message\")\r\n        });\r\n\r\n        self.selectorCheckboxItems = \".casetemplate-box-check-selector input:checkbox\";\r\n        self.actionService = actionService;\r\n        self.casetoolbar = casetoolbar;\r\n        self.usersCasesService = usersCasesService;\r\n        self.actionsEventsService = actionsEventsService;\r\n        self.hasBatchActions = false;\r\n\r\n        self.sequenceCall = 0;\r\n        self.accumulatedcontext = accumulatedcontext;\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this,\r\n            templateContainer = self.getTemplate(\"casestemplate-container\");\r\n\r\n        self.content = templateContainer.render({});\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        self.sub(\"CASES-TEMPLATE-VIEW\", $.proxy(self.updateCases, self));\r\n        self.sub(\"UPDATE-DATATEMPLATE-VIEW\", $.proxy(self.updateCases, self));\r\n        self.sub(\"GET-COMMON-ACTIONS\", $.proxy(self.getCommonActions, self));\r\n        self.sub(\"SET-RECORDS\", $.proxy(self.updateCases, self));\r\n        self.sub(\"SET-VALUES\", function (ev, params) { return self.setValues(params) });\r\n        self.actionService.subscribe(\"onFormActionExecuted\", $.proxy(self.onFormActionExecuted, self));\r\n        self.actionService.subscribe(\"onFormRuleExecuted\", $.proxy(self.onFormRuleExecuted, self));\r\n        $content.find(\"#casestemplate-dataviewer-list\").on(\"click\", self.selectorCheckboxItems, $.proxy(self.onCaseChecked, self));\r\n    },\r\n\r\n    /**\r\n     * Detach events\r\n     */\r\n    clean: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        self.checkAll = false;\r\n        self.sequenceCall = 0;\r\n\r\n        if ($content) {\r\n            self.actionService.unsubscribe(\"onFormActionExecuted\");\r\n            self.actionService.unsubscribe(\"onFormRuleExecuted\");\r\n            self.unsub(\"CASES-TEMPLATE-VIEW\");\r\n            self.unsub(\"UPDATE-DATATEMPLATE-VIEW\");\r\n            self.unsub(\"GET-COMMON-ACTIONS\");\r\n            self.sub(\"SET-VALUES\");\r\n            $content.find(\"#casestemplate-dataviewer-list\").off(\"click\", self.selectorCheckboxItems);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Updates the cases list\r\n     */\r\n    updateCases : function(ev, data){\r\n        var self = this,\r\n            args = data.args,\r\n            defer = new $.Deferred(),\r\n            $dataViewList = $(\"#casestemplate-dataviewer-list\", self.getContent());\r\n\r\n        $dataViewList.empty();\r\n        self.actionService.init();\r\n        self.casesSelected = {};\r\n        self.sequenceCall++;\r\n\r\n        self.page = args.page || self.page;\r\n        self.idworkflow = (args.idworkflow == undefined) ? self.idworkflow : args.idworkflow;\r\n        self.route = args.route || self.route;\r\n        self.filter = args.filter || self.filter;\r\n        self.pageSize = args.pageSize || self.pageSize;\r\n\r\n        (function (sequence) {\r\n            $.when(self.getCasesData({ page: self.page, idworkflow: self.idworkflow, pageSize: self.pageSize }))\r\n                .pipe(function (casesData) {\r\n                    if (self.sequenceCall !== sequence) {\r\n                        defer.resolve();\r\n                        return null;\r\n                    }\r\n                    self.pub(\"notify\", { type: \"PAGINATOR-UPDATE\", args: $.extend(args, casesData, { event: data.type }) });\r\n                    return self.getCasesTemplates(casesData);\r\n                })\r\n                .done(function (templates) {\r\n                    if(templates !== null){\r\n                        var casesLength = self.casesLength = templates.length,\r\n                            templateString = casesLength > 0 ? \"\" : self.getEmptyDataMessage(),\r\n                            $templateCase = null,\r\n                            $elementsTmpl = $();\r\n\r\n                        self.hasBatchActions = false;\r\n                        for (var i = 0, l = templates.length; i < l; i++) {\r\n                            if (self.sequenceCall !== sequence) {\r\n                                defer.resolve();\r\n                                return;\r\n                            }\r\n                            $templateCase = self.renderCase(templates[i], false, sequence);\r\n                            $elementsTmpl.push.apply($elementsTmpl, $templateCase);\r\n                        }\r\n                        if (!self.hasBatchActions) {\r\n                            self.pub(\"notify\", {\r\n                                type: \"HIDE-CHECK-ALL\",\r\n                                args: {}\r\n                            });\r\n                        }\r\n\r\n                        if ($elementsTmpl.length > 0) {\r\n                            $dataViewList.append($elementsTmpl);\r\n                        }\r\n                        else {\r\n                            $dataViewList.append(templateString);\r\n                        }\r\n\r\n                        self.checkAll = false;\r\n\r\n                        self.pub(\"notify\", { type: \"ENABLE-BATCHS-ACTIONS\", args: { commonActions: self.setValues({ args: { value: self.checkAll } }) } });\r\n                        defer.resolve(templates);\r\n                    }\r\n\r\n                });\r\n        })(self.sequenceCall);\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * Renders the case with the decorators related\r\n     * actions events and images\r\n     */\r\n    renderCase : function(caseData, isRefresh, sequence){\r\n        var self = this,\r\n            actionData = caseData.actionData,\r\n            idCase = actionData.idCase,\r\n            surrogateKey = actionData.surrogateKey,\r\n            guidEntity = actionData.guidEntity,\r\n            templateCase = self.getTemplate(\"casestemplate-item\"),\r\n            security = new bizagi.workportal.command.security(self.dataService);\r\n        var $templateCase = templateCase.render({\r\n            idCase: idCase,\r\n            guidEntity: guidEntity,\r\n            surrogateKey: surrogateKey\r\n        });\r\n\r\n        $templateCase.find(\"#template\").append(caseData.tmpl);\r\n\r\n        $.when(security.checkSecurityPerm(\"GraphicQuery\")).done(function(graphicQuery){\r\n            caseData.casetoolbarData[\"graphicQuery\"] = graphicQuery;\r\n             // Set header\r\n            setTimeout(function () {\r\n                var $casetoolbar = self.casetoolbar.getCaseToolbar({ casetoolbarData: $.extend(caseData.casetoolbarData, {referrer: \"CasesTemplate\"}) });\r\n                var $case = self.getContent().find(\"#casetemplate-box-wrapper-\" + idCase + \" .casetemplate-box-element\");\r\n\r\n                if (sequence === self.sequenceCall) {\r\n                    $case.append($casetoolbar);\r\n                }\r\n            }, 0);\r\n        });\r\n\r\n        // Get Actions and events\r\n        setTimeout(function () {\r\n            var $footer = self.getContent().find(\"#casetemplate-box-wrapper-\" + idCase + \" .casetemplate-box-footer\");\r\n\r\n            $footer.startLoading({ delay: 0, overlay: true });\r\n            $.when(self.actionService.getActionsView({\r\n                    actionData: caseData.actionData,\r\n                    loadEvents: true,\r\n                    isRefresh: isRefresh\r\n                }))\r\n                .done(function (responseActions) {\r\n                    var $actionsView = responseActions.actionsView;\r\n                    var actionsData = responseActions.actionsData;\r\n\r\n                    // Get the batch actions in the actionsData array\r\n                    var batchActions = actionsData.length === 0 ? [] : self.pub(\"notify\", {\r\n                        type: \"BATCH-ACTIONS\",\r\n                        args: {actionsData: actionsData}\r\n                    })[0];\r\n                    var $case = self.getContent()\r\n                        .find(\"#casetemplate-box-wrapper-\" + idCase + \" .casetemplate-box-element .casetemplate-box-footer\");\r\n                    if ($actionsView && (sequence === self.sequenceCall)) {\r\n                        $case.append($actionsView);\r\n\r\n                        // Show cases checboxes and check all checkbox if there are batch actions\r\n                        if(batchActions.length > 0 && self.getCheckBox($case).data(\"surrogatekey\") != -1){\r\n                            self.hasBatchActions = true;\r\n                            self.showCheckItem($case);\r\n                            self.pub(\"notify\", {\r\n                                type: \"SOME-ITEM-ALLOW-SELECT\",\r\n                                args: {}\r\n                            });\r\n                        }\r\n                        else{\r\n                            self.removeCheckItem($case);\r\n                        }\r\n                    }\r\n                    else{\r\n                        self.removeCheckItem($case);\r\n                    }\r\n                    $footer.endLoading();\r\n                });\r\n        }, 0);\r\n        // Get cases assignees\r\n        setTimeout(function () {\r\n            $.when(self.usersCasesService.getAssignees(idCase))\r\n                .done(function ($assignees) {\r\n                    if ($assignees && (sequence === self.sequenceCall)) {\r\n                        var $case = self.getContent()\r\n                            .find(\"#casetemplate-box-wrapper-\" + idCase + \" .casetemplate-box-element .casetemplate-box-footer\");\r\n                        $case.append($assignees);\r\n                    }\r\n                });\r\n        }, 0);\r\n        \r\n        return $templateCase;\r\n    },\r\n\r\n    /**\r\n     * Get check item by case\r\n     * @param $item\r\n     */\r\n    getCheckBox: function($item){\r\n        var self = this;\r\n        return $item.closest(\".casetemplate-box-element\").find(self.selectorCheckboxItems);\r\n    },\r\n\r\n    /**\r\n     * Hide check item\r\n     * @param $item\r\n     */\r\n    removeCheckItem: function($item){\r\n        var self = this;\r\n        self.getCheckBox($item).remove();\r\n    },\r\n\r\n    /**\r\n     * Show checkbox\r\n     * @param $item\r\n     */\r\n    showCheckItem: function($item){\r\n        var self = this;\r\n        self.getCheckBox($item).show();\r\n    },\r\n\r\n    /**\r\n     * Process action was executed\r\n     */\r\n    onFormActionExecuted : function(ev, data){\r\n        var self = this;\r\n        data = data || {};\r\n\r\n        if (data.refresh) {\r\n            self.refreshCase(data.idCase);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Process action was executed\r\n     */\r\n    onFormRuleExecuted: function (ev, data) {\r\n        var self = this;\r\n        data = data || {};\r\n\r\n        if (data.refresh) {\r\n            self.refreshCase(data.idCase);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Refresh the case with the new data\r\n     */\r\n    refreshCase: function (idCase) {\r\n        var self = this;\r\n\r\n        var idBox = \"#casetemplate-box-wrapper-\" + idCase;\r\n        var $templateBox = $(idBox);\r\n        var isChecked = $templateBox\r\n            .find(\".casetemplate-box-check-selector > input\")\r\n            .is(\":checked\");\r\n\r\n        $templateBox.startLoading({ delay: 250, overlay: true });\r\n\r\n        $.when(self.getCasesData({ idCase: idCase }))\r\n            .then(function (caseData) {\r\n                return self.getCasesTemplates(caseData, true);\r\n            })\r\n            .done(function (caseTemplate) {\r\n                \r\n                var $templateCase = null;\r\n\r\n                if (caseTemplate[0] != undefined && caseTemplate[0] != null) {\r\n                    $templateCase = self.renderCase(caseTemplate[0], true, self.sequenceCall);\r\n                    $templateBox.replaceWith($templateCase);\r\n                }\r\n\r\n                $templateBox.endLoading();\r\n\r\n                // Restore checked value\r\n                if (isChecked) {\r\n                    $templateBox = $(idBox);\r\n                    $templateBox.find(\".casetemplate-box-check-selector > input\").prop(\"checked\", true);\r\n                }\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Gets the data related with the cases\r\n     */\r\n    getCasesData: function (params) {\r\n        var self = this;\r\n\r\n        if (self.route == \"following\") {\r\n            return self.dataService.getActivitiesData(params);\r\n        }\r\n\r\n        if (self.route == \"pendings\") {\r\n            return self.dataService.getPendingsData(params);\r\n        }\r\n\r\n        if ( self.route == \"Green\" ||\r\n            self.route == \"Yellow\" ||\r\n            self.route == \"Red\" ) {\r\n            $.extend(params, { taskState: self.route });\r\n            return self.dataService.getPendingsData(params);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Invokes the template engine, to gets the custom columns\r\n     */\r\n    getCasesTemplates : function(casesData, refreshCase){\r\n        var self = this,\r\n            result = [],\r\n            defer = new $.Deferred();\r\n\r\n            $.when(self.getTemplateEngine())\r\n                .then(function (engine) {\r\n                    return $.when.apply($, $.map(casesData.entities, function (cases) {\r\n                        return engine.render(cases);\r\n                    }));\r\n                })\r\n                .done(function () {\r\n                    var casesTemplates = $.makeArray(arguments),\r\n                        idCases = [],\r\n                        cases = casesData.entities.length;\r\n\r\n                    for (var i = 0; i < cases; i++) {\r\n                        var tmpl = (cases === 1) ? casesTemplates[i] : casesTemplates[i][0];\r\n                        var caseData = casesData.entities[i];\r\n                        result.push({\r\n                            tmpl: tmpl,\r\n                            casetoolbarData: {\r\n                                guidFavorite: casesData.entities[i].guidFavorite,\r\n                                idcase: casesData.entities[i].idCase,\r\n                                idWorkflow: casesData.entities[i].idWorkflow,\r\n                                radNumber: casesData.entities[i].radNumber || casesData.entities[i].idCase\r\n                            },\r\n                            actionData: {\r\n                                guidEntity: caseData.guid,\r\n                                idCase: caseData.idCase,\r\n                                radNumber: caseData.radNumber,\r\n                                surrogateKey: caseData.surrogateKey\r\n                            }\r\n                        });\r\n                        idCases.push(caseData.idCase);\r\n                    }\r\n\r\n                    if (!refreshCase) {\r\n                        self.usersCasesService.render(idCases);\r\n                        self.actionsEventsService.render(idCases);\r\n                    }\r\n\r\n                    defer.resolve(result);\r\n                });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     *  returns an instance of  the template engine\r\n     */\r\n    getTemplateEngine: function () {\r\n        var self = this;\r\n\r\n        if (self.templateEngine) {\r\n            return self.templateEngine;\r\n        }\r\n\r\n        var params = {};\r\n\r\n        params.proxyPrefix = bizagi.RPproxyPrefix;\r\n        var renderDataService = new bizagi.render.services.service(params),\r\n            renderFactory = new bizagi.rendering.desktop.factory(renderDataService),\r\n            defer = new $.Deferred();\r\n\r\n        $.when(renderFactory.initAsyncStuff())\r\n            .done(function () {\r\n                self.templateEngine = new bizagi.templateEngine({ renderFactory: renderFactory, cache: true, forcePersonalizedColumns: true });\r\n                self.templateEngine.subscribe(\"onLoadDataNavigation\", function (ev, params) {\r\n                    var data = params.data || {};\r\n                    var args = {\r\n                        reference: data.reference,\r\n                        surrogateKey: data.surrogateKey,\r\n                        referenceType: data.referenceType,\r\n                        fromActionLauncher: false,\r\n                        histName: data.displayName,\r\n                        guidEntityCurrent: data.guidEntityCurrent,\r\n                        page: 1\r\n                    };\r\n\r\n                    if (typeof data.xpath !== \"undefined\" && data.xpath) {\r\n                        args.xpath = data.xpath;\r\n                    }\r\n\r\n                    self.accumulatedcontext.clean();\r\n                    self.pubDeadLockDetection(\"notify\", {\r\n                        type: \"TEMPLATEENGINE-VIEW\",\r\n                        args: args\r\n                    });\r\n                });\r\n                defer.resolve(self.templateEngine);\r\n            });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * Gets Message when there aren\"t data\r\n     */\r\n    getEmptyDataMessage: function () {\r\n        var self = this;\r\n        var casestemplateEmptyData = self.getTemplate(\"casestemplate-empty-data\");\r\n\r\n        return casestemplateEmptyData.render()[0].outerHTML;\r\n    },\r\n\r\n    /**\r\n     * Handler to hold the cases selected\r\n     */\r\n    onCaseChecked: function (ev) {\r\n        var self = this,\r\n            $target = $(ev.target),\r\n            surrogateKey = $target.data(\"surrogatekey\"),\r\n            idCase = $target.data(\"idcase\"),\r\n            guidEntity = $target.data(\"guidentity\"),\r\n            isChecked = $target.is(\":checked\");\r\n\r\n        self.casesSelected[idCase] = {\r\n            surrogateKey: surrogateKey,\r\n            guidEntity: guidEntity,\r\n            idCase: idCase\r\n        };\r\n\r\n        if (!isChecked) {\r\n            delete self.casesSelected[idCase];\r\n        }\r\n        self.pub(\"notify\", { type: \"ENABLE-BATCHS-ACTIONS\", args: { commonActions: self.getCommonActions() } });\r\n\r\n    },\r\n\r\n    /**\r\n     * Returns the common actions in the set of data\r\n     */\r\n    getCommonActions: function () {\r\n        var self = this,\r\n            model = {};\r\n\r\n        model.actions = self.actionService.getCommonActions(self.casesSelected);\r\n        model.surrogateKeys = [];\r\n        model.parentsid = [];\r\n\r\n        for (var idcase in self.casesSelected) {\r\n            var data = self.casesSelected[idcase];\r\n            if (data.surrogateKey !== -1) {\r\n                model.surrogateKeys.push(data.surrogateKey);\r\n                model.parentsid.push(data.idCase);\r\n            }\r\n        }\r\n\r\n        model.guidEntity = (idcase !== undefined) ? self.casesSelected[idcase].guidEntity : \"\";\r\n\r\n        if (model.surrogateKeys.length == 0) {\r\n            self.checkAll = false;\r\n            model.checkAll = false;\r\n        }\r\n        else if (model.surrogateKeys.length == self.casesLength) {\r\n            self.checkAll = true;\r\n            model.checkAll = true;\r\n        }\r\n\r\n        model.itemsSelected = self.casesSelected;\r\n\r\n        return model;\r\n    },\r\n\r\n    /**\r\n     * Set current value\r\n     */\r\n    setValues: function (params) {\r\n        var self = this,\r\n            $content = self.getContent(),\r\n            args = params.args || {},\r\n            isChecked = args.value;\r\n\r\n        if ($content) {\r\n            self.casesSelected = {};\r\n            var $inputs = $content.find(self.selectorCheckboxItems);\r\n            $.map($inputs, function (input) {\r\n                $(input).prop(\"checked\", isChecked);\r\n\r\n                if (isChecked) {\r\n                    var surrogateKey = $(input).data(\"surrogatekey\"),\r\n                        idCase = $(input).data(\"idcase\"),\r\n                        guidentity = $(input).data(\"guidentity\");\r\n\r\n                    self.casesSelected[idCase] = {\r\n                        surrogateKey: surrogateKey,\r\n                        guidEntity: guidentity,\r\n                        idCase: idCase\r\n                    };\r\n                }\r\n            });\r\n\r\n            self.checkAll = isChecked;\r\n\r\n            return self.getCommonActions();\r\n        }\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.casestemplate\", [\"workportalFacade\", \"dataService\", \"actionService\", \"casetoolbar\", \"usersCasesService\", \"actionsEventsService\", \"accumulatedcontext\", bizagi.workportal.widgets.casestemplate]);\r\n","/**\r\n *   Name: Bizagi Workportal Desktop Filter Cases Widget\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.filtercases\", {}, {\r\n\r\n    /**\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.lastIdworkflow;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"filtercases\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.filtercases\").concat(\"#filtercases-wrapper\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function (event, params) {\r\n        var self = this;\r\n        var template = self.getTemplate(\"filtercases\");\r\n        self.content = template.render({});\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function (event, params) {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        $(\"li.ui-bizagi-wp-app-inbox-tab\", $contentWidget).on(\"click\", $.proxy(self.onClickButtonFilter, self));\r\n        self.sub(\"CASES-TEMPLATE-VIEW\", $.proxy(self.updateUI, self));\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     */\r\n    onClickButtonFilter: function(event){\r\n        var self = this;\r\n        var $target = $(event.currentTarget);\r\n\r\n        if(!$target.hasClass(\"active\")){\r\n            var auxDescriptionColorResourceName = \"workportal-widget-inboxcommon-filter-\";\r\n            var route = $target.attr(\"id\");\r\n            var idworkflow = self.pub(\"notify\", { type: \"GETIDWORKFLOW_FROM_PROCESSESLIST\"})[0];\r\n            var histName;\r\n\r\n            $target.addClass(\"active\").siblings().removeClass(\"active\");\r\n\r\n            if(route === \"pendings\"){\r\n                histName = self.pub(\"notify\", { type: \"GETHISTNAME_FROM_PROCESSESLIST\"})[0];\r\n            }\r\n            else{\r\n                var resourceLocalization = auxDescriptionColorResourceName + route.toLowerCase();\r\n                histName = bizagi.localization.getResource(resourceLocalization);\r\n            }\r\n\r\n            self.lastIdworkflow = idworkflow;\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"CASES-TEMPLATE-VIEW\",\r\n                args : {\r\n                    histName: histName,\r\n                    page: 1,\r\n                    refreshLastItemBreadcrumb: false,\r\n                    route : route,\r\n                    idworkflow : idworkflow || \"\"\r\n                }\r\n            });\r\n\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateUI: function(event, params){\r\n        var self = this;\r\n\r\n        if(params.args.route === \"following\"){\r\n            $(self.content).hide();\r\n        }\r\n        else{\r\n            $(self.content).show();\r\n        }\r\n        if(params.args.idworkflow != (self.lastIdworkflow || \"\")){\r\n            $(\".ui-bizagi-wp-app-inbox-tab:first-child\").addClass(\"active\").siblings().removeClass(\"active\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    clean: function(){\r\n        var self = this;\r\n        self.unsub(\"CASES-TEMPLATE-VIEW\");\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.filtercases\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.filtercases]);","/**\r\n * Name: Bizagi Workportal Desktop Paginator Controller\r\n * Author: Mauricio Sánchez\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.paginator\", {}, {\r\n\r\n    /**\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"paginator\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.paginator\").concat(\"#paginator-wrapper\"),\r\n            \"content\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.paginator\").concat(\"#paginator-content\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var hide = self.params.referenceType === \"ENTITY\";\r\n        var template = self.getTemplate(\"paginator\" + self.getSuffixWidget());\r\n        self.content = template.render({hide:hide});\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        self.sub(\"PAGINATOR-UPDATE\", $.proxy(self.updateView, self));\r\n        self.configureHandlers();\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @returns {string}\r\n     */\r\n    getSuffixWidget: function(){\r\n        return \"\";\r\n    },\r\n\r\n    /**\r\n     * Updates la view with the data related to entity:\r\n     * Name entity\r\n     * Number of records\r\n     * Number of pages\r\n     * */\r\n    updateView: function (ev, params) {\r\n        var self = this;\r\n        var args = params.args;\r\n        var hide = args.referenceType === \"ENTITY\";\r\n        var $content = self.getContent();\r\n\r\n        self.setModel(args);\r\n        $content.empty();\r\n\r\n        if (args.fromActionLauncher){\r\n            if (self.totalRecords > 1) {\r\n                renderTemplate();\r\n            }\r\n            else {\r\n                self.clean();\r\n            }\r\n        }\r\n        else {\r\n            renderTemplate();\r\n        }\r\n\r\n        /**\r\n         *\r\n         */\r\n        function renderTemplate( ){\r\n            var contentTemplate = self.getTemplate(\"content\" + self.getSuffixWidget());\r\n\r\n            contentTemplate.render({\r\n                totalRecords: self.totalRecords,\r\n                totalPages: self.totalPages,\r\n                displayName: self.displayName,\r\n                currentPage: self.currentPage,\r\n                hide: hide\r\n            }).appendTo($content);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Builds the navigation model\r\n     */\r\n    setModel: function (args) {\r\n        var self = this;\r\n\r\n        self.totalRecords = typeof(args.totalRecords) == \"undefined\" ?  self.totalRecords : args.totalRecords;\r\n        self.totalPages = args.totalPages || self.totalPages;\r\n        self.displayName = args.histName || self.displayName;\r\n        self.currentPage = args.currentPage || self.currentPage;\r\n        self.action = args.action;\r\n        self.reference = args.reference || self.reference;\r\n        self.surrogateKey = args.surrogateKey || self.surrogateKey;\r\n        self.referenceType = args.referenceType;\r\n        self.event = args.event;\r\n        self.guidSearch = args.guidSearch;\r\n    },\r\n\r\n    /**\r\n     *  Gets the current model\r\n     */\r\n    getModel: function () {\r\n        var self = this;\r\n\r\n        return {\r\n            page: self.currentPage,\r\n            totalRecords: self.totalRecords,\r\n            action: self.action,\r\n            reference: self.reference,\r\n            surrogateKey: self.surrogateKey,\r\n            referenceType: self.referenceType,\r\n            stopNavigation : true,\r\n            guidSearch: self.guidSearch\r\n        };\r\n    },\r\n\r\n    /**\r\n     *  Binds events to handles\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        $content.on(\"click\", $.proxy(self.onPageBreak, self));\r\n    },\r\n\r\n    /**\r\n     * This event get a new page\r\n     */\r\n    onPageBreak: function (ev) {\r\n        var self = this,\r\n            $target = $(ev.target),\r\n            $content = self.getContent();\r\n\r\n        if ($target.hasClass(\"control-icon\") && !$target.hasClass(\"ui-state-disabled\")) {\r\n            var type = $target.data(\"type\");\r\n\r\n            if (type == \"forward\") {\r\n                self.currentPage += 1;\r\n            }\r\n            else if (type == \"rewind\") {\r\n                self.currentPage -= 1;\r\n            }\r\n            else if (type == \"fastrewind\") {\r\n                self.currentPage = 1;\r\n            }\r\n            else {\r\n                self.currentPage = self.totalPages;\r\n            }\r\n\r\n            self.disabledPaginatorButtonsByLimits();\r\n            $content.find(\".paginator-controls__currentPage\").text(self.currentPage);\r\n\r\n            self.pub(\"notify\", { type: \"UPDATE-DATATEMPLATE-VIEW\", args: self.getModel() });\r\n        }\r\n    },\r\n\r\n    disabledPaginatorButtonsByLimits: function (){\r\n        var self = this;\r\n        var $buttonFastRewind = $(\"[data-type='fastrewind']\", self.content);\r\n        var $buttonRewind = $(\"[data-type='rewind']\", self.content);\r\n        var $buttonFordward = $(\"[data-type='forward']\", self.content);\r\n        var $buttonFastFordward = $(\"[data-type='fastforward']\", self.content);\r\n\r\n        if(self.totalPages === 1){\r\n            $buttonFastRewind.addClass(\"ui-state-disabled\");\r\n            $buttonRewind.addClass(\"ui-state-disabled\");\r\n            $buttonFordward.addClass(\"ui-state-disabled\");\r\n            $buttonFastFordward.addClass(\"ui-state-disabled\");\r\n        }else{\r\n            // The first page\r\n            if(self.currentPage === 1){\r\n                $buttonFastRewind.addClass(\"ui-state-disabled\");\r\n                $buttonRewind.addClass(\"ui-state-disabled\");\r\n                $buttonFordward.removeClass(\"ui-state-disabled\");\r\n                $buttonFastFordward.removeClass(\"ui-state-disabled\");\r\n            }\r\n            // the last page\r\n            else if(self.currentPage === self.totalPages){\r\n                $buttonFastRewind.removeClass(\"ui-state-disabled\");\r\n                $buttonRewind.removeClass(\"ui-state-disabled\");\r\n                $buttonFordward.addClass(\"ui-state-disabled\");\r\n                $buttonFastFordward.addClass(\"ui-state-disabled\");\r\n            }\r\n            // other page\r\n            else{\r\n                $buttonFastRewind.removeClass(\"ui-state-disabled\");\r\n                $buttonRewind.removeClass(\"ui-state-disabled\");\r\n                $buttonFordward.removeClass(\"ui-state-disabled\");\r\n                $buttonFastFordward.removeClass(\"ui-state-disabled\");\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    clean: function(){\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        if($content){\r\n            $content.empty();\r\n        }\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.paginator\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.paginator]);","/**\r\n * Name: Bizagi Workportal Desktop Sort Bar Controller\r\n * Author: Danny Gonzalez\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.sortbar\", {}, {\r\n    /**\r\n     * Constructor\r\n     * @param workportalFacade\r\n     * @param dataService\r\n     * @param processActionService\r\n     * @param accumulatedcontext\r\n     * @param params\r\n     */\r\n    init: function (workportalFacade, dataService, processActionService, accumulatedcontext, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"sortbar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-wrapper\"),\r\n            \"content\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-content\"),\r\n            \"right-content\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-right\"),\r\n            \"addButton\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-content-add-button\"),\r\n            \"sortMenu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-sort-menu\"),\r\n            \"actions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-content-actions\"),\r\n            \"recordsPerPage\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-records-per-page\"),\r\n            \"recordsMenu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.sortbar\").concat(\"#sortbar-records-menu\")\r\n        });\r\n\r\n        self.processActionService = processActionService;\r\n        self.accumulatedcontext = accumulatedcontext;\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"sortbar\");\r\n        self.content = template.render({ enableFilter: true });\r\n        self.$checkAll = self.content.find(\".sortbar-left-check-uncheck input\");\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        var template = self.getTemplate(\"right-content\");\r\n        self.configureHandlers();\r\n        $(\".sortbar-right\", self.content).append(template.render());\r\n        self.configureAfterPaintHandlers();\r\n    },\r\n\r\n    /**\r\n     * Binds events to handles\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        self.sub(\"TEMPLATEENGINE-VIEW\", $.proxy(self.initializeAndProcessFilterButton, self));\r\n        self.sub(\"SEARCH-ENGINE-VIEW\", $.proxy(self.initializeAndProcessFilterButton, self));\r\n        self.sub(\"SET-FILTERS-DATA\", $.proxy(self.setFiltersSortData, self));\r\n        self.sub(\"HIDE-FILTER-BUTTONANDBAR\", $.proxy(self.hideFilterButtonAndBar, self));\r\n        self.sub(\"HIDE-SORT-BUTTONS\", $.proxy(self.hideSortButtons, self));\r\n        self.sub(\"ENABLE-BATCHS-ACTIONS\", function(ev, args) { return self.enableBatchActions(args);});\r\n        self.sub(\"UPDATE-COUNTER-FILTERS-APPLIED\", function(ev, args) { return self.updateCounterByFilterApplied(args); });\r\n        self.sub(\"CASES-TEMPLATE-VIEW\", function(ev, args){ self.showingFiltering = false; self.setVisibleCheckAll(false);self.behaviorVisibleSortbar(); });\r\n        self.sub(\"SOME-ITEM-ALLOW-SELECT\", function(ev, args){ self.setVisibleCheckAll(true);self.behaviorVisibleSortbar(); });\r\n        self.sub(\"HIDE-CHECK-ALL\", function(ev, args){ self.setVisibleCheckAll(false); });\r\n        self.sub(\"BATCH-ACTIONS\", function(ev, args){ return self.validActions(args.args.actionsData); });\r\n\r\n        $content.find(\".wgd-sortbar-add-button\").tooltip();\r\n        self.$checkAll.on(\"click\", $.proxy(self.onCheckUncheck, self));\r\n    },\r\n\r\n    /**\r\n     * Configure Handlers\r\n     */\r\n    configureAfterPaintHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        // Show sort menu\r\n        $content.find(\".right-menu\").on(\"click\", function (ev) {\r\n            self.showSortMenu(ev, $(this));\r\n        });\r\n\r\n        // Show records menu\r\n        $content.find(\".records-menu\").on(\"click\", function (ev) {\r\n            self.showRecordsMenu(ev, $(this));\r\n        });\r\n\r\n        // Change sort type\r\n        $content.find(\".sortbar-az\").on(\"click\", function () {\r\n            if(self.sortSelection.attribute) {\r\n                self.setIconSortType($(this), self._sortType);\r\n\r\n                self.pub(\"notify\", { type: \"SET-ORDERBY\", args: {\r\n                    properties:{\r\n                        xpath: self.sortSelection.attribute,\r\n                        orderType: self._sortType,\r\n                        typeSearch: \"none\"\r\n                    }\r\n                }});\r\n            }\r\n        });\r\n        // Show filter bar\r\n        $content.find(\".filter-icon\").on(\"click\", function () {\r\n            self.pub(\"notify\", { type: \"OPENCLOSE-MYSEARCHFILTER\", args: {guidSearch: self.params.guidSearch, target: $(this) }});\r\n        });\r\n\r\n        $(\".remove-selected-items-collections\", $content).on(\"click\", $.proxy(self.onRemoveSelectedItemsCollections, self));\r\n    },\r\n\r\n    /**\r\n     * Behavior visible sortbar\r\n     */\r\n    behaviorVisibleSortbar: function(){\r\n        var self = this;\r\n        if(self.showingFiltering || self.showingSorting || self.showingCheckAll || self._haveAddButton){\r\n            self.setVisibleSortbar(true);\r\n        }\r\n        else{\r\n            self.setVisibleSortbar(false);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Shor or hide sortbar\r\n     * @param visible\r\n     */\r\n    setVisibleSortbar: function(visible){\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        if(visible){\r\n            $content.show();\r\n        }\r\n        else{\r\n            $content.hide();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show or hide check input (select all)\r\n     * @param visible\r\n     */\r\n    setVisibleCheckAll: function(visible){\r\n        var self = this;\r\n        if(visible){\r\n            self.$checkAll.closest(\".border-check-uncheck\").show();\r\n            self.showingCheckAll = true;\r\n        }\r\n        else{\r\n            self.$checkAll.closest(\".border-check-uncheck\").hide();\r\n            self.showingCheckAll = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show number items selected from data items (from casetemplate or entityTemplates)\r\n     * @param numberCheckedItems\r\n     */\r\n    showSelectedItems: function(numberCheckedItems){\r\n        var self = this;\r\n        if(numberCheckedItems && numberCheckedItems > 0){\r\n            self.content.addClass(\"there-are-actions\");\r\n\r\n            var keywordSelected = self.getResource(\"workportal-general-word-selected-singular\");\r\n            if(numberCheckedItems > 1){\r\n                keywordSelected = self.getResource(\"workportal-general-word-selected-plural\");\r\n            }\r\n            $(\".actions-count-selected\", self.content).text(numberCheckedItems + \" \" + keywordSelected + \" \");\r\n        }\r\n        else{\r\n            self.content.removeClass(\"there-are-actions\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Set icon descending or ascending\r\n     * @param button represents icon ascending or descending\r\n     * @param sortTypeBeforeChanged\r\n     */\r\n    setIconSortType: function(button, sortTypeBeforeChanged){\r\n        var self = this;\r\n        if (sortTypeBeforeChanged === \"asc\") {\r\n            self._sortType =\"desc\";\r\n            button.removeClass(\"bz-icon-order-ascendant-outline\").addClass(\"bz-icon-order-descendant-outline\");\r\n        }\r\n        else {\r\n            self._sortType =\"asc\";\r\n            button.removeClass(\"bz-icon-order-descendant-outline\").addClass(\"bz-icon-order-ascendant-outline\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     */\r\n    onClickBatchAction: function(event){\r\n        var self = this;\r\n        var $buttonLI = $(event.target).closest(\"li\");\r\n        var guidAction = $buttonLI.data(\"guid\");\r\n        var action = self.getAction(guidAction);\r\n\r\n        if(!self.requestsInProgressActionGuid[guidAction]){\r\n            self.requestsInProgressActionGuid[guidAction] = true;\r\n\r\n            self.addLoadingButtonAction($buttonLI);\r\n\r\n            $.when(self.processActionService.executeBatchAction({\r\n                action: action,\r\n                commonActionsmodel: self.commonActionsmodel\r\n            })).always(function(){\r\n                $buttonLI.find(\".wdg-tple-button\").removeClass(\"state-loading\");\r\n                $buttonLI.find(\".ui-bizagi-loading-button\").remove();\r\n                $buttonLI.find(\"i\").show();\r\n\r\n                self.requestsInProgressActionGuid[guidAction] = undefined;\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Add loading to button\r\n     */\r\n    addLoadingButtonAction: function($button){\r\n        $button.find(\".wdg-tple-button\").addClass(\"state-loading\");\r\n        $button.find(\".wdg-tple-button\").prepend(\"<div class=\\\"ui-bizagi-loading-icon ui-bizagi-loading-button\\\"></div>\").find(\"i\").hide();\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    onRemoveSelectedItemsCollections: function(){\r\n        var self = this;\r\n        var commonActions = self.pub(\"notify\", {type: \"SET-VALUES\", args: {value: false}})[0];\r\n        self.enableBatchActions({ args: { commonActions: commonActions } });\r\n    },\r\n\r\n    /**\r\n     * Show the sort menu\r\n     * @param ev\r\n     * @param $parent\r\n     */\r\n    showSortMenu: function (ev, $parent) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        var template = self.getTemplate(\"sortMenu\");\r\n        var tooltip = template.render({filters: self._filters}, {\r\n            displayValue: function (val) {\r\n                return val;\r\n            }});\r\n\r\n        if ($(\".sortbar-box-menu\", $parent).length) {\r\n            $(\".sortbar-box-menu\", $parent).remove();\r\n        }\r\n\r\n        $parent.append(tooltip);\r\n        tooltip.show(\"fast\", function () {\r\n            tooltip.click(function (e) {\r\n                e.stopPropagation();\r\n            });\r\n            $(document).one(\"click\", function () {\r\n                tooltip.hide(\"fast\");\r\n                tooltip.remove();\r\n            });\r\n        });\r\n\r\n        //Configure handler to each action\r\n        $content.find(\".sortbar-option\").on(\"click\", function (ev) {\r\n            var data = $(ev.currentTarget).data();\r\n            var sortSelection = self._filters[data.index];\r\n            $content.find(\".sortbar-az\").removeClass(\"disabled\");\r\n\r\n            if(self.sortSelection != sortSelection) {\r\n                self.sortSelection = sortSelection;\r\n                $(\".sortbar-selected\", $parent).text(self.sortSelection.display.split(\".\").pop());\r\n                self.pub(\"notify\", { type: \"SET-ORDERBY\", args: {\r\n                    properties:{\r\n                        xpath: sortSelection.attribute,\r\n                        orderType: self._sortType,\r\n                        typeSearch: \"none\"\r\n                    }\r\n                }});\r\n            }\r\n            tooltip.hide(\"fast\");\r\n        });\r\n    },\r\n\r\n    showRecordsMenu: function (ev, $parent) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        var template = self.getTemplate(\"recordsMenu\");\r\n        var tooltip = template.render({});\r\n\r\n        if ($(\".sortbar-records-box-menu\", $parent).length) {\r\n            $(\".sortbar-records-box-menu\", $parent).remove();\r\n        }\r\n\r\n        $parent.append(tooltip);\r\n        tooltip.show(\"fast\", function () {\r\n            tooltip.click(function (e) {\r\n                e.stopPropagation();\r\n            });\r\n            $(document).one(\"click\", function () {\r\n                tooltip.hide(\"fast\");\r\n                tooltip.remove();\r\n            });\r\n        });\r\n\r\n        //Configure handler to each action\r\n        $content.find(\".sortbar-records-option\").on(\"click\", function (ev) {\r\n\r\n            var pageSize = Number(bizagi.util.trim(this.textContent));\r\n\r\n            $(\".sortbar-records-selected\", $parent).text(pageSize);\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"SET-RECORDS\", args: {\r\n                    pageSize: pageSize\r\n                }\r\n            });\r\n\r\n            tooltip.hide(\"fast\");\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Asigna los parametros iniciales de la busqueda e inicializa los objetos\r\n     * @param e\r\n     * @param params\r\n     */\r\n    initializeAndProcessFilterButton: function (e, params) {\r\n        var self = this;\r\n\r\n        self.showingFiltering = false;\r\n        self.setVisibleCheckAll(false);\r\n        self.behaviorVisibleSortbar();\r\n\r\n        self.restoreOrderSelected();\r\n        self.setIconSortType($(\".sortbar-az\", self.content), \"desc\");\r\n        self.params = params.args;\r\n        self.sortSelection = {};\r\n\r\n        self.processAddButton(e, params);\r\n    },\r\n\r\n    /**\r\n     *  Checks if the add button should be displayed\r\n     */\r\n    processAddButton: function (ev, params) {\r\n        var self = this,\r\n            $content = self.getContent(),\r\n            args = params.args,\r\n            action = args.action,\r\n            $buttonContainer = $content.find(\".sortbar-left .add-button\");\r\n        self._lastReferenceEntity = args.reference;\r\n        $buttonContainer.children().remove();\r\n        $(\".wrapper-sortbar-actions\", $content).remove();//Remove same time buttons batch actions\r\n        self._haveAddButton = false;\r\n        if (args.reference && args.referenceType !== \"ENTITY\") {\r\n            $buttonContainer.startLoading({ delay: 0, overlay: true });\r\n            self.dataService.getProcessAddAction(params).done(function (data) {\r\n                if(self._lastReferenceEntity === data.referenceEntity){\r\n                    if (typeof data !== \"undefined\" && Object.getOwnPropertyNames(data).length > 1 && data.guidEntity && data.id) {\r\n                        self.renderButton($buttonContainer, data);\r\n                    }\r\n                }\r\n            }).always(function () {\r\n                $buttonContainer.endLoading();\r\n            });\r\n        }\r\n        else if (action) {\r\n            self.renderButton($buttonContainer, action);\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    renderButton: function ($buttonContainer, action) {\r\n        var self = this,\r\n            template = self.getTemplate(\"addButton\"),\r\n            $addButton = template.render({ action: action });\r\n\r\n        $buttonContainer.empty();\r\n        $addButton.appendTo($buttonContainer);\r\n        self._haveAddButton = true;\r\n        self.behaviorVisibleSortbar();\r\n        $addButton.on(\"click\", function () { self.clickAddButton(action); });\r\n    },\r\n\r\n    /**\r\n     * Click on add Proccess btn\r\n     */\r\n    clickAddButton: function (action) {\r\n        var self = this;\r\n\r\n        $.when(self.dataService.getMapping({\r\n            guidEntity: action.guidEntity,\r\n            accumulatedContext: self.accumulatedcontext.getContext({}),\r\n            xpathContext: (action.type === \"Process\") ? action.xpathContext : \"\"\r\n        })).done(function (mappingData) {\r\n            if (action.type === \"Process\") {\r\n                self.onExecuteProcess(action, mappingData);\r\n            }\r\n            else {\r\n                self.onExecuteForm(action, mappingData);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Check or uncheck all registers related, could be cases or data\r\n     */\r\n    onCheckUncheck: function(ev){\r\n        var self = this;\r\n        var $target = $(ev.target);\r\n        var isChecked = $target.is(\":checked\");\r\n        var commonActions = self.pub(\"notify\", {type: \"SET-VALUES\", args: {value: isChecked}})[0];\r\n\r\n        self.enableBatchActions({ args: { commonActions: commonActions } });\r\n    },\r\n\r\n    /**\r\n     * Enabled / disables the batch actions. This method is called always update data\r\n     */\r\n    enableBatchActions: function (params) {\r\n        var self = this;\r\n        var args = params.args;\r\n        var commonActionsModel = self.commonActionsmodel = args.commonActions;\r\n        var actions = self.validActions(commonActionsModel.actions);\r\n        if(actions.length > 0 || self._haveAddButton ){\r\n            $(self.getContent()).show();\r\n        }\r\n        self.showBatchActions(actions, commonActionsModel, \"batchAction\");\r\n\r\n        if (commonActionsModel.checkAll !== undefined) {\r\n            self.$checkAll.prop(\"checked\", commonActionsModel.checkAll);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show batch actions\r\n     * @param actions\r\n     * @param commonActionsModel\r\n     * @param typeActions\r\n     */\r\n    showBatchActions: function (actions, commonActionsModel, typeActions){\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        var template = self.getTemplate(\"actions\");\r\n\r\n        self.showSelectedItems(Object.keys(commonActionsModel.itemsSelected).length);\r\n\r\n        var moreActions = actions.slice(3, 9999);\r\n\r\n        var $actions = template.render({actions: actions.slice(0, 3), moreActions: moreActions, typeActions: typeActions});\r\n\r\n        $(\".wdg-tple-button.batchAction\", self.content).off(\"click\", $.proxy(self.onClickBatchAction, self));\r\n\r\n        $(\".wrapper-sortbar-actions\", $content).remove();\r\n        $(\".sortbar-left .sortbar-menu\", $content).append($actions);\r\n\r\n        $(\".wdg-tple-button.batchAction\", self.content).on(\"click\", $.proxy(self.onClickBatchAction, self));\r\n\r\n        if(moreActions.length > 0){\r\n            if(self.content.data('ui-tooltip')) {\r\n                $(self.content).tooltip(\"destroy\");\r\n            }\r\n\r\n            $(self.content).tooltip({\r\n                tooltipClass: \"sortbar-tooltip-more-actions\",\r\n                items: \".bz-actions-showmore\",\r\n                content: $(\".template-box-tooltip\", self.content).html(),\r\n                open: function(event, ui)\r\n                {\r\n                    $(\".wdg-tple-button.batchAction\", ui.tooltip).on(\"click\", $.proxy(self.onClickBatchAction, self));\r\n\r\n                    var uiTooltip = $('div.ui-tooltip');\r\n\r\n                    if (typeof(event.originalEvent) === 'undefined')\r\n                    {\r\n                        uiTooltip.remove();\r\n                        return false;\r\n                    }\r\n                    var $id = $(ui.tooltip).attr('id');\r\n                    // close any lingering tooltips\r\n                    uiTooltip.not('#' + $id).remove();\r\n                    // ajax function to pull in data and add it to the tooltip goes here\r\n\r\n                    for(var keyActionGuid in self.requestsInProgressActionGuid){\r\n                        if(self.requestsInProgressActionGuid[keyActionGuid]){\r\n                            var $buttonAction = $(\"li[data-guid='\" + keyActionGuid + \"']\", ui.tooltip);\r\n                            self.addLoadingButtonAction($buttonAction);\r\n                        }\r\n                    }\r\n                },\r\n                close: function(event, ui)\r\n                {\r\n                    ui.tooltip.hover(function()\r\n                        {\r\n                            $(this).stop(true).fadeTo(400, 1);\r\n                        },\r\n                        function()\r\n                        {\r\n                            $(this).fadeOut('400', function()\r\n                            {\r\n                                $(\".wdg-tple-button.batchAction\", this).off(\"click\", $.proxy(self.onClickBatchAction, self));\r\n                                $(this).remove();\r\n                            });\r\n                        });\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Define the data on order to show the sort options\r\n     * @param ev\r\n     * @param params\r\n     */\r\n    setFiltersSortData: function (ev, params) {\r\n        var self = this;\r\n        var filtersAppliedCounter = params.args.filtersAppliedCounter;\r\n        var totalRecords = params.args.totalRecords;\r\n        self._filters = params.args.calculateFilters ? params.args.filters : self._filters;\r\n\r\n        if (params.args.calculateFilters) {\r\n            var i = -1, a, filterCounter = 0, sortCounter = 0;\r\n            while (a = self._filters[++i]) {\r\n                if (a.type != \"Text\" && a.type !== \"Link\" && a.data && ((a.data.defaultValues && a.data.defaultValues.length > 0) || (a.data.min && a.data.max))) {\r\n                    filterCounter++;\r\n                }\r\n                if (a.display !== \"\") {\r\n                    sortCounter++;\r\n                }\r\n            }\r\n\r\n            if (totalRecords > 0) {\r\n                // Si existen filtros, muestre el boton\r\n                if (filterCounter > 0) {\r\n                    self.showFilterButton();\r\n                }\r\n                else {\r\n                    self.hideFilterButton();\r\n                }\r\n                // Si existen filtros que tienen display name, muestre los botones de sort\r\n                if (sortCounter > 0) {\r\n                    self.showSortButtons();\r\n                }\r\n                else {\r\n                    self.hideSortButtons();\r\n                }\r\n            }\r\n            // Si no hay registros y ni se ha aplicado ningun filtro ocultar\r\n            // los botones del sortbar\r\n            else if (filtersAppliedCounter === 0) {\r\n                self.hideFilterButton();\r\n                self.hideSortButtons();\r\n            }\r\n        }\r\n        self.updateCounter(filtersAppliedCounter);\r\n    },\r\n\r\n    /**\r\n     * Show Filter Button\r\n     */\r\n    showFilterButton: function () {\r\n        var self = this;\r\n        $(\".filter-icon\", self.getContent()).show();\r\n    },\r\n\r\n    /**\r\n     * Hide Filter Button\r\n     */\r\n    hideFilterButton: function () {\r\n        var self = this;\r\n        $(\".filter-icon\", self.getContent()).hide();\r\n        self.showingFiltering = false;\r\n        self.behaviorVisibleSortbar();\r\n    },\r\n\r\n    /**\r\n     * Show Sort Buttons\r\n     */\r\n    showSortButtons: function () {\r\n        var self = this;\r\n        $(\".sortbar-text\", self.getContent()).show();\r\n        $(\".sortbar-icon\", self.getContent()).show();\r\n        $(\".sortbar-az\", self.getContent()).show();\r\n\r\n        self.showingSorting = true;\r\n        self.showingFiltering = true;\r\n        self.behaviorVisibleSortbar();\r\n    },\r\n\r\n    /**\r\n     * Hide Sort Buttons\r\n     */\r\n    hideSortButtons: function () {\r\n        var self = this;\r\n        var $sortbarIcon = $(\".sortbar-az\", self.getContent());\r\n\r\n        // Restore initial settings\r\n        $(\".sortbar-text\", self.getContent()).hide();\r\n\r\n        $sortbarIcon.addClass(\"disabled\");\r\n        $sortbarIcon.removeClass(\"bz-icon-order-ascendant-outline\");\r\n        $sortbarIcon.removeClass(\"bz-icon-order-descendant-outline\");\r\n        $sortbarIcon.addClass(\"bz-icon-order-ascendant-outline\");\r\n        $sortbarIcon.hide();\r\n\r\n        self.showingSorting = false;\r\n        self.behaviorVisibleSortbar();\r\n    },\r\n\r\n    /**\r\n     * Restore Order by Option\r\n     */\r\n    restoreOrderSelected: function(){\r\n        var self = this;\r\n        $(\".sortbar-selected\", self.getContent()).text(self.getResource(\"workportal-my-search-order-by\"));\r\n    },\r\n\r\n    /**\r\n     * Set number filters\r\n     * @param params\r\n     */\r\n    updateCounterByFilterApplied: function(params){\r\n        var self = this;\r\n        if(params.args.filtersApplied){\r\n            self.updateCounter(params.args.filtersApplied.length);\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param counter\r\n     */\r\n    updateCounter: function (counter) {\r\n        var self = this,\r\n            $content = self.getContent(),\r\n            $counter = $(\".counter-filters-applied\", $content);\r\n\r\n        if (counter > 0) {\r\n            $counter.html(counter);\r\n            $counter.show();\r\n        }\r\n        else {\r\n            $counter.hide();\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    hideFilterButtonAndBar: function () {\r\n        var self = this;\r\n        self.showingFilter = false;\r\n        $(\".filter-icon\", self.getContent()).hide();\r\n        self.pub(\"notify\", { type: \"CLOSE-MYSEARCHFILTER\", args: {\"show\": false, \"$target\": null}});\r\n    },\r\n\r\n    /**\r\n     * Creates a new case, it could has start form or not\r\n     */\r\n    onExecuteProcess: function (action, mappingData) {\r\n        var self = this;\r\n\r\n        if (action.startForm) {\r\n            action.hasStartForm = action.startForm;\r\n        }\r\n\r\n        $.when(self.processActionService.executeProcessAction({\r\n            action: action,\r\n            mappingData: mappingData\r\n        })).done( function (params) {\r\n            var params = params || {};\r\n\r\n            if(!!params && params.refreshTemplateData !== false){\r\n                self.loadTemplateData(action);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     */\r\n    loadTemplateData: function (action) {\r\n        var self = this;\r\n        self.pub(\"notify\", { type: \"TEMPLATEENGINE-VIEW\", args: {action: action, isRefresh: true}});\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    onExecuteForm: function (action, mappingData) {\r\n        var self = this;\r\n\r\n        $.when(self.processActionService.executeFormAction({\r\n            action: action,\r\n            mappingData: mappingData\r\n        })).done(function (data) {\r\n            if (data.refresh) {\r\n                self.pub(\"notify\", { type: \"UPDATE-DATATEMPLATE-VIEW\", args: { action: action, isRefresh: true, calculateFilters: true }});\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Returns the action required\r\n     */\r\n    getAction: function (guidAction) {\r\n        var self = this;\r\n        return self.commonActionsmodel.actions.filter( function (action) {\r\n            return action.id == guidAction;\r\n        })[0];\r\n    },\r\n\r\n    /**\r\n     * Returns an array with the valid actions\r\n     * @param actions\r\n     * @return {*}\r\n     */\r\n    validActions: function (actions) {\r\n        return $.grep(actions, function (action) {\r\n            if (action.multiplicity == 2) { return true; }\r\n            if (action.mode == \"Collection\") { return false; }\r\n            if (action.type == \"Form\") { return false; }\r\n            if (action.isEvent) { return false; }\r\n            if (action.type == \"Process\" && action.hasStartForm) { return false; }\r\n            return true;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Detach handlers\r\n     */\r\n    clean: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n        self.requestsInProgressActionGuid = {};\r\n\r\n        if ($content) {\r\n            self.unsub(\"TEMPLATEENGINE-VIEW\");\r\n            self.unsub(\"ENABLE-BATCHS-ACTIONS\");\r\n            self.unsub(\"SEARCH-ENGINE-VIEW\");\r\n            self.unsub(\"SET-FILTERS-DATA\");\r\n            self.unsub(\"HIDE-FILTER-BUTTONANDBAR\");\r\n            self.unsub(\"HIDE-SORT-BUTTONS\");\r\n\r\n            self.$checkAll.off(\"click\");\r\n            $content.find(\".right-menu\").off(\"click\");\r\n            $content.find(\".sortbar-az\").off(\"click\");\r\n            $content.find(\".filter-icon\").off(\"click\");\r\n            $content.find(\".sortbar-action\").off(\"click\");\r\n            $(\".wdg-tple-button.batchAction\", $content).off(\"click\", $.proxy(self.onClickBatchAction, self));\r\n            $(\".remove-selected-items-collections\", $content).off(\"click\", $.proxy(self.onRemoveSelectedItemsCollections, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.sortbar\", [\"workportalFacade\", \"dataService\", \"processActionService\", \"accumulatedcontext\", bizagi.workportal.widgets.sortbar]);\r\n","/**\r\n *   Name: Bizagi Workportal Desktop Processes list controller\r\n *   Author: Danny Gonzalez\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.processeslist\", {}, {\r\n\r\n    /**\r\n     * Constructor\r\n     * @param workportalFacade instance of facade, mandatory\r\n     * @param dataService instance of service tier, mandatory\r\n     * @param params extra params, its not mandatory\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.idworkflow = params.idworkflow; //Save current idworkflow\r\n        self.histName = params.histName; //Save current histName\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"processeslist\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.processeslist\").concat(\"#processeslist-wrapper\"),\r\n            \"processeslistEmptyData\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.processeslist\").concat(\"#processeslist-empty-message\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     * @return {string} html\r\n     */\r\n    renderContent: function () {\r\n        var self = this,\r\n            template = self.getTemplate(\"processeslist\");\r\n\r\n        return $.when(self.getData()).done(function(data){\r\n            self.content = data.length > 0 ? template.render({ processes: data }) : self.getEmptyDataMessage().render({});\r\n            self.setSelectedList($(\".wdg-process-card:first\", self.getContent()));\r\n        });\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n        self.configureHandlers();\r\n\r\n        self.sub(\"GETIDWORKFLOW_FROM_PROCESSESLIST\", function(){\r\n            return self.getIdworkflow();\r\n        });\r\n        self.sub(\"GETHISTNAME_FROM_PROCESSESLIST\", function(){\r\n            return self.getHistname();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Binds events to handles\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n        $(\".wdg-process-card\", $content).on(\"click\", $.proxy(self.onClickProcess, self));\r\n    },\r\n\r\n    /**\r\n     * Call to all processes in my activities\r\n     * @return {object} data\r\n     */\r\n    getData: function () {\r\n        var self = this,\r\n            $args = {},\r\n            $route = self.params.route;\r\n\r\n        switch ($route) {\r\n            case \"pendings\":\r\n                $args = {\r\n                    \"taskState\": \"all\",\r\n                    \"myPendings\": true\r\n                };\r\n                break;\r\n            case \"following\":\r\n                $args = {\r\n                    \"taskState\": \"all\",\r\n                    \"myActivities\": true,\r\n                    \"onlyFavorites\": true\r\n                };\r\n                break;\r\n            case \"Green\":\r\n            case \"Red\":\r\n            case \"Yellow\":\r\n                $args = {\r\n                    \"taskState\": $route\r\n                };\r\n                break;\r\n        }\r\n        return self.dataService.getAllProcesses($args).then(function (data) {\r\n            return self.getInfoToProcessesList(data);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Organize all data to processes in my activities\r\n     * @param data\r\n     * @returns {{cases}}\r\n     */\r\n    getInfoToProcessesList: function (data) {\r\n        var allProcesses = data.categories,\r\n            processes = [],\r\n            cases = [];\r\n\r\n        for (var i = 0, l = allProcesses.length; i < l; i++) {\r\n            processes = allProcesses[i].workflows;\r\n            for (var j = 0, k = processes.length; j < k; j++) {\r\n                cases.push({\r\n                    process: processes[j].name,\r\n                    idworkflow: processes[j].idworkflow\r\n                });\r\n            }\r\n        }\r\n        return cases;\r\n    },\r\n\r\n    /**\r\n     * event listener for each action in the processes list\r\n     * @param ev\r\n     */\r\n    onClickProcess: function (ev) {\r\n        var self = this,\r\n            params = bizagi.clone(self.params),\r\n            $target = $(ev.target).closest(\".wdg-process-card\");\r\n        self.setSelectedList($target);\r\n\r\n        self.idworkflow = $target.data(\"idworkflow\");\r\n        self.histName = $target.data(\"title\");\r\n\r\n        self.pubDeadLockDetection(\"notify\", {\r\n            type: \"CASES-TEMPLATE-VIEW\",\r\n            args: $.extend(params, {\r\n                histName: self.histName,\r\n                level: 3,\r\n                idworkflow: self.idworkflow\r\n            })\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @returns {*}\r\n     */\r\n    getIdworkflow: function (){\r\n        var self = this;\r\n        return self.idworkflow;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @returns {*}\r\n     */\r\n    getHistname: function(){\r\n        var self = this;\r\n        return self.histName;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param item\r\n     */\r\n    setSelectedList: function(item){\r\n        var self = this;\r\n        $(item).addClass(\"wdg-plst-selected\").siblings().removeClass(\"wdg-plst-selected\");\r\n    },\r\n\r\n    /**\r\n     * Gets Message when there are not data\r\n      * @returns {processeslistEmptyData}\r\n     */\r\n     getEmptyDataMessage: function () {\r\n        var self = this,\r\n            processeslistEmptyData = self.getTemplate(\"processeslistEmptyData\");\r\n\r\n        return processeslistEmptyData;\r\n    },\r\n\r\n    /**\r\n     * Detach handlers\r\n     */\r\n    clean: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        if ($content) {\r\n            $(\".wdg-process-card\", $content).off(\"click\");\r\n        }\r\n\r\n        self.unsub(\"GETIDWORKFLOW_FROM_PROCESSESLIST\");\r\n        self.unsub(\"GETHISTNAME_FROM_PROCESSESLIST\");\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.processeslist\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.processeslist], true);"]}