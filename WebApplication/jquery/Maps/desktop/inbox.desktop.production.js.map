{"version":3,"sources":["jquery/common/bizagi.pagination/js/jquery.bizagi.pagination.js","jquery/workportal/js/plugins/jquery.bizagi.pagination.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.inbox.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.listCases.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.inboxGrid.js","jquery/workportal/js/desktop/inbox/bizagi.workportal.inbox.rowsPerPage.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.integration.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.inbox.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.inboxGrid.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.folders.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.smartfolders.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.folders.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.smartfolders.js"],"names":["$","fn","bizagiPagination","options","opt","limInf","totalPages","actualPage","listElement","first","firstClass","prev","prevClass","next","nextClass","last","lastClass","liClass","arrowClass","selectedFocus","clickCallBack","extend","pagination","previousPage","Math","max","parseInt","nextPage","displaceElements","firstElementValue","increment","pageData","each","key","value","this","data","find","html","attr","hasClass","removeClass","addClass","length","parent","css","disableFirst","disableLast","totalElements","prepend","append","click","page","trim","self","halfDisplace","round","init","jQuery","bizagi","workportal","widgets","widget","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_INBOX","renderContent","template","getTemplate","enableFolders","undefined","override","enableFolder","enableSmartFolders","content","tmpl","currentInboxView","renderSummaryForm","container","def","Deferred","proxyPrefix","dataService","serviceLocator","loader","start","then","rendering","facade","execute","canvas","summaryForm","idCase","renderingFacade","setTimeout","resizeLayout","when","ready","done","resolve","promise","routingExecute","element","val","idWorkflow","idWorkItem","idTask","eventAsTasks","publish","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","BIZAGI_WORKPORTAL_WIDGET_LISTCASES","setTableHeadFixed","params","TableElement","floatThead","floatOptions","groupByCaseNumber","util","isIE","hide","listCases","BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID","security","menuSecurity","obj","Class","initCombo","comboDataSource","combo","id","values","Array","bizagiConfig","inboxRowsPerPage","indexOf","push","sort","a","b","map","v","name","_findValue","finding","c","initialValueCombo","initValueCombo","preferencesItemsPerPage","getRowValue","inboxItemsPerPage","defaultValue","renderNumberRowsCombo","deferred","comboWrapper","empty","setRowValue","lastValue","uicombo","isEditable","itemValue","itemText","onComplete","onChange","ui","initValue","workportalFacade","module","selector","BIZAGI_WORKPORTAL_WIDGET_INTEGRATION","document","createElement","postRender","clean","_super","inbox","taskState","icoTaskState","adhocCases","loadTemplates","concat","inbox-cases","inbox-cases-list","inbox-cases-personalized-list","inbox-common-processes","inbox-common-noresults","inbox-common-header-view","inbox-common-case-summary","inbox-common-case-summary-form","inbox-common-case-summary-subprocess","inbox-common-case-summary-assignees","inbox-common-case-summary-events","inbox-common-case-summary-oldrender","useNewEngine","referrerParams","processesTemplate","casesTemplate","casesTemplateList","caseSummaryTemplate","caseSummaryTemplateForm","caseSummaryTemplateSubprocess","caseSummaryTemplateAssigness","caseSummaryTemplateEvents","noResults","paginationTemplate","getInboxSummary","summary","updateSummary","changeTaskState","configureViewControl","configureSmartFolders","comboRowsPerPage","rowsPerPage","getContent","changeProcess","services","preferences","getPreferences","modifiedJSON","overridePreferences","currentPopup","popupOpened","widgetName","BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS","sourceElement","modalClass","max-height","height","width","offset","activeScroll","foldersView","closed","desktop","popup","closePopupInstance","eyeIcon","eyeIconParent","at","arrowPosition","left","render","popupContent","close","k","e","All","Red","Green","Yellow","processesContainer","smartfoldersParameters","urlParameters","previewTaskState","onlyFavorites","getAllProcesses","categories","appendTo","getStoredQueryFormList","storedQueryForm","storedQueryForms","getWidget","pipe","result","event","process","currentTarget","tagName","workflowName","text","stopPropagation","elmnt","idObject","favoriteType","addFavorite","favoritesData","updateCountProcess","delFavorite","trigger","arrow","is","show","lastProcess","restoreStatus","key2","value2","bizagiScrollbar","isAvailableTimelineByProcessType","isAdhocProcess","isEnableFeature","casesContainer","pageSelector","descContainer","nElemToShow","showErrorAlertDialog","getCasesByWorkflow","eval","pageSize","lstIdCases","rows","index","elem","enableTimelineByProcessType","processName","pages","totPages","pageToshow","i","pageNumber","command","graphicQuery","checkSecurityPerm","paginationHtml","enableFeatureShowTimelineButton","replaceLineBreak","string","search","replaceAll","formatMonetaryCell","formatMoney","BIZAGI_DEFAULT_CURRENCY_INFO","formatDecimalCell","decimalFormat","externalDecimalFormat","decimalSymbol","decimalSeparator","digitGroupSymbol","groupSeparator","roundToDecimalPlace","decimalDigits","colorize","groupDigits","negativeFormat","positiveFormat","symbol","formatDecimal","formatBoolean","parseBoolean","getResource","formatInvariantDate","cAse","children","changeCase","BIZAGI_WORKPORTAL_WIDGET_FOLDERS","onlyFolderMode","favoriteOptions","fail","error","JSON","parse","responseText","caseSummaryContainer","errorTemplate","message","errorHtml","cache","htmlContent","isAdhoc","idProcess","idAdhocProcess","summaryCaseDetails","hasComments","contextualized","currentState","forEach","state","displayName","processPath","delegate","tabs","active","create","activate","newPanel","comments","readOnly","renderComments","setContext","commentsFocus","bind","isPropagationStopped","oldrenderevent","eventMethod","window","addEventListener","eventer","getWorkitems","onlyUserWorkItems","workItems","idWorkitem","url","getUrl","iframeOldRender","performResizeLayout","getCaseFormsRenderVersion","formsVersion","formsRenderVersion","summarySubProcess","subprocess","summaryAssigness","preview","assignees","eventsUniqueList","events","split","el","inArray","join","activitiesUniqueList","activities","summaryCaseEvents","caseNumber","closest","showTimeLine","radNumber","showGraphicQuery","button","referrer","autohide","casesPagination","listContainer","resize","forceResize","assigned","workflows","idworkflow","count","localization","iframe","queryString","readQueryString","load","contents","cssLocation","browser","mozilla","webkit","replace","inboxGrid","adhocIds","inbox-grid","inbox-grid-rubik","inbox-grid-cases","remove","Number","prototype","apply","arguments","procContainer","setFiltersOnChangeProcess","res","orderFieldName","orderType","order","getCustomizedColumnsData","group","cases","caseId","processId","columnTitle","isArray","workitems","TaskName","State","pdata","formatDecimalAndMoneyCell","timeLine","renderedTemplate","showMagicButton","enableAdhocProcess","setFormat","formatValue","formatCategories","isDate","getRadNumberColumnIndex","l","fieldName","showColumn","columnIndex","createGroupedHeader","rowIndex","getRadNumber","row","fields","isIEAndFirstRowAndGroupCases","isIE9","expr","RegExp","tbhtml","ShowTimeInInboxDates","maxElemShow","tooltip","parents","showCase","preventDefault","queryTableElement","position","zIndex","scrollContainer","adhocProcessId","caseSummaryDialog","dialog","buttons","modal","title","draggable","resizable","formatRequest","dispose","getEventListener","on","folders","folders-elements","folders-empty-elements","folders-query-tree","folders-query-confirm","folders-default","folders-input-new","folders-add-case","folders-elements-node","folders-query-edit","smartfolders","smartfolders-elements","smartfolders-empty-elements","smartfolders-query-confirm","smartfolders-default","smartfolders-add-case","smartfolders-elements-node","smartfolders-query-tree","smartfolders-query-edit","smartfolders-input-new","configureTreeNavigation","configureBackButton","renderFolders","scrollVertical","renderDefaultFolders","appendElement","queryContent","mergeData","emptyTemplate","mergeNewFolder","getFolders","idParent","childs","categoryWithLink","countChilds","configureNavTree","queriesContainer","confirm","headerTemplate","categoryTree","queriesListDisplay","idParentQuery","queryDisplayName","makeFolder","listElements","getCasesByFolder","customized","casesGroupedByFolder","idFolder","BIZAGI_WORKPORTAL_WIDGET_SEARCH","beforeElement","style","idParentDone","editFolder","idCustomFolder","deleteFolder","ico","associateCaseToFolder","btnBack","nodeTemplate","newElement","insertAfter","focus","folderName","checkRepeatFolderName","idParentFolder","keyCode","args","folderNameAvailable","not","replaceWith","updateFolder","nextAll","showQueryFormPopup","arg","idQuery","idStoredQuery","queryFormAction","BIZAGI_WORKPORTAL_WIDGET_QUERYFORM","idQueryForm","modalParameters","getSmartFolders","widgetRedirect","viewSmartFoldersAsSearch","idSmartFolder","deleteSmartFolder","idUser","currentUser","endPoint","BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME","widgetURL"],"mappings":"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","sourcesContent":["/*\r\n* Simple Pagination Control for Bizagi Workportal\r\n* @author: Edward J Morales\r\n*/\r\n\r\n(function ($) {\r\n    $.fn.bizagiPagination = function (options) {\r\n        // define options\r\n        options = options || {};\r\n\r\n        var opt = {\r\n            limInf: 0,\r\n            totalPages: 1,\r\n            actualPage: 1,\r\n\r\n            // Controllers elements\r\n            listElement: $(\"ul\"),\r\n            first: '&lt;&lt;',\r\n            firstClass: \"first\",\r\n            prev: '&lt;',\r\n            prevClass: 'prev',\r\n            next: \"&gt;\",\r\n            nextClass: \"next\",\r\n            last: \"&gt;&gt;\",\r\n            lastClass: \"last\",\r\n\r\n            // Default class of pagination template, ui-bizagi-workportal-widget-inbox-common-pagination\r\n            // <li {{if page==pageNumber}} class=\"page active\" {{else}} class=\"page\" {{/if}} data-page=\"${pageNumber}\">\r\n            // <span class=\"number\">${pageNumber}</span>\r\n            // </li>\r\n            liClass: \"bz-page\",\r\n            arrowClass: \"bz-pageArrow\",\r\n\r\n            // Auto focus on selected element\r\n            selectedFocus: true,\r\n\r\n            // Call back methods\r\n            clickCallBack: function () { }\r\n\r\n        };\r\n\r\n\r\n        if (options.actualPage > options.totalPages) {\r\n            options.actualPage = options.totalPages;\r\n        }\r\n\r\n\r\n        // Extend options\r\n        $.extend(opt, opt, options);\r\n\r\n        var pagination = {\r\n            previousPage: Math.max(1,parseInt(opt.actualPage) - 1),\r\n            nextPage: parseInt(opt.actualPage) + 1\r\n        }\r\n\r\n        function init() {\r\n            // Count total elements\r\n            opt.totalElements = $(\"li.\" + opt.liClass, opt.listElement[0]).length;\r\n\r\n\r\n            // Add control elements\r\n            if (opt.totalPages > opt.totalElements && opt.totalElements > 1) {\r\n                appendControlsArrows();\r\n            }\r\n\r\n            // Add events\r\n            bindElements();\r\n\r\n            // Set focus\r\n            if (opt.selectedFocus && opt.actualPage >= opt.totalElements && opt.totalPages > opt.totalElements) {\r\n                var firstElementValue;\r\n                var halfDisplace = (opt.actualPage - Math.round(opt.totalElements / 2));\r\n\r\n                if (halfDisplace < 1) {\r\n                    firstElementValue = 1;\r\n                } else if ((halfDisplace + opt.totalElements) > opt.totalPages) {\r\n                    firstElementValue = (opt.totalPages - opt.totalElements);\r\n                    firstElementValue = (firstElementValue < 1) ? 1 : firstElementValue;\r\n                } else {\r\n                    firstElementValue = halfDisplace;\r\n                }\r\n\r\n                if (opt.listElement.find(\"li.active\").length == 0) {\r\n                    displaceElements(firstElementValue, 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Append control arrow to list\r\n        function appendControlsArrows() {\r\n\r\n            var disableFirst=pagination.previousPage==opt.actualPage;\r\n            var disableLast=opt.actualPage==opt.totalPages;\r\n\r\n            // add prev arrow\r\n            opt.listElement.prepend(\"<li/>\").find(\"li:first\").addClass(opt.prevClass).addClass(disableFirst?\"pagination-disabled\":\"\").data(\"page\", pagination.previousPage).html(opt.prev);\r\n\r\n            // add first arrow\r\n            opt.listElement.prepend(\"<li/>\").find(\"li:first\").addClass(opt.arrowClass + \" \" + opt.firstClass).addClass(disableFirst?\"pagination-disabled\":\"\").data(\"page\", \"1\").html(opt.first);\r\n\r\n            // add next arrow\r\n            opt.listElement.append(\"<li/>\").find(\"li:last\").addClass(opt.nextClass).addClass(disableLast?\"pagination-disabled\":\"\").data(\"page\", pagination.nextPage).html(opt.next);\r\n\r\n            // add last arrow\r\n            opt.listElement.append(\"<li/>\").find(\"li:last\").addClass(opt.arrowClass + \" \" + opt.lastClass).addClass(disableLast?\"pagination-disabled\":\"\").data(\"page\", opt.totalPages).html(opt.last);\r\n        }\r\n\r\n\r\n        // Add events\r\n        function bindElements() {\r\n            // Click event for list element\r\n            var options = {};\r\n            $(\"li:not(.pagination-disabled)\", opt.listElement).click(function () {\r\n                // Next line now includes a ternary operator in order to confirm last arrow (>>) if going indeed to the last page\r\n                options.page = ($(this).hasClass(opt.lastClass)) ? opt.totalPages : $.trim($(this).data(\"page\") + \" \");\r\n                options.parent = $(this).parent();\r\n                options.self = $(this);\r\n                opt.clickCallBack(options);\r\n            });\r\n        }\r\n\r\n        // Change values of elements\r\n        function pageScroll(increment) {\r\n            // if increment its positive, execute right scroll\r\n            // if increment its negative, execute left scroll\r\n            increment = increment || 1;\r\n            var displace = false;\r\n\r\n            // Define first element value\r\n            var firstPageValue = $(\"li.\" + opt.liClass + \":first\", opt.listElement).data(\"page\");\r\n            var lastPageValue = $(\"li.\" + opt.liClass + \":last\", opt.listElement).data(\"page\");\r\n\r\n\r\n            // Check left scroll - decrement\r\n            if (increment < 0 && firstPageValue > 1) {\r\n                displace = true;\r\n            } else if (increment > 0 && lastPageValue < opt.totalPages) {\r\n                displace = true;\r\n            }\r\n\r\n            if (displace) {\r\n                displaceElements(firstPageValue, increment);\r\n            }\r\n        }\r\n\r\n        // Displace elements\r\n        function displaceElements(firstElementValue, increment) {\r\n            firstElementValue = firstElementValue || 1;\r\n            increment = increment || 0;\r\n            var pageData;\r\n\r\n            if (increment > 0) {\r\n                // Increment\r\n                pageData = firstElementValue;\r\n            } else if (increment < 0) {\r\n                // Decrement\r\n                pageData = firstElementValue - 2;\r\n            } else {\r\n                return;\r\n            }\r\n\r\n            $.each($(\"li.\" + opt.liClass, opt.listElement), function (key, value) {\r\n                pageData++;\r\n                $(this).data(\"page\", pageData);\r\n                $(this).find(\"span\").html(pageData);\r\n                // Changes the attribute content of data-page with the current number pageData\r\n                $(this).attr(\"data-page\", pageData);\r\n                // Check if selected style\r\n                if (opt.actualPage == pageData && !$(this).hasClass(\"active\")) {\r\n                    $(this).addClass(\"active\");\r\n                } else {\r\n                    $(this).removeClass(\"active\");\r\n                }\r\n            });\r\n\r\n            // Show or hide tooltip pagination\r\n            if ($(opt.listElement).find(\".active\").length == 1) {\r\n                $(opt.listElement).parent().find(\"#tooltipPagination\").css(\"visibility\", \"hidden\");\r\n            } else {\r\n                $(opt.listElement).parent().find(\"#tooltipPagination\").css(\"visibility\", \"visible\");\r\n            }\r\n        }\r\n\r\n        // Init plugin\r\n        init();\r\n    };\r\n})(jQuery);\r\n\r\n\r\n\r\n","/* \r\n* Simple Pagination Control for Bizagi Workportal\r\n* @author: Edward J Morales\r\n*/\r\n\r\n(function ($) {\r\n    $.fn.bizagiPagination = function (options) {\r\n        // define options\r\n        options = options || {};\r\n\r\n        var opt = {\r\n            limInf: 0,\r\n            totalPages: 1,\r\n            actualPage: 1,\r\n\r\n            // Controllers elements\r\n            listElement: $(\"ul\"),\r\n            first: '&lt;&lt;',\r\n            firstClass: \"first\",\r\n            prev: '&lt;',\r\n            prevClass: 'prev',\r\n            next: \"&gt;\",\r\n            nextClass: \"next\",\r\n            last: \"&gt;&gt;\",\r\n            lastClass: \"last\",\r\n\r\n            // Default class of pagination template, ui-bizagi-workportal-widget-inbox-common-pagination\r\n            // <li {{if page==pageNumber}} class=\"page active\" {{else}} class=\"page\" {{/if}} data-page=\"${pageNumber}\">\r\n            // <span class=\"number\">${pageNumber}</span>\r\n            // </li>\r\n            liClass: \"bz-page\",\r\n            arrowClass: \"bz-pageArrow\",\r\n\r\n            // Auto focus on selected element\r\n            selectedFocus: true,\r\n\r\n            // Call back methods\r\n            clickCallBack: function () { }\r\n\r\n        };\r\n\r\n\r\n        if (options.actualPage > options.totalPages) {\r\n            options.actualPage = options.totalPages;\r\n        }\r\n\r\n        \r\n        // Extend options\r\n        $.extend(opt, opt, options);\r\n        \r\n        var pagination = {\r\n            previousPage: Math.max(1,parseInt(opt.actualPage) - 1),\r\n            nextPage: parseInt(opt.actualPage) + 1\r\n        }\r\n\r\n        function init() {\r\n            // Count total elements\r\n            opt.totalElements = $(\"li.\" + opt.liClass, opt.listElement[0]).length;\r\n\r\n\r\n            // Add control elements\r\n            if (opt.totalPages > opt.totalElements && opt.totalElements > 1) {\r\n                appendControlsArrows();\r\n            }\r\n\r\n            // Add events\r\n            bindElements();\r\n\r\n            // Set focus\r\n            if (opt.selectedFocus && opt.actualPage >= opt.totalElements && opt.totalPages > opt.totalElements) {\r\n                var firstElementValue;\r\n                var halfDisplace = (opt.actualPage - Math.round(opt.totalElements / 2));\r\n\r\n                if (halfDisplace < 1) {\r\n                    firstElementValue = 1;\r\n                } else if ((halfDisplace + opt.totalElements) > opt.totalPages) {\r\n                    firstElementValue = (opt.totalPages - opt.totalElements);\r\n                    firstElementValue = (firstElementValue < 1) ? 1 : firstElementValue;\r\n                } else {\r\n                    firstElementValue = halfDisplace;\r\n                }\r\n\r\n                if (opt.listElement.find(\"li.active\").length == 0) {\r\n                    displaceElements(firstElementValue, 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Append control arrow to list\r\n        function appendControlsArrows() {\r\n\r\n            var disableFirst=pagination.previousPage==opt.actualPage;\r\n            var disableLast=opt.actualPage==opt.totalPages;\r\n\r\n            // add prev arrow\r\n            opt.listElement.prepend(\"<li/>\").find(\"li:first\").addClass(opt.prevClass).addClass(disableFirst?\"pagination-disabled\":\"\").data(\"page\", pagination.previousPage).html(opt.prev);\r\n\r\n            // add first arrow\r\n            opt.listElement.prepend(\"<li/>\").find(\"li:first\").addClass(opt.arrowClass + \" \" + opt.firstClass).addClass(disableFirst?\"pagination-disabled\":\"\").data(\"page\", \"1\").html(opt.first);\r\n\r\n            // add next arrow\r\n            opt.listElement.append(\"<li/>\").find(\"li:last\").addClass(opt.nextClass).addClass(disableLast?\"pagination-disabled\":\"\").data(\"page\", pagination.nextPage).html(opt.next);\r\n\r\n            // add last arrow\r\n            opt.listElement.append(\"<li/>\").find(\"li:last\").addClass(opt.arrowClass + \" \" + opt.lastClass).addClass(disableLast?\"pagination-disabled\":\"\").data(\"page\", opt.totalPages).html(opt.last);\r\n        }\r\n\r\n\r\n        // Add events\r\n        function bindElements() {\r\n            // Click event for list element\r\n            var options = {};\r\n            $(\"li:not(.pagination-disabled)\", opt.listElement).click(function () {\r\n                // Next line now includes a ternary operator in order to confirm last arrow (>>) if going indeed to the last page\r\n                options.page = ($(this).hasClass(opt.lastClass)) ? opt.totalPages : $.trim($(this).data(\"page\") + \" \");\r\n                options.parent = $(this).parent();\r\n                options.self = $(this);\r\n                opt.clickCallBack(options);\r\n            });\r\n        }\r\n\r\n        // Change values of elements\r\n        function pageScroll(increment) {\r\n            // if increment its positive, execute right scroll\r\n            // if increment its negative, execute left scroll\r\n            increment = increment || 1;\r\n            var displace = false;\r\n\r\n            // Define first element value\r\n            var firstPageValue = $(\"li.\" + opt.liClass + \":first\", opt.listElement).data(\"page\");\r\n            var lastPageValue = $(\"li.\" + opt.liClass + \":last\", opt.listElement).data(\"page\");\r\n\r\n\r\n            // Check left scroll - decrement\r\n            if (increment < 0 && firstPageValue > 1) {\r\n                displace = true;\r\n            } else if (increment > 0 && lastPageValue < opt.totalPages) {\r\n                displace = true;\r\n            }\r\n\r\n            if (displace) {\r\n                displaceElements(firstPageValue, increment);\r\n            }\r\n        }\r\n\r\n        // Displace elements\r\n        function displaceElements(firstElementValue, increment) {\r\n            firstElementValue = firstElementValue || 1;\r\n            increment = increment || 0;\r\n            var pageData;\r\n\r\n            if (increment > 0) {\r\n                // Increment                \r\n                pageData = firstElementValue;\r\n            } else if (increment < 0) {\r\n                // Decrement  \r\n                pageData = firstElementValue - 2;\r\n            } else {\r\n                return;\r\n            }\r\n\r\n            $.each($(\"li.\" + opt.liClass, opt.listElement), function (key, value) {\r\n                pageData++;\r\n                $(this).data(\"page\", pageData);\r\n                $(this).find(\"span\").html(pageData);\r\n                // Changes the attribute content of data-page with the current number pageData\r\n                $(this).attr(\"data-page\", pageData);\r\n                // Check if selected style\r\n                if (opt.actualPage == pageData && !$(this).hasClass(\"active\")) {\r\n                    $(this).addClass(\"active\");\r\n                } else {\r\n                    $(this).removeClass(\"active\");\r\n                }\r\n            });\r\n\r\n            // Show or hide tooltip pagination\r\n            if ($(opt.listElement).find(\".active\").length == 1) {\r\n                $(opt.listElement).parent().find(\"#tooltipPagination\").css(\"visibility\", \"hidden\");\r\n            } else {\r\n                $(opt.listElement).parent().find(\"#tooltipPagination\").css(\"visibility\", \"visible\");\r\n            }\r\n        }\r\n\r\n        // Init plugin\r\n        init();\r\n    };\r\n})(jQuery);\r\n\r\n\r\n\r\n","/*\r\n*   Name: BizAgi Workportal Inbox Widget Controller\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script will define a base class to to define the inbox widget\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.inbox\", {}, {\r\n\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX;\r\n    },\r\n\r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"inbox\");\r\n        var data = {};\r\n\r\n        // Enable or disable functionality\r\n        data.enableFolders = (bizagi.override != undefined && bizagi.override.enableFolder) ? true : false;\r\n        data.enableSmartFolders = (bizagi.override != undefined && bizagi.override.enableSmartFolders) ? true : false;\r\n\r\n        // Render content\r\n        var content = self.content = $.tmpl(template, data);\r\n\r\n        // Set inbox view variable\r\n        bizagi.workportal.currentInboxView = self.getWidgetName();\r\n\r\n        return content;\r\n    },\r\n\r\n    /*\r\n    *   Renders the summary form inside a given container\r\n    */\r\n    renderSummaryForm: function (container) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var proxyPrefix = (typeof (self.dataService.serviceLocator.proxyPrefix) !== \"undefined\")\r\n            ? self.dataService.serviceLocator.proxyPrefix : \"\";\r\n\r\n        bizagi.loader.start(\"rendering\").then(function () {\r\n            // Load render page\r\n            var rendering = new bizagi.rendering.facade({ \"proxyPrefix\": proxyPrefix });\r\n\r\n            // Executes rendering into render container\r\n            rendering.execute({\r\n                canvas: container,\r\n                summaryForm: true,\r\n                idCase: self.idCase\r\n            });\r\n\r\n            // Keep reference to rendering facade\r\n            self.renderingFacade = rendering;\r\n\r\n            // Resize layout\r\n            setTimeout(function () {\r\n                self.resizeLayout();\r\n            }, 1000);\r\n\r\n            // Resolve main deferred\r\n            $.when(rendering.ready())\r\n            .done(function () {\r\n                def.resolve();\r\n            });\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    routingExecute: function (element) {\r\n        // Executes routing action\r\n        if (element == undefined) {\r\n            return false;\r\n        }\r\n\r\n        var self = this;\r\n\r\n        var idCase = element.find(\"#idCase\").val();\r\n        var idWorkflow = element.find(\"#idWorkflow\").val();\r\n        var idWorkItem = element.find(\"#idWorkItem\").val();\r\n        var idTask = element.find(\"#idTask\").val();\r\n        var eventAsTasks = element.find(\"#eventAsTasks\").val() || false;\r\n\r\n        self.publish(\"executeAction\", {\r\n            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n            idCase: idCase,\r\n            idWorkflow: idWorkflow,\r\n            idWorkItem: idWorkItem,\r\n            idTask: idTask,\r\n            eventAsTasks: eventAsTasks\r\n        });\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Desktop List Cases implementation\r\n*   Author: Kevin Alvarado\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.listCases\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES;\r\n    },\r\n    \r\n    /**\r\n    * Set the table with the fixed thead\r\n    * @param {Json} params TableElement,groupByCaseNumber,floatOptions\r\n    */\r\n    setTableHeadFixed:function(params) {\r\n        params.TableElement.floatThead(params.floatOptions);\r\n        \r\n        if(params.groupByCaseNumber && bizagi.util.isIE()){\r\n            params.TableElement.find(\"tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide\").hide();\r\n        }\r\n    }\r\n});\r\n","\r\n/*\r\n*   Name: BizAgi Workportal Inbox Grid Widget Controller\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script will define a base class to to define the inbox grid widget\r\n*/\r\n\r\nbizagi.workportal.widgets.listCases.extend(\"bizagi.workportal.widgets.inboxGrid\", {}, {\r\n   \r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function(){  \r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID;\r\n    },\r\n    \r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"inbox-grid\");\r\n        \r\n        var data={};\r\n        \r\n        // Enable or disable functionality\r\n        data.enableFolders = (bizagi.override != undefined && bizagi.override.enableFolder) ? true : false;\r\n        data.enableSmartFolders = (bizagi.override != undefined && bizagi.override.enableSmartFolders) ? true : false;\r\n        \r\n        // Render content\r\n        var content = self.content = $.tmpl(template,$.extend(data, {security: bizagi.menuSecurity}));\r\n        \r\n        // Set inbox view variable\r\n        bizagi.workportal.currentInboxView = self.getWidgetName();\r\n        \r\n        return content;\r\n    },\r\n    \r\n    \r\n    /*\r\n    *   Renders the summary form inside a given container\r\n    */\r\n    renderSummaryForm: function (container) {\r\n        var self = this;\r\n\r\n        var proxyPrefix = (typeof (self.dataService.serviceLocator.proxyPrefix) !== \"undefined\")\r\n            ? self.dataService.serviceLocator.proxyPrefix : \"\";\r\n\r\n        bizagi.loader.start(\"rendering\").then(function () {\r\n            // Load render page\r\n            var rendering = new bizagi.rendering.facade({ \"proxyPrefix\": proxyPrefix });\r\n\r\n            // Executes rendering into render container\r\n            rendering.execute({\r\n                canvas: container,\r\n                summaryForm: true,\r\n                idCase: self.idCase\r\n            });\r\n\r\n            // Keep reference to rendering facade\r\n            self.renderingFacade = rendering;\r\n\r\n            // Resize layout\r\n            setTimeout(function () {\r\n                self.resizeLayout();\r\n            }, 1000);\r\n        });\r\n    },\r\n    \r\n    routingExecute : function(obj){        \r\n        // Executes routing action\r\n        var self = this;\r\n        if(obj == undefined){\r\n            return false;\r\n        }\r\n        \r\n        var idCase = obj.find(\"#idCase\").val();\r\n        var idWorkItem = obj.find(\"#idWorkItem\").val();\r\n        var idTask = obj.find(\"#idTask\").val();\r\n        var eventAsTasks = obj.find(\"#eventAsTasks\").val() || false;\r\n        \r\n        self.publish(\"executeAction\", {\r\n            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n            idCase: idCase,\r\n            idWorkItem: idWorkItem,\r\n            idTask: idTask,\r\n            eventAsTasks: eventAsTasks\r\n        });\r\n    }     \r\n});\r\n","/*\r\n*   Name: BizAgi Workportal Inbox Rows Per Page\r\n*   Author: Kevin Alvarado\r\n*   Comments:\r\n*   -   \r\n*/\r\n\r\n\r\n// Extends itself\r\n$.Class.extend(\"bizagi.workportal.inbox.rowsPerPage\", {\r\n\r\n}, {\r\n\r\n    \r\n    /**\r\n     * return the combo DataSource with the default values and bizagiConfig.inboxRowsPerPage\r\n     */\r\n    initCombo: function(){\r\n        var comboDataSource = {\r\n            combo: [],\r\n            id: \"numberRows\"\r\n        };\r\n        var values=Array(10,20,30,40,50,100);\r\n        if(bizagiConfig.inboxRowsPerPage && values.indexOf(bizagiConfig.inboxRowsPerPage)==-1){\r\n            values.push(bizagiConfig.inboxRowsPerPage);\r\n            values.sort( function(a, b) {return a-b} );\r\n        }\r\n        values.map(function(v) {\r\n            comboDataSource.combo.push({\r\n                id: v,\r\n                name: v\r\n            });\r\n        });\r\n        return comboDataSource;\r\n    },\r\n    /**\r\n     * Busca el valor finding en el combo[i].id si no lo encuentra retorna false, de lo contrario retorna el elemento combo[i]\r\n     * @param {Array} combo array de valores del combo\r\n     * @param {Number} finding valor que se busca\r\n     */\r\n    _findValue: function (combo,finding) {\r\n        var value=false;\r\n        combo.map(function (c) {\r\n            if(c.id==finding){\r\n                value=c;\r\n            }\r\n        });\r\n        return value;\r\n    },\r\n\r\n    /**\r\n     * Revisa el valor inicial que debe tener el combo, revisando preferencias de usuario, web.config y casos null, retorna un elemento del combo\r\n     * @param {JSON} params contenido del comboDataSource, setRowValue y getRowValue\r\n     */\r\n    initialValueCombo: function (params) {\r\n        var self = this;\r\n        var initValueCombo = params.comboDataSource.combo[0];\r\n        var preferencesItemsPerPage=params.getRowValue();\r\n        preferencesItemsPerPage=(preferencesItemsPerPage && preferencesItemsPerPage.inboxItemsPerPage)?preferencesItemsPerPage.inboxItemsPerPage:null;\r\n        if(preferencesItemsPerPage || bizagiConfig.inboxRowsPerPage){\r\n            var defaultValue=(preferencesItemsPerPage && self._findValue(params.comboDataSource.combo, preferencesItemsPerPage)!==false)?preferencesItemsPerPage:bizagiConfig.inboxRowsPerPage;\r\n            if(defaultValue){\r\n                initValueCombo=self._findValue(params.comboDataSource.combo, defaultValue);\r\n            }\r\n        }\r\n        return initValueCombo;\r\n    },\r\n\r\n    /**\r\n     * Agrega la interaccin al comboBox y define los listeners, retorna el deferred\r\n     * @param {*} params combo, content, comboWrapper, onChange, setRowValue y getRowValue\r\n     */\r\n    renderNumberRowsCombo: function (params) {\r\n        var self = this;\r\n        var deferred = $.Deferred();\r\n        params.comboWrapper.empty();\r\n        var initValueCombo=self.initialValueCombo({\r\n            comboDataSource: params.combo,\r\n            setRowValue: params.setRowValue,\r\n            getRowValue: params.getRowValue\r\n        });\r\n        var lastValue=initValueCombo.id;\r\n        params.comboWrapper.uicombo({\r\n            isEditable: false,\r\n            data: params.combo,\r\n            itemValue: function (obj) {\r\n                return obj.id;\r\n            },\r\n            itemText: function (obj) {\r\n                return obj.name;\r\n            },\r\n            onComplete: function () {\r\n                deferred.resolve();\r\n            },\r\n            onChange: function (obj) {\r\n                var value = obj.ui.data('value');\r\n                if(value!=lastValue){\r\n                    lastValue=value;\r\n                    $(\"#userPositionInput\", params.content).val(value);\r\n                    params.setRowValue(value); //Store the value of rows\r\n                    params.onChange();\r\n                }\r\n            },\r\n            initValue: initValueCombo\r\n        });\r\n        return deferred;\r\n    },\r\n});\r\n","\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.integration\", {}, {\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.module = params.module || null;\r\n        self.selector = params.selector || \"\";   \r\n    },\r\n\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INTEGRATION;\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var selector = document.createElement(self.selector);\r\n        var content = self.content = $(selector);\r\n\r\n        return content\r\n    },\r\n    postRender: function () {\r\n        var self = this;\r\n        //Load module\r\n        if (self.module) {\r\n            bizagi.loader.start(self.module).then(function () {\r\n           });\r\n        }\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n        $(self.selector).empty()\r\n\r\n        self._super();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Workportal Desktop Inbox Widget Controller\r\n*   Author: Diego Parra (based on  Edward Morales version)\r\n*   Comments:\r\n*   -   This script will provide desktop overrides to implement the inbox widget\r\n*/\r\n\r\n// Extends itself\r\nbizagi.workportal.widgets.inbox.extend(\"bizagi.workportal.widgets.inbox\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        // Declare widget variables\r\n        self.taskState = \"all\"; // general taskState from tabs\r\n        self.icoTaskState = \"\"; // real staskState from list cases\r\n        self.idWorkflow = 0;\r\n        self.idCase = 0;\r\n        self.adhocCases = [];\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"inbox\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox\").concat(\"#ui-bizagi-workportal-widget-inbox\"),\r\n            \"inbox-cases\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox\").concat(\"#ui-bizagi-workportal-widget-inbox-cases\"),\r\n            \"inbox-cases-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox\").concat(\"#ui-bizagi-workportal-widget-inbox-cases-list\"),\r\n            \"inbox-cases-personalized-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox\").concat(\"#ui-bizagi-workportal-widget-inbox-cases-personalized-list\"),\r\n            \"inbox-common-processes\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-processes\"),\r\n            \"inbox-common-noresults\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-noresults\"),\r\n            \"inbox-common-header-view\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-header-view\"),\r\n            \"inbox-common-case-summary\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description\"),\r\n            \"inbox-common-case-summary-form\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-form\"),\r\n            \"inbox-common-case-summary-subprocess\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess\"),\r\n            \"inbox-common-case-summary-assignees\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-assignees\"),\r\n            \"inbox-common-case-summary-events\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-events\"),\r\n            \"inbox-common-case-summary-oldrender\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-oldrender\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n    /*\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        bizagi.referrerParams = (self.params.restoreStatus) ? bizagi.referrerParams || {} : {};\r\n        self.params.taskState = self.params.taskState || bizagi.referrerParams.taskState || \"all\";\r\n\r\n\r\n        // Set templates\r\n        self.processesTemplate = self.getTemplate(\"inbox-common-processes\");\r\n        self.casesTemplate = self.getTemplate(\"inbox-cases\");\r\n        //self.casesTemplateList = self.getTemplate(\"inbox-cases-list\");   // original template\r\n        self.casesTemplateList = self.getTemplate(\"inbox-cases-personalized-list\");    // personalized columns\r\n        self.caseSummaryTemplate = self.getTemplate(\"inbox-common-case-summary\");\r\n        self.caseSummaryTemplateForm = self.getTemplate(\"inbox-common-case-summary-form\");\r\n        self.caseSummaryTemplateSubprocess = self.getTemplate(\"inbox-common-case-summary-subprocess\");\r\n        self.caseSummaryTemplateAssigness = self.getTemplate(\"inbox-common-case-summary-assignees\");\r\n        self.caseSummaryTemplateEvents = self.getTemplate(\"inbox-common-case-summary-events\");\r\n\r\n        self.noResults = self.getTemplate(\"inbox-common-noresults\");\r\n        self.paginationTemplate = self.workportalFacade.getTemplate(\"inbox-common-pagination-inbox\");\r\n\r\n\r\n        // Loads inbox summary\r\n        $.when(self.dataService.getInboxSummary())\r\n                .done(function (summary) {\r\n                    self.updateSummary(summary);\r\n\r\n                    // Init with default task state\r\n                    self.changeTaskState(self.params.taskState);\r\n                });\r\n\r\n        // Configure view control\r\n        self.configureViewControl();\r\n\r\n        // Configure folders\r\n        // Check if its avalible\r\n        if (bizagi.override.enableSmartFolders) {\r\n            self.configureSmartFolders();\r\n        }\r\n        self.comboRowsPerPage=new bizagi.workportal.inbox.rowsPerPage();\r\n        self.renderNumberRowsCombo(self.comboRowsPerPage.initCombo());\r\n    },\r\n    renderNumberRowsCombo: function (comboDataSource) {\r\n        var self = this;\r\n        var content=self.getContent();\r\n        return self.comboRowsPerPage.renderNumberRowsCombo({\r\n            combo:comboDataSource,\r\n            content:content,\r\n            comboWrapper:$(\"#select-pagination\", content),\r\n            onChange:function () {\r\n                self.changeProcess();\r\n            },\r\n            setRowValue:self.setRowValue,\r\n            getRowValue:self.getRowValue\r\n        });\r\n    },\r\n    getRowValue: function() {\r\n        // Get Preferences Values\r\n        var storedValue = bizagi.services.preferences().getPreferences();\r\n        return storedValue;    \r\n    },\r\n    setRowValue: function(value) {\r\n        var self = this;\r\n        var modifiedJSON = self.getRowValue();\r\n        modifiedJSON.inboxItemsPerPage = value;\r\n        // Set Preference value\r\n        bizagi.services.preferences().overridePreferences(modifiedJSON);   \r\n    },\r\n    /**\r\n    * Modal menu with folder actions\r\n    */\r\n    configureSmartFolders: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var inboxArrow = $(\"#innerContentInbox>h2, #innerContentInbox .smartfolders\", content);\r\n\r\n        inboxArrow.click(function () {\r\n            // If the same popup is opened close it\r\n            if (self.currentPopup == \"folders\") {\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                return;\r\n            }\r\n\r\n            // Creates popup\r\n            self.popupOpened = true;\r\n            self.currentPopup = \"folders\";\r\n            self.publish(\"popupWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,\r\n                options: {\r\n                    sourceElement: \"#innerContentInbox>h2\",\r\n                    modalClass: \"folders\",\r\n                    'max-height': '346',\r\n                    height: 'auto',\r\n                    width: '110',\r\n                    offset: \"88 0\",\r\n                    activeScroll: true,\r\n                    foldersView: 'inboxdetails',\r\n                    closed: function () {\r\n                        self.currentPopup = null;\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    },\r\n    /*\r\n    *   Configures the view control for the widget\r\n    */\r\n    configureViewControl: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var eyeIcon = $(\"#ui-bizagi-wp-app-inbox-bt-eye\", content);\r\n        var eyeIconParent = $(\"#ui-bizagi-wp-app-inbox-bt-eye\", content).parent();\r\n\r\n        // Bind view handler\r\n        eyeIcon.click(function () {\r\n            // If the popup is opened close it\r\n            /* if (self.popupOpened){\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            return;\r\n            }*/\r\n\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            // Creates popup\r\n            self.popupOpened = false;\r\n            eyeIconParent.addClass(\"active\");\r\n            self.currentPopup = \"eyeDetails\";\r\n            var offset = \"0 0\";\r\n            var at = \"left bottom\";\r\n            var height = 60;\r\n            var width = 129;\r\n            var arrowPosition = {\r\n                left: \"64%\"\r\n            };\r\n\r\n            var popup = new bizagi.workportal.desktop.popup(self.dataService, self.workportalFacade, {\r\n                sourceElement: \"#ui-bizagi-wp-app-inbox-bt-eye\",\r\n                offset: offset,\r\n                at: at,\r\n                height: height,\r\n                width: width,\r\n                arrowPosition: arrowPosition\r\n            });\r\n\r\n            // Render popup\r\n            var template = self.getTemplate(\"inbox-common-header-view\");\r\n            popup.render($.tmpl(template));\r\n\r\n            // Checks for close signal to change the class again\r\n            $.when(popup.closed())\r\n                    .done(function () {\r\n                        self.popupOpened = false;\r\n                        eyeIconParent.removeClass(\"active\");\r\n                    });\r\n\r\n            // Details view\r\n            var popupContent = popup.getContent();\r\n            $(\"#viewDetailsEvent\", popupContent).click(function () {\r\n                self.publish(\"changeWidget\", {\r\n                    widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX\r\n                });\r\n                popup.close();\r\n            });\r\n\r\n            // Grid view\r\n            $(\"#viewGridEvent\", popupContent).click(function () {\r\n                self.publish(\"changeWidget\", {\r\n                    widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID\r\n                });\r\n                popup.close();\r\n            });\r\n        });\r\n    },\r\n    /*\r\n    *   Updates inbox summary\r\n    */\r\n    updateSummary: function (summary) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        // Update values\r\n        $(\".ui-bizagi-wp-app-inbox-tab#red\", content).data(\"taskState\", \"Red\");\r\n        $(\".ui-bizagi-wp-app-inbox-tab#green\", content).data(\"taskState\", \"Green\");\r\n        $(\".ui-bizagi-wp-app-inbox-tab#yellow\", content).data(\"taskState\", \"Yellow\");\r\n        $(\".ui-bizagi-wp-app-inbox-tab#favourites\", content).data(\"taskState\", \"Favorites\");\r\n\r\n        // set number of cases for each category\r\n        //{\"inboxSummary\":{\"All\":1151,\"Green\":85,\"Red\":1055,\"Black\":0,\"Yellow\":11}}\r\n        if (self.params.taskState != \"all\") {\r\n            $(\".ui-bizagi-wp-app-inbox-tab\", content).each(function (k, e) {\r\n                if ($(e).data(\"taskState\") == self.params.taskState) {\r\n                    $(e).addClass(\"active\");\r\n                } else {\r\n                    $(e).removeClass(\"active\");\r\n                }\r\n            });\r\n        }\r\n\r\n        $(\".ui-bizagi-wp-app-inbox-tab#all\", content).find(\".toolTip\").html(summary.All);\r\n        $(\".ui-bizagi-wp-app-inbox-tab#red\", content).find(\".toolTip\").html(summary.Red);\r\n        $(\".ui-bizagi-wp-app-inbox-tab#green\", content).find(\".toolTip\").html(summary.Green);\r\n        $(\".ui-bizagi-wp-app-inbox-tab#yellow\", content).find(\".toolTip\").html(summary.Yellow);\r\n\r\n        $(\".ui-bizagi-wp-app-inbox-tab\", content).click(function () {\r\n            //remove selected style\r\n            $(\".ui-bizagi-wp-app-inbox-tab\", content).removeClass(\"active\");\r\n            //set selected style\r\n            $(this).addClass(\"active\");\r\n\r\n            // get content\r\n            /* self.publish(\"changeWidget\", {\r\n            widgetName : self.params.widgetName,\r\n            taskState : $(this).data(\"taskState\")\r\n            });*/\r\n            self.changeTaskState($(this).data(\"taskState\"));\r\n        });\r\n    },\r\n    /*\r\n    *   Changes the task state and updates the content\r\n    */\r\n    changeTaskState: function (taskState) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var processesContainer = $(\"#contentProc\", content);\r\n        var smartfoldersParameters = \"\";\r\n\r\n        if (self.params.smartfoldersParameters && self.params.smartfoldersParameters.urlParameters) {\r\n            smartfoldersParameters = self.params.smartfoldersParameters.urlParameters;\r\n        }\r\n\r\n        var previewTaskState = self.params.taskState;\r\n        self.params.taskState = taskState;\r\n\r\n        // Update internal variable\r\n        if (taskState == \"Favorites\") {\r\n            self.taskState = \"all\";\r\n            self.onlyFavorites = \"true\";\r\n            if(previewTaskState !== taskState){\r\n                bizagi.referrerParams.page = \"1\";\r\n            }\r\n        } else {\r\n            self.taskState = taskState;\r\n            self.onlyFavorites = \"\";\r\n        }\r\n\r\n        $(\"#ui-bizagi-wp-app-inbox-tap-selector\", content).removeClass().addClass(taskState);\r\n\r\n        // Clear content\r\n        processesContainer.empty();\r\n\r\n        // Loads processes by task state\r\n        $.when(self.dataService.getAllProcesses({\r\n            taskState: self.taskState || \"all\",\r\n            onlyFavorites: self.onlyFavorites,\r\n            smartfoldersParameters: smartfoldersParameters\r\n        }))\r\n                .done(function (data) {\r\n                    //Remove title All processes on inbox\r\n                    if(data.categories.length > 0){\r\n                        data.categories[0].name = \"\";\r\n                    }\r\n                    // Get template\r\n                    $.tmpl(self.processesTemplate, data).appendTo(processesContainer);\r\n\r\n                    //update 11/11/2014\r\n                    //if (bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms) == true) {\r\n\r\n                        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n                            if (storedQueryForm.storedQueryForms.length > 0) {\r\n                                $.when(\r\n                                    self.workportalFacade.getWidget(\"queriesShortcut\", {})\r\n                                ).pipe(function (result) {\r\n                                    widget = result;\r\n                                    return widget.render();\r\n                                }).done(function () {\r\n                                    var content = widget.getContent();\r\n                                    $(\"#queryFormShortcut\").html(content);\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                    //}\r\n\r\n                    // Binds click handler for processes\r\n                    $(\"li\", processesContainer).click(function (event) {\r\n                        var process = $(this);\r\n\r\n                        // Remove all selected elements\r\n                        $(\".selected\", processesContainer).removeClass(\"selected\");\r\n\r\n                        // Add selected class\r\n                        process.addClass(\"selected\");\r\n\r\n                        //if click for human, restore page to 1\r\n                        if(event.currentTarget && event.currentTarget.tagName){\r\n                            bizagi.referrerParams.page = \"1\";\r\n                        }\r\n\r\n                        // Change the current process\r\n                        var idWorkflow = $(\"#idWorkflow\", process).val();\r\n                        var workflowName = $(\".ui-bizagi-wp-app-inbox-processes-name\", process).text();\r\n                        self.changeProcess({\r\n                            idWorkflow: idWorkflow,\r\n                            workflowName: workflowName,\r\n                            smartfoldersParameters: smartfoldersParameters,\r\n                            page: bizagi.referrerParams ? bizagi.referrerParams.page : undefined\r\n                        });\r\n                    });\r\n\r\n                    // Bind favorites start\r\n                    $(\".ui-bizagi-wp-app-inbox-processes-start\", processesContainer).click(function (e) {\r\n                        e.stopPropagation();\r\n                        var options;\r\n                        var elmnt = this;\r\n                        var idWorkflow = $(\"#idWorkflow\", $(elmnt).parent()).val();\r\n\r\n                        $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-processes-start\").addClass(\"ui-bizagi-wp-app-inbox-processes-start-wait\");\r\n\r\n                        // check if its favorite\r\n                        if ($(elmnt).parent().find(\"#isFavorite\").val() == \"false\") {\r\n                            options = {\r\n                                idObject: $(elmnt).parent().find(\"#guidWFClass\").val(),\r\n                                favoriteType: \"WFCLASS\"\r\n                            };\r\n                            $.when(\r\n                            self.dataService.addFavorite(options)\r\n                            ).done(function (favoritesData) {\r\n                                $(elmnt).parent().find(\"#guidFavorite\").val(favoritesData[\"idFavorites\"]);\r\n                                $(elmnt).removeClass(\"bz-icon-star-outline\").addClass(\"bz-icon-star\");\r\n                                $(elmnt).parent().find(\"#isFavorite\").val(\"true\");\r\n                                $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-processes-start-wait\").addClass(\"ui-bizagi-wp-app-inbox-processes-start\");\r\n                                self.updateCountProcess(idWorkflow, true);\r\n                            });\r\n                        } else {\r\n                            options = {\r\n                                idObject: $(elmnt).parent().find(\"#guidFavorite\").val(),\r\n                                favoriteType: \"WFCLASS\"\r\n                            };\r\n                            $.when(\r\n                            self.dataService.delFavorite(options)\r\n                            ).done(function (favoritesData) {\r\n                                if (favoritesData[\"deleted\"] == \"true\" || favoritesData[\"deleted\"] == true) {\r\n                                    $(elmnt).parent().find(\"#guidFavorite\").val(\"\");\r\n                                    $(elmnt).removeClass(\"bz-icon-star\").addClass(\"bz-icon-star-outline\");\r\n                                    $(elmnt).parent().find(\"#isFavorite\").val(\"false\");\r\n                                    $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-processes-start-wait\").addClass(\"ui-bizagi-wp-app-inbox-processes-start\");\r\n                                    self.updateCountProcess(idWorkflow, false);\r\n                                }\r\n                            });\r\n                        }\r\n\r\n                        // Update case list\r\n                        if (self.params.taskState == \"Favorites\" && $(elmnt).parent().hasClass(\"selected\")) {\r\n                            $(elmnt).parent().trigger(\"click\");\r\n                        }\r\n                    });\r\n\r\n\r\n\r\n                    $(\".ui-bizagi-wp-app-inbox-processes-title\", processesContainer).click(function () {\r\n                        var process = $(this).next(\"ul\");\r\n                        var arrow = $(this).find(\"span\");\r\n                        var isHidden = (process.is(\":hidden\")) ? true : false;\r\n                        // Check if element has been hidden\r\n                        if (isHidden) {\r\n                            process.show();\r\n                            arrow.removeClass(\"Right\");\r\n                            arrow.addClass(\"Down\");\r\n                        } else {\r\n                            process.hide();\r\n                            arrow.removeClass(\"Down\");\r\n                            arrow.addClass(\"Right\");\r\n                        }\r\n                    });\r\n\r\n                    var lastProcess = true;\r\n\r\n                    // Open first category\r\n                    if (self.params.restoreStatus) {\r\n                        $.each($(\".ui-bizagi-wp-app-inbox-processes-title\", processesContainer), function (key, value) {\r\n                            $.each($(\"li\", $(value, processesContainer).next()), function (key2, value2) {\r\n                                if ($(value2).find(\"#idWorkflow\").val() == bizagi.referrerParams.idWorkflow) {\r\n                                    $.when($(value, processesContainer).trigger(\"click\")).done(function () {\r\n                                        $(value2, processesContainer).addClass(\"selected\");\r\n                                        self.changeProcess({\r\n                                            page: bizagi.referrerParams.page,\r\n                                            idWorkflow: bizagi.referrerParams.idWorkflow,\r\n                                            workflowName: $(\".ui-bizagi-wp-app-inbox-processes-name\", $(value2, processesContainer)).text()\r\n                                        });\r\n                                        lastProcess = false;\r\n                                    })\r\n                                }\r\n                            });\r\n                        });\r\n                        self.params.restoreStatus = false;\r\n                    } else {\r\n                        $(\".ui-bizagi-wp-app-inbox-processes-title:first\", processesContainer).trigger(\"click\");\r\n                        $(\"li:first\", processesContainer).addClass(\"selected\").trigger(\"click\");\r\n                        lastProcess = false;\r\n                    }\r\n\r\n\r\n                    // Next lines applied to last submitted process in a group of processes, It must go to Inbox instead of a non-existing group of processes\r\n                    if (lastProcess) {\r\n                        $(\".ui-bizagi-wp-app-inbox-processes-title:first\", processesContainer).trigger(\"click\");\r\n                        $(\"li:first\", processesContainer).addClass(\"selected\").trigger(\"click\");\r\n                    }\r\n\r\n                    $(processesContainer).bizagiScrollbar();\r\n\r\n                    if (data.categories.length == 0) {\r\n                        self.changeProcess();\r\n                    }\r\n                });\r\n    },\r\n\r\n    /**\r\n     * Validate if the timeline icon should be shown or not, depending on features endpoint\r\n     */\r\n    isAvailableTimelineByProcessType: function (isAdhocProcess) {\r\n        return (!isAdhocProcess ||\r\n            (isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\")));\r\n    },\r\n\r\n\r\n    /*\r\n    *   Changes selected process and updates the content\r\n    */\r\n    changeProcess: function (options) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var casesContainer = $(\"#contentCases\", content);\r\n        var pageSelector = $(\"#footer #casesPagination\");\r\n        var descContainer = $(\"#contentDesc\", content);\r\n        var nElemToShow = 14;\r\n        var smartfoldersParameters = \"\";\r\n\r\n        if (self.params.smartfoldersParameters && self.params.smartfoldersParameters.urlParameters) {\r\n            smartfoldersParameters = self.params.smartfoldersParameters.urlParameters;\r\n        }\r\n\r\n        options = options || {};\r\n        var page = options[\"page\"] || 1;\r\n        bizagi.referrerParams.page = page;\r\n\r\n        var idWorkflow = options.idWorkflow!=undefined?options.idWorkflow:self.idWorkflow;\r\n        options.workflowName=options.workflowName || self.workflowName;\r\n        // Update internal variable\r\n        self.idWorkflow = idWorkflow;\r\n        self.workflowName = options.workflowName;\r\n\r\n        // Clear content\r\n        casesContainer.empty();\r\n        //casesContainer.empty();\r\n        descContainer.empty();\r\n        pageSelector.empty();\r\n\r\n        bizagi.showErrorAlertDialog = false;\r\n        // Load cases by process and task state\r\n        $.when(\r\n                self.dataService.getCasesByWorkflow({\r\n                    idWorkflow: self.idWorkflow,\r\n                    taskState: self.taskState,\r\n                    // Filter by favorites  only when we are searching all processes and favorites\r\n                    onlyFavorites: eval(self.onlyFavorites),\r\n                    page: page,\r\n                    pageSize: self.getRowValue().inboxItemsPerPage,\r\n                    smartfoldersParameters: smartfoldersParameters\r\n\r\n                }))\r\n                .done(function (data) {\r\n                    bizagi.showErrorAlertDialog = true;\r\n                    // Set list of cases for global purpose\r\n                    bizagi.lstIdCases = data.lstIdCases;\r\n                    $(data.rows).each(function(index, elem){\r\n                        if( !elem.isAdhocProcess || typeof elem.isAdhocProcess === 'undefined'){\r\n                            elem.isAdhocProcess = false;\r\n                        }else{\r\n                            elem.isAdhocProcess = true;\r\n                            self.adhocCases.push(elem);\r\n                        }\r\n                        elem.enableTimelineByProcessType = self.isAvailableTimelineByProcessType(elem.isAdhocProcess);\r\n                    });\r\n                    // add idWorkFlow\r\n                    data.idWorkflow = idWorkflow;\r\n                    // If cases container has no elements append something to hide spinner\r\n                    if (!data.rows.length) {\r\n                        casesContainer.append(\"&nbsp;\");\r\n                        descContainer.append(\"&nbsp;\");\r\n                        return;\r\n                    }\r\n\r\n                    // Extend data\r\n                    data.processName = options.workflowName || \"\";\r\n\r\n                    // show or hide \"load more\" button\r\n                    data.pagination = (data[\"totalPages\"] > 1) ? true : false;\r\n\r\n                    // set total pages\r\n                    data.pages = {};\r\n                    var totPages = data[\"totalPages\"];\r\n                    var pageToshow = (nElemToShow > data[\"totalPages\"]) ? data[\"totalPages\"] : nElemToShow;\r\n                    // Next couple Lines to ensure enough space in the pager area\r\n                    if (totPages > 9) pageToshow--;\r\n                    if (totPages > 99) pageToshow--;\r\n                    for (var i = 1; i <= pageToshow; i++) {\r\n                        data[\"pages\"][i] = {\r\n                            \"pageNumber\": i\r\n                        };\r\n                    }\r\n\r\n                    // Get security\r\n                    var security = new bizagi.workportal.command.security(self.dataService);\r\n                    data.graphicQuery = security.checkSecurityPerm(\"GraphicQuery\");\r\n\r\n                    data.enableFolders = bizagi.override.enableFolder || false;\r\n                    var paginationHtml = $.tmpl(self.paginationTemplate, data).html();\r\n\r\n                    // when show summary form from inbox grid\r\n                    data.enableFeatureShowTimelineButton = bizagi.override.enableFeatureShowTimelineButton;\r\n\r\n                    // Get template\r\n                    $(pageSelector).append(paginationHtml);\r\n\r\n                    // Render template\r\n                    $.tmpl(self.casesTemplate, data, {\r\n                        replaceLineBreak: function (string) {\r\n                            return typeof string === \"string\" ? (string.search(/\\n/) !== -1 ? string.replaceAll(\"\\n\", \"<br/>\") : string) : string;\r\n                        },\r\n                        formatMonetaryCell: function (value) {\r\n                            return bizagi.util.formatMoney(value, BIZAGI_DEFAULT_CURRENCY_INFO);\r\n                        },\r\n                        formatDecimalCell: function (value) {\r\n                            var decimalFormat;\r\n                            var externalDecimalFormat = {\r\n                                decimalSymbol: BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,\r\n                                digitGroupSymbol: BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator,\r\n                                roundToDecimalPlace: BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits\r\n                            };\r\n                            var defaultDecimalFormat = {\r\n                                colorize: false,\r\n                                decimalSymbol: \".\",\r\n                                digitGroupSymbol: \",\",\r\n                                groupDigits: true,\r\n                                negativeFormat: \"(%s%n)\",\r\n                                positiveFormat: \"%s%n\",\r\n                                roundToDecimalPlace: \"2\",\r\n                                symbol: \"\"\r\n                            };\r\n                            decimalFormat = $.extend(defaultDecimalFormat, externalDecimalFormat);\r\n                            return bizagi.util.formatDecimal(value, decimalFormat);\r\n                        },\r\n                        formatBoolean: function (value) {\r\n                            if (bizagi.util.parseBoolean(value) == true) {\r\n                                return self.getResource(\"render-boolean-yes\");\r\n                            } else if (bizagi.util.parseBoolean(value) == false) {\r\n                                return self.getResource(\"render-boolean-no\");\r\n                            } else {\r\n                                return \"\";\r\n                            }\r\n                        }\r\n                    }).appendTo(casesContainer);\r\n\r\n                    // Format invariant dates\r\n                    bizagi.util.formatInvariantDate(content, self.getResource(\"dateFormat\") + \" \" + self.getResource(\"timeFormat\"));\r\n\r\n                    // set total number pages\r\n                    $(\".scrollCases\").data(\"totalPage\", data[\"totalPages\"]);\r\n                    $(\".scrollCases\").data(\"page\", 1);\r\n\r\n                    // Crate pagination control\r\n                    $(\"ul\").bizagiPagination({\r\n                        totalPages: data.totalPages,\r\n                        actualPage: data.page,\r\n                        listElement: $(\"ul\", pageSelector),\r\n                        clickCallBack: function (options) {\r\n                            self.changeProcess({\r\n                                idWorkflow: idWorkflow,\r\n                                page: options.page\r\n                            });\r\n                        }\r\n                    });\r\n\r\n\r\n                    // Binds click handler for cases\r\n                    $(\"li\", casesContainer).click(function () {\r\n                        var cAse = $(this);\r\n                        // set real taskState\r\n                        self.icoTaskState = $(this).children(\"#caseName\").children(\"#taskState\").val();\r\n\r\n                        // Remove all selected elements\r\n                        $(\".selected\", casesContainer).removeClass(\"selected\");\r\n\r\n                        // Add selected class\r\n                        cAse.addClass(\"selected\");\r\n\r\n                        // Change the current process\r\n                        var idCase = $(\"#idCase\", cAse).val();\r\n                        var idWorkflow = $(\"#idWorkflowGQ\", cAse).val();\r\n                        self.changeCase(idCase, idWorkflow);\r\n                    });\r\n\r\n                    // Bind Folders\r\n                    $(\".ui-bizagi-inbox-folder\", casesContainer).click(function (e) {\r\n                        e.stopPropagation();\r\n                        var idCase = $(this).data(\"idcase\");\r\n\r\n                        // If the same popup is opened close it\r\n                        if (self.currentPopup == \"folders\") {\r\n                            bizagi.workportal.desktop.popup.closePopupInstance();\r\n                            return;\r\n                        }\r\n\r\n                        bizagi.workportal.desktop.popup.closePopupInstance();\r\n                        // Creates popup\r\n                        self.popupOpened = false;\r\n                        self.currentPopup = \"folders\";\r\n                        self.publish(\"popupWidget\", {\r\n                            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,\r\n                            options: {\r\n                                sourceElement: $(this),\r\n                                modalClass: \"folders\",\r\n                                'max-height': '146',\r\n                                height: 'auto',\r\n                                width: '110',\r\n                                offset: \"88 0\",\r\n                                activeScroll: true,\r\n                                onlyFolderMode: true,\r\n                                idCase: idCase,\r\n                                closed: function () {\r\n                                    self.currentPopup = null;\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    // Bind favorites start\r\n                    $(\".ui-bizagi-wp-app-inbox-cases-start\", casesContainer).click(function (e) {\r\n                        e.stopPropagation();\r\n                        var favoriteOptions;\r\n                        var elmnt = this;\r\n\r\n                        $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-cases-start\").addClass(\"ui-bizagi-wp-app-inbox-cases-start-wait\");\r\n\r\n                        // check if its favorite\r\n                        if ($(elmnt).parent().find(\"#isFavorite\").val() == \"false\") {\r\n                            favoriteOptions = {\r\n                                idObject: $(elmnt).parent().parent().find(\"#idCase\").val(),\r\n                                favoriteType: \"CASES\"\r\n                            };\r\n                            $.when(\r\n                            self.dataService.addFavorite(favoriteOptions)\r\n                            ).done(function (favoritesData) {\r\n                                $(elmnt).parent().find(\"#guidFavorite\").val(favoritesData[\"idFavorites\"]);\r\n                                $(elmnt).removeClass(\"bz-icon-star-outline\").addClass(\"bz-icon-star\");\r\n                                $(elmnt).parent().find(\"#isFavorite\").val(\"true\");\r\n                                $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-cases-start-wait\").addClass(\"ui-bizagi-wp-app-inbox-cases-start\");\r\n\r\n                                self.updateCountProcess(idWorkflow, true);\r\n                            });\r\n                        } else {\r\n                            favoriteOptions = {\r\n                                idObject: $(elmnt).parent().find(\"#guidFavorite\").val(),\r\n                                favoriteType: \"CASES\"\r\n                            };\r\n                            $.when(\r\n                            self.dataService.delFavorite(favoriteOptions)\r\n                            ).done(function (favoritesData) {\r\n                                if (favoritesData[\"deleted\"] == \"true\" || favoritesData[\"deleted\"] == true) {\r\n                                    $(elmnt).parent().find(\"#guidFavorite\").val(\"\");\r\n                                    $(elmnt).removeClass(\"bz-icon-star\").addClass(\"bz-icon-star-outline\");\r\n                                    $(elmnt).parent().find(\"#isFavorite\").val(\"false\");\r\n                                    $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-cases-start-wait\").addClass(\"ui-bizagi-wp-app-inbox-cases-start\");\r\n                                    self.updateCountProcess(idWorkflow, false);\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    if (data.rows.length > 0) {\r\n                        // Make first item selected\r\n                        self.icoTaskState = $(\"li:first\", casesContainer).children(\"#taskState\").val();\r\n                        $(\"li:first\", casesContainer).addClass(\"selected\").trigger(\"click\");\r\n\r\n                    } else {\r\n                        self.changeCase(0);\r\n                    }\r\n\r\n                    $(casesContainer).bizagiScrollbar();\r\n                }).fail(function (error) {\r\n                    error = JSON.parse(error.responseText) || {};\r\n                    var caseSummaryContainer = $(\"#contentDesc\", content);\r\n                    var errorTemplate = self.workportalFacade.getTemplate(\"info-message\");\r\n                    var message = error.message || error;\r\n                    var errorHtml = $.tmpl(errorTemplate, {\r\n                        message: message,\r\n                        css: 'ui-bizagi-info-inbox-detail'\r\n                    });\r\n                    // Remove loading icon from summary container\r\n                    caseSummaryContainer.append('&nbsp;');\r\n\r\n                    errorHtml.appendTo(casesContainer);\r\n                });\r\n    },\r\n    /*\r\n    *   Changes the selected case and updates the content\r\n    */\r\n    changeCase: function (idCase, idWorkflow) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var caseSummaryContainer = $(\"#contentDesc\", content);\r\n        var cache = {};\r\n        var htmlContent = \"\";\r\n        var isAdhoc = false;\r\n        var idProcess = null;\r\n        // Clear content\r\n        caseSummaryContainer.empty();\r\n        for(var i = 0; i < this.adhocCases.length; i++){\r\n            if( idCase == this.adhocCases[i].id ){\r\n                isAdhoc = true;\r\n                idProcess = this.adhocCases[i].idAdhocProcess;\r\n            }\r\n        }\r\n        // Update internal variable\r\n        self.idCase = idCase;\r\n\r\n        // Don't search data when there is no case\r\n        if (self.idCase == 0) {\r\n            return;\r\n        }\r\n\r\n        // Render Form Tab\r\n        $.when(\r\n                self.dataService.summaryCaseDetails({\r\n                    idCase: self.idCase\r\n                })\r\n                ).done(function (data) {\r\n                    data.hasComments = (data.hasComments == 'true') ? true : false;\r\n\r\n                    // Get security\r\n                    var security = new bizagi.workportal.command.security(self.dataService);\r\n                    data.graphicQuery = security.checkSecurityPerm(\"GraphicQuery\");\r\n\r\n                    // when inbox is showed in details mode.\r\n                    data.enableFeatureShowTimelineButton = bizagi.override.enableFeatureShowTimelineButton;\r\n                    data.enableTimelineByProcessType = self.isAvailableTimelineByProcessType(data.isAdhocProcess);\r\n\r\n                    if(typeof data.contextualized === \"undefined\"){\r\n                        data.contextualized = true;\r\n                    }\r\n\r\n                    if(data.currentState && data.currentState.length > 0){\r\n                        data.currentState.forEach(function(currentState){\r\n                            if(!currentState.idTask){\r\n                                currentState.idTask = 0;\r\n                            }\r\n                            if(!currentState.state){\r\n                                currentState.state = currentState.displayName || \" \";\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    if(data.process === \"undefined\" || data.process === \"\" || typeof data.process === \"undefined\"){\r\n                        data.process = false;\r\n                    }\r\n\r\n                    if(data.processPath === \"undefined\" || data.processPath === \"\" || typeof data.processPath === \"undefined\"){\r\n                        data.processPath = false;\r\n                    }\r\n\r\n                    var summary = $.tmpl(self.caseSummaryTemplate, $.extend(data, {security: bizagi.menuSecurity})).appendTo(caseSummaryContainer);\r\n\r\n                    // Format invariant dates\r\n                    bizagi.util.formatInvariantDate(content, self.getResource(\"dateFormat\") + \" \" + self.getResource(\"timeFormat\"));\r\n\r\n                    // Delegate events for parent process\r\n                    $(\"#details\", summary).delegate(\".summaryLink\", \"click\", function () {\r\n                        self.routingExecute($(this));\r\n                    });\r\n\r\n                    // jQuery-ui\r\n                    $(\"#ui-bizagi-details-tabs\", content).tabs({\r\n                        active: -1,\r\n                        create: function (event, ui) {\r\n                            $(this).tabs(\"option\", \"active\", 0);\r\n                        },\r\n                        activate: function (event, ui) {\r\n                            var panel = (ui == undefined) ? \"formSummary\" : ui.newPanel.attr('id');\r\n                            switch (panel) {\r\n\r\n                                case \"comments\":\r\n                                    if (cache[\"comments\"] == undefined) {\r\n                                        // Extend render with comments\r\n                                        $.extend(self, {}, bizagi.workportal.comments);\r\n\r\n                                        // Define canvas\r\n                                        data.canvas = $(\"#comments\", caseSummaryContainer);\r\n                                        data.readOnly = true;\r\n\r\n                                        $.when(self.renderComments(data))\r\n                                    .done(function (htmlContent) {\r\n                                        cache[\"comments\"] = htmlContent;\r\n                                    });\r\n                                    }\r\n                                    bizagi.util.setContext({\r\n                                        commentsFocus: true\r\n                                    });\r\n                                    break;\r\n                                case \"formSummary\":\r\n                                    if (cache[\"formSummary\"] == undefined) {\r\n                                        var canvas = $(\"#formSummary\", caseSummaryContainer);\r\n\r\n                                        // Define action when render form has not been migrated\r\n                                        canvas.bind(\"oldrenderintegration\", function (e) {\r\n                                            if (e.isPropagationStopped()) {\r\n                                                return;\r\n                                            }\r\n                                            e.stopPropagation();\r\n\r\n                                            var template = self.getTemplate(\"inbox-common-case-summary-oldrender\");\r\n                                            var data = {};\r\n\r\n                                            bizagi.oldrenderevent = true; // has been loaded\r\n                                            var eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\";\r\n                                            var eventer = window[eventMethod];\r\n                                            var messageEvent = eventMethod == \"attachEvent\" ? \"onmessage\" : \"message\";\r\n\r\n                                            // Listen to message from child window\r\n                                            eventer(messageEvent, function (e) {\r\n                                                e.stopPropagation();\r\n                                                self.publish(\"executeAction\", {\r\n                                                    action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                                                    idCase: e.data\r\n                                                });\r\n                                            }, false);\r\n\r\n                                            // Define wirkitem and idtask\r\n                                            $.when(self.dataService.getWorkitems({\r\n                                                idCase: self.idCase,\r\n                                                onlyUserWorkItems: true\r\n                                            })).done(function (getWorkitems) {\r\n                                                // verify workitem, in some cases these variables are not available\r\n                                                if (typeof getWorkitems.workItems == \"object\" && getWorkitems.workItems.length >= 1) {\r\n                                                    // Case Open\r\n                                                    var idWorkitem = getWorkitems.workItems[0]['idWorkItem'];\r\n                                                    var idTask = getWorkitems.workItems[0]['idTask'];\r\n                                                    data.url = self.dataService.serviceLocator.getUrl(\"old-render\") + \"?PostBack=1&idCase=\" + self.idCase + \"&idWorkitem=\" + idWorkitem + \"&idTask=\" + idTask + \"&isSummary=1\";\r\n                                                } else {\r\n                                                    // Case closed\r\n                                                    data.url = self.dataService.serviceLocator.getUrl(\"old-render\") + \"?PostBack=1&idCase=\" + self.idCase + \"&isSummary=1\";\r\n                                                }\r\n\r\n                                                // Render content\r\n                                                canvas.empty();\r\n                                                $.tmpl(template, data).appendTo(canvas);\r\n                                                //Set styles\r\n                                                self.iframeOldRender($(\"iframe\", canvas));\r\n                                                // Recalculate size panel\r\n                                                self.performResizeLayout();\r\n                                            });\r\n                                        });\r\n\r\n                                        var params = {\r\n                                            idCase: self.idCase\r\n                                        };\r\n\r\n                                        $.when(self.dataService.getCaseFormsRenderVersion(params))\r\n                                    .done(function (formsVersion) {\r\n                                        if (formsVersion.formsRenderVersion == 1) {\r\n                                            canvas.trigger(\"oldrenderintegration\");\r\n                                        } else {\r\n                                            $.when(self.renderSummaryForm(canvas))\r\n                                            .done(function () {\r\n                                                htmlContent = $(\"#formSummary\", caseSummaryContainer).html();\r\n                                                cache[\"formSummary\"] = htmlContent;\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                                case \"subprocess\":\r\n                                    if (cache[\"subprocess\"] == undefined) {\r\n                                        $.when(\r\n                                    self.dataService.summarySubProcess({\r\n                                        idCase: self.idCase\r\n                                    }))\r\n                                    .done(function (subprocess) {\r\n                                        htmlContent = $.tmpl(self.caseSummaryTemplateSubprocess, subprocess);\r\n                                        htmlContent.appendTo($(\"#subprocess\", caseSummaryContainer));\r\n                                        cache[\"subprocess\"] = htmlContent;\r\n\r\n                                        // Define Events for subprocess tab\r\n                                        htmlContent.delegate(\".summaryLink\", \"click\", function () {\r\n                                            self.routingExecute($(this));\r\n                                        });\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                                case \"assignees\":\r\n                                    if (cache[\"assignees\"] == undefined) {\r\n                                        $.when(\r\n                                    self.dataService.summaryAssigness({\r\n                                        idCase: self.idCase,\r\n                                        preview:true\r\n                                    }))\r\n                                    .done(function (assignees) {\r\n                                        // Generates  lists of unique assignees for Events\r\n                                        var eventsUniqueList = [];\r\n                                        $.each(assignees.events.split(\", \"), function (i, el) {\r\n                                            if ($.inArray(el, eventsUniqueList) === -1) eventsUniqueList.push(el);\r\n                                        });\r\n                                        assignees.events = eventsUniqueList.join(\", \");\r\n\r\n                                        // Generates  lists of unique assignees for activities\r\n                                        var activitiesUniqueList = [];\r\n                                        $.each(assignees.activities.split(\", \"), function (i, el) {\r\n                                            if ($.inArray(el, activitiesUniqueList) === -1) activitiesUniqueList.push(el);\r\n                                        });\r\n                                        assignees.activities = activitiesUniqueList.join(\", \");\r\n                                        htmlContent = $.tmpl(self.caseSummaryTemplateAssigness, assignees);\r\n                                        htmlContent.appendTo($(\"#assignees\", caseSummaryContainer));\r\n                                        cache[\"assignees\"] = htmlContent;\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                                case \"events\":\r\n                                    if (cache[\"events\"] == undefined) {\r\n                                        $.when(\r\n                                    self.dataService.summaryCaseEvents({\r\n                                        idCase: self.idCase\r\n                                    }))\r\n                                    .done(function (events) {\r\n                                        htmlContent = $.tmpl(self.caseSummaryTemplateEvents, events);\r\n                                        htmlContent.appendTo($(\"#events\", caseSummaryContainer));\r\n                                        cache[\"events\"] = htmlContent;\r\n\r\n                                        htmlContent.delegate(\".summaryLink\", \"click\", function () {\r\n                                            self.routingExecute($(this));\r\n                                        });\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    // set even style for process and cases\r\n                    $.each($(\"#ui-bizagi-wp-app-inbox-processes-container li:even, #ui-bizagi-wp-app-inbox-cases-container li:even\"), function () {\r\n                        $(this).addClass(\"ui-bizagi-wp-app-inbox-evenColor\");\r\n                    });\r\n\r\n                    // Add click to timeline icon\r\n                    $(\".js-show-timeline\", content).click(function (event){\r\n                        var caseNumber = $.trim($(this).closest(\"div.ui-bizagi-wp-app-inbox-processes-title\").find(\"span.js-case-number\").text());\r\n                        self.showTimeLine({ radNumber: caseNumber, idCase: idCase });\r\n                    });\r\n\r\n                    // Add click to view workflow\r\n                    $(\".ui-bizagi-wp-app-inbox-cases-ico-view\", content).click(function () {\r\n                        if( isAdhoc ){\r\n                            self.showGraphicQuery({ idCase: idCase, idWorkflow: idWorkflow, isAdhoc: true, idProcess: idProcess });\r\n                        }else {\r\n                            self.showGraphicQuery({idCase: idCase, idWorkflow: idWorkflow});\r\n                        }\r\n                    });\r\n\r\n\r\n                    //Work on it button\r\n                    $(\".workonitRow\", content).button();\r\n\r\n                    // Bind work on it button\r\n                    $(\".workonitRow\", content).click(function () {\r\n                        // Executes routing action\r\n                        var idWorkItem = $(this).parent().find(\"#idWorkItem\").val();\r\n                        var referrerParams = {\r\n                            taskState: self.params.taskState,\r\n                            idWorkItem: idWorkItem,\r\n                            idCase: self.idCase,\r\n                            idTask: $(this).parent().find(\"#idTask\").val(),\r\n                            onlyFavorites: self.onlyFavorites,\r\n                            idWorkflow: self.idWorkflow,\r\n                            referrer: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX\r\n                        }\r\n\r\n                        $.extend(bizagi.referrerParams, bizagi.referrerParams, referrerParams);\r\n                        self.publish(\"executeAction\", {\r\n                            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                            idCase: self.idCase,\r\n                            idTask: $(this).parent().find(\"#idTask\").val(),\r\n                            idWorkItem: idWorkItem,\r\n                            idWorkflow: idWorkflow //idWorkflow for graphic query bucause self.idworkflow is a wfClass\r\n                        });\r\n                    });\r\n\r\n                    self.resizeLayout();\r\n                    $(\".scrollProcess\").bizagiScrollbar();\r\n                    $(\".scrollSummary\").bizagiScrollbar({\r\n                        autohide: false\r\n                    });\r\n                });\r\n    },\r\n    /**\r\n    * Load more cases when scroll controler reach button position\r\n    */\r\n    casesPagination: function (options) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var casesContainer = $(\"#contentCases\", content);\r\n        var listContainer = $(\"#contentCases .scrollCases ul\", content);\r\n        var def = new $.Deferred();\r\n\r\n        // Update internal variable\r\n        self.idWorkflow = options['idWorkflow'];\r\n        self.page = options['page'] || 2;\r\n\r\n        bizagi.showErrorAlertDialog = false;\r\n        // Load cases by process and task state\r\n        $.when(self.dataService.getCasesByWorkflow({\r\n            idWorkflow: self.idWorkflow,\r\n            taskState: self.taskState,\r\n            page: self.page\r\n        }))\r\n                .done(function (data) {\r\n                bizagi.showErrorAlertDialog = true;\r\n                    data.processName = \"\";\r\n                    // Get template\r\n                    $.tmpl(self.casesTemplateList, data).appendTo(listContainer);\r\n\r\n                    // Binds click handler for cases\r\n                    $(\"li\", casesContainer).click(function () {\r\n                        var cAse = $(this);\r\n\r\n                        // Remove all selected elements\r\n                        $(\".selected\", casesContainer).removeClass(\"selected\");\r\n\r\n                        // Add selected class\r\n                        cAse.addClass(\"selected\");\r\n\r\n                        // Change the current process\r\n                        var idCase = $(\"#idCase\", cAse).val();\r\n                        var idWorkflow = $(\"#idWorkflowGQ\", cAse).val();\r\n\r\n                        self.changeCase(idCase, idWorkflow);\r\n                    });\r\n\r\n                    // Resolve deferred\r\n                    def.resolve();\r\n                }).fail(function (error) {\r\n                    error = JSON.parse(error.responseText) || {};\r\n                    var errorTemplate = self.workportalFacade.getTemplate(\"info-message\");\r\n                    var message = error.message || error;\r\n                    var errorHtml = $.tmpl(errorTemplate, {\r\n                        message: message\r\n                    });\r\n\r\n                    $('.ui-bizagi-error', errorHtml).width(\"50%\");\r\n\r\n                    errorHtml.appendTo(casesContainer);\r\n                    def.resolve();\r\n                });\r\n\r\n        return def.promise();\r\n\r\n    },\r\n    /*\r\n    *   When the window resizes, runs this method to adjust stuff in each controller or widget\r\n    *   Override when needed\r\n    */\r\n    performResizeLayout: function () {\r\n        var self = this;\r\n\r\n        // Call base\r\n        this._super();\r\n\r\n        // Trigger render resize\r\n        if (self.renderingFacade) {\r\n            self.renderingFacade.resize({\r\n                forceResize: true\r\n            });\r\n        }\r\n    },\r\n    /**\r\n    *  Change total processes indicator, when start favorites view and user select or deselect\r\n    *  favorite cases.\r\n    *\r\n    *  @param increment  {true || false }, true= increment +1 , false = decrement -1, default true.\r\n    */\r\n    updateCountProcess: function (idWorkflow, increment) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var processesContainer = $(\"#contentProc\", content);\r\n        var assigned = false;\r\n\r\n        increment = (increment) ? true : false;\r\n\r\n        // Check if task state is diferent to Favorites\r\n        if (self.params.taskState != \"Favorites\" || idWorkflow == \"\") {\r\n            return true;\r\n        }\r\n\r\n\r\n        // Get all process and verify new favorites count\r\n        // Loads processes by task state\r\n        $.when(self.dataService.getAllProcesses({\r\n            taskState: self.taskState,\r\n            onlyFavorites: self.onlyFavorites\r\n        }))\r\n                .done(function (data) {\r\n                    data.categories = data.categories || {};\r\n                    $.each(data.categories, function (key, value) {\r\n                        $.each(value.workflows, function (key2, value2) {\r\n                            if (value2.idworkflow == idWorkflow) {\r\n                                // update value\r\n                                // Find list elements\r\n                                $('li > input[value=\"' + idWorkflow + '\"][id=\"idWorkflow\"]', processesContainer).parent().find(\".ui-bizagi-wp-app-inbox-processes-ncase\").html(value2.count);\r\n                                assigned = true;\r\n                            }\r\n                        })\r\n                    });\r\n\r\n                    //Remove title All processes on inbox\r\n                    data.categories[bizagi.localization.getResource('workportal-widget-inbox-all-processes')].key = \"\";\r\n\r\n                    // If element reach 0 cases, set 0\r\n                    if (!assigned) {\r\n                        if (increment) {\r\n                            $('li > input[value=\"' + idWorkflow + '\"][id=\"idWorkflow\"]', processesContainer).parent().find(\".ui-bizagi-wp-app-inbox-processes-ncase\").html(1);\r\n                        } else {\r\n                            $('li > input[value=\"' + idWorkflow + '\"][id=\"idWorkflow\"]', processesContainer).parent().find(\".ui-bizagi-wp-app-inbox-processes-ncase\").html(0);\r\n                        }\r\n                    }\r\n                });\r\n    },\r\n    /**\r\n    * Inject styles and js into the iframe\r\n    */\r\n    iframeOldRender: function (canvas) {\r\n        var self = this;\r\n        var iframe;\r\n        var content = self.getContent();\r\n        var theme = \"bizagiDefault\";\r\n        var queryString = bizagi.readQueryString();\r\n\r\n        $.each(canvas, function () {\r\n            if ($(this).is(\"iframe\")) {\r\n                iframe = $(this);\r\n            }\r\n        });\r\n\r\n        iframe.load(function () {\r\n            // inject css\r\n            var content = $(this).contents();\r\n\r\n            // Fixed problem with relative path across the different browsers\r\n            var cssLocation = ($.browser.mozilla || $.browser.webkit) ? \"../../css/render_%theme%.css\" : \"css/render_%theme%.css\";\r\n\r\n            // Append javascript\r\n            $('head', content).append(\"<script type='text/javascript' src='../../js/renderintegration.js'></script>\");\r\n\r\n            // Define theme\r\n            cssLocation = cssLocation.replace(\"%theme%\", (queryString[\"theme\"] || theme));\r\n\r\n            // Append css\r\n            $('body', content).append(\"<link type='text/css' rel='stylesheet' href='\" + cssLocation + \"'>\");\r\n        });\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Workportal Desktop Inbox grid Widget Controller\r\n*   Author: Diego Parra (based on  Edward Morales version)\r\n*   Comments:\r\n*   -   This script will provide desktop overrides to implement the inbox grid widget\r\n*/\r\n\r\n// Extends itself\r\nbizagi.workportal.widgets.inboxGrid.extend(\"bizagi.workportal.widgets.inboxGrid\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        // Declare widget variables\r\n        self.taskState = \"all\"; // general taskState from tabs\r\n        self.icoTaskState = \"\"; // real staskState from list cases\r\n        self.idWorkflow = 0;\r\n        self.isAdhocProcess = true;\r\n        self.idCase = 0;\r\n        self.page = 0;\r\n        self.adhocIds = [];\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"inbox-grid\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.grid\").concat(\"#ui-bizagi-workportal-widget-inbox-grid\"),\r\n            \"inbox-grid-rubik\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.grid\").concat(\"#ui-bizagi-workportal-widget-inbox-grid-rubik\"),\r\n            \"inbox-grid-cases\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.grid\").concat(\"#ui-bizagi-workportal-widget-inbox-grid-cases\"),\r\n            \"inbox-common-processes\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-processes\"),\r\n            \"inbox-common-header-view\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-header-view\"),\r\n            \"inbox-common-case-summary\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description\"),\r\n            \"inbox-common-case-summary-subprocess\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess\"),\r\n            \"inbox-common-case-summary-assignees\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-assignees\"),\r\n            \"inbox-common-case-summary-events\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-case-description-events\"),\r\n            \"inbox-common-case-summary-oldrender\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.inbox.common\").concat(\"#ui-bizagi-workportal-widget-inbox-common-oldrender\"),\r\n            useNewEngine: false\r\n        });\r\n\r\n        \r\n    },\r\n    /*\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        bizagi.referrerParams = (self.params.restoreStatus) ? bizagi.referrerParams || {} : {};\r\n        self.params.taskState = self.params.taskState || bizagi.referrerParams.taskState || \"all\";\r\n\r\n\t        // Set templates\r\n\t        self.processesTemplate = self.getTemplate(\"inbox-common-processes\");\r\n\t        self.casesTemplate = self.getTemplate(\"inbox-grid-cases\");\r\n\t        self.caseSummaryTemplate = self.getTemplate(\"inbox-common-case-summary\");\r\n\t        self.caseSummaryTemplateSubprocess = self.getTemplate(\"inbox-common-case-summary-subprocess\");\r\n\t        self.caseSummaryTemplateAssigness = self.getTemplate(\"inbox-common-case-summary-assignees\");\r\n\t        self.caseSummaryTemplateEvents = self.getTemplate(\"inbox-common-case-summary-events\");\r\n\t        self.paginationTemplate = self.workportalFacade.getTemplate(\"inbox-common-pagination-grid\");\r\n\r\n\tvar security = new bizagi.workportal.command.security(self.dataService);\r\n        security.checkSecurityPerm(\"Inbox\").done(function (inbox) {\r\n            \r\n\t    if (inbox) {\r\n\t\t        // Loads inbox summary\r\n\t\t            $.when(self.dataService.getInboxSummary())\r\n\t\t                    .done(function (summary) {\r\n\t\t                        self.updateSummary(summary);\r\n\t\t                        self.resizeLayout();\r\n\t\t                        // Init with default task state\r\n\t\t                        self.changeTaskState(self.params.taskState);\r\n\t\t                    });\r\n\r\n\t\t            // Configure view control\r\n\t\t            self.configureViewControl();\r\n\r\n\t\t            // Configure folders\r\n\t\t            // Check if its avalible\r\n\t\t            if (bizagi.override.enableSmartFolders) {\r\n\t\t                self.configureSmartFolders();\r\n\t\t            }\r\n\t    \t    } \r\n    \t     else {\r\n                $(\"#contentInbox\").remove();\r\n                $(\"#contentFramework\").remove();\r\n                $(\"#footer\").remove();\r\n                self.content = $(\"<div class=\\\"wp-empty\\\"></div>\");\r\n            }\r\n            self.comboRowsPerPage=new bizagi.workportal.inbox.rowsPerPage();\r\n            self.renderNumberRowsCombo(self.comboRowsPerPage.initCombo());\r\n        });\r\n        \r\n    },\r\n\r\n    renderNumberRowsCombo: function (comboDataSource) {\r\n        var self = this;\r\n        var content=self.getContent();\r\n        return self.comboRowsPerPage.renderNumberRowsCombo({\r\n            combo:comboDataSource,\r\n            content:content,\r\n            comboWrapper:$(\"#select-pagination\", content),\r\n            onChange:function () {\r\n                self.changeProcess();\r\n            },\r\n            setRowValue: self.setRowValue,\r\n            getRowValue: self.getRowValue\r\n        });\r\n    },\r\n    getRowValue: function() {\r\n        // Get Preferences Values\r\n        var storedValue = bizagi.services.preferences().getPreferences();\r\n        return storedValue;   \r\n    },\r\n    setRowValue: function(value) {\r\n        var self = this;\r\n        var modifiedJSON = self.getRowValue();\r\n        modifiedJSON.inboxItemsPerPage = Number(value);\r\n        // Set preferences value\r\n        bizagi.services.preferences().overridePreferences(modifiedJSON); \r\n    },\r\n    /**\r\n    * Modal menu with folder actions\r\n    */\r\n    configureSmartFolders: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var inboxArrow = $(\"#innerContentInbox>h2, #innerContentInbox .smartfolders\", content);\r\n\r\n        inboxArrow.click(function () {\r\n            // If the same popup is opened close it\r\n            if (self.currentPopup == \"folders\") {\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                return;\r\n            }\r\n\r\n            // Creates popup\r\n            self.popupOpened = true;\r\n            self.currentPopup = \"folders\";\r\n            self.publish(\"popupWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,\r\n                options: {\r\n                    sourceElement: \"#innerContentInbox>h2\",\r\n                    modalClass: \"folders\",\r\n                    'max-height': '346',\r\n                    height: 'auto',\r\n                    width: '110',\r\n                    offset: \"88 0\",\r\n                    activeScroll: true,\r\n                    foldersView: 'inboxgrid',\r\n                    closed: function () {\r\n                        self.currentPopup = null;\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    },\r\n    /*\r\n    *   Configures the view control for the widget\r\n    */\r\n    configureViewControl: function () {\r\n        // We can use the same code than the normal version\r\n        // in case we use a different template or something we need to reimplement this\r\n        bizagi.workportal.widgets.inbox.prototype.configureViewControl.apply(this, arguments);\r\n    },\r\n    /*\r\n    *   Updates inbox summary\r\n    */\r\n    updateSummary: function (summary) {\r\n        // We can use the same code than the normal version\r\n        // in case we use a different template or something we need to reimplement this\r\n        bizagi.workportal.widgets.inbox.prototype.updateSummary.apply(this, arguments);\r\n    },\r\n    /*\r\n    *   Changes the task state and updates the content\r\n    */\r\n    changeTaskState: function (taskState) {\r\n        // We can use the same code than the normal version\r\n        // in case we use a different template or something we need to reimplement this\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var procContainer = $(\"#contentProc\", content);\r\n        bizagi.workportal.widgets.inbox.prototype.changeTaskState.apply(this, arguments);\r\n        // Add scroll bars\r\n        $(procContainer).bizagiScrollbar();\r\n\r\n    },\r\n\r\n    /**\r\n     * validate needed params for the self.changeProcess request, return json with the params\r\n     * @param {ClassReference} self this class reference\r\n     * @param {JSON} options taskState,idWorkflow,orderType,order,orderFieldName,page,\r\n     */\r\n    setFiltersOnChangeProcess:function (self,options) {\r\n        var res={};\r\n        res.page = (options[\"page\"] && options[\"page\"]>0)?options[\"page\"]:1;\r\n        res.taskState = options.taskState || self.taskState;\r\n        res.idWorkflow = options.idWorkflow!=undefined?options.idWorkflow:(self.idWorkflow || \"\");\r\n        // Set order vars\r\n        res.orderFieldName = options[\"orderFieldName\"] || (options.idWorkflow==self.idWorkflow || options.idWorkflow==undefined?self.orderFieldName : \"\");\r\n        res.orderType = options[\"orderType\"]!=undefined?options[\"orderType\"] : (options.idWorkflow==self.idWorkflow || options.idWorkflow==undefined?self.orderType : \"0\");\r\n        res.order = options[\"order\"] || (options.idWorkflow==self.idWorkflow || options.idWorkflow==undefined?self.order : \"\");\r\n\r\n        // Update internal variable\r\n        self.idWorkflow = res.idWorkflow;\r\n        self.orderFieldName = res.orderFieldName;\r\n        self.orderType = res.orderType;\r\n        self.order = res.order;\r\n        return res;\r\n    },\r\n\r\n     /**\r\n       * Validate if the timeline icon should be shown or not, depending on features endpoint\r\n       */\r\n    isAvailableTimelineByProcessType: function (isAdhocProcess) {\r\n        return (!isAdhocProcess ||\r\n            (isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\")));\r\n    },\r\n\r\n    /*\r\n    *   Changes selected process and updates the content\r\n    */\r\n    changeProcess: function (options) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var casesContainer = $(\"#contentCases\", content);\r\n        var procContainer = $(\"#contentProc\", content);\r\n        var pageSelector = $(\"#footer #casesPagination\");\r\n        var nElemToShow = 14;\r\n        options = options || {};\r\n\r\n        var res=self.setFiltersOnChangeProcess(self,options);\r\n        var page = res.page;\r\n        var taskState = res.taskState;\r\n        var idWorkflow = res.idWorkflow;\r\n        var orderFieldName = res.orderFieldName;\r\n        var orderType = res.orderType;\r\n        var order = res.order;\r\n\r\n        bizagi.referrerParams.page = page;\r\n        \r\n        var smartfoldersParameters = \"\";\r\n        \r\n        if (self.params.smartfoldersParameters && self.params.smartfoldersParameters.urlParameters) {\r\n            smartfoldersParameters = self.params.smartfoldersParameters.urlParameters;\r\n        }\r\n        // Clear content\r\n        casesContainer.empty();\r\n        pageSelector.hide().empty();\r\n\r\n        // Load cases by process and task state\r\n        bizagi.showErrorAlertDialog = false;\r\n        $.when(self.dataService.getCustomizedColumnsData({\r\n            idWorkflow: idWorkflow,\r\n            taskState: taskState,\r\n            // Filter by favorites  only when we are searching all processes and favorites\r\n            onlyFavorites: eval(self.onlyFavorites),\r\n            // Sort and order parameters\r\n            order: order,\r\n            orderFieldName: orderFieldName,\r\n            orderType: orderType,\r\n            page: page,\r\n            pageSize: self.getRowValue().inboxItemsPerPage,\r\n            smartfoldersParameters: smartfoldersParameters,\r\n            group: (bizagiConfig.groupByCaseNumber)?\"T_RADNUMBER\":null\r\n        })).done(function (data) {\r\n            bizagi.showErrorAlertDialog = true;\r\n            $(data.cases.rows).each(function(key, value){\r\n                if(!value.isAdhocProcess || typeof value.isAdhocProcess ==='undefined' ) value.isAdhocProcess = false;\r\n                if( value.isAdhocProcess ){\r\n                    self.adhocIds.push({\r\n                        'caseId': value.id,\r\n                        'processId': value.idAdhocProcess\r\n                    });\r\n                }\r\n                value.enableTimelineByProcessType = self.isAvailableTimelineByProcessType(value.isAdhocProcess);\r\n            });\r\n            // Define list of cases\r\n            bizagi.lstIdCases = data.cases.lstIdCases;\r\n\r\n            //  Hack json data :(\r\n            var i = 0;\r\n            $(data.cases.columnTitle).each(function (key, value) {\r\n                if (value.order == \"T_idTask\") {\r\n                    $(data.cases.rows).each(function (key2, value2) {\r\n                        if (!self.isArray(value2[\"fields\"][i])) {\r\n                            data[\"cases\"][\"rows\"][key2][\"fields\"][i] = {\r\n                                \"workitems\": [{\r\n                                    \"TaskName\": value2[\"fields\"][i],\r\n                                    \"State\": data[\"cases\"][\"rows\"][key2][\"taskState\"]\r\n                                }]\r\n                            };\r\n                        }\r\n                    });\r\n                }\r\n                i++;\r\n            });\r\n\r\n            // Show or hide \"load more\" button\r\n            var pdata = {};\r\n            pdata.pagination = (data[\"cases\"][\"totalPages\"] > 1) ? true : false;\r\n            pdata.page = bizagi.referrerParams.page || data[\"cases\"][\"page\"];\r\n\r\n            // set total pages\r\n            pdata.pages = {};\r\n            var pageToshow = (nElemToShow > data[\"cases\"][\"totalPages\"]) ? data[\"cases\"][\"totalPages\"] : nElemToShow;\r\n            for (i = 1; i <= pageToshow; i++) {\r\n                pdata.pages[i] = {\r\n                    \"pageNumber\": i\r\n                };\r\n            }\r\n\r\n            // Set style pagination\r\n            pdata[\"gridPagination\"] = \"gridCasePagination\";\r\n            pdata.previousPage = (data.cases.page > 1) ? data.cases.page - 1 : 1;\r\n            pdata.nextPage = (data.cases.page < data.cases.totalPages) ? data.cases.page + 1 : data.cases.totalPages;\r\n            pdata.totalPages = data.cases.totalPages;\r\n            if(pdata.totalPages>1){\r\n                var paginationHtml = $.tmpl(self.paginationTemplate, pdata).html();\r\n\r\n                // Get template\r\n                $(pageSelector).show().append(paginationHtml);\r\n            }\r\n            data.cases.enableFolders = bizagi.override.enableFolder || false;\r\n            data.cases = bizagi.util.formatDecimalAndMoneyCell(data.cases, BIZAGI_DEFAULT_CURRENCY_INFO);\r\n\r\n            // Get security\r\n            var security = new bizagi.workportal.command.security(self.dataService);\r\n            $.when(security.checkSecurityPerm(\"GraphicQuery\"),\r\n                security.checkSecurityPerm(\"TimeLine\")).done(function (graphicQuery, timeLine) {\r\n                data.cases.graphicQuery = graphicQuery;\r\n                data.cases.timeLine = timeLine && bizagi.override.enableFeatureShowTimelineButton;\r\n                data.cases.groupByCaseNumber = bizagiConfig.groupByCaseNumber;\r\n                // Get template\r\n                var renderedTemplate = $.tmpl(self.casesTemplate, data.cases, {\r\n                    showMagicButton: function () { return bizagi.override.enableAdhocProcess; },\r\n                    setFormat: self.formatValue,\r\n                    isArray: self.isArray,\r\n                    formatCategories: self.formatCategories,\r\n                    isDate: bizagi.util.isDate,\r\n                    replaceLineBreak: function (string) {\r\n                        return typeof string === \"string\" ? (string.search(/\\n/) !== -1 ? string.replaceAll(\"\\n\", \"<br/>\") : string) : string;\r\n                    },\r\n                    getRadNumberColumnIndex: function(){\r\n                        var data = this.data;\r\n                        var index = -1;\r\n                        for(var i=0,l=data.columnTitle.length; i<l;i++){\r\n                            if(data.columnTitle[i].fieldName ==\"I_RadNumber\"){\r\n                                index = i;\r\n                            }\r\n                        }\r\n                        return index;\r\n                    },\r\n                    showColumn:function(columnIndex) {\r\n                        var index = this.getRadNumberColumnIndex();\r\n                        return (this.data.groupByCaseNumber && index == columnIndex)? \" style=display:none; \": \"\";\r\n                    },\r\n                    createGroupedHeader:function(rowIndex){\r\n                        var data = this.data;\r\n                        var result = false;\r\n                        var radNumber = this.getRadNumber(data.rows[rowIndex]);\r\n                        if(data.groupByCaseNumber){\r\n                            if(rowIndex == 0){\r\n                                result = true;\r\n                            }else{\r\n                                var previousRadNumber = this.getRadNumber(data.rows[rowIndex-1]);\r\n                                if(radNumber != previousRadNumber){\r\n                                    result = true;\r\n                                }\r\n                            }\r\n                        }\r\n                        return result;\r\n                    },\r\n                    getRadNumber:function(row){\r\n                        var index = this.getRadNumberColumnIndex();\r\n                        return (index >= 0)? row.fields[index] : \"\";\r\n                    },\r\n                    /**\r\n                     * validate if in the first row and group by cases and if is IE necesary for bug QAF-1883 fixed head table\r\n                     * @param {Int} rowIndex row index item of case\r\n                     */\r\n                    isIEAndFirstRowAndGroupCases:function (rowIndex) {\r\n                        return rowIndex==0 && this.data.groupByCaseNumber && bizagi.util.isIE();\r\n                    }\r\n                }).appendTo(casesContainer);\r\n\r\n                //There is an issue with ie9 and long tables, its removes the space between closed td and next opened td\r\n                if (bizagi.util.isIE9()) {\r\n                    var expr = new RegExp('>[ \\t\\r\\n\\v\\f]*<', 'g');\r\n                    var tbhtml = $(\"#ui-bizagi-wp-app-inbox-grid-cases\", casesContainer).html();\r\n\r\n                    $(\"#ui-bizagi-wp-app-inbox-grid-cases\", casesContainer).html(tbhtml.replace(expr, \"><\"));\r\n                }\r\n\r\n                // Format invariant dates\r\n                if (bizagi.override.ShowTimeInInboxDates == 1 || bizagi.override.ShowTimeInInboxDates == undefined)\r\n                    bizagi.util.formatInvariantDate(content, self.getResource(\"dateFormat\") + \" \" + self.getResource(\"timeFormat\"));\r\n                else\r\n                    bizagi.util.formatInvariantDate(content, self.getResource(\"dateFormat\"));\r\n\r\n                // Set data for pagination\r\n                $(\"li\", pageSelector).parent().data(\"order\", order);\r\n                $(\"li\", pageSelector).parent().data(\"orderFieldName\", orderFieldName);\r\n                $(\"li\", pageSelector).parent().data(\"orderType\", orderType);\r\n                // Crate pagination control\r\n                $(\"ul\").bizagiPagination({\r\n                    maxElemShow: 50,\r\n                    totalPages: pdata.totalPages,\r\n                    actualPage: pdata.page,\r\n                    listElement: $(\"ul\", pageSelector),\r\n                    clickCallBack: function (options) {\r\n                        self.changeProcess({\r\n                            idWorkflow: idWorkflow,\r\n                            page: options.page,\r\n                            order: options.parent.data(\"order\"),\r\n                            orderFieldName: options.parent.data(\"orderFieldName\"),\r\n                            orderType: options.parent.data(\"orderType\")\r\n                        });\r\n                    }\r\n                });\r\n\r\n\r\n                //Work on it button\r\n                //$(\".workonitRow\", content).button();\r\n                $(\".inbox-grid-tooltip-button\", content).tooltip();\r\n\r\n                // Set even style\r\n                $(\"#ui-bizagi-wp-app-inbox-grid-cases tr:nth-child(even)\", renderedTemplate).addClass(\"event\");\r\n\r\n                // Add click event for activities\r\n                $(\".ui-bizagi-wp-app-inbox-activity-name\", renderedTemplate).click(function () {\r\n                    var referrerParams = {\r\n                        taskState: self.params.taskState,\r\n                        idWorkItem: $(this).find(\"#idWorkItem\").val(),\r\n                        idCase: $(this).find(\"#idCase\").val(),\r\n                        idTask: $(this).find(\"#idTask\").val(),\r\n                        onlyFavorites: self.onlyFavorites,\r\n                        idWorkflow: self.idWorkflow,\r\n                        referrer: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID\r\n                    };\r\n\r\n                    $.extend(bizagi.referrerParams, bizagi.referrerParams, referrerParams);\r\n\r\n                    // Call routing action\r\n                    var idCase = $(this).find(\"#idCase\").val();\r\n                    var idTask = $(this).find(\"#idTask\").val();\r\n                    var idWorkItem = $(this).find(\"#idWorkItem\").val();\r\n                    var idWorkflow = $(this).closest('tr').data(\"idworkflow\");\r\n\r\n                    self.publish(\"executeAction\", {\r\n                        action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                        idCase: idCase,\r\n                        idWorkItem: idWorkItem,\r\n                        idTask: idTask,\r\n                        idWorkflow: idWorkflow\r\n                    });\r\n                });\r\n\r\n                $(\".ui-bizagi-wp-app-inbox-grouped\",renderedTemplate).bind(\"click\", function(){\r\n                    var radNumber = $(this).data(\"radnumber\");\r\n                    var referrerParams = {\r\n                        taskState: self.params.taskState,\r\n                        idWorkItem: $(this).find(\"#idWorkItem\").val(),\r\n                        idCase: $(this).find(\"#idCase\").val(),\r\n                        idTask: $(this).find(\"#idTask\").val(),\r\n                        onlyFavorites: self.onlyFavorites,\r\n                        idWorkflow: self.idWorkflow,\r\n                        referrer: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID\r\n                    };\r\n                    $.extend(bizagi.referrerParams, bizagi.referrerParams, referrerParams);\r\n\r\n                    var idCase = $(this).find(\"#idCase\").val();\r\n\r\n                    self.publish(\"executeAction\", {\r\n                        action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                        idCase: idCase\r\n                    });\r\n                });\r\n\r\n                // Bind favorites start\r\n                $(renderedTemplate).delegate(\".ui-bizagi-wp-app-inbox-cases-start\", \"click\", function (e) {\r\n                    e.stopPropagation();\r\n                    var favoriteOptions;\r\n                    var elmnt = this;\r\n                    $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-cases-start\").addClass(\"ui-bizagi-wp-app-inbox-cases-start-wait\");\r\n\r\n                    // check if its favorite\r\n                    if ($(elmnt).parent().find(\"#isFavorite\").val() == \"false\") {\r\n                        favoriteOptions = {\r\n                            idObject: $(elmnt).parent().find(\"#idCase\").val(),\r\n                            favoriteType: \"CASES\"\r\n                        };\r\n                        $.when(\r\n                                self.dataService.addFavorite(favoriteOptions)\r\n                                ).done(function (favoritesData) {\r\n                                    $(elmnt).parent().find(\"#guidFavorite\").val(favoritesData[\"idFavorites\"]);\r\n                                    $(elmnt).removeClass(\"bz-icon-star-outline\").addClass(\"bz-icon-star\");\r\n                                    $(elmnt).parent().find(\"#isFavorite\").val(\"true\");\r\n                                    $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-cases-start-wait\").addClass(\"ui-bizagi-wp-app-inbox-cases-start\");\r\n                                    self.updateCountProcess(idWorkflow, true);\r\n                                });\r\n                    } else {\r\n                        favoriteOptions = {\r\n                            idObject: $(elmnt).parent().find(\"#guidFavorite\").val(),\r\n                            favoriteType: \"CASES\"\r\n                        };\r\n                        $.when(\r\n                                self.dataService.delFavorite(favoriteOptions)\r\n                                ).done(function (favoritesData) {\r\n                                    if (favoritesData[\"deleted\"] == \"true\" || favoritesData[\"deleted\"] == true) {\r\n                                        $(elmnt).parent().find(\"#guidFavorite\").val(\"\");\r\n                                        $(elmnt).removeClass(\"bz-icon-star\").addClass(\"bz-icon-star-outline\");\r\n                                        $(elmnt).parent().find(\"#isFavorite\").val(\"false\");\r\n                                        $(elmnt).removeClass(\"ui-bizagi-wp-app-inbox-cases-start-wait\").addClass(\"ui-bizagi-wp-app-inbox-cases-start\");\r\n                                        self.updateCountProcess(idWorkflow, false);\r\n                                    }\r\n                                });\r\n                    }\r\n                });\r\n\r\n                // show case summary\r\n                $(\"i.bz-icon-search-outline\", renderedTemplate).click(function () {\r\n                    // Call routing action\r\n                    var idCase = $(this).parents(\"td\").first().find(\"#idCase\").val();\r\n                    var idWorkflow = $(this).closest(\"tr\").data(\"idworkflow\");\r\n                    self.showCase(idCase, idWorkflow);\r\n                });\r\n\r\n\r\n\r\n                // Add click to view workflow\r\n                $(\".ui-bizagi-wp-app-inbox-cases-ico-view\", renderedTemplate).click(function (event) {\r\n                    var idCase = $(this).parent().children(\"#idCase\").val();\r\n                    var idWorkflow = $(this).closest(\"tr\").data(\"idworkflow\");\r\n                    var isAdhoc = $(this).closest(\"tr\").data(\"isadhoc\");\r\n                    var processId = null;\r\n                    if( isAdhoc ){\r\n                        for( var i = 0; i < self.adhocIds.length; i++){\r\n                            if( parseInt(idCase) ==  self.adhocIds[ i ].caseId){\r\n                                processId = self.adhocIds[ i ].processId;\r\n                                self.showGraphicQuery({ idCase: idCase, idWorkflow: idWorkflow, isAdhoc: true, idProcess: processId });\r\n                                break;\r\n                            }\r\n                        }\r\n                    }else{\r\n                        self.showGraphicQuery({ idCase: idCase, idWorkflow: idWorkflow });\r\n                    }\r\n\r\n                    event.preventDefault();\r\n                });\r\n\r\n                // Add click to timeline icon\r\n                $(\".js-show-timeline\", renderedTemplate).click(function (event){\r\n                    var idCase = $(this).parent().children(\"#idCase\").val();\r\n                    var caseNumber = $.trim($(this).closest(\"tr\").find(\".I_RadNumber\").text());\r\n                    self.showTimeLine({ radNumber: caseNumber, idCase: idCase });\r\n                });\r\n                // bind for sort columns\r\n                $(\".sortColumnsData\", casesContainer).click(function () {\r\n                    self.changeProcess({\r\n                        idWorkflow: idWorkflow,\r\n                        orderFieldName: $(this).find(\"#orderFieldName\").val(),\r\n                        orderType: (($(this).find(\"#orderType\").val() == 0) ? 1 : 0),\r\n                        order: $(this).find(\"#order\").val()\r\n                    });\r\n\r\n                });\r\n\r\n                // Add scroll bars\r\n                $(casesContainer).bizagiScrollbar({\r\n                    \"autohide\": false\r\n                });\r\n\r\n                // Bind Folders\r\n                $(\".ui-bizagi-inbox-folder\", renderedTemplate).click(function (e) {\r\n                    e.stopPropagation();\r\n                    var idCase = $(this).data(\"idcase\");\r\n\r\n                    // If the same popup is opened close it\r\n                    if (self.currentPopup == \"folders\") {\r\n                        bizagi.workportal.desktop.popup.closePopupInstance();\r\n                        return;\r\n                    }\r\n\r\n                    // Creates popup\r\n                    self.popupOpened = true;\r\n                    self.currentPopup = \"folders\";\r\n                    self.publish(\"popupWidget\", {\r\n                        widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,\r\n                        options: {\r\n                            sourceElement: $(this),\r\n                            modalClass: \"folders\",\r\n                            'max-height': '146',\r\n                            height: 'auto',\r\n                            width: '110',\r\n                            offset: \"88 0\",\r\n                            activeScroll: true,\r\n                            onlyFolderMode: true,\r\n                            idCase: idCase,\r\n                            closed: function () {\r\n                                self.currentPopup = null;\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n\r\n\r\n                $(\".ui-bizagi-wp-app-magic-button\", casesContainer).bind(\"click\", function () {\r\n                    self.publish(\"changeWidget\", {\r\n                        widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INTEGRATION,\r\n                        module: \"adhocProcess\",\r\n                        selector: \"app-root\"\r\n                    });\r\n                    \r\n                });\r\n\r\n                $(procContainer).bizagiScrollbar();\r\n            });\r\n            \r\n            var queryTableElement=$(\"li#contentCases > .ui-bizagi-wp-app-inbox-grid-cases-container-parent-tableHeadFixed > .ui-bizagi-wp-app-inbox-grid-cases-container-tableHeadFixed > table\");\r\n            self.setTableHeadFixed({\r\n                TableElement:queryTableElement,\r\n                groupByCaseNumber:data.cases.groupByCaseNumber,\r\n                floatOptions:{\r\n                    position: 'fixed',\r\n                    zIndex:1,\r\n                    scrollContainer: function() {\r\n                        return $(\"li#contentCases > .ui-bizagi-wp-app-inbox-grid-cases-container-parent-tableHeadFixed > .ui-bizagi-wp-app-inbox-grid-cases-container-tableHeadFixed\");\r\n                    }\r\n                }\r\n            });\r\n            queryTableElement.find(\"thead > tr\").height(queryTableElement.prev().height());\r\n        }).fail(function (error) {\r\n            error = JSON.parse(error.responseText) || {};\r\n            var errorTemplate = self.workportalFacade.getTemplate(\"info-message\");\r\n            var message = error.message || error;\r\n            var errorHtml = $.tmpl(errorTemplate, {\r\n                message: message\r\n            });\r\n\r\n            errorHtml.appendTo(casesContainer);\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Shows a popup with the case information\r\n    */\r\n    showCase: function (idCase, idWorkflow) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var caseSummaryContainer = $(\"#contentDesc\", content);\r\n        var cache = {};\r\n        var htmlContent = \"\";\r\n\r\n        // Update internal variable\r\n        self.idCase = idCase;\r\n\r\n        caseSummaryContainer.empty();\r\n\r\n        // Don't search data when there is no case\r\n        if (self.idCase == 0) {\r\n            return;\r\n        }\r\n\r\n        // Render Form Tab\r\n        $.when(\r\n                self.dataService.summaryCaseDetails({\r\n                    idCase: self.idCase\r\n                })\r\n                ).done(function (data) {\r\n                    var adhocProcessId = null;\r\n                    var isAdhoc = false;\r\n                    if(!data.isAdhocProcess || typeof data.isAdhocProcess ==='undefined' ) data.isAdhocProcess = false;\r\n                    if( data.isAdhocProcess ){\r\n                        adhocProcessId = data.idAdhocProcess;\r\n                        isAdhoc = true;\r\n                    }\r\n                    data.hasComments = (data.hasComments == 'true') ? true : false;\r\n\r\n                    // Get security\r\n                    var security = new bizagi.workportal.command.security(self.dataService);\r\n                    data.graphicQuery = security.checkSecurityPerm(\"GraphicQuery\");\r\n\r\n                    data.enableFeatureShowTimelineButton = bizagi.override.enableFeatureShowTimelineButton;\r\n                    data.enableTimelineByProcessType = self.isAvailableTimelineByProcessType(data.isAdhocProcess);\r\n\r\n                    if(data.currentState && data.currentState.length > 0){\r\n                        data.currentState.forEach(function(currentState){\r\n                            if(!currentState.idTask){\r\n                                currentState.idTask = 0;\r\n                            }\r\n                            if(!currentState.state){\r\n                                currentState.state = currentState.displayName || \" \";\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    if(data.process === \"undefined\" || data.process === \"\" || typeof data.process === \"undefined\"){\r\n                        data.process = false;\r\n                    }\r\n\r\n                    if(data.processPath === \"undefined\" || data.processPath === \"\" || typeof data.processPath === \"undefined\"){\r\n                        data.processPath = false;\r\n                    }\r\n\r\n\r\n                    var renderedTemplate = $.tmpl(self.caseSummaryTemplate, $.extend(data, {security: bizagi.menuSecurity})).appendTo(caseSummaryContainer);\r\n\r\n                    // Format invariant dates\r\n                    bizagi.util.formatInvariantDate(content, self.getResource(\"dateFormat\") + \" \" + self.getResource(\"timeFormat\"));\r\n\r\n\r\n                    // Delegate events for parent process\r\n                    $(\"#details\", renderedTemplate).delegate(\".summaryLink\", \"click\", function () {\r\n                        self.routingExecute($(this));\r\n                        caseSummaryDialog.dialog('close');\r\n                    });\r\n\r\n                    var caseSummaryDialog = renderedTemplate;\r\n\r\n                    // jQuery-ui tabs\r\n                    $(\"#ui-bizagi-details-tabs\", content).tabs({\r\n                        active: -1,\r\n                        create: function (event, ui) {\r\n                            $(this).tabs(\"option\", \"active\", 0);\r\n                        },\r\n                        \"activate\": function (event, ui) {\r\n                            var panel = (ui == undefined) ? \"formSummary\" : ui.newPanel.attr('id');\r\n                            switch (panel) {\r\n                                case \"comments\":\r\n                                    if (cache[\"comments\"] == undefined) {\r\n                                        // Extend render with comments\r\n                                        $.extend(self, {}, bizagi.workportal.comments);\r\n\r\n                                        // Define canvas\r\n                                        data.canvas = $(\"#comments\");\r\n                                        data.readOnly = true;\r\n\r\n                                        $.when(self.renderComments(data))\r\n                                    .done(function (htmlContent) {\r\n                                        cache[\"comments\"] = htmlContent;\r\n                                    });\r\n                                    }\r\n                                    bizagi.util.setContext({\r\n                                        commentsFocus: true\r\n                                    });\r\n                                    break;\r\n                                case \"formSummary\":\r\n                                    if (cache[\"formSummary\"] == undefined) {\r\n                                        var canvas = $(\"#formSummary\", caseSummaryContainer);\r\n\r\n                                        // Define action when render form has not been migrated\r\n                                        canvas.bind(\"oldrenderintegration\", function (e) {\r\n                                            if (e.isPropagationStopped()) {\r\n                                                return;\r\n                                            }\r\n                                            e.stopPropagation();\r\n\r\n                                            var template = self.getTemplate(\"inbox-common-case-summary-oldrender\");\r\n                                            var data = {};\r\n\r\n                                            bizagi.oldrenderevent = true; // has been loaded\r\n                                            var eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\";\r\n                                            var eventer = window[eventMethod];\r\n                                            var messageEvent = eventMethod == \"attachEvent\" ? \"onmessage\" : \"message\";\r\n\r\n                                            // Listen to message from child window\r\n                                            eventer(messageEvent, function (e) {\r\n                                                e.stopPropagation();\r\n                                                self.publish(\"executeAction\", {\r\n                                                    action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                                                    idCase: e.data\r\n                                                });\r\n                                            }, false);\r\n\r\n                                            // Define wirkitem and idtask\r\n                                            $.when(self.dataService.getWorkitems({\r\n                                                idCase: self.idCase,\r\n                                                onlyUserWorkItems: true,\r\n                                                eventAsTasks: true\r\n                                            })).done(function (getWorkitems) {\r\n                                                // verify workitem, in some cases these variables are not available\r\n                                                if (typeof getWorkitems.workItems == \"object\" && getWorkitems.workItems.length >= 1) {\r\n                                                    // Case Open\r\n                                                    var idWorkitem = getWorkitems.workItems[0]['idWorkItem'];\r\n                                                    var idTask = getWorkitems.workItems[0]['idTask'];\r\n\r\n                                                    for (i = 0; i < getWorkitems.workItems.length; i++) {\r\n                                                        if (getWorkitems.workItems[i]['idCase'] == self.idCase) {\r\n                                                            idWorkitem = getWorkitems.workItems[i]['idWorkItem'];\r\n                                                            idTask = getWorkitems.workItems[i]['idTask'];\r\n                                                            break;\r\n                                                        }\r\n                                                    }\r\n\r\n                                                    data.url = self.dataService.serviceLocator.getUrl(\"old-render\") + \"?PostBack=1&idCase=\" + self.idCase + \"&idWorkitem=\" + idWorkitem + \"&idTask=\" + idTask + \"&isSummary=1\";\r\n                                                } else {\r\n                                                    // Case closed\r\n                                                    data.url = self.dataService.serviceLocator.getUrl(\"old-render\") + \"?PostBack=1&idCase=\" + self.idCase + \"&isSummary=1\";\r\n                                                }\r\n\r\n                                                // Render content\r\n                                                canvas.empty();\r\n                                                $.tmpl(template, data).appendTo(canvas);\r\n                                                //Set styles\r\n                                                self.iframeOldRender($(\"iframe\", canvas));\r\n                                            });\r\n                                        });\r\n\r\n                                        var params = {\r\n                                            idCase: self.idCase\r\n                                        };\r\n\r\n                                        $.when(self.dataService.getCaseFormsRenderVersion(params))\r\n                                    .done(function (formsVersion) {\r\n                                        if (formsVersion.formsRenderVersion == 1) {\r\n                                            canvas.trigger(\"oldrenderintegration\");\r\n                                        } else {\r\n                                            $.when(\r\n                                            self.renderSummaryForm($(\"#formSummary\", renderedTemplate))\r\n                                            ).done(function () {\r\n                                                htmlContent = $(\"#formSummary\", renderedTemplate).html();\r\n                                                cache[\"formSummary\"] = htmlContent;\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                                case \"subprocess\":\r\n                                    if (cache[\"subprocess\"] == undefined) {\r\n                                        $.when(\r\n                                    self.dataService.summarySubProcess({\r\n                                        idCase: self.idCase\r\n                                    })\r\n                                    ).done(function (subprocess) {\r\n                                        htmlContent = $.tmpl(self.caseSummaryTemplateSubprocess, subprocess);\r\n                                        htmlContent.appendTo($(\"#subprocess\", renderedTemplate));\r\n                                        cache[\"subprocess\"] = htmlContent;\r\n\r\n                                        // Define Events for subprocess tab\r\n                                        htmlContent.delegate(\".summaryLink\", \"click\", function () {\r\n                                            self.routingExecute($(this));\r\n                                            caseSummaryDialog.dialog('close');\r\n                                        });\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                                case \"assignees\":\r\n                                    if (cache[\"assignees\"] == undefined) {\r\n                                        $.when(\r\n                                    self.dataService.summaryAssigness({\r\n                                        idCase: self.idCase,\r\n                                        preview:true\r\n                                    })\r\n                                    ).done(function (assignees) {\r\n                                        // Generates  lists of unique assignees for Events\r\n                                        var eventsUniqueList = [];\r\n                                        $.each(assignees.events.split(\", \"), function (i, el) {\r\n                                            if ($.inArray(el, eventsUniqueList) === -1) eventsUniqueList.push(el);\r\n                                        });\r\n                                        assignees.events = eventsUniqueList.join(\", \");\r\n\r\n                                        htmlContent = $.tmpl(self.caseSummaryTemplateAssigness, assignees);\r\n                                        htmlContent.appendTo($(\"#assignees\", renderedTemplate));\r\n                                        cache[\"assignees\"] = htmlContent;\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                                case \"events\":\r\n                                    if (cache[\"events\"] == undefined) {\r\n                                        $.when(\r\n                                    self.dataService.summaryCaseEvents({\r\n                                        idCase: self.idCase\r\n                                    })\r\n                                    ).done(function (events) {\r\n                                        htmlContent = $.tmpl(self.caseSummaryTemplateEvents, events);\r\n                                        htmlContent.appendTo($(\"#events\", renderedTemplate));\r\n                                        cache[\"events\"] = htmlContent;\r\n\r\n                                        htmlContent.delegate(\".summaryLink\", \"click\", function () {\r\n                                            self.routingExecute($(this));\r\n                                            caseSummaryDialog.dialog('close');\r\n                                        });\r\n                                    });\r\n                                    }\r\n                                    break;\r\n                            }\r\n                        }\r\n                    });\r\n\r\n\r\n                    // jquery UI Button work on it button\r\n                    $(\".workonitRow\", renderedTemplate).button();\r\n\r\n                    // Add click to timeline icon\r\n                    $(\".js-show-timeline\", renderedTemplate).click(function (event){\r\n                        var caseNumber = $.trim($(this).closest(\"div.ui-bizagi-wp-app-inbox-processes-title\").find(\"span.js-case-number\").text());\r\n                        self.showTimeLine({ radNumber: caseNumber, idCase: idCase });\r\n                    });\r\n\r\n                    // Add click to view workflow\r\n                    $(\"#ui-bizagi-wp-app-inbox-description-container .ui-bizagi-wp-app-inbox-cases-ico-view\", content).click(function () {\r\n                        if( isAdhoc ){\r\n                            self.showGraphicQuery({ idCase: idCase, idWorkflow: idWorkflow, isAdhoc: true, idProcess: adhocProcessId });\r\n                        }else {\r\n                            self.showGraphicQuery({idCase: idCase, idWorkflow: idWorkflow});\r\n                        }\r\n                    });\r\n\r\n\r\n\r\n                    // Bind events for events and process on summary case\r\n                    $(\".workonitRow\", renderedTemplate).click(function () {\r\n                        var referrerParams = {\r\n                            taskState: self.params.taskState,\r\n                            idWorkItem: $(this).parent().find(\"#idWorkItem\").val(),\r\n                            idCase: data.idCase,\r\n                            idTask: $(this).parent().find(\"#idTask\").val(),\r\n                            onlyFavorites: self.onlyFavorites,\r\n                            idWorkflow: self.idWorkflow,\r\n                            referrer: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID\r\n                        }\r\n\r\n                        $.extend(bizagi.referrerParams, bizagi.referrerParams, referrerParams);\r\n                        // Executes routing action\r\n                        caseSummaryDialog.dialog('close');\r\n                        self.publish(\"executeAction\", {\r\n                            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                            idCase: data.idCase,\r\n                            idWorkflow: idWorkflow,\r\n                            idTask: $(this).parent().find(\"#idTask\").val(),\r\n                            idWorkItem: $(this).parent().find(\"#idWorkItem\").val()\r\n                        });\r\n                    });\r\n\r\n                    // Set buttons\r\n                    var buttons = {};\r\n                    buttons[bizagi.localization.getResource(\"workportal-case-dialog-box-close\")] = function () {\r\n                        caseSummaryContainer.empty();\r\n                        renderedTemplate.remove();\r\n                        $(\"#ui-bizagi-wp-app-inbox-description-container\").remove();\r\n                    };\r\n\r\n                    caseSummaryDialog.dialog({\r\n                        modal: true,\r\n                        title: data.process,\r\n                        width: 1000,\r\n                        height: 600,\r\n                        draggable: true,\r\n                        resizable: true,\r\n                        buttons: buttons,\r\n                        close: function () {\r\n                            caseSummaryContainer.empty();\r\n                            renderedTemplate.remove();\r\n                            $(\"#ui-bizagi-wp-app-inbox-description-container\").remove();\r\n                        }\r\n                    });\r\n\r\n                    //$(\"\").add(\"workonitRow\")\r\n\r\n                });\r\n    },\r\n    /*\r\n    *   Misc method to format cell values\r\n    */\r\n    formatRequest: function (value) {\r\n        return value;\r\n    },\r\n    /**\r\n    * Misc method to render categories\r\n    */\r\n    formatCategories: function (value) {\r\n        return value;\r\n\r\n    },\r\n    isArray: function (value) {\r\n        if (typeof (value) == 'object') {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    },\r\n    /**\r\n    *  Change total processes indicator, when start favorites view and user select or deselect\r\n    *  favorite cases.\r\n    *\r\n    *  @augments increment  {true || false }, true= increment +1 , false = decrement -1, default true.\r\n    */\r\n    updateCountProcess: function (idWorkflow, increment) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var processesContainer = $(\"#contentProc\", content);\r\n        var assigned = false;\r\n\r\n        increment = (increment) ? true : false;\r\n\r\n        // Check if task state is diferent to Favorites\r\n        if (self.params.taskState != \"Favorites\" || idWorkflow == \"\") {\r\n            return true;\r\n        }\r\n\r\n\r\n        // Get all process and verify new favorites count\r\n        // Loads processes by task state\r\n        $.when(self.dataService.getAllProcesses({\r\n            taskState: self.taskState,\r\n            onlyFavorites: self.onlyFavorites\r\n        }))\r\n                .done(function (data) {\r\n                    data.categories = data.categories || {};\r\n                    $.each(data.categories, function (key, value) {\r\n                        $.each(value.workflows, function (key2, value2) {\r\n                            if (value2.idworkflow == idWorkflow) {\r\n                                // update value\r\n                                // Find list elements\r\n                                $('li > input[value=\"' + idWorkflow + '\"][id=\"idWorkflow\"]', processesContainer).parent().find(\".ui-bizagi-wp-app-inbox-processes-ncase\").html(value2.count);\r\n                                assigned = true;\r\n                            }\r\n                        })\r\n                    });\r\n\r\n                    // If element reach 0 cases, set 0\r\n                    if (!assigned) {\r\n                        if (increment) {\r\n                            $('li > input[value=\"' + idWorkflow + '\"][id=\"idWorkflow\"]', processesContainer).parent().find(\".ui-bizagi-wp-app-inbox-processes-ncase\").html(1);\r\n                        } else {\r\n                            $('li > input[value=\"' + idWorkflow + '\"][id=\"idWorkflow\"]', processesContainer).parent().find(\".ui-bizagi-wp-app-inbox-processes-ncase\").html(0);\r\n                        }\r\n                    }\r\n                });\r\n    },\r\n    /**\r\n    * Inject styles and js into the iframe\r\n    */\r\n    iframeOldRender: function (canvas) {\r\n        var self = this;\r\n        var iframe;\r\n        var content = self.getContent();\r\n        var theme = \"bizagiDefault\";\r\n        var queryString = bizagi.readQueryString();\r\n\r\n        $.each(canvas, function () {\r\n            if ($(this).is(\"iframe\")) {\r\n                iframe = $(this);\r\n            }\r\n        });\r\n\r\n        iframe.load(function () {\r\n            // inject css\r\n            var content = $(this).contents();\r\n\r\n            // Fixed problem with relative path across the different browsers\r\n            var cssLocation = ($.browser.mozilla || $.browser.webkit) ? \"../../css/render_%theme%.css\" : \"css/render_%theme%.css\";\r\n\r\n            // Define theme\r\n            cssLocation = cssLocation.replace(\"%theme%\", (queryString[\"theme\"] || theme));\r\n\r\n            // Append css\r\n            $('body', content).append(\"<link type='text/css' rel='stylesheet' href='\" + cssLocation + \"'>\");\r\n\r\n            // Append javascript\r\n            //  $('head',content).append(\"<script type='text/javascript' src='../../js/renderintegration.js'></script>\");\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Disposes the widget\r\n    */\r\n    dispose: function () {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super();\r\n    }\r\n\r\n});\r\n\r\nbizagi.workportal.widgets.inboxGrid.extend(\"bizagi.workportal.widgets.inboxGridRubik\", {}, {\r\n\t/**\r\n\t * Overrite of renderContent\r\n\t *\r\n\t * @return {*}\r\n\t */\r\n\trenderContent: function () {\r\n\t\tvar self = this;\r\n\t\tvar template = self.getTemplate(\"inbox-grid-rubik\");\r\n\r\n\t\t// Render content\r\n\t\tvar content = self.content = $.tmpl(template,{});\r\n\r\n\t\t// Set inbox view variable\r\n\t\tbizagi.workportal.currentInboxView = self.getWidgetName();\r\n\r\n\t\treturn content;\r\n\t},\r\n\r\n\t/**\r\n\t * Override of postRender\r\n\t */\r\n\tpostRender: function(){\r\n\t\tvar self = this;\r\n\r\n\t\tbizagi.referrerParams = (self.params.restoreStatus) ? bizagi.referrerParams || {} : {};\r\n\r\n\t\tself.changeProcess({idWorkflow: \"\", workflowName: \"All Cases \", smartfoldersParameters: \"\"});\r\n\r\n\t\t/**\r\n\t\t * Publish event to list cases\r\n\t\t *\r\n\t\t * @param {idWorkflow, page, orderFieldName, orderType, order, taskState}\r\n\t\t */\r\n\t\tself.getEventListener().on(\"PROCESS-VIEW-UPDATE\",function(e,params){\r\n\t\t\tself.changeProcess(params);\r\n\t\t});\r\n\t}\r\n});\r\n","/*\r\n*   Name: BizAgi Workportal Folder Widget Controller\r\n*   Author: Edward Morales\r\n*   Comments:\r\n*   -   This script will define a base class to to define the folders widget\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.folders\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function(){  \r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS;\r\n    },\r\n    \r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"folders\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders\"),\r\n            \"folders-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-elements\"),\r\n            \"folders-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-empty-elements\"),\r\n            \"folders-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-query-tree\"),\r\n            \"folders-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-confirm\"),\r\n            \"folders-default\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-default\"),\r\n            \"folders-input-new\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-input-new\"),\r\n            \"folders-add-case\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-add-case\"),\r\n            \"folders-elements-node\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-element-node\"),\r\n            \"folders-query-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.folders\").concat(\"#ui-bizagi-workportal-widget-folders-edit\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"folders\");\r\n        var content = self.content = $.tmpl(template);\r\n        \r\n        return content;\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Workportal Smart Folder Widget Controller\r\n*   Author: Edward Morales\r\n*   Comments:\r\n*   -   This script will define a base class to to define the smart folders widget\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.smartfolders\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS;\r\n    },\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"smartfolders\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders\"),\r\n            \"smartfolders-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-elements\"),\r\n            \"smartfolders-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-empty-elements\"),\r\n            \"smartfolders-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-confirm\"),\r\n            \"smartfolders-default\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-default\"),\r\n            \"smartfolders-add-case\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-add-case\"),\r\n            \"smartfolders-elements-node\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-element-node\"),\r\n            \"smartfolders-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-query-tree\"),\r\n            \"smartfolders-query-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-edit\"),\r\n            \"smartfolders-input-new\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.smartfolders\").concat(\"#ui-bizagi-workportal-widget-smartfolders-input-new\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"smartfolders\");\r\n        var content = self.content = $.tmpl(template);\r\n\r\n        return content;\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal Desktop Folders Widget Controller\r\n *   Author: Edward Morales\r\n *   Comments:\r\n *   -   This script will provide desktop overrides to implement the folder widget\r\n */\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.folders.extend(\"bizagi.workportal.widgets.folders\", {}, {\r\n\r\n    /**\r\n     *   To be overriden in each device to apply layouts\r\n     */\r\n    postRender: function(){\r\n        var self = this;\r\n\r\n        self.params.options.onlyFolderMode = self.params.options.onlyFolderMode || false;\r\n\r\n        // Set bind event for last element\r\n        self.configureTreeNavigation();\r\n\r\n        // Bind back button\r\n        self.configureBackButton();\r\n\r\n        // Render default folders\r\n        // self.renderDefaultFolders();\r\n\r\n        // Render base categories\r\n        self.renderFolders((self.params.options.onlyFolderMode)?\"-1\":\"\");\r\n\r\n        // set vertical scroll\r\n        self.scrollVertical({\r\n            \"autohide\":false\r\n        });\r\n    },\r\n\r\n    renderDefaultFolders: function(){\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var template = self.getTemplate(\"folders-default\");\r\n        var container = $(\"#queries\", content);\r\n\r\n        container.empty();\r\n        $.tmpl(template).appendTo(container);\r\n\r\n    },\r\n\r\n    /**\r\n     * Render List categories for each idCategory\r\n     */\r\n    renderFolders: function(id,appendElement){\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var template = (self.params.options.onlyFolderMode != undefined && self.params.options.onlyFolderMode)?self.getTemplate(\"folders-add-case\"):self.getTemplate(\"folders-elements\");\r\n        var emptyTemplate = self.getTemplate(\"folders-empty-elements\");\r\n        var container = $(\"#queries\", content);\r\n        var queryContent;\r\n        var mergeData;\r\n        var mergeNewFolder ={};\r\n\r\n        id = id || \"\";\r\n\r\n        $.when(self.dataService.getFolders(id))\r\n        .done(function(data) {\r\n\r\n            container.empty();\r\n\r\n            // check if service have nodes\r\n            data = data || undefined;\r\n            var idParent = \"\";\r\n            try{\r\n                if(data.folders != undefined && data.folders.length > 0){\r\n                    idParent = data.folders[0][\"idParent\"];\r\n                }\r\n            }catch(e){}\r\n\r\n\r\n            if(data.folders != undefined && data.folders != \"\"){\r\n                // Check if have appendElement\r\n                if(appendElement != undefined){\r\n                    mergeData = {\r\n                        folders:\r\n                        (data != undefined)?appendElement.concat(data.folders):appendElement\r\n                    };\r\n                //$.merge({folders:appendElement},data)\r\n                //$.merge(appendElement, data); //appendElement.concat(data.folders)\r\n                }else{\r\n                    mergeData = data;\r\n                }\r\n                // Count number of childs\r\n                $.each(mergeData.folders,function(key,value){\r\n                    if(value != undefined && value.childs.folders != undefined){\r\n                        mergeData.folders[key][\"countChilds\"] = mergeData.folders[key][\"childs\"][\"folders\"].length;\r\n                    }else{\r\n                        mergeData.folders[key][\"countChilds\"]=0;\r\n                    }\r\n                });\r\n\r\n                // Append \"new folder\"element\r\n                if(id != \"\" && !self.params.options.onlyFolderMode){\r\n                    mergeNewFolder.folders = mergeData.folders.concat({\r\n                        \"name\": self.getResource(\"workportal-widget-folders-new\"),\r\n                        \"id\": 'newFolder',\r\n                        \"idParent\": idParent,\r\n                        \"childs\": [],\r\n                        \"categoryWithLink\": \"true\",\r\n                        \"countChilds\":0\r\n                    });\r\n                }else{\r\n                    mergeNewFolder = mergeData;\r\n                }\r\n\r\n                queryContent = $.tmpl(template, mergeNewFolder);\r\n            }else if(!self.params.options.onlyFolderMode){\r\n                //Don't have results\r\n                mergeNewFolder.folders = [{\r\n                    \"name\": self.getResource(\"workportal-widget-folders-new\"),\r\n                    \"id\": 'newFolder',\r\n                    \"idParent\": idParent,\r\n                    \"childs\": [],\r\n                    \"categoryWithLink\": \"true\",\r\n                    \"countChilds\":0\r\n                }];\r\n                queryContent = $.tmpl(template,mergeNewFolder);\r\n            }else{\r\n                queryContent = $.tmpl(emptyTemplate);\r\n            }\r\n            queryContent.appendTo(container);\r\n\r\n            // set actions to rendered html\r\n            self.configureNavTree(container);\r\n        });\r\n    },\r\n\r\n\r\n    configureNavTree: function(queriesContainer) {\r\n        var self = this;\r\n        var confirm = self.getTemplate(\"folders-query-confirm\");\r\n\r\n        // Bind for list elements\r\n        $(\"li\", \"#queries\").click(function(e) {\r\n            e.stopPropagation();\r\n            var id =$(this).data(\"id\");\r\n            var countChilds =$(this).data(\"childslength\");\r\n            var name =$(this).data(\"name\");\r\n            var urlParameters =$(this).data(\"urlparameters\");\r\n            var idParent = $(this).data(\"idparent\");\r\n\r\n            var headerTemplate = self.getTemplate(\"folders-query-tree\");\r\n            var categoryTree = $(\"#categoryTree\");\r\n            var queriesListDisplay = $(\".queriesListDisplay li\");\r\n\r\n            // Config inbox view\r\n            if(countChilds == 0 && self.params.options.onlyFolderMode){\r\n                return;\r\n            }\r\n\r\n            // If the node is base folder\r\n            if (id == \"-1\"){\r\n                // Is category\r\n                // Append query header\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: -1,\r\n                    queryDisplayName: name\r\n                }).appendTo(categoryTree);\r\n\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation(idParent);\r\n\r\n                // Render sub-categories\r\n                self.renderFolders(id);\r\n            }else if(id==\"newFolder\"){\r\n                // Create new folder\r\n                self.makeFolder({\r\n                    listElements:queriesListDisplay,\r\n                    idParent:idParent\r\n                });\r\n\r\n            }else if( countChilds > 0 ){\r\n                // Is category with link\r\n\r\n                // Add element for tree navigation\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: id,\r\n                    queryDisplayName: name\r\n                }).appendTo(categoryTree);\r\n\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation(idParent);\r\n\r\n                // Apend this object to children\r\n                self.renderFolders(id,\r\n                    (self.params.options.onlyFolderMode)?[]:\r\n                    [{\r\n                        \"name\": name,\r\n                        \"id\": id,\r\n                        \"idParent\": '',\r\n                        \"childs\": [],\r\n                        \"categoryWithLink\": true,\r\n                        \"urlParameters\":urlParameters\r\n                    }]\r\n                    );\r\n            }else {\r\n                // Is Process\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                if(countChilds == 0 && urlParameters){\r\n                    $.when(self.dataService.getCasesByFolder(urlParameters))\r\n                    .done(function(data){\r\n                        bizagi.lstIdCases = data.lstIdCases;\r\n                        // Define radnumber for render actions bottons\r\n                        bizagi.referrerParams = bizagi.referrerParams || {};\r\n                        bizagi.referrerParams.radNumber = \"\";//params.radNumber;\r\n                        bizagi.referrerParams.page = \"\";//params.page;\r\n                        bizagi.referrerParams.referrer = \"folders\";\r\n                        bizagi.referrerParams.urlParameters = urlParameters;\r\n                        bizagi.referrerParams.name = name;\r\n                        bizagi.referrerParams.id = id;\r\n\r\n                        // Define widget customized for pagination purposes\r\n                        data.customized = true; \r\n                        data.urlParameters = urlParameters;\r\n                        \r\n                        // Define title of widget\r\n                        data.title = name;\r\n\r\n                        // Set a flag here to tell the search widget that must show the ungroup case from folder (icon).\r\n                        data.casesGroupedByFolder = true;\r\n                        data.idFolder = id;\r\n\r\n                        self.publish(\"changeWidget\", {\r\n                            widgetName : bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,\r\n                            data: data,\r\n                            referrerParams: {}\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".addButton\", \"#queries\").click(function(e){\r\n            e.stopPropagation();\r\n            var queriesListDisplay = $(\".queriesListDisplay li\");\r\n            var id = $(this).data(\"id\");\r\n            var idParent = $(this).data(\"idparent\");\r\n            self.makeFolder({\r\n                listElements:queriesListDisplay,\r\n                idParent:id,\r\n                beforeElement:$(this).parent(),\r\n                style:\"newSubFolder\",\r\n                idParentDone:idParent\r\n            });\r\n        });\r\n\r\n        $(\".editButton\", \"#queries\").click(function(e) {\r\n            e.stopPropagation();\r\n            self.editFolder($(this).parent());\r\n        });\r\n\r\n\r\n        $(\".deleteButton\", \"#queries\").click(function(e){\r\n            e.stopPropagation();\r\n\r\n            var content = $.tmpl(confirm);\r\n            var idCustomFolder = $(this).data(\"id\");\r\n            var idParent = $(this).data(\"idparent\");\r\n\r\n            // Open dialog with confirm message\r\n            $(content).dialog({\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                buttons: [\r\n                {\r\n                    text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                    click: function(){\r\n                        self.dataService.deleteFolder({\r\n                            idCustomFolder: idCustomFolder\r\n                        });\r\n\r\n                        $(this).dialog(\"close\");\r\n                        self.renderFolders(idParent);\r\n                    //bizagi.workportal.desktop.popup.closePopupInstance();\r\n                    }\r\n                },\r\n                {\r\n                    text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                    click: function(){\r\n                        $(this).dialog(\"close\");\r\n                    }\r\n                }\r\n                ]\r\n            });\r\n        });\r\n\r\n        $(\".addIco\",\"#queries\").click(function(e){\r\n            e.stopPropagation();\r\n            var ico = $(this);\r\n            var parent = ico.parent();\r\n            var idFolder = ico.data(\"id\");\r\n\r\n            ico.addClass(\"wait\");\r\n            // Associate case to folder\r\n            $.when(self.dataService.associateCaseToFolder({\r\n                idCustomFolder: idFolder,\r\n                idCase: self.params.options.idCase\r\n            })).done(function(data){\r\n                if(data.message == \"\"){\r\n                    bizagi.workportal.desktop.popup.closePopupInstance();                    \r\n                }else{\r\n                    // Show error message \r\n                    ico.removeClass(\"wait\");\r\n                    if($(\".errorMessage\",parent).text()== \"\"){\r\n                        parent.append($(\"<div class='errorMessage'></div>\").html(data.message));\r\n                        setTimeout(function(){\r\n                            $(\".errorMessage\",parent).hide('blind','slow',function(){\r\n                                $(this).remove();    \r\n                            });                        \r\n                        }, 5000);\r\n                    }\r\n                }\r\n            })\r\n        });\r\n    },\r\n\r\n    /**\r\n     *   Binds the back buttons so we can navigate back\r\n     */\r\n    configureBackButton: function(){\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var btnBack = $(\"#bt-back\", content);\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n\r\n        // Bind click\r\n        btnBack.click(function(){\r\n            if($(\"li\", categoryTree).length > 1){\r\n                // Removes last child\r\n                $(\"li:last-child\", categoryTree).remove();\r\n                var idParentQuery = $(\"li:last-child\").children(\"#idParent\").val();\r\n\r\n                // Render Querie again\r\n                self.renderFolders(idParentQuery);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Configure Edit input field\r\n     * @param options{listElements,idParent,beforeElement,style,idParentDone}\r\n     */\r\n    makeFolder:function(options){\r\n        var self = this;\r\n        var nodeTemplate = options.template || self.getTemplate(\"folders-input-new\");\r\n        options.beforeElement = (options.beforeElement != undefined && options.beforeElement.length >=1)?options.beforeElement:options.listElements;\r\n        var newElement = $.tmpl(nodeTemplate,{\r\n            name: \"\",\r\n            idParent: options.idParent,\r\n            style: options.style\r\n        }).insertAfter((options.beforeElement.length ==1)?options.beforeElement:options.beforeElement.last().prev());\r\n\r\n        // Set focus on input element\r\n        $(\".newInput\",newElement).focus();\r\n        \r\n        // Bind event to checkin botton\r\n        $(\".checkico\",newElement).click(function(){\r\n            var folderName = $(\".newInput\",newElement).val();            \r\n            var parent = $(this).parent();\r\n            \r\n            // Check if folderName already exists   \r\n            $.when(self.checkRepeatFolderName({\r\n                parent:parent,\r\n                options:options,\r\n                folderName: folderName\r\n            })\r\n            ).done(function(result){\r\n                if(result){\r\n                    // Create folder\r\n                    $.when(self.dataService.makeFolder({\r\n                        idParentFolder:options.idParent,\r\n                        folderName: folderName\r\n                    }))\r\n                    .done(function(result){\r\n                        // Update View\r\n                        self.renderFolders(options.idParentDone || options.idParent);\r\n                    });\r\n                }else{\r\n                    // Display notification - folder name already in use\r\n                    parent.append($(\"<div class='errorMessage'></div>\").html(self.getResource(\"workportal-widget-folders-name-repeated\")));\r\n                    setTimeout(function(){\r\n                        $(\".errorMessage\",parent).hide('blind','slow',function(){\r\n                            $(\".errorMessage\",parent).remove();\r\n                        });                \r\n                    },5000);\r\n                }   \r\n            });\r\n        });\r\n        \r\n        $(\".newInput\",newElement).bind(\"keypress\",function(e){\r\n            if(e.keyCode==13){\r\n                $(\".checkico\", newElement).click();\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Check if folder name already exist\r\n     */\r\n    checkRepeatFolderName: function(args){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        args = args || {};\r\n        var folderNameAvailable = true;\r\n        if(args.parent.hasClass(\"newSubFolder\")){ // Check if new folder in subcategory\r\n            $.when(self.dataService.getFolders(\r\n                args.options.idParent\r\n                )).done(function(data){\r\n                if(data.folders != undefined){\r\n                    $.each(data.folders, function(key,value){                    \r\n                        if(value.name != undefined && args.folderName == value.name){\r\n                            folderNameAvailable = false;    \r\n                            def.resolve(folderNameAvailable);\r\n                        }                    \r\n                    });\r\n                }\r\n                def.resolve(folderNameAvailable);\r\n            });            \r\n        }else{\r\n            // it is principal tree\r\n            $('.queriesListDisplay li')\r\n            .not(':last-child') // Do not include the last item\r\n            .each(function(){\r\n                // Compare each value\r\n                if(args.folderName == $(this).data('name')){\r\n                    // Sorry the name of the folder is already taken\r\n                    folderNameAvailable = false;\r\n                }\r\n            });\r\n            def.resolve(folderNameAvailable);\r\n        }\r\n        //def.resolve(folderNameAvailable);\r\n        return def.promise();\r\n    },\r\n    /**\r\n     * Edit folder\r\n     */\r\n    editFolder: function(element){\r\n        var self = this;\r\n        var idParent = $(element).data(\"idparent\");\r\n        var value = $(element).find(\"h3\").html();\r\n        var id = $(element).data(\"id\");\r\n        var nodeTemplate = self.getTemplate(\"folders-input-new\");\r\n\r\n        var newElement = $.tmpl(nodeTemplate,{\r\n            name: value,\r\n            idParent: idParent\r\n        });\r\n\r\n        element.replaceWith(newElement);\r\n\r\n        // Set focus on input element\r\n        $(\".newInput\",newElement).focus();\r\n\r\n        // Bind event to checkin botton\r\n\r\n\r\n        $(\".checkico\",newElement).click(function(){\r\n            var folderName =$(\".newInput\",newElement).val();\r\n\r\n            $.when(self.dataService.updateFolder({\r\n                idFolder:id,\r\n                folderName: folderName\r\n            }))\r\n            .done(function(result){\r\n                // Update View\r\n                self.renderFolders(idParent);\r\n            });\r\n        });\r\n\r\n        $(\".newInput\",newElement).bind(\"keypress\",function(e){\r\n            if(e.keyCode==13){\r\n                $(\".checkico\",newElement).click();\r\n            }\r\n        });\r\n    },\r\n\r\n\r\n    /**\r\n     * Bind tree navigation\r\n     */\r\n    configureTreeNavigation:function(idParent){\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n\r\n        // Bind header events\r\n        $(\"li:last-child\", categoryTree).click(function(){\r\n            idParent = idParent || $(this).children(\"#idParent\").val();\r\n\r\n            if(self.params.options.onlyFolderMode && idParent==\"\"){\r\n                self.renderFolders(-1);\r\n            }\r\n            // Remove all elements\r\n            $(this).nextAll().remove();\r\n            // Render query tree again\r\n            self.renderFolders(idParent);\r\n        });\r\n    },\r\n\r\n    scrollVertical:function(){\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $(\"#queries\",content).bizagiScrollbar({\r\n            \"autohide\":false\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Show new case popup to create a case\r\n     */\r\n    showQueryFormPopup: function(arg){\r\n        var self = this;\r\n\r\n        var idQuery = arg.idQuery || \"\";\r\n        var idStoredQuery = arg.idStoredQuery || \"\";\r\n        var queryFormAction = arg.queryFormAction || \"\";\r\n        var title = arg.title || \"\";\r\n\r\n        // If the same popup is opened close it\r\n        if (self.currentPopup == \"queryform\"){\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            return;\r\n        }\r\n\r\n        // Shows a popup widget\r\n        self.currentPopup = \"queryform\";\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName : bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,\r\n            idQueryForm: idQuery,\r\n            idStoredQuery: idStoredQuery,\r\n            queryFormAction: queryFormAction,\r\n            modalParameters: {\r\n                title: title\r\n            }\r\n        });\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal Desktop Smart Folders Widget Controller\r\n *   Author: Edward Morales\r\n *   Comments:\r\n *   -   This script will provide desktop overrides to implement the smart folder widget\r\n */\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.smartfolders.extend(\"bizagi.workportal.widgets.smartfolders\", {}, {\r\n\r\n\t/**\r\n\t *   To be overriden in each device to apply layouts\r\n\t */\r\n\tpostRender: function () {\r\n\t\tvar self = this;\r\n\r\n\t\tself.params.options.onlyFolderMode = self.params.options.onlyFolderMode || false;\r\n\r\n\t\t// Set bind event for last element\r\n\t\tself.configureTreeNavigation();\r\n\r\n\t\t// Bind back button\r\n\t\tself.configureBackButton();\r\n\r\n\t\t// Render default folders\r\n\t\t// self.renderDefaultFolders();\r\n\r\n\t\t// Render base categories\r\n\t\tself.renderFolders((self.params.options.onlyFolderMode) ? \"-1\" : \"\");\r\n\r\n\t\t// set vertical scroll\r\n\t\tself.scrollVertical({\r\n\t\t\t\"autohide\": false\r\n\t\t});\r\n\t},\r\n\r\n\trenderDefaultFolders: function () {\r\n\t\tvar self = this;\r\n\t\tvar content = self.getContent();\r\n\t\tvar template = self.getTemplate(\"smartfolders-default\");\r\n\t\tvar container = $(\"#queries\", content);\r\n\r\n\t\tcontainer.empty();\r\n\t\t$.tmpl(template).appendTo(container);\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Render List categories for each idCategory\r\n\t */\r\n\trenderFolders: function (id, appendElement) {\r\n\t\tvar self = this;\r\n\t\tvar content = self.getContent();\r\n\t\tvar template = (self.params.options.onlyFolderMode != undefined && self.params.options.onlyFolderMode) ? self.getTemplate(\"smartfolders-add-case\") : self.getTemplate(\"smartfolders-elements\");\r\n\t\tvar emptyTemplate = self.getTemplate(\"smartfolders-empty-elements\");\r\n\t\tvar container = $(\"#queries\", content);\r\n\t\tvar queryContent;\r\n\t\tvar mergeData;\r\n\t\tvar mergeNewFolder = {};\r\n\r\n\t\tid = id || \"\";\r\n\r\n\t\t$.when(self.dataService.getSmartFolders(id))\r\n\t\t.done(function (data) {\r\n\r\n\t\t\tcontainer.empty();\r\n\r\n\t\t\t// check if service it has nodes\r\n\t\t\tdata = data || undefined;\r\n\t\t\tvar idParent = \"\";\r\n\t\t\ttry {\r\n\t\t\t\tif (data.folders != undefined && data.folders.length > 0) {\r\n\t\t\t\t\tidParent = data.folders[0][\"idParent\"];\r\n\t\t\t\t}\r\n\t\t\t} catch (e) { }\r\n\r\n\r\n\t\t\tif (data.folders != undefined && data.folders != \"\") {\r\n\t\t\t\t// Check if it has appendElement\r\n\t\t\t\tif (appendElement != undefined) {\r\n\t\t\t\t\tmergeData = {\r\n\t\t\t\t\t\tfolders:\r\n\t\t\t\t\t\t(data != undefined) ? appendElement.concat(data.folders) : appendElement\r\n\t\t\t\t\t};\r\n\t\t\t\t//$.merge({folders:appendElement},data)\r\n\t\t\t\t//$.merge(appendElement, data); //appendElement.concat(data.folders)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmergeData = data;\r\n\t\t\t\t}\r\n\t\t\t\t// Count number of childs\r\n\t\t\t\t$.each(mergeData.folders, function (key, value) {\r\n\t\t\t\t\tif (value != undefined && value.childs.folders != undefined) {\r\n\t\t\t\t\t\tmergeData.folders[key][\"countChilds\"] = mergeData.folders[key][\"childs\"][\"folders\"].length;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmergeData.folders[key][\"countChilds\"] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Append \"new folder\"element\r\n\t\t\t\tif (!self.params.options.onlyFolderMode) {\r\n\t\t\t\t\tmergeNewFolder.folders = mergeData.folders.concat({\r\n\t\t\t\t\t\t\"name\": self.getResource(\"workportal-widget-folders-new\"),\r\n\t\t\t\t\t\t\"id\": 'newFolder',\r\n\t\t\t\t\t\t\"idParent\": idParent,\r\n\t\t\t\t\t\t\"childs\": [],\r\n\t\t\t\t\t\t\"categoryWithLink\": \"true\",\r\n\t\t\t\t\t\t\"countChilds\": 0\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmergeNewFolder = mergeData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tqueryContent = $.tmpl(template, mergeNewFolder);\r\n\t\t\t} else if (!self.params.options.onlyFolderMode) {\r\n\t\t\t\t//Don't have results\r\n\t\t\t\tmergeNewFolder.folders = [{\r\n\t\t\t\t\t\"name\": self.getResource(\"workportal-widget-folders-new\"),\r\n\t\t\t\t\t\"id\": 'newFolder',\r\n\t\t\t\t\t\"idParent\": idParent,\r\n\t\t\t\t\t\"childs\": [],\r\n\t\t\t\t\t\"categoryWithLink\": \"true\",\r\n\t\t\t\t\t\"countChilds\": 0\r\n\t\t\t\t}];\r\n\t\t\t\tqueryContent = $.tmpl(template, mergeNewFolder);\r\n\t\t\t} else {\r\n\t\t\t\tqueryContent = $.tmpl(emptyTemplate);\r\n\t\t\t}\r\n\t\t\tqueryContent.appendTo(container);\r\n\r\n\t\t\t// set actions to rendered html\r\n\t\t\tself.configureNavTree();\r\n\t\t});\r\n\t},\r\n\r\n\r\n\tconfigureNavTree: function () {\r\n\t\tvar self = this;\r\n\t\tvar confirm = self.getTemplate(\"smartfolders-query-confirm\");\r\n\r\n\t\t// Bind for list elements\r\n\t\t$(\"li\", \"#queries\").click(function (e) {\r\n\t\t\te.stopPropagation();\r\n\t\t\tvar id = $(this).data(\"id\");\r\n\t\t\tvar countChilds = $(this).data(\"childslength\");\r\n\t\t\tvar name = $(this).data(\"name\");\r\n\t\t\tvar urlParameters = $(this).data(\"urlparameters\");\r\n\t\t\tvar idParent = $(this).data(\"idparent\");\r\n\r\n\t\t\t//            var categoryTree = $(\"#categoryTree\");\r\n\t\t\tvar queriesListDisplay = $(\".queriesListDisplay li\");\r\n\r\n\t\t\t// Config inbox view\r\n\t\t\tif (countChilds == 0 && self.params.options.onlyFolderMode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the node is base folder\r\n\t\t\tif (id == \"-1\") {\r\n\t\t\t\t// Is category\t\t\r\n\r\n\t\t\t\t// Set bind event for last element\r\n\t\t\t\tself.configureTreeNavigation(idParent);\r\n\r\n\t\t\t\t// Render sub-categories\r\n\t\t\t\tself.renderFolders(id);\r\n\t\t\t} else if (id == \"newFolder\") {\r\n\t\t\t\t// Create new folder\r\n\t\t\t\tself.makeFolder({\r\n\t\t\t\t\tlistElements: queriesListDisplay,\r\n\t\t\t\t\tidParent: idParent\r\n\t\t\t\t});\r\n\r\n\t\t\t} else if (countChilds > 0) {\r\n\t\t\t\t// Is category with link\r\n\r\n\r\n\t\t\t\t// Set bind event for last element\r\n\t\t\t\tself.configureTreeNavigation(idParent);\r\n\r\n\t\t\t\t// Apend this object to children\r\n\t\t\t\tself.renderFolders(id,\r\n\t\t\t\t\t(self.params.options.onlyFolderMode) ? [] :\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\"name\": name,\r\n\t\t\t\t\t\t\"id\": id,\r\n\t\t\t\t\t\t\"idParent\": '',\r\n\t\t\t\t\t\t\"childs\": [],\r\n\t\t\t\t\t\t\"categoryWithLink\": true,\r\n\t\t\t\t\t\t\"urlParameters\": urlParameters\r\n\t\t\t\t\t}]\r\n\t\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\t// Is Process\r\n\t\t\t\tbizagi.workportal.desktop.popup.closePopupInstance();\r\n\t\t\t\tif (countChilds == 0 && urlParameters) {\r\n\t\t\t\t\tif(bizagi.override.viewSmartFoldersAsSearch){\r\n\t\t\t\t\t\t$.when(\r\n\t\t\t\t\t\t\tself.dataService.getCustomizedColumnsData({\r\n\t\t\t\t\t\t\t\tsmartfoldersParameters: urlParameters\r\n\t\t\t\t\t\t\t}))\t\t\t\t\t\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\tbizagi.lstIdCases = data.lstIdCases;\r\n\t\t\t\t\t\t\t// Define radnumber for render actions bottons\r\n\t\t\t\t\t\t\tbizagi.referrerParams = bizagi.referrerParams || {};\r\n\t\t\t\t\t\t\tbizagi.referrerParams.radNumber = \"\"; //params.radNumber;\r\n\t\t\t\t\t\t\tbizagi.referrerParams.page = \"\"; //params.page;\r\n\t\t\t\t\t\t\tbizagi.referrerParams.referrer = \"folders\";\r\n\t\t\t\t\t\t\tbizagi.referrerParams.urlParameters = urlParameters;\r\n\t\t\t\t\t\t\tbizagi.referrerParams.name = name;\r\n\t\t\t\t\t\t\tbizagi.referrerParams.id = id;\r\n\r\n\t\t\t\t\t\t\t// Define widget customized for pagination purposes\r\n\t\t\t\t\t\t\tdata.customized = true;\r\n\t\t\t\t\t\t\tdata.urlParameters = urlParameters;\r\n\r\n\t\t\t\t\t\t\t// Define title of widget\r\n\t\t\t\t\t\t\tdata.title = name;\r\n\r\n\t\t\t\t\t\t\t// Set a flag here to tell the search widget that must show the ungroup case from folder (icon).\r\n\t\t\t\t\t\t\tdata.casesGroupedByFolder = true;\r\n\t\t\t\t\t\t\tdata.idFolder = id;\r\n\r\n\t\t\t\t\t\t\tself.publish(\"changeWidget\", {\r\n\t\t\t\t\t\t\t\twidgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,\r\n\t\t\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\t\t\treferrerParams: {}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tbizagi.referrerParams = bizagi.referrerParams || {};\r\n\t\t\t\t\t\tvar widgetRedirect;\r\n\t\t\t\t\t\tif(self.params.options.foldersView == 'inboxgrid'){\r\n\t\t\t\t\t\t\twidgetRedirect = bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID;\r\n\t\t\t\t\t\t\tbizagi.referrerParams = {\r\n\t\t\t\t\t\t\t\turlParameters : urlParameters,\r\n\t\t\t\t\t\t\t\treferrer: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\twidgetRedirect = bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX;\r\n\t\t\t\t\t\t\tbizagi.referrerParams = {\r\n\t\t\t\t\t\t\t\turlParameters : urlParameters,\r\n\t\t\t\t\t\t\t\treferrer: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tself.publish(\"changeWidget\", {\r\n\t\t\t\t\t\t\twidgetName: widgetRedirect,\r\n\t\t\t\t\t\t\tsmartfoldersParameters: {\r\n\t\t\t\t\t\t\t\turlParameters : urlParameters\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\treferrerParams: {}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\r\n\t\t// Bind for action elements (Edit and delete buttons)\r\n        \r\n\t\t$(\".editButton\", \"#queries\").click(function (e) {\r\n\t\t\te.stopPropagation();\r\n\t\t\tself.editFolder($(this).parent());\r\n\t\t});\r\n\r\n\r\n\t\t$(\".deleteButton\", \"#queries\").click(function (e) {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\tvar content = $.tmpl(confirm);\r\n\t\t\tvar idSmartFolder = $(this).data(\"id\");\r\n\t\t\tvar idParent = $(this).data(\"idparent\");\r\n\r\n\t\t\t// Open dialog with confirm message\r\n\t\t\t$(content).dialog({\r\n\t\t\t\tresizable: true,\r\n\t\t\t\tmodal: true,\r\n\t\t\t\ttitle: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n\t\t\t\tbuttons: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n\t\t\t\t\tclick: function () {\t\t\t\t\t\t\r\n\t\t\t\t\t\tself.dataService.deleteSmartFolder({\r\n\t\t\t\t\t\t\tidSmartFolder: idSmartFolder,\r\n\t\t\t\t\t\t\tidUser: bizagi.currentUser.idUser || 0\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\tself.renderFolders(idParent);\r\n\t\t\t\t\t//bizagi.workportal.desktop.popup.closePopupInstance();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n\t\t\t\t\tclick: function () {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t\t});\r\n\t\r\n\t},\r\n\r\n\t/**\r\n *   Binds the back buttons so we can navigate back\r\n */\r\n\tconfigureBackButton: function () {\r\n\t\tvar self = this;\r\n\t\tvar content = self.getContent();\r\n\t\tvar btnBack = $(\"#bt-back\", content);\r\n\t\tvar categoryTree = $(\"#categoryTree\", content);\r\n\r\n\t\t// Bind click\r\n\t\tbtnBack.click(function () {\r\n\t\t\tif ($(\"li\", categoryTree).length > 1) {\r\n\t\t\t\t// Removes last child\r\n\t\t\t\t$(\"li:last-child\", categoryTree).remove();\r\n\t\t\t\tvar idParentQuery = $(\"li:last-child\").children(\"#idParent\").val();\r\n\r\n\t\t\t\t// Render Querie again\r\n\t\t\t\tself.renderFolders(idParentQuery);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n * Configure Edit input field\r\n */\r\n\tmakeFolder: function () {\r\n\t\tvar self = this;\r\n\t\tvar url =self.dataService.getUrl({\r\n\t\t\tendPoint:\"smartfolders-integration\"\r\n\t\t})+\"?ParentQueryId=-1\";\r\n\t\t\t\t\t\r\n\t\tself.publish(\"showDialogWidget\", {\r\n\t\t\twidgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,\r\n\t\t\twidgetURL: url,\r\n\t\t\tmodalParameters: {\r\n\t\t\t\ttitle: self.getResource(\"workportal-widget-folders-new\"),\r\n\t\t\t\twidth:\"1020px\"\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t},\r\n\r\n\t\r\n\t/**\r\n * Edit folder\r\n */\r\n\teditFolder: function (element) {\r\n\t\tvar self = this;\r\n\t\tvar value = $(element).find(\"h3\").html();\r\n\t\tvar id = $(element).data(\"id\");\r\n\t\tvar url =self.dataService.getUrl({\r\n\t\t\tendPoint:\"smartfolders-integration\"\r\n\t\t})+\"?iQueryFormId=\"+id;\r\n\r\n\t\tself.publish(\"showDialogWidget\", {\r\n\t\t\twidgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,\r\n\t\t\twidgetURL: url,\r\n\t\t\tmodalParameters: {\r\n\t\t\t\ttitle: value,\r\n\t\t\t\twidth:\"1020px\"\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\r\n\t/**\r\n * Bind tree navigation\r\n */\r\n\tconfigureTreeNavigation: function (idParent) {\r\n\t\tvar self = this;\r\n\t\tvar content = self.getContent();\r\n\t\tvar categoryTree = $(\"#categoryTree\", content);\r\n\r\n\t\t// Bind header events\r\n\t\t$(\"li:last-child\", categoryTree).click(function () {\r\n\t\t\tidParent = idParent || $(this).children(\"#idParent\").val();\r\n\r\n\t\t\tif (self.params.options.onlyFolderMode && idParent == \"\") {\r\n\t\t\t\tself.renderFolders(-1);\r\n\t\t\t}\r\n\t\t\t// Remove all elements\r\n\t\t\t$(this).nextAll().remove();\r\n\t\t\t// Render query tree again\r\n\t\t\tself.renderFolders(idParent);\r\n\t\t});\r\n\t},\r\n\r\n\tscrollVertical: function () {\r\n\t\tvar self = this;\r\n\t\tvar content = self.getContent();\r\n\r\n\t\t$(\"#queries\", content).bizagiScrollbar({\r\n\t\t\t\"autohide\": false\r\n\t\t});\r\n\t}\r\n    \r\n});\r\n"]}