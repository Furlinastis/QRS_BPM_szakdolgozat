{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.files/bizagi.workportal.desktop.widgets.project.files.js","jquery/workportal/desktop/widget/project.filesPreview/bizagi.workportal.desktop.widgets.project.filesPreview.js","jquery/workportal/desktop/widget/project.file.sidebar/bizagi.workportal.desktop.widgets.project.file.sidebar.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","plan","idActivitySelected","undefined","clean","$content","getContent","empty","type","showContextByMenuDashboard","argsTemplate","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","util","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","render","appendTo","toUpperCase","addClass","siblings","removeClass","handlerEvents","loadContentById","preventDefault","$item","target","closest","hasClass","data","getLevelNavigator","pub","currentLevelNavigator","parseInt","nameItemNavigator","newLevelNavigator","localization","getResource","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","on","toggle","options","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idTask","idWorkflow","idWorkItem","idWorkitem","referrer","publish","unsub","off","injector","register","project","dashboard","menu","activity","project-content-dashboard","template","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","plugins","prefixBase64","usersData","currentFilesList","fileDateInterval","project-files","project-files-uploaditem","project-files-list","project-attachments","templateHomeFiles","isOpen","parseBoolean","isClosedForAllUsers","when","renderFilesList","done","initializeUploadFiles","eventsHandler","restrictedEventsHandler","defer","Deferred","filesLength","globalParent","encodeURIComponent","radNumber","dateTime","date","getDateServer","count","flowContext","id","getFilesListByRadNumber","renderFiles","resolve","promise","$showMoreWrapper","displayFileList","updateRelativeTime","setAdditionalData","notifyFilesNumber","renderNoFiles","noFilesTmpl","resources","$noFiles","tmpl","html","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","onSaveFileData","supportFileExt","uploadMaxFilesSize","thumbnails","users","guidsUsers","user","attachment","setUserData","join","setThumbnails","usersGuids","height","getUsersData","picture","getFileInfoByGuid","guids","getFilesThumbnails","thumbnail","$wrapper","$img","each","src","toLowerCase","setFilePreview","guidAttch","guidFile","img","userId","fileData","userData","XMLHttpRequest","JSON","parse","response","saveFileData","fail","onRetryFile","toString","description","idUser","attachmentsToCreate","unshift","createProjectFile","always","userName","Date","getTime","photo","reject","$filesList","equalizeHeights","deleteFile","filter","updateFileData","changeRelativeTime","item","relativeTime","dateFormatter","getRelativeTime","onSelectFiles","bannedFiles","isValidFile","bannedFile","splice","showFilesError","resetWidget","switchFilesEvents","stopPropagation","fileName","getDownloadAttachment","parent","mandatory","filesNumber","notifier","datePickerRegional","dialogBox","project-filespreview-wrapper","project-filespreview-preview","project-filespreview-popup","project-filespreview-thenumber","generalTmpl","setFilesNumber","fileEdition","initPluginPopupEdition","form","image","edit","parameters","isEmptyObject","currentFile","$filesNumber","formContent","showPreview","idCurrentUser","applyMenu","setEditionData","val","onResetFileForm","onSaveEdition","onSelectMenu","onOpenEdition","onDeleteFile","onDownloadFile","dialog","modal","maximize","focus","showConfirmationBox","attachmentsToDelete","validateAddFileDescriptionForm","updateProjectFile","showSucessMessage","printf","showErrorMessage","$description","result","$textAreadescription","trim","descriptionValidation","next","detach","filesPreview","supportNav","project-file-sidebar","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR","sidebar"],"mappings":"AAKAA,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,gEAKrCC,KAAM,SAAUC,EAAkBC,EAAaC,GAC5C,IAAIC,EAAOC,KACXD,EAAKD,OAASA,MAGdC,EAAKE,OAAOL,EAAkBC,EAAaC,GAG3CC,EAAKG,eACFC,yBAA0Bb,OAAOc,YAAY,qEAAqEC,OAAO,+BAO/HC,cAAe,WAGZ,OAFWN,KACNO,QAAUC,EAAE,eADNR,KAECO,SAMfE,WAAY,WACT,IAAIV,EAAOC,KAEXD,EAAKD,OAAOY,iCAAiCC,QAAQ,SAASC,GAC3Db,EAAKc,IAAID,EAASJ,EAAEM,MAAMf,EAAKgB,WAAYhB,OASjDgB,WAAY,SAAUC,EAAOlB,GAC1B,IAAIC,EAAOC,KACXD,EAAKD,OAASU,EAAEd,OAAOK,EAAKD,OAAQA,EAAOmB,MAC3ClB,EAAKD,OAAOoB,KAAKC,wBAAqBC,EACtCrB,EAAKsB,QACL,IAAIC,EAAWvB,EAAKwB,aAAaC,aAER,IAAfR,EAAMS,OACb1B,EAAKD,OAAO4B,2BAA6BV,EAAMS,MAGlD,IAAIE,GACDC,iBAAkB7B,EAAKD,OAAO+B,cAAcD,iBAC5CE,iBAAkB/B,EAAKD,OAAO+B,cAAcC,iBAC5CC,uBAAwBhC,EAAKD,OAAO+B,cAAcE,uBAClDC,oBAAqBjC,EAAKD,OAAO+B,cAAcG,oBAC/CC,uBAAwBlC,EAAKD,OAAO+B,cAAcI,0BAC7ClC,EAAKD,OAAOoC,gBACbnC,EAAKD,OAAOoC,gBAAkB5C,OAAO6C,KAAKC,gBAAgB,kCAC9DC,mBAAoBtC,EAAKD,OAAO+B,cAAcQ,mBAC9CC,sBAAuBvC,EAAKD,OAAO+B,cAAcS,sBACjDC,8BAA+BxC,EAAKD,OAAO+B,cAAcU,+BAI7CxC,EAAKK,YAAY,0BACvBoC,OAAOb,GAAcc,SAASnB,GAEpCvB,EAAKD,OAAO4B,4BACZlB,EAAE,oBAAsBT,EAAKD,OAAO4B,2BAA2BgB,cAAgB,KAAM3C,EAAKQ,SAASoC,SAAS,UAAUC,WAAWC,YAAY,UAGhJ9C,EAAK+C,iBAMRC,gBAAiB,SAAU/B,GACxB,IAAIjB,EAAOC,KACXgB,EAAMgC,iBACN,IAAIC,EAAQzC,EAAEQ,EAAMkC,QAAQC,QAAQ,MAEpC,IAAKF,EAAMG,SAAS,UAAW,CAE5B,IAAI1B,EAA6BuB,EAAMI,KAAK,WAE5C,GAAI3B,EAA4B,CAC7B,IAAI4B,EAAoBvD,EAAKwD,IAAI,UAAY9B,KAAM,uBAC/C+B,EAAwBC,SAASH,EAAkB,GAAI,IACvDI,EAAoB,GACpBC,EAAoBH,EAES,kBAA9B9B,IACAiC,EAAoBH,EAAwB,EAC5CE,EAAoBpE,OAAOsE,aAAaC,YAAY,0CAGvD9D,EAAKD,OAAOgE,2BAA4B,EACxC/D,EAAKwD,IAAI,UACN9B,KAAMC,EAA2BgB,cACjCzB,KAAMT,EAAEd,OAAOK,EAAKD,QAAU4B,2BAA4BA,EACvDqC,SAAUL,EACVM,MAAOL,MAEVnD,EAAE,oBAAsBT,EAAKD,OAAO4B,2BAA2BgB,cAAgB,KAAM3C,EAAKQ,SAASoC,SAAS,UAAUC,WAAWC,YAAY,aAKzJoB,eAAgB,WACZ,IACI1D,EADOP,KACQuB,aACf2C,EAAY1D,EAAE,4BAA6BD,GAC3C4D,EAAS3D,EAAE,yBAA0BD,GACrC6D,EAAY5D,EAAE,4BAA6BD,GAE/CC,EAAE,sCAAuCD,GAAS8D,GAAG,QAAS,WAC1DH,EAAUI,SACVH,EAAOG,SACPF,EAAUE,YAOlBxB,cAAe,WACZ,IAAI/C,EAAOC,KACPO,EAAUR,EAAKwB,aAEnBxB,EAAKkE,iBAELzD,EAAE,oCAAqCD,GAAS8D,GAAG,QAAS7D,EAAEM,MAAMf,EAAKgD,gBAAiBhD,IAGzFS,EAAE,6DAA8DD,GAAS8D,GAAG,QAAS,WACjF,IAAIE,GACAC,OAAQlF,OAAOC,WAAWkF,QAAQD,OAAOE,iCACzCC,OAAQ5E,EAAKD,OAAO6E,OACpBC,OAAQ7E,EAAKD,OAAO8E,OACpBC,WAAY9E,EAAKD,OAAO+E,WACxBC,WAAY/E,EAAKD,OAAOiF,WACxBC,SAAUjF,EAAKD,OAAOkF,UAAY,aAEtCjF,EAAKkF,QAAQ,gBAAiBV,MAOtClD,MAAO,WACJ,IAAItB,EAAOC,KACPO,EAAUR,EAAKwB,aAEhBxB,EAAKD,QAAUC,EAAKD,OAAOY,kCAC3BX,EAAKD,OAAOY,iCAAiCC,QAAQ,SAASC,GAC3Db,EAAKmF,MAAMtE,EAASJ,EAAEM,MAAMf,EAAKgB,WAAYhB,MAInDS,EAAE,oCAAqCD,GAAS4E,MAChD3E,EAAE,6DAA8DD,GAAS4E,SAI/E7F,OAAO8F,SAASC,SAAS,6DAA8D,mBAAoB,cAAe/F,OAAOC,WAAWC,QAAQ8F,QAAQC,UAAUC,KAAKC,WAAW,GC1KtLnG,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,0DAKrCC,KAAM,SAAUC,EAAkBC,EAAaC,GACjCE,KAGNC,OAAOL,EAAkBC,EAAaC,GAHhCE,KAMNE,eACFwF,4BAA6BpG,OAAOc,YAAY,8DAA8DC,OAAO,sCAQ3HC,cAAe,WACZ,IAAIP,EAAOC,KAEP2F,EAAW5F,EAAKK,YAAY,6BAGhC,OAFAL,EAAKQ,QAAUoF,EAASnD,WAEjBzC,EAAKQ,SAEfE,WAAY,WAGTmF,WAAW,WACRpF,EAAEqF,QAAQC,QAAQ,WAClB,QAMTxG,OAAO8F,SAASC,SAAS,uDAAwD,mBAAoB,cAAe/F,OAAOC,WAAWC,QAAQ8F,QAAQ/E,QAAQgF,YAAY,GCrCzK,SAAW/E,GAGP,IACCuF,EADWF,OAAOG,MACPD,GACXE,EAASF,EAAGE,OAETC,EAAqBD,EAAOvG,QAE5BC,KAAM,SAAUwG,EAAS5B,GAErB,IAAI6B,EAAOpG,KAGXiG,EAAOI,GAAG1G,KAAK2G,KAAKF,EAAMD,EAAS5B,GAEnC6B,EAAKG,cAAgBhC,EAAQiC,QAC7BJ,EAAKK,aACLL,EAAKM,iCAAmCnC,EAAQoC,kCAAmC,EACnFP,EAAKQ,gBAAkBrC,EAAQsC,WAC/BT,EAAKU,oBAAsBvC,EAAQiC,QACnCJ,EAAKW,OAASX,EAAKY,cACnBZ,EAAKa,aAAeb,EAAKc,oBACzBd,EAAKe,aAAef,EAAKgB,oBAEzBhB,EAAKiB,iBAELjB,EAAKkB,kBAAkBlB,EAAK7B,QAAQX,eAGxCW,SACIgD,KAAM,qBACNC,QAAShH,EAAE,2CACXiH,UAAU,EACVC,UAAU,EACVC,aAAcrI,OAAOsI,YAActI,OAAOsI,YAAYC,kBAAoB,KAC1EC,SAAS,EACTlE,iBAGJoD,YAAa,WAET,IAAIZ,EAAOpG,KACVuE,EAAU6B,EAAK7B,QACfX,EAAeW,EAAQX,iBACvBmE,EAAwB,EAIzB,OAFA3B,EAAKkB,kBAAkB1D,GAEhB5D,KAAKmG,QAAQ6B,aAChBC,OACIC,QAAS3D,EAAQ2D,QAAU,SAAW5I,OAAO6I,eAC7CC,YAAY,GAEhBC,OAAQ,SAAUrH,GACdoF,EAAKkC,oBAAoBtH,GACzB+G,EAAwB,GAE5BQ,SAAU,WACN,IAAIC,EAAWC,YAAY,WAC4C,IAAhErC,EAAKa,aAAaO,QAAQkB,KAAK,sBAAsBC,SACrDvC,EAAKwC,gCAAgCxC,EAAKa,aAAaO,QAASO,GAChEc,cAAcL,KAElB,MAEPzB,OAAQxC,EAAQwC,OAChB+B,SAAU,SAAU9H,GAChBoF,EAAK2C,gBAAgB/H,IAEzBgI,QAAS,SAAUhI,GACfoF,EAAKK,UAAUwC,KAAKjI,EAAMkI,MAAM,IAChCnB,GAAyB,EACzBxD,EAAQyE,QAAQhI,IAEpBmI,MAAO,SAAUnI,GACboF,EAAKgD,YAAYpI,IAErB4C,cACIyE,OAAQzE,EAAayF,YACrBC,cAAe1F,EAAa0F,eAEhC7B,SAAUlD,EAAQkD,SAClBK,QAASvD,EAAQuD,QACjBJ,SAAUnD,EAAQmD,SAClB6B,cAAc,IACflG,KAAK,gBAIZ+D,kBAAmB,WACf,OAAO5G,EAAE,eAAegJ,mBACpBC,UACIC,QAAQ,KAEbrG,KAAK,sBAGZ6D,kBAAmB,WAEf,IACOtD,EADI5D,KACgBuE,QAAQX,aAGnC,OAJW5D,KAEYuE,QAAQiD,QAEfmC,aACZC,MAAOhG,EAAaiG,cACpBpF,SAAU,SACVqF,WACIC,MACIC,SAAU,KAEdC,OACID,SAAU,MAGlBD,KAAM,WACF/J,KAAKwH,QAAQ7E,SAAS,uCAE1BuH,SAAS,EACTC,WAAW,EACXC,WAAW,EACXC,UAAW,QACXC,SAAU,UACXjH,KAAK,gBAIZiE,kBAAmB,SAASiD,GACxB,IACIC,GACAnB,YAAa/J,OAAOsE,aAAaC,YAAY,2CAC7CgG,cAAevK,OAAOsE,aAAaC,YAAY,gDAC/C4G,YAAanL,OAAOsE,aAAaC,YAAY,kDAC7C6G,cAAepL,OAAOsE,aAAaC,YAAY,6CAC/C8G,UAAWrL,OAAOsE,aAAaC,YAAY,8CAC3C+G,kBAAmBtL,OAAOsE,aAAaC,YAAY,8CAA8CgH,QAAQ,KAAOC,KAAKC,MAP9G/K,KAOyHuG,cAAc,KAAU,IACxJ+C,cAAehK,OAAOsE,aAAaC,YAAY,2CAC/CmH,OAAQ1L,OAAOsE,aAAaC,YAAY,4CACxCoH,MAAO3L,OAAOsE,aAAaC,YAAY,wCACvCoG,MAAO3K,OAAOsE,aAAaC,YAAY,uCAG3CrD,EAAEd,OAAO6K,EAA2BC,IAGxCzB,gBAAiB,SAAU/H,GAEvB,IACIkK,EADOlL,KACMmL,kBAAkBnK,EAAMkI,MAAM,GAAGkC,KAC9CC,EAAUrK,EAAMsK,gBAEpB9K,EAAE,cAAe0K,GAAOK,KACpBC,MAAOH,EAAU,MAGrB7K,EAAE,gBAAiB0K,GAAOrI,YAAY,oBAAoB4I,KAAKJ,EAAU,KAEzD,MAAZA,GAAkB7K,EAAE,2BAA4B0K,GAAOQ,QAG/DC,sBAAuB,SAAU3K,GAE7B,IACGkI,EAAQlI,EAAMkI,MACdvD,EAFQ3F,KAEQuE,QAAQoB,SAFhB3F,KAINiH,aAAa1G,QAAQoF,EAASnD,QAAS0G,MAAOA,KAJxClJ,KAKNiH,aAAaO,QAAQ+D,KACtBK,IAAK,OACLC,KAAM,OACNC,OAAQ,MACRC,MAAO,QATA/L,KAYNiH,aAAa8C,QAGvBnB,gCAAiC,SAASoD,EAAgBjE,GAElDiE,EAAetD,KAAK,qBAAqBC,SAAWZ,GAA2E,IAAlDiE,EAAetD,KAAK,mBAAmBC,QAD7G3I,KAGFiM,iBAAiBD,IAI7BC,iBAAkB,SAASD,GACvB,IAAI5F,EAAOpG,KACX4F,WAAW,WACPoG,EAAeE,QAAQ,WACnB9F,EAAKa,aAAagD,WAEvB,MAGPkC,cAAe,SAAUC,GACrB,IACIC,EAAeD,EAAQjJ,QAAQ,MAC/BmJ,EAFOtM,KAEe+G,OAAOS,QAC7B+E,EAAOF,EAAahJ,KAAK,QAE7BiJ,EAAe5D,KAAK,eAAiB6D,EAAO,sBAAsBzG,QAAQ,SAC1EuG,EAAaG,UAGjBC,cAAe,SAAUL,GACFA,EAAQjJ,QAAQ,MACtBqJ,UAGjBE,aAAc,SAAUN,GACpB,IAEIG,EADQH,EAAQjJ,QAAQ,MACXE,KAAK,QAClBsJ,EAAOnM,EAAEoM,KAHF5M,KAGYyG,UAAW,SAAUoG,GACxC,OAAOA,EAAEzB,MAAQmB,IAJVvM,KAONuE,QAAQ0G,MAAM0B,EAAK,KAG5BvD,YAAa,SAAUpI,GAEnB,IACA4C,EADW5D,KACSuE,QAAQX,aAC5B+I,EAAO3L,EAAMkI,MAAM,GACnB4D,EAHW9M,KAGO+M,aAAaJ,GAC3BK,EAAkC,KAAvBF,EAAWE,QAAkBF,EAAWE,QAAUpJ,EAAa6G,YAJnEzK,KAMNiN,UAAU,QAASN,EAAKvB,IAAK4B,IAGtCD,aAAc,SAAUJ,GAEpB,IACA/I,EADW5D,KACSuE,QAAQX,aAC5BsJ,GAAQ,EACRF,EAAU,GAcV,OAZIL,EAAKQ,KALEnN,KAKU8G,qBAAoC1F,MAAbuL,EAAKQ,MAAkC,GAAbR,EAAKQ,QACvEH,EAAUpJ,EAAa+G,UACvBuC,GAAQ,GAPDlN,KAUF0G,mCACoD,IAArDlG,EAAE4M,QAAQT,EAAKU,UAXZrN,KAW4B4G,mBAC/BoG,EAAUpJ,EAAa8G,cACvBwC,GAAQ,IAKZA,MAAOA,EACPF,QAASA,IAIjB1E,oBAAqB,SAAUtH,GAK5B,IAHA,IACIsM,EAAQ,EAEHT,EAAI,EAAGlE,EAAS3H,EAAMkI,MAAMP,OAAQkE,EAAIlE,EAAQkE,IACrDS,GAAStM,EAAMkI,MAAM2D,GAAGM,KAExBG,EANOtN,KAMMuG,eANNvG,KAOFuN,sBACLvM,EAAMgC,kBARChD,KAUF2L,sBAAsB3K,IAIlCuM,oBAAqB,WAENvN,KAENmH,aAAaqG,KAFPxN,KAEiBuE,QAAQX,aAAagH,kBAAmB,UAGxEO,kBAAmB,SAAUC,GAEzB,OAAO5K,EAAE,gBAAkB4K,EAAM,IADtBpL,KACgCiH,aAAad,UAG5DsH,cAAe,SAAUzM,GACrB,IACIoL,EAAU5L,EAAE,UAAWQ,EAAM0M,eAC7BtB,EAAQhJ,SAAS,aAAegJ,EAAQhJ,SAAS,YAF1CpD,KAGFyM,cAAcL,GACZA,EAAQhJ,SAAS,WAJjBpD,KAKF0M,aAAaN,GACXA,EAAQhJ,SAAS,aANjBpD,KAOFmM,cAAcC,IAI3B/E,eAAgB,WACZ,IAAIjB,EAAOpG,KAEXoG,EAAKa,aAAad,QAAQ9B,GAAG,QAAS,yBAA0B,SAAUrD,GACtEoF,EAAKqH,cAAczM,MAI3B2M,kBAAmB,WACJ3N,KACe+G,OAAOS,QAElBkB,KAAK,uBAAuB5C,QAAQ,SAHxC9F,KAINiK,SAGTA,MAAO,WACHjK,KAAKiH,aAAagD,SAGtB2D,QAAS,WACL5N,KAAKiH,aAAa2G,UAClB5N,KAAK+G,OAAO6G,WAGhBX,UAAW,SAAUY,EAAQzC,EAAK4B,GAE9B,IAAI9B,EAAQlL,KAAKmL,kBAAkBC,GAC/BxH,EAAe5D,KAAKuE,QAAQX,aAEhC,OAAQiK,GACJ,IAAK,UACD3C,EAAMrI,YAAY,gCAAgCF,SAAS,kBAC3DnC,EAAE,2BAA4B0K,GAAOrI,YAAY,gCAAgCF,SAAS,YAAYmL,KAAK,QAASlK,EAAaqG,OAAOuD,OACxIhN,EAAE,cAAe0K,GAAOO,KAAK,IAC7B,MACJ,IAAK,QACDP,EAAMrI,YAAY,mBAAmBF,SAAS,gBAC9CnC,EAAE,2BAA4B0K,GAAOrI,YAAY,uBAAuBF,SAAS,YAAY6K,OAC7FhN,EAAE,iCAAkC0K,GAAOrI,YAAY,0BAA0BF,SAAS,oBAC1FnC,EAAE,cAAe0K,GAAOO,KAAKuB,GAASc,KAAK,QAASd,GACpD,MACJ,IAAK,QACD9B,EAAMrI,YAAY,mBAAmBF,SAAS,gBAC9CnC,EAAE,iCAAkC0K,GAAOrI,YAAY,0BAA0BF,SAAS,aAAa8I,KAAK,IAC5GjL,EAAE,2BAA4B0K,GAAOrI,YAAY,qBAAqBF,SAAS,uBAAuBmL,KAAK,QAASlK,EAAaqH,OAAOuC,OACxIhN,EAAE,cAAe0K,GAAOO,KAAK7H,EAAa6G,aAAaqD,KAAK,QAASlK,EAAamK,oBAOlGhI,EAAGiI,OAAO9H,GA7Vd,CA8VG+H,QCjWJ3O,OAAOC,WAAWC,QAAQ8F,QAAQ4I,KAAKxO,OAAO,8CAI1CC,KAAM,SAAUC,EAAkBC,EAAaC,GAE3C,IAAIC,EAAOC,KAGXD,EAAKE,OAAOL,EAAkBC,EAAaC,GAE3CC,EAAKoO,WACLpO,EAAKqO,aAAe,yBACpBrO,EAAKsO,aACLtO,EAAKuO,oBACLvO,EAAKwO,iBAGLxO,EAAKG,eACDsO,gBAAiBlP,OAAOc,YAAY,kDAAkDC,OAAO,0BAC7FoO,2BAA4BnP,OAAOc,YAAY,kDAAkDC,OAAO,6BACxGqO,qBAAsBpP,OAAOc,YAAY,kDAAkDC,OAAO,uBAClGsO,sBAAuBrP,OAAOc,YAAY,yDAAyDC,OAAO,2BAOlHC,cAAe,WACX,IACIsO,EADO5O,KACkBI,YAAY,iBAEzC,OAHWJ,KAENO,QAAUqO,EAAkBpM,QAASqM,QAASvP,OAAO6C,KAAK2M,aAFpD9O,KAEsEF,OAAOiP,uBAF7E/O,KAGCO,SAMhBE,WAAY,WACR,IAAIV,EAAOC,KACXQ,EAAEwO,KAAKjP,EAAKkP,mBAAmBC,KAAK,WAChCnP,EAAKoO,QAAqB,YAAIpO,EAAKoP,wBACnCpP,EAAKqP,gBACLrP,EAAKsP,6BAObJ,gBAAiB,WACb,IAAIlP,EAAOC,KACPsP,EAAQ9O,EAAE+O,WACVC,EAAczP,EAAKuO,iBAAiB3F,OACpC7I,GACA2P,aAAcC,mBAAmB3P,EAAK4P,WACtCC,SAAYJ,EAAsCzP,EAAKuO,iBAAiBkB,EAAc,GAAGK,KAA9D9P,EAAK+P,gBAChCC,MAAO,IAaX,MAX8B,gCAA3BhQ,EAAKD,OAAOkQ,cACXlQ,EAAO2P,aAAe1P,EAAKD,OAAOoB,KAAK+O,IAE3CzP,EAAEwO,KAAKjP,EAAKF,YAAYqQ,wBAAwBpQ,IAASoP,KAAK,SAAUhG,GACpEnJ,EAAKuO,iBAAmBvO,EAAKuO,iBAAiBjO,OAAO6I,GAErDnJ,EAAKoQ,YAAYjH,GAEjBoG,EAAMc,YAGHd,EAAMe,WAMjBF,YAAa,SAASjH,GAElB,IAAInJ,EAAOC,KAEPsB,EAAWvB,EAAKwB,aAChB+O,EAAmB9P,EAAE,0BAA2Bc,GACpDvB,EAAKwQ,gBAAgBrH,EAAO,UAC5BnJ,EAAKyQ,qBAEDtH,EAAMP,QACN5I,EAAK0Q,kBAAkBvH,GAGvBnJ,EAAKuO,iBAAiB3F,QAAU,KAChC2H,EAAiB9C,OAEbtE,EAAMP,OAAS,KACfnI,EAAE,SAAU8P,GAAkB9D,SAC9BhM,EAAE,wBAAyB8P,GAAkB9C,SAIrDzN,EAAK2Q,mBAAkB,IAM3BC,cAAe,WAEX,IACIC,EADO5Q,KACYJ,iBAAiBQ,YAAY,gBAChD4M,EAFOhN,KAEQ6Q,UAAUhN,YAAY,wCAIrCiN,EAAWtQ,EAAEuQ,KAAKH,GAClB5D,QAASA,IAPFhN,KAUNO,QAAQyQ,KAAKF,IAMtB3B,sBAAuB,WACnB,IAAIpP,EAAOC,KACPO,EAAUR,EAAKwB,aAEnB,OAAOf,EAAE,wBAAyBD,GAAS0Q,yBACvC/I,QAASnI,EAAKF,YAAYqR,eAAeC,OAAO,gCAChDxL,SAAU5F,EAAKK,YAAY,uBAC3B4I,QAASxI,EAAEM,MAAMf,EAAKqR,cAAerR,GACrCgH,OAAQvG,EAAEM,MAAMf,EAAKsR,YAAatR,GAClCkL,MAAOzK,EAAEM,MAAMf,EAAKuR,eAAgBvR,GACpC+H,SAAS,EACTjB,WAAY9G,EAAKwR,eACjB/K,QAASzG,EAAKyR,qBACfnO,KAAK,4BAMZoN,kBAAmB,SAAUvH,GAKzB,IAHA,IACIuI,KAAiBC,KAAYC,KAExB9E,EAAI,EAAGlE,EAASO,EAAMP,OAAS,EAAGkE,GAAKlE,EAAQkE,IACpD6E,EAAMzI,KAAKC,EAAM2D,GAAG+E,MACpBD,EAAW1I,KAAKC,EAAM2D,GAAG+E,MACzBH,EAAWxI,KAAKC,EAAM2D,GAAGgF,WAAWtF,MAN7BvM,KASN8R,YAAYH,EAAWI,QATjB/R,KAUNgS,cAAcP,EAAWM,SAMlCD,YAAa,SAAUJ,GACnB,IAAI3R,EAAOC,KACPsB,EAAWvB,EAAKwB,aAEhBzB,GACAmS,WAAYP,EACZlG,MAAO,GACP0G,OAAQ,IAGZ1R,EAAEwO,KAAKjP,EAAKF,YAAYsS,aAAarS,IAASoP,KAAK,SAAUwC,GACzD,IAAK,IAAI7E,EAAI,EAAGlE,EAAS+I,EAAM/I,OAAS,EAAGkE,GAAKlE,EAAQkE,IACjD6E,EAAM7E,GAAGuF,UACRV,EAAM7E,GAAGuF,QAAUrS,EAAKqO,aAAesD,EAAM7E,GAAGuF,SAEpDrS,EAAKsO,UAAU,KAAOqD,EAAM7E,GAAGoD,IAAMyB,EAAM7E,GAC3CrM,EAAE,oEAAsEkR,EAAM7E,GAAGoD,GAAK,IAAK3O,GAAUmK,KAAKiG,EAAM7E,GAAGtF,SAQ/H8K,kBAAmB,SAAU9F,GAGzB,IAFA,IACII,EACKE,EAAI,EAAGlE,EAFL3I,KAEmBsO,iBAAiB3F,OAAQkE,EAAIlE,EAAQkE,IAE3DN,IAJGvM,KAIWsO,iBAAiBzB,GAAGN,OAClCI,EALG3M,KAKSsO,iBAAiBzB,GAC7BA,EAAIlE,GAGZ,OAAOgE,GAMXqF,cAAe,SAAUP,GACrB,IAAI1R,EAAOC,KACPsB,EAAWvB,EAAKwB,aAEhBzB,GACAwS,MAAOb,EACPjG,MAAO,IACP0G,OAAQ,KAGZ1R,EAAEwO,KAAKjP,EAAKF,YAAY0S,mBAAmBzS,IAASoP,KAAK,SAAUhG,GAC/D,IAAIsJ,EAAWC,EAAUC,EAEzBlS,EAAEmS,KAAKzJ,EAAO,SAAUqD,EAAMqG,GAC1BrG,EAAOA,EAAKsG,cACZL,EAAYzS,EAAKqO,aAAewE,EAChCH,EAAWjS,EAAE,2EAA6E+L,EAAO,IAAKjL,IACtGoR,EAAOlS,EAAE,wCAAyCiS,IAE7C3E,KAAK,MAAO0E,GACjBhS,EAAE,mCAAoCiS,GAAUjG,SAChDkG,EAAKnH,IAAI,UAAW,cAQhCuH,eAAgB,SAAU1G,EAAS2G,EAAWC,GAE1C,IAAIjT,EAAOC,KACPiT,EAAM,GACNnT,GACAwS,OAAQS,GAAWhB,OACnBvG,MAAO,IACP0G,OAAQ,KAGZ1R,EAAEwO,KAAKjP,EAAKF,YAAY0S,mBAAmBzS,IAASoP,KAAK,SAAUhG,GAC/D,IACIgK,EADW9G,EAAQ1D,KAAK,oCACNrF,KAAK,UAE3B7C,EAAEmS,KAAKzJ,EAAO,SAAUqD,EAAMqG,GAC1BK,EAAMlT,EAAKqO,aAAewE,IAG9B7S,EAAKwD,IAAI,UACL9B,KAAM,cACNR,MACI0O,UAAWD,mBAAmB3P,EAAK4P,WACnCwD,SAAUpT,EAAKsS,kBAAkBW,GACjCI,SAAUrT,EAAKsO,UAAU,KAAO6E,GAChCrE,QAASvP,OAAO6C,KAAK2M,aAAa/O,EAAKD,OAAOiP,qBAC9CkE,IAAKA,KAIblT,EAAKwD,IAAI,UACL9B,KAAM,0BAQlB2P,cAAe,SAAUpQ,IAGPA,EAAMqS,eAAuB,SAAIC,KAAKC,MAAMvS,EAAMqS,eAAeG,cAEnErK,MAHDnJ,KAMFmO,QAAqB,YAAE/E,YAAYpI,GANjChB,KAIFsR,eAAetQ,EAAMkI,MAAM,KASxCoI,eAAgB,SAAU3E,GAEtB,IAAI5M,EAAOC,KAEXQ,EAAEwO,KAAKjP,EAAK0T,aAAa9G,IAAOuC,KAAK,WACjCnP,EAAK2Q,oBACL3Q,EAAKoO,QAAqB,YAAElB,UAAU,UAAWN,EAAKvB,OACvDsI,KAAK,WACJ3T,EAAKoO,QAAqB,YAAElB,UAAU,QAASN,EAAKvB,QAQ5DuI,YAAa,SAAUvH,GACnB,IACIlB,EAAQkB,EAAQjJ,QAAQ,MACxBoJ,EAAOrB,EAAM7H,KAAK,QAElBsJ,EAAOnM,EAAEoM,KAJF5M,KAIYsO,iBAAkB,SAAUzB,GAC/C,OAAOA,EAAEzB,MAAQmB,IALVvM,KAQNsR,eAAepG,EAAOyB,EAAK,KAOpC0E,YAAa,SAAUrQ,GAInBA,EAAMqC,MACFkJ,KAAMvL,EAAMkI,MAAM,GAAGkC,MAS7BqI,aAAc,SAAU9G,GAEpB,IAAI5M,EAAOC,KACPsP,EAAQ9O,EAAE+O,WAEVhD,EAAOzB,KAAKyB,OACZkD,EAAe1P,EAAK4P,UAAY5P,EAAK4P,UAAUiE,WAAa,GAChC,gCAA5B7T,EAAKD,OAAOkQ,cACZP,EAAe1P,EAAKD,OAAOoB,KAAK+O,IAGpC,IAAInQ,GACAS,SACIgM,KAAQA,EACRsH,YAAe,GACftM,KAAQoF,EAAKpF,KACbsK,YACItF,KAAQI,EAAKvB,IACb7D,KAAQoF,EAAKpF,MAEjBsI,KAAQ9P,EAAK+P,gBACb8B,KAAQtS,OAAOsI,YAAYkM,OAC3BrE,aAAgBA,GAEpBsE,qBACIpH,EAAKvB,MAqCb,OAjCArL,EAAKuO,iBAAiB0F,QAAQrH,GAE9BnM,EAAEwO,KAAKjP,EAAKF,YAAYoU,kBAAkBnU,IAASoU,OAAO,SAAUV,GACxC,MAApBA,EAAS3F,QAAsC,MAApB2F,EAAS3F,aAAsCzM,IAApBoS,EAAS3F,QAG/DrN,EAAEd,OAAOiN,GACLiF,KAAMtS,OAAOsI,YAAYkM,OACzBK,SAAU7U,OAAOsI,YAAYuM,SAC7BtE,MAAM,IAAIuE,MAAOC,UACjBxC,WAAY/R,EAAOS,QAAQsR,WAC3BtF,KAAMzM,EAAOS,QAAQgM,KACrBsH,YAAa/T,EAAOS,QAAQsT,cAGhC9T,EAAKsO,UAAU,KAAO/O,OAAOsI,YAAYkM,SACrC1B,QAAS9S,OAAOsI,YAAY0M,MAC5B/M,KAAMjI,OAAOsI,YAAYuM,SACzBlE,GAAI3Q,OAAOsI,YAAYkM,QAG3B/T,EAAKwQ,gBAAgB5D,EAAM,WAE3B5M,EAAKyQ,qBACLzQ,EAAKiS,cAAcrF,EAAKvB,KAExBkE,EAAMc,WAGNd,EAAMiF,WAIPjF,GAQXiB,gBAAiB,SAAUrH,EAAO1E,GAC9B,IACIuM,EADO/Q,KACKI,YAAY,sBAExBG,GADA2I,EAAQA,GAFDlJ,KAEesO,iBAFftO,KAGQuB,cACfiT,EAAazD,EAAKvO,QAClB0G,MAAOA,IAGX1I,EAAE,sBAAuBD,GAASiE,GAAQgQ,GAC1ChU,EAAEiU,gBAAgB,aAQtBC,WAAY,SAAS1T,EAAOlB,GACxB,IAEIS,EAFOP,KAEQuB,aACnBf,EAAE,sBAAwBV,EAAOmB,KAAKsL,KAAO,KAAMhM,GAASiM,SAHjDxM,KAKNsO,iBALMtO,KAKkBsO,iBAAiBqG,OAAO,SAAUhI,GAC3D,OAAOA,EAAKJ,OAASzM,EAAOmB,KAAKsL,OAN1BvM,KASN0Q,mBAAkB,IAQ3BkE,eAAgB,SAAU5T,EAAOlB,GAElBE,KACKqS,kBAAkBvS,EAAOmB,KAAKsL,MAEzCsH,YAAc/T,EAAOmB,KAAK4S,aAMnCrD,mBAAoB,WAEhB,IAAIzQ,EAAOC,KAEPD,EAAKwO,kBAAkB1F,cAAc9I,EAAKwO,kBAE9CxO,EAAKwO,iBAAmB9F,YAAYjI,EAAEM,MAAMf,EAAK8U,mBAAoB9U,GAAO,SAMhF8U,mBAAoB,WAEhB,IACIvT,EADOtB,KACSuB,aAEpBf,EAAE,uDAAwDc,GAAUqR,KAAK,SAAU9F,EAAGiI,GAClF,IAAIlF,EAAWpP,EAAEsU,GAAMzR,KAAK,QACxB0R,EAAezV,OAAO6C,KAAK6S,cAAcC,gBAAgB,IAAIb,KAAKxE,GAAW,MAAM,GAEvFpP,EAAEsU,GAAMrJ,KAAKsJ,MAQrBG,cAAe,SAAUlU,GAMrB,IAJA,IACImU,KACAjM,EAAQlI,EAAMkI,MAET2D,EAAI3D,EAAMP,OAAS,EAAGkE,GAAK,EAAGA,IAEnC,IANO7M,KAMGoV,YAAYlM,EAAM2D,IAAIK,MAAO,CACnC,IAAImI,EAAanM,EAAMoM,OAAOzI,EAAGA,EAAI,GACrCsI,EAAYnB,QAAQqB,EAAW,IAInCF,EAAYxM,OAAS,GAZd3I,KAaFuV,eAAeJ,IAO5BK,YAAa,WAEExV,KACHmO,QAAqB,aADlBnO,KAEFmO,QAAqB,YAAElE,QAFrBjK,KAINsO,oBACLzF,cALW7I,KAKQuO,mBAMvBkH,kBAAmB,SAAUzU,GAEzBA,EAAM0U,kBAEN,IAEItJ,EAAU5L,EAAEQ,EAAMkC,QAClBD,EAAQmJ,EAAQjJ,QAAQ,wCAE5B,GAAGF,EAAM0F,OAAQ,CAEb,IAAIoK,EAAY9P,EAAMI,KAAK,aACvB2P,EAAW/P,EAAMI,KAAK,YAE1B,GAAI+I,EAAQhJ,SAAS,mCAAoC,CACrD,IAAIuS,EAAWvJ,EAAQX,OAXpBzL,KAaEH,YAAY+V,sBAAsB7C,EAAW4C,QAb/C3V,KAeE8S,eAAe7P,EAAO8P,EAAWC,OAGH,2BAAhC5G,EAAQyJ,SAAS/H,KAAK,MAlBtB9N,KAmBFiP,kBACyB,yBAAvB7C,EAAQ0B,KAAK,OApBb9N,KAqBF0Q,mBAAkB,IAS/BA,kBAAmB,SAASoF,GACb9V,KAENuD,IAAI,UACL9B,KAAM,iBACNR,MACI8U,YALG/V,KAKesO,iBAAiB3F,OACnCmN,UAAWA,MAQvBzG,wBAAyB,WACVrP,KACNO,QAAQ8D,GAAG,QAAS7D,EAAEM,MADhBd,KAC2ByV,kBAD3BzV,QAOfoP,cAAe,WAEX,IAAIrP,EAAOC,KACPsB,EAAWvB,EAAKwB,aAEpBxB,EAAKc,IAAI,sBAAuBL,EAAEM,MAAMf,EAAKyV,YAAazV,IAC1DA,EAAKc,IAAI,aAAcL,EAAEM,MAAMf,EAAK6U,eAAgB7U,IACpDA,EAAKc,IAAI,aAAcL,EAAEM,MAAMf,EAAK2U,WAAY3U,IAEhDuB,EAAS+C,GAAG,QAAS7D,EAAEM,MAAMf,EAAK0V,kBAAmB1V,KAMzDsB,MAAO,WACH,IAAItB,EAAOC,KAOX,IAAK,IAAI6M,KANT9M,EAAKyV,cAELzV,EAAKmF,MAAM,sBAAuB1E,EAAEM,MAAMf,EAAKyV,YAAazV,IAC5DA,EAAKmF,MAAM,aAAc1E,EAAEM,MAAMf,EAAK6U,eAAgB7U,IACtDA,EAAKmF,MAAM,aAAc1E,EAAEM,MAAMf,EAAK2U,WAAY3U,IAEpCA,EAAKoO,QACXpO,EAAKoO,QAAQtB,IACb9M,EAAKoO,QAAQtB,GAAGe,UAGxB/E,cAAc9I,EAAKwO,kBACnBxO,EAAKE,YAIbX,OAAO8F,SAASC,SAAS,2CAA4C,mBAAoB,cAAe/F,OAAOC,WAAWC,QAAQ8F,QAAQ4D,QAAQ,GCvlBlJ5J,OAAOC,WAAWC,QAAQ8F,QAAQ4I,KAAKxO,OAAO,qDAI1CC,KAAM,SAAUC,EAAkBC,EAAamW,EAAUlW,GACrD,IAAIC,EAAOC,KAGXD,EAAKkW,mBAAqB3W,OAAOsE,aAAaC,YAAY,sBAE1D9D,EAAKmW,aAGLnW,EAAKE,OAAOL,EAAkBC,EAAaC,GAC3CC,EAAKiW,SAAWA,EAGhBjW,EAAKG,eACDiW,+BAAgC7W,OAAOc,YAAY,yDAAyDC,OAAO,iCACnH+V,+BAAgC9W,OAAOc,YAAY,yDAAyDC,OAAO,iCACnHgW,6BAA8B/W,OAAOc,YAAY,yDAAyDC,OAAO,+BACjHiW,iCAAkChX,OAAOc,YAAY,yDAAyDC,OAAO,sCAO7HC,cAAe,WACX,IAAIP,EAAOC,KACPuW,EAAcxW,EAAKK,YAAY,gCAMnC,OAJAL,EAAKQ,QAAUgW,EAAY/T,SAE3BzC,EAAKc,IAAI,iBAAkBL,EAAEM,MAAMf,EAAKyW,eAAgBzW,IAEjDA,EAAKQ,SAMhBE,WAAY,WACR,IAAIV,EAAOC,KAEXD,EAAKoO,QAAQsI,YAAc1W,EAAK2W,yBAEhC3W,EAAK4W,MACD9C,YAAarT,EAAE,uDAAwDT,EAAKoO,QAAQsI,aACpFG,MAAOpW,EAAE,6CAA8CT,EAAKoO,QAAQsI,aACpEzL,OAAQxK,EAAE,gDAAiDT,EAAKoO,QAAQsI,aACxEI,KAAMrW,EAAE,kDAAmDT,EAAKoO,QAAQsI,cAG5E1W,EAAKqP,iBAGToH,eAAgB,SAAUxV,EAAOlB,GAC7B,IACIgX,EAAahX,EAAOmB,KAExB,GAAIT,EAAEuW,cAHK/W,KAGcgX,cAAgBF,EAAWhB,UAAW,CAC3D,IACImB,EALGjX,KAISI,YAAY,kCACJoC,QAASuT,YAAae,EAAWf,cALlD/V,KAMFgX,eACLxW,EAAE,6CAPKR,KAO8CO,SAASyQ,KAAKiG,KAI3EP,uBAAwB,WACpB,IACI3F,EADO/Q,KACKI,YAAY,8BAI5B,OALWJ,KAGNkW,UAAUgB,YAAcnG,EAAKvO,SAHvBxC,KAKCkW,UAAUgB,aAG1BC,YAAa,SAAUnW,EAAOlB,GAC1B,IACI6F,EADO3F,KACSI,YAAY,gCADrBJ,KAENgX,YAAclX,EAAOmB,KAE1B,IAAIV,EAAUoF,EAASnD,OAAOhC,EAAEd,OAAOI,EAAOmB,MAAMmW,cAAe9X,OAAOsI,YAAYkM,UAEtFtT,EAAE,6CANSR,KAM0CO,SAASyQ,KAAKzQ,GANxDP,KAONqX,aAGTC,eAAgB,WACZ,IAAIvX,EAAOC,KACXD,EAAK4W,KAAK9C,YAAY0D,IAAIxX,EAAKiX,YAAY7D,SAASU,aACjD9T,EAAKiX,YAAY5D,SAAShB,SACzBrS,EAAK4W,KAAKC,MAAM9I,KAAK,MAAO/N,EAAKiX,YAAY5D,SAAShB,UAI9DhD,cAAe,WACX,IAAIrP,EAAOC,KACXD,EAAK4W,KAAK3L,OAAO3G,GAAG,QAAS7D,EAAEM,MAAMf,EAAKyX,gBAAiBzX,IAC3DA,EAAK4W,KAAKE,KAAKxS,GAAG,QAAS7D,EAAEM,MAAMf,EAAK0X,cAAe1X,IACvDA,EAAKc,IAAI,cAAeL,EAAEM,MAAMf,EAAKoX,YAAapX,KAGtD2X,aAAc,SAAU1W,EAAO+E,GAE3B,GAA+C,IAA5CvF,EAAEQ,EAAM0M,eAAehF,KAAK,KAAKC,OAEhC,OADWnI,EAAEuF,EAAG+O,MAAMzR,KAAK,SAEvB,IAAK,OAJFrD,KAKM2X,gBACL,MACJ,IAAK,SAPF3X,KAQM4X,eACL,MACJ,IAAK,WAVF5X,KAWM6X,mBAMrBA,eAAgB,WACD7X,KACNH,YAAY+V,sBADN5V,KACiCgX,YAAY7D,SAAStB,WAAWtF,KADjEvM,KAC4EgX,YAAY7D,SAAS5L,OAGhHoQ,cAAe,WACX,IAAI5X,EAAOC,KAEXD,EAAKmW,UAAUgB,YAAYY,QACvB3N,WAAW,EACXC,WAAW,EACX8H,OAAQ,OACR1G,MAAO,QACPuM,OAAO,EACPnO,MAAOtK,OAAOsE,aAAaC,YAAY,qCACvCmU,UAAU,EACV/N,MAAO,WACHlK,EAAKyX,qBAIbzX,EAAKuX,iBACLvX,EAAK4W,KAAK9C,YAAYoE,SAG1BL,aAAc,WACV,IAAI7X,EAAOC,KACXQ,EAAEwO,KAAK1P,OAAO4Y,oBAAoB5Y,OAAOsE,aAAaC,YAAY,uCAAwC,GAAI,SAASqL,KAAK,WACxH,IAAIpP,GACAS,SACIgM,KAAMxM,EAAKiX,YAAY7D,SAAS5G,MAEpC4L,qBAAsBpY,EAAKiX,YAAY7D,SAAStB,WAAWtF,OAG/D/L,EAAEwO,KAAKjP,EAAKF,YAAY6U,WAAW5U,IAASoU,OAAO,SAAUV,GACjC,MAApBA,EAAS3F,QAAsC,MAApB2F,EAAS3F,aAAsCzM,IAApBoS,EAAS3F,QAC/D9N,EAAKwD,IAAI,UACL9B,KAAM,aACNR,MACIsL,KAAMzM,EAAOS,QAAQgM,aAQ7CkL,cAAe,WACX,IAAI1X,EAAOC,KACX,GAAID,EAAKqY,+BAA+BrY,EAAK4W,KAAK9C,aAAc,CAC5D9T,EAAKiX,YAAY7D,SAASU,YAAc9T,EAAK4W,KAAK9C,YAAY0D,MAE9D,IAAIzX,GACAS,SACIgM,KAAQxM,EAAKiX,YAAY7D,SAAS5G,KAClCsH,YAAe9T,EAAKiX,YAAY7D,SAASU,YACzChC,WAAc9R,EAAKiX,YAAY7D,SAAStB,WACxCtK,KAAQxH,EAAKiX,YAAY7D,SAAS5L,KAClCsI,KAAQ9P,EAAKiX,YAAY7D,SAAStD,KAClC+B,KAAQtS,OAAOsI,YAAYkM,OAC3BrE,aAAgB1P,EAAKiX,YAAYrH,YAIzCnP,EAAEwO,KAAKjP,EAAKF,YAAYwY,kBAAkBvY,IAASoU,OAAO,SAAUV,GACxC,MAApBA,EAAS3F,QAAsC,MAApB2F,EAAS3F,aAAsCzM,IAApBoS,EAAS3F,QAC/DrN,EAAE,iDAAkDT,EAAKQ,SAASkL,KAAK3L,EAAOS,QAAQsT,aAEtF9T,EAAKyX,kBACLzX,EAAKiW,SAASsC,kBACXC,OAAOjZ,OAAOsE,aAAaC,YAAY,2CAA4C,KAEtF9D,EAAKwD,IAAI,UACL9B,KAAM,aACNR,MACI4S,YAAa/T,EAAOS,QAAQsT,YAC5BtH,KAAMzM,EAAOS,QAAQgM,UAI7BxM,EAAKyX,kBACLzX,EAAKiW,SAASwC,iBACXD,OAAOjZ,OAAOsE,aAAaC,YAAY,oCAAqC,UAM/FuU,+BAAgC,SAASK,GACrC,IAAIC,GAAS,EACTC,EAAuBF,EAC3B,GAAyC,KAAtCE,EAAqBpB,MAAMqB,OAAc,CACxC,IAAIC,EAAwBvZ,OAAOsE,aAAaC,YAAY,qDAC5D8U,EAAqB9C,SAASiD,OAAOpQ,KAAK,QAAQsI,KAAK6H,QAGvDF,EAAqB9C,SAASiD,OAAOpQ,KAAK,QAAQlH,QAClDkX,GAAS,EAEb,OAAOA,GAGXlB,gBAAiB,WACFxX,KACN2W,KAAK9C,YAAYgC,SAASiD,OAAOpQ,KAAK,QAAQlH,QADxCxB,KAENkW,UAAUgB,YAAYY,OAAO,WAFvB9X,KAGNkW,UAAUgB,YAAY6B,UAG/B1B,UAAW,WAGP7W,EAAE,0CAFSR,KAEuCO,SAASiF,MACvD6C,OAAQ7H,EAAEM,MAHHd,KAGc0X,aAHd1X,QAIR6C,YAAY,sBAGnBxB,MAAO,WACQrB,KAENmO,WAFMnO,KAGN2W,QAHM3W,KAINgX,eAJMhX,KAKN+V,YAAc,KAI3BzW,OAAO8F,SAASC,SAAS,kDAAmD,mBAAoB,cAAe,WAAY/F,OAAOC,WAAWC,QAAQ8F,QAAQ0T,eC1P7J1Z,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,qDAKpCC,KAAM,SAAUC,EAAkBC,EAAaC,GAChCE,KAGNC,OAAOL,EAAkBC,EAAaC,IAE3CA,EAASA,OACFmZ,YAAa,EANTjZ,KASNE,eACDgZ,uBAAwB5Z,OAAOc,YAAY,yDAAyDC,OAAO,4BAQnH8Y,cAAe,WACX,OAAO7Z,OAAOC,WAAWC,QAAQC,OAAO2Z,+CAM5C9Y,cAAe,WACX,IAEIqF,EAFO3F,KAESI,YAAY,wBAGhC,OALWJ,KAGNO,QAAUoF,EAASnD,WAHbxC,KAKCO,WAIpBjB,OAAO8F,SAASC,SAAS,kDAAmD,mBAAoB,cAAe/F,OAAOC,WAAWC,QAAQ8F,QAAQqH,KAAK0M,UAAU","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.params.plan.idActivitySelected = undefined;\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      if(typeof event.type !== \"undefined\"){\r\n         self.params.showContextByMenuDashboard = event.type;\r\n      }\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu &&\r\n            (!self.params.isAdhocProcess ||\r\n            (self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\"))),\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n\r\n         var showContextByMenuDashboard = $item.data(\"context\");\r\n\r\n         if (showContextByMenuDashboard) {\r\n            var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\r\n            var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\r\n            var nameItemNavigator = \"\";\r\n            var newLevelNavigator = currentLevelNavigator;\r\n\r\n            if(showContextByMenuDashboard == \"PLANACTIVITIES\"){\r\n               newLevelNavigator = currentLevelNavigator + 1;\r\n               nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\r\n            }\r\n\r\n            self.params.refreshLastItemBreadcrumb = false;\r\n            self.pub(\"notify\", {\r\n               type: showContextByMenuDashboard.toUpperCase(),\r\n               args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\r\n                  histName: nameItemNavigator,\r\n                  level: newLevelNavigator })\r\n            });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='COMMENTS']\", content);\r\n       var $files = $(\"[data-context='FILES']\", content);\r\n       var $timeline = $(\"[data-context='TIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\r\n\r\n       // Bind for click event on refresh botton\r\n       $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\r\n           var options = {\r\n               action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n               idCase: self.params.idCase,\r\n               idTask: self.params.idTask,\r\n               idWorkflow: self.params.idWorkflow,\r\n               idWorkItem: self.params.idWorkitem,\r\n               referrer: self.params.referrer || \"inboxGrid\"\r\n           };\r\n           self.publish(\"executeAction\", options);\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n      $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Files Controller\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.files\", {}, {\r\n    /**\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.plugins = {};\r\n        self.prefixBase64 = \"data:image/png;base64,\";\r\n        self.usersData = {};\r\n        self.currentFilesList = [];\r\n        self.fileDateInterval;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-files\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-wrapper\"),\r\n            \"project-files-uploaditem\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-uploaditem\"),\r\n            \"project-files-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeFiles = self.getTemplate(\"project-files\");\r\n        self.content = templateHomeFiles.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * Post render and links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        $.when(self.renderFilesList()).done(function () {\r\n            self.plugins[\"uploadFiles\"] = self.initializeUploadFiles();\r\n            self.eventsHandler();\r\n            self.restrictedEventsHandler();\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   Render Files List\r\n    */\r\n    renderFilesList: function () {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var filesLength = self.currentFilesList.length;\r\n        var params = {\r\n            globalParent: encodeURIComponent(self.radNumber),\r\n            dateTime: (!filesLength) ? self.getDateServer() : self.currentFilesList[filesLength - 1].date,\r\n            count: 12\r\n        };\r\n        if(self.params.flowContext ===\"FLOW-DECONTEXTUALIZED-PLANS\"){\r\n            params.globalParent = self.params.plan.id;\r\n        }\r\n        $.when(self.dataService.getFilesListByRadNumber(params)).done(function (files) {\r\n            self.currentFilesList = self.currentFilesList.concat(files);\r\n\r\n            self.renderFiles(files);\r\n\r\n            defer.resolve();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n    * Render Files\r\n    */\r\n    renderFiles: function(files) {\r\n        \r\n        var self = this;\r\n\r\n        var $content = self.getContent();\r\n        var $showMoreWrapper = $(\"#project-files-showmore\", $content);\r\n        self.displayFileList(files, \"append\");\r\n        self.updateRelativeTime();\r\n\r\n        if (files.length) {\r\n            self.setAdditionalData(files);\r\n        }\r\n\r\n        if (self.currentFilesList.length >= 12) {\r\n            $showMoreWrapper.show();\r\n\r\n            if (files.length < 12) {\r\n                $(\"button\", $showMoreWrapper).remove();\r\n                $(\"#project-files-nomore\", $showMoreWrapper).show();\r\n            }\r\n        }\r\n\r\n        self.notifyFilesNumber(false);\r\n    },\r\n\r\n    /**\r\n    * Render no files\r\n    */\r\n    renderNoFiles: function(){\r\n        \r\n        var self = this;\r\n        var noFilesTmpl = self.workportalFacade.getTemplate(\"info-message\");\r\n        var message = self.resources.getResource(\"workportal-project-files-noavailable\");\r\n\r\n       /* self.disableSideBar();*/\r\n\r\n        var $noFiles = $.tmpl(noFilesTmpl, {\r\n            message: message\r\n        });\r\n\r\n        self.content.html($noFiles);\r\n    },\r\n\r\n    /**\r\n    * Initialize upload files\r\n    */\r\n    initializeUploadFiles: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        return $(\"#project-files-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: $.proxy(self.onSuccessFile, self),\r\n            upload: $.proxy(self.addFileData, self),\r\n            retry: $.proxy(self.onSaveFileData, self),\r\n            enabled: true,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    /**\r\n    * Set Additional Data For Files\r\n    */\r\n    setAdditionalData: function (files) {\r\n\r\n        var self = this;\r\n        var thumbnails = [], users = [], guidsUsers = [];\r\n\r\n        for (var i = 0, length = files.length - 1; i <= length; i++) {\r\n            users.push(files[i].user);\r\n            guidsUsers.push(files[i].user);\r\n            thumbnails.push(files[i].attachment.guid);\r\n        }\r\n\r\n        self.setUserData(guidsUsers.join());\r\n        self.setThumbnails(thumbnails.join());\r\n    },\r\n\r\n    /**\r\n    * Set User Data\r\n    */\r\n    setUserData: function (users) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            usersGuids: users,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        $.when(self.dataService.getUsersData(params)).done(function (users) {\r\n            for (var i = 0, length = users.length - 1; i <= length; i++) {\r\n                if(users[i].picture){\r\n                    users[i].picture = self.prefixBase64 + users[i].picture;\r\n                }\r\n                self.usersData[\"id\" + users[i].id] = users[i];\r\n                $(\"#project-files-list .ui-bizagi-wp-project-files-user[data-userId=\" + users[i].id + \"]\", $content).text(users[i].name);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Get file list \r\n    */\r\n    getFileInfoByGuid: function (guid) {\r\n        var self = this;\r\n        var file;\r\n        for (var i = 0, length = self.currentFilesList.length; i < length; i++) {\r\n\r\n            if (guid === self.currentFilesList[i].guid) {\r\n                file = self.currentFilesList[i];\r\n                i = length;\r\n            }\r\n        }\r\n        return file;\r\n    },\r\n\r\n    /**\r\n    * Set Thumbnails\r\n    */\r\n    setThumbnails: function (thumbnails) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            guids: thumbnails,\r\n            width: 480,\r\n            height: 150\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var thumbnail, $wrapper, $img;\r\n\r\n            $.each(files, function (guid, src) {\r\n                guid = guid.toLowerCase();\r\n                thumbnail = self.prefixBase64 + src;\r\n                $wrapper = $(\"#project-files-list .ui-bizagi-wp-project-files-wrapitem[data-attchGuid=\" + guid + \"]\", $content);\r\n                $img = $(\".ui-bizagi-wp-project-files-thumbnail\", $wrapper);\r\n\r\n                $img.prop(\"src\", thumbnail);\r\n                $(\".ui-bizagi-wp-project-files-icon\", $wrapper).remove();\r\n                $img.css(\"display\", \"block\");\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Set Preview\r\n    */\r\n    setFilePreview: function ($target, guidAttch, guidFile) {\r\n\r\n        var self = this;\r\n        var img = \"\";\r\n        var params = {\r\n            guids: [guidAttch].join(),\r\n            width: 500,\r\n            height: 500\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var $userTag = $target.find(\".ui-bizagi-wp-project-files-user\");\r\n            var userId = $userTag.data(\"userid\");\r\n\r\n            $.each(files, function (guid, src) {\r\n                img = self.prefixBase64 + src;\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"FILEPREVIEW\",\r\n                args: {\r\n                    radNumber: encodeURIComponent(self.radNumber),\r\n                    fileData: self.getFileInfoByGuid(guidFile),\r\n                    userData: self.usersData[\"id\" + userId],\r\n                    isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n                    img: img\r\n                }\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"OPEN_RIGHT_SIDEBAR\"\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    *  On Success File\r\n    */\r\n    onSuccessFile: function (event) {\r\n\r\n        var self = this;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            self.onSaveFileData(event.files[0]);\r\n        } else {\r\n            self.plugins[\"uploadFiles\"].onErrorFile(event);\r\n        }\r\n    },\r\n\r\n    /**\r\n    * On Save File Data\r\n    */\r\n    onSaveFileData: function (file) {\r\n\r\n        var self = this;\r\n\r\n        $.when(self.saveFileData(file)).done(function () {\r\n            self.notifyFilesNumber();\r\n            self.plugins[\"uploadFiles\"].setStatus(\"SUCCESS\", file.uid);\r\n        }).fail(function () {\r\n            self.plugins[\"uploadFiles\"].setStatus(\"RETRY\", file.uid);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retry file\r\n     * @param $target\r\n     */\r\n    onRetryFile: function ($target) {\r\n        var self = this;\r\n        var $file = $target.closest(\"li\");\r\n        var guid = $file.data(\"guid\");\r\n\r\n        var file = $.grep(self.currentFilesList, function (i) {\r\n            return i.uid === guid;\r\n        });\r\n\r\n        self.onSaveFileData($file, file[0]);\r\n    },\r\n\r\n    /**\r\n     * Add Guid to Files Data\r\n     * @param event\r\n     */\r\n    addFileData: function (event) {\r\n        var self = this;\r\n\r\n        //add guid to send\r\n        event.data = {\r\n            guid: event.files[0].uid\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Save Files\r\n     * @param file\r\n     * @return {*}\r\n     */\r\n    saveFileData: function (file) {\r\n\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n\r\n        var guid = Math.guid();\r\n        var globalParent = self.radNumber ? self.radNumber.toString() : \"\";\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            globalParent = self.params.plan.id;\r\n        }\r\n\r\n        var params = {\r\n            \"content\": {\r\n                \"guid\": guid,\r\n                \"description\": \"\",\r\n                \"name\": file.name,\r\n                \"attachment\": {\r\n                    \"guid\": file.uid,\r\n                    \"name\": file.name\r\n                },\r\n                \"date\": self.getDateServer(),\r\n                \"user\": bizagi.currentUser.idUser,\r\n                \"globalParent\": globalParent\r\n            },\r\n            \"attachmentsToCreate\": [\r\n                file.uid\r\n            ]\r\n        };\r\n\r\n        self.currentFilesList.unshift(file);\r\n\r\n        $.when(self.dataService.createProjectFile(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                //extend file data\r\n                $.extend(file, {\r\n                    user: bizagi.currentUser.idUser,\r\n                    userName: bizagi.currentUser.userName,\r\n                    date: new Date().getTime(),\r\n                    attachment: params.content.attachment,\r\n                    guid: params.content.guid,\r\n                    description: params.content.description\r\n                });\r\n\r\n                self.usersData[\"id\" + bizagi.currentUser.idUser] = {\r\n                    picture: bizagi.currentUser.photo,\r\n                    name: bizagi.currentUser.userName,\r\n                    id: bizagi.currentUser.idUser\r\n                };\r\n\r\n                self.displayFileList(file, \"prepend\");\r\n\r\n                self.updateRelativeTime();\r\n                self.setThumbnails(file.uid);\r\n\r\n                defer.resolve();\r\n            } else {\r\n\r\n                defer.reject();\r\n            }\r\n        });\r\n\r\n        return defer;\r\n    },\r\n\r\n    /**\r\n     * Display File List\r\n     * @param files\r\n     * @param action\r\n     */\r\n    displayFileList: function (files, action) {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-files-list\");\r\n        var files = files || self.currentFilesList;\r\n        var content = self.getContent();\r\n        var $filesList = tmpl.render({\r\n            files: files\r\n        });\r\n\r\n        $(\"#project-files-list\", content)[action]($filesList);\r\n        $.equalizeHeights(\".bz-card\");\r\n    },\r\n\r\n    /**\r\n     * Delete file\r\n     * @param event\r\n     * @param params\r\n     */\r\n    deleteFile: function(event, params){\r\n        var self = this;\r\n\r\n        var content = self.getContent();\r\n        $(\"div[data-fileguid='\" + params.args.guid + \"']\", content).remove();\r\n\r\n        self.currentFilesList = self.currentFilesList.filter(function( file ) {\r\n            return file.guid !== params.args.guid;\r\n        });\r\n\r\n        self.notifyFilesNumber(true);\r\n    },\r\n\r\n    /**\r\n     * Update File Data\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateFileData: function (event, params) {\r\n\r\n        var self = this;\r\n        var file = self.getFileInfoByGuid(params.args.guid);\r\n\r\n        file.description = params.args.description;\r\n    },\r\n\r\n    /**\r\n    * Update relative time\r\n    */\r\n    updateRelativeTime: function () {\r\n\r\n        var self = this;\r\n\r\n        if (self.fileDateInterval) clearInterval(self.fileDateInterval);\r\n\r\n        self.fileDateInterval = setInterval($.proxy(self.changeRelativeTime, self), \"7000\");\r\n    },\r\n\r\n    /**\r\n    * Change Relative Time\r\n    */\r\n    changeRelativeTime: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        $(\"#project-files-list .ui-bizagi-wp-project-files-date\", $content).each(function (i, item) {\r\n            var dateTime = $(item).data(\"date\");\r\n            var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(dateTime), null, false);\r\n\r\n            $(item).text(relativeTime);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Filter files by some criteria\r\n     * @param event\r\n     */\r\n    onSelectFiles: function (event) {\r\n\r\n        var self = this,\r\n            bannedFiles = [],\r\n            files = event.files;\r\n\r\n        for (var i = files.length - 1; i >= 0; i--) {\r\n\r\n            if (!self.isValidFile(files[i]).valid) {\r\n                var bannedFile = files.splice(i, i + 1);\r\n                bannedFiles.unshift(bannedFile[0]);\r\n            }\r\n        }\r\n\r\n        if (bannedFiles.length > 0) {\r\n            self.showFilesError(bannedFiles);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Reset widget\r\n     */\r\n    resetWidget: function () {\r\n\r\n        var self = this;\r\n        if(self.plugins[\"uploadFiles\"]){\r\n            self.plugins[\"uploadFiles\"].close();\r\n        }\r\n        self.currentFilesList = [];\r\n        clearInterval(self.fileDateInterval);\r\n    },\r\n\r\n    /**\r\n    * Switch Events\r\n    */\r\n    switchFilesEvents: function (event) {\r\n\r\n        event.stopPropagation();\r\n\r\n        var self = this;\r\n        \r\n        var $target = $(event.target),\r\n            $item = $target.closest(\".ui-bizagi-wp-project-files-wrapitem\");\r\n\r\n        if($item.length) {\r\n            \r\n            var guidAttch = $item.data(\"attchguid\"),\r\n                guidFile = $item.data(\"fileguid\");\r\n\r\n            if ($target.hasClass(\"ui-bizagi-wp-project-files-file\")) {\r\n                var fileName = $target.text();\r\n\r\n                self.dataService.getDownloadAttachment(guidAttch, fileName);\r\n            } else{\r\n                self.setFilePreview($item, guidAttch, guidFile);\r\n            }\r\n        \r\n        } else if ($target.parent().prop(\"id\") === \"project-files-showmore\") {\r\n            self.renderFilesList();\r\n        } else if ($target.prop(\"id\") !== \"project-files-upload\") {\r\n            self.notifyFilesNumber(true)\r\n        }\r\n         \r\n    },\r\n\r\n    /**\r\n     * Show number files to right sidebar\r\n     * @param mandatory\r\n     */\r\n    notifyFilesNumber: function(mandatory){\r\n        var self = this;\r\n\r\n        self.pub(\"notify\", {\r\n            type: \"SETFILESNUMBER\",\r\n            args: {\r\n                filesNumber: self.currentFilesList.length,\r\n                mandatory: mandatory\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Restricted Event Handler\r\n     */\r\n    restrictedEventsHandler: function(){\r\n        var self = this;\r\n        self.content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    *  Events Handler\r\n    */\r\n    eventsHandler: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        self.sub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.sub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.sub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        $content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    * Clean\r\n    */\r\n    clean: function(){\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        self.unsub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.unsub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.unsub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i])\r\n                self.plugins[i].destroy();\r\n        }\r\n\r\n        clearInterval(self.fileDateInterval);\r\n        self._super();\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.files\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.files], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.filesPreview\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n        var self = this;\r\n\r\n        //Regional\r\n        self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n        self.dialogBox = {};\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.notifier = notifier;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-wrapper\"),\r\n            \"project-filespreview-preview\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-preview\"),\r\n            \"project-filespreview-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-popup\"),\r\n            \"project-filespreview-thenumber\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-thenumber\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\r\n\r\n        self.content = generalTmpl.render();\r\n\r\n        self.sub(\"SETFILESNUMBER\", $.proxy(self.setFilesNumber, self));\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        self.plugins.fileEdition = self.initPluginPopupEdition();\r\n\r\n        self.form = {\r\n            description: $(\"#ui-bizagi-wp-project-filespreview-popup-description\", self.plugins.fileEdition),\r\n            image: $(\".ui-bizagi-wp-project-popupform-user-image\", self.plugins.fileEdition),\r\n            cancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.fileEdition),\r\n            edit: $(\"#ui-bizagi-wp-project-popupform-action-editfile\", self.plugins.fileEdition)\r\n        };\r\n\r\n        self.eventsHandler();\r\n    },\r\n\r\n    setFilesNumber: function (event, params) {\r\n        var self = this;\r\n        var parameters = params.args;\r\n\r\n        if ($.isEmptyObject(self.currentFile) || parameters.mandatory) {\r\n            var tmpl = self.getTemplate(\"project-filespreview-thenumber\");\r\n            var $filesNumber = tmpl.render({ filesNumber: parameters.filesNumber });\r\n            self.currentFile = {};\r\n            $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html($filesNumber);\r\n        }\r\n    },\r\n\r\n    initPluginPopupEdition: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-filespreview-popup\");\r\n\r\n        self.dialogBox.formContent = tmpl.render();\r\n\r\n        return self.dialogBox.formContent;\r\n    },\r\n\r\n    showPreview: function (event, params) {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-filespreview-preview\");\r\n        self.currentFile = params.args;\r\n\r\n        var content = template.render($.extend(params.args,{idCurrentUser: bizagi.currentUser.idUser}));\r\n\r\n        $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html(content);\r\n        self.applyMenu();\r\n    },\r\n\r\n    setEditionData: function () {\r\n        var self = this;\r\n        self.form.description.val(self.currentFile.fileData.description);\r\n        if(self.currentFile.userData.picture){\r\n            self.form.image.prop(\"src\", self.currentFile.userData.picture);\r\n        }\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        self.form.cancel.on(\"click\", $.proxy(self.onResetFileForm, self));\r\n        self.form.edit.on(\"click\", $.proxy(self.onSaveEdition, self));\r\n        self.sub(\"FILEPREVIEW\", $.proxy(self.showPreview, self));\r\n    },\r\n\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onDeleteFile();\r\n                    break;\r\n                case \"download\":\r\n                    self.onDownloadFile();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadFile: function () {\r\n        var self = this;\r\n        self.dataService.getDownloadAttachment(self.currentFile.fileData.attachment.guid, self.currentFile.fileData.name);\r\n    },\r\n\r\n    onOpenEdition: function () {\r\n        var self = this;\r\n\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-files-editfile\"),\r\n            maximize: true,\r\n            close: function () {\r\n                self.onResetFileForm();\r\n            }\r\n        });\r\n\r\n        self.setEditionData();\r\n        self.form.description.focus();\r\n    },\r\n\r\n    onDeleteFile: function(){\r\n        var self = this;\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-file-querydelete\"), \"\", \"info\")).done(function () {\r\n            var params = {\r\n                content: {\r\n                    guid: self.currentFile.fileData.guid\r\n                },\r\n                attachmentsToDelete: [self.currentFile.fileData.attachment.guid]\r\n            };\r\n\r\n            $.when(self.dataService.deleteFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"DELETEFILE\",\r\n                        args: {\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSaveEdition: function () {\r\n        var self = this;\r\n        if (self.validateAddFileDescriptionForm(self.form.description)) {\r\n            self.currentFile.fileData.description = self.form.description.val();\r\n\r\n            var params = {\r\n                \"content\": {\r\n                    \"guid\": self.currentFile.fileData.guid,\r\n                    \"description\": self.currentFile.fileData.description,\r\n                    \"attachment\": self.currentFile.fileData.attachment,\r\n                    \"name\": self.currentFile.fileData.name,\r\n                    \"date\": self.currentFile.fileData.date,\r\n                    \"user\": bizagi.currentUser.idUser,\r\n                    \"globalParent\": self.currentFile.radNumber\r\n                }\r\n            };\r\n\r\n            $.when(self.dataService.updateProjectFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    $(\"#ui-bizagi-wp-project-filespreview-description\", self.content).text(params.content.description);\r\n\r\n                    self.onResetFileForm();\r\n                    self.notifier.showSucessMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-project-files-editionsuccess\"), \"\"));\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: \"UPDATEFILE\",\r\n                        args: {\r\n                            description: params.content.description,\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                } else {\r\n                    self.onResetFileForm();\r\n                    self.notifier.showErrorMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-general-error-generic\"), \"\"));\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    validateAddFileDescriptionForm: function($description){\r\n        var result = false,\r\n            $textAreadescription = $description ;\r\n        if($textAreadescription.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $textAreadescription.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $textAreadescription.parent().next().find(\"span\").empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    onResetFileForm: function () {\r\n        var self = this;\r\n        self.form.description.parent().next().find(\"span\").empty();\r\n        self.dialogBox.formContent.dialog(\"destroy\");\r\n        self.dialogBox.formContent.detach();\r\n    },\r\n\r\n    applyMenu: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-project-filespreview-edit\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n\r\n        self.plugins = {};\r\n        self.form = {};\r\n        self.currentFile = {};\r\n        self.filesNumber = 0;\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.filesPreview\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.filesPreview]);","/*\r\n *   Name: Bizagi Workportal project File Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.file.sidebar\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n        params.supportNav = false;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-file-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.file.sidebar\").concat(\"#project-file-sidebar\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR;\r\n    },\r\n\r\n    /*\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n\r\n        var template = self.getTemplate(\"project-file-sidebar\");\r\n        self.content = template.render({});\r\n\r\n        return self.content;\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.file.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.file.sidebar], true);"]}