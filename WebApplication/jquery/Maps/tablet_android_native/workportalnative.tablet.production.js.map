{"version":3,"sources":["jquery/common/bizagi/js/services/bizagi.template.services.service.kendo.js","jquery/workportalflat/common/bizagi.workportal.loader.override.js","jquery/workportalflat/common/bizagi.workportal.util.js","jquery/workportalflat/common/tablet/js/bizagi.workportal.util.tablet.js","jquery/workportalflat/common/bizagi.workportal.webpart.controllers.controller.js","jquery/workportalflat/common/services/bizagi.workportal.services.context.js","jquery/workportalflat/common/services/bizagi.workportal.services.endPoints.js","jquery/workportalflat/common/services/bizagi.workportal.services.service.js","jquery/workportalflat/common/services/bizagi.workportal.services.routing.js","jquery/workportalflat/common/bizagi.workportal.device.factory.js","jquery/workportalflat/common/bizagi.workportal.webparts.facade.js","jquery/workportalflat/common/tablet/js/bizagi.workportal.webparts.tablet.facade.js","jquery/workportalflat/common/tablet/js/bizagi.workportal.webparts.tablet.facade.native.js","jquery/workportalflat/common/webpart/bizagi.workportal.webpart.helper.js","jquery/workportalflat/common/webpart/bizagi.workportal.webparts.webpart.js","jquery/workportalflat/common/webpart/bizagi.workportal.render.webparts.webpart.js","jquery/workportalflat/common/webpart/bizagi.framework.homeportal.js","jquery/workportalflat/common/tablet/js/bizagi.framework.tablet.homeportal.js","jquery/workportalflat/common/tablet/js/bizagi.framework.tablet.homeportal.native.js","jquery/reporting/bizagi.reporting.definition.js","jquery/workportalflat/common/webpart/commands/bizagi.workportal.command.search.js","jquery/workportalflat/common/webpart/componentservices/actionsEvents/bizagi.component.actionsEvents.js","jquery/workportalflat/common/webpart/componentservices/actionsEvents/bizagi.component.actionsEvents.native.js","jquery/workportalflat/common/webpart/componentservices/users/bizagi.component.caseUsers.js","jquery/rendering/js/services/bizagi.render.services.endPoints.js","jquery/rendering/js/services/bizagi.render.services.context.js","jquery/rendering/js/services/bizagi.render.services.service.js","jquery/offline/js/services/bizagi.render.services.service.offline.js","jquery/rendering/js/services/bizagi.render.services.multiactionservice.js","jquery/rendering/js/services/bizagi.render.services.metadataMultiactionservice.js","jquery/offline/js/services/database/bizagi.clientdb.js","jquery/offline/js/services/database/bizagi.clientdb.cases.js","jquery/offline/js/services/database/bizagi.clientdb.forms.js","jquery/offline/js/services/database/bizagi.clientdb.pullWorker.js","jquery/offline/js/services/database/bizagi.clientdb.fetchWorker.js","jquery/offline.old/js/services/database/bizagi.clientdb.js","jquery/offline.old/js/services/database/bizagi.clientdb.cases.js","jquery/offline.old/js/services/database/bizagi.clientdb.forms.js","jquery/offline.old/js/services/database/bizagi.clientdb.pullWorker.js","jquery/offline.old/js/services/database/bizagi.clientdb.fetchWorker.js","jquery/offline/js/services/bizagi.workportal.services.service.offline.js","jquery/offline.old/js/services/bizagi.workportal.services.service.offline.js","jquery/offline/js/services/bizagi.workportal.services.routing.offline.js"],"names":["$","Class","extend","customTemplateFile","bizagi","loader","getResource","detectDevice","cachedFiles","cachedTemplates","customTemplates","init","localization","this","cssRegex","loadingFileDeferred","loadCustomTemplates","self","defer","Deferred","when","getTemplateFile","done","response","temp","html","responseParts","each","i","responsePart","attr","resolve","promise","getTemplate","template","id","isCustomTemplate","replace","enableCustomizations","hash","getHash","environment","internalGetTemplate","pipe","resolvedTemplate","getTemplateForRelease","getTemplateWidget","then","getTemplateWebpart","url","containsHash","getUrlWithoutHashes","processAndReturnTemplate","loadTemplateFileForRelease","ajax","dataType","ready","index","valueTemplate","translatedTemplate","reject","JSON","parse","hasOwnProperty","translate","cachedTemplate","getTemplatePart","templateUrl","loadingTemplatePartExecution","loadingTemplatePart","BIZAGI_ENVIRONMENT","length","console","warn","matches","match","cssFile","loadFile","src","type","outerHTML","indexOf","substring","override","enableMSF","jQuery","fn","fastEmpty","kendoTmplEmpty","fasttmpl","tmpl","data","kendoTmpl","cacheTemplate","cacheKendoTemplate","children","remove","element","hasClass","loadingMessage","kendo","useWithBlock","tempTmpl","trim","kendoTmpls","templates","services","service","loadedWebparts","loaderOverride","steal","window","registerMobileWebpart","webpartName","webparts","map","name","class","devices","location","js","css","initialized","initializing","loadingDeferred","bind","Object","keys","key","origRequest","request","options","success","error","arguments","device","prefix","useAbsolutePath","basePath","getLocationPrefix","build","resources","completed","loaded","loading","executing","text","stringify","util","context","smartphone","tablet","mobility","startLoading","start","stopLoading","stop","resourceKey","fallback","initWebpartOld","initWebpart","webpart","callback","log","isDate","value","state","slash","split","Date","getYear","e","setContext","params","reset","getTimeAgo","commentTime","timeago","getGroupedData","date","groupedData","actualDate","actualYear","getFullYear","actualMonth","getMonth","actualDay","getDate","tmpDate","tmpMonth","tmpYear","tmpDay","dateFormatter","formatDate","status","getTaskStatus","solutionDate","formatDataType","replaceLineBreak","formatBoolean","formatMonetaryCell","formatDecimalCell","formatDateTime","toString","newDate","getHours","toLowerCase","getMinutes","formatMoney","BIZAGI_DEFAULT_CURRENCY_INFO","formatDecimal","format","formatCurrency","syntaxHighlight","json","cls","test","b64EncodeUnicode","string","btoa","encodeURIComponent","p1","String","fromCharCode","queryString","startkendo","kendoMobileApplication","mobile","Application","transition","skin","initial","ui","progress","started","bizagiNavigate","t","navigate","workportalFacade","dataService","container","document","componentContainers","workportal","controllers","instances","controller","getWorkportal","publish","eventName","triggerHandler","subscribe","subscribeEvent","subscribeOneTime","one","unsubscribe","unbind","render","showMessageBox","renderContent","postRender","getContent","content","defaultValue","endPoints","getEndPoints","proxyPrefix","isEmpty","getUrl","setProxyPrefix","user-handler","process-handler","query-handler","case-handler","query-form","query-form-edit","query-form-delete","query-form-delete-cube","favorites-handler","file-handler","login-handler","login-handlerv10","logoff-handler","logoff-handlerv1","authorization-handler-getMenuAuthorization","authorization-handler-isCaseCreationAuthorized","case-handler-getCaseSummary","case-handler-releaseActivity","case-handler-getCasesList","case-handler-getActivityList","offline-getProcessTree","offline-tasks","offline-getForms","offline-sendForm","case-handler-getCaseTasks","case-handler-getCaseEvents","case-handler-getCaseSubprocesses","case-handler-getTaskAssignees","case-handler-getCaseAssignees","case-handler-getWorkItems","case-handler-getAsynchExecutionState","case-handler-addNewCase","case-handler-startProcess","handler-execute-action-start","case-handler-supportedLogTypes","case-handler-getActivityLog","case-handler-getActivityDetailLog","case-handler-getEntityLog","case-handler-getEntityDetailLog","case-handler-getUserLog","case-handler-getUserDetailLog","case-handler-getAdminLog","case-handler-getCaseFormsRenderVersion","case-handler-validateHasStartForm","favorites-handler-saveFavorite","favorites-handler-deleteFavorite","process-getIcon","collections-getIcon","bamAnalytics-handler-getAnalisysQueries","bamAnalytics-handler-updateQuery","inbox-handler-getInboxSummary","MessageHandler-NewComment","MessageHandler-GetComments","MessageHandler-SetCategoryToComment","MessageHandler-RemoveComment","MessageHandler-ReplyComment","MessageHandler-RemoveReply","MessageHandler-GetCategoryColors","MessageHandler-RenameCategoryColor","MessageHandler-CountNewComments","process-handler-getAllProcesses","process-handler-getFavourites","process-handler-getFavouriteCases","process-handler-getCustomizedColumnsData","process-handler-getCategory","process-handler-getRecentProcesses","process-handler-getCustomizedColumnsDataInfo","process-handler-getOrganizations","process-handler-getMyStuff","process-handler-getIdCasesOfProcessEntities","templates-handler-getCollectionData","data-navigation-handler-collection","data-navigation-handler-entity","data-navigation-handler-entity-filters","action-handler-getProcessAddAction","my-search-getSearchLists","my-search-getFilters","my-search-getFiltersData","my-search-getData","templates-handler-getVirtualCollectionData","templates-handler-getMultipleActions","process-handler-getMapping","process-handler-getForm","process-handler-startform","process-handler-rule","process-action-execute","process-handler-getActivitiesData","process-handler-getPendingsData","entities-handler-getActions","entities-handler-getUsersAndEvents","entities-handler-getUsers","entities-handler-getEvents","entities-handler-getUsersImages","entities-handler-getShotCuts","query-handler-getqueries","query-handler-getQueryForm","user-handler-getCurrentUser","old-render","Reports","reports-handler-deleteQueries","folders-handler-getUserQueries","folders-associate-deleteSmartFolder","folders-handler","folders-associate","smartfolders-integration","AlarmAdmin","AnalyticsProcess","AnalyticsSensor","AnalyticsTask","AsynchronousWorkitemRetries","AuthenticationLogQuery","BAMProcess","BAMTask","BusinessPolicies","CaseAdmin","adminReassignCases","asyncECMUpload","CasesMonitor","Closed","CurrentUser","EncryptionAdmin","MobileUpdatesAdmin","EntityAdmin","LocationResources","NewCase","Pending","Profiles","Search","UserAdmin","UserDefaultAssignation","UserPendingRequests","ListPreferences","UserPreferencesUrl","GRDimensionAdmin","Licenses","AnalysisQueries","DocumentTemplates","ProcessAdmin","ResourceBAM","WorkPortalVersion","entities-administration","theme-handler-getLogoImagePath","logout","logoutDotNet","authenticationConfig","logout-oauth2","FederateLogoffUrl","oauth2AuthenticationConfig","massive-activity-assignments-getOrganizationInfo","massive-activity-assignments-getCasesByOrganization","massive-activity-assignments-reassignCases","massive-activity-assignments-searchUsers","async-ecm-upload-baseService","domains","getCurrentTheme","admin-getAuthenticationLog","admin-getAuthenticationDomains","admin-getAuthenticationEventsTypes","admin-getAuthenticationEventSubTypes","admin-EncryptString","admin-UserPendingRequests","admin-UserAuthenticationInfo","admin-updateUserAuthenticationInfo","admin-generateRandomPassword","admin-GenerateDataToSendByEmail","admin-sendEmail","admin-getApplicationList","admin-getApplicationProcesses","admin-getProcessVersion","admin-getProcessTasks","admin-getTaskAlarms","admin-getLapseMode","admin-getRecurrMode","admin-getScheduleType","admin-getBossList","admin-addAlarm","admin-editAlarm","admin-deleteAlarm","admin-alarmRecipients","admin-deleteAlarmRecipients","admin-recipientToAlarm","admin-enableAlarm","admin-getCategoriesList","admin-getCasesList","admin-abortItems","admin-reassignItems","admin-getDefaultAssignationUserToAllProcess","admin-getDefaultAssignationUserToProcess","admin-setDefaultAssignationUserToProcess","admin-getProfilesTypes","admin-searchProfiles","admin-getUsersByProfile","admin-removeUserFromProfile","admin-addUserToProfile","admin-async-activities-get-activities","admin-async-activities-get-retry-now","admin-async-activities-get-activities-by-task","admin-async-activities-enable-execution","admin-async-activities-enable-multiple","admin-async-activities-async-execution","admin-async-activities-async-execution-log","admin-Licenses","admin-GetDimensions","admin-EditDimension","admin-CreateAdministrableDimension","admin-DeleteDimension","admin-EntityPathChildNodesAction","admin-GetActiveWFClasses","admin-document-templates-storeDocumentTemplates","admin-document-templates-restoreDocumentTemplates","admin-document-templates-uploadDocumentTemplate","admin-processes-workflowClasses","admin-processes-tasksByWorkflow","admin-processes-modifyProcessDuration","admin-processes-modifyTaskDuration","admin-language-resource","admin-language-languages","bam-resourcemonitor-myteam","reports-analysisquery","reports-analysisquery-update","reports-analysisquery-delete","processviewer-processdefinition","processviewer-processgraphicinfo","mobile-getLastUpdate","discussion-case","discussion-case-v1","get-users","new-discussion","count-comments","comment-case","new-comment","new-comment-attach","get-list-files","get-list-files-v1","project-resource-action","thumbnail-file","get-attachment","get-mobile-attachment","project-files-upload","count-files","count-files-v1","remove-comment","time-schemas-effectiveduration","project-users-get","case-summary-task-options","project-plan-get","project-plan-activities","project-plan-workitems","project-plan-transitions-get","project-plan-activity-edit","project-plan-get-by-parent","project-plan-parent","project-plan-update","project-plan-execute","project-plan-close","project-plan-delete","project-plan-first-parent-plan","getFeatureObject","BA_CONTEXT_PARAMETER_PREFIX","ENTITIES_QUERY_PAGE_SIZE","normalizeUrl","RPproxyPrefix","sharepointProxyPrefix","serviceLocator","pageSize","deviceType","isSmartphoneDevice","deviceEnum","isTabletDevice","desktop","deviceCode","getDeviceCode","BIZAGI_INBOX_ROWS_PER_PAGE","isNumeric","endPoint","concat","getOverrides","overrides","valueUppercase","toUpperCase","parseBoolean","read","authenticatedUser","urlSend","userName","BIZAGI_USER","password","BIZAGI_PASSWORD","domain","BIZAGI_DOMAIN","logoutUser","logOffUser","getCurrentUser","getInboxSummary","getAllProcesses","undefined","taskState","onlyFavorites","myActivities","myPendings","smartfoldersParameters","isMobile","skipAggrupate","responseData","categories","allProcesses","allCases","path","category","isFavorite","guidFavorite","idworkflow","guidWFClass","count","workflows","push","workflow","Number","getFavourites","getMyStuff","icon","getFavouriteCases","page","getCasesList","numberOfFields","idWfClass","elementToHtml","overdue","today","tomorrow","upcoming","totalPages","lengthData","elements","counter","tmpElement","tmpdate","getCasesListBeta","getMobileCasesList","advanceSearch","statusFunction","defineActivityStateByTaskState","defineActivityStateByDate","taskstate","parseInt","tmpEndDate","getTime","endDate","idworkitem","idwfclass","validateFeatureSupport","radNumber","urlMobile","resp","row","rows","field","tempElement","el","j","headers","fieldName","displayName","serializeActivity","currentPage","activityDate","now","group","shortEndDate","isEvent","dataChangeset","getCurrentActivities","processActivitiesResponse","highlight","process_filter","processes","highlightedNumber","highlightsString","find","processname","active","expresion","RegExp","offset","getDiscussionCase","globalParent","contentType","editDiscussion","update","getUsersDiscussion","getEffectiveDuration","getUsersData","getSummaryCaseTaskOptions","idWorkitem","createNewDiscussion","create","createNewComment","updateProjectFile","createProjectFile","getFilesCount","getCommentCase","getCommentsByParent","getFilesList","deleteFile","destroy","getFilesThumbnail","getAttachment","guidAttachment","idAttachment","getMobileAttachment","getAllAdministrableEntities","action","kind","result","entities","item","getEntitiesList","getCasesByWorkflow","idWorkflow","param","k","v","keyvalue","radnumber","idcase","idCase","cases","newFieldsValue","fields","fieldsKey","fieldsValue","isRadNumber","Value","DisplayName","workitems","getOrganizationsList","getCustomizedColumnsData","orderFieldName","orderType","order","idTask","getCustomizedColumnsDataBeta","columnTitle","lstIdCases","noResults","message","getCategories","idCategory","idApp","groupByApp","getRecentProcesses","mobileDevice","getCaseSummary","eventAsTasks","onlyUserWorkItems","serviceType","getCaseAssignees","getCaseTasks","getCaseEvents","getCaseSubprocesses","getCaseFormsRenderVersion","getCaseFormsRenderVersionDataContent","getTaskAssignees","getWorkitems","fromTask","fromWorkItemId","getQueries","hashQueries","idElement","processQueries","query","queries","idParent","nodes","createNewCase","caseData","idOrganization","validateHasStartForm","processId","batchRequest","startProcess","idProcess","entityMapping","mapping","idParentCase","fail","parseJSON","responseText","isVersionSupported","oldParams","oldVersion","actionCreateCase","guidProcess","parentCaseId","getFirstParentPlan","searchCases","h_action","onlyUserCases","queryCases","filter","outputxpath","queryEntities","idEntity","getMenuAuthorization","isCaseCreationAuthorized","getAsynchExecutionState","idAsynchWorkitem","supportedLogTypes","getActivityLog","orden","sort","idActualPage","getActivityDetailLog","idWorkItemFrom","getEntityLog","getEntityDetailLog","userFullName","attribDisplayName","getUserLog","getUserDetailLog","idUser","entDisplayName","getAdminLog","addFavorite","idObject","favoriteType","delFavorite","summaryAssigness","def","baseAssignees","assignees","assigneesLength","assigneesFix","showAssignees","events","activities","assigneesEvents","assigneesActivities","assigneesEventsList","assigneesActivitiesList","Name","summarySubProcess","subprocess","len","n","summaryCaseEvents","summaryCaseDetails","getCaseSummaryDataContent","currentState","dataCurrentStateLength","showEvents","countEvents","showParentProcess","parentProcess","parentDisplayName","isClosedForAllUsers","isClosed","isOpen","countAssigness","showSubProcess","countSubProcesses","showForm","hasGlobalForm","allowsReassign","idWorkItem","currentStateTypes","m","assignToCurrentUser","showActivities","releaseActivity","summaryActivities","icoTaskState","process","createdBy","createdByName","createdByUserName","caseDescription","processPath","showWorkOnIt","getSmartFolders","idFolder","searchFolders","deleteSmartFolder","idSmartFolder","getFolders","folders","childs","getCasesByFolder","cache","makeFolder","folderName","idParentFolder","updateFolder","associateCaseToFolder","idCustomFolder","dissasociateCaseFromFolder","deleteFolder","getFile","uploadId","entityId","entityKey","pathToBase","getComments","encodeURI","idColorCategory","pag","pagSize","picture","comments","users","user","Id","Picture","makeNewComment","comment","makeNewReply","idComment","Replies","removeMobileComment","removeComment","removeReply","idReply","renameCommentCategory","colorName","setCommentCategory","getCommentsCategories","getNewComments","getAnalisysQueries","updateQueries","idQuery","queryName","queryDescription","deleteQueries","queryId","QueryId","getConfiguration","sessionStorage","removeItem","javaLogout","reload","logoutMobile","logoutData","sourceLogout","isCordovaSupported","redirectErrorPage","href","authenticationType","logOffURL","federationLogoutBindingProtocol","authenticationSubType","always","res","federateLogoffUrl","open","write","close","nativeAjax","getPathUrl","jsonResponse","samlUrlRedirect","decodeURI","iframe","createElement","getElementsByTagName","appendChild","on","isIE8","contentWindow","body","eval","logoutUrl","callbackUrl","homeUrl","loginPage","getOrganizationInfo","getCasesByOrganization","roles","skills","locations","reassignCases","searchUsers","fullName","getDomainList","getEcmAllScheduledJobs","retryECMPendingScheduledJob","getWorkPortalVersion","version","productBuild","getAuthenticationLogData","getAuthenticationLogResult","dtFrom","dtTo","eventSubType","eventType","encryptString","entry","userPendingRequests","userAuthenticationInfo","updateUserAuthenticationInfo","enable","expired","locked","generateRandomPassword","generateDataToSendByEmail","sendEmail","emailTo","subject","getApplicationCategoriesList","filterStartEvent","getAdminCasesList","getApplicationProcesses","getProcessVersion","getProcessTasks","getTaskAlarms","getLapseMode","getRecurrMode","getScheduleType","getBossList","addAlarm","editAlarm","deleteAlarm","getAlarmRecipients","addRecipientToAlarm","deleteRecipientsFromAlarm","enableAlarm","abortReassignItems","asyncActivitiesServices","getDefaultAssignationUserToAllProcess","serviceAction","getDefaultAssignationUserToProcess","idWFClass","setDefaultAssignationUserToProcess","getProcessIcon","getCollectionIcon","collectionId","getProfilesTypes","searchProfiles","getUsersByProfile","removeUserFromProfile","addUserToProfile","licenses","getDimensions","editDimension","entityPath","description","createAdministrableDimension","deleteDimension","administrable","entityPathChildNodesAction","nodeType","idNode","nodeDisplayPath","nodePath","getActiveWFClasses","storeDocumentTemplates","restoreDocumentTemplates","Guid","getWorkFlowClasses","getTaskByWorkFlow","modifyProcessDuration","duration","modifyTaskDuration","getDataForMyTeam","getReporstAnalysisQuery","updateReportData","deleteReportData","getStoreLanguageTemplates","justActives","getLanguageTemplate","cultureName","processDefinition","graphicInfo","getLastUpdateByMobile","getCollectionData","idFact","filters","Array","isArray","getVirtualCollectionData","guidVirtualCollection","getSearchData","guidSearch","calculateFilters","serializeEntityData","getCollectionEntityData","templateType","referenceType","surrogateKey","defaultFilterApplied","reference","guidEntityCurrent","xpath","getFiltersEntityData","getProcessAddAction","getMultipleActions","getMapping","getForm","hasStartForm","guid","executeAction","surrogatedKey","ruleId","actionRule","getActivitiesData","pagsize","getPendingsData","getActionsData","getUsersAndEvents","idCases","getUsers","caseId","getEvents","getUsersImages","userIds","width","height","square","getShortCuts","getSearchLists","getIdCasesOfProcessEntities","ids","server","lessThanOrEqualsTo","getQueryForm","defineFilterObject","filterObject","properties","rangeQuery","searchType","min","max","typeSearch","values","setValues","clone","isDefaultFilter","defaultFilter","val","isNaN","getPlan","getActivities","updatePlan","putExecutePlan","deletePlan","closePlan","getWorkitemsPlan","getTransitionsByPlan","editActivityPlan","activity","items","idPlan","getPlanByParent","getItemsByActivity","getPlanParent","serializedData","_buildNewObject","header","newObject","guidEntity","timestamp","columns","rowData","kRow","iCell","cells","kReturnObject","BIZAGI_WORKPORTAL_WIDGET_START_FORM","args","modules","oldRender","async","activitySelector","renderVersion","resetRouteInformation","route","module","moduleParams","setRenderParams","getRenderParams","renderParams","formsRenderVersion","referrer","isComplex","onClose","isOfflineForm","skipSubprocessGlobalForm","BIZAGI_SETTINGS","getRoute","getRenderVersion","getWorkItems","workItems","hasWorkItems","setRenderModuleName","getRenderModuleName","searchIdTask","idWorkFlow","mobileAccess","isMobileAccessEnabledForWorkItem","listAsyncWorkItems","checkAsyncWorkItems","msgTask","routeToMessageForm","routeToGlobalForm","routeToGlobalFormWithoutData","workItemIndex","workitemCounter","isAsynch","checkProcess","subProcesses","checkWorkItems","xhr","errorType","renderName","widgetName","workItemsList","workItemToSearch","workItemId","currentWorkItem","idCaseForGlobalForm","urlTemplate","printf","withOutGlobalForm","messageForm","formsVersion","cachedFacade","getWorkportalFacade","initializeTemplates","facade","initAsyncStuff","getDataService","currentInboxView","deviceFactory","factory","routing","search","getQueryString","isConfiguredFromHash","defaultParams","createWebpart","executeWebpart","creating","doc","ownerDocument","canvas","processWebpart","webpartConfiguration","testWebpartConfiguration","append","executionDeferred","webpartController","deferTemplates","loadWebpart","getWebpart","getMainController","mainController","execute","processOfflineData","deviceFacade","executeWebparts","splitView","hide","isNativePluginSupported","isiOSTabletDevice","isiOSSmartphoneDevice","fetchOfflineData","online","isOfflineFormsV2Supported","getOutboxCasesCount","bizagiapp","openSyncDialog","pushOfflineData","render_module","setup","getWidgetImplementation","widget","setMobileMetaTags","setMobileIcons","homePortalFramework","homeportalFramework","templateService","appendTo","rel","loadTemplate","templateDestination","loadTemplateWebpart","resolvedRemplate","apply","originalAlias","alias","webpartImplementation","dynamicFunction","stringBuilder","join","dynamic","loadModule","err","defaultLogout","currentUser","userProperty","userProperties","sUserProperties","startpage","userstartpage","sortMenuItemsByStartPage","loadReleaseTemplates","debug","waits","onError","waitingTime","setTimeout","associatedStakeholders","homePortalLayout","homePortalLayoutDashboard","homePortalLayoutTaskFeed","homePortalLayoutComplement","bizagiModule","logoutPage","BIZAGI_NATIVE_COMPONENT_HOMEPORTAL","_super","getNativeComponent","homePortalReady","workPortalReady","isAndroidDevice","detectRealDevice","getFileImage","files","getEmptyFile","isWebpartInIFrame","top","getFailServerErrorDeferred","a","b","c","whenCreated","fullname","whenExecuted","BIZAGI_WORKPORTAL_WEBPART_ROUTING","BIZAGI_WORKPORTAL_WEBPART_RENDER","BIZAGI_WORKPORTAL_WEBPART_ASYNC","BIZAGI_WORKPORTAL_WEBPART_OLDRENDERINTEGRATION","helper","pane","project","namespace","isVisible","adjustButtonsToContent","remoteServer","postmessageSocket","postmessage","destination","parent","origin","receive","msg","iframeidentifier","BIZAGI_IFRAME_IDENTIFIER","event","canHide","shortName","webPartDestine","iframeclosemsg","send","showCasesMSG","startReceiving","sendDimensionsiFrame","mandatorysend","iframeDimentions","iframeName","iframeHeight","iframeWidth","notFireToIframe","refresh","contentElement","empty","newContent","manageError","canvasError","errorMsg","endWaiting","hideParent","show","getHomeportalFrameworkIntance","initialParams","navigator","accumulatedContext","navigateFromRender","_homeportalShow","configureHandler","homePortalNavigate","proxy","homePortalViewShown","homePortalViewInit","homePortalViewHide","drawerBeforeShow","loadComponents","component","components","wp","position","$canvas","func","loadComponentTemplate","templateName","wpLayout","direction","homePortalLayoutPositions","where","openDrawer","what","setContextFromRender","showDrawer","closeDrawers","selector","preventNavigate","navigateToRenderTemplates","title","view","_back","notifier","add","drawer","scroller","_cleanContext","getActionsContext","actionsContext","entityGuid","surrogateKeyToMapping","addContext","extendCurrentContext","popContext","pop","entityType","trigger","menuHome","layout","dashBoard","taskFeed","summaryItem","reportsChart","loadForm","renderTemplates","caseTemplates","caseTemplatesOptions","stakeHolder","shortCut","searchesList","stuff","leftPaneViewShown","_backRenderTemplates","_collapseHomePortalPane","collapsePanes","navParams","sender","_openLeftPane","showNewCase","showMenu","conten","toggle","navLength","history","getKendoMobilePane","leftDestination","leftContent","expandPanes","homePortalLayoutInit","openRenderElement","showMainMenu","reporting","defaultReport","info","reportSet","reports","bamprocessloadanalysis","resource","bamprocessworkinprogress","bamtasksworkinprogress","bamtaskloadanalysis","analyticsprocesscycletime","analyticsprocessdurationhistogram","analyticsprocessactivity","analyticsprocessactivationranking","analyticsprocessfrequentspaths","analyticstaskcycletime","callBack","bamresourcemonitorworkinprogress","bamresourcemonitorworkinprogressuser","bamresourcemonitorworkinprogressteam","sensors","SEARCH_PAGE_SIZE","SEARCH_DELAY","enableOfflineForm","hasOfflineFormsEnabled","searchList","inputtray","inputTray","referrerParams","isQuickSearchEnabled","loadDataListBeta","loadDataList","solutionDateElement","resultElement","elementLength","dateValue","processName","dataRowWorkItems","counterCase","grouped","getCaseData","dataItem","promises","entity","getActions","actions","startForm","entityName","getCommomActions","selectedItems","tempActions","shift","reduce","every","mode","multiplicity","actionAgreesRules","executeActionSingleData","executeChangeCaseEvent","processEvent","actionType","isMultiInstance","processAction","summary","sticky","class_name","refreshTemplate","entitySurrogateKey","isBatch","readonlyform","showConfirmation","showErrorMessage","executeActionMultipleData","surrogatedKeys","processBatchCreationAction","messageSummary","confirmation","dirty_message","success_summary","actionParams","itemSelected","processAddAction","addAction","xpathContext","actionParam","createParams","notification","formGuid","showConfirmationBox","label","executeRuleAction","promiseData","eventParams","actionsEvents","Casenumber","newCase","isNativeHeaderEnabled","addEntityValue","readOnly","openEntity","openEvent","userDataPromise","initials","_getInitials","_getUniqueUsers","merge","_canWorkOnIt","names","charAt","uniqueUsers","isAssignee","assigneesUsers","canWorkOnIt","renderHandlerPathRest","renderUploadHandlerPathRest","renderFileHandlerPathRest","letterHandlerPathRest","multiActionHandlerPathRest","metadataHandlerPathRest","form-get-data","form-submit-data","form-submit-data-upload","render-property-refresh","render-multiaction","render-upload-cancel-image","render-upload-data-url","render-upload-add-url","render-upload-delete-url","render-ecm-upload-url","render-multiaction-metadata","render-grid-edit-url","render-grid-save-url","render-grid-add-url","render-grid-rollback-url","render-grid-commit-url","render-grid-checkpoint-url","render-save-entity","render-stakeholder-associated","render-search-default-image","render-search-form-get-data","render-search-advanced-url","render-letter-notEditable-url","render-letter-content-url","render-letter-save-url","render-letter-content-icons","render-userfield-definition","render-document-generate","render-document-generateAllDocuments","render-processes-startform","render-processes-getstartform","render-entity-layout-image64","render-entity-layout-imageByteArray","getXSRFToken","render-entity-layout-upload-files","case-handler-getCaseSummaryByGuid","case-handler-getWorkItemsByGuid","admin-getUsersList","admin-getUsersList-FromPreferences","admin-getUsersList-ForStakeholders","admin-getUsersForAssignation","admin-users-config","admin-usersform","admin-sendUserEmail","alert","BA_ACTION_PARAMETER_PREFIX","BA_PAGE_CACHE","multiactionService","multiactionservice","Math","enableECMMetadataMultiaction","multiactionMetadataService","metadatamultiactionservice","userfieldRequests","multiaction","metadataECMMultiaction","getFormData","idForm","idRender","requestedForm","recordXPath","summaryForm","idPageCache","contextType","isRefresh","isActionStartForm","additionalXpaths","idStartScope","readOnlyForm","printversion","recordXpath","downloadOfflineForm","editable","BA_ALL_PARAMETER_PREFIX","prepare","chrono","initAndStart","ajaxParams","avoidLoader","stopAndLog","form","transformGridDataToReadOnly","_data","allowAdd","allowDelete","allowEdit","allowGrouping","allowMore","allowSearch","getSearchFormData","idSearchForm","processDataValues","o","submitData","resolveData","contexttype","transitions","surrogatekey","forcePlanCompletion","newName","isEmptyObject","substr","getPropertyData","extra","property","sessionId","guidentity","pxpath","prows","ppage","pfilter","psort","porder","pcaseId","pguidEntity","psurrogatedKey","pactionXpath","ptemplateGuid","pparameters","beforeSend","multiactionConnection","getData","term","getCollapseData","collapseState","getGridData","searchFilter","getGridDataExclusivesSelected","xpathfilter","getUploadCancelImage","getUploadFileUrl","fileId","verifyPathToBase","getUploadFileEntityUrl","isContextContainerWidgetRender","xpathActions","getUploadAddUrl","getUploadAddFileUrl","isUserPreferences","deleteImage","deleteUploadFile","getECMMetadata","idFileUpload","xPath","idAttrib","interceptor","intercept","source","checkOutFile","cancelCheckOut","deleteECMFile","updateECMFileContent","metaValues","updateECMMetadata","getFileProperties","uploadECMFile","fileUpload","fileName","getECMFileUrl","p_sessionId","isFileOnECM","idUpload","editGridRecord","addGridRecord","addGridRecordData","saveGridRecord","disableServerGridValidations","deleteGridRecord","getFlipAssociation","flipstate","rollbackGridAction","getSearchDefaultImage","processDataCriteria","criteria","submitSearch","encode","allowFullSearch","maxRecords","associateStakeholder","associatedUser","refreshAssociateStakeholder","getLetterNotEditableUrl","getLetterContent","getCanGenerateLetter","saveLetterContent","fullUrl","getLetterEditorIconsPath","executeButton","getFilePrintUrl","disposition","editLinkForm","saveLinkForm","rollbackLinkForm","commitLinkForm","commitGridAction","sendCheckpoint","sendCheckpointAction","getUserfieldDefinition","userfield","guidUserfield","refreshControl","refreshGridCell","column","typeRender","executeRule","rule","executeInterface","interface","executeSAPConnector","guidsap","executeConnector","guidConnector","generateDocumentTemplate","h_pageCacheId","contextXpath","xpathcontext","groupMappingId","groupMapping","xpathAttribute","controlId","getAllDocumentsDownloadUrl","getCaseNumber","getGridExportUrl","exportType","to","selected","invalidatePageCache","getUsersList","getUsersListFromPreferences","getUsersListForStakeholders","getUsersForAssignation","getUsersForm","sendUserEmail","eMailTo","forcePersonalizedColumns","templateGuid","isDefaultTemplate","getStartForm","guidprocess","mappingstakeholders","editActionForm","extendParams","ptags","pmaxitems","executeActions","pguidConstructor","pguidAction","getPolymorphicActions","serializePolymorphicActions","getParents","node","parents","fillTree","list","child","hasConstructor","guidObject","guidConstructor","getEntityImage64","getFilesDataForLayoutUploadControl","processUploadFile","verifyMobilePathToBase","formData","processData","isMashupContext","replaceAll","database","getFormDataFromNative","mergeForm","offlineType","isEdited","getTaskData","formPromise","getTaskForm","mergeDataDocument","complexData","object","mergedForm","getCase","getOfflineImage","fileType","getActivityImage","getStartDataImage","getOfflineActivityDataImage","fileFormat","getActivityDataImage","saveOfflineImage","image","operationType","saveActivityFormImage","saveActivityDataImage","saveStartDataImage","saveOfflineFile","file","mimeType","saveActivityFormFile","saveActivityDataFile","saveStartDataFile","getOfflineFile","getActivityFile","getStartDataFile","getOfflineActivityDataFile","getActivityDataFile","getNativeFormData","caseInfo","saveNativeFormInfo","saveTaskData","saveStartData","nativesaveStartData","saveFormData","batch","batchTimer","circularDependencies","replicateServiceMethods","getService","prototype","proxyMethod","method","makeCircularDependenciesError","messageTmpl","dependencyFrom","dependencyTo","deferred","detectCircularDependencies","addNode","clearTimeout","batchTimeout","tag","singleAction","resolveDependencies","multiactionError","fire","rejectDeferreds","responses","errorMessage","finalResponse","readQueryString","disabledb","globalId","BIZAGI_PROXY_PREFIX","createDatabases","_destroy","deleteDatabases","globalIdHash","hashCode","dbRecentProcesses","PouchDB","auto_compaction","dbProcessesHierarchy","dbStartForms","dbStartData","dbActivities","dbActivityForms","dbActivityData","databases","databasesDeleted","forEach","restartDatabases","getHierarchyObjects","obj","objects","lastIndexOf","getAllOpenCases","closed","emit","STOREOBJECTNAME","db","toISOString","offlineCase","_id","creationDate","categoryName","uniqueID","colorState","State","TaskName","put","deleteCase","get","getDocument","processesHierarchyDoc","groupCategory","getGroup","totalApps","tempCategories","subCategories","appId","cat","allDocs","include_docs","total_rows","localCase","syncStatus","DataType","queryFun","idWf","getOutboxCases","getOutboxTaskCases","getOutboxTaskCasesFilteredBySyncStatus","pSyncStatus","includeDocs","queryMap","emitValue","filterParameters","existantCase","getCustomizedColumnsNewData","isAborted","recentProcesses","saveOfflineTasks","tasksMap","saveQueue","bizagiQueue","currentTask","atRiskTime","wfClassDisplayName","saveOrUpdateTask","internalTaskId","currentDocument","saveDocument","saveError","cleanOfflineTasks","getOfflineCases","getLocalActivities","currentRow","updateCaseSyncStatus","docId","updateSyncAttribute","syncDetails","serverResponse","responseTimestamp","saveResp","wasActivityWorkedOffline","internalId","activityData","prop","buttons","fillForm","setRenderGridValues","setRenderValues","cause","setDataType","records","total","lengthColumns","tmpEditAndVisible","lengthRows","details","idRow","randomNumber","tempRow","col","changes","mergedRow","isNew","visible","getSummary","activityCaseId","attachmentId","documentId","saveAttachment","attachment","loadImageFromForm","formImage","dataImage","dataResult","formResult","saveTaskForm","deleteTaskForm","deleteDocument","updateTaskForm","saveStartForm","mergeTaskAction","oldAction","newAction","performSaveTaskData","dataToSave","saveResult","markTaskPromise","closeOfflineTask","markTaskEdited","markResponse","markError","separateComplexControls","mergePromise","mergeRes","images","uploads","grids","renderId","mergeError","updateResponse","updateErr","getErr","deleteTaskData","getResp","mergeData","filterXpathsByType","xpaths","extractXpathFromRenderProperties","renderProperties","extractRenderElements","isContainer","datafill","assigned","nativeSaveFormInfo","deleteNextButton","button","caption","querydisable","pull","syncOfflineCases","argument","synchronizing","pushInProgressPromise","syncCasesQueue","syncStarts","syncOfflineStartCases","syncTasks","syncOfflineTaskCases","startRes","taskRes","queueErr","startErr","taskErr","syncSingleOfflineTaskCase","taskData","syncCaseParams","generateSyncCasePromise","syncResult","syncSingleOfflineStartCase","syncResponse","synchCasesQueue","Start","itemId","Tasks","syncDeferred","syncOfflineStartCase","syncOfflineTaskCase","successMsg","maxOfflineCases","secondsBeforeAllowFetchAgain","tasksSyncDelda","startSyncDelta","fetchInProgress","triggerOfflineSyncEvent","synchronizeDownloadOfflineState","fetch","timeBeforeFetch","executeFetch","fetchInProgressPromise","downloadStartFormsPromise","downloadTaskFormsPromise","getOfflineTasksProm","getOfflineTasks","getOfflineProcessesProm","getOfflineProcessesHierarchy","formsToDownloadCountPromise","offlineWorkAvailable","offlineProcessesHierarchy","offlineTasksResponse","offlineProcessesList","getProcessesListFromHierarchy","serializedOfflineActivities","serializeActivities","getTasksToDownload","getStartFormsToDownload","tasksToDownloadResponse","startFormsToDownload","processTasksToFetchForms","fetchStartForms","getTasksToDownloadErr","getStartFormsToDownloadErr","tasks","startFormsSyncNeededError","offlineTasksError","lastFetch","startResult","tasksResult","getRecentOfflineProcesses","recentProcceses","saveRecentProcesses","offlineProcessTree","processesList","saveProcessesHierarchy","downloadStartForms","getProcessesFromCategory","isProcess","hasOfflineForm","checksQueue","processesToDownload","checkProm","checkIfStartFormNeedsSync","isSyncNeeded","localForm","lastSync","lastSynchronization","currentTime","downloadFormsQueue","formsSuccessCount","formsFailedCount","downloadProm","downloadOfflineStartForm","checkIfDownloadStartFormsEnds","elementsMap","serverActivities","localCases","itemsToDownload","itemsCount","timeBeforeNextHardRedownload","servTaskId","servTask","matchingLocalTask","lastFullSync","syncDelda","serverTasks","tasksToDownload","queueReadyToProcess","processOfflineFormsQueue","tasksSuccessfulCount","tasksFailedCount","tasksToDownloadCount","checkIfDownloadTaskFormsEnds","localActivitiesProm","localActivities","localActivityInternalId","deleteLocalDataIfActivityWasNotWorked","saveResponse","downloadTaskParams","processFormProm","downloadOfflineTaskForm","updateActivityDatachangesetAndSyncTimestamp","wasWorked","hierarchy","docHierarchy","dbProcessRecent","dbProcessHierarchy","dbForms","dbCases","old","syncronized","gId","saveFormInfo","tempDataColumn","lengthCols","array_cases","objToSend","rta","decodeURIComponent","pivot","rowPos","cellPos","cell","processesHierarchy","dataCategory","dataRecents","processesHierarchyTofetchForms","data1","data2","data3","changeset","getItemLocalStorage","callSyncForms","changeSet","prom","changeSetType","saveProcessesHierarchyTofetchForms","saveProcessInHierarchy","setItemLocalStorage","wfClass","globalid","workFlow","_rev","docRecent","shouldSynchronize","oldOfflineServicesAlreadyEnabled","enableOfflineEvents","renderDataService","fetchWorker","pullWorker","configureOfflineHandlers","configurePushCaseHandler","offlineModuleReady","setOfflineCategories","setOfflineRecentProcesses","openCreatedStartForm","inboxType","setOfflineInboxCases","offlineCaseDeleted","off","updateDataList","pushPromise","IdCase","responsePromise","syncError","networkErrorMsg","networkError","errorString","isMobileDevice","connection","Connection","NONE","queryoffline","returnOnlineStatus","outboxCasesCount","showSyncMessage","isValidResource","synchronizationFinished","showNotification","delegateUserName","idDelegateUser","groupSeparator","language","decimalSeparator","decimalDigits","symbol","ShortDateFormat","TimeFormat","LongDateFormat","twoDigitYearMax","twoDigitYearMaxDelta","uploadMaxFileSize","isMultiOrganization","getCustomizedColumnsDataTasks","currTask","wfclsdisplayname","permissions","Cases","AnalysisReports","Admin","CurrentUserAdministration","LogOut","SmartFolders","CustomFolders","BizagiQueries","StateLog","PrintableVersion","enableDefaultMethod","getNativeWorkItems","taskFeedData","getTaskFeedData","originalEndDate","recentProcess","isObjectEmpty","downloadImage","imageRenderControl","getPropertyDataParams","pageCacheId","base64Image","saveParams","downloadBinaryFile","uploadControl","getFileUrlParams","fileUrl","binary_file","reader","FileReader","onloadend","readAsText","getResponseHeader","byteArrayToBlob","stringToByteArray","downloadFilesInUploadControl","promisesArray","singleFileValue","downloadSingleFile","downloadPromise","binaryFile","downloadError","convertUploadOnlineValueInOfflineValue","offlineValue","fileExtension","media","getFileExtension","getMIMETypeByExtension","loadFormParams","separatedCaseData","performSyncOfflineCase","getFormErr","sData","imageValues","uploadValues","gridValues","uploadParams","uploadPromises","uploadControlValue","generateUploadPromisesAndDeleteActionsForFilesInUploadControl","imageControlValue","generateUploadPromiseForImageControl","gridPromises","generateGridPromises","bizAdditions","bizDeletions","syncAction","multiActionData","dataValue","performActionProm","multiactionResponse","deleteCasePromise","wasActionPerformed","deleteResponse","syncActionTagResponse","deleteError","delFormResponse","processMultiAction","failResponses","serverFormProm","getFormError","deleteActions","fileMimeType","uploadPromise","generateFileUploadPromise","deleteParams","deleteAction","generateFileDeleteAction","getFilePromise","uploadDeferred","getFileParams","AttachmentType","Blob","blobFile","uploadFileParams","uploadFile","FormData","BIZAGI_SESSION_NAME","imageControl","getImagePromise","uploadImageDeferred","blobImage","uploadImage","blob","addParams","queueID","encodeXpath","fileKey","uploadKey","addUrl","vFD","removeOnlineItems","gridsData","promisesResponse","currentGridData","isTaskForm","getServerTaskForm","resolvedForm","downloadPromises","upload","downloadImagesPromise","downloadFormImages","mergedFormPromise","imageControls","downloadImagesPromises","currentImageControl","pushStatus","v2Param","synObject","pullObject","awCaseCreationContext","offlineAction"],"mappings":"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","sourcesContent":["/*\r\n*   Name: Bizagi Template Services\r\n*   Author: Bizagi UI Team\r\n*   Comments:\r\n*   -   This class will provide a facade to access to all templates available on bizagi\r\n*/\r\n\r\n$.Class.extend(\"bizagi.kendo.templates.services.service\", {\r\n    // Static templates\r\n    customTemplateFile: bizagi.loader.getResource(\"tmpl\", \"bizagi.overrides.\" + bizagi.detectDevice() + \".custom.templates\"),\r\n    cachedFiles: {},\r\n    cachedTemplates: {},\r\n    customTemplates: {}\r\n}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (localization) {\r\n        this.localization = localization;\r\n        this.cssRegex = /{{css \"(.+)\"}}/g;\r\n        this.loadingFileDeferred = {};\r\n    },\r\n\r\n    /*\r\n    *   Load custom templates info in order to override framework stuff\r\n    */\r\n    loadCustomTemplates: function () {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        $.when(this.getTemplateFile(this.Class.customTemplateFile))\r\n        .done(function (response) {\r\n            var temp = $(\"<div />\").html(response);\r\n            var responseParts = $(\"script\", temp);\r\n\r\n            $.each(responseParts, function (i, responsePart) {\r\n                responsePart = $(responsePart);\r\n                self.Class.customTemplates[responsePart.attr(\"id\")] = responsePart.html();\r\n            });\r\n\r\n            defer.resolve();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Returns the template from cache or from ajax\r\n    *   Must return a deferred\r\n    */\r\n    getTemplate: function (template, id) {\r\n        var self = this;\r\n        var isCustomTemplate = false;\r\n\r\n        // If the template contains double hash, it's because its in release mode, then we got to ignore the first hash\r\n        template = template.replace(/([^#]*#)([^#]*#)([^#]*)/g, \"$1$3\");\r\n\r\n        // If the template contains the hash before the question mark, we need to exchange them\r\n        template = template.replace(/([a-zA-Z_\\/.-=]*)#([a-zA-Z_\\/.-]*)\\?(build=[a-zA-Z0-9.-]*)/g, \"$1?$3#$2\");\r\n\r\n        if (bizagi.enableCustomizations) {\r\n            var hash = self.getHash(template);\r\n\r\n            // Check if a custom template has been given in order to override it\r\n            if (self.Class.customTemplates[hash]) {\r\n                isCustomTemplate = true;\r\n            }\r\n        }\r\n\r\n        if (isCustomTemplate || (bizagi.loader.environment !== \"release\")) {\r\n            return this.internalGetTemplate(template, id)\r\n                .pipe(function (resolvedTemplate) {\r\n                    // Creates a in-memory element to hold the template\r\n                    return resolvedTemplate;\r\n                });\r\n        } else {\r\n            return this.getTemplateForRelease(template, id)\r\n                .pipe(function (resolvedTemplate) {\r\n                    return resolvedTemplate;\r\n                });\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Returns the template from cache or from ajax\r\n     *   Must return a deferred\r\n     */\r\n    getTemplateWidget: function (template, id) {\r\n        var self = this;\r\n        var isCustomTemplate = false;\r\n\r\n        // If the template contains double hash, it's because its in release mode, then we got to ignore the first hash\r\n        template = template.replace(/([^#]*#)([^#]*#)([^#]*)/g, \"$1$3\");\r\n\r\n        // If the template contains the hash before the question mark, we need to exchange them\r\n        template = template.replace(/([a-zA-Z_\\/.-=]*)#([a-zA-Z_\\/.-]*)\\?(build=[a-zA-Z0-9.-]*)/g, \"$1?$3#$2\");\r\n\r\n        if (bizagi.enableCustomizations) {\r\n            var hash = self.getHash(template);\r\n\r\n            // Check if a custom template has been given in order to override it\r\n            if (self.Class.customTemplates[hash]) {\r\n                isCustomTemplate = true;\r\n            }\r\n        }\r\n\r\n        if (isCustomTemplate || (bizagi.loader.environment !== \"release\")) {\r\n            return this.internalGetTemplate(template, id)\r\n                .pipe(function (resolvedTemplate) {\r\n                    // Creates a in-memory element to hold the template\r\n                    return resolvedTemplate;\r\n                });\r\n        } else {\r\n            return this.getTemplateForRelease(template, id).then(function (resolvedTemplate) {\r\n                return resolvedTemplate;\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Returns the template from cache or from ajax\r\n    *   Must return a deferred\r\n    */\r\n    getTemplateWebpart: function (template, id) {\r\n        // If the template contains double hash, it's because its in release mode, then we got to ignore the first hash\r\n        template = template.replace(/([^#]*#)([^#]*#)([^#]*)/g, \"$1$3\");\r\n\r\n        // If the template contains the hash before the question mark, we need to exchange them\r\n        template = template.replace(/([a-zA-Z_\\/.-=]*)#([a-zA-Z_\\/.-]*)\\?(build=[a-zA-Z0-9.-]*)/g, \"$1?$3#$2\");\r\n        return this.internalGetTemplate(template, id)\r\n            .pipe(function (resolvedTemplate) {\r\n                // Creates a in-memory element to hold the template\r\n                return resolvedTemplate;\r\n            });\r\n    },\r\n\r\n    /*\r\n    * Load the production template and return requested template\r\n    */\r\n    getTemplateForRelease: function (template, id) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var url;\r\n        var hash;\r\n\r\n        // extract url\r\n        if (self.containsHash(template)) {\r\n            url = self.getUrlWithoutHashes(template);\r\n            hash = self.getHash(template);\r\n        } else {\r\n            url = template;\r\n            hash = \"\";\r\n        }\r\n\r\n        var cachedTemplate = self.Class.cachedTemplates[url];\r\n\r\n        if (!cachedTemplate) {\r\n            $.when(self.loadTemplateFileForRelease(url))\r\n            .done(function () {\r\n                defer.resolve(self.processAndReturnTemplate(url, hash, id));\r\n            });\r\n\r\n        } else {\r\n            defer.resolve(self.processAndReturnTemplate(url, hash, id));\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    loadTemplateFileForRelease: function (url) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n\r\n        // Check in cache\r\n        if (self.Class.cachedTemplates[url]) {\r\n            return self.Class.cachedTemplates[url];\r\n        }\r\n\r\n        // Check if it is already being loaded\r\n        if (self.loadingFileDeferred[url]) {\r\n            $.when(self.loadingFileDeferred[url])\r\n                .done(function () {\r\n                    // Resolve with cached content\r\n                    defer.resolve(self.Class.cachedTemplates[url]);\r\n                });\r\n            return defer.promise();\r\n        }\r\n\r\n        // Load file via ajax\r\n        self.loadingFileDeferred[url] = $.Deferred();\r\n        $.when($.ajax({ url: url, dataType: \"text\" }), self.localization.ready())\r\n            .done(function (response) {\r\n                if (!response)\r\n                    defer.reject(\"\");\r\n\r\n                // response is an object\r\n                if (typeof (response) != \"string\")\r\n                    response = JSON.parse(response[0]);\r\n\r\n                self.Class.cachedTemplates[url] = response;\r\n\r\n                // process templates for translate, remove CSS and generate global function template\r\n                var index;\r\n                var valueTemplate;\r\n                var translatedTemplate;\r\n\r\n                for (index in response) {\r\n                    if (response.hasOwnProperty(index)) {\r\n                        valueTemplate = response[index];\r\n                        translatedTemplate = self.localization.translate(valueTemplate);\r\n\r\n                        // Remove css tags\r\n                        translatedTemplate = translatedTemplate.replace(self.cssRegex, \"\");\r\n                        self.Class.cachedTemplates[url][index] = translatedTemplate;\r\n                    }\r\n                }\r\n\r\n                self.loadingFileDeferred[url].resolve();\r\n                defer.resolve(response);\r\n            });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    * Return hashed template\r\n    */\r\n    processAndReturnTemplate: function (url, hash, id) {\r\n        var self = this;\r\n        var template = self.Class.cachedTemplates[id];\r\n\r\n        if (!template) {\r\n            template = self.Class.cachedTemplates[url][hash];\r\n\r\n            if (!template) {\r\n                throw \"template \" + template + \"doesn't exist\";\r\n            } else {\r\n                self.Class.cachedTemplates[id] = template;\r\n            }\r\n        }\r\n\r\n        return template;\r\n    },\r\n\r\n    /*\r\n    *   Returns the template from cache or from ajax\r\n    *   Must return a deferred\r\n    */\r\n    internalGetTemplate: function (template, id) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n        var cachedTemplate = this.Class.cachedTemplates[id];\r\n\r\n        if (!cachedTemplate) {\r\n\r\n            // Check if the template has a hash\r\n            if (self.containsHash(template)) {\r\n                var url = self.getUrlWithoutHashes(template);\r\n                var hash = self.getHash(template);\r\n\r\n                // Check if a custom template has been given in order to override it\r\n                if (self.Class.customTemplates[url]) {\r\n                    // Resolve deferred\r\n                    if (self.Class.customTemplates[url][id]) {\r\n                        defer.resolve(self.Class.customTemplates[hash]);\r\n                        return defer.promise();\r\n                    }\r\n                }\r\n\r\n                $.when(self.getTemplatePart(url, hash, id))\r\n                    .done(function (response) {\r\n                        // Set in cache\r\n                        self.Class.cachedTemplates[id] = response;\r\n\r\n                        // Resolve deferred\r\n                        defer.resolve(response);\r\n                    });\r\n\r\n            } else {\r\n                // Gets the full template\r\n                $.when(self.getTemplateFile(template))\r\n                    .done(function (response) {\r\n                        self.Class.cachedTemplates[id] = response;\r\n                        // Resolve deferred\r\n                        defer.resolve(response);\r\n                    });\r\n            }\r\n        } else {\r\n            defer.resolve(cachedTemplate);\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Gets a template part from a composite template file\r\n    *   Just load one template at a time to avoid multiple loadings of the same file\r\n    */\r\n    getTemplatePart: function (templateUrl, hash) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // If it is already loading a template set a timeout to check later\r\n        $.when(self.loadingTemplatePartExecution)\r\n        .done(function () {\r\n            // Set a async flag to synchronize this method\r\n            self.loadingTemplatePart = true;\r\n            self.loadingTemplatePartExecution = new $.Deferred();\r\n\r\n            // Load template file\r\n            $.when(self.getTemplateFile(templateUrl))\r\n            .done(function (response) {\r\n                var temp = $(\"<div />\").html(response);\r\n                var responsePart = $(\"#\" + hash, temp);\r\n\r\n                // Assertion to check that hash exists inside the main template                \r\n                if (BIZAGI_ENVIRONMENT === \"debug\" && responsePart.length === 0) {\r\n                    console.warn(\"No template part (\" + hash + \") found in content for:\" + templateUrl);\r\n                }\r\n\r\n                // Set response\r\n                response = responsePart.html();\r\n\r\n                // Free async flag\r\n                self.loadingTemplatePartExecution.resolve();\r\n                self.loadingTemplatePart = true;\r\n\r\n                // Resolve main deferred\r\n                defer.resolve(response);\r\n            });\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Loads a full template file and keeps it on cache\r\n    */\r\n    getTemplateFile: function (template) {\r\n        var self = this;\r\n        var cachedTemplate = this.Class.cachedFiles[template];\r\n\r\n        if (cachedTemplate) return cachedTemplate;\r\n\r\n        // Not found in cache, fetch it with ajax\r\n        return $.when($.ajax({ url: template, dataType: \"text\" }), self.localization.ready())\r\n            .pipe(function (response) {\r\n                // if no response has been found in the source file return an empty template\r\n                if (!response) return \"\";\r\n\r\n                if (typeof (response) != \"string\")\r\n                    response = response[0];\r\n\r\n                // Translate template\r\n                var translatedTemplate = self.localization.translate(response);\r\n\r\n                // Find css and import them\r\n                var matches = translatedTemplate.match(self.cssRegex);\r\n\r\n                if (matches) {\r\n                    $.each(matches, function (i, match) {\r\n                        var cssFile = match.replace(self.cssRegex, \"$1\");\r\n\r\n                        bizagi.loader.loadFile({ src: cssFile, type: \"css\", environment: \"debug\" });\r\n                    });\r\n                }\r\n                // Remove css tags\r\n                translatedTemplate = translatedTemplate.replace(self.cssRegex, \"\");\r\n\r\n                // Set in cache\r\n                self.Class.cachedFiles[template] = typeof (translatedTemplate) === \"string\" ? translatedTemplate\r\n                    : translatedTemplate[0].outerHTML;\r\n\r\n                return translatedTemplate;\r\n            });\r\n    },\r\n\r\n    /*\r\n    *   Check if a url contains hashes\r\n    */\r\n    containsHash: function (url) {\r\n        return url.indexOf(\"#\") !== -1;\r\n    },\r\n\r\n    /*\r\n    *   Get url hash\r\n    */\r\n    getHash: function (url) {\r\n        return url.substring(url.indexOf(\"#\") + 1, url.length);\r\n    },\r\n\r\n    /*\r\n    *   Get url without hashes\r\n    */\r\n    getUrlWithoutHashes: function (url) {\r\n        return url.substring(0, url.indexOf(\"#\"));\r\n    }\r\n});\r\n\r\nif (!bizagi.override.enableMSF) {\r\n\r\n    jQuery.fn.fastEmpty = function () {\r\n        $(this).kendoTmplEmpty();\r\n    };\r\n\r\n    jQuery.fasttmpl = function (tmpl, data) {\r\n        return jQuery.kendoTmpl(tmpl, data);\r\n    };\r\n\r\n    //jQuery.tmpl = function (tmpl, data) {\r\n    //    return jQuery.kendoTmpls(tmpl, data);\r\n    //};\r\n\r\n    jQuery.cacheTemplate = function (tmpl, data) {\r\n        jQuery.cacheKendoTemplate(tmpl, data);\r\n    };\r\n\r\n}\r\n// KENDO TEMPLATES\r\n\r\n/**\r\n *   Overrides detach method to apply custom stuff\r\n */\r\njQuery.fn.kendoTmplEmpty = function () {\r\n    this.children().remove();\r\n\r\n    // Check if it has loading property to apply plugin\r\n    var element = $(this);\r\n    if (element.hasClass(\"ui-bizagi-component-loading\")) {\r\n        element.loadingMessage();\r\n    }\r\n};\r\n\r\n/**\r\n *   JQuery tmpl extension\r\n */\r\njQuery.kendoTmpl = function (tmpl, data) {\r\n    if (typeof tmpl === \"undefined\") return \"\";\r\n\r\n    tmpl = tmpl.replace(/(\\n*)|(\\r*)|(\\t*)/g, \"\");\r\n    tmpl = tmpl.replace(/\\s+/g, \" \");\r\n\r\n    var tempTmpl = kendo.template(tmpl, { useWithBlock: false });\r\n    var html = tempTmpl(data);\r\n\r\n    return $.trim(html.replace(/>\\s*</g, \"><\"));\r\n};\r\n\r\njQuery.kendoTmpls = function (tmpl, data) {\r\n    return $(jQuery.kendoTmpl(tmpl, data));\r\n};\r\n\r\njQuery.cacheKendoTemplate = function(tmpl, data) {\r\n    var tempTmpl = bizagi.kendo.templates.services.service.cachedTemplates[tmpl];\r\n    return jQuery.kendoTmpl(tempTmpl, data);\r\n};\r\n","/**\r\n * System loader override to avoid workportalflat/webparts requests\r\n *\r\n * scoped in a function so we don't mess up system's vars\r\n */\r\n\r\n(function(){\r\n\r\n  // Creates or Defines steal loader\r\n  var steal = window.steal || {};\r\n  // Create or Define BizAgi namespace\r\n  var bizagi = window.bizagi || {};\r\n  bizagi.loader = bizagi.loader || {};\r\n  \r\n  if (bizagi.loader.environment === \"release\") {\r\n\r\n    // Loader override methods\r\n    (function () {\r\n\r\n      var loaderOverride = {\r\n        /**\r\n         * Auto called function when JS file is loaded to register its webparts\r\n         * @param webpartName Array/String\r\n         */\r\n        registerMobileWebpart: function (webpartName) {\r\n\r\n          if (typeof webpartName === \"string\") {\r\n            webpartName = [webpartName];\r\n          }\r\n\r\n          this.webparts = this.webparts || {};\r\n\r\n          // Creates a dummy webpart for each one\r\n          webpartName.map(function (name) {\r\n            if (!this.webparts[name]) {\r\n              this.webparts[name] = {\r\n                \"class\": \"bizagi.workportal.webparts.\" + name,\r\n                devices: null,\r\n                location: \"\",\r\n                name: name,\r\n                js: [],\r\n                css: [],\r\n                tmpl: []\r\n              };\r\n            }\r\n            this.webparts[name].initialized = true;\r\n            this.webparts[name].initializing = false;\r\n            this.webparts[name].loadingDeferred = this.webparts[name].loadingDeferred || new $.Deferred();\r\n          }.bind(this));\r\n        }\r\n      };\r\n\r\n      Object.keys(loaderOverride).map(function (key) {\r\n        bizagi.loader[key] = loaderOverride[key];\r\n      });\r\n\r\n    })();\r\n\r\n    // Steal override methods\r\n    (function () {\r\n      var loadedWebparts = false;\r\n\r\n      steal.origRequest = steal.request;\r\n      steal.request = function (options, success, error) {\r\n        if (!arguments[0] || !arguments[0].src || !(arguments[0].src + \"\").match(/\\/workportalflat\\/webparts\\//i)) {\r\n          // If asked for a normal, not workportalflat/webpart, go and do your things\r\n          return this.origRequest(options, success, error);\r\n        }\r\n        else {\r\n          var device = bizagi.detectDevice().replace(/[^a-z0-9]+/ig, \"\");\r\n\r\n          if (!loadedWebparts) {\r\n            // Is is the 1st time that asked for workportalflat/webpart, lets load all at once\r\n\r\n            var prefix = bizagi.loader.useAbsolutePath ? bizagi.loader.basePath + bizagi.loader.getLocationPrefix() : \"\" + bizagi.loader.getLocationPrefix();\r\n            var js = prefix + \"jquery/workportalflat/production/\" + device + \"/webpart.\" + device + \".production.js?build=\" + bizagi.loader.build;\r\n            var css = prefix + \"jquery/workportalflat/production/\" + device + \"/webpart.\" + device + \".production.css?build=\" + bizagi.loader.build;\r\n\r\n            loadedWebparts = true;\r\n\r\n            bizagi.loader.loadFile({ type: \"js\", src: js });\r\n            bizagi.loader.loadFile({ type: \"css\", src: css });\r\n\r\n          }\r\n\r\n          // In any case: register a dummy resource\r\n          var url = arguments[0].id + \"\";\r\n          bizagi.loader.registerMobileWebpart(device);\r\n\r\n          steal.resources[url].completed.resolve();\r\n          steal.resources[url].loaded.resolve();\r\n          steal.resources[url].loading = false;\r\n          steal.resources[url].executing = false;\r\n          steal.resources[url].options.text = JSON.stringify(bizagi.loader.webparts[device]);\r\n\r\n          success(steal.resources[url].options.text);\r\n        }\r\n\r\n      };\r\n    })();\r\n    \r\n  }\r\n\r\n})();\r\n","bizagi = (typeof (bizagi) !== \"undefined\") ? bizagi : {};\r\nbizagi.util = (typeof (bizagi.util) !== \"undefined\") ? bizagi.util : {};\r\nbizagi.context = (typeof (bizagi.context) !== \"undefined\") ? bizagi.context : {};\r\nbizagi.util.smartphone = (typeof (bizagi.util.smartphone) !== \"undefined\") ? bizagi.util.smartphone : {};\r\nbizagi.util.tablet = (typeof (bizagi.util.tablet) !== \"undefined\") ? bizagi.util.tablet : {};\r\nbizagi.util.mobility = (typeof (bizagi.util.mobility) !== \"undefined\") ? bizagi.util.mobility : {};\r\n\r\nbizagi.util.smartphone.startLoading = function () {\r\n    bizagi.loading.start();\r\n};\r\n\r\nbizagi.util.smartphone.stopLoading = function () {\r\n    bizagi.loading.stop();\r\n};\r\n\r\nbizagi.util.mobility.getResource = function(resourceKey, fallback){\r\n    return bizagi.localization.getResource(resourceKey,fallback);\r\n}\r\n\r\nbizagi.loader.initWebpartOld = bizagi.loader.initWebpart;\r\n\r\nbizagi.loader.initWebpart = function (webpart, device, callback) {\r\n    var self = this;\r\n    if (webpart != null) {\r\n        if (!webpart.initialized) {\r\n            if (webpart.devices) {\r\n                if (typeof webpart.devices[device] !== 'undefined') {\r\n                    bizagi.loader.initWebpartOld($.extend(webpart, webpart.devices[device]), device, callback);\r\n                } else {\r\n                    console.log(\"No existe la definicion del device \" + device + \" Para el webpart \" + webpart.name);\r\n                }\r\n            } else {\r\n                bizagi.loader.initWebpartOld(webpart, device, callback);\r\n            }\r\n        } else {\r\n            steal.then(function () {\r\n                // Invokes callback\r\n                if (callback) callback();\r\n            });\r\n        }\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Initializes a webpart on-demand\r\n * @param webpart\r\n * @param device\r\n * @returns {*}\r\n */\r\nbizagi.util.initWebpart = function (webpart, device) {\r\n    var defer = new $.Deferred();\r\n\r\n    device = device || bizagi.detectDevice();\r\n\r\n    if (webpart.initialized) {\r\n        // If already initialized resolve the deferred\r\n        defer.resolve();\r\n    } else {\r\n\r\n        if (webpart.initializing) {\r\n            $.when(webpart.loadingDeferred.promise())\r\n                .done(function () {\r\n                    defer.resolve();\r\n                });\r\n        } else {\r\n\r\n            webpart.loadingDeferred = new $.Deferred();\r\n            webpart.initializing = true;\r\n            bizagi.loader.initWebpart(webpart, device, function () {\r\n\r\n                // Resolve deferreds\r\n                webpart.loadingDeferred.resolve();\r\n                webpart.initializing = false;\r\n                defer.resolve();\r\n            });\r\n        }\r\n    }\r\n\r\n    return defer.promise();\r\n};\r\n\r\nbizagi.util.isDate = function (value) {\r\n    value = value || '';\r\n    var state = false;\r\n    var slash = (typeof value == 'string') ? value.split(\"/\") : '';\r\n    try {\r\n        // Check format int/int/int\r\n        if (slash.length == 3) {\r\n            var date = new Date(value);\r\n            if (date.getYear() > 0) {\r\n                state = true;\r\n            }\r\n        }\r\n    } catch (e) {\r\n        state = false;\r\n    }\r\n\r\n    return state;\r\n};\r\n\r\nbizagi.util.setContext = function (params, reset) {\r\n    params = params || {};\r\n    reset = reset || false;\r\n    if (reset) {\r\n        bizagi.context = {};\r\n    }\r\n\r\n    $.each(params, function (key, value) {\r\n        bizagi.context[key] = value;\r\n    });\r\n};\r\n\r\n/**\r\n * Get time ago\r\n * @param commentTime\r\n * @returns {jQuery|*|*|*|*|*|*}\r\n */\r\nbizagi.getTimeAgo = function (commentTime) {\r\n    return $.timeago(new Date(commentTime));\r\n};\r\n\r\n/**\r\n * Data grouped\r\n * @param date\r\n */\r\nbizagi.getGroupedData = function (date) {\r\n    var groupedData = {};\r\n\r\n    var actualDate = new Date();\r\n    var actualYear = actualDate.getFullYear();\r\n    var actualMonth = actualDate.getMonth();\r\n    var actualDay = actualDate.getDate();\r\n\r\n    date = bizagi.util.isDate(date) ? date : actualDate;\r\n\r\n    var tmpDate = new Date(date);\r\n    var tmpMonth = tmpDate.getMonth();\r\n    var tmpYear = tmpDate.getFullYear();\r\n    var tmpDay = tmpDate.getDate();\r\n\r\n    var dateDiff = ((new Date(tmpYear, tmpMonth, tmpDay, 0, 0, 0) - new Date(actualYear, actualMonth, actualDay, 0, 0, 0)));\r\n\r\n    if (dateDiff < 0) {\r\n        groupedData.date = bizagi.util.dateFormatter.formatDate(new Date(tmpDate), \"dd MMM\");\r\n        groupedData.type = bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n        groupedData.status = \"red\";\r\n    } else {\r\n        if (actualDay === tmpDay) {\r\n            groupedData.date = bizagi.util.dateFormatter.formatDate(new Date(tmpDate), \"hh:mm\");\r\n            groupedData.type = bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n            groupedData.status = \"yellow\";\r\n        } else if ((actualDay + 1) === tmpDay) {\r\n            groupedData.date = bizagi.util.dateFormatter.formatDate(new Date(tmpDate), \"hh:mm\");\r\n            groupedData.type = bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n            groupedData.status = \"yellow\";\r\n        } else {\r\n            groupedData.date = bizagi.util.dateFormatter.formatDate(new Date(tmpDate), \"dd MMM\");\r\n            groupedData.type = bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n            groupedData.status = \"green\";\r\n        }\r\n    }\r\n\r\n    return groupedData;\r\n};\r\n\r\nbizagi.util.getTaskStatus = function (date) {\r\n    // Current date\r\n    var actualDate = new Date();\r\n    var actualMonth = actualDate.getMonth();\r\n    var actualDay = actualDate.getDate();\r\n    var actualYear = actualDate.getFullYear();\r\n\r\n    // Solution date\r\n    var solutionDate = date || \"\";\r\n    if (!bizagi.util.isDate(solutionDate)) return \"--\";\r\n\r\n    // Temporal date\r\n    var tmpDate = new Date(solutionDate);\r\n    var tmpDay = tmpDate.getDate();\r\n    var tmpMonth = tmpDate.getMonth();\r\n    var tmpYear = tmpDate.getFullYear();\r\n\r\n    // Difference date\r\n    var dateDiff = ((new Date(tmpYear, tmpMonth, tmpDay, 0, 0, 0)\r\n        - new Date(actualYear, actualMonth, actualDay, 0, 0, 0)));\r\n\r\n    if (dateDiff < 0) {\r\n        return bizagi.util.dateFormatter.formatDate(new Date(solutionDate), \"dd MMM\");\r\n    } else {\r\n        if (actualMonth === tmpMonth && actualDay === tmpDay) {\r\n            return bizagi.util.dateFormatter.formatDate(new Date(solutionDate), \"hh:mm\");\r\n        } else if (actualMonth === tmpMonth && (actualDay + 1) === tmpDay) {\r\n            return bizagi.util.dateFormatter.formatDate(new Date(solutionDate), \"hh:mm\");\r\n        } else {\r\n            return bizagi.util.dateFormatter.formatDate(new Date(solutionDate), \"dd MMM\");\r\n        }\r\n    }\r\n};\r\n\r\n/*\r\n* Give format to data\r\n*/\r\nbizagi.util.formatDataType = function (value, dataType) {\r\n\r\n    var parseValue = \"\";\r\n\r\n    if (dataType === \"NText\" || dataType === \"VarChar\") {\r\n        parseValue = \"<div>\" + bizagi.util.replaceLineBreak(value) + \"</div>\";\r\n    } else if (dataType === \"Boolean\") {\r\n        parseValue = bizagi.util.formatBoolean(value);\r\n    } else if (dataType === \"Int\" || dataType === \"BigInt\" || dataType === \"SmallInt\" || dataType === \"TinyInt\") {\r\n        parseValue = value;\r\n    } else if (dataType === \"Money\") {\r\n        parseValue = bizagi.util.formatMonetaryCell(value);\r\n    } else if (dataType === \"Float\" || dataType === \"Real\") {\r\n        parseValue = bizagi.util.formatDecimalCell(value);\r\n    } else if (dataType === \"DateTime\") {\r\n        parseValue = bizagi.util.dateFormatter.formatDate(new Date(value), bizagi.localization.getResource(\"dateFormat\") + \" \" + bizagi.localization.getResource(\"timeFormat\"));\r\n    } else {\r\n        parseValue = value;\r\n    }\r\n\r\n    return parseValue;\r\n};\r\n\r\n/*\r\n*   Dar formato a la celda tipo DateTime\r\n*/\r\nbizagi.util.formatDateTime = function (value) {\r\n    value = (value == null) ? \"\" : value;\r\n    value = (typeof value != \"string\") ? value.toString() : value;\r\n    if (Date.parse(value)) {\r\n        var newDate = new Date(value);\r\n        var date = ((newDate.getMonth() + 1) < 10 ? (\"0\" + (newDate.getMonth() + 1)) : (newDate.getMonth() + 1)) + \"/\" + ((newDate.getDate() < 10) ? ('0' + newDate.getDate()) : newDate.getDate()) + \"/\" + newDate.getFullYear();\r\n        var time = (newDate.getHours() < 12 && value.toLowerCase().indexOf(\"pm\") > 0 ? newDate.getHours() + 12 : newDate.getHours()) + \":\" + (newDate.getMinutes() < 10 ? \"0\" + newDate.getMinutes() : newDate.getMinutes());\r\n\r\n        return (date + \" \" + time);\r\n    } else {\r\n        return value;\r\n    }\r\n};\r\n\r\n/*\r\n* Aplicar formato Tipo moneda\r\n*/\r\nbizagi.util.formatMonetaryCell = function (value) {\r\n    return bizagi.util.formatMoney(value, BIZAGI_DEFAULT_CURRENCY_INFO);\r\n};\r\n\r\n\r\nbizagi.util.formatDecimal = function (value, format) {\r\n    var i = $(\"<i/>\").text(value);\r\n    i.formatCurrency(format);\r\n    return i.text();\r\n};\r\n\r\n/**\r\n * Syntax Highlight\r\n * @param {} json\r\n * @returns {}\r\n */\r\nbizagi.util.syntaxHighlight = function (json) {\r\n    if (typeof (json) == \"undefined\" || json == null) return \"\";\r\n\r\n    json = json.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n\r\n    return json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\r\n        var cls = \"number\";\r\n\r\n        if (/^\"/.test(match)) {\r\n            if (/:$/.test(match)) {\r\n                cls = \"key\";\r\n            } else {\r\n                cls = \"string\";\r\n            }\r\n        } else if (/true|false/.test(match)) {\r\n            cls = \"boolean\";\r\n        } else if (/null/.test(match)) {\r\n            cls = \"null\";\r\n        }\r\n\r\n        return \"<span class='\" + cls + \"'>\" + match + \"</span>\";\r\n    });\r\n};\r\n\r\n/**\r\n * Convert String to Base64 Unicode\r\n * @param {} str\r\n * @returns {}\r\n */\r\nbizagi.util.b64EncodeUnicode = function (string) {\r\n    return btoa(encodeURIComponent(string).replace(/%([0-9A-F]{2})/g, function (match, p1) {\r\n        return String.fromCharCode(\"0x\" + p1);\r\n    }));\r\n};\r\n","bizagi = (typeof (bizagi) !== 'undefined') ? bizagi : {};\r\nbizagi.util = (typeof (bizagi.util) !== 'undefined') ? bizagi.util : {};\r\nbizagi.util.tablet = (typeof (bizagi.util.tablet) !== \"undefined\") ? bizagi.util.tablet : {};\r\nbizagi.util.mobility = (typeof (bizagi.util.mobility) !== \"undefined\") ? bizagi.util.mobility : {};\r\nbizagi.environment = typeof (BIZAGI_ENVIRONMENT) !== \"undefined\" ? BIZAGI_ENVIRONMENT : (queryString[\"environment\"] || \"debug\");\r\n\r\nbizagi.util.tablet.startLoading = function () {\r\n    bizagi.loading.start();\r\n};\r\n\r\nbizagi.util.tablet.stopLoading = function () {\r\n    bizagi.loading.stop();\r\n};\r\n\r\nbizagi.util.tablet.startkendo = function (params) {\r\n    if (typeof (bizagi.kendoMobileApplication) === \"undefined\") {\r\n        bizagi.kendoMobileApplication = new kendo.mobile.Application($(\"body\"), {\r\n            transition: \"slide\",\r\n            skin: \"flat\",\r\n            initial: \"initKendo\",\r\n            init: function (e) {\r\n                kendo.ui.progress($(\".km-flat\"), true);\r\n                params.started && params.started();\r\n            }\r\n        });\r\n\r\n        bizagi.kendoMobileApplication.bizagiNavigate = function (e, t) {\r\n            this.navigate(e, t);\r\n        };\r\n    } else {\r\n        params.started && params.started();\r\n    }\r\n};\r\n","/*\r\n*   Name: BizAgi Workportal Main Controller\r\n*   Author: oo\r\n*   Comments:\r\n*   -   This script will define a base class to handle workportal layouts for any device\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.controllers.controller\", {}, {\r\n\r\n    /**\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        // Set workportal facade\r\n        this.workportalFacade = workportalFacade;\r\n\r\n        // Set data service\r\n        this.dataService = dataService;\r\n\r\n        // Set l10n service\r\n        this.resources = bizagi.localization;\r\n\r\n        //set container to bind events\r\n        this.container = params.container || document;\r\n\r\n        // Set a component container hash to use with templates\r\n        this.componentContainers = {};\r\n\r\n        bizagi.workportal.controllers.instances = {};\r\n        bizagi.workportal.controllers.instances.controller = this;\r\n    },\r\n\r\n    /**\r\n    *   Returns the current workportal\r\n    */\r\n    getWorkportal: function () {\r\n        return this.workportalFacade.workportal;\r\n    },\r\n\r\n    /**\r\n    *   Publish an event so any controller can subscribe to it\r\n    */\r\n    publish: function (eventName, params) {\r\n        return $(this.container).triggerHandler(eventName, params);\r\n    },\r\n\r\n    /**\r\n    *   Subscribe to an event that any controller could trigger\r\n    */\r\n    subscribe: function (eventName, callback) {\r\n        $(this.container).bind(eventName, callback);\r\n    },\r\n     \r\n    subscribeEvent: function (eventName, callback) {\r\n        $(document).bind(eventName, callback);\r\n    },\r\n\r\n\r\n    /**\r\n    *   Subscribe to one time event that any controller could trigger\r\n    */\r\n    subscribeOneTime: function (eventName, callback) {\r\n        $(this.container).one(eventName, callback);\r\n    },\r\n\r\n    /**\r\n    *   Un Subscribe to an event that any controller could trigger in this document\r\n    */\r\n    unsubscribe: function (eventName, callback) {\r\n        if (callback) {\r\n            $(this.container).unbind(eventName, callback);\r\n        }\r\n        else { $(this.container).unbind(eventName); }\r\n    },\r\n\r\n    /**\r\n    *   Makes the base processing of the layout (mix templates + data)\r\n    *   after all that processing will call a post-render method to\r\n    *   be implemented in each device to apply custom plugins\r\n    *   Returns a promise because the rendering could be asynchronous\r\n    */\r\n    render: function () {        \r\n        bizagi.showMessageBox(\"controllers render\", \"Error\");\r\n\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // Render content\r\n        $.when(self.renderContent())\r\n        .done(function () {\r\n\r\n            // Call post-render method\r\n            self.postRender();\r\n\r\n            // Resolve deferred\r\n            defer.resolve(self.getContent());\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Returs the rendered content\r\n    */\r\n    getContent: function () {\r\n        return this.content;\r\n    },\r\n\r\n    /*\r\n    *   Returns the mapped resource\r\n    */\r\n    getResource: function (key, defaultValue) {\r\n        return this.resources.getResource(key, defaultValue);\r\n    },\r\n\r\n    /*\r\n    *   Renders the content for the current controller\r\n    *\r\n    */\r\n    renderContent: function () {\r\n        // Override on implementations\r\n        return \"\";\r\n    },\r\n\r\n    /*\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    postRender: function () { }\r\n\r\n    /*\r\n    *   Returns the component replaced tag selector\r\n    */\r\n \r\n\r\n});\r\n","/*\r\n*   Name: BizAgi Work Portal Service Context Factory\r\n*   Author: Diego Parra (based on Edward Morales version)\r\n*   Comments:\r\n*   -   This script will define the endpoints to be used based on the given context\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.context\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (params) {\r\n        this.context = params.context;\r\n        this.endPoints = bizagi.workportal.services.getEndPoints(params);\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n    },\r\n\r\n    /*\r\n    *   Returns the given url for a specified service\r\n    */\r\n    getUrl: function (service) {\r\n        if (typeof this.endPoints[service] === 'undefined') {\r\n            bizagi.log(\"Url not found\",\"No endpoint defined for: \" + service);\r\n        }\r\n        return this.endPoints[service];\r\n    },\r\n\r\n    setProxyPrefix: function (params) {\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n        this.endPoints = bizagi.workportal.services.getEndPoints(params);\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Services WorkPortal End Points\r\n*   Author: Diego Parra (based on Edward Morales version)\r\n*   Comments:\r\n*   -   This script defines all the end-points used to retrieve ajax stuff\r\n*   -   All urls must be relative to the base application\r\n*/\r\n\r\n// Create or define namespace\r\nbizagi.workportal = (typeof (bizagi.workportal) !== \"undefined\") ? bizagi.workportal : {};\r\nbizagi.workportal.services = (typeof (bizagi.workportal.services) !== \"undefined\") ? bizagi.workportal.services : {};\r\nbizagi.workportal.services.endPoints = [];\r\n\r\n// Creates a endpoint hash factory to resolve custom requirements\r\nbizagi.workportal.services.getEndPoints = function (params) {\r\n    // Default workportal end-points\r\n    if (params.context == \"workportal\") {\r\n        var endPoints = {\r\n            \"user-handler\": params.proxyPrefix + \"RestServices/UserHandler.ashx\",\r\n            \"process-handler\": params.proxyPrefix + \"RestServices/ProcessHandler.ashx\",\r\n            \"query-handler\": params.proxyPrefix + \"Rest/Handlers/Query\",\r\n            \"case-handler\": params.proxyPrefix + \"RestServices/CaseHandler.ashx\",\r\n            \"query-form\": params.proxyPrefix + \"App/ListaDetalle/QueryForm.aspx\",\r\n            \"query-form-edit\": params.proxyPrefix + \"App/ListaDetalle/SaveQuery.aspx\",\r\n            \"query-form-delete\": params.proxyPrefix + \"App/ListaDetalle/QueryForm.aspx\",\r\n            \"query-form-delete-cube\": params.proxyPrefix + \"Rest/Queries/Cubes/{idCube}\",\r\n            \"favorites-handler\": params.proxyPrefix + \"RestServices/FavoritesHandler.ashx\",\r\n            \"file-handler\": params.proxyPrefix + \"RestServices/EntityHandler.ashx\",\r\n            \"login-handler\": params.proxyPrefix + \"Rest/Users/UserAuthentication\",\r\n            \"login-handlerv10\": params.proxyPrefix + \"RestServices/UserHandler.ashx?action=authenticateUser&userName={0}&password={1}&domain={2}\",\r\n            \"logoff-handler\": params.proxyPrefix + \"RestServices/UserHandler.ashx?action=logOff\",\r\n            \"logoff-handlerv1\": params.proxyPrefix + \"Rest/Users/LogOff\",\r\n\r\n            // Rest Services\r\n            \"authorization-handler-getMenuAuthorization\": params.proxyPrefix + \"Rest/Authorization/MenuAuthorization\",\r\n            \"authorization-handler-isCaseCreationAuthorized\": params.proxyPrefix + \"Rest/Authorization/Processes/{0}/IsCaseCreationAuthorized\",\r\n            \"case-handler-getCaseSummary\": params.proxyPrefix + \"Rest/Cases/{idCase}/Summary\",\r\n\r\n            //ReleaseActivityResponse\r\n            \"case-handler-releaseActivity\": params.proxyPrefix + \"Rest/Cases/{idCase}/ReleaseActivity\",\r\n\r\n            //mobile beta services\r\n            \"case-handler-getCasesList\": params.proxyPrefix + \"Rest/Processes/SearchCases\",\r\n            \"case-handler-getActivityList\": params.proxyPrefix + \"Api/Cases/Activities\",\r\n        \r\n            // Services to Offline capability\r\n            \"offline-getProcessTree\": params.proxyPrefix + \"Rest/Processes/OfflineProcessTree\",\r\n\r\n            //\"offline-getForms\": params.proxyPrefix + \"Rest/Handlers/Render\",\r\n            \"offline-tasks\": params.proxyPrefix + \"Api/Cases/GetOfflineTasks\",\r\n            \"offline-getForms\": params.proxyPrefix + \"Rest/RenderForm/offlineForms\",\r\n            \"offline-sendForm\": params.proxyPrefix + \"Rest/Cases/SaveAsynchWorkItemOffLine\",\r\n\r\n            // StartProcess\r\n            \"case-handler-getCaseTasks\": params.proxyPrefix + \"Rest/Cases/{idCase}/Tasks\",\r\n            \"case-handler-getCaseEvents\": params.proxyPrefix + \"Rest/Cases/{idCase}/Events\",\r\n            \"case-handler-getCaseSubprocesses\": params.proxyPrefix + \"Rest/Cases/{idCase}/Subprocesses\",\r\n            \"case-handler-getTaskAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/Tasks/{idTask}/Assignees\",\r\n            \"case-handler-getCaseAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/Assignees\",\r\n            \"case-handler-getWorkItems\": params.proxyPrefix + \"Rest/Cases/{idCase}/WorkItems\",\r\n            \"case-handler-getAsynchExecutionState\": params.proxyPrefix + \"Rest/Cases/{idCase}/AsynchExecutionState\",\r\n            \"case-handler-addNewCase\": params.proxyPrefix + \"Rest/Cases\",\r\n            \"case-handler-startProcess\": params.proxyPrefix + \"Rest/Processes/StartProcess/{idProcess}\",\r\n            \"handler-execute-action-start\": params.proxyPrefix + \"Api/Cases/{processId}/Start\",\r\n            \"case-handler-supportedLogTypes\": params.proxyPrefix + \"Rest/Cases/SupportedLogsTypes\",\r\n            \"case-handler-getActivityLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/ActivityLog\",\r\n            \"case-handler-getActivityDetailLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/{idWorkItemFrom}/ActivityDetailLog\",\r\n            \"case-handler-getEntityLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/EntityLog\",\r\n            \"case-handler-getEntityDetailLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/EntityDetailLog\",\r\n            \"case-handler-getUserLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/UserLog\",\r\n            \"case-handler-getUserDetailLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/{idUser}/UserDetailLog\",\r\n            \"case-handler-getAdminLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/AdminLog\",\r\n            \"case-handler-getCaseFormsRenderVersion\": params.proxyPrefix + \"Rest/Cases/{idCase}/FormsRenderVersion\",\r\n            \"case-handler-validateHasStartForm\": params.proxyPrefix + \"Api/Processes/{processId}/StartContext\",\r\n\r\n            //Favorites Restful\r\n            \"favorites-handler-saveFavorite\": params.proxyPrefix + \"Rest/Favorites\",\r\n            \"favorites-handler-deleteFavorite\": params.proxyPrefix + \"Rest/Favorites/{guidFavorite}\",\r\n\r\n            //ICONS && IMAGES\r\n            \"process-getIcon\": params.proxyPrefix + \"Api/Processes/{processId}/Icon\",\r\n            \"collections-getIcon\": params.proxyPrefix + \"Api/CurrentUser/Collections/{collectionId}/Icon\",\r\n\r\n            //BAMAnalytics Restful\r\n            \"bamAnalytics-handler-getAnalisysQueries\": params.proxyPrefix + \"Rest/BAMAnalytics/AnalisysQueries\",\r\n            \"bamAnalytics-handler-updateQuery\": params.proxyPrefix + \"Rest/BAMAnalytics/Reports/Ids/{idQuery}\",\r\n\r\n            //Inbox Restful\r\n            \"inbox-handler-getInboxSummary\": params.proxyPrefix + \"Rest/Inbox/Summary\",\r\n\r\n            //Messages Restful\r\n            \"MessageHandler-NewComment\": params.proxyPrefix + \"Rest/Cases/Comments\",\r\n            \"MessageHandler-GetComments\": params.proxyPrefix + \"Rest/Cases/Comments\",\r\n            \"MessageHandler-SetCategoryToComment\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}\",\r\n            \"MessageHandler-RemoveComment\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}\",\r\n            \"MessageHandler-ReplyComment\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}/Replies\",\r\n            \"MessageHandler-RemoveReply\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}/Replies/{idReply}\",\r\n            \"MessageHandler-GetCategoryColors\": params.proxyPrefix + \"Rest/Cases/Comments/CategoryColors\",\r\n            \"MessageHandler-RenameCategoryColor\": params.proxyPrefix + \"Rest/Cases/Comments/CategoryColors/{idColorCategory}\",\r\n            \"MessageHandler-CountNewComments\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}/NewComments/Count\",\r\n\r\n            //Processes Restful\r\n            \"process-handler-getAllProcesses\": params.proxyPrefix + \"Rest/Processes\",\r\n            \"process-handler-getFavourites\": params.proxyPrefix + \"Rest/Home/MyFavorites/Count\",\r\n            \"process-handler-getFavouriteCases\": params.proxyPrefix + \"Rest/Home/MyFavorites\",\r\n            \"process-handler-getCustomizedColumnsData\": params.proxyPrefix + \"Rest/Processes/CustomizedColumnsData\",\r\n            \"process-handler-getCategory\": params.proxyPrefix + \"Rest/Processes/Categories\",\r\n            \"process-handler-getRecentProcesses\": params.proxyPrefix + \"Rest/Processes/RecentProcesses\",\r\n            \"process-handler-getCustomizedColumnsDataInfo\": params.proxyPrefix + \"Rest/Processes/CustomizedColumnsDataInfo\",\r\n            \"process-handler-getOrganizations\": params.proxyPrefix + \"Rest/Profile/Organizations\",                                              \r\n\r\n            //workportal\r\n            \"process-handler-getMyStuff\": params.proxyPrefix + \"Api/CurrentUser/Collections\",\r\n            \"process-handler-getIdCasesOfProcessEntities\": params.proxyPrefix + \"Api/Entities/Cases\",\r\n\t        \"templates-handler-getCollectionData\": params.proxyPrefix + \"Api/Collection/{idFact}/Data\",\r\n            //\"data-navigation-handler\": params.proxyPrefix + \"Api/Entities/{guidLeftEntity}/Data/{surrogateKeyLeftEntity}\",\r\n            \"data-navigation-handler-collection\": params.proxyPrefix + \"Api/CurrentUser/Collections/{reference}/Data/{surrogateKey}\",\r\n            \"data-navigation-handler-entity\": params.proxyPrefix + \"Api/CurrentUser/Entities/{reference}/Data/{surrogateKey}/{xpath}\",\r\n            \"data-navigation-handler-entity-filters\": params.proxyPrefix + \"Api/CurrentUser/Entities/{reference}/Filters/{surrogateKey}/{xpath}\",\r\n\r\n            //\"action-handler-getProcessAddAction\": params.proxyPrefix + \"Api/Entities/{guidLeftEntity}/Collection/{guidFact}/Actions\",\r\n            \"action-handler-getProcessAddAction\": params.proxyPrefix + \"Api/CurrentUser/Collections/{reference}/{surrogateKey}/Actions\",\r\n\r\n            //My Searches\r\n            'my-search-getSearchLists': params.proxyPrefix + \"Api/CurrentUser/Searches\",\r\n            'my-search-getFilters': params.proxyPrefix + \"Api/CurrentUser/Searches/{guidSearch}/Filters\",\r\n            'my-search-getFiltersData': params.proxyPrefix + \"Api/CurrentUser/Searches/{guidSearch}/FilterData\",\r\n            'my-search-getData': params.proxyPrefix + \"Api/CurrentUser/Searches/{guidSearch}/Data\",\r\n\r\n            \"templates-handler-getVirtualCollectionData\" : params.proxyPrefix + \"Api/Collection/{guidVirtualCollection}/VirtualData\",\r\n            \"templates-handler-getMultipleActions\" : params.proxyPrefix + \"Rest/Entities/multipleInstancesActions\",\r\n            \r\n            \"process-handler-getMapping\" : params.proxyPrefix + \"Rest/Entities/Mapping\",\r\n            \"process-handler-getForm\" : params.proxyPrefix + \"Rest/Handlers/Render\",\r\n            \"process-handler-startform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            //\"process-handler-rule\": params.proxyPrefix + \"Rest/Action/Rule\",\r\n            \"process-handler-rule\": params.proxyPrefix + \"Api/Rules/{ruleId}/Execute\",\r\n            //\"process-action-execute\" : params.proxyPrefix + \"Api/Action/Execute\",\r\n            \"process-action-execute\": params.proxyPrefix + \"Api/Rules/{ruleId}/ExecuteMultiple\",\r\n            \"process-handler-getActivitiesData\": params.proxyPrefix + \"Api/Processes/CasesData/MyActivities\",\r\n            \"process-handler-getPendingsData\": params.proxyPrefix + \"Api/Processes/CasesData/MyPendings\",\r\n            \r\n            //\"entities-handler-getActions\" : params.proxyPrefix + \"Rest/Entities/Actions\",\r\n            \"entities-handler-getActions\": params.proxyPrefix + \"Api/Entities/{guidEntity}/{surrogateKey}/actions\",\r\n            \"entities-handler-getUsersAndEvents\" : params.proxyPrefix + \"Rest/Processes/CasesData/UsersAndEvents\",\r\n            \"entities-handler-getUsers\" : params.proxyPrefix + \"Api/Cases/{caseId}/Users\",\r\n            \"entities-handler-getEvents\" : params.proxyPrefix + \"Api/Cases/{caseId}/CurrentEvents\",\r\n            \"entities-handler-getUsersImages\" : params.proxyPrefix + \"Rest/Users/UserPictures\",\r\n            \"entities-handler-getShotCuts\" : params.proxyPrefix + \"Api/CurrentUser/Shortcuts\",\r\n            \r\n            //Queries Restful\r\n            \"query-handler-getqueries\": params.proxyPrefix + \"Rest/Queries\",\r\n            \"query-handler-getQueryForm\": params.proxyPrefix + \"Rest/Handlers/Render\",\r\n\r\n            //Users Restful\r\n            \"user-handler-getCurrentUser\": params.proxyPrefix + \"Rest/Users/CurrentUser\",\r\n\r\n            // Old render integration, readonly\r\n            \"old-render\": params.proxyPrefix + \"App/ListaDetalle/Detalle.aspx\",\r\n\r\n            //Service locator for reports\r\n            \"Reports\": params.proxyPrefix + \"RestServices/BAMAnalyticsHandler.ashx\",\r\n            \"reports-handler-deleteQueries\": params.proxyPrefix + \"Rest/BAMAnalytics/Reports/{QueryId}\",\r\n\r\n            //Service locator for bizagi folders\r\n            \"folders-handler-getUserQueries\": params.proxyPrefix + \"Rest/SmartFolders\",\r\n            \"folders-associate-deleteSmartFolder\": params.proxyPrefix + \"Rest/SmartFolders/{idSmartFolder}\",\r\n            \"folders-handler\": params.proxyPrefix + \"RestServices/SmartFoldersHandler.ashx\",\r\n            \"folders-associate\": params.proxyPrefix + \"App/Ajax/AJAXGateway.aspx\",\r\n            \"smartfolders-integration\": params.proxyPrefix + \"App/WorkPortal/ConfigureFilteredFolder.aspx\",\r\n\r\n            //Service locator for menu\r\n            \"AlarmAdmin\": params.proxyPrefix + \"App/Admin/AlarmsAdmin.aspx\",\r\n            \"AnalyticsProcess\": params.proxyPrefix + \"App/Cockpit/AnalyticsProcess.aspx\",\r\n            \"AnalyticsSensor\": params.proxyPrefix + \"App/Cockpit/AnalyticsSensor.aspx\",\r\n            \"AnalyticsTask\": params.proxyPrefix + \"App/Cockpit/AnalyticsTask.aspx\",\r\n            \"AsynchronousWorkitemRetries\": params.proxyPrefix + \"App/Admin/AsynchDisabledWorkitems.aspx\",\r\n            \"AuthenticationLogQuery\": params.proxyPrefix + \"App/Admin/AuthLogQuery.aspx\",\r\n            \"BAMProcess\": params.proxyPrefix + \"App/Cockpit/BAMProcess.aspx\",\r\n            \"BAMTask\": params.proxyPrefix + \"App/Cockpit/BAMTask.aspx\",\r\n            \"BusinessPolicies\": params.proxyPrefix + \"App/Admin/BusinessPolicies/BusinessPoliciesSelector.aspx\",\r\n            \"CaseAdmin\": params.proxyPrefix + \"App/Admin/CaseSearch.aspx\",\r\n            \"adminReassignCases\": \"CaseAdmin\", // Open workportal module called 'adminCases'\r\n            \"asyncECMUpload\": \"asyncECMUpload\", // Open workportal module called 'asyncECMUpload'\r\n            \"CasesMonitor\": params.proxyPrefix + \"App/Admin/CasesMonitor.aspx\",\r\n            \"Closed\": params.proxyPrefix + \"App/ListaDetalle/listaitems.aspx?h_Location=Cerrados&I_ProcessState=Completed\",\r\n            \"CurrentUser\": params.proxyPrefix + \"App/Admin/CurrentUser.aspx\",\r\n            \"EncryptionAdmin\": params.proxyPrefix + \"App/Admin/Encrypt.aspx\",\r\n            \"MobileUpdatesAdmin\": params.proxyPrefix + \"App/MobileUpdates/default.aspx\",\r\n            \"EntityAdmin\": params.proxyPrefix + \"App/Admin/Entity.aspx\",\r\n            \"LocationResources\": params.proxyPrefix + \"App/Admin/AdminLocResources.aspx\",\r\n            \"NewCase\": params.proxyPrefix + \"App/Radicar/application.aspx\",\r\n            \"Pending\": params.proxyPrefix + \"App/ListaDetalle/listaitems.aspx?h_Location=Pendientes&I_processState=Running\",\r\n            \"Profiles\": params.proxyPrefix + \"App/Admin/ProfilesAdminSearch.aspx\",\r\n            \"Search\": params.proxyPrefix + \"App/ListaDetalle/Search.aspx\",\r\n            \"UserAdmin\": params.proxyPrefix + \"App/Admin/ListUsers.aspx\",\r\n            \"UserDefaultAssignation\": params.proxyPrefix + \"App/Admin/DefaultAssignationUser.aspx?h_AdminDefaultAssign=1\",\r\n            \"UserPendingRequests\": params.proxyPrefix + \"App/Admin/UserPendingRequests.aspx\",\r\n            \"ListPreferences\": (bizagi.UserPreferencesUrl !== \"\") ? params.proxyPrefix + bizagi.UserPreferencesUrl : params.proxyPrefix + \"App/Admin/CurrentUser.aspx\",\r\n            \"GRDimensionAdmin\": params.proxyPrefix + \"App/Cockpit/DimensionEdit.aspx\",\r\n            \"Licenses\": params.proxyPrefix + \"App/Admin/Licenses.aspx\",\r\n            \"AnalysisQueries\": params.proxyPrefix + \"App/Inicio/WPAnalysisQuery.aspx\",\r\n            \"DocumentTemplates\": params.proxyPrefix + \"App/Admin/AdminDocumentTemplates.aspx\",\r\n            \"ProcessAdmin\": params.proxyPrefix + \"App/Admin/AdminProcess.aspx\",\r\n            \"ResourceBAM\": params.proxyPrefix + \"App/Cockpit/BAMResourceMonitor.aspx\",\r\n            \"WorkPortalVersion\": params.proxyPrefix + \"Rest/Util/Version\",\r\n\r\n            // entities administration\r\n            \"entities-administration\": \"RestServices/EntityHandler.ashx\",\r\n\r\n            //Theme Rest Service Handler\r\n            \"theme-handler-getLogoImagePath\": params.proxyPrefix + \"Rest/Theme/LogoImage\",\r\n\r\n            // Logout Service, already implemented on java environment\r\n            \"logout\": params.proxyPrefix + \"Rest/Authentication/logout\",\r\n            \"logoutDotNet\": params.proxyPrefix + \"App/Inicio/LogOff.aspx\",            \r\n            \"authenticationConfig\": params.proxyPrefix + \"Api/Authentication/BizagiConfig\",\r\n            \"logout-oauth2\": params.proxyPrefix + \"Api/Authentication/OAuth2/IdentityProvider/Server/Logout\",\r\n            \"FederateLogoffUrl\": params.proxyPrefix + \"Api/Authentication/FederateLogoffUrl\",\r\n            \"oauth2AuthenticationConfig\": params.proxyPrefix + \"Api/Authentication/OAuth2/OAuth2AuthenticationConfig\",\r\n\r\n            //Massive Activity Asigments\r\n            \"massive-activity-assignments-getOrganizationInfo\": params.proxyPrefix + \"Rest/Users/OrganizationInfo\",\r\n            \"massive-activity-assignments-getCasesByOrganization\": params.proxyPrefix + \"Rest/Queries/GetCasesByOrganization\",\r\n            \"massive-activity-assignments-reassignCases\": params.proxyPrefix + \"Rest/Cases/ReassignCases\",\r\n            \"massive-activity-assignments-searchUsers\": params.proxyPrefix + \"Rest/Users/\",\r\n\r\n            //Asynchronous ECM Upload\r\n            \"async-ecm-upload-baseService\": params.proxyPrefix + \"Rest/Handlers/Metadata\",\r\n\r\n            // Workportal\r\n            \"domains\": params.proxyPrefix + \"Rest/Authentication/Domains\",\r\n\r\n            // Theme Builder\r\n            //\"ThemeBuilder\": params.proxyPrefix + \"ThemeBuilder/index.html?language=\" + bizagi.localization.language,\r\n            \"getCurrentTheme\": params.proxyPrefix + \"Api/Theme/Current\",\r\n\r\n            //Frankenstein\r\n            \"admin-getAuthenticationLog\": params.proxyPrefix + \"Rest/Users/AuthLog\",\r\n            \"admin-getAuthenticationDomains\": params.proxyPrefix + \"Rest/Users/Domains\",\r\n            \"admin-getAuthenticationEventsTypes\": params.proxyPrefix + \"Rest/Users/EventTypes\",\r\n            \"admin-getAuthenticationEventSubTypes\": params.proxyPrefix + \"Rest/Users/EventSubTypes\",\r\n            \"admin-EncryptString\": params.proxyPrefix + \"Rest/Util/EncryptString\",\r\n            \"admin-UserPendingRequests\": params.proxyPrefix + \"Rest/Users/UserPendingRequests\",\r\n            \"admin-UserAuthenticationInfo\": params.proxyPrefix + \"Rest/Users/UserAuthenticationInfo\",\r\n            \"admin-updateUserAuthenticationInfo\": params.proxyPrefix + \"Rest/Users/UpdateUserAuthenticationInfo\",\r\n            \"admin-generateRandomPassword\": params.proxyPrefix + \"Rest/Util/GenerateRandomPassword\",\r\n            \"admin-GenerateDataToSendByEmail\": params.proxyPrefix + \"Rest/Users/GenerateDataToSendByEmail\",\r\n            \"admin-sendEmail\": params.proxyPrefix + \"Rest/Util/SendEmail/\",\r\n            \"admin-getApplicationList\": params.proxyPrefix + \"Rest/Application\",\r\n            \"admin-getApplicationProcesses\": params.proxyPrefix + \"Rest/Application/{idApp}/Process\",\r\n            \"admin-getProcessVersion\": params.proxyPrefix + \"Rest/Processes/Version\",\r\n            \"admin-getProcessTasks\": params.proxyPrefix + \"Rest/Processes/Version/{version}/Tasks\",\r\n\r\n            //servicios alarmas\r\n            \"admin-getTaskAlarms\": params.proxyPrefix + \"Rest/Alarm/TaskAlarms\",\r\n            \"admin-getLapseMode\": params.proxyPrefix + \"Rest/Alarm/LapseMode\",\r\n            \"admin-getRecurrMode\": params.proxyPrefix + \"Rest/Alarm/RecurrMode\",\r\n            \"admin-getScheduleType\": params.proxyPrefix + \"Rest/Alarm/ScheduleType\",\r\n            \"admin-getBossList\": params.proxyPrefix + \"Rest/Alarm/Boss\",\r\n            \"admin-addAlarm\": params.proxyPrefix + \"Rest/Alarm\",\r\n            \"admin-editAlarm\": params.proxyPrefix + \"Rest/Alarm/{idAlarm}\",\r\n            \"admin-deleteAlarm\": params.proxyPrefix + \"Rest/Alarm\",\r\n            \"admin-alarmRecipients\": params.proxyPrefix + \"Rest/Alarm/{idAlarm}/Recipient\",\r\n            \"admin-deleteAlarmRecipients\": params.proxyPrefix + \"Rest/Alarm/Recipient\",\r\n            \"admin-recipientToAlarm\": params.proxyPrefix + \"Rest/Alarm/{idAlarm}/Recipient/{idRecipient}\",\r\n            \"admin-enableAlarm\": params.proxyPrefix + \"Rest/Alarm/Task/{idTask}/ToggleAlarm\",\r\n            \"admin-getCategoriesList\": params.proxyPrefix + \"Rest/Application/Category\",\r\n            \"admin-getCasesList\": params.proxyPrefix + \"Rest/Queries/SearchCases\",\r\n            \"admin-abortItems\": params.proxyPrefix + \"Rest/Cases/Abort\",\r\n            \"admin-reassignItems\": params.proxyPrefix + \"Rest/Cases/Reassign\",\r\n            \"admin-getDefaultAssignationUserToAllProcess\": params.proxyPrefix + \"Rest/Users/{serviceAction}/\",\r\n            \"admin-getDefaultAssignationUserToProcess\": params.proxyPrefix + \"Rest/Users/Process/{process}/AssignationUser\",\r\n            \"admin-setDefaultAssignationUserToProcess\": params.proxyPrefix + \"Rest/Users/Process/{process}/AssignationUser\",\r\n            \"admin-getProfilesTypes\": params.proxyPrefix + \"Rest/Profile/Types\",\r\n            \"admin-searchProfiles\": params.proxyPrefix + \"Rest/Profile\",\r\n            \"admin-getUsersByProfile\": params.proxyPrefix + \"Rest/Users/Profile/{type}/{id}\",\r\n            \"admin-removeUserFromProfile\": params.proxyPrefix + \"Rest/Profile/{type}/{id}/User/{idUser}/\",\r\n            \"admin-addUserToProfile\": params.proxyPrefix + \"Rest/Profile/{type}/{id}/User/{idUser}/\",\r\n            \"admin-async-activities-get-activities\": params.proxyPrefix + \"Rest/Cases/Asynchronous/Activities\",\r\n            \"admin-async-activities-get-retry-now\": params.proxyPrefix + \"Rest/Cases/{idCase}/Workitem/{idworkItem}/RetryNow\",\r\n            \"admin-async-activities-get-activities-by-task\": params.proxyPrefix + \"Rest/Cases/Asynchronous/Activities/Task\",\r\n            \"admin-async-activities-enable-execution\": params.proxyPrefix + \"Rest/Cases/Asynchronous/Enable\",\r\n            \"admin-async-activities-enable-multiple\": params.proxyPrefix + \"Rest/Cases/Asynchronous/EnableMultiple\",\r\n            \"admin-async-activities-async-execution\": params.proxyPrefix + \"Rest/Cases/{idCase}/Workitem/{idWorkitem}/AsynchExecution\",\r\n            \"admin-async-activities-async-execution-log\": params.proxyPrefix + \"Rest/Cases/{idCase}/Workitem/{idworkItem}/AsynchExecutionLog\",\r\n            \"admin-Licenses\": params.proxyPrefix + \"Rest/Licenses\",\r\n            \"admin-GetDimensions\": params.proxyPrefix + \"Rest/Dimensions\",\r\n            \"admin-EditDimension\": params.proxyPrefix + \"Rest/Dimensions/{id}\",\r\n            \"admin-CreateAdministrableDimension\": params.proxyPrefix + \"Rest/Dimensions/Administrable\",\r\n            \"admin-DeleteDimension\": params.proxyPrefix + \"Rest/Dimensions/{id}?isAdministrable={administrable}\",\r\n            \"admin-EntityPathChildNodesAction\": params.proxyPrefix + \"Rest/Dimensions/EntityChildNodes\",\r\n            \"admin-GetActiveWFClasses\": params.proxyPrefix + \"Rest/Dimensions/ActiveProcess\",\r\n            \"admin-document-templates-storeDocumentTemplates\": params.proxyPrefix + \"Rest/DocumentTemplates/StoreDocumentTemplates\",\r\n            \"admin-document-templates-restoreDocumentTemplates\": params.proxyPrefix + \"Rest/DocumentTemplates/RestoreDocumentTemplate\",\r\n            \"admin-document-templates-uploadDocumentTemplate\": params.proxyPrefix + \"Rest/DocumentTemplates/UploadDocumentTemplate\",\r\n            \"admin-processes-workflowClasses\": params.proxyPrefix + \"Rest/Processes/WorkflowClasses\",\r\n            \"admin-processes-tasksByWorkflow\": params.proxyPrefix + \"Rest/Processes/TasksByWorkflow\",\r\n            \"admin-processes-modifyProcessDuration\": params.proxyPrefix + \"Rest/Processes/{idWorkflow}/Duration/\",\r\n            \"admin-processes-modifyTaskDuration\": params.proxyPrefix + \"Rest/Processes/Task/{idTask}/Duration/\",\r\n            \"admin-language-resource\": params.proxyPrefix + \"Rest/Multilanguage/Resource\",\r\n            \"admin-language-languages\": params.proxyPrefix + \"Rest/Multilanguage/Languages\",\r\n            \"bam-resourcemonitor-myteam\": params.proxyPrefix + \"Rest/Reports/BAM/Resources/MyTeam\",\r\n            \"reports-analysisquery\": params.proxyPrefix + \"Rest/Reports/AnalysisQueries\",\r\n            \"reports-analysisquery-update\": params.proxyPrefix + \"Rest/Reports/AnalysisQueries\",\r\n            \"reports-analysisquery-delete\": params.proxyPrefix + \"Rest/Reports/AnalysisQueries\",\r\n            \"processviewer-processdefinition\": params.proxyPrefix + \"Rest/Reports/Components/ProcessDefinition\",\r\n            \"processviewer-processgraphicinfo\": params.proxyPrefix + \"Rest/Reports/Components/ProcessGraphicInfo\",\r\n            \r\n             // Mobile Updates\r\n            \"mobile-getLastUpdate\": params.proxyPrefix + \"Rest/Util/mobileUpdates\",\r\n\r\n            //discussionCase\r\n            \"discussion-case\": params.proxyPrefix + \"Api/CaseResource/Discussion?globalParent={globalParent}\",\r\n            \"discussion-case-v1\": params.proxyPrefix + \"Api/CaseResource/{globalParent}/Discussion\",\r\n            \"get-users\": params.proxyPrefix + \"Rest/Users/UserPictures\",\r\n            \"new-discussion\": params.proxyPrefix + \"Api/CaseResource/Discussion\",\r\n            \"count-comments\": params.proxyPrefix + \"Api/CaseResource/{idParent}/Comment/Count\",\r\n            \"comment-case\": params.proxyPrefix + \"Api/CaseResource/{idParent}/Comment\",\r\n            \"new-comment\": params.proxyPrefix + \"Api/CaseResource/Comment\",\r\n            \"new-comment-attach\": params.proxyPrefix + \"Api/CaseResource/Attachment\",\r\n            \"get-list-files\": params.proxyPrefix + \"Api/CaseResource/File?globalParent={globalParent}\",\r\n            \"get-list-files-v1\": params.proxyPrefix + \"Api/CaseResource/{globalParent}/File\",\r\n            \"project-resource-action\": params.proxyPrefix + \"Api/CaseResource/{typeResource}\",\r\n            \"thumbnail-file\": params.proxyPrefix + \"Api/CaseResource/File/Thumbnails\",\r\n            \"get-attachment\": params.proxyPrefix + \"Api/CaseResource/Attachment/{idAttachment}\",\r\n            \"get-mobile-attachment\": params.proxyPrefix + \"Api/CaseResource/Mobile/Attachment/{idAttachment}\",\r\n\r\n            //Files and Attachments\r\n            \"project-files-upload\": params.proxyPrefix + \"Api/CaseResource/File\",\r\n            \"count-files\": params.proxyPrefix + \"Api/CaseResource/File/Count?globalParent={globalParent}\",\r\n            \"count-files-v1\": params.proxyPrefix + \"Api/CaseResource/{globalParent}/File/Count\",\r\n            \"remove-comment\": params.proxyPrefix + \"Api/CaseResource/Comment\",\r\n\r\n            //Mobile CaseSummary\r\n            \"time-schemas-effectiveduration\": params.proxyPrefix + \"Api/WorkingTimeSchema/EffectiveDuration?idUser={idUser}&fromDate={fromDate}&toDate={toDate}\",\r\n            \"case-handler-getCaseAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/Assignees\",\r\n            \"project-users-get\": params.proxyPrefix + \"Rest/Users/UserPictures\",\r\n            \"case-summary-task-options\": params.proxyPrefix + \"Rest/Cases/WorkItems/{idWorkitem}/TaskOptions\",\r\n            //Mobile plans\r\n            \"project-plan-get\": params.proxyPrefix + \"Api/Plans/{idPlan}\",\r\n            \"project-plan-activities\": params.proxyPrefix + \"Api/Plans/{idPlan}/Activities\",\r\n            \"project-plan-workitems\": params.proxyPrefix + \"Api/Plans/{idPlan}/WorkItems\",\r\n            \"project-plan-transitions-get\": params.proxyPrefix + \"Api/Plans/{idPlan}/Activities/Transitions\",\r\n            \"project-plan-activity-edit\": params.proxyPrefix + \"Api/Plans/{idPlan}/Activities/{id}\",\r\n            \"project-plan-get-by-parent\": params.proxyPrefix + \"Api/Plans?parentWorkItem={parentWorkItem}\",\r\n            \"project-plan-parent\": params.proxyPrefix + \"Api/Plans/{idPlan}/ParentCase\",\r\n            \"project-plan-update\": params.proxyPrefix + \"Api/Plans/{idPlan}\",\r\n            \"project-plan-execute\": params.proxyPrefix + \"Api/Plans/Execute\",\r\n            \"project-plan-close\": params.proxyPrefix + \"Api/Plans/Close\",\r\n            \"project-plan-delete\": params.proxyPrefix + \"Api/Plans/{idPlan}\",\r\n            \"project-plan-first-parent-plan\": params.proxyPrefix + \"Api/Plans/{idPlan}/FirstParentPlan\"\r\n        };\r\n\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n\r\n            endPoints[\"user-handler-getCurrentUser\"] = params.proxyPrefix + \"Rest/Users/CurrentUserGuid\";\r\n            endPoints[\"get-users\"] = params.proxyPrefix + \"Rest/Users/UserPicturesGuid\";\r\n            endPoints[\"entities-handler-getUsersImages\"] = params.proxyPrefix + \"Rest/Users/UserPicturesGuid\";\r\n            endPoints[\"project-users-get\"] = params.proxyPrefix + \"Rest/Users/UserPicturesGuid\";\r\n            \r\n            endPoints[\"entities-handler-getUsers\"] = params.proxyPrefix + \"Api/Cases/{caseId}/UsersGuid\";\r\n            //endPoints[\"case-handler-getWorkItems\"] = params.proxyPrefix + \"Rest/Cases/{idCase}/WorkItemsGuid\";\r\n            endPoints[\"case-handler-getCaseSummary\"] = params.proxyPrefix + \"Rest/Cases/{idCase}/SummaryGuid\";\r\n            endPoints[\"case-handler-getCaseAssignees\"] = params.proxyPrefix + \"Rest/Cases/{idCase}/AssigneesGuid\";\r\n\r\n            endPoints[\"discussion-case\"] = params.proxyPrefix + \"Api/CaseResource/DiscussionGuid?globalParent={globalParent}\";\r\n            //endPoints[\"discussion-case-v1\"] = params.proxyPrefix + \"Api/CaseResource/{globalParent}/DiscussionGuid\";\r\n            endPoints[\"new-discussion\"] = params.proxyPrefix + \"Api/CaseResource/DiscussionGuid\";\r\n            \r\n            endPoints[\"comment-case\"] = params.proxyPrefix + \"Api/CaseResource/{idParent}/CommentGuid\";\r\n            endPoints[\"new-comment\"] = params.proxyPrefix + \"Api/CaseResource/CommentGuid\";\r\n\r\n            endPoints[\"project-files-upload\"] = params.proxyPrefix + \"Api/CaseResource/FileGuid\";\r\n            endPoints[\"get-list-files\"] = params.proxyPrefix + \"Api/CaseResource/FileGuid?globalParent={globalParent}\";\r\n      \r\n            //Mobile case summary\r\n            endPoints[\"time-schemas-effectiveduration\"] = params.proxyPrefix + \"Api/WorkingTimeSchema/EffectiveDurationGuid?idUser={idUser}&fromDate={fromDate}&toDate={toDate}\";\r\n            //Mobile plans\r\n            endPoints[\"project-plan-get\"] = params.proxyPrefix + \"Api/Plans/Guid/{idPlan}\";\r\n            endPoints[\"project-plan-update\"] = params.proxyPrefix + \"Api/Plans/Guid/{idPlan}\";\r\n            endPoints[\"project-plan-activities\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/ActivitiesGuid\";\r\n            endPoints[\"project-plan-workitems\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/WorkItemsGuid\";\r\n            endPoints[\"project-plan-first-parent-plan\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/FirstParentPlanGuid\";\r\n            endPoints[\"project-plan-activity-edit\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/ActivitiesGuid/{id}\";      \r\n        }\r\n\r\n        return endPoints;\r\n    }\r\n    return {};\r\n};","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra (based on Edward Morales version)\r\n *   Comments:\r\n *   -   This class will provide a facade to access to workportal REST services\r\n */\r\n\r\n$.Class.extend(\"bizagi.workportal.services.service\", {\r\n    // Statics\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    ENTITIES_QUERY_PAGE_SIZE: 10\r\n}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (params) {\r\n        var self = this;\r\n        params = typeof (params) == \"object\" ? params : {};\r\n        params.context = !bizagi.util.isEmpty(params.context) ? params.context : \"workportal\";\r\n\r\n        params.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n        params.proxyPrefix = this.normalizeUrl(params.proxyPrefix);\r\n        bizagi.RPproxyPrefix = params.proxyPrefix;\r\n\r\n\r\n        params.sharepointProxyPrefix = !bizagi.util.isEmpty(params.sharepointProxyPrefix) ? params.sharepointProxyPrefix : \"\";\r\n        params.sharepointProxyPrefix = this.normalizeUrl(params.sharepointProxyPrefix);\r\n\r\n        this.serviceLocator = new bizagi.workportal.services.context(params);\r\n\r\n        // Define default value of number of records to show\r\n        this.pageSize = 10;\r\n\r\n        this.deviceType = params.deviceType || (bizagi.util.isSmartphoneDevice() ? bizagi.deviceEnum.smartphone: (bizagi.util.isTabletDevice() ? bizagi.deviceEnum.tablet: bizagi.deviceEnum.desktop));\r\n        this.deviceCode = bizagi.util.getDeviceCode();\r\n\r\n        // Get override for pageSize, use BIZAGI_INBOX_ROWS_PER_PAGE constant within config file\r\n        if (typeof BIZAGI_INBOX_ROWS_PER_PAGE !== \"undefined\") {\r\n            this.pageSize = ($.isNumeric(BIZAGI_INBOX_ROWS_PER_PAGE)) ? BIZAGI_INBOX_ROWS_PER_PAGE : this.pageSize;\r\n        }\r\n    },\r\n    /**\r\n     * This method will return the url defined as endPoint using the parameter 'endPoint' name\r\n     */\r\n    getUrl: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(params.endPoint);\r\n        return url;\r\n    },\r\n    /**\r\n     * This method will return the url normalized\r\n     */\r\n    normalizeUrl: function (url) {\r\n        if (url !== \"\") {\r\n            if (url[url.length - 1] != \"/\") {\r\n                url = url.concat(\"/\");\r\n            }\r\n\r\n            if (url.indexOf(\"http://\") == -1 && url.indexOf(\"https://\") == -1) {\r\n                url = \"http://\" + url;\r\n            }\r\n        }\r\n        return url;\r\n    },\r\n\r\n    /**\r\n     * This service get all overrides keys within configuration project\r\n     *\r\n     * @return {json}\r\n     */\r\n    getOverrides: function () {\r\n        var self = this;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"overrides\")\r\n        }).pipe(function (overrides) {\r\n            overrides = overrides || {};\r\n\r\n            $.each(overrides, function (key, value) {\r\n                var valueUppercase = value.toUpperCase();\r\n                if (valueUppercase == \"TRUE\" || valueUppercase == \"FALSE\") {\r\n                    overrides[key] = bizagi.util.parseBoolean(value);\r\n                }\r\n            });\r\n\r\n            return overrides;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * This service get json of theme definition\r\n     *@return {json} theme definition\r\n     */\r\n    getCurrentTheme: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('getCurrentTheme');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /**\r\n     * This method will return the response of the user information login is correct\r\n     * this method is use for native smartphone\r\n     **/\r\n    authenticatedUser: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl(\"login-handler\");\r\n\r\n        return $.read({\r\n            url: urlSend,\r\n            data: {\r\n                \"userName\": BIZAGI_USER,\r\n                \"password\": BIZAGI_PASSWORD,\r\n                \"domain\": BIZAGI_DOMAIN\r\n            }\r\n        }).pipe(\r\n            function (response) {\r\n                return response;\r\n            },\r\n            function (data) {\r\n                urlSend = self.serviceLocator.getUrl('login-handlerv10');\r\n                urlSend = urlSend.replace('{0}', BIZAGI_USER || '');\r\n                urlSend = urlSend.replace('{1}', BIZAGI_PASSWORD || '');\r\n                urlSend = urlSend.replace('{2}', BIZAGI_DOMAIN || '');\r\n                return $.ajax({\r\n                    url: urlSend,\r\n                    type: 'GET',\r\n                    dataType: 'json'\r\n                });\r\n            }\r\n        );\r\n    },\r\n\r\n    /**\r\n     *\r\n     * this method is use for native smartphone\r\n     **/\r\n    logoutUser: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl('logoff-handlerv1');\r\n        return $.read({\r\n            url: urlSend\r\n        });\r\n    },\r\n    /*\r\n     *   Logoff the current user\r\n     */\r\n    logOffUser: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl(\"logoff-handler\");\r\n        return $.read({\r\n            url: urlSend\r\n        });\r\n    },\r\n    /*\r\n     *   Gets the current working user\r\n     */\r\n    getCurrentUser: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl(\"user-handler-getCurrentUser\"));\r\n    },\r\n    /*\r\n     *   Gets the inbox summary for the current logged user\r\n     *   Returns a promise of the data being retrieved\r\n     */\r\n    getInboxSummary: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl(\"inbox-handler-getInboxSummary\"))\r\n            .pipe(function (response) {\r\n                // Extract inboxSummary property\r\n                return response[\"inboxSummary\"];\r\n            });\r\n    },\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getAllProcesses: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl('process-handler-getAllProcesses');\r\n\r\n        if (params.taskState != undefined) {\r\n            data['taskState'] = params.taskState;\r\n        }\r\n\r\n        if (params.onlyFavorites != undefined && params.onlyFavorites != '') {\r\n            data['onlyFavorites'] = params.onlyFavorites;\r\n        }\r\n\r\n        if (params.myActivities != undefined && params.myActivities != \"\") {\r\n            data[\"myActivities\"] = params.myActivities;\r\n        }\r\n\r\n        if (params.myPendings != undefined && params.myPendings != \"\") {\r\n            data[\"myPendings\"] = params.myPendings;\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            url = url + '?' + params.smartfoldersParameters;\r\n        }\r\n\r\n        if (bizagi.isMobile()) {\r\n            data['mobileDevice'] = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                // !! (double Not) (bang bang) <-- For Boolean Type Casting http://jibbering.com/faq/notes/type-conversion/#tcBool\r\n                if (!!params.skipAggrupate)\r\n                    return response;\r\n                // Aggrupate workflows by categories\r\n                var responseData = {};\r\n                var categories = {};\r\n                var allProcesses = bizagi.localization.getResource('workportal-widget-inbox-all-processes');\r\n                var allCases = {\r\n                    name: bizagi.localization.getResource('workportal-widget-inbox-all-cases'),\r\n                    path: '',\r\n                    category: allProcesses,\r\n                    isFavorite: (params.onlyFavorites || false),\r\n                    guidFavorite: '',\r\n                    idworkflow: '',\r\n                    guidWFClass: '',\r\n                    count: 0\r\n                };\r\n\r\n                // Create a default category\r\n                categories[allProcesses] = [];\r\n                categories[allProcesses].workflows = [];\r\n                categories[allProcesses].workflows.push(allCases);\r\n                if (response.workflows) {\r\n                    $.each(response.workflows.workflow, function (i, workflow) {\r\n                        // Creates the category if it doesn't exist\r\n                        if (!categories[workflow.category]) {\r\n                            categories[workflow.category] = [];\r\n                            categories[workflow.category].workflows = [];\r\n                        }\r\n\r\n                        // Push the workflow\r\n                        categories[workflow.category].workflows.push(workflow);\r\n\r\n                        // Sum the cases count\r\n                        //  if (bizagi.util.isEmpty(params.onlyFavorites) || params.onlyFavorites == false) {\r\n                        allCases.count += Number(workflow.count);\r\n                        // }\r\n                    });\r\n                }\r\n\r\n                // Build result array once grouped\r\n                responseData.categories = [];\r\n                for (key in categories) {\r\n                    responseData.categories.push({\r\n                        name: key,\r\n                        workflows: categories[key].workflows\r\n                    });\r\n                }\r\n\r\n                return responseData;\r\n            });\r\n    },\r\n    /*\r\n     *   Return my favourites count\r\n     */\r\n    getFavourites: function () {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getFavourites\");\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Return my favourites count\r\n     */\r\n    getMyStuff: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getMyStuff\");\r\n\r\n        if (typeof params.icon !== \"undefined\" && params.icon) {\r\n            data.icon = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data);\r\n    },\r\n    /*\r\n     *   Return my favourites cases\r\n     */\r\n    getFavouriteCases: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getFavouriteCases\");\r\n\r\n        data[\"pageSize\"] = params.pageSize || self.pageSize;\r\n        data[\"page\"] = params.page || 1;\r\n\r\n        if (bizagi.isMobile()) {\r\n            data[\"mobileDevice\"] = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Return all the available cases in bizagi and thinking for mobile response\r\n     */\r\n    getCasesList: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"case-handler-getCasesList\");\r\n\r\n        params = params || {};\r\n\r\n        data[\"pageSize\"] = params.pageSize || 10;\r\n        data[\"page\"] = params.page || 1;\r\n        data[\"numberOfFields\"] = params.numberOfFields || \"-1\"; //1;\r\n        data[\"idWfClass\"] = params.idWfClass || \"-1\";\r\n\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                var elementToHtml = {\r\n                    overdue: [],\r\n                    today: [],\r\n                    tomorrow: [],\r\n                    upcoming: [],\r\n                    page: response.page,\r\n                    totalPages: response.totalPages\r\n                };\r\n                var actualDate = new Date();\r\n                var actualMonth = actualDate.getMonth();\r\n                var actualDay = actualDate.getDate();\r\n                var actualYear = actualDate.getYear();\r\n                var lengthData = typeof response.elements !== \"undefined\" ? response.elements.length : 0;\r\n\r\n                for (var counter = 0; lengthData > counter; counter++) {\r\n                    var tmpElement = response.elements[counter];\r\n                    var tmpdate = new Date(tmpElement[3]);\r\n                    var tmpDay = tmpdate.getDate();\r\n                    var tmpMonth = tmpdate.getMonth();\r\n                    var tmpYear = tmpdate.getYear();\r\n\r\n                    if (actualDay > tmpDay || (actualMonth > tmpMonth || actualYear > tmpYear)) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"dd MMM yyyy\");\r\n                        elementToHtml.overdue.push(tmpElement);\r\n                    } else {\r\n                        if (actualDay == tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm\");\r\n                            elementToHtml.today.push(tmpElement);\r\n\r\n                        } else if ((actualDay + 1) == tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm\");\r\n                            elementToHtml.tomorrow.push(tmpElement);\r\n\r\n                        } else {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"dd MMM yyyy\");\r\n                            elementToHtml.upcoming.push(tmpElement);\r\n                        }\r\n                    }\r\n                }\r\n                return elementToHtml;\r\n            });\r\n\r\n    },\r\n\r\n    /*\r\n     *   Return all the available cases in bizagi and thinking for mobile response\r\n     */\r\n    getCasesListBeta: function (params) {\r\n        var self = this;\r\n\r\n        return self.getMobileCasesList(params)\r\n            .then(function (response) {                \r\n                var groupedData = {\r\n                    elements: [],\r\n                    page: response.page,\r\n                    totalPages: response.totalPages,\r\n                    advanceSearch: response.advanceSearch || false\r\n                };\r\n\r\n                var actualDate = new Date();\r\n                var statusFunction = response.advanceSearch ? self.defineActivityStateByTaskState :self.defineActivityStateByDate;\r\n\r\n                for (var counter = 0; response.elements.length > counter; counter++) {\r\n                    var tmpElement = response.elements[counter];\r\n                    var status = {};\r\n\r\n                    status = statusFunction(tmpElement[3], tmpElement.taskstate);\r\n\r\n                    // Time to atRiskTimeDelta\r\n                    if (tmpElement.length >= 10 && parseInt(tmpElement[11], 10) > 0) {\r\n                        var tmpEndDate = new Date(tmpElement[3]);\r\n\r\n                        if (actualDate.getTime() > tmpEndDate.getTime()) {\r\n                            status.state = \"red\";\r\n                        } else {\r\n                            if (actualDate.getTime() > (tmpEndDate.getTime() - (parseInt(tmpElement[11], 10) * 60000))) {\r\n                                status.state = \"yellow\";\r\n                            } else {\r\n                                status.state = \"green\";\r\n                            }\r\n                        }\r\n                    }\r\n                \r\n                    groupedData.elements.push($.extend({}, tmpElement, status, {\r\n                        \"endDate\": tmpElement[3],\r\n                        \"idworkitem\": tmpElement[1],\r\n                        \"idwfclass\": !bizagi.util.validateFeatureSupport(\"advancedSearch\") ? tmpElement[7] : tmpElement[10]\r\n                    }));\r\n                }                               \r\n                return groupedData;\r\n            });\r\n    },\r\n   \r\n    getMobileCasesList: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        params = params || {};\r\n\r\n        if (typeof params.radNumber !== \"undefined\") {\r\n            data[\"radNumber\"] = params.radNumber;\r\n        }\r\n\r\n        data[\"pageSize\"] = params.pageSize || 10;\r\n        data[\"page\"] = params.page || 1;\r\n\r\n        var urlMobile = self.serviceLocator.getUrl(\"case-handler-getActivityList\");\r\n\r\n        //if server version is less than server version where the new service was implemented, then call last version of service\r\n        if (!bizagi.util.validateFeatureSupport(\"advancedSearch\")) {\r\n            urlMobile = self.serviceLocator.getUrl(\"case-handler-getCasesList\");\r\n            data[\"numberOfFields\"] = params.numberOfFields || \"-1\"; //1;\r\n            data[\"idWfClass\"] = params.idWfClass || \"-1\";\r\n            return $.read(urlMobile, data);\r\n        }\r\n\r\n        return $.read(urlMobile, data).then(function (resp) {\r\n            var response = {elements: [], rows: []};\r\n            var row, i = -1;\r\n            while ((row = resp.rows[++i])) {\r\n                var tempElement = {}, el = [\"\", \"\", \"\", \"\", \"\", \"\", [], \"\", \"\", \"\", \"\",\"\",\"\"];\r\n                var field, j = -1;\r\n                while ((field = resp.headers[++j])) {\r\n                    tempElement[field.fieldName.toLowerCase()] = {\r\n                        \"displayName\": field.displayName,\r\n                        \"value\": row[j]\r\n                    };\r\n                    self.serializeActivity(el, field.fieldName.toLowerCase(), tempElement[field.fieldName.toLowerCase()]);\r\n                }\r\n\r\n                response.elements.push(el);\r\n                response.rows.push(tempElement);\r\n            }\r\n            return {\r\n                \"page\": resp.page || resp.currentPage,\r\n                \"totalPages\": resp.totalPages,\r\n                \"elements\": response.elements,\r\n                \"rows\": response.rows,\r\n                \"advanceSearch\": true\r\n            };\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Returns the activity status based on the end date and the risk\r\n     * @param {String} endDate ISO representation of a date\r\n     * @returns {{}}\r\n     */\r\n    defineActivityStateByDate: function (endDate) {\r\n        var status = {};\r\n\r\n        if ( endDate ) {\r\n            var activityDate = new Date( endDate );\r\n            var now = new Date();\r\n            var today = new Date( now.getFullYear(), now.getMonth(), now.getDate() );\r\n            var second = 1000;\r\n            var minute = 60 * second;\r\n            var day = 24 * 60 * minute;\r\n\r\n            // Before today\r\n            if( activityDate.getTime( ) < today.getTime( ) - second ) {\r\n                status = { group: \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\"), state: \"red\",  type: \"overdue\", icon: \"overdue\", shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n            // Today but before now\r\n            else if( activityDate.getTime( ) < now.getTime( ) + minute - second ) {\r\n                status = { group: \"2|\" + bizagi.localization.getResource(\"workportal-taskfeed-today\"), state: \"red\", type: \"today\", icon: \"overdue\", shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n            // Today but after now\r\n            else if( activityDate.getTime( ) < today.getTime( ) + day - second ) {\r\n                status = { group: \"2|\" + bizagi.localization.getResource(\"workportal-taskfeed-today\"), state: \"yellow\", type: \"today\", icon: \"ontime\", shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\") };\r\n            }\r\n            // Tomorrow\r\n            else if( activityDate.getTime( ) < today.getTime( ) + 2 * day - second ) {\r\n                status = { group: \"3|\" + bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\"), state: \"green\", type: \"tomorrow\" , icon: \"upcoming\", shortEndDate:  bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n            // After tomorrow\r\n            else {\r\n                status = { group: \"4|\" + bizagi.localization.getResource(\"workportal-taskfeed-upcomming\"), state: \"green\", type: \"upcoming\" , icon: \"upcoming\", shortEndDate:  bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n        } else {\r\n            status = { group: \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\"), state: \"red\", type: \"overdue\", shortEndDate : \"--\" ,  icon: \"overdue\"};\r\n        }\r\n\r\n        return status;\r\n    },\r\n\r\n    /**\r\n     * Returns the activity status based on the taskstate property\r\n     * @param {String} endDate ISO representation of a date\r\n     * @param {String} taskstate Color name\r\n     * @returns {{}}\r\n     */\r\n    defineActivityStateByTaskState: function(endDate, taskstate) {\r\n        var status = {\r\n            group: \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\"),\r\n            state: taskstate,\r\n            type: \"overdue\",\r\n            shortEndDate : \"--\",\r\n            icon: \"overdue\"\r\n        };\r\n\r\n        if ( endDate && taskstate ) {\r\n            var activityDate = new Date( endDate );\r\n            var now = new Date();\r\n            var today = new Date( now.getFullYear(), now.getMonth(), now.getDate() );\r\n            var second = 1000;\r\n            var minute = 60 * second;\r\n            var day = 24 * 60 * minute;\r\n\r\n            status = {\r\n                group: \"\",\r\n                state: taskstate,\r\n                type: \"\",\r\n                icon: \"\",\r\n                shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")\r\n            };\r\n            // Before today\r\n            if( activityDate.getTime( ) < today.getTime( ) - second ) {\r\n                status.group = \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n                status.type = \"overdue\";\r\n            }\r\n            // Today\r\n            else if( activityDate.getTime( ) < today.getTime( ) + day - second ) {\r\n                status.group = \"2|\" + bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n                status.type = \"today\";\r\n            }\r\n            // Tomorrow\r\n            else if( activityDate.getTime( ) < today.getTime( ) + 2 * day - second ) {\r\n                status.group = \"3|\" + bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n                status.type = \"tomorrow\";\r\n            }\r\n            // After tomorrow\r\n            else {\r\n                status.group = \"4|\" + bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n                status.type = \"upcoming\";\r\n            }\r\n\r\n            switch( taskstate ) {\r\n                case \"green\":\r\n                    status.icon = \"upcoming\";\r\n                    break;\r\n                case \"yellow\":\r\n                    status.icon = \"ontime\";\r\n                    break;\r\n                case \"red\":\r\n                default:\r\n                    status.icon = \"overdue\";\r\n                    break;\r\n            }\r\n        }\r\n        return status;\r\n    },\r\n\r\n    serializeActivity: function (el, fieldName, element) {\r\n        switch (fieldName) {\r\n            case \"radnumber\":\r\n                el[6].push([element.displayName, element.value]);\r\n                break;\r\n            //Proceso\r\n            case \"wfclsdisplayname\":\r\n                el[4] = element.value !== null ? element.value.toString() : bizagi.localization.getResource(\"workportal-project-activity-plan\");\r\n                break;\r\n            //Actividad\r\n            case \"currenttask\":\r\n                el[5] = element.value !== null ? element.value.toString() : bizagi.localization.getResource(\"workportal-project-casedashboard-activity\");\r\n                break;\r\n            //Fecha creación caso\r\n            case \"cascreationdate\":\r\n                el[12] = element.value;\r\n                break;\r\n            // Actividad vence en\r\n            case \"wiestimatedsolutiondate\":\r\n                el[3] = element.value;\r\n                break;\r\n            //Fecha Solución caso\r\n            case \"cassolutiondate\":\r\n                //el[6] = [\"\"];\r\n                break;\r\n            // Id de caso\r\n            case \"idcase\":\r\n                el[0] = element.value;\r\n                break;\r\n            // idWorkItem\r\n            case \"idworkitem\":\r\n                el[1] = element.value.toString();\r\n                break;\r\n            //Fecha de entrada al estado\r\n            case \"wientrydate\":\r\n                //el[6] = [\"\"];\r\n                break;\r\n            case \"taskid\":\r\n                el[2] = element.value;\r\n                break;\r\n            case \"taskstate\":\r\n                el.taskstate = ( element.value ? ( \"\" + element.value ).toLowerCase() : \"\" );\r\n                break;\r\n            //idWorkflow\"\r\n            case \"idwfclass\":\r\n                el[10] = el.idwfclass = element.value;\r\n                break;\r\n            //Is Favorite\r\n            case \"isfavorite\":\r\n                el[9] = element.value;\r\n                break;\r\n            case \"atrisktime\":\r\n                el[11] = element.value;\r\n                break;\r\n            case \"guidfavorite\":\r\n                el[8] = element.value;\r\n                break;\r\n            case \"isevent\":\r\n                el.isEvent = element.value;\r\n                break;\r\n            case \"datachangesetversion\":\r\n                el.dataChangeset = element.value;\r\n                break;                \r\n        }\r\n    },\r\n\r\n    /**\r\n     * Obtiene la lista de actividades para el usuario actual con filtros\r\n     * Version: 2, Llamado al servicio con todas las prestaciones de filtrado\r\n     */\r\n    getCurrentActivities: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        params = params || {};\r\n\r\n        data[\"page\"] = params.page || 1;\r\n        data[\"pageSize\"] = params.pageSize || 10;\r\n\r\n        if (typeof params.radNumber !== \"undefined\") {\r\n            data[\"radNumber\"] = params.radNumber;\r\n        }\r\n\r\n        var url = self.serviceLocator.getUrl('case-handler-getActivityList');\r\n        return $.read(url, data).then(function (resp) {\r\n            return self.processActivitiesResponse(resp);\r\n        });\r\n    },\r\n\r\n    processActivitiesResponse: function (resp, highlight, process_filter) {\r\n        var self = this;\r\n        var row;\r\n        var i = -1;\r\n\r\n        resp.elements = [];\r\n        resp.processes = [];\r\n\r\n        while ((row = resp.rows[++i])) {\r\n            var tempElement = {};\r\n            var field, j = -1;\r\n            while ((field = resp.headers[++j])) {\r\n                tempElement[\"o_\" + field.fieldName.toLowerCase()] = {\"displayName\": field.displayName, \"value\": row[j]};\r\n                tempElement[field.fieldName.toLowerCase()] = row[j];\r\n            }\r\n            $.extend(tempElement, self.defineActivityStateByDate(tempElement[\"wiestimatedsolutiondate\"]), {highlightedNumber: self.highlightsString(tempElement[\"radnumber\"], highlight)});\r\n            resp.elements.push(tempElement);\r\n\r\n            var process = resp.processes.find(function (el) {\r\n                return el.processname == tempElement[\"wfclsdisplayname\"];\r\n            });\r\n\r\n            if (typeof process === \"undefined\") {\r\n                resp.processes.push({\r\n                    processname: tempElement[\"wfclsdisplayname\"],\r\n                    idwfclass: tempElement[\"idwfclass\"],\r\n                    active: (process_filter || false) ? \"active\" : \"\"\r\n                });\r\n            }\r\n        }\r\n        return resp;\r\n    },\r\n\r\n    highlightsString: function (string, highlight) {\r\n        if (typeof string !== \"string\" || typeof highlight !== \"string\") {\r\n            return string;\r\n        }\r\n\r\n        var expresion = new RegExp(highlight, \"gi\");\r\n        return string.replace(expresion, function (match, offset) {\r\n            return \"<strong>\" + match + \"</strong>\";\r\n        });\r\n    },\r\n\r\n    getDiscussionCase: function (params) {\r\n        var self = this;\r\n        var data = data || {};\r\n        data['globalParent'] = params.globalParent;\r\n        var url = bizagi.util.validateFeatureSupport(\"discussionCase\") ? self.serviceLocator.getUrl('discussion-case') : self.serviceLocator.getUrl('discussion-case-v1');\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    editDiscussion: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"new-discussion\");\r\n        return $.update({\r\n            url: url,\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getUsersDiscussion: function (params) {\r\n        var self = this;\r\n        var data = data || {};\r\n        data[\"userIds\"] = params;\r\n        data[\"width\"] = 50;\r\n        data[\"height\"] = 50;\r\n        var url = self.serviceLocator.getUrl(\"get-users\");\r\n\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n            return $.ajax({\r\n                url: url, \r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        } else {    \r\n            return $.read(url, data)\r\n                .pipe(function (response) {\r\n                    return response;\r\n                });\r\n        }        \r\n    },\r\n\r\n    getEffectiveDuration: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"time-schemas-effectiveduration\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getUsersData: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-users-get\");\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n            return $.ajax({\r\n                url: url, \r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        } else {    \r\n            return $.read({\r\n                url: url,\r\n                data: data,\r\n                dataType: \"json\"\r\n            });\r\n        }   \r\n\r\n        \r\n    },\r\n\r\n    getSummaryCaseTaskOptions : function(params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"case-summary-task-options\");\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idWorkitem\r\n        return $.read(url, {\r\n            idWorkitem: params.idWorkitem\r\n        });\r\n    },\r\n\r\n    createNewDiscussion: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"new-discussion\");\r\n\r\n        params = params || {};\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    createNewComment: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var data = params.data || {};\r\n        var url = self.serviceLocator.getUrl(\"new-comment\");\r\n\r\n        return $.create({\r\n            url: url.replace(\"{typeResource}\", \"Comment\"),\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Update Project File\r\n     */\r\n    updateProjectFile: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-files-upload\");\r\n\r\n        return $.update({\r\n            url: url,\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Update Project File\r\n     */\r\n    createProjectFile: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-files-upload\");\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Count the files number\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getFilesCount: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var url = bizagi.util.validateFeatureSupport(\"filesCount\") ? self.serviceLocator.getUrl(\"count-files\") : self.serviceLocator.getUrl(\"count-files-v1\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getCommentCase: function (data) {\r\n        var self = this;\r\n        data = data || {};\r\n\r\n        var url = self.serviceLocator.getUrl(\"comment-case\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getCommentsByParent: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var url = self.serviceLocator.getUrl(\"count-comments\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getFilesList: function (params) {\r\n        var self = this;\r\n        var url = bizagi.util.validateFeatureSupport(\"filesList\") ? self.serviceLocator.getUrl(\"get-list-files\") : self.serviceLocator.getUrl(\"get-list-files-v1\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    deleteFile: function(data){\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-resource-action\");\r\n        return $.destroy({\r\n            url: url.replace(\"{typeResource}\", \"Attachment\"),\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getFilesThumbnail: function (data) {\r\n        var self = this;\r\n        data = data || {};\r\n        var url = self.serviceLocator.getUrl(\"thumbnail-file\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getAttachment: function (guidAttachment) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl(\"get-attachment\");\r\n        url = url.replace(\"{idAttachment}\", guidAttachment.idAttachment);\r\n        return url;\r\n    },\r\n\r\n    getMobileAttachment: function (guidAttachment) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl(\"get-mobile-attachment\");\r\n        url = url.replace(\"{idAttachment}\", guidAttachment.idAttachment);\r\n        return url + \"?sessionId=\";\r\n    },\r\n\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getAllAdministrableEntities: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data[\"action\"] = \"entitiesList\";\r\n        data[\"kind\"] = \"administrable\";\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"entities-administration\"),\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\"\r\n        }).pipe(function (data) {\r\n            var result = {\r\n                entities: []\r\n            };\r\n            $.each(data, function (i, item) {\r\n                result.entities.push(item);\r\n            });\r\n            return result;\r\n        });\r\n    },\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getEntitiesList: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        params[\"action\"] = \"entitiesList\";\r\n        params[\"kind\"] = \"entitiesData\";\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"entities-administration\"),\r\n            data: params,\r\n            type: \"POST\",\r\n            dataType: \"json\"\r\n        });\r\n    },\r\n    /*\r\n     *   Returns all the cases for the current user filtered by a workflow\r\n     */\r\n    getCasesByWorkflow: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl('process-handler-getCustomizedColumnsDataInfo');\r\n\r\n\r\n        // Required params\r\n        if (!bizagi.util.isEmpty(params.taskState))\r\n            data['taskState'] = params.taskState;\r\n        if (!bizagi.util.isEmpty(params.idWorkflow))\r\n            data['idWorkflow'] = params.idWorkflow;\r\n\r\n        // Special case to search all favorite cases for all processes\r\n        if (params.onlyFavorites == true) {\r\n            data['onlyFavorites'] = true;\r\n            data['taskState'] = 'all';\r\n        }\r\n\r\n        // Optional params\r\n        data['pageSize'] = params.pageSize || self.pageSize;\r\n        data['page'] = params.page || 1;\r\n\r\n        if (bizagi.isMobile()) {\r\n            data['mobileDevice'] = true;\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            var param = params.smartfoldersParameters.split('&');\r\n            $.each(param, function (k, v) {\r\n                var keyvalue = v.split('=');\r\n                data[keyvalue[0]] = keyvalue[1];\r\n            });\r\n        }\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            data['radNumber'] = params.radNumber ? params.radNumber : params.radnumber;\r\n        }\r\n\r\n        if ((params.idcase || params.idCase) && bizagi.util.isNumeric(params.idcase || params.idCase)) {\r\n            data['idCase'] = params.idCase ? params.idCase : params.idcase;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                $.each(response.cases.rows, function (key, value) {\r\n                    var newFieldsValue = [];\r\n\r\n                    //  Set id of case to radnumber\r\n                    response.cases.rows[key]['radnumber'] = value.id;\r\n                    $.each(value.fields, function (fieldsKey, fieldsValue) {\r\n                        // when delete element from fields array, each function lose key value\r\n                        if (fieldsValue != undefined) {\r\n                            // Radnumber\r\n                            try {\r\n                                if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == 'true') {\r\n                                    response.cases.rows[key]['radnumber'] = fieldsValue.Value;\r\n                                    response.cases.rows[key]['casenumberdisplayname'] = fieldsValue.DisplayName;\r\n                                } else if (fieldsValue.workitems != undefined) {\r\n                                    response.cases.rows[key]['workitems'] = fieldsValue.workitems;\r\n                                } else {\r\n                                    newFieldsValue.push(fieldsValue);\r\n                                }\r\n                            } catch (e) { }\r\n                        }\r\n                    });\r\n\r\n                    // Update Fields\r\n                    response.cases.rows[key]['fields'] = newFieldsValue;\r\n                });\r\n                return response.cases;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Organization List\r\n     */\r\n    getOrganizationsList: function () {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('process-handler-getOrganizations');\r\n        var data = {};\r\n        data['type'] = 12;\r\n        data['name'] = '';\r\n\r\n        return $.read(url, data);\r\n    },\r\n    /*\r\n     *   Returns the data for the inbox grid view\r\n     */\r\n    getCustomizedColumnsData: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getCustomizedColumnsData\");\r\n        data[\"pageSize\"] = params.pageSize || self.pageSize;\r\n        data[\"page\"] = params.page || 1;\r\n\r\n        // data for sort columns\r\n        data[\"orderFieldName\"] = params.orderFieldName || \"\";\r\n        data[\"orderType\"] = params.orderType || \"0\";\r\n        data[\"order\"] = params.order || \"\";\r\n\r\n        if (bizagi.isMobile()) {\r\n            data[\"mobileDevice\"] = true;\r\n        }\r\n\r\n        // Fixes stuff\r\n        // TODO: this must be fixed in the server\r\n        params.taskState = params.taskState || 'all';\r\n        if (params.taskState.toString().toLowerCase() === '')\r\n            params.taskState = 'all';\r\n        if (params.taskState.toString().toLowerCase() === 'red')\r\n            params.taskState = 'Red';\r\n        if (params.taskState.toString().toLowerCase() === 'yellow')\r\n            params.taskState = 'Yellow';\r\n        if (params.taskState.toString().toLowerCase() === 'green')\r\n            params.taskState = 'Green';\r\n\r\n        data.taskState = params.taskState;\r\n        // Required params\r\n        if (!bizagi.util.isEmpty(params.idWorkflow)) {\r\n            data['idWorkflow'] = params.idWorkflow;\r\n        }\r\n        if (!bizagi.util.isEmpty(params.idTask)) {\r\n            data['idTask'] = params.idTask;\r\n        }\r\n\r\n        if (!bizagi.util.isEmpty(params.radNumber)) {\r\n            data['radNumber'] = params.radNumber;\r\n        }\r\n\r\n        // Special case to search all favorite cases for all processes\r\n        if (params.onlyFavorites == true) {\r\n            data['onlyFavorites'] = true;\r\n            data['taskState'] = 'all';\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            var param = params.smartfoldersParameters.split('&');\r\n            $.each(param, function (k, v) {\r\n                var keyvalue = v.split('=');\r\n                data[keyvalue[0]] = keyvalue[1];\r\n            });\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Returns the data for the inbox grid view\r\n     */\r\n    getCustomizedColumnsDataBeta: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl('process-handler-getCustomizedColumnsData');\r\n\r\n        data['pageSize'] = params.pageSize || self.pageSize;\r\n        data['page'] = params.page || 1;\r\n\r\n        // data for sort columns\r\n        data['orderFieldName'] = params.orderFieldName || '';\r\n        data['orderType'] = params.orderType || '0';\r\n        data['order'] = params.order || '';\r\n        data['mobileDevice'] = bizagi.isMobile() ? true : false;\r\n\r\n        // Fixes stuff\r\n        // TODO: this must be fixed in the server\r\n        params.taskState = params.taskState || 'all';\r\n        if (params.taskState.toString().toLowerCase() === '')\r\n            params.taskState = 'all';\r\n        if (params.taskState.toString().toLowerCase() === 'red')\r\n            params.taskState = 'Red';\r\n        if (params.taskState.toString().toLowerCase() === 'yellow')\r\n            params.taskState = 'Yellow';\r\n        if (params.taskState.toString().toLowerCase() === 'green')\r\n            params.taskState = 'Green';\r\n\r\n        data.taskState = params.taskState;\r\n        // Required params\r\n        if (!bizagi.util.isEmpty(params.idWorkflow)) {\r\n            data['idWorkflow'] = params.idWorkflow;\r\n        }\r\n        if (!bizagi.util.isEmpty(params.idTask)) {\r\n            data['idTask'] = params.idTask;\r\n        }\r\n\r\n        if (!bizagi.util.isEmpty(params.radNumber)) {\r\n            data['radNumber'] = params.radNumber;\r\n        }\r\n\r\n        // Special case to search all favorite cases for all processes\r\n        if (params.onlyFavorites == true) {\r\n            data['onlyFavorites'] = true;\r\n            data['taskState'] = 'all';\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            var param = params.smartfoldersParameters.split('&');\r\n            $.each(param, function (k, v) {\r\n                var keyvalue = v.split('=');\r\n                data[keyvalue[0]] = keyvalue[1];\r\n            });\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        //return $.read(url, data);\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n\r\n                var groupedData = {\r\n                    columnTitle: [],\r\n                    lstIdCases: [],\r\n                    elements: [],\r\n                    page: response.page,\r\n                    totalPages: response.totalPages\r\n                };\r\n\r\n                var actualDate = new Date();\r\n                var actualMonth = actualDate.getMonth();\r\n                var actualDay = actualDate.getDate();\r\n                var actualYear = actualDate.getYear();\r\n\r\n                groupedData.columnTitle = response.cases.columnTitle;\r\n                groupedData.lstIdCases = response.cases.lstIdCases;\r\n                groupedData.page = response.cases.page;\r\n                groupedData.totalPages = response.cases.totalPages;\r\n\r\n                for (var counter = 0, length = response.cases.rows.length; counter < length; counter++) {\r\n                    var tmpElement = response.cases.rows[counter];\r\n\r\n                    var tmpdate = new Date(tmpElement.fields[3]);\r\n                    var tmpDay = tmpdate.getDate();\r\n                    var tmpMonth = tmpdate.getMonth();\r\n                    var tmpYear = tmpdate.getYear();\r\n\r\n                    if (actualDay > tmpDay || (actualMonth > tmpMonth || actualYear > tmpYear)) {\r\n                        tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'dd MMM'); // 'dd MMM hh:mm'\r\n                        groupedData.elements.push($.extend({}, tmpElement, {'group': 'overdue'}));\r\n\r\n                    } else {\r\n                        if (actualDay == tmpDay) {\r\n                            tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'hh:mm');\r\n                            groupedData.elements.push($.extend({}, tmpElement, {'group': 'today'}));\r\n\r\n                        } else if ((actualDay + 1) == tmpDay) {\r\n                            tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'hh:mm');\r\n                            groupedData.elements.push($.extend({}, tmpElement, {'group': 'tomorrow'}));\r\n\r\n                        } else {\r\n                            tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'dd MMM');\r\n                            groupedData.elements.push($.extend({}, tmpElement, {'group': 'upcoming'}));\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // No data items\r\n                if (typeof (groupedData.elements) === 'undefined' || (typeof (groupedData.elements) !== 'undefined' && groupedData.elements.length === 0)) {\r\n                    groupedData.elements.push({ noResults: true, message: bizagi.localization.getResource('workportal-menu-search-found-no-cases') });\r\n                }\r\n\r\n                return groupedData;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the available categories filtered by a parent category\r\n     *   If not parent category is sent, it will return the base categories\r\n     */\r\n    getCategories: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        // Required params\r\n        if (params.idCategory)\r\n            data['idCategory'] = params.idCategory;\r\n        if (params.idApp)\r\n            data['idApp'] = params.idApp;\r\n\r\n        if (bizagi.isMobile()) {\r\n            data['mobileDevice'] = true;\r\n        }\r\n\r\n\r\n        data['groupByApp'] = params.groupByApp || false;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('process-handler-getCategory'), data);\r\n    },\r\n    /*\r\n     *   Returns the recent process\r\n     */\r\n    getRecentProcesses: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        params.mobileDevice = bizagi.isMobile() || \"false\" ;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('process-handler-getRecentProcesses'), params);\r\n    },\r\n\r\n    /*\r\n     *   Returns the summary for a case\r\n     */\r\n    getCaseSummary: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getCaseSummary'),\r\n            data: {\r\n                idCase: params.idCase,\r\n                eventAsTasks: params.eventAsTasks || \"false\",\r\n                onlyUserWorkItems: params.onlyUserWorkItems || \"true\",\r\n                mobileDevice: bizagi.isMobile() || \"false\"\r\n            },\r\n            serviceType: \"GETSUMMARY\"\r\n        }).pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /*\r\n     *   Returns the assigness for a case (all users assigned to any task of this case)\r\n     */\r\n    getCaseAssignees: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(self.serviceLocator.getUrl('case-handler-getCaseAssignees'), {\r\n            idCase: params.idCase\r\n        }).pipe(function(response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Returns all the tasks belonging to a process, aditionally return if it has an active workitem or not\r\n     */\r\n    getCaseTasks: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getCaseTasks'), {\r\n                idCase: params.idCase\r\n            }\r\n        );\r\n    },\r\n    /*\r\n     *   Returns all the events available for a case\r\n     */\r\n    getCaseEvents: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getCaseEvents'),\r\n            data: {\r\n                idCase: params.idCase\r\n            },\r\n            serviceType: 'GETEVENTS'\r\n        })\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns all the available subprocesses for a case\r\n     */\r\n    getCaseSubprocesses: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getCaseSubprocesses'),\r\n            data: {\r\n                idCase: params.idCase\r\n            },\r\n            serviceType: 'GETSUBPROCESSES'\r\n        })\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns forms render version for a case\r\n     */\r\n    getCaseFormsRenderVersion: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getCaseFormsRenderVersion'), {\r\n                idCase: params.idCase\r\n            }\r\n        );\r\n    },\r\n    /**\r\n     *  Get json from forms render version service\r\n     */\r\n    getCaseFormsRenderVersionDataContent: function (options) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        $.when(self.getCaseFormsRenderVersion(options))\r\n            .done(function (data) {\r\n                // return json content\r\n                defer.resolve(data);\r\n            });\r\n        return defer.promise();\r\n    },\r\n    /*\r\n     *   Returns all the assignees belonging to a workitem (case - task combination)\r\n     */\r\n    getTaskAssignees: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase, idTask\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getTaskAssignees'), {\r\n                idCase: params.idCase,\r\n                idTask: params.idTask\r\n            }\r\n        );\r\n    },\r\n    /*\r\n     *   Returns the available workitems for a case (Routing service)\r\n     */\r\n    getWorkitems: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        params = params || {};\r\n\r\n        data.idCase = params.idCase;\r\n        data.fromTask = params.fromTask;\r\n        data.fromWorkItemId = params.fromWorkItemId;\r\n        data.mobileDevice = bizagi.isMobile();\r\n\r\n        params.eventAsTasks ? (data.eventAsTasks = params.eventAsTasks) : \"\";\r\n\r\n        if (typeof params.onlyUserWorkItems !== \"undefined\") {\r\n            data.onlyUserWorkItems = params.onlyUserWorkItems;\r\n        }\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getWorkItems'),\r\n            data: data,\r\n            serviceType: 'GETWORKITEMS'\r\n        });\r\n    },\r\n    /*\r\n     *   Returns the available workitems for a case (Routing service)\r\n     */\r\n    getQueries: function (params) {\r\n        var self = this;\r\n\r\n        if (self.hashQueries && params.idElement) {\r\n            return self.hashQueries[params.idElement];\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            // Call ajax and returns promise\r\n            $.read(self.serviceLocator.getUrl('query-handler-getqueries'))\r\n                .done(function (response) {\r\n                    self.hashQueries = {};\r\n                    self.hashQueries[0] = {};\r\n\r\n                    // Process the full response converting it into small entries inside a hashtable\r\n                    self.processQueries(response.query);\r\n                    defer.resolve(self.hashQueries['-1']);\r\n                });\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Creates a hash of queries to simulate each category request\r\n     */\r\n    processQueries: function (queries) {\r\n        var self = this;\r\n        $.each(queries, function (i, query) {\r\n            if (!self.hashQueries[query.idParent]) {\r\n                self.hashQueries[query.idParent] = [];\r\n            }\r\n            self.hashQueries[query.idParent].push(query);\r\n            if (query.nodes) {\r\n                self.processQueries(query.nodes);\r\n            } else {\r\n                query.nodes = {};\r\n            }\r\n        });\r\n    },\r\n    /*\r\n     *   Creates a new case in BizAgi\r\n     */\r\n    createNewCase: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl('case-handler-addNewCase'),\r\n            data: {\r\n                idWfClass: params.idWfClass,\r\n                caseData: params.caseData ? JSON.stringify(params.caseData) : null,\r\n                idOrganization: params.idOrganization ? params.idOrganization : null\r\n            },\r\n            serviceType: 'NEWCASE'\r\n        });\r\n    },\r\n\r\n    /*\r\n     * La idea con este servicio es por ahora quitar el hatStartForm del servicio de Shortcuts y de acciones\r\n     * retorna si tiene forma de inicio y el guid de la entidad de proceso\r\n     */\r\n    validateHasStartForm: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            processId: params.processId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"case-handler-validateHasStartForm\"),\r\n            data: data,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n\r\n    /*\r\n     *   Start process in Bizagi\r\n     */\r\n    startProcess: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        var data = {\r\n            idProcess: params.idProcess,\r\n            entityMapping: params.mapping ? JSON.stringify(params.mapping) : {}\r\n        };\r\n\r\n        if (typeof params.idParentCase !== \"undefined\") {\r\n            data.idParentCase = params.idParentCase;\r\n        }\r\n\r\n        var defer = $.Deferred();\r\n\r\n        $.create({\r\n            url: self.serviceLocator.getUrl(\"case-handler-startProcess\"),\r\n            data: data,\r\n            serviceType: \"STARTPROCESS\"\r\n        }).fail(function (error) {\r\n            var response = $.parseJSON(error.responseText);\r\n            if (response.status === \"error\" && !bizagi.util.isVersionSupported()) {\r\n                var oldParams = {\r\n                    idWfClass: params.idProcess || params.idWfClass,\r\n                    idOrganization: params.idOrganization || null\r\n                };\r\n\r\n                self.createNewCase(oldParams)\r\n                    .then(function (result) {\r\n                        result.oldVersion = true;\r\n\r\n                        defer.resolve(result);\r\n                    }).fail(function (error) {\r\n                    defer.reject(error);\r\n                });\r\n            } else {\r\n                defer.reject(error);\r\n            }\r\n        }).done(function (data) {\r\n            defer.resolve(data);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     *   Start process in BizAgi\r\n     */\r\n    actionCreateCase: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            processId: (typeof params.idProcess !== \"undefined\") ? params.idProcess : params.guidProcess\r\n        }\r\n        // When the proccess is a shortcut it does not have mapping and parentCaseId,\r\n        // but when the process is not a shortcut, it has a context, so it comes with mapping and parentCaseId\r\n        if (typeof params.parentCaseId !== \"undefined\") {\r\n            data.parentCaseId = params.parentCaseId;\r\n        }\r\n        if (typeof params.mapping !== \"undefined\") {\r\n            data.entityMapping = params.mapping ? JSON.stringify(params.mapping) : {};\r\n        }\r\n\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl(\"handler-execute-action-start\"),\r\n            data: data,\r\n            serviceType: \"STARTPROCESS\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get the first parent plan on not contextualizeds plans\r\n     * */\r\n    getFirstParentPlan: function (data) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"project-plan-first-parent-plan\");\r\n        var defer = $.Deferred();\r\n        $.when($.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\"\r\n        })).done(function (response) {\r\n            defer.resolve(response);\r\n        }).fail(function () {\r\n            defer.resolve(null);\r\n        });\r\n        return defer.promise();\r\n    },\r\n    /*\r\n     *   Search cases with radNumber\r\n     */\r\n    searchCases: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        data['h_action'] = 'SEARCHCASES';\r\n        data['onlyUserCases'] = false;\r\n        data['active'] = false;\r\n        data['page'] = params.page || 1;\r\n        if (params.radNumber)\r\n            data['radNumber'] = $.trim(params.radNumber);\r\n        data['pageSize'] = params.pageSize || self.pageSize;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('query-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Search cases with radNumber\r\n     */\r\n    queryCases: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        data.h_action = 'QUERYCASES';\r\n        data.onlyUserCases = params.onlyUserCases || false;\r\n        data.active = params.active && true;\r\n        data.page = params.page || 1;\r\n        if (params.radNumber)\r\n            data.radNumber = $.trim(params.radNumber);\r\n        data.pageSize = params.pageSize || self.pageSize;\r\n\r\n        data.filter = params.filter;\r\n        data.outputxpath = params.outputxpath;\r\n\r\n        // data for sort columns\r\n        data.orderFieldName = params.orderFieldName || '';\r\n        data.orderType = (params.orderType == 'asc' || params.orderType == 1) ? 1 : 0;\r\n        data.order = params.order || '';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('query-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Search entities service\r\n     */\r\n    queryEntities: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        data.h_action = 'QUERYENTITIES';\r\n        data.page = params.page || 1;\r\n        data.pageSize = self.Class.ENTITIES_QUERY_PAGE_SIZE;\r\n\r\n        // Query parameters\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + 'idEnt'] = params.idEntity;\r\n        data.filter = params.filter;\r\n        data.outputxpath = params.outputxpath;\r\n\r\n        // Data to sort columns\r\n        data.orderFieldName = params.orderFieldName || '';\r\n        data.orderType = params.orderType || '';\r\n        data.order = params.order || '';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('query-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *  Get Menu Authorization\r\n     */\r\n    getMenuAuthorization: function () {\r\n        var self = this;\r\n\r\n        return $.read(\r\n            self.serviceLocator.getUrl('authorization-handler-getMenuAuthorization')\r\n        );\r\n    },\r\n    /*\r\n     *  The user have permissions to excecute this Case\r\n     */\r\n    isCaseCreationAuthorized: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl('authorization-handler-isCaseCreationAuthorized');\r\n        urlSend = urlSend.replace('{0}', params.idWfClass || '');\r\n\r\n        return $.read({\r\n            url: urlSend //,\r\n            //data: { 'idWfClass': params.idWfClass }\r\n            //data: { 'userName': BIZAGI_USER, 'password': BIZAGI_PASSWORD, 'domain': BIZAGI_DOMAIN }\r\n        });\r\n    },\r\n    /*\r\n     *   Returns the execution state of an async workitem\r\n     */\r\n    getAsynchExecutionState: function(params) {\r\n        var self = this;\r\n        var idAsynchWorkitem;\r\n        params = params || {};\r\n\r\n        if (params.idCase != -1) {\r\n            return $.read({\r\n                url: self.serviceLocator.getUrl(\"case-handler-getAsynchExecutionState\"),\r\n                data: {\r\n                    idCase: params.idCase,\r\n                    idAsynchWorkitem: params.idAsynchWorkitem\r\n                },\r\n                serviceType: \"ASYNCHEXECUTION\"\r\n            });\r\n        } else {\r\n            return $.read({\r\n                url: self.serviceLocator.getUrl(\"case-handler-getAsynchExecutionState\"),\r\n                data: {\r\n                    idCase: params.idCase,\r\n                    idAsynchWorkitem: params.idAsynchWorkitem\r\n                },\r\n                serviceType: \"ASYNCHEXECUTION\"\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n     *  Returns the supported log types\r\n     */\r\n    supportedLogTypes: function () {\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('case-handler-supportedLogTypes'));\r\n    },\r\n    /*\r\n     *   Returns the Activity Log for a case\r\n     */\r\n    getActivityLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getActivityLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Activity Detail Log for a case\r\n     */\r\n    getActivityDetailLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idWorkItemFrom\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getActivityDetailLog'), {\r\n                idCase: params.idCase,\r\n                idWorkItemFrom: params.idWorkItemFrom,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Entity Log for a case\r\n     */\r\n    getEntityLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getEntityLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Entity Detail Log for a case\r\n     */\r\n    getEntityDetailLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getEntityDetailLog'), {\r\n                idCase: params.idCase,\r\n                idEntity: params.idEntity || -1,\r\n                userFullName: params.userFullName || '',\r\n                attribDisplayName: params.attribDisplayName || '',\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the User Log for a case\r\n     */\r\n    getUserLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getUserLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the User Detail Log for a case\r\n     */\r\n    getUserDetailLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase , idUser\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getUserDetailLog'), {\r\n                idCase: params.idCase,\r\n                idUser: params.idUser,\r\n                entDisplayName: params.entDisplayName || '',\r\n                attribDisplayName: params.attribDisplayName || '',\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Admin Log for a case\r\n     */\r\n    getAdminLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getAdminLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Adds a New Favorite\r\n     */\r\n    addFavorite: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n\r\n        return $.create(\r\n            self.serviceLocator.getUrl('favorites-handler-saveFavorite'), {\r\n                idObject: params.idObject,\r\n                favoriteType: params.favoriteType\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Favorites service\r\n     */\r\n    delFavorite: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n\r\n        // Required params: guidFavorite\r\n        return $.destroy(\r\n            self.serviceLocator.getUrl('favorites-handler-deleteFavorite'), {\r\n                guidFavorite: params.idObject\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    // Data Transformations for Summary Widget\r\n    /*\r\n     * Render Assigness\r\n     */\r\n    summaryAssigness: function (options) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var idCase = options.idCase || \"\";\r\n\r\n        $.when(\r\n            self.getCaseAssignees({\r\n                idCase: idCase\r\n            })\r\n        ).done(function (baseAssignees) {\r\n\r\n            var assignees = baseAssignees.assignees || [];\r\n            var assigneesLength = assignees.length;\r\n            var assigneesFix = {\r\n                showAssignees: (bizagi.override.showAssignees && assignees.length > 0) ? true : false,\r\n                assignees: {},\r\n                events: \"\",\r\n                activities: \"\"\r\n            };\r\n\r\n            var assigneesEvents = \"\";\r\n            var assigneesActivities = \"\";\r\n            var assigneesEventsList = [];\r\n            var assigneesActivitiesList = [];\r\n\r\n            for (var i = 0; i < assigneesLength; i++) {\r\n                if (bizagi.util.parseBoolean(assignees[i].isEvent)) {\r\n                    if (assigneesEventsList.indexOf(assignees[i].idUser) == -1) {\r\n                        assigneesEventsList.push(assignees[i].idUser);\r\n                        assigneesEvents += assignees[i].Name + \", \";\r\n                    }\r\n                } else {\r\n                    if (assigneesActivitiesList.indexOf(assignees[i].idUser) == -1) {\r\n                        assigneesActivitiesList.push(assignees[i].idUser);\r\n                        assigneesActivities += assignees[i].Name + \", \";\r\n                    }\r\n                }\r\n            }\r\n            //join assignees to event and activities\r\n            assigneesFix.events = assigneesEvents.substring(0, assigneesEvents.length - 2);\r\n            assigneesFix.activities = assigneesActivities.substring(0, assigneesActivities.length - 2);\r\n\r\n\r\n            def.resolve(assigneesFix);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /*\r\n     * Render Assigness\r\n     */\r\n    summarySubProcess: function (options) {\r\n        var self = this;\r\n        var def = $.Deferred();\r\n        var idCase = options.idCase || '';\r\n\r\n        $.when(\r\n            self.getCaseSubprocesses({\r\n                idCase: idCase\r\n            })\r\n        ).done(function (subprocess) {\r\n            subprocess['showSubProcess'] = (subprocess['subProcesses'].length >= 1) ? true : false;\r\n            subprocess['showSubProcesColumns'] = (subprocess['CustFields'][0] !== undefined && subprocess['CustFields'][0][0].length >= 1) ? true : false;\r\n\r\n            // Prepare json for subprocess\r\n            if (subprocess['showSubProcesColumns']) {\r\n                subprocess['subProcPersonalized'] = {};\r\n                var len;\r\n                for (var n = 0; n < subprocess['CustFields'].length; n++) {\r\n                    len = 0;\r\n                    for (var i = 0; i < subprocess['subProcesses'].length; i++) {\r\n                        if (subprocess['subProcesses'][i]['idCustData'] == n) {\r\n                            subprocess['subProcPersonalized'][n] = subprocess['subProcPersonalized'][n] || {};\r\n                            subprocess['subProcPersonalized'][n]['subProcesses'] = subprocess['subProcPersonalized'][n]['subProcesses'] || {};\r\n                            subprocess['subProcPersonalized'][n]['subProcesses'][len++] = subprocess['subProcesses'][i];\r\n                        }\r\n                    }\r\n\r\n                    if (subprocess[\"subProcesses\"][n][\"idCustData\"] != -1 && subprocess[\"subProcPersonalized\"][n] != undefined) {\r\n                        subprocess[\"subProcPersonalized\"][n][\"CustFields\"] = subprocess[\"CustFields\"][n];\r\n                        subprocess[\"subProcPersonalized\"][n][\"idCase\"] = subprocess[\"idCase\"];\r\n                    }\r\n                }\r\n            }\r\n\r\n            def.resolve(subprocess);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /*\r\n     * Render Case Events\r\n     */\r\n    summaryCaseEvents: function (options) {\r\n        var self = this;\r\n        var def = $.Deferred();\r\n        var idCase = options.idCase || '';\r\n\r\n        $.when(\r\n            self.getCaseEvents({\r\n                idCase: idCase\r\n            })\r\n        ).done(function (events) {\r\n            events['showEvents'] = (events['events'].length >= 1) ? true : false;\r\n            def.resolve(events);\r\n        }).fail(function(error){\r\n            def.reject();\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /*\r\n     * Render Details\r\n     * @param idWorkitem\r\n     */\r\n    summaryCaseDetails: function (options) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var idWorkitem = options.idWorkitem || 0;\r\n\r\n        $.when(\r\n            self.getCaseSummaryDataContent(options)\r\n        ).done(function (data) {\r\n            data.currentState = data.currentState || [];\r\n            var dataCurrentStateLength = data.currentState.length;\r\n            // Show or hide tabs\r\n            data.showEvents = (data.countEvents >= 1) ? true : false;\r\n            data.showParentProcess = (data.idParentCase >= 1) ? true : false;\r\n            data.parentProcess = {\r\n                \"displayName\": data.parentDisplayName,\r\n                \"idCase\": data.idParentCase\r\n            };\r\n\r\n            //data.isOpen: if request have onlyUserWorkItems = true, so verify workitems of current user\r\n            //data.isClosed: if request have onlyUserWorkItems = false, not verify workitems of current user\r\n            data.isClosedForAllUsers = bizagi.util.parseBoolean(data.isClosed);\r\n            data.isClosed = (bizagi.util.parseBoolean(data.isOpen)) ? false : true;\r\n            data.showAssignees = (bizagi.override.showAssignees && data.countAssigness > 0) ? true : false;\r\n            data.showSubProcess = (data.countSubProcesses > 0) ? true : false;\r\n            data.showForm = (bizagi.util.parseBoolean(data.hasGlobalForm)) ? true : false;\r\n            data.allowsReassign = \"false\";\r\n\r\n            for (i = 0; i < dataCurrentStateLength; i++) {\r\n                if (data.currentState[i].idWorkItem == idWorkitem) {\r\n                    data.allowsReassign = data.currentState[i].allowsReassign;\r\n                }\r\n            }\r\n\r\n            // edit original data, no show events in activities tab\r\n            var currentStateTypes = [];\r\n            var m = 0; // counter for new activities array\r\n            for (i = 0; i < dataCurrentStateLength; i++) {\r\n                if (!bizagi.util.parseBoolean(data.currentState[i].isEvent) && bizagi.util.parseBoolean(data\r\n                        .currentState[i].assignToCurrentUser) && data.currentState[i].idWorkItem != idWorkitem) {\r\n                    currentStateTypes[m++] = data.currentState[i];\r\n                }\r\n            }\r\n\r\n            data.currentStateTypes = currentStateTypes;\r\n            data.showActivities = (currentStateTypes.length > 0) ? true : false;\r\n\r\n            def.resolve(data);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    releaseActivity: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"case-handler-releaseActivity\");\r\n        url = url.replace(\"{idCase}\", params.idCase);\r\n        var data = {};\r\n        // Define data\r\n        if (params) {\r\n            data[\"idCase\"] = params.idCase;\r\n            data[\"idWorkItem\"] = params.idWorkItem;\r\n        }\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: url,\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\"\r\n        });\r\n\r\n    },\r\n    /**\r\n     *\r\n     * Segment Activities for summary in render module\r\n     * @param options {data,idWorkItem}\r\n     */\r\n    summaryActivities: function (options) {\r\n        var activities = {};\r\n        var data = options['data'] || {};\r\n        var idWorkItem = idWorkItem || options['idWorkitem'] || 0;\r\n\r\n        try {\r\n            activities['showActivities'] = (data['currentStateTypes'].length >= 1) ? true : false;\r\n            activities['currentState'] = data['currentStateTypes'];\r\n            activities['globalIdWorkitem'] = idWorkItem;\r\n            activities['creationDate'] = data['creationDate'];\r\n        } catch (e) { }\r\n\r\n        return activities;\r\n    },\r\n    /**\r\n     *  Get json from cases service\r\n     */\r\n    getCaseSummaryDataContent: function (options) {\r\n        var self = this;\r\n        var promise = new $.Deferred();\r\n\r\n        $.when(self.getCaseSummary(options))\r\n            .done(function (data) {\r\n                // Completes data\r\n                data.taskState = self.icoTaskState;\r\n                data.process = data.process ? data.process : \"\";\r\n\r\n                if (data.createdBy) {\r\n                    data.createdByName = data.createdBy.Name;\r\n                    data.createdByUserName = data.createdBy.userName;\r\n                    data.caseDescription = (data.caseDescription == \"\" ? \"\" : data.caseDescription);\r\n                    data.processPath = data.processPath.replace(/\\//g, \" > \") + data.process;\r\n                    data.showWorkOnIt = true;\r\n                }\r\n\r\n                // return json content\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise.promise();\r\n    },\r\n    /**\r\n     * Definition service for bizagi smart folders\r\n     *\r\n     * @param id optional with filter purpose\r\n     */\r\n    getSmartFolders: function (id) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.idFolder = id || '';\r\n        // Call read and returns promise\r\n        return $.read(self.serviceLocator.getUrl('folders-handler-getUserQueries'), data).pipe(function (response) {\r\n            if (id == -1 || id == '') {\r\n                return response;\r\n            } else {\r\n                return self.searchFolders(id, response) || [];\r\n            }\r\n        });\r\n    },\r\n    /**\r\n     * Delete smart folder\r\n     * @param options {idSmartFolder,idUser}\r\n     */\r\n    deleteSmartFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '6';\r\n        options = options || {};\r\n\r\n        data.idSmartFolder = options.idSmartFolder || '';\r\n        data.idUser = options.idUser || '';\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('folders-associate-deleteSmartFolder'), data);\r\n    },\r\n    /**\r\n     * Definition service for bizagi folders\r\n     *\r\n     * @param id optional with filter purpose\r\n     */\r\n    getFolders: function (id) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = 'getUserFolder';\r\n        data.idFolder = id || '';\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            type: 'POST',\r\n            data: data,\r\n            dataType: 'json'\r\n        }).pipe(function (response) {\r\n            if (id == '') {\r\n                var folders = {\r\n                    folders: [{\r\n                        name: bizagi.localization.getResource('workportal-widget-folders'),\r\n                        id: '-1',\r\n                        idParent: 0,\r\n                        childs: response\r\n                    }]\r\n                };\r\n                return folders;\r\n            } else if (id == -1) {\r\n                return response;\r\n            } else {\r\n                return self.searchFolders(id, response) || [];\r\n            }\r\n        });\r\n    },\r\n    searchFolders: function (idFolder, data) {\r\n        for (var i = 0; i < data.folders.length; i++) {\r\n            var value = data.folders[i];\r\n            if (value.id == idFolder) {\r\n                return data.folders[i]['childs'];\r\n                break;\r\n            }\r\n        }\r\n        return undefined;\r\n    },\r\n    getCasesByFolder: function (query) {\r\n        query = query || '';\r\n\r\n        return $.ajax({\r\n            cache: true,\r\n            url: 'RestServices/' + query,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    makeFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = 'CreateUpdateFolder';\r\n        data.folderName = options.folderName || 'No Name';\r\n\r\n        // Make folder under subcategory\r\n        if (options.idParentFolder != undefined && options.idParentFolder > 1) {\r\n            data.idParentFolder = options.idParentFolder;\r\n        }\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    updateFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n        options = options || {};\r\n\r\n        data.action = 'CreateUpdateFolder';\r\n        // Define idFolder\r\n        data.idFolder = options.idFolder || '';\r\n\r\n        // Update name\r\n        if (options.folderName) {\r\n            data.folderName = options.folderName;\r\n        }\r\n\r\n        // Update path\r\n        if (options.idParentFolder) {\r\n            data.idParentFolder = options.idParentFolder;\r\n        }\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Associate cases to folders\r\n     *\r\n     * @param options {idcase,idCustomFolder}\r\n     */\r\n    associateCaseToFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '4';\r\n        options = options || {};\r\n\r\n        data.idCase = options.idCase || '';\r\n        data.idCustomFolder = options.idCustomFolder;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-associate'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     * Dissasociate cases to folder\r\n     *\r\n     * @param options {idFolder, idCase}\r\n     */\r\n    dissasociateCaseFromFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = 'DeleteCaseFromFolder';\r\n        options = options || {};\r\n\r\n        data.idFolder = options.idFolder;\r\n        data.idCase = options.idCase;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Delete folder\r\n     * @param options {idCustomFolder}\r\n     */\r\n    deleteFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '5';\r\n        options = options || {};\r\n\r\n        data.idCustomFolder = options.idCustomFolder || '';\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-associate'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Gets a file binary from the server\r\n     * @param options {fileId}\r\n     */\r\n    getFile: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = this.serviceLocator.getUrl('file-handler');\r\n        options = options || {};\r\n\r\n        data.action = 'getFileContent';\r\n        data.uploadId = options.uploadId || '';\r\n        data.entityId = options.entityId || '';\r\n        data.entityKey = options.entityKey || '';\r\n\r\n        return bizagi.services.ajax.pathToBase + url + '?' + jQuery.param(data);\r\n    },\r\n    /**\r\n     * Get Comments per case\r\n     * @param params {idCase=int&idColorCategory=int&pag=int&pagSize=int}\r\n     * @return json\r\n     */\r\n    getComments: function (params) {\r\n        //params.idCase = params.idCase || 0;\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        return $.read(encodeURI(self.serviceLocator.getUrl('MessageHandler-GetComments')), {\r\n            idCase: params.idCase || '',\r\n            idColorCategory: (typeof params.idColorCategory == 'number') ? params.idColorCategory : '',\r\n            pag: params.pag || 1,\r\n            pagSize: params.pagSize || 10\r\n        })\r\n            .pipe(function (result) {\r\n                var def = new $.Deferred();\r\n                var picture = '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';\r\n                if (!result.comments) {\r\n                    result.comments = [];\r\n                } else {\r\n                    // Add CategoryColor for each comment\r\n                    $.each(result.comments, function (key, value) {\r\n                        if (!result.comments[key].hasOwnProperty('CategoryColor')) {\r\n                            result.comments[key]['CategoryColor'] = '';\r\n                        }\r\n                    });\r\n                }\r\n                if (!result.users) {\r\n                    $.when(self.getCurrentUser())\r\n                        .done(function (user) {\r\n                            result.users = [];\r\n                            result.users.push({\r\n                                Id: user.idUser,\r\n                                Name: user.user,\r\n                                DisplayName: user.userName,\r\n                                Picture: picture\r\n                            });\r\n                        });\r\n                } else {\r\n                    $.each(result.users, function (key, value) {\r\n                        // Add picture to all users\r\n                        result.users[key]['Picture'] = (result.users[key]['Picture'] === '') ? picture : result.users[key]['Picture'];\r\n                    });\r\n                }\r\n                def.resolve(result);\r\n                return def.promise();\r\n            });\r\n    },\r\n    /**\r\n     * This function allow create new comment into the activity\r\n     *\r\n     * @param options {idCase,comment}\r\n     * @return json\r\n     */\r\n    makeNewComment: function (options) {\r\n        var self = this;\r\n        var picture = 'iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABJwSURBVHhe7Vt5UJPnuj+ddvSqdcpotQougCyGRfY9QCQQwhKIrAqurUtbbbVV1KO2UrXH46lL1aOOdWvrcl3QuosIBUSGongA5bLXqLjCVbarrX/97vO8SSAieLRVJ86czPwmX0L8vve3PM/7vp/JX/7yn8d/FHhVCkykC+144403NL16vQ1TU1MtBpqiR48eoL8VE9YQnF/VgF7VdVLffPPNRkdHJ0SER0CpDIdCEYqQkBAtgvlZgdDQUHh5ecHMzIzFyCbIXtUAX9Z12MliN1c3JCcnIzkpGWp1jCBrSD6YBAgODoZczpALBMmCYGFhwULsIJi8rAG+zPM6s+vseGLiaMTFxSM2JlaQl8lkAoGBgQgMCERAQAD8/f0hlfrDz88Pfr5+8PX1FXByctKXxmslgiAfEqxAdFQ0VKooqCJVwnVvb1+Ct4i6l6cXPDw8CR5wd3OHm5sbXF1d4ezMcIYTlQwLYGNjoxfhZRr2ws7NTmm8vLwRSnWuIMelflK46kkRISbl6OAIB4K9vT3s7ewhkdgRJLC1sRWEra2tYWVlhWHDhonnPn36sAjcII3+kWplZQ0Pd08RYXt7Bx0pW0FKT8xqmBUsLYfB0sISFkMtMHToUAwZPASDBw8WTdDU1AwDBw4UGDBggAClikUwN2YFTLp37y5izvFlId7t+y4G9B8gSGmJaae9gQO0xPr3649+/fqJz/UlsNN9TPrAxMRE4J133hGf43RwEnRN0Wg1mMVR5q5vQc72pLl99sfj0b3bW3j77beJYF8t+vRtI9qjR0+80/sdIqoly8e9e/d+DJaWlrC1tRXlwn8z5lmh2MvTm2rYFt26dcOSeTNQnn8U2Ue2w8pyCHp076EjTwIIl/vgrbfeYkKCGAvQ+ykCcAq4VOjzE40xAiYm5CIvdvpRrHv26I6a8+nQXMxAbdFpFGcfxJTx8YIsk9fHnB3n9xicho7uc3K4D3ACGNxDjLUZyrh+hwwZSvXcD3J/T1wrPYNrJRkC10uzUPFLOnZvWQ13Zwf06tVL29yoPzBJqZc7fD2cRaN7913qG/Q3fuY+wKLwbMACGKwSjS4EsoHU3MzMBoOTwLVfV5pJOCNw41I2bpadxbVLubiUn46VyxZhYP9+QghujBx/pVyKr+d/goH9+gpRWAR2n4Xg1wwWmfcSRsee65IF4O7OdTxn+gTcvJyFm5cyBW6V5eB2xTncrvoFd2qKoLmcj5L8DHy37hsE+HmR828xMVgOMcWejcsw98MkSN3tRY/gBOgF4EToSsbo+oBMTG0UaRZg/fL5uFOWTcgSuFuRi7uV+aivKUTDlYtouFqKe9fLUVddgrLCLGQc/hGLPp+GQF83mPZ/F9tXzkPegfU4vHkJUmeOx9houSCuE4B3jWpjS4GMu3p/FuDtXqgsOIr6ihzUl2cLNFSeRUN1Ae7VXsD9qyVovH4JTTcq0XyrBo115bhbfQG1FzJQmrUfpWd24VbREdwpOoTrBftQkfk9StO3GApglCtCE65nruUFMz8gwrm4V0WozCHkorEmH02a82i5XoLWG5fx8E4VHt6txcP6q3hwuwotdaVovHIe96vO4l7ZGTSUHkd98WHUXzxEOIj6ojT4eziAF1rkfKqxuS/G06vHfzXy9HZo+2oikovmmjy01BKunEPr1UI8uF6EhzdK8dvtcvx2txq/37uKR/ev47f6WvHew7pitF4pQFNlFu5dOoF7JUcIh3Gv+BDukQiBXo7o2bMnkiOkvEU2rsepTYsmTklQigXQ0R/XoonIN1ZRCVzOQF3RUdy4eAI3S07jFs0It2hGaL5eSgJo8KhRJ8CtMjRQn7hRdBx1hRT9/L24lrcL1wm3C/eRAGmQ+7qKafIfcyfjxIZFxtUDTmxamHpwy3JRp0d/WIP6skxcPX8ENXn7tTiXhqqzB1CZewDl2VTXOQdwX1NCCbhGCagRopRn7iLsRGXWTlRR3ddkfY/abC2uZG+Hr6stYkOlyNi9Fic3LphlVBFgRzL3rINc6o7D36+ixpeJO5cycLs0nVxnZBDJLJoOc2k9kIfawpO4XpzZJoCm8DiuFaWjrphw4QjqqPnV5e/GDcJNwp3CvVi9YDLy9qxC5u7VOLVpocyoBDi1abH52X1ryZ3VKCMn66mRNVVlaxtaWQYayrNoVshFfRVNhdWFtCYowNWiDDy6RwmgfnC7/BzulucK0e4UH8edC2m4c36fQP2FfWgsPoCajC24eHQT8ug6P61ZbGJUAvBgzmxdqrlB7p3bv0643lKdQ6B6r8pCU3Uu9QWaCa4UounqRTReLUZFbppohCwAv3e/Oh/3K7Jx/3K6aH73i9MEGhkXqXRObsSVvL04tflLXgcY34PLoOjwP5Gz8x+4UXyCunkmWog8o5Vmg1bNLzQTXMRvNBM0XrlgIECVeO/htfNorTmLlvIMNJUeQWPJwTbyjRf345e934DPb3QN0NAKHtzhdXM1tef2o+HyaTSTCM1VmYJYq6YAD64VCbL1tCoUCWjQUAJ0AtBU2UpJaSk/TQIcfox8w/k9OLFxocaoyeuFOLouRV14aANulxwnAc4IEVprcmmOzycBLtB8X4o62iZX5OgEuFOpTYCGBchBc5lOAIo9O8+ozviOGt8io1v/d1mHxzYs1Fw7fwjNFRlCBCbWWnsOD66eJwFKUJ13SEyFIgFCgBI8oBJpocbZXJaOppJDbeRZgPzdf2/8aYcRNr6uFDi4NiW1NH0bLWlPCBFaqRlqBShEMy159WuB3xuuCAFYlAdUIkKAyydJAKp/nfvXcraT+18a5fq/ywTwNJW+dUljXeFBNFNTa9U1wgcU84fXi2lKzKOF0SFKAAlwu0IrAC2DW2gZ3HyZGqiBAOQ+Tu1Ybm58bf/fjIhTUHhwPRrJ0RbRB86KmD/kmeDmJXK+Cr/XswC0DyBRHlCP6CgAu396y1fGufl5FkfSVqdoNDR3t3AfoEbILrcLUEkC6DZCJEpHAbjzZ21bguzXqfY7inJk/bzU01uXUC84KRohk3yomwq59oUAtBFiUToKUHKI1vybv+D9xev7OLBqdmpe2gZcOLIJTRVZbQJot8UsQE2nAlRnbEPe7hU4s33p6y3AwbVzf6osPIHMXatQcnIbWmib/OAqrQWEABWdClCbsxOZ25eh/DSt/SkFp79b7PzaRuDExkXZdbQLrCg4JkS4cGwrmmupD9BiqDMBanL3kOvLaNOzgTZB+3Hp2Aac2rLYuHZ+z+PGqiUp2Q/qLtJuLwdVdJ/wwvFtyPh+BYpP78QN+r8C3gXepnsB1WfTkLNrJU5Sv/jl0HrcKNgjFkNHvluKxTMnvz4rQBYnOjraPDIycs1IpVrj6S9HQcY+tNISuJlmgJt0X6A0ay/O7F2Hw0Ru/7qF+OGbFPy4ai69XoJ8mjYr6WYI3wW6SSKMT1TDL3oilFHxGpVKlcrnfh4DXulnaYATw1SjsmWxk+GS/CXsx6+Ac9znUCpCsHPzSnFfkPcDfHOk/Ox+nDv8HY5uX4E9//wSaXT7+wwl4PyRjUIAvgs8LoHIK+NgN26FOBefk8/N1+BrvVJyXV2MHWFnFOrRjd6jZ8Nx3NdisIbwSPgMsuBQxKhV2LlpBUqz9wsBCqgfnPxxVZsAx7b9DdtWzkfK9IniuwU+ihjYJS974nx8Db5WaFR8oy4VJq9cDF3Md4SMGgv3pAVPDLKjCE5jl0AaMxUjQ1Xi+0BMcNzoWIyJi0K8OgKhIXLx/SD+3pBvRBJcEufDTgj5d9iPM8Ryek0Yuxx2BLfR8xE8KhlUcjteSXnQRUxY9Wcl3lEIJuSS9AU8ElPgE/shvEZNE3CLm0mk5wlSdmP/pkUy42sDLINdkh5L6ZgwZikkBNeEFMjVSS83EeHh4c4RqlGaJx0nh/6NU12SaiPExLSE9KQkY5YQOcJoxlftSEyFpA2LIUnQYjjBPXYm94hiHusLLQs+oUKd2OiYTAPUxe+FkUokck8hNTzhSwyPZ3zxOOIWYXgbFmJ4rBZ2sfMQokpofGEicOzDyXmHMam6CHblkoFTTyVFZDojFUcEuyBlG7sAAjGMvz6OUfNhKzBPC/U8SNRzKAnqF3PzlOd01/g5HVziGLZHTxB6UaRGEcFOSDExG/VcLaIZKe2IouOoOTrMpufZcFVNo+8oqv7cVppjFKQeB4lBBG05ap04xe936VQbocedsnkqKT0hfiZSqnZYqz6HdaQen9GxFlbhn8I6YlYbRqpG40/NDqRgtnM8RSquPX7Dwj/RRvAFkrImcl2RMiRkHTET1uHtYMJWYYxPBCxDpmFY6HRYKWfAOmwGHCI+FlPkH2qIERERsqBRE+AQvwCSmPlt8bMImdohfp07JQh15lTEZ1i3Ox38SJ6/ntzqQKgDKUFOyZhhACLJRHUYFvoxhik+hqV8MsxHTqLjj2BN7w0PnwGZaswfSwG5/5M71b5j7HxqKlRjOpcGS8c8GT+D2GkdezqpdbtOagWYu7ZTUoKQjhSTaUMIHYd82I5gcrwNU2FB5If4jSEhpsCa0jBc+RGcwqc9fwq4buRU+y7x8+EYkwJJ1OewIWIWwVMwyDtO1FrH+GmdMnSJjzu4pCO1dudxIUDSnNXwSpiDUdO/hrN6lpaYASnL4KkQkDOmtCOIjoMm6/ABLEdqMVSaDDP3aDp+H9aUBoliGhzCPoI8MuH5UsCd3yd2BlxiU+Co/hwSFblKNTVEmgQzrxhRaxy/rp0ycKkTUmt/OCoE+HHPfvz888/49ddf8ejRI6Sl58M5imo5qJ0UE7MgQhYyPSbRsQ6BE2HRhgkY4pOIAU6hsAycAOugSZCETIaDciq8wyfwjDDrmXtBuCpW4xGfApcY2uBEzYIk4hNRU4O8YmHmqYYFDdAweu0uGTj1mEvsVjupb78/IgRYunIjZi5eg282/zf+936TeC8j71+PkbIImAA9zAPGw9xfj3F0rIN0LMwJg73i8J6DHOa+o2EtmwCJfBIcFZPhpJwCZYT62b5ep5/6PGJnw4Vi6Rj5CSRhH8Oa4jTQOUxEjFXXRtDQKXKoM6cec4kdm4Bvd/wkyI7+dDn0pEaEfYjm1gfifWn8Z4JQO5Jh7qdHEob6EXwZY9rhMwaDPWLwnn0QhnrGwDpgLCQjJ8AxZBJclJMRGJaAZ1od8uJBGvMhPGJmwSXqUzjSVCIJnQZrqn8+uambSijfHj0iZeCSBbvUmVMGhNZsOyiITv3rah0xLamCf5WL9xOnL9ESI1JDfUa3wzsRQ9uQgCFeesTTcTwGuUXjPYkMg8goG/8xkMjGwlE+AS6KSfBUJD9TGXQjlU66Rc2Ah/pTuKimw5GcsVNQVw16H/1s/WDqEikGK+L3mEvkWJtL7JbepY5OjcZX3/4giBZc/J82QmHj5rYlwFc9XRAS8NQjjo518IjFkDbEYLC7FoNcVHhveCAGjQiBjV8iJAFJGBE0Fi4hE+AUNI6325upDwwjvNlVP3DkD/lEvg/P6OlwjfgII6iJ2AW/Dyv/JPRnAUhd4cpj8TNwif9m4NJQ7yedciBX6m7VCxH4mYVobvk/8XrrnmNErp3UYPdRRI7gxlAbIBqDXQ0RBTOncAwY7o+BBBvfOEj8EzFCRvcX5OMgVSbS75KkK4m4G0HSlQBu9J1+mUKhyB6pSoZb+GSMUHwAuyCqee8Y9LfxhamTUufO4/HTOmXgEh8buNSRlI9qKgqKLgvS/GABtu4++gSpQS5R5CxDpYUzI7IdThEYpIOZoxIDbKUYaOMDGxqvnV88nAMTEUi31pgTc9MJwCJ0+uiv/wD9tmeqUqnMDoqIp/qhxY831Red2NRRIZoNE3p+p6KIoJ6QISkDQkzOgNQgcpVhNoJBTZjhqIeSjnVwCIWZfQgG2PhhkK0PPGVqyJVq+p2iMpu5GBBn8n2fNiX21tUJf1AkwsfHJ5V+23csSBF5y1sWCSf/aEh89PH7g6QEoY6kDAgxMSbVBgURVMBUIKQddiGwdQuFs68SvrJwjJSH3eKx8pg7OM58zAndnnU9wI2CleJ/5KhXkE/KinKv4AvJFcoiaVDErYDgSHgERMKdYO8dgeGe4QJWbkRS79JzkDK1C4aVi0KQs3VTwM4jFO7SMAH/oHBIRypvyYNDi+iHlnt4LDymTgjzuHn8zKPLxvesgrByJgRTXUJsOsRKpIUHwmAHeGCG4DqkSBY9DSxqx39Hvy2crT9vJyRFUgk8Hu7wPD4e5zM7/awCdPU5VpbLhsE9hAdgKBIPTA/njqJ18Zo/Z/jvDMnxufk6+mv+qfH/Pz9r9qvYcZe2AAAAAElFTkSuQmCC';\r\n        return $.create(self.serviceLocator.getUrl('MessageHandler-NewComment'), {\r\n            idCase: options.idCase || '',\r\n            comment: options.comment.replace(/\\n/g, '<br>') || ''\r\n        })\r\n            .pipe(function (result) {\r\n                if (result.comments) {\r\n                    var comments = [result.comments];\r\n                    $.each(comments, function (key, value) {\r\n                        // Add CategoryColor for each comment\r\n                        comments[key]['CategoryColor'] = '';\r\n                    });\r\n                    result.comments = comments;\r\n                }\r\n\r\n                if (result.users) {\r\n                    var users = [result.users];\r\n                    $.each(users, function (key, value) {\r\n                        // Add picture to all users\r\n                        users[key]['Picture'] = (users[key]['Picture'] == '') ? picture : users[key]['Picture'];\r\n                    });\r\n                    result.users = users;\r\n                }\r\n\r\n                return result;\r\n            });\r\n    },\r\n    /**\r\n     * This function allow create new replies into the comment\r\n     *\r\n     * @param options {idCase=int&idComment=int&comment=string}\r\n     * @return json\r\n     */\r\n    makeNewReply: function (options) {\r\n        var self = this;\r\n        var picture = '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';\r\n\r\n        options = options || {};\r\n\r\n        return $.create(self.serviceLocator.getUrl('MessageHandler-ReplyComment'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || '',\r\n            comment: options.comment.replace(/\\n/g, '<br>') || ''\r\n        })\r\n            .pipe(function (result) {\r\n                if (result.comments) {\r\n                    result.Replies = [result.comments];\r\n                }\r\n\r\n                if (result.users) {\r\n                    var users = [result.users];\r\n                    $.each(users, function (key, value) {\r\n                        // Add picture to all users\r\n                        users[key]['Picture'] = (users[key]['Picture'] == '') ? picture : users[key]['Picture'];\r\n                    });\r\n                    result.users = users;\r\n                }\r\n\r\n                return result;\r\n            });\r\n    },\r\n    /**\r\n     * Remove one comment from the list in mobiles\r\n     *\r\n     * @param options {content:{guid:\"...\"},attachmentsToDelete:[\"...\", \"...\", ...]};\r\n     * @return json {action:true|false, message:'if error, explain why'}\r\n     */\r\n    removeMobileComment: function (options) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('remove-comment');\r\n\r\n        options = options || {};\r\n\r\n        return $.destroy({\r\n            url: url,\r\n            data: JSON.stringify(options),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Remove one comment from the list\r\n     *\r\n     * @param options {idCase=int&idComment=int}\r\n     * @return json {action:true|false, message:'if error, explain why'}\r\n     */\r\n    removeComment: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('MessageHandler-RemoveComment'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || ''\r\n        });\r\n    },\r\n    /**\r\n     * Remove one replies from the list\r\n     *\r\n     * @param options {idCase=int&idComment=int&idReply=int}\r\n     * @return json {action:true|false, message:'if error, explain why'}\r\n     */\r\n    removeReply: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('MessageHandler-RemoveReply'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || '',\r\n            idReply: options.idReply || ''\r\n        });\r\n\r\n    },\r\n    /**\r\n     * Rename category\r\n     *\r\n     * @param options {idColorCategory=int&colorName=string}\r\n     * @return json\r\n     */\r\n    renameCommentCategory: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.update(self.serviceLocator.getUrl('MessageHandler-RenameCategoryColor'), {\r\n            idColorCategory: (options.idColorCategory >= 0) ? options.idColorCategory : '',\r\n            colorName: options.colorName || ''\r\n        });\r\n    },\r\n    /**\r\n     * @param options {idCase=int&idComment=int&idColorCategory={0-5}}\r\n     * return json\r\n     */\r\n    setCommentCategory: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.update(self.serviceLocator.getUrl('MessageHandler-SetCategoryToComment'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || '',\r\n            idColorCategory: (typeof options.idColorCategory == 'number') ? options.idColorCategory : ''\r\n        });\r\n    },\r\n    /**\r\n     * @return json Definition of all categories of message\r\n     */\r\n    getCommentsCategories: function () {\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('MessageHandler-GetCategoryColors'))\r\n            .pipe(function (result) {\r\n                if (result.length > 1 && result[0]['categories']) {\r\n                    return result[0];\r\n                } else {\r\n                    return result;\r\n                }\r\n            });\r\n    },\r\n    /**\r\n     * This service can be define number of new comments based on idComment\r\n     * @param json  options {idCase=int, idLastComment=int}\r\n     * @return int\r\n     */\r\n    getNewComments: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.read(encodeURI(self.serviceLocator.getUrl('MessageHandler-CountNewComments')), {\r\n            idCase: options.idCase || 0,\r\n            idComment: options.idComment || 0\r\n        });\r\n    },\r\n    /**\r\n     * Get all analisys queries\r\n     * @return json\r\n     */\r\n    getAnalisysQueries: function () {\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('bamAnalytics-handler-getAnalisysQueries'));\r\n    },\r\n    /**\r\n     * Update name and comment\r\n     *\r\n     * @param options json {queryName,queryDescription,idQuery }\r\n     * @return json  {response:true}\r\n     */\r\n    updateQueries: function (options) {\r\n        var self = this;\r\n\r\n        return $.update(self.serviceLocator.getUrl('bamAnalytics-handler-updateQuery'), {\r\n            idQuery: (options.idQuery >= 0) ? options.idQuery : '',\r\n            queryName: options.queryName || '',\r\n            queryDescription: options.queryDescription || ''\r\n        });\r\n    },\r\n    /**\r\n     * Delete query\r\n     *\r\n     * @param queryId integer\r\n     * @return json  {response:true}\r\n     */\r\n    deleteQueries: function (queryId) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '1612';\r\n        data.QueryId = queryId || '';\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('reports-handler-deleteQueries'), data);\r\n    },\r\n    /**\r\n     * Get bizagi configuration\r\n     * @param {Function}   type    callback function when the file load is succed\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    getConfiguration: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"authenticationConfig\");\r\n\r\n        return $.read(url);\r\n    },\r\n    /**\r\n     * Logout Service\r\n     */\r\n    logout: function () {\r\n        var self = this;\r\n        // Remove session storage of authentication data\r\n        sessionStorage.removeItem('bizagiAuthentication');\r\n\r\n        //Call to the restfull service for domain list\r\n        try {\r\n            var javaLogout = $.create(self.serviceLocator.getUrl('logout'));\r\n\r\n            $.when(javaLogout).done(function () {\r\n                location.reload();\r\n            }).fail(function () {\r\n                bizagi.log('Error logging out');\r\n            });\r\n        } catch (e) { }\r\n    },\r\n\r\n    /**\r\n     * Logout from different types of services\r\n     * This method can reload the page after calling the logout service required\r\n     */\r\n    logoutMobile: function() {\r\n        var self = this;\r\n        var logoutData = { sourceLogout: \"user\" };\r\n\r\n        // Remove session storage of authentication data\r\n        sessionStorage.removeItem(\"bizagiAuthentication\");\r\n\r\n        // Hybrid will use normal system\r\n        if (bizagi.util.isCordovaSupported()) {\r\n            var url = self.serviceLocator.getUrl(\"logout\");\r\n            return $.create(url);\r\n        } else {\r\n            // Call to the restfull service for domain list\r\n            try {\r\n\r\n                $.when(self.getConfiguration()).done(function (data) {\r\n                    if (data.redirectErrorPage) {\r\n                        window.location.href = data.redirectErrorPage;\r\n                        return;\r\n                    }\r\n\r\n                    var authenticationType = data.authenticationType;\r\n                    switch (authenticationType) {\r\n                        case \"Federate\":\r\n                        var logOffURL = data.logOffURL;\r\n                        var federationLogoutBindingProtocol = data.federationLogoutBindingProtocol;\r\n\r\n                        if (authenticationSubType === 'WSFederated') {\r\n                            $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData)).done(function () {\r\n                                location.href = logOffURL;\r\n                            }).fail(function () {\r\n                                bizagi.log(\"Error logging out\");\r\n                            }).always(function () {\r\n                                location.href = data.logOffURL;\r\n                            });\r\n                        }\r\n                        else if (authenticationSubType === 'Saml') {\r\n                            var param = {};\r\n                            $.when($.read(self.serviceLocator.getUrl(\"FederateLogoffUrl\"), param)).done(function (res) {\r\n                                if (res.federateLogoffUrl) {\r\n                                    logOffURL = res.federateLogoffUrl;\r\n                                }\r\n\r\n                                $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData)).done(function () {\r\n                                    if (federationLogoutBindingProtocol === 'POST') {\r\n                                        window.document.open('text/html');\r\n                                        window.document.write(logOffURL);\r\n                                        window.document.close();\r\n                                    }\r\n                                    else {\r\n                                        window.location.href = logOffURL;\r\n                                    }\r\n                                }).fail(function () {\r\n                                    bizagi.log(\"Error logging out\");\r\n                                }).always(function () {\r\n                                });\r\n\r\n                            }).fail(function () {\r\n                                bizagi.log(\"Error logging out\");\r\n                            }).always(function () {\r\n                            });\r\n                        }\r\n                        break;\r\n                    case \"SAML\":\r\n                        loader.nativeAjax(loader.getPathUrl(self.serviceLocator.getUrl(\"logout\"), logoutData),\r\n                            function(response) {\r\n                                var jsonResponse = JSON.parse(response.responseText);\r\n\r\n                                if (jsonResponse.logout === true) {\r\n                                    if (typeof jsonResponse.samlUrlRedirect != \"undefined\") {\r\n                                        var url = decodeURI(jsonResponse.samlUrlRedirect);\r\n                                        var iframe = document.createElement(\"iframe\");\r\n\r\n                                        document.getElementsByTagName(\"body\")[0].appendChild(iframe);\r\n\r\n                                        $(iframe).on(\"load\", function() {\r\n                                            var iframeContent = bizagi.util.isIE8() ?\r\n                                                $(this.contentWindow.document.body) :\r\n                                                $(this.contentWindow.eval(\"document.body\"));\r\n                                            var rawResponse = iframeContent.text();\r\n\r\n                                            location.reload();\r\n                                        });\r\n\r\n                                        iframe.src = url;\r\n\r\n                                    } else {\r\n                                        location.reload();\r\n                                    }\r\n                                } else {\r\n                                    bizagi.log(\"Error logging out\");\r\n                                }\r\n                            });\r\n                        break;\r\n                    case \"OAuth2\":\r\n                        $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData)).done(function() {\r\n                            $.when($.read(self.serviceLocator.getUrl(\"oauth2AuthenticationConfig\")))\r\n                                .done(function(response) {\r\n                                    if (response.logoutUrl && response.logoutUrl != \"\") {\r\n                                        var logoutUrl = response.logoutUrl;\r\n                                        var callbackUrl = response.homeUrl;\r\n\r\n                                        logoutUrl = logoutUrl.replace(/post_logout_redirect_uri=[^&]*/,\r\n                                            \"post_logout_redirect_uri=\" + callbackUrl);\r\n                                        location.href = logoutUrl;\r\n                                    } else {\r\n                                        location.reload();\r\n                                    }\r\n\r\n                                }).fail(function() {\r\n                                    bizagi.log(\"Error logging out\");\r\n                                });\r\n                        }).fail(function() {\r\n                            bizagi.log(\"Error logging out\");\r\n                        });\r\n                        break;\r\n                    default:\r\n                        //Normal\r\n                        $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData))\r\n                            .done(function() {\r\n                                window.location = bizagi.services.ajax.loginPage;\r\n                            }).fail(function() {\r\n                                bizagi.log(\"Error logging out\");\r\n                            });\r\n                        break;\r\n                    }\r\n                }).fail(function(message) {\r\n                    bizagi.log(message);\r\n                });\r\n            } catch (e) {\r\n                bizagi.log(e);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Services for Massive Activity Assignment\r\n     */\r\n\r\n    /*\r\n     * Obtain the organization info, such as roles, skills or locations. One of this options\r\n     * must be specified as a parameter\r\n     * @param object  {objectType=Roles|Skills|Locations}\r\n     * @return json\r\n     */\r\n    getOrganizationInfo: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['objectType'] = params;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-getOrganizationInfo'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Get Cases By Organization, using parameters suchs as roles, skills and locations\r\n     * @param object  {roles=(string),roles=(skills), locations=(string)}\r\n     * @return json\r\n     */\r\n    getCasesByOrganization: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n\r\n        data['roles'] = (params.roles) ? '[' + params.roles.toString() + ']' : '[]';\r\n\r\n        data['skills'] = (params.skills) ? '[' + params.skills.toString() + ']' : '[]';\r\n\r\n        data['locations'] = (params.locations) ? '[' + params.locations.toString() + ']' : '[]';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-getCasesByOrganization'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Get Cases By Organization, using parameters suchs as roles, skills and locations\r\n     * @param object  {user=[array], roles=(string),roles=(skills), locations=(string)}\r\n     */\r\n    reassignCases: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['users'] = (params.user) ? '[' + params.user.toString() + ']' : '[]';\r\n        data['roles'] = (params.roles) ? '[' + params.roles.toString() + ']' : '[]';\r\n        data['skills'] = (params.skills) ? '[' + params.skills.toString() + ']' : '[]';\r\n        data['locations'] = (params.locations) ? '[' + params.locations.toString() + ']' : '[]';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-reassignCases'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     * Search the users inside the Organization, using parameters suchs as userName, full name, domain, roles, skills and locations\r\n     * All parameters are optional\r\n     * @param object  {userName=(string), fullName=(string), domain=(string), roles=(string),roles=(skills), locations=(string)}\r\n     * @return json\r\n     */\r\n    searchUsers: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['userName'] = params.userName || '';\r\n\r\n        data['fullName'] = params.fullName || '';\r\n\r\n        data['domain'] = params.domain || '';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-searchUsers'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Get json with bizagi domains list\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    getDomainList: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('domains');\r\n\r\n        return $.read(url);\r\n    },\r\n    /**\r\n     * Services for Asynchronous ECM Upload\r\n     */\r\n\r\n    /* Get the ECM Pending Scheduled Jobs\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    getEcmAllScheduledJobs: function () {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        data['action'] = 'getEcmAllScheduledJobs';\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('async-ecm-upload-baseService'), data);\r\n    },\r\n    /* Retries an especific ECM Pending Scheduled Job\r\n     * @param object  {jobId=(string)} //The id of the job wich is going to be retried\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    retryECMPendingScheduledJob: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        data['action'] = 'retryECMPendingScheduledJob';\r\n        data['idJob'] = params;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('async-ecm-upload-baseService'), data);\r\n    },\r\n    /*\r\n     *   Returns the current workportal version\r\n     */\r\n    getWorkPortalVersion: function () {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('WorkPortalVersion'),\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        }).always(function (data) {\r\n            // Compatibility with java version\r\n            data = data || {};\r\n\r\n            if (data.version == '') {\r\n                // Take the build version\r\n                data.version = bizagi.loader.productBuild || '';\r\n            }\r\n            return data;\r\n        });\r\n    },\r\n    /*\r\n     *   Returns the combo's data to authentication log depending of the params\r\n     */\r\n    getAuthenticationLogData: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        var url = '';\r\n\r\n        if (params['dataType'] == 'domains') {\r\n            url = 'admin-getAuthenticationDomains';\r\n        } else if (params['dataType'] == 'events') {\r\n            url = 'admin-getAuthenticationEventsTypes';\r\n        } else {\r\n            url = 'admin-getAuthenticationEventSubTypes';\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(url),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Get the search result of authentication log\r\n     */\r\n    getAuthenticationLogResult: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['action'] = params.action;\r\n        data['domain'] = params.domain;\r\n        data['userName'] = params.userName;\r\n        data['dtFrom'] = params.dtFrom;\r\n        data['dtTo'] = params.dtTo;\r\n        data['eventSubType'] = params.eventSubType;\r\n        data['eventType'] = params.eventType;\r\n        data['pag'] = params.pag;\r\n        data['pagSize'] = params.pagSize;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-getAuthenticationLog'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Return the password encrypted\r\n     */\r\n    encryptString: function (params) {\r\n        var self = this;\r\n\r\n        var data = {};\r\n\r\n        // Define data\r\n        params = params || {};\r\n\r\n        data.entry = params.entry;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-EncryptString'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return the users requests\r\n     */\r\n    userPendingRequests: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            pag: params.pag,\r\n            pagSize: params.pagSize\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl(\"admin-UserPendingRequests\"), data);\r\n    },\r\n\r\n    /*\r\n     *   Return the User Authentication Info\r\n     */\r\n    userAuthenticationInfo: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('admin-UserAuthenticationInfo'), {\r\n            idUser: params.idUser\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return Update User Authentication Info\r\n     */\r\n    updateUserAuthenticationInfo: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.create(self.serviceLocator.getUrl('admin-updateUserAuthenticationInfo'), {\r\n            idUser: params.idUser,\r\n            password: params.password,\r\n            enable: params.enable,\r\n            expired: params.expired,\r\n            locked: params.locked\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return generate Data To Send By Email\r\n     */\r\n    generateRandomPassword: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        params['action'] = 'generateRandomPassword';\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-generateRandomPassword'),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return generate Data To Send By Email\r\n     */\r\n    generateDataToSendByEmail: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['action'] = 'GenerateDataToSendByEmail';\r\n        data['idUser'] = params.idUser;\r\n        data['password'] = params.password;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-GenerateDataToSendByEmail'),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return generate Send Mail\r\n     */\r\n    sendEmail: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['action'] = 'sendEmail';\r\n        data['emailTo'] = params.emailTo;\r\n        data['subject'] = params.subject;\r\n        data['body'] = params.body;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-sendEmail'),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return Applications, Categories or processes list\r\n     */\r\n    getApplicationCategoriesList: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = '';\r\n\r\n        if (params.action == 'Applications') {\r\n            url = 'admin-getApplicationList';\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(url),\r\n                type: 'GET',\r\n                dataType: 'json'\r\n            });\r\n        } else {\r\n            url = 'admin-getCategoriesList';\r\n            data.idApp = params.idApp;\r\n            data.idCategory = params.idCategory;\r\n            if (data.idCategory == '') {\r\n                data.idCategory = -1;\r\n            }\r\n\r\n            if (typeof (params.filterStartEvent) !== 'undefined') {\r\n                data.filterStartEvent = params.filterStartEvent;\r\n            }\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(url),\r\n                data: data,\r\n                type: 'GET',\r\n                dataType: 'json'\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Return the list of all cases that matched the filters\r\n     */\r\n    getAdminCasesList: function (params) {\r\n        var self = this;\r\n        var data = params || {};\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            //eliminar esto con el servicio restfull\r\n            cache: true,\r\n            url: self.serviceLocator.getUrl('admin-getCasesList'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n     *   Return the application's processes\r\n     */\r\n    getApplicationProcesses: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getApplicationProcesses');\r\n\r\n        var data = {};\r\n\r\n        data['idApp'] = params['idApp'] ? params['idApp'] : -1;\r\n\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Return the application's processes\r\n     */\r\n    getProcessVersion: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getProcessVersion');\r\n\r\n        var data = {};\r\n\r\n        data['idWfClass'] = params['idWFClass'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Return the the workflow's versions task\r\n     */\r\n    getProcessTasks: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getProcessTasks');\r\n\r\n        var data = {};\r\n\r\n        data['idWfClass'] = params['idWFClass'];\r\n        data['version'] = params['version'] ? params['version'] : undefined;\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Retrieves the alarms from an specific task\r\n     */\r\n    getTaskAlarms: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getTaskAlarms');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Retrieves each kind of alarm lapse\r\n     */\r\n    getLapseMode: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getLapseMode');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     * Retrieves each kind of alarm recurrence\r\n     */\r\n    getRecurrMode: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getRecurrMode');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n\r\n    /*\r\n     * Retrieves each kind of alarm recurrence\r\n     */\r\n    getScheduleType: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getScheduleType');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     *   Retrieves the boss list\r\n     */\r\n    getBossList: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getBossList');\r\n        return $.read(url);\r\n    },\r\n\r\n    /**\r\n     *   Add a new alarm\r\n     */\r\n    addAlarm: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-addAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n        data['idRecurrMode'] = params['idRecurrMode'];\r\n        data['idLapseMode'] = params['idLapseMode'];\r\n        data['scheduleType'] = params['scheduleType'];\r\n        data['alarmTime'] = params['alarmTime'];\r\n        data['alarmRecurrTime'] = params['alarmRecurrTime'];\r\n        data['sendToCurrentAssignee'] = params['sendToCurrentAssignee'];\r\n\r\n        return $.update(url, data);\r\n        /*\r\n         return $.ajax({\r\n         url: self.serviceLocator.getUrl('admin-addAlarm'),\r\n         data: data,\r\n         type: 'PUT',\r\n         dataType: 'json'\r\n         });\r\n         */\r\n    },\r\n\r\n    /*\r\n     *   Edits an existin alarm\r\n     */\r\n    editAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-editAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n        data['idAlarm'] = params['idAlarm'];\r\n        data['idRecurrMode'] = params['idRecurrMode'];\r\n        data['idLapseMode'] = params['idLapseMode'];\r\n        data['scheduleType'] = params['scheduleType'];\r\n        data['alarmTime'] = params['alarmTime'];\r\n        data['alarmRecurrTime'] = params['alarmRecurrTime'];\r\n        data['sendToCurrentAssignee'] = params['sendToCurrentAssignee'];\r\n\r\n\r\n        return $.update(url, data);\r\n\r\n\r\n    },\r\n\r\n    /*\r\n     *   Delete an alarm\r\n     */\r\n    deleteAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-deleteAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idAlarm'] = params['idAlarm'];\r\n\r\n        return $.destroy(url, params);\r\n\r\n    },\r\n\r\n    /*\r\n     * Returns the Alarm Recipients\r\n     * @param param: idAlarm : the alarm id to get the related recipients\r\n     */\r\n    getAlarmRecipients: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-alarmRecipients');\r\n\r\n        var data = {};\r\n\r\n        data['idAlarm'] = params['idAlarm'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Adds a new Alarm Recipient to the current alam\r\n     * @param param: idAlarm : the alarm id to get the related recipients\r\n     * @param param: idRecipient : the recipient id\r\n     */\r\n    addRecipientToAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-recipientToAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idAlarm'] = params['idAlarm'];\r\n        data['idRecipient'] = params['idRecipient'];\r\n\r\n        return $.update(url, data);\r\n\r\n\r\n    },\r\n\r\n    /*\r\n     * Delete/s the alarm recipient/s from the current task\r\n     * @param param: idRecipient : the recipient id/s who is going to be deleted\r\n     */\r\n    deleteRecipientsFromAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-deleteAlarmRecipients');\r\n\r\n        var data = {};\r\n\r\n        data['idRecipients'] = params['idRecipients'];\r\n\r\n        return $.destroy(url, data);\r\n    },\r\n\r\n    /*\r\n     * Send the action to toggle the alarms state: enable or disable\r\n     * @param param: idTask : the task id who is going to be actvidated/deactivaded his alarms\r\n     */\r\n    enableAlarm: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-enableAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n\r\n        return $.create(url, data);\r\n    },\r\n\r\n    /*\r\n     * Invalidate or Reassign a set of cases\r\n     */\r\n    abortReassignItems: function (params) {\r\n        var self = this;\r\n        var data = params || {};\r\n        var url = params.action == 'abort' ? 'admin-abortItems' : 'admin-reassignItems';\r\n        // Call ajax and returns promise\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(url),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     * Services for Asynchronous Activities\r\n     */\r\n    asyncActivitiesServices: function (params) {\r\n        var self = this;\r\n        var data = params;\r\n        var url = '';\r\n        var type = 'GET';\r\n        if (params.action == 'getActivities') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-get-activities');\r\n        } else if (params.action == 'retryNow') {\r\n            type = 'POST';\r\n            url = self.serviceLocator.getUrl('admin-async-activities-get-retry-now');\r\n            url = url.replace('{idCase}', params.idCase);\r\n            url = url.replace('{idworkItem}', params.idWorkitem);\r\n            url = url.replace(\"{idAsynchWorkitem}\", params.idAsynchWorkitem);\r\n        } else if (params.action == 'getActivitiesByTask') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-get-activities-by-task');\r\n        } else if (params.action == 'enableExecution') {\r\n            type = 'POST';\r\n            url = self.serviceLocator.getUrl('admin-async-activities-enable-execution');\r\n        } else if (params.action == 'enableMultiple') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-enable-multiple');\r\n            type = 'POST';\r\n        } else if (params.action == 'asyncExecution') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-async-execution');\r\n        } else if (params.action == 'asyncExecutionLog') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-async-execution-log');\r\n            url = url.replace('{idCase}', params.idCase);\r\n            url = url.replace('{idworkItem}', params.idWorkItem);\r\n            url = url.replace(\"{idAsynchWorkitem}\", params.idAsynchWorkitem);\r\n        } else if (params.action == 'getAsyncExecution') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-async-get-current-execution-log');\r\n        }\r\n        // Call ajax and returns promise\r\n        var response = $.ajax({\r\n            url: url,\r\n            data: data,\r\n            type: type,\r\n            dataType: 'json'\r\n        });\r\n\r\n        return response;\r\n    },\r\n\r\n    /*\r\n     *  Return generate Default Assignation To all Process\r\n     */\r\n    getDefaultAssignationUserToAllProcess: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('admin-getDefaultAssignationUserToAllProcess'), {\r\n            serviceAction: 'getDefaultAssignationUserToAllProcess'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *  Return generate Default Assignation To Process\r\n     */\r\n    getDefaultAssignationUserToProcess: function (params) {\r\n        var self = this;\r\n        var process;\r\n        // Call ajax and returns promise\r\n        if (params.idWFClass == '') {\r\n            process = -1\r\n        } else {\r\n            process = params.idWfClass\r\n        }\r\n        return $.read(self.serviceLocator.getUrl('admin-getDefaultAssignationUserToProcess'), {\r\n            serviceAction: 'getDefaultAssignationUserToProcess',\r\n            process: process\r\n\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Return Assignation Process\r\n     */\r\n    setDefaultAssignationUserToProcess: function (params) {\r\n        var self = this;\r\n        if (params.idWFClass == '') {\r\n            process = -1\r\n        } else {\r\n            process = params.idWfClass\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.create(self.serviceLocator.getUrl('admin-setDefaultAssignationUserToProcess'), {\r\n            serviceAction: 'setDefaultAssignationUserToProcess',\r\n            process: process,\r\n            idUser: params.idUser\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get the icon of a given process\r\n     * @param params\r\n     */\r\n    getProcessIcon: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            processId: params.processId\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"process-getIcon\"),\r\n            data: data,\r\n            batchRequest: true\r\n        });\r\n    },\r\n    /**\r\n     * Get the icon of a given collection\r\n     * @param params\r\n     */\r\n    getCollectionIcon: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            collectionId: params.collectionId\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"collections-getIcon\"),\r\n            data: data,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Returns the combo's data to Type Profiles depending of the params\r\n     */\r\n    getProfilesTypes: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('admin-getProfilesTypes'));\r\n    },\r\n\r\n    /*\r\n     *  Return generate Search Profiles\r\n     */\r\n    searchProfiles: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-searchProfiles');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['name'] = params['profileName'];\r\n\r\n        data[\"orgId\"] = params[\"orgId\"] ? params[\"orgId\"] : null;\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *  Return Users By Profiles\r\n     */\r\n    getUsersByProfile: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-getUsersByProfile');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['id'] = params['idProfile'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *  Remove User Profiles\r\n     */\r\n    removeUserFromProfile: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-removeUserFromProfile');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['id'] = params['idProfile'];\r\n        data['idUser'] = params['idUser'];\r\n\r\n        return $.destroy(url, data);\r\n    },\r\n\r\n    /*\r\n     *  Add Users Profiles\r\n     */\r\n    addUserToProfile: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-addUserToProfile');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['id'] = params['idProfile'];\r\n        data['idUser'] = params['idUser'];\r\n\r\n        return $.update(url, data);\r\n    },\r\n    /*\r\n     *  Display Licenses\r\n     */\r\n    licenses: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-Licenses');\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     *   Return Dimensions List\r\n     */\r\n    getDimensions: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-GetDimensions');\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     *   Edit Dimensions\r\n     */\r\n    editDimension: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['id'] = params.id;\r\n        data['displayName'] = params.displayName;\r\n        data['name'] = params.name;\r\n        data['idWfClass'] = params.idWfClass;\r\n        data['entityPath'] = params.entityPath;\r\n        data['description'] = params.description;\r\n        var url = self.serviceLocator.getUrl('admin-EditDimension');\r\n        // Call ajax and returns promise\r\n        return $.create(url, data);\r\n        /*return $.ajax({\r\n         url: self.serviceLocator.getUrl('admin-EditDimension'),\r\n         data: params,\r\n         type: 'POST',\r\n         dataType: 'json'\r\n         });*/\r\n    },\r\n\r\n    /*\r\n     *   Create Dimensions\r\n     */\r\n    createAdministrableDimension: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['displayName'] = params.displayName;\r\n        data['name'] = params.name;\r\n        data['idWfClass'] = params.idWfClass;\r\n        data['entityPath'] = params.entityPath;\r\n        data['Description'] = params.description;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-CreateAdministrableDimension'),\r\n            data: params,\r\n            type: 'PUT',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Delete manageable dimensions\r\n     */\r\n    deleteDimension: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-DeleteDimension');\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['id'] = params.id;\r\n        data['idDimension'] = params.id;\r\n        data['administrable'] = params.administrable;\r\n        // Call ajax and returns promise\r\n        return $.destroy(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Dimensions Process Tree\r\n     */\r\n    entityPathChildNodesAction: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['pathNodeType'] = params.nodeType;\r\n        data['idNode'] = params.idNode;\r\n        data['nodeDisplayPath'] = params.nodeDisplayPath;\r\n        data['nodePath'] = params.nodePath;\r\n        data['idWfClass'] = params.idWfClass;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-EntityPathChildNodesAction'),\r\n            data: params,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return list of available processes\r\n     */\r\n    getActiveWFClasses: function (params) {\r\n        var self = this;\r\n        var data = params || {};\r\n\r\n        // Call ajax and returns promise\r\n\r\n        return $.ajax({\r\n            //eliminar esto con el servicio restfull\r\n            cache: true,\r\n            url: self.serviceLocator.getUrl('admin-GetActiveWFClasses'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Resturn the list of Stored Document Templates\r\n     */\r\n    storeDocumentTemplates: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-document-templates-storeDocumentTemplates');\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     * Restore an selected document template using his Guid as parameter\r\n     * @param params {Object} Guid: the associated Guid from the desired document template\r\n     */\r\n    restoreDocumentTemplates: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-document-templates-restoreDocumentTemplates');\r\n\r\n        url += '?Guid=' + params.Guid;\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     * Retreieves the workflow from the actual processes\r\n     */\r\n    getWorkFlowClasses: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-workflowClasses');\r\n        return $.read(url);\r\n    },\r\n\r\n\r\n    /*\r\n     * Retreives the task from a desired workflow\r\n     * @param params {Object} idWorkFlow: the desired workflow id\r\n     */\r\n    getTaskByWorkFlow: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-tasksByWorkflow');\r\n\r\n        var data = {};\r\n        data['idWorkflow'] = params.idWorkflow;\r\n\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Modifies the process durationworkflow\r\n     * @param params {Object} idWorkflow: the desired process id to modify\r\n     * @param params {Object} duration: the duracion, converted in minutes\r\n     */\r\n    modifyProcessDuration: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-modifyProcessDuration');\r\n\r\n        var data = {};\r\n        data['idWorkflow'] = params.idWorkflow;\r\n        data['duration'] = params.duration;\r\n\r\n        return $.create(url, data);\r\n    },\r\n\r\n    /*\r\n     * Modifies the task duration form a desired workflow\r\n     * @param params {Object} idTask: the desired task id to modifie\r\n     * @param params {Object} duration: the duracion, converted in minutes\r\n     */\r\n    modifyTaskDuration: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-modifyTaskDuration');\r\n\r\n        var data = {};\r\n        data['idTask'] = params.idTask;\r\n        data['duration'] = params.duration;\r\n\r\n        return $.create(url, data);\r\n    },\r\n\r\n    /*\r\n     * this retrive data for the report my team\r\n     */\r\n    getDataForMyTeam: function () {\r\n\r\n        var self = this;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('bam-resourcemonitor-myteam'),\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Retrive data for reports\r\n     */\r\n    getReporstAnalysisQuery: function () {\r\n\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('reports-analysisquery'));\r\n    },\r\n\r\n    /*\r\n     * Update report data\r\n     */\r\n    updateReportData: function (params) {\r\n\r\n        var self = this;\r\n\r\n        return $.update(self.serviceLocator.getUrl('reports-analysisquery-update'), params);\r\n    },\r\n\r\n    /*\r\n     * Delete report data\r\n     */\r\n    deleteReportData: function (params) {\r\n\r\n        var self = this;\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('reports-analysisquery-delete') + '?' + params);\r\n    },\r\n    /*\r\n     *Entrega la lista de idiomas soportados\r\n     */\r\n    getStoreLanguageTemplates: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-language-languages');\r\n        var data = {justActives: false};\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *Download template language list\r\n     */\r\n    getLanguageTemplate: function (params) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var url = self.serviceLocator.getUrl('admin-language-resource') + '?cultureName=' + params.cultureName;\r\n        defer.resolve('OK');\r\n        window.location.href = url;\r\n        /*\r\n         var response=  $.ajax({\r\n         type: 'GET',\r\n         url: url\r\n         });\r\n         response.always(function(response, status, xhr) {\r\n         if(response.responseText.indexOf('error') >= 0){\r\n         defer.reject('Download error');\r\n         }else{\r\n         defer.resolve('OK');\r\n         window.location.href=url;\r\n         }\r\n         });*/\r\n        return defer.promise();\r\n    },\r\n    /*\r\n     * Process definition service for process viewer\r\n     */\r\n    processDefinition: function (params) {\r\n        var self = this;\r\n        return $.read(self.serviceLocator.getUrl('processviewer-processdefinition'), params);\r\n    },\r\n\r\n    /*\r\n     * Graphic info for process viewer\r\n     */\r\n    graphicInfo: function (params) {\r\n        var self = this;\r\n        return $.read(self.serviceLocator.getUrl('processviewer-processgraphicinfo'), params);\r\n    },\r\n\r\n    /**\r\n     * This service get the last version of BizagiBPM\r\n     *\r\n     * @return {json}\r\n     */\r\n    getLastUpdateByMobile: function () {\r\n        var self = this;\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"mobile-getLastUpdate\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getCollectionData: function (params) {\r\n        var self = this,\r\n            data = {},\r\n            url = self.serviceLocator.getUrl('templates-handler-getCollectionData');\r\n\r\n        data.idFact = params.idFact;\r\n        data.pag = params.page || 1;\r\n        data.pagSize = params.pageSize || 10;\r\n        data.filters = params.filters ? ((!Array.isArray(params.filters)) ? JSON.stringify(params.filters) : undefined) : undefined;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getVirtualCollectionData: function (params) {\r\n        var self = this,\r\n            data = {},\r\n            url = self.serviceLocator.getUrl('templates-handler-getVirtualCollectionData');\r\n\r\n        data.guidVirtualCollection = params.guidVirtualCollection;\r\n        data.pag = params.page || 1;\r\n        data.pagSize = params.pageSize || 10;\r\n        data.filters = params.filters ? ((!Array.isArray(params.filters)) ? JSON.stringify(params.filters) : undefined) : undefined;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getSearchData: function (params) {\r\n        var self = this;\r\n        // Call ajax and returns promise\r\n        var urlSend = self.serviceLocator.getUrl(\"my-search-getData\");\r\n        urlSend = urlSend.replace(\"{guidSearch}\", params.guidSearch);\r\n        var filters = params.filters || [];\r\n\r\n        var data = {\r\n            filters: JSON.stringify(filters),\r\n            pag: params.page || 1,\r\n            calculateFilters: params.calculateFilters || false,\r\n            pagSize: params.pageSize || 10\r\n        };\r\n        return $.read(urlSend, data).then(function (data) {\r\n            return self.serializeEntityData(data);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Return an array with the collections or entity related to stakeholder entities\r\n     * @param params\r\n     */\r\n    getCollectionEntityData: function (params) {\r\n        var self = this, url;\r\n        params = params || {};\r\n        var data = {\r\n            templateType: (params.referenceType === \"VIRTUAL\" || params.referenceType === \"FACT\") ? \"List\" : \"Content\",\r\n            surrogateKey: params.surrogateKey,\r\n            pag: params.page || 1,\r\n            pagSize: params.pageSize || 10,\r\n            defaultFilterApplied: params.defaultFilterApplied,\r\n            filters: JSON.stringify(params.filters)\r\n        };\r\n\r\n        // VIRTUAL\r\n        if (params.referenceType === \"VIRTUAL\") {\r\n            url = self.serviceLocator.getUrl('data-navigation-handler-collection');\r\n            data.reference = params.reference;\r\n        }\r\n        // ENTITY AND FACTS\r\n        else {\r\n            url = self.serviceLocator.getUrl('data-navigation-handler-entity');\r\n            data.reference = params.guidEntityCurrent;\r\n            data.xpath = params.xpath;\r\n            data.collectionId = params.reference;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data).then(function (response) {\r\n            return self.serializeEntityData(response);\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     */\r\n    getFiltersEntityData: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var data = {\r\n            reference: params.guidEntityCurrent,\r\n            collectionId: params.reference,\r\n            surrogateKey: params.surrogateKey,\r\n            xpath: params.xpath,\r\n            templateType: \"List\",\r\n            defaultFilterApplied: params.defaultFilterApplied,\r\n            filters: JSON.stringify(params.filters)\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"data-navigation-handler-entity-filters\"),\r\n            data: data\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getProcessAddAction: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"action-handler-getProcessAddAction\");\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, params)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getMultipleActions: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"templates-handler-getMultipleActions\");\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, params)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getMapping: function (params) {\r\n        var self = this;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"process-handler-getMapping\"),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    getForm: function (data) {\r\n        var self = this;\r\n\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = self.deviceType;\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicecode\"] = self.deviceCode;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"process-handler-getForm\"),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Chek if an entity has startform\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    hasStartForm: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        if (params.guid) {\r\n            data.guidWFClass = params.guid;\r\n        }\r\n\r\n        return $.read(self.serviceLocator.getUrl(\"process-handler-startform\"), data);\r\n    },\r\n\r\n    /**\r\n     * Executes the action\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    executeAction: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            surrogateKey: JSON.stringify(params.surrogatedKey),\r\n            entityId: params.entityId,\r\n            ruleId: params.processId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl(\"process-action-execute\"),\r\n            data: data\r\n        });\r\n    },\r\n\r\n    /**\r\n     * executes a rule\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    actionRule: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            surrogateKey: params.surrogateKey,\r\n            entityId: params.entityId,\r\n            ruleId: params.processId\r\n        }\r\n\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl(\"process-handler-rule\"),\r\n            data: data,\r\n            batchRequest: false\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get following cases\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getActivitiesData: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"process-handler-getActivitiesData\");\r\n        params = params || {};\r\n        var data = {\r\n            page: params.page || 1,\r\n            pagsize: params.pageSize || 10\r\n        };\r\n\r\n        if (typeof (params.idworkflow) !== \"undefined\" && params.idworkflow ||\r\n            typeof (params.idWorkflow) !== \"undefined\" && params.idWorkflow) {\r\n            data.idWorkflow = params.idworkflow || params.idWorkflow;\r\n        }\r\n        if (typeof params.idCase !== \"undefined\" && params.idCase) {\r\n            data.idCase = params.idCase;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data).then(function (response) {\r\n            return self.serializeEntityData(response);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Return an array with the collections related to stakeholder entities\r\n     */\r\n    getPendingsData: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"process-handler-getPendingsData\");\r\n        params = params || {};\r\n        var data = {\r\n            page: params.page || 1,\r\n            pagsize: params.pageSize || 10\r\n        };\r\n\r\n        if (typeof (params.idworkflow) !== \"undefined\" && params.idworkflow ||\r\n            typeof (params.idWorkflow) !== \"undefined\" && params.idWorkflow) {\r\n            data.idWorkflow = params.idworkflow || params.idWorkflow;\r\n        }\r\n        if (typeof params.idCase !== \"undefined\" && params.idCase) {\r\n            data.idCase = params.idCase;\r\n        }\r\n        if (typeof params.taskState !== \"undefined\" && params.taskState) {\r\n            data.taskState = params.taskState;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data).then(function (response) {\r\n            return self.serializeEntityData(response);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get actions\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getActionsData: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('entities-handler-getActions'),\r\n            data: params,\r\n            batchRequest: true\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get Users, assignees and events from cases\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getUsersAndEvents: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        if (params.idCases && params.idCases.length > 0) {\r\n            data.idCases = params.idCases.toString();\r\n        }\r\n\r\n        return $.read(self.serviceLocator.getUrl(\"entities-handler-getUsersAndEvents\"), data);\r\n    },\r\n\r\n    /**\r\n     * Get Users, assignees and events from cases\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getUsers: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            caseId: params.caseId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"entities-handler-getUsers\"),\r\n            data: params,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get Users, assignees and events from cases\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getEvents: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            caseId: params.caseId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"entities-handler-getEvents\"),\r\n            data: params,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get Users images\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getUsersImages: function (params, userIds) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"entities-handler-getUsersImages\");\r\n\r\n        if (userIds && userIds.length > 0) {\r\n            data.userIds = userIds.toString();\r\n        }\r\n\r\n        data.width = params.width;\r\n        data.height = params.height;\r\n        data.square = params.square;\r\n\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n            return $.ajax({\r\n                url: url, \r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        } else {    \r\n            return $.read({\r\n                url: url,\r\n                data: data,\r\n                dataType: \"json\"\r\n            });\r\n        }  \r\n    },\r\n\r\n    /**\r\n     * Get stakeholder shortCurts\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getShortCuts: function (params) {\r\n        var self = this,\r\n            data = {},\r\n            url = self.serviceLocator.getUrl(\"entities-handler-getShotCuts\");\r\n\r\n        if (typeof params.icon !== \"undefined\" && params.icon) {\r\n            data.icon = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /**\r\n     *   Returns the available list of searches\r\n     */\r\n    getSearchLists: function () {\r\n        var self = this;\r\n        return $.read(self.serviceLocator.getUrl(\"my-search-getSearchLists\"), {});\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     */\r\n    getIdCasesOfProcessEntities: function (params) {\r\n        params = params || {};\r\n        var self = this;\r\n        var ids = {\r\n            ids: JSON.stringify(params)\r\n        };\r\n\r\n        // TODO: Validate compatibility\r\n        if (bizagi.version.server.lessThanOrEqualsTo(\"11.0.0.2608\")) {\r\n            // Call ajax and returns promise\r\n            return $.read({\r\n                url: self.serviceLocator.getUrl(\"process-handler-getIdCasesOfProcessEntities\"),\r\n                data: ids\r\n            });\r\n\r\n        }else{\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"process-handler-getIdCasesOfProcessEntities\"),\r\n                data: ids,\r\n                type: \"POST\"\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Retuns query form to searches\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getQueryForm: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"query-handler-getQueryForm\"),\r\n            data: params,\r\n            type: \"POST\",\r\n            dataType: params.dataType || \"json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Returns an object with the filter to send to the server\r\n     * @param params\r\n     * @param filterObject\r\n     * @param callback is called when a filter is added to the array\r\n     */\r\n    defineFilterObject: function (params, filterObject, callback) {\r\n        var properties = params.properties;\r\n        var xpath = properties.xpath.split('@')[0];\r\n\r\n        var filter = filterObject.find(function (el) {\r\n            return el.xpath == xpath;\r\n        });\r\n\r\n        //if the control exists is because it is a range\r\n        if (filter) {\r\n            if (properties.rangeQuery == \"from\") {\r\n                filter.value = filter.value || {};\r\n                filter.searchType = 'range';\r\n                filter.value.min = params.value;\r\n            }\r\n            else if (properties.rangeQuery == \"to\") {\r\n                filter.value = filter.value || {};\r\n                filter.searchType = 'range';\r\n                filter.value.max = params.value;\r\n            }\r\n            else {\r\n                params.properties.typeSearch = filter.searchType;\r\n                var values = setValues(params);\r\n                $.extend(filter, values);\r\n            }\r\n\r\n            if (properties.orderType) {\r\n                filter.orderType = properties.orderType;\r\n            }\r\n            if (callback) {\r\n                callback(bizagi.clone(filter));\r\n            }\r\n        }\r\n        else {\r\n            var isDefaultFilter = properties.defaultFilter || false;\r\n            filter = setValues(params);\r\n\r\n            if (properties.orderType) {\r\n                filter.orderType = properties.orderType;\r\n            }\r\n\r\n            if (typeof filter.value != 'undefined' || filter.orderType || isDefaultFilter) {\r\n                filterObject.push(filter);\r\n                if (callback) {\r\n                    callback(bizagi.clone(filter));\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        function setValues(params) {\r\n            var properties = params.properties;\r\n            var searchType = properties.typeSearch;\r\n            var value = params.value;\r\n\r\n            //Identifing the type control in order to define search type\r\n            if (properties.type == \"boolean\") {\r\n                if (value.toLowerCase() === \"null\") {\r\n                    value = null;\r\n                    searchType = \"Nullable\"\r\n                }\r\n                else {\r\n                    value = bizagi.util.parseBoolean(value);\r\n                    searchType = \"exact\"\r\n                }\r\n            }\r\n\r\n            if (properties.type == \"number\" || properties.type == \"money\" || properties.type == \"date\") {\r\n                searchType = \"exact\"\r\n            }\r\n\r\n            if (typeof params.value == 'object') {\r\n                value = [];\r\n                if (Array.isArray(params.value)) {\r\n                    for (var i = 0, len = params.value.length; i < len; i++) {\r\n                        var val = parseInt(params.value[i].id);\r\n                        if (!isNaN(val)) {\r\n                            value.push(val);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    var val = parseInt(params.value.id);\r\n                    if (!isNaN(val)) {\r\n                        value.push(val);\r\n                    }\r\n                }\r\n                searchType = \"exact\";\r\n                value = value.length > 0 ? value : undefined;\r\n            }\r\n\r\n            if (properties.rangeQuery && properties.rangeQuery !== \"none\") {\r\n                value = {\r\n                    min: params.value,\r\n                    max: params.value\r\n                };\r\n                searchType = \"range\";\r\n            }\r\n\r\n            searchType = searchType || \"approx\";\r\n\r\n            var filter = {\r\n                xpath: xpath,\r\n                searchType: searchType\r\n            };\r\n\r\n            if (typeof value !== 'undefined') {\r\n                filter.value = value;\r\n            }\r\n\r\n            return filter;\r\n        }\r\n    },\r\n\r\n    /*PLAN*/\r\n    getPlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-get\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getActivities: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-activities\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    updatePlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-update\");\r\n        return $.update({\r\n            url: url.replace(\"{idPlan}\", params.id),\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    putExecutePlan: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-execute\");\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/x-www-form-urlencoded\"\r\n        });\r\n    },\r\n\r\n    deletePlan: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-delete\");\r\n\r\n        return $.destroy({\r\n            url: url.replace(\"{idPlan}\", params.id),\r\n            data: params,\r\n            contentType: \"application/x-www-form-urlencoded\"\r\n        });\r\n    },\r\n\r\n    closePlan: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-close\");\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/x-www-form-urlencoded\"\r\n        });\r\n    },\r\n\r\n    getWorkitemsPlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-workitems\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getTransitionsByPlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-transitions-get\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    editActivityPlan: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        if (params.activity) {\r\n            data = params.activity;\r\n            data.items = params.items;\r\n        } else {\r\n            data = params;\r\n        }\r\n\r\n        var url = self.serviceLocator.getUrl(\"project-plan-activity-edit\").replace(\"{idPlan}\", data.idPlan).replace(\"{id}\", data.id);\r\n\r\n        return $.update({\r\n            url: url,\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getPlanByParent: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-get-by-parent\");\r\n        var def = $.Deferred();\r\n\r\n        $.when($.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        })).done(function (response) {\r\n            def.resolve(response);\r\n        });\r\n\r\n        return def.promise();\r\n\r\n    },\r\n\r\n    getItemsByActivity: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-activity-tasks-get\");\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getPlanParent: function (data) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"project-plan-parent\");\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\"\r\n        });\r\n    },\r\n    /**\r\n     * Serializador de servicio de entitiData\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    serializeEntityData: function (data) {\r\n        var serializedData = data;\r\n        serializedData.entities = [];\r\n\r\n        /**\r\n         * build the return object.\r\n         * @param header\r\n         * @param row\r\n         * @returns {{data: {}, guid: *, surrogateKey: *, timestamp: *}}\r\n         * @private\r\n         */\r\n        function _buildNewObject(header, row) {\r\n            var newObject = {\r\n                    data: {},\r\n                    guid: row.guidEntity,\r\n                    timestamp: header.timestamp\r\n                },\r\n                columns = header.columns,\r\n                rowData = row.row;\r\n\r\n            for (name in row) {\r\n                if (row.hasOwnProperty(name) && name.toString() !== \"row\" && name.toString() !== \"id\") {\r\n                    newObject[name] = row[name];\r\n                }\r\n            }\r\n\r\n            for (var i = 0, len = columns.length; i < len; i += 1) {\r\n                newObject.data[columns[i]] = rowData[i];\r\n            }\r\n\r\n            return newObject;\r\n        };\r\n\r\n        var k = -1, kRow;\r\n        while (kRow = data.rows[++k]) {\r\n            var i = -1, iCell;\r\n            while (iCell = data.cells[++i]) {\r\n                if (iCell.id === kRow.id) {\r\n                    var kReturnObject = _buildNewObject(iCell, kRow);\r\n                    serializedData.entities.push(kReturnObject);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return serializedData;\r\n    },\r\n\r\n  \r\n});","\r\n/**\r\n* Routing service\r\n*\r\n* @author Edward J Morales\r\n* @description This class has been created based on jira story DRAGON-4943\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.routing\",\r\n{\r\n    BIZAGI_WORKPORTAL_WIDGET_START_FORM: \"startForm\"\r\n},\r\n{\r\n    /**\r\n    * Main method\r\n    *\r\n    * @param params <object> json with parameters to route\r\n    * @return object deferred\r\n    */\r\n    init: function (args) {\r\n        var self = this;\r\n        args = args || {};\r\n        self.params = args.params || {};\r\n        self.dataService = args.dataService || {};\r\n        self.modules = {\r\n            render: \"activityform\",\r\n            oldRender: \"oldrenderintegration\",\r\n            async: \"async\",\r\n            activitySelector: \"routing\"\r\n        };\r\n\r\n        // By default render version is Bizagi GO\r\n        self.renderVersion = 2;\r\n\r\n        self.resetRouteInformation();\r\n    },\r\n\r\n    resetRouteInformation: function () {\r\n        var self = this;\r\n        self.route = {\r\n            module: \"\", // Name of module to route\r\n            moduleParams: {} // parameters of module\r\n        };\r\n    },\r\n\r\n    setRenderParams: function (params) {\r\n        var self = this;\r\n        self.params = self.getRenderParams(params);\r\n    },\r\n\r\n    /**\r\n    * Parse a format incoming parameters\r\n    * @param params object\r\n    * @return object json with render parameters\r\n    */\r\n    getRenderParams: function (params) {\r\n        var self = this;\r\n\r\n        var renderParams = {\r\n            idCase: parseInt(params.idCase || 0),\r\n            idWorkflow: parseInt(params.idWorkflow || 0),\r\n            idWorkitem: params.idWorkitem || params.idWorkItem || 0,\r\n            idTask: parseInt(params.idTask || 0),\r\n            eventAsTasks: params.eventAsTasks || false,\r\n            onlyUserWorkItems: params.onlyUserWorkItems || \"true\",\r\n            formsRenderVersion: params.formsRenderVersion || 0,\r\n            referrer: params.referrer || \"\",\r\n            isComplex: (params.isComplex !== undefined) ? true : false,\r\n            formsRenderVersion: 2,\r\n            onClose: params.onClose || \"\",\r\n            isOfflineForm: params.isOfflineForm || false,\r\n            radNumber: params.radNumber || null\r\n        };\r\n\r\n        var skipSubprocessGlobalForm = true;\r\n        try {\r\n            skipSubprocessGlobalForm = BIZAGI_SETTINGS[\"skipSubprocessGlobalForm\"] || true;\r\n        } catch (e) {\r\n        }\r\n\r\n        self.skipSubprocessGlobalForm = (skipSubprocessGlobalForm == \"true\");\r\n\r\n        return renderParams;\r\n    },\r\n    /**\r\n    * Define the next route to take\r\n    * @param params object\r\n    * @return deferred with specific path\r\n    */\r\n    getRoute: function (params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        // Params Override\r\n        self.params = (params) ? params : self.params;\r\n\r\n        var fromTask = params.fromTask || params.idTask || \"\";\r\n        var fromWorkItemId = params.fromWorkItemId || params.idWorkitem || params.idWorkItem || \"\";\r\n\r\n        /**\r\n        * Get form version\r\n        */\r\n        $.when(self.getRenderVersion(self.params))\r\n            .done(function (renderVersion) {\r\n                self.renderVersion = renderVersion;\r\n                self.route.moduleParams = self.getRenderParams(self.params);\r\n\r\n                // Looking for workitems\r\n                $.when(self.dataService.getWorkitems({\r\n                    idCase: self.params.idCase,\r\n                    onlyUserWorkItems: self.params.onlyUserWorkItems,\r\n                    isOfflineForm: self.params.isOfflineForm,\r\n                    fromTask: fromTask,\r\n                    fromWorkItemId: fromWorkItemId\r\n                })).done(function (getWorkItems) {\r\n                    var workItems = getWorkItems.workItems.length;\r\n\r\n                    /**\r\n                    * If routing has been called with idCase and idWorkitem\r\n                    * then go to the render\r\n                    */\r\n                    self.route.moduleParams.hasWorkItems = workItems ? true : false;\r\n                    self.route.moduleParams.isEvent = self.params.isEvent || false;\r\n                    self.route.moduleParams.hasGlobalForm = bizagi.util.parseBoolean(getWorkItems.hasGlobalForm);\r\n\r\n                    if (self.route.moduleParams.idWorkitem > 0) {\r\n                        self.setRenderModuleName(self.getRenderModuleName(renderVersion));\r\n\r\n                        if (self.route.moduleParams.idTask === 0) {\r\n                            // Try to found idTask\r\n                            self.route.moduleParams.idTask = self.searchIdTask(self.route.moduleParams.idWorkitem);\r\n                        }\r\n\r\n                        // We have enough information to instance the render\r\n                        self.route.moduleParams.radNumber = getWorkItems.radNumber || \"\";\r\n                        self.route.moduleParams.idWorkflow = getWorkItems.idWorkFlow || \"\";\r\n\r\n                        if (!self.route.moduleParams.displayName && !self.params.displayName) {\r\n                            var item = getWorkItems.workItems.find(function (el) {\r\n                                return Number(el.idWorkItem) === Number(self.route.moduleParams.idWorkitem);\r\n                            })\r\n\r\n                            if (typeof item !== \"undefined\" && item.displayName) {\r\n                                self.route.moduleParams.displayName = item.displayName;\r\n                            }\r\n                        }\r\n\r\n                        self.route.moduleParams.mobileAccess = self.isMobileAccessEnabledForWorkItem(getWorkItems.workItems, \r\n                            self.route.moduleParams.idWorkitem);\r\n\r\n                        // Resolve the promise\r\n                        def.resolve(self.route);\r\n                        self.resetRouteInformation();\r\n                    } else {\r\n\r\n                        var listAsyncWorkItems = self.checkAsyncWorkItems(getWorkItems);\r\n\r\n                        // Check if case has workItems\r\n                        if (workItems === 0) {\r\n\r\n                            self.route.moduleParams.idWorkflow = getWorkItems.idWorkFlow || \"\";\r\n                            self.route.moduleParams.radNumber = getWorkItems.radNumber || \"\";\r\n\r\n                            if ($.trim(getWorkItems.msgTask) !== \"\") {\r\n                                def.resolve(self.routeToMessageForm(getWorkItems.msgTask));\r\n                            } else if (bizagi.util.parseBoolean(getWorkItems.hasGlobalForm)) {\r\n                                // hasn't work items, show global form\r\n                                // Resolve route -> Global Form\r\n                                self.route.moduleParams.displayName = null;\r\n                                def.resolve(self.routeToGlobalForm(getWorkItems));\r\n                            } else {\r\n                                // Resolve route -> Global form without data\r\n                                def.resolve(self.routeToGlobalFormWithoutData());\r\n                            }\r\n                        } else if (workItems === 1 || listAsyncWorkItems.length > 0) {\r\n                            // it has one workItem\r\n                            // Check if it is asyncronous activity\r\n                            var workItemIndex = 0;\r\n                            if (listAsyncWorkItems.length > 0) {\r\n                                for (var workitemCounter = 0; workitemCounter < workItems; workitemCounter++) {\r\n\r\n                                    if (getWorkItems.workItems[workitemCounter].isAsynch == \"true\") {\r\n                                        workItemIndex = workitemCounter;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            // Change idCase\r\n                            self.route.moduleParams.idCase = getWorkItems.workItems[workItemIndex].idCase;\r\n                            self.route.moduleParams.idTask = getWorkItems.workItems[workItemIndex].idTask;\r\n                            self.route.moduleParams.fromTask = getWorkItems.workItems[workItemIndex].idTask;\r\n                            self.route.moduleParams.idWorkitem = getWorkItems.workItems[workItemIndex].idWorkItem;\r\n                            self.route.moduleParams.idWorkflow = getWorkItems.workItems[workItemIndex].idWorkFlow;\r\n                            self.route.moduleParams.displayName = getWorkItems.workItems[workItemIndex].displayName\r\n                                ? getWorkItems.workItems[workItemIndex].displayName : \"\";\r\n                            self.route.moduleParams.radNumber = getWorkItems.radNumber || \"\";\r\n\r\n                            self.route.moduleParams.mobileAccess = self.isMobileAccessEnabledForWorkItem(getWorkItems.workItems, \r\n                                self.route.moduleParams.idWorkitem);\r\n\r\n                            if (listAsyncWorkItems.length > 0) {\r\n                                // Resolve asynchronous activity\r\n                                self.setRenderModuleName(self.modules.async);\r\n                            } else {\r\n                                // Resolve render\r\n                                self.setRenderModuleName(self.getRenderModuleName(renderVersion));\r\n                            }\r\n\r\n                            def.resolve(self.route);\r\n                            self.resetRouteInformation();\r\n                        } else {\r\n\r\n                            // it has many workItems or subprocess\r\n                            // show routing window\r\n                            getWorkItems.checkProcess = getWorkItems.subProcesses.length > 0\r\n                                && self.skipSubprocessGlobalForm ? true : false;\r\n                            getWorkItems.checkWorkItems = workItems > 1 ? true : false;\r\n\r\n                            getWorkItems[\"fromSearchWidget\"] = self.params.referrer == \"search\" ? true : false;\r\n                            self.setRenderModuleName(self.modules.activitySelector);\r\n                            self.route.moduleParams.data = getWorkItems;\r\n\r\n\r\n                            def.resolve(self.route);\r\n                            self.resetRouteInformation();\r\n                        }\r\n                    }\r\n                }).fail(function (error) {\r\n                    var msgTask = bizagi.localization.getResource(\"workportal-menu-search-found-no-cases\");\r\n                    def.resolve(self.routeToMessageForm(msgTask));\r\n                });\r\n        }).fail(function (xhr, errorType, message) {\r\n            def.reject();\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n    * Set name of module to instance\r\n    * @param renderName\r\n    */\r\n    setRenderModuleName: function (renderName) {\r\n        var self = this;\r\n\r\n        self.route.module = renderName;\r\n        self.route.moduleParams.widgetName = renderName;\r\n    },\r\n    /**\r\n    * Get render module\r\n    * @param renderVersion integer 1 || 2\r\n    * @returns boolean\r\n    */\r\n    getRenderModuleName: function (renderVersion) {\r\n        var self = this;\r\n        return (renderVersion == 1) ? self.modules.oldRender : self.modules.render;\r\n    },\r\n    /**\r\n    * Search idTask from workItems object\r\n    * @return {number} idTask\r\n    * @param workItemsList\r\n    * @param workItemToSearch\r\n    */\r\n    searchIdTask: function (workItemsList, workItemToSearch) {\r\n        var idTask = 0;\r\n        workItemsList = workItemsList || [];\r\n\r\n        for (var i = 0, length = workItemsList.length; i < length; i++) {\r\n            //search idTask\r\n            if (parseInt(workItemsList[i][\"idWorkItem\"]) == parseInt(workItemToSearch)) {\r\n                idTask = parseInt(workItemsList[i][\"idTask\"]);\r\n                break;\r\n            }\r\n        }\r\n        return idTask;\r\n    },\r\n\r\n    /**\r\n    * Check if workitems has asynchronous activities\r\n    * @param data\r\n    * @returns {Array}\r\n    */\r\n    checkAsyncWorkItems: function (data) {\r\n        var result = [];\r\n\r\n        $.each(data[\"workItems\"], function (key) {\r\n            if (data[\"workItems\"][key][\"isAsynch\"] == \"true\") {\r\n                result.push({\r\n                    idCase: data[\"idCase\"],\r\n                    idWorkitem: data.workItems[key].idWorkItem,\r\n                    idTask: data.workItems[key].idTask\r\n                });\r\n            }\r\n        });\r\n        return result;\r\n    },\r\n\r\n    /**\r\n    * Check if the specified workItemId has restricted the mobileAccess\r\n    * @param data\r\n    * @returns {Array}\r\n    */\r\n    isMobileAccessEnabledForWorkItem: function (workItems, workItemId) {\r\n        var mobileAccess = true;\r\n        $.each(workItems, function (key) {\r\n            var currentWorkItem = workItems[key];\r\n            var currentWorkItemId = currentWorkItem.idWorkItem || currentWorkItem.idWorkitem;\r\n            if (currentWorkItemId == workItemId){\r\n                mobileAccess = currentWorkItem.mobileAccess != undefined ? currentWorkItem.mobileAccess : true;\r\n                return false;\r\n            }\r\n        });\r\n        return mobileAccess;\r\n    },\r\n\r\n\r\n    /**\r\n    * Resolve global form route\r\n    * @param getWorkitems\r\n    * @returns {{module: string, moduleParams: {}}|*}\r\n    */\r\n    routeToGlobalForm: function (getWorkitems) {\r\n        var self = this;\r\n\r\n        // Override idCase and idWorkflow\r\n        self.route.moduleParams.idCase = ($.isNumeric(getWorkitems.idCaseForGlobalForm) && getWorkitems\r\n                .idCaseForGlobalForm > 0)\r\n            ? getWorkitems.idCaseForGlobalForm : self.route.moduleParams.idCase;\r\n\r\n        self.route.moduleParams.idWorkflow = parseInt(getWorkitems.idWorkFlow || 0);\r\n\r\n        if (self.renderVersion == 1) {\r\n            // Old render\r\n            var urlTemplate = self.dataService.serviceLocator.getUrl(\"old-render\") +\r\n                \"?PostBack=1&idCase=%s&idWorkitem=%s&idTask=%s\";\r\n            var idCase = self.route.moduleParams.idCase || \"\";\r\n            var idWorkitem = self.route.moduleParams.idWorkitem || \"\";\r\n            var idTask = self.route.moduleParams.idTask || \"\";\r\n            var url = printf(urlTemplate, idCase, idWorkitem, idTask);\r\n\r\n            self.route.moduleParams.onlyUserWorkItems = self.route.moduleParams.idCase || \"\";\r\n\r\n            self.setRenderModuleName(self.modules.oldRender);\r\n            self.route.moduleParams.url = url;\r\n        } else {\r\n            // Bizagi\r\n            self.setRenderModuleName(self.modules.render);\r\n        }\r\n\r\n        return self.route;\r\n    },\r\n    /**\r\n    * Resolve global form\r\n    * @returns {{module: string, moduleParams: {}}|*}\r\n    */\r\n    routeToGlobalFormWithoutData: function () {\r\n        var self = this;\r\n\r\n        self.setRenderModuleName(self.modules.render);\r\n        self.route.moduleParams.withOutGlobalForm = true;\r\n\r\n        return self.route;\r\n    },\r\n\r\n    /**\r\n    * Resolve Render with personalized message\r\n    * @param message\r\n    * @returns {{module: string, moduleParams: {}}|*|bizagi.workportal.services.routing.route}\r\n    */\r\n    routeToMessageForm: function (message) {\r\n        var self = this;\r\n        message = message || \"\";\r\n\r\n        self.setRenderModuleName(self.modules.render);\r\n        self.route.moduleParams.withOutGlobalForm = true;\r\n        self.route.moduleParams.messageForm = message;\r\n\r\n        return self.route;\r\n    },\r\n\r\n    /**\r\n    * Return the forms render version from parameters or service\r\n    * @param params object\r\n    * @returns {integer}\r\n    */\r\n    getRenderVersion: function (params) {\r\n        var self = this, defer = new $.Deferred();\r\n\r\n        // Try get from parameters\r\n        var formsVersion = params.formsRenderVersion || 0;\r\n        if (formsVersion != 0) {\r\n            // Response from parameters\r\n            defer.resolve(formsVersion);\r\n        } else {\r\n\r\n            // Get from service\r\n            $.when(self.dataService.getCaseFormsRenderVersion({\r\n                idCase: params.idCase\r\n            })).done(function (data) {\r\n                formsVersion = parseInt(data.formsRenderVersion);\r\n                defer.resolve(formsVersion);\r\n            }).fail(function (xhr, errorType, message) {\r\n                defer.reject();\r\n            });\r\n        }\r\n\r\n        return defer.promise();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Device Render Factory\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script will detect the current device and then will load the appropiate factory on demand\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.device.factory\", {}, {\r\n\r\n    /* \r\n    *   Constructor, detects the device\r\n    */\r\n    init: function (workportal) {\r\n        this.device = bizagi.util.detectDevice();\r\n        this.workportal = workportal;\r\n        this.cachedFacade = null;\r\n    },\r\n\r\n    /*\r\n    *   Returns the appropiate workportal facade based on the device detection\r\n    *   Because it loads the scripts on demand it must return a promise\r\n    */\r\n    getWorkportalFacade: function (dataService, initializeTemplates) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n        initializeTemplates = typeof (initializeTemplates) !== \"undefined\" ? initializeTemplates : true;\r\n\r\n        if (self.cachedFacade != null) {\r\n            // Resolve with cached factory                \r\n            defer.resolve(self.cachedFacade);\r\n\r\n        } else {\r\n\r\n            // If factory is not cached then build it\r\n            if (this.device === \"desktop\") {\r\n\r\n                self.cachedFacade = new bizagi.workportal.desktop.facade(this.workportal, dataService);\r\n\r\n                // Chain template loading\r\n                $.when(self.cachedFacade.initAsyncStuff(initializeTemplates)).done(function () {\r\n                    // Resolve operation\r\n                    defer.resolve(self.cachedFacade);\r\n                });\r\n\r\n                return defer.promise();\r\n\r\n            } else if (bizagi.util.isTabletDevice()) {\r\n\r\n                self.cachedFacade = new bizagi.workportal.tablet.facade(dataService, this.device);\r\n\r\n                // Chain template loading\r\n                $.when(self.cachedFacade.initAsyncStuff()).done(function () {\r\n                    // Resolve operation\r\n                    defer.resolve(self.cachedFacade);\r\n                });\r\n\r\n                return defer.promise();\r\n\r\n            } else if (bizagi.util.isSmartphoneDevice()) {\r\n\r\n                self.cachedFacade = new bizagi.workportal.smartphone.facade(dataService, this.device);\r\n\r\n                // Chain template loading\r\n                $.when(self.cachedFacade.initAsyncStuff()).done(function () {\r\n                    // Resolve operation\r\n                    defer.resolve(self.cachedFacade);\r\n                });\r\n\r\n                return defer.promise();\r\n            } else {\r\n                // if no device supported\r\n                bizagi.showMessageBox(\"Not supported device: \" + this.device, \"Error\");\r\n                defer.resolve(\"\");\r\n            }\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Returns the current data service being used\r\n    */\r\n    getDataService: function () {\r\n        return this.dataService;\r\n    }\r\n\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal\r\n *   Author: Bizagi Mobile Team\r\n *   Comments:\r\n *   -   This script will process a workportal page using a device factory to use the adequate rendering\r\n *       to create the layout\r\n */\r\n\r\n// Reload without tag\r\nif (location.href.indexOf(\"#\") != -1) {\r\n    document.location = \"index.html\";\r\n}\r\n\r\n// Define BizAgi Workportal namespace\r\nbizagi.workportal = bizagi.workportal || {};\r\n\r\n// Define global variables\r\nbizagi.workportal.currentInboxView = \"inbox\";\r\n\r\n// Define state variables\r\nbizagi.workportal.state = bizagi.workportal.state || {};\r\n\r\n// Define webparts\r\nbizagi.webparts = bizagi.webparts || {};\r\nbizagi.webparts.instances = bizagi.webparts.instances || [];\r\n\r\n//bizagi.workportal.instances = {};\r\n\r\n/*\r\n *   Renders the workportal\r\n */\r\n$.Class.extend(\"bizagi.workportal.facade\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function(params) {\r\n\r\n        // Defines a device factory for all rendering\r\n        this.deviceFactory = new bizagi.workportal.device.factory(this);\r\n\r\n        // Creates a data service instance\r\n        this.dataService = new bizagi.workportal.services.service(params);\r\n\r\n        // Create instance of routing service\r\n        this.dataService.routing = new bizagi.workportal.services.routing({ dataService: this.dataService });\r\n\r\n        // Execute Case link\r\n        if (!bizagi.util.isEmpty(window.location.search)) {\r\n            var queryString = bizagi.util.getQueryString();\r\n\r\n            // Set idCase param from query string\r\n            if (queryString[\"idCase\"]) {\r\n                params.idCase = queryString[\"idCase\"];\r\n                this.isConfiguredFromHash = true;\r\n            }\r\n\r\n            // Set idWorkitem param from query string\r\n            if (queryString[\"idWorkitem\"]) {\r\n                params.idWorkitem = queryString[\"idWorkitem\"];\r\n            }\r\n        }\r\n\r\n        // Set default params\r\n        this.defaultParams = params || {};\r\n    },\r\n\r\n    /*\r\n    *   Creates a webpart inside a canvas but don't execute it\r\n    */\r\n    createWebpart: function(params) {\r\n        return this.executeWebpart($.extend(params, {\r\n            creating: true\r\n        }));\r\n    },\r\n\r\n    /*\r\n    *   Executes a webpart inside a canvas\r\n    */\r\n    executeWebpart: function(params) {\r\n        var self = this;\r\n        var doc = this.ownerDocument;\r\n        var body = $(\"body\", doc);\r\n\r\n        // Creates ready deferred\r\n        var canvas = params.canvas;\r\n\r\n        var processWebpart = true;\r\n        if (params.webpartConfiguration) {\r\n            processWebpart = self.testWebpartConfiguration(params);\r\n        }\r\n        if (processWebpart) {\r\n            // Process the webpart asynchonous\r\n            return self.processWebpart(params)\r\n                .then(function(result) {\r\n\r\n                    result.name = result.webpart.Class.fullName;\r\n                    bizagi.webparts.instances.push(result);\r\n\r\n                    // Append content to canvas\r\n                    canvas.append(result.content);\r\n                    canvas.triggerHandler(\"ondomincluded\");\r\n\r\n                    return result;\r\n                });\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Returns the execution deferred to determine if the component is ready or not\r\n    */\r\n    ready: function() {\r\n\r\n        return this.executionDeferred.promise();\r\n    },\r\n\r\n    /*\r\n    *   Process a webpart\r\n    */\r\n    processWebpart: function(params) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n        var webpartController;\r\n\r\n        // Create a workportal facade\r\n        var facade = this.deviceFactory.getWorkportalFacade(self.dataService, false);\r\n\r\n        // Combine workportal params with call params\r\n        $.extend(params, this.defaultParams);\r\n\r\n        // Set callback when requests have been done\r\n        $.when(facade).then(function(workportalFacade) {\r\n\r\n            var deferTemplates = new $.Deferred();\r\n\r\n            // Load webpart templates\r\n            $.when(workportalFacade.loadWebpart(params))\r\n                .done(function() {\r\n                    deferTemplates.resolve(workportalFacade);\r\n                });\r\n\r\n            return deferTemplates.promise();\r\n\r\n        }).then(function(workportalFacade) {\r\n            webpartController = workportalFacade.getWebpart(params.webpart, params);\r\n\r\n            // Render the full content\r\n            return webpartController.render(params);\r\n\r\n        }).then(function(content) {\r\n            // Resolve deferred\r\n            defer.resolve({ webpart: webpartController, content: content });\r\n        }).fail(function(error) {\r\n            defer.reject(error);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Returns the main controller\r\n    */\r\n    getMainController: function() {\r\n        return this.mainController;\r\n    },\r\n\r\n    execute: function() {\r\n        var self = this;\r\n        var args = arguments;\r\n        var facade = this.deviceFactory.getWorkportalFacade(self.dataService);\r\n\r\n        // Process offline data \r\n        self.processOfflineData();\r\n\r\n        bizagi.loading.start();\r\n        return $.when(facade).then(function(deviceFacade) {\r\n            return deviceFacade.executeWebparts(args);\r\n        }).then(function() {\r\n            // Check if the required params are filled\r\n            if (!bizagi.util.isEmpty(self.defaultParams.idCase) && self.isConfiguredFromHash) {\r\n                var params = {\r\n                    action: \"routing\",\r\n                    idCase: self.defaultParams.idCase\r\n                };\r\n\r\n                if (self.defaultParams.idWorkitem) {\r\n                    params.idWorkitem = self.defaultParams.idWorkitem;\r\n                }\r\n\r\n                var splitView = $(\"#homePortal\").data(\"kendoMobileSplitView\");\r\n                if (splitView && splitView.element) {\r\n                    splitView.element.hide();\r\n                }\r\n\r\n                bizagi.webpart.publish(\"executeRoutingAction\", params);\r\n            } else {\r\n                // TODO: To review in iOS\r\n                if (!bizagi.util.isNativePluginSupported() || (bizagi.util.isNativePluginSupported() && bizagi.util.isiOSTabletDevice())) {\r\n                    bizagi.kendoMobileApplication.navigate(\"#homePortal\");\r\n                }\r\n            }\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Process offline data\r\n    */\r\n    processOfflineData: function() {\r\n        var self = this;\r\n        var shouldPushData = !(bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice());       \r\n        if(shouldPushData && typeof self.dataService.fetchOfflineData != \"undefined\" && self.dataService.online === true) {\r\n            if(bizagi.util.isOfflineFormsV2Supported()){\r\n                $.when(self.dataService.getOutboxCasesCount())\r\n                .then( function(cases){\r\n                    if(cases > 0){\r\n                        if (bizagi.util.isNativePluginSupported()){\r\n                            bizagiapp.openSyncDialog();\r\n                        }\r\n                        self.dataService.pushOfflineData()\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                self.dataService.pushOfflineData()\r\n            }\r\n        }\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Smartphone Workportal Facade\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script will define a workportal facade to access to all components\r\n*/\r\n\r\n\r\n$.Class.extend(\"bizagi.workportal.tablet.facade\", {\r\n    render_module: \"renderingflat\",\r\n\r\n    setup: function () {                \r\n        this.render_module = bizagi.override.enableMSF ? \"rendering\" : \"renderingflat\";\r\n    },\r\n    /*\r\n    *   Returns the implementation class by widget\r\n    */\r\n    getWidgetImplementation: function(widget) {\r\n        bizagi.log(\"getWidgetImplementation\" + widget);\r\n    }\r\n}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function(dataService, device) {\r\n        var self = this;\r\n        self.templates = {};\r\n        self.dataService = dataService;\r\n        self.setMobileMetaTags();\r\n        self.setMobileIcons();\r\n        self.modules = {};\r\n        self.device = device;\r\n        self.homePortalFramework = new bizagi.workportal.homeportalFramework(this);\r\n\r\n        if (bizagi.override.enableMSF) {\r\n            if (bizagi.hasOwnProperty(\"kendo\")) {\r\n                self.templateService = new bizagi.kendo.templates.services.service(bizagi.localization);\r\n            } else {\r\n                self.templateService = new bizagi.templates.services.service(bizagi.localization);\r\n            }\r\n        } else {\r\n            self.templateService = new bizagi.kendo.templates.services.service(bizagi.localization);\r\n        }\r\n    },\r\n\r\n    /* SETS iPhone META TAGS\r\n    =====================================================*/\r\n    setMobileMetaTags: function () {\r\n        $('<meta>', {\r\n            name: \"apple-mobile-web-app-capable\",\r\n            content: \"yes\"\r\n        }).appendTo('head');\r\n\r\n        $('<meta>', {\r\n            name: \"viewport\",\r\n            content: \"width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no\"\r\n        }).appendTo('head');\r\n\r\n        $('<link>', {\r\n            rel: 'apple-touch-icon-precomposed',\r\n            href: 'jquery/common/base/css/tablet/images/BizAgi_logo.png'\r\n        }).appendTo('head');\r\n\r\n        $('<link>', {\r\n            rel: 'apple-touch-startup-image',\r\n            href: 'jquery/common/base/css/tablet/images/splash.png'\r\n        }).appendTo('head');\r\n    },\r\n\r\n    setMobileIcons: function () {\r\n        var generatedIcons = '<svg xmlns=\"http://www.w3.org/2000/svg\" display=\"none\" width=\"0\" height=\"0\" id=\"genome-mobile-icons\"><defs> <path d=\"M14,11 C14.5522847,11 15,11.4477153 15,12 C15,12.5522847 14.5522847,13 14,13 C13.4477153,13 13,12.5522847 13,12 C13,11.4477153 13.4477153,11 14,11 Z M10.62,11.22 C10.8071865,11.4087188 10.9115368,11.664197 10.91,11.93 C10.9115368,12.195803 10.8071865,12.4512812 10.62,12.64 L8.53,14.71 C8.34373936,14.8947442 8.09233988,14.9988954 7.83,15 C7.5627541,14.9988906 7.30707144,14.8908556 7.12,14.7 C6.73227641,14.3099625 6.73227641,13.6800375 7.12,13.29 L7.42,13 L4.55,13 C3.61113249,13.0026559 2.7096639,12.6322374 2.04390894,11.9702332 C1.37815398,11.308229 1.00264842,10.4088675 1,9.47 L1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 L3,9.47 C3.01094569,10.3182207 3.70170869,11.0000706 4.55,11 L7.55,11 L7.12,10.58 C6.93068735,10.3922334 6.82420168,10.1366375 6.82420168,9.87 C6.82420168,9.60336246 6.93068735,9.3477666 7.12,9.16 C7.51003745,8.77227641 8.13996255,8.77227641 8.53,9.16 L10.62,11.22 Z M2,3 C2.55228475,3 3,3.44771525 3,4 C3,4.55228475 2.55228475,5 2,5 C1.44771525,5 1,4.55228475 1,4 C1,3.44771525 1.44771525,3 2,3 Z M11.45,3 C12.3888675,2.99734409 13.2903361,3.36776255 13.9560911,4.02976678 C14.621846,4.691771 14.9973516,5.59113247 15,6.53 L15,9 C15,9.55228475 14.5522847,10 14,10 C13.4477153,10 13,9.55228475 13,9 L13,6.53 C12.9890543,5.6817793 12.2982913,4.99992938 11.45,5 L8.45,5 L8.88,5.42 C9.06931265,5.6077666 9.17579832,5.86336246 9.17579832,6.13 C9.17579832,6.39663754 9.06931265,6.6522334 8.88,6.84 C8.69128117,7.02718651 8.43580298,7.13153676 8.17,7.13 C7.90766012,7.12889538 7.65626064,7.02474416 7.47,6.84 L5.38,4.78 C5.19281349,4.59128117 5.08846324,4.33580298 5.09,4.07 C5.08846324,3.80419702 5.19281349,3.54871883 5.38,3.36 L7.47,1.29 C7.86212218,0.900639269 8.49563924,0.902877853 8.88499998,1.29500002 C9.27436072,1.68712218 9.27212216,2.32063925 8.88,2.71 L8.58,3 L11.45,3 Z\" id=\"icon-sync-path-1\"/> </defs><symbol viewBox=\"0 0 16 16\" id=\"icon-sync\"><desc>Created with sketchtool.</desc> <!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com -->    <g id=\"icon-sync-Mobile-Prototype\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\"> <g id=\"icon-sync-Inbox-Offline-Edited\" transform=\"translate(-311.000000, -157.000000)\"> <g id=\"icon-sync-cases\" transform=\"translate(0.000000, 141.000000)\"> <g id=\"icon-sync-case\"> <g id=\"icon-sync-edited\" transform=\"translate(311.000000, 16.000000)\"> <g id=\"icon-sync-2.0/16x/cloud\"> <mask id=\"icon-sync-mask-2\" fill=\"white\"> <use xlink:href=\"#icon-sync-path-1\"/> </mask> <use id=\"icon-sync-Mask\" fill=\"#9E9E9E\" xlink:href=\"#icon-sync-path-1\"/> </g> </g> </g> </g> </g> </g> </symbol><symbol viewBox=\"0 0 32 32\" id=\"icon-trash\"><desc>Created with sketchtool.</desc> <!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com -->   <g id=\"icon-trash-Mobile-Prototype\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\"> <g id=\"icon-trash-Drafts-Offline\" transform=\"translate(-335.000000, -149.000000)\"> <g id=\"icon-trash-cases\" transform=\"translate(0.000000, 141.000000)\"> <g id=\"icon-trash-case\"> <g id=\"icon-trash-icon\" transform=\"translate(335.000000, 8.000000)\"> <rect id=\"icon-trash-box\" x=\"0\" y=\"0\" width=\"32\" height=\"32\"/> <path d=\"M21,13 C21.553,13 22,13.447 22,14 L22,21 C22,22.654 20.654,24 19,24 L13,24 C11.346,24 10,22.654 10,21 L10,14 C10,13.447 10.447,13 11,13 C11.553,13 12,13.447 12,14 L12,21 C12,21.552 12.448,22 13,22 L19,22 C19.552,22 20,21.552 20,21 L20,14 C20,13.447 20.447,13 21,13 Z M14,19.5 C14,19.776 13.776,20 13.5,20 C13.224,20 13,19.776 13,19.5 L13,14.5 C13,14.224 13.224,14 13.5,14 C13.776,14 14,14.224 14,14.5 L14,19.5 Z M16.5,19.5 C16.5,19.776 16.276,20 16,20 C15.724,20 15.5,19.776 15.5,19.5 L15.5,14.5 C15.5,14.224 15.724,14 16,14 C16.276,14 16.5,14.224 16.5,14.5 L16.5,19.5 Z M19,19.5 C19,19.776 18.776,20 18.5,20 C18.224,20 18,19.776 18,19.5 L18,14.5 C18,14.224 18.224,14 18.5,14 C18.776,14 19,14.224 19,14.5 L19,19.5 Z M23,10 C23.553,10 24,10.447 24,11 C24,11.553 23.553,12 23,12 L9,12 C8.447,12 8,11.553 8,11 C8,10.447 8.447,10 9,10 L13,10 L13,9 C13,8.447 13.447,8 14,8 L18,8 C18.553,8 19,8.447 19,9 L19,10 L23,10 Z\" id=\"icon-trash-trash\" fill=\"#9E9E9E\"/> </g> </g> </g> </g> </g> </symbol><symbol viewBox=\"0 0 24 24\" id=\"icon-check-mark\"><g id=\"icon-check-mark-check-mark-24x\"><path d=\"M8.11,19.36a1,1,0,0,1-.71-.29l-4.95-5a1,1,0,0,1,0-1.41,1,1,0,0,1,1.42,0L8.11,17l12-12a1,1,0,0,1,1.42,0,1,1,0,0,1,0,1.41L8.82,19.07A1,1,0,0,1,8.11,19.36Z\"/></g></symbol><symbol viewBox=\"0 0 16 16\" id=\"icon-close\"><g id=\"icon-close-close-16x\"><path d=\"M9.41,8l5.3-5.29a1,1,0,1,0-1.42-1.42L8,6.59,2.71,1.29A1,1,0,0,0,1.29,2.71L6.59,8l-5.3,5.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L8,9.41l5.29,5.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42Z\"/></g></symbol><symbol viewBox=\"0 0 24 24\" id=\"icon-download\"><g id=\"icon-download-download-24x\"><path d=\"M22,23H2a1,1,0,0,1-1-1V17a1,1,0,0,1,2,0v4H21V17a1,1,0,0,1,2,0v5A1,1,0,0,1,22,23Z\"/><path d=\"M19,10a1,1,0,0,0-.29-.71,1,1,0,0,0-1.42,0L13,13.58V2a1,1,0,0,0-2,0V13.58L6.71,9.29a1,1,0,0,0-1.42,1.42l6,6a.91.91,0,0,0,.33.22.69.69,0,0,0,.24,0A.7.7,0,0,0,12,17a.7.7,0,0,0,.14,0,.69.69,0,0,0,.24,0,.91.91,0,0,0,.33-.22l6-6A1,1,0,0,0,19,10Z\"/></g></symbol><symbol viewBox=\"0 0 24 24\" id=\"icon-offline\"><desc>Created with sketchtool.</desc> <!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com -->   <g id=\"icon-offline-Mobile-Prototype\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\"> <g id=\"icon-offline-Inbox-Offline\" transform=\"translate(-32.000000, -97.000000)\" fill=\"#9E9E9E\"> <g id=\"icon-offline-controls/alert\" transform=\"translate(16.000000, 84.000000)\"> <g id=\"icon-offline-icon\" transform=\"translate(16.000000, 13.000000)\"> <path d=\"M7.86075713,14.278983 L8.17741033,13.9623298 C8.61266861,13.5270715 9.31870454,13.5270715 9.75396283,13.9623298 L12.0238702,16.2322372 L14.2937776,13.9623298 C14.7290359,13.5270715 15.4350718,13.5270715 15.8703301,13.9623298 L16.1869833,14.278983 C16.6222416,14.7146143 16.6222416,15.4202772 16.1869833,15.8555355 L13.9170759,18.1250699 L16.0777025,20.2856965 C16.5129608,20.7209548 16.5129608,21.4273637 16.0777025,21.862622 L15.7610493,22.1789022 C15.325791,22.6141605 14.6197551,22.6141605 14.1844968,22.1789022 L12.0238702,20.0182756 L9.86287064,22.1789022 C9.42761236,22.6141605 8.72157643,22.6141605 8.28631815,22.1789022 L7.96966495,21.862622 C7.53440666,21.4273637 7.53440666,20.7209548 7.96966495,20.2856965 L10.1302915,18.1250699 L7.86075713,15.8555355 C7.42549885,15.4202772 7.42549885,14.7142413 7.86075713,14.278983 M4.49878784,10.0558215 C6.56169578,8.40765836 9.17138062,7.41517996 12.0171567,7.41517996 C14.846522,7.41517996 17.4431529,8.39572325 19.5008392,10.0267297 C19.8999192,10.2557344 20.1714428,10.6812955 20.1714428,11.1743644 C20.1714428,11.9080002 19.5769255,12.5025176 18.8436626,12.5025176 C18.4408529,12.5025176 18.0842917,12.3193883 17.840741,12.0359296 L17.8317896,12.044881 C16.2276372,10.7887114 14.2128427,10.0334432 12.0175297,10.0334432 C9.81028159,10.0334432 7.78504382,10.7965438 6.17678871,12.0646485 L6.16746441,12.0553242 C5.92391372,12.3440045 5.56399577,12.5316094 5.15671039,12.5316094 C4.42307453,12.5316094 3.82855722,11.9370921 3.82855722,11.2034562 C3.82818425,10.7103873 4.09970784,10.2851992 4.49878784,10.0558215 M24,7.33573693 C24,8.06899981 23.4054827,8.6638901 22.6714739,8.6638901 C22.2716479,8.6638901 21.9173245,8.48337167 21.6737739,8.20326972 L21.632001,8.24504258 C19.0402188,6.00497296 15.6648225,4.64660906 11.9701622,4.64660906 C8.288183,4.64660906 4.92322994,5.99564866 2.3348045,8.22191832 C2.09125381,8.50798782 1.73282775,8.69298191 1.32815317,8.69298191 C0.594517312,8.69298191 0,8.0984646 0,7.36482874 C0,6.90495431 0.234226394,6.49990676 0.589668677,6.26157767 C3.65475228,3.60937403 7.64629825,2 12.0175297,2 C16.3730963,2 20.3515882,3.59818487 23.4118232,6.2332318 C23.7665195,6.47156089 24,6.87623547 24,7.33573693\" id=\"icon-offline-icon-offline\"/> </g> </g> </g> </g> </symbol><symbol viewBox=\"0 0 16 16\" id=\"icon-refresh\"><g id=\"icon-refresh-refresh-16x\"><path d=\"M13.84,7.16a1,1,0,0,0-1,1,4.85,4.85,0,1,1-2.05-4h-1a1,1,0,0,0,0,2H13a1,1,0,0,0,1-1V2a1,1,0,0,0-2,0v.57a6.84,6.84,0,1,0,2.89,5.59A1,1,0,0,0,13.84,7.16Z\"/></g></symbol><symbol viewBox=\"0 0 24 24\" id=\"icon-retrieve-offline\"><g id=\"icon-retrieve-offline-retrieving-24x\"><path d=\"M5.24,13.45a2.86,2.86,0,0,1-.1-4.64l.78-.59-.26-.94a1.09,1.09,0,0,1,0-.26A1.34,1.34,0,0,1,7,5.71a1.65,1.65,0,0,1,.38,0l1.13.33.55-1a3.91,3.91,0,0,1,3.48-2,4,4,0,0,1,2.37.8l1.43-1.43A6,6,0,0,0,7.49,3.75,3.35,3.35,0,0,0,3.63,7a3,3,0,0,0,0,.42,4.83,4.83,0,0,0,.16,7.42Z\"/><path d=\"M18.33,5.71a5.13,5.13,0,0,0-.26-.87l2.14-2.13a1,1,0,1,0-1.42-1.42l-15,15a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L6.92,16H11v3.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3a1,1,0,0,0-1.42-1.42L13,19.59V16h3.64A5.27,5.27,0,0,0,18.33,5.71ZM16.64,14H8.91l7.51-7.51.11.81.95.24A3.27,3.27,0,0,1,16.64,14Z\"/></g></symbol><symbol viewBox=\"0 0 24 24\" id=\"icon-warning\"><g id=\"icon-warning-warning-24x\"><path d=\"M21.33,23H2.62A2,2,0,0,1,.83,20.11L10.18,2.33A2,2,0,0,1,12,1.24h0a2,2,0,0,1,1.79,1.11l9.36,17.74A2,2,0,0,1,21.33,23ZM12,3.26,2.6,21l18.74,0Z\"/><path d=\"M12,16a1,1,0,0,1-1-1V8a1,1,0,0,1,2,0v7A1,1,0,0,1,12,16Z\"/><circle cx=\"12\" cy=\"18\" r=\"1\"/></g></symbol></svg>'\r\n        $(\"head\").append(generatedIcons);\r\n    },\r\n\r\n    /*\r\n    *   This function will load asynchronous stuff needed in the module\r\n    */\r\n    initAsyncStuff: function() {\r\n        var self = this;\r\n        // Load default templates            \r\n        return $.when(self.loadTemplate(\"base\", bizagi.getTemplate(\"base.workportal.tablet\")))\r\n            .then(function(template) {\r\n                var def = new $.Deferred();\r\n                $(\"body\").append(template);\r\n                bizagi.util.tablet.startkendo({\r\n                    started: function() {\r\n                        def.resolve();\r\n                    }\r\n                });\r\n                return def.promise();\r\n            });\r\n    },\r\n\r\n    /*\r\n    *   Load one template and save it internally\r\n    */\r\n    loadTemplate: function(template, templateDestination) {\r\n        var self = this;\r\n        // Go fetch the template\r\n        return self.templateService.getTemplate(templateDestination, template)\r\n            .done(function(resolvedTemplate) {\r\n                if (typeof resolvedTemplate === \"string\") {\r\n                    self.templates[template] = $.trim(resolvedTemplate.replace(/\\n/g, \"\"));\r\n                }\r\n            });\r\n    },\r\n\r\n    /*\r\n    *   Load one template and save it internally\r\n    */\r\n    loadTemplateWebpart: function(template, templateDestination) {\r\n        var self = this;\r\n\r\n        // Go fetch the template\r\n        return self.templateService.getTemplateWebpart(templateDestination, template)\r\n            .done(function(resolvedRemplate) {\r\n                self.templates[template] = $.trim(resolvedRemplate.replace(/\\n/g, \"\"));\r\n            });\r\n    },\r\n\r\n    /*\r\n    *   Method to fetch templates from a private dictionary\r\n    */\r\n    getTemplate: function(template) {\r\n        var self = this;\r\n        return self.templates[template];\r\n    },\r\n    /*\r\n    *   Initializes a webpart\r\n    */\r\n    loadWebpart: function(params) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n        var webpartName = params.webpart;\r\n        var webpart = bizagi.getWebpart(webpartName, params);\r\n\r\n        if (!webpart) {\r\n            bizagi.log(\"webpart not found\");\r\n        }\r\n\r\n        if (bizagi.loader.environment === \"release\") {\r\n            defer.resolve(webpart);\r\n        } else {\r\n            // Ensure the webpart is initialized\r\n            $.when(bizagi.util.initWebpart(webpart, self.device))\r\n                .done(function() {\r\n                    // Load all templates asyncronously\r\n                    $.when.apply(this, $.map(webpart.tmpl, function(tmpl) {\r\n                        return self.loadTemplateWebpart(tmpl.originalAlias, bizagi.getTemplate(tmpl.alias, true));\r\n                    })).done(function() {\r\n                        defer.resolve(webpart);\r\n                    });\r\n\r\n                });\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Returns a webpart\r\n    */\r\n    getWebpart: function(webpartImplementation, params) {\r\n        try {\r\n\r\n            // Create a dynamic function to avoid problem with eval calls when minifying the code\r\n            if (webpartImplementation.indexOf(\"bizagi\") === -1) {\r\n                webpartImplementation = \"bizagi.workportal.webparts.\" + webpartImplementation;\r\n            }\r\n\r\n            var dynamicFunction;\r\n            var stringBuilder = [\"var baDynamicFn = function(facade, dataService, params){ \\r\\n\"];\r\n\r\n            stringBuilder.push(\"return new \" + webpartImplementation + \"(facade, dataService, params);\\r\\n\");\r\n            stringBuilder.push(\"}\\r\\n\");\r\n            stringBuilder.push(\"baDynamicFn\");\r\n\r\n            dynamicFunction = eval(stringBuilder.join(\"\\n\"));\r\n\r\n            // Call the dynamic function\r\n            return dynamicFunction(this, this.dataService, params);\r\n\r\n        } catch (e) {\r\n            bizagi.log(e);\r\n        }\r\n    },\r\n\r\n    /*\r\n    * call the render method for webparts and insert into canvas\r\n    */\r\n    executeWebpart: function(params) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        $.when(self.loadWebpart(params)).done(function(webpart) {\r\n            var webpartImplementation = webpart[\"class\"];\r\n            var dynamic = self.getWebpart(webpartImplementation, params);\r\n\r\n            $.when(dynamic.render($.extend(params, { creating: false }))).done(function() {\r\n\r\n                params.canvas.triggerHandler(\"ondomincluded\");\r\n                defer.resolve(dynamic);\r\n\r\n            });\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    executeWebparts: function() {\r\n        var self = this;\r\n\r\n        // load rendering first\r\n        self.loadModule(self.Class.render_module);\r\n\r\n        return $.when(self.dataService.getCurrentUser()).fail(function(err) {\r\n            $.when(self.dataService.logoutMobile())\r\n                .always(function(response) {\r\n                    self.defaultLogout();\r\n                });\r\n        }).pipe(\r\n            function(currentUser) {\r\n                // Sacar de este lugar cuando se adicione el security al currentUser\r\n                currentUser.userProperties = {};\r\n                var userProperty;\r\n                var i = -1;\r\n\r\n                while ((userProperty = currentUser.sUserProperties[++i])) {\r\n                    currentUser.userProperties[userProperty.key] = userProperty.value;\r\n                }\r\n\r\n                bizagi.currentUser = currentUser;\r\n                var startpage = currentUser.userProperties.userstartpage = currentUser.userProperties.userstartpage || \"\";\r\n                self.sortMenuItemsByStartPage(startpage, currentUser);\r\n\r\n\r\n                return $.when(self.loadReleaseTemplates()).then(function() {\r\n                    return $.when(\r\n                        self.executeWebpart({\r\n                            webpart: \"homePortal\",\r\n                            canvas: $(\"body\")\r\n                        }),\r\n                        self.executeWebpart({\r\n                            webpart: \"menu\",\r\n                            canvas: $(\"body\")\r\n                        }),\r\n                        self.executeWebpart({\r\n                            webpart: \"newcase\",\r\n                            canvas: $(\"body\")\r\n                        }),\r\n                        self.executeWebpart({\r\n                            webpart: \"render\",\r\n                            canvas: $(\"body\")\r\n                        })).then(function() {\r\n                        bizagi.debug(\"Finalizo ejecución de webparts workportal\");\r\n                    });\r\n                });\r\n            }\r\n        );\r\n    },\r\n\r\n    loadReleaseTemplates: function() {\r\n\r\n        if (bizagi.loader.environment !== \"release\") {\r\n            return true;\r\n        }\r\n\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n        var prefix = bizagi.loader.useAbsolutePath ? bizagi.loader.basePath + bizagi.loader.getLocationPrefix() : \"\" + bizagi.loader.getLocationPrefix();\r\n        var url = prefix + \"jquery/workportalflat/production/\" + this.device.replace(/[^a-z0-9]+/gi, \"\") + \"/webpart.\" + this.device.replace(/[^a-z0-9]+/gi, \"\") + \".production.tmpl.html?build=\" + bizagi.loader.build;\r\n\r\n        steal.then({\r\n            src: url,\r\n            id: url,\r\n            type: \"text\",\r\n            waits: false,\r\n            onError: function(options) {\r\n                bizagi.log(\"Could not load file \" + options.src, options, \"error\");\r\n                defer.reject(options);\r\n            }\r\n        }).then(function() {\r\n            var waitingTime = 1000;\r\n            setTimeout( function() {\r\n                var data = steal.resources[url].options.text;\r\n                self.templates = eval(\"(\" + data + \")\");\r\n\r\n                Object.keys(self.templates).map(function(key) {\r\n                    self.templates[key] = self.templateService.localization.translate(self.templates[key]);\r\n                });\r\n\r\n                defer.resolve();\r\n            }, waitingTime);            \r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    sortMenuItemsByStartPage: function(startpage, currentUser) {\r\n        var self = this;\r\n\r\n        /*\r\n        Values userstartpage property\r\n        1. \"\" -> El usuario no ha configurado esta opción(usuario viejo).\r\n        2. \"1\" -> Automatic\r\n        3. \"2\" -> Me\r\n        4. \"3\" -> Inbox\r\n        */\r\n\r\n        if (startpage === \"1\" || startpage === \"2\") {\r\n            if (typeof currentUser.associatedStakeholders !== \"undefined\" && currentUser.associatedStakeholders.length > 0) {\r\n                // Merge layouts - Load dashboard\r\n                self.homePortalFramework.homePortalLayout = $.extend(self.homePortalFramework.homePortalLayoutDashboard,\r\n                    self.homePortalFramework.homePortalLayoutTaskFeed,\r\n                    self.homePortalFramework.homePortalLayoutComplement);\r\n            } else {\r\n                // Merge layouts - Load task feed\r\n                self.homePortalFramework.homePortalLayout = $.extend(self.homePortalFramework.homePortalLayoutTaskFeed,\r\n                    self.homePortalFramework.homePortalLayoutDashboard,\r\n                    self.homePortalFramework.homePortalLayoutComplement);\r\n            }\r\n        } else {\r\n            // Merge layouts - Load task feed\r\n            self.homePortalFramework.homePortalLayout = $.extend(self.homePortalFramework.homePortalLayoutTaskFeed,\r\n                self.homePortalFramework.homePortalLayoutDashboard,\r\n                self.homePortalFramework.homePortalLayoutComplement);\r\n        }\r\n    },\r\n\r\n    loadModule: function(bizagiModule) {\r\n        var self = this;\r\n        if (typeof bizagiModule !== \"string\") {\r\n            return;\r\n        }\r\n\r\n        if (typeof self.modules[bizagiModule] !== \"undefined\") {\r\n            return self.modules[bizagiModule];\r\n        }\r\n\r\n        self.modules[bizagiModule] = new $.Deferred();\r\n\r\n        bizagi.loader.start(bizagiModule).then(function() {\r\n            self.modules[bizagiModule].resolve();\r\n        });\r\n\r\n        return self.modules[bizagiModule].promise();\r\n    },\r\n\r\n    defaultLogout: function() {\r\n        /* istanbul ignore next: untestable */\r\n        if (bizagi.util.isCordovaSupported()) {\r\n            window.location = bizagi.services.ajax.logoutPage;\r\n        } else {\r\n            window.location.replace(\"\");\r\n        }\r\n    }\r\n});","/*\r\n *   Name: BizAgi Smartphone Workportal Facade\r\n *   Author: luisce\r\n *   Comments:\r\n *   -   This script will define a workportal facade to access to all components\r\n */\r\n\r\nbizagi.workportal.tablet.facade.extend(\"bizagi.workportal.tablet.facade\", {\r\n    BIZAGI_NATIVE_COMPONENT_HOMEPORTAL: \"homeportal\"\r\n}, {\r\n    executeWebparts: function() {\r\n        var self = this;\r\n        return self._super.apply(this, arguments).then(function() {\r\n\r\n            if (bizagi.util.isNativePluginSupported()) {\r\n                if (bizagi.getNativeComponent() === self.Class.BIZAGI_NATIVE_COMPONENT_HOMEPORTAL) {\r\n                    bizagiapp.homePortalReady();\r\n                } else {\r\n                    bizagiapp.workPortalReady();\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    sortMenuItemsByStartPage: function(startpage, currentUser) {\r\n        var self = this;\r\n\r\n        // TODO: To review in iOS\r\n        if (!bizagi.util.isAndroidDevice()) {\r\n            self._super(startpage, currentUser);\r\n        } else {\r\n            if (typeof currentUser.associatedStakeholders !== \"undefined\" &&\r\n                currentUser.associatedStakeholders.length > 0) {\r\n                // Merge layouts - Load dashboard\r\n                self.homePortalFramework.homePortalLayout = $.extend(self.homePortalFramework.homePortalLayoutDashboard,\r\n                    self.homePortalFramework.homePortalLayoutComplement);\r\n            } else {\r\n                // Merge layouts - Load task feed\r\n                self.homePortalFramework.homePortalLayout = $.extend(self.homePortalFramework.homePortalLayoutDashboard,\r\n                    self.homePortalFramework.homePortalLayoutComplement);\r\n            }\r\n        }\r\n    },\r\n\r\n    loadModule: function(bizagiModule) {\r\n        var self = this;\r\n        var device = bizagi.util.detectRealDevice();\r\n\r\n        if (typeof bizagiModule !== \"string\") return;\r\n\r\n        //if (typeof self.modules[bizagiModule] !== 'undefined') {\r\n        //    return self.modules[bizagiModule];\r\n        //}\r\n\r\n        self.modules[bizagiModule] = new $.Deferred();\r\n\r\n        bizagi.loader.start(bizagiModule, device).then(function() {\r\n            self.modules[bizagiModule].resolve();\r\n        });\r\n\r\n        return self.modules[bizagiModule].promise();\r\n    }\r\n\r\n});","\r\n/*\r\n*   Name: BizAgi Workportal Webpart helper\r\n*   Author: oscaro\r\n*   Comments:\r\n*   -   This script will define helper functions that the webparts could use to reuse some logic\r\n*/\r\n/*\r\n*   Static Methods to configure webparts\r\n*/\r\nbizagi = (typeof (bizagi) !== \"undefined\") ? bizagi : {};\r\nbizagi.webparts = (typeof (bizagi.webparts) !== \"undefined\") ? bizagi.webparts : {};\r\n\r\n\r\n$.Class.extend(\"bizagi.workportal.webpart.helper\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (webpart) {\r\n        // Set data service\r\n        this.dataService = webpart.dataService;\r\n\r\n        // Set l10n service\r\n        this.resources = webpart.resources;\r\n\r\n        // Set workportal facade\r\n        this.workportalFacade = webpart.workportalFacade;\r\n\r\n        //Load Aditional templates\r\n        this.templates = {};\r\n    },\r\n    /*  \r\n    *   Returns the file url\r\n    */\r\n    getFileImage: function (files) {\r\n        var self = this;\r\n\r\n        if (!files || files.length == 0) return self.getEmptyFile();\r\n        return files;\r\n    },\r\n    getFile: function (files) {\r\n        var self = this;\r\n\r\n        if (!files || files.length == 0) return self.getEmptyFile();\r\n        return self.dataService.getFile(files[0]);\r\n    },\r\n\r\n    loadTemplate: function (template, templateDestination) {\r\n        var self = this;\r\n\r\n        // Go fetch the template\r\n        return self.workportalFacade.templateService.getTemplate(templateDestination)\r\n                .done(function (resolvedRemplate) {\r\n                    self.templates[template] = resolvedRemplate;\r\n                });\r\n    },\r\n\r\n    //beta Iframe\r\n    isWebpartInIFrame: function () {\r\n        try {\r\n            return window.self !== window.top;\r\n        } catch (e) {\r\n            return true;\r\n        }\r\n    },\r\n    //pending implement\r\n    getFailServerErrorDeferred: function (a, b, c) { }\r\n});\r\n\r\n\r\n","/*\r\n *   Name: BizAgi Workportal Webpart Controller\r\n *   Author: Diego Parra\r\n *   Comments:\r\n *   -   This script will define a base class to all widgets\r\n */\r\n\r\n/* Asegura que el namespace este creado*/\r\nbizagi = (typeof (bizagi) !== \"undefined\") ? bizagi : {};\r\nbizagi.webpart = (typeof (bizagi.webpart) !== \"undefined\") ? bizagi.webpart : {};\r\nbizagi.webpart.subscribe = function (eventName, callback) {\r\n    $(document).bind(eventName, callback);\r\n};\r\nbizagi.webpart.publish = function (eventName, params) {\r\n    return $(document).triggerHandler(eventName, params);\r\n};\r\n\r\nbizagi.webpart.whenCreated = function (webpartName, callback) {\r\n    bizagi.webpart.subscribe(\"bizagi-webpart-created\", function (params) {\r\n        if (params.webpart.Class.fullname == \"bizagi.workportal.webparts.\" + webpartName) {\r\n            if (callback) callback(params);\r\n        }\r\n    });\r\n};\r\n\r\nbizagi.webpart.whenExecuted = function (webpartName, callback) {\r\n    bizagi.webpart.subscribe(\"bizagi-webpart-executed\", function (params) {\r\n        if (params.webpart.Class.fullname == \"bizagi.workportal.webparts.\" + webpartName) {\r\n            if (callback) callback(params);\r\n        }\r\n    });\r\n};\r\n\r\n\r\nbizagi.workportal.controllers.controller.extend(\"bizagi.workportal.webparts.webpart\", {\r\n    BIZAGI_WORKPORTAL_WEBPART_ROUTING: \"routing\",\r\n    BIZAGI_WORKPORTAL_WEBPART_RENDER: \"activityform\",\r\n    BIZAGI_WORKPORTAL_WEBPART_ASYNC: \"async\",\r\n    BIZAGI_WORKPORTAL_WEBPART_OLDRENDERINTEGRATION: \"oldrenderintegration\",\r\n}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        this._super(workportalFacade, dataService, params);\r\n\r\n        // Set helper\r\n        this.helper = new bizagi.workportal.webpart.helper(this);\r\n\r\n        this.canvas = params.canvas;\r\n\r\n        this.pane = params.pane;\r\n\r\n        // Set project\r\n        this.project = params.project;\r\n        this.sharepointProxyPrefix = params.sharepointProxyPrefix;\r\n\r\n        //homePortal Framework\r\n        this.homePortalFramework = this.workportalFacade.homePortalFramework;\r\n\r\n        // Set namespace\r\n        this.namespace = params.namespace;\r\n        // visible\r\n        this.isVisible = true;\r\n        this.isWebpartInIFrame = typeof (params.isWebpartInIFrame) != 'undefined' ? params.isWebpartInIFrame : self.helper.isWebpartInIFrame();\r\n        this.adjustButtonsToContent = params.adjustButtonsToContent;\r\n        this.remoteServer = params.remoteServer;\r\n\r\n        if (this.remoteServer) {\r\n\r\n            //postmessage object definition\r\n            self.postmessageSocket = new bizagi.postmessage({\r\n                remoteServer: this.remoteServer,\r\n                destination: window.parent,\r\n                origin: window\r\n            });\r\n            self.postmessageSocket.receive = function (msg) {\r\n                var params = msg.data;\r\n\r\n                // Auto-discard self messages\r\n                if (params.message) {\r\n                    if (params.message.iframeidentifier == BIZAGI_IFRAME_IDENTIFIER) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                if (params.event) {\r\n                    switch (params.event) {\r\n                        case \"postmessage-bizagi-canCloseIFramePopUp\":\r\n                            if (self.canHide && self.Class.shortName == params.message.webPartDestine) {\r\n                                $.when(self.canHide())\r\n                                    .done(function () {\r\n                                        var iframeclosemsg = {};\r\n                                        iframeclosemsg.event = \"postmessage-bizagi-closeIFramePopUp\";\r\n                                        iframeclosemsg.message = {};\r\n                                        iframeclosemsg.message.iframeidentifier = BIZAGI_IFRAME_IDENTIFIER;\r\n                                        self.postmessageSocket.send(iframeclosemsg);\r\n                                        var showCasesMSG = {\r\n                                            message: {}\r\n                                        };\r\n                                        showCasesMSG.event = \"ui-bizagi-reload-cases\";\r\n                                        self.postmessageSocket.send(showCasesMSG);\r\n                                    });\r\n                            }\r\n                            break;\r\n                        case \"postmessage-bizagi-openParentPopUp\":\r\n                            //Do nothing this message is for parent\r\n                            break;\r\n                        default:\r\n                            //re send message to other webparts\r\n                            self.publish(params.event, params.message, true);\r\n                            break;\r\n                    }\r\n                } else {\r\n                    //set iframe height and width\r\n\r\n                }\r\n            };\r\n            self.postmessageSocket.startReceiving();\r\n            self.sendDimensionsiFrame();\r\n        }\r\n    },\r\n    sendDimensionsiFrame: function (mandatorysend) {\r\n        var self = this;\r\n        //If webpart is put in iFrame resize the iframe with content height\r\n        //else if iframe show in popUp FixButtons, is desirable\r\n        //If namespace is defined this is a chil webpart\r\n        //delay wait for finish render\r\n        if (this.remoteServer) {\r\n            if (!!!self.adjustButtonsToContent && (!!!self.namespace || mandatorysend)) {\r\n                if (self.isWebpartInIFrame) {\r\n                    window.setTimeout(function () {\r\n\r\n                        var iframeDimentions = {\r\n                            message: {}\r\n                        };\r\n                        iframeDimentions.message.iframeName = BIZAGI_IFRAME_IDENTIFIER;\r\n                        iframeDimentions.message.iframeHeight = $('body').height();\r\n                        if (self.Class.shortName == \"newcaselist\") {\r\n                        } else {\r\n                            iframeDimentions.message.iframeWidth = undefined;\r\n                        }\r\n                        self.postmessageSocket.send(iframeDimentions);\r\n\r\n\r\n                    }, 50);\r\n                }\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     *   Publish an event so any controller can subscribe to it\r\n     */\r\n    publish: function (eventName, params, notFireToIframe) {\r\n        var self = this;\r\n        eventName = this.namespace ? this.namespace + \".\" + eventName : eventName;\r\n        //publish event to iframe\r\n        if (!!!notFireToIframe && eventName.indexOf(\"bizagi-webpart-created\") == -1 && eventName.indexOf(\"bizagi-webpart-executed\") == -1 && self.postmessageSocket) {\r\n            var msg = {};\r\n            msg.event = eventName;\r\n            //By iFrame messages it can not transmit the canvas object or object workportal\r\n            if (params) {\r\n                params.canvas = null;\r\n                params.workportal = null;\r\n            }\r\n            msg.message = {};\r\n            msg.message = $.extend(params, {\r\n                project: this.project,\r\n                iframeidentifier: BIZAGI_IFRAME_IDENTIFIER\r\n            });\r\n            self.postmessageSocket.send(msg);\r\n        }\r\n        //publish event localy in webparts\r\n        return this._super(eventName, $.extend(params, {\r\n            project: this.project\r\n        }));\r\n    },\r\n\r\n    /**\r\n     *   Subscribe to an event that any controller could trigger\r\n     */\r\n    subscribe: function (eventName, callback) {\r\n        var self = this;\r\n        eventName = this.namespace ? this.namespace + \".\" + eventName : eventName;\r\n        this._super(eventName, function (e, params) {\r\n            if (typeof params === 'undefined') params = {};\r\n            if (self.project == params.project && self.isVisible)\r\n                return callback(e, params);\r\n        });\r\n    },\r\n\r\n    /**\r\n     *   UnSubscribe to an event that any controller could trigger\r\n     */\r\n    unsubscribe: function (eventName, callback) {\r\n        var self = this;\r\n        eventName = this.namespace ? this.namespace + \".\" + eventName : eventName;\r\n        this._super(eventName, callback);\r\n    },\r\n\r\n    /*\r\n     *   Re-draw the webpart\r\n     */\r\n    refresh: function (params) {\r\n        var self = this;\r\n\r\n        var content;\r\n        // Clear content\r\n        if (self.canvas.data(\"role\") == \"view\") {\r\n            content = self.canvas.data(\"kendoMobileView\").contentElement();\r\n        } else {\r\n            content = self.canvas;\r\n        }\r\n        content.empty();\r\n        // Dispose stuff\r\n        //self.prepareForRefresh();\r\n\r\n        // Re-draw content;\r\n        return self.render(params).then(function (newContent) {\r\n            content.append(newContent);\r\n            self.canvas.triggerHandler(\"ondomincluded\");\r\n            return \"included\";\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Renders the web part\r\n     *   Also ensures that templates are loaded\r\n     */\r\n    render: function (params) {\r\n        var self = this;\r\n\r\n        // Set params in webpart variable\r\n        self.params = params;\r\n\r\n        if (params.creating) {\r\n            self.content = self.empty();\r\n\r\n            // Trigger webpart created event\r\n            self.publish(\"bizagi-webpart-created\", {\r\n                webpart: self\r\n            });\r\n\r\n            return self.content;\r\n        }\r\n\r\n        // Trigger webpart created event\r\n        self.publish(\"bizagi-webpart-created\", {\r\n            webpart: self\r\n        });\r\n\r\n        // Load templates\r\n        return $.when(self.renderContent(params))\r\n            .pipe(function (content) {\r\n                // Then customize in current device\r\n                // if you use kendoTmpl the object string is transformed to object html -jquery\r\n                if (typeof (content) == \"string\") {\r\n                    content = $(content);\r\n                }\r\n\r\n                self.content = content;\r\n                params.canvas.append(content);\r\n\r\n                return $.when(self.postRender(params)).then(function () {\r\n                    // Trigger webpart executed event\r\n                    self.publish(\"bizagi-webpart-executed\", {\r\n                        webpart: self\r\n                    });\r\n                    self.sendDimensionsiFrame();\r\n                    return self.getContent();\r\n                });\r\n            });\r\n    },\r\n\r\n    /*\r\n     *   Renders the web part, override this method in each webpart\r\n     */\r\n    renderContent: function (params) {},\r\n\r\n    /*\r\n     *   Customize the web part in each device\r\n     */\r\n    postRender: function (params) {},\r\n\r\n    /*\r\n     *   Return the rendered content\r\n     */\r\n    getContent: function () {\r\n        return this.content;\r\n    },\r\n\r\n    /*\r\n     *   Creates an empty content\r\n     */\r\n    empty: function () {\r\n        return $(\"<div/>\");\r\n    },\r\n\r\n    /*  \r\n     *   Return a specified template\r\n     */\r\n    getTemplate: function (template) {\r\n        return this.workportalFacade.getTemplate(template);\r\n    },\r\n\r\n    /*  \r\n     *   Create webpart\r\n     */\r\n    createWebpart: function (params) {\r\n        return this.workportalFacade.workportal.createWebpart(params);\r\n    },\r\n\r\n    /*  \r\n     *   Execute webpart\r\n     */\r\n    executeWebpart: function (params) {\r\n        return this.workportalFacade.workportal.executeWebpart(params);\r\n    },\r\n    /**\r\n     *   Manage the error in base class\r\n     */\r\n    manageError: function (msg, defer, canvasError) {\r\n        var self = this;\r\n        var errorMsg = '';\r\n        if (msg.responseText) {\r\n            errorMsg = msg.responseText;\r\n        } else {\r\n            errorMsg = msg;\r\n        }\r\n        if (errorMsg.indexOf(\"AUTHENTICATION_ERROR\") == -1) {\r\n            self.helper.getFailServerErrorDeferred({\r\n                message: errorMsg,\r\n                sharepointProxyPrefix: self.sharepointProxyPrefix\r\n            }, defer);\r\n            self.endWaiting();\r\n            //en caso de no tener un canvasError el error se despliega en todo el content\r\n            if (canvasError) {\r\n                defer.done(function (value) {\r\n                    canvasError.append(value);\r\n                    self.endWaiting();\r\n                });\r\n            }\r\n            //defer.resolve(msg);\r\n        } else {\r\n            //when it's generate autentication error, cannot load the template\r\n            var content = self.content = \"<div class='ui-bizagi-webpart-error-message'>The current user does not exist as a registered user in the bizagi project</div>\";\r\n            if (canvasError) {\r\n                canvasError.append(content);\r\n            }\r\n            self.endWaiting();\r\n            defer.resolve(content);\r\n        }\r\n    },\r\n\r\n    /**\r\n     *   Hide WebPart\r\n     */\r\n    hide: function (hideParent) {\r\n        var self = this;\r\n        self.canvas.hide();\r\n        if (hideParent) {\r\n            self.canvas.parent().hide();\r\n        }\r\n        self.isVisible = false;\r\n    },\r\n    /**\r\n     *    Show WebPart\r\n     */\r\n    show: function () {\r\n        var self = this;\r\n        self.canvas.show();\r\n        self.canvas.parent().show();\r\n        self.isVisible = true;\r\n    },\r\n    /**\r\n     *    visible flat\r\n     */\r\n    isVisible: function () {\r\n        var self = this;\r\n        return self.isVisible;\r\n    },\r\n\r\n    destroy: function () {\r\n\r\n    },\r\n\r\n    getHomeportalFrameworkIntance: function () {\r\n        if (!this.workportalFacade.homePortalFramework) {\r\n            this.workportalFacade.homePortalFramework = new bizagi.workportal.homeportalFramework(this.workportalFacade);\r\n        }\r\n        return this.workportalFacade.homePortalFramework;\r\n    }\r\n\r\n});","/**\r\n * Created by RicardoPD on 3/20/2015.\r\n */\r\n\r\nbizagi.workportal.webparts.webpart.extend(\"bizagi.workportal.webparts.rendermanager\", {},\r\n\r\n{\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, initialParams) {\r\n        var self = this;\r\n        // Call base\r\n        this._super(workportalFacade, dataService, initialParams);\r\n        if (!initialParams || typeof initialParams.navigator == 'undefined'){\r\n            console.error(\"it is a render webpart and there is no navigator to this webpart\");\r\n        }\r\n        self.navigator = initialParams.navigator;\r\n\r\n    }\r\n});\r\n","/*\r\n *   Name:\r\n *   Author: Luis Cabarique - LuisCE\r\n *   Comments:\r\n *   -   This script will define homePortal Framework\r\n */\r\nbizagi = (typeof (bizagi) !== \"undefined\") ? bizagi : {};\r\nbizagi.webparts = (typeof (bizagi.webparts) !== \"undefined\") ? bizagi.webparts : {};\r\n\r\n$.Class.extend(\"bizagi.workportal.homeportalFramework\", {}, {\r\n    /**\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade) {\r\n        var self = this;\r\n\r\n        // Set workportal facade\r\n        self.workportalFacade = workportalFacade;\r\n        self.device = bizagi.detectDevice();\r\n\r\n        self.accumulatedContext = [];\r\n        self.navigateFromRender = false;\r\n\r\n        self._homeportalShow();\r\n        self.configureHandler();\r\n\r\n        bizagi.util.mobility.homePortalNavigate = $.proxy(self.homePortalNavigate, self);\r\n        bizagi.util.mobility.homePortalViewShown = $.proxy(self.homePortalViewShown, self);\r\n        bizagi.util.mobility.homePortalViewInit = $.proxy(self.homePortalViewInit, self);\r\n        bizagi.util.mobility.homePortalViewHide = $.proxy(self.homePortalViewHide, self);\r\n        bizagi.util.mobility.drawerBeforeShow = $.proxy(self.drawerBeforeShow, self);\r\n    },\r\n    /**\r\n     * finds and executes child components based on the given layout\r\n     * @param component name of the component\r\n     * @param content jquery content container\r\n     * @returns {Array} promise of executing child components\r\n     */\r\n    loadComponents: function (component, content) {\r\n        var self = this;\r\n        var components = [];\r\n\r\n        $.each(self.homePortalLayout, function (wp, v) {\r\n            if (Array.isArray(v.position)) {\r\n                $.each(v.position, function (index, value) {\r\n                    if (value === component) {\r\n                        var $canvas = $(('#' + v.canvas[index]), content);\r\n                        var func = self.workportalFacade.executeWebpart({\r\n                            webpart: wp,\r\n                            canvas: $canvas,\r\n                            pane: $canvas.parent('div[data-role=\"pane\"]')\r\n                        });\r\n                        components.push(func);\r\n                    }\r\n                });\r\n            } else if (v.type !== \"drawer\" && v.position === component) {\r\n                var $canvas = $(('#' + v.canvas), content);\r\n                var func = self.workportalFacade.executeWebpart({\r\n                    webpart: wp,\r\n                    canvas: $canvas,\r\n                    pane: $canvas.parent('div[data-role=\"pane\"]')\r\n                });\r\n                components.push(func);\r\n            } else if (v.type === \"drawer\" && v.position === component) {\r\n                var $canvas = $((\"#\" + v.canvas), \"body\");\r\n                var func = self.workportalFacade.executeWebpart({\r\n                    webpart: wp,\r\n                    canvas: $canvas\r\n                });\r\n                components.push(func);\r\n            }\r\n        });\r\n\r\n        return $.when(components);\r\n    },\r\n    /**\r\n     * load requested template and fix the layout\r\n     * @param templateName name of the template\r\n     * @param component name of the component\r\n     * @param params aditional paramethers\r\n     * @returns {jquery} template object\r\n     */\r\n    loadComponentTemplate: function (templateName, component, params) {\r\n        var self = this;\r\n        var template = kendo.template(self.workportalFacade.getTemplate(templateName), {\r\n            useWithBlock: false\r\n        });\r\n        var components = [];\r\n        for (var wp in self.homePortalLayout) {\r\n            var wpLayout = self.homePortalLayout[wp];\r\n            if (Array.isArray(wpLayout.position)) {\r\n                $.each(wpLayout.position, function (index, value) {\r\n                    if (value === component) {\r\n                        components.push({\r\n                            canvas: self.homePortalLayout[wp].canvas[index]\r\n                        });\r\n                    }\r\n                });\r\n            } else if (wpLayout.type !== \"drawer\" && wpLayout.position === component) {\r\n                components.push(wpLayout);\r\n            }\r\n\r\n            if (wpLayout.type === \"drawer\" && wp === component) {\r\n                $.extend(params, {\r\n                    \"canvas\": wpLayout.canvas,\r\n                    \"direction\": wpLayout.direction\r\n                });\r\n            }\r\n        }\r\n\r\n        return template($.extend(params, {\r\n            \"homePortalLayoutPositions\": components\r\n        }));\r\n    },\r\n    /**\r\n     * Show the component\r\n     * @private\r\n     */\r\n    _homeportalShow: function () {\r\n        var self = this;\r\n\r\n        bizagi.webpart.subscribe(\"homeportalShow\", function (e, params) {\r\n            params.params = params.params || {};\r\n            var where = \"\";\r\n            var openDrawer = false;\r\n            var navigateFromRender = false;\r\n\r\n            var transition = \"\";\r\n            switch (params.what) {\r\n                case \"reportsChart\":\r\n                    where = \"reportsChart\";\r\n                    openDrawer = false;\r\n                    break;\r\n                case \"stuffTemplates\":\r\n                    where = \"renderTemplates\";\r\n                    if (params.params.data && params.params.data.navigateFromRender) {\r\n                        self.setContextFromRender(params);\r\n                        self.navigateFromRender = navigateFromRender = params.params.data.navigateFromRender;\r\n                    }\r\n                    break;\r\n                case \"favorites\":\r\n                case \"pendings\":\r\n                case \"ontime\":\r\n                case \"overdue\":\r\n                case \"risk\":\r\n                    where = \"caseTemplates\";\r\n                    break;\r\n                case \"startForm\":\r\n                    params.transition = \"overlay:up\";\r\n                    where = params.what;\r\n                    break;\r\n                case \"newCase\":\r\n                case \"menu\":\r\n                case \"render\":\r\n                    openDrawer = true;\r\n                    break;\r\n                case \"activitiesOptions\":\r\n                    params.what = \"caseTemplatesOptions\";\r\n                    openDrawer = true;\r\n                    break;\r\n                default:\r\n                    where = params.what;\r\n                    break;\r\n            }\r\n\r\n            if (!openDrawer) {\r\n                self.closeDrawers();\r\n                var canvas = self.homePortalLayout[where].canvas;\r\n                var element = $('#' + canvas);\r\n                if (element.css('display') === 'none' || element.selector === '#renderTemplates') {\r\n                    var parent = element.parent();\r\n                    var pane = parent.data('kendoMobilePane');\r\n                    if (!params.preventNavigate) {\r\n                        if (navigateFromRender) {\r\n                            self.navigateToRenderTemplates();\r\n                        } else {\r\n                            pane.navigate(canvas, params.transition || \"\");\r\n                        }\r\n                    }\r\n                    if (params.title) {\r\n                        $.each(pane.view().header, function (index, element) {\r\n                            var navbar = $(\".km-navbar\", element).data(\"kendoMobileNavBar\");\r\n                            navbar.title(params.title);\r\n                        });\r\n                    }\r\n                }\r\n            } else {\r\n                self.showDrawer(params.what);\r\n            }\r\n\r\n            bizagi.webpart.publish('homeportalShow-' + params.what, params.params);\r\n        });\r\n    },\r\n    /**\r\n     *\r\n     */\r\n    configureHandler: function () {\r\n        var self = this;\r\n\r\n        bizagi.webpart.subscribe(\"homeportalBack\", function (e, params) {\r\n            self._back();\r\n        });\r\n\r\n        bizagi.webpart.subscribe(\"homeportalShowNotification\", function (e, params) {\r\n            $.notifier.add({ text: params.message });\r\n        });\r\n    },\r\n    /**\r\n     *\r\n     * @param drawer\r\n     */\r\n    showDrawer: function (drawer) {\r\n        if (drawer === \"newCase\") {\r\n            $(\"#newCase-drawer\").data(\"kendoMobileDrawer\").show();\r\n        } else if (drawer === \"menu\") {\r\n        \t//reset the scrolling to avoid leaving content out of bounds ( ADO bug 13193 )\r\n        \t$(\"#menu-drawer\").data(\"kendoMobileDrawer\").scroller.reset();\r\n            $(\"#menu-drawer\").data(\"kendoMobileDrawer\").show();\r\n        } else if (drawer === \"caseTemplatesOptions\") {\r\n            $(\"#caseTemplatesOptions\").data(\"kendoMobileDrawer\").show();\r\n        } else {\r\n            if ($(\"#bz-render-drawer\").length > 0) {\r\n                $(\"#bz-render-drawer\").data(\"kendoMobileDrawer\").show();\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    _cleanContext: function () {\r\n        var self = this;\r\n\r\n        if (typeof (self.accumulatedContext) !== 'undefined') {\r\n            self.accumulatedContext = [];\r\n        }\r\n        self.navigateFromRender = false;\r\n    },\r\n    /**\r\n     * Get accumulated context for actions\r\n     * @returns {{}} Accumulates context for actions\r\n     */\r\n    getActionsContext: function () {\r\n        var self = this;\r\n        var actionsContext = {};\r\n        var accumulatedContext = self.accumulatedContext;\r\n\r\n        if (accumulatedContext.length > 0) {\r\n            actionsContext.context = $.map(accumulatedContext, function (el) {\r\n                var entityGuid = el.entityGuid ? el.entityGuid : el.guidEntityCurrent;\r\n                var resp = { entityGuid: entityGuid };\r\n\r\n                if (el.surrogateKeyToMapping !== null) {\r\n                    resp.surrogateKey = (typeof el.surrogateKeyToMapping === \"object\") ? el.surrogateKeyToMapping : [el.surrogateKeyToMapping];\r\n                } else {\r\n                    resp.surrogateKey = \"\";\r\n                }\r\n\r\n                return resp;\r\n            }).filter(function(el){\r\n                return el.surrogateKey !== \"\";\r\n            });\r\n\r\n        }\r\n        else {\r\n            actionsContext.context = [];\r\n        }\r\n\r\n        return actionsContext;\r\n    },\r\n    /**\r\n     * add context to accumulated context\r\n     * @param JSON context\r\n     * @returns {Array}\r\n     */\r\n    addContext: function (context) {\r\n        var self = this;\r\n\r\n        self.accumulatedContext.push(context);\r\n        return { \"context\": self.accumulatedContext };\r\n    },\r\n    /**\r\n     * Extends the properties of the last context\r\n     * @param params\r\n     */\r\n    extendCurrentContext: function (params) {\r\n        var self = this;\r\n        $.extend(self.accumulatedContext[self.accumulatedContext.length - 1], params);\r\n    },\r\n    /**\r\n     * Pops the last object in the context\r\n     * @param JSON context\r\n     * @returns {Array}\r\n     */\r\n    popContext: function () {\r\n        var self = this;\r\n\r\n        self.accumulatedContext.pop();\r\n        return { \"context\": self.accumulatedContext };\r\n    },\r\n    /**\r\n     *\r\n     * @param params\r\n     */\r\n    setContextFromRender: function (params) {\r\n        var self = this;\r\n\r\n        params = params.params || {};\r\n        //self._cleanContext();\r\n        self.addContext($.extend(params.data, { entityType: \"actionLauncher\" }));\r\n    },\r\n    /**\r\n     *\r\n     * @param context\r\n     */\r\n    homePortalViewInit: function (context) {\r\n        context.view.element.trigger(\"view-initialized\", context.view);\r\n    },\r\n    /**\r\n     *\r\n     * @param context\r\n     */\r\n    homePortalViewHide: function (context) {\r\n        context.view.element.trigger(\"view-hidden\", context.view);\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param context\r\n     */\r\n    homePortalViewShown: function (context) {\r\n        context.view.element.trigger(\"view-showed\", context.view);\r\n    }\r\n\r\n});\r\n","/*\r\n *   Name:\r\n *   Author: Luis Cabarique - LuisCE\r\n *   Comments:\r\n *   -   This script will define homePortal Framework\r\n */\r\nbizagi = (typeof (bizagi) !== \"undefined\") ? bizagi : {};\r\nbizagi.webparts = (typeof (bizagi.webparts) !== \"undefined\") ? bizagi.webparts : {};\r\n\r\n\r\nbizagi.workportal.homeportalFramework.extend(\"bizagi.workportal.homeportalFramework\", {}, {\r\n    /**\r\n     *   Constructor\r\n     */\r\n    init: function(workportalFacade) {\r\n        var self = this;\r\n        self._super(workportalFacade);\r\n        self.deviceType = \"tablet\";\r\n\r\n        self.homePortalLayout = {};\r\n\r\n        self.homePortalLayoutDashboard = {\r\n            \"menuHome\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"left\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"menuHome\",\r\n                \"title\": \"\",\r\n                \"layout\": \"menu-default\"\r\n            },\r\n            \"dashBoard\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"right\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"dashBoard\",\r\n                \"title\": \"\",\r\n                \"layout\": \"main-default\"\r\n            }\r\n        };\r\n\r\n        self.homePortalLayoutTaskFeed = {\r\n            \"taskFeed\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"left\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"taskFeed\",\r\n                \"title\": \"\",\r\n                \"layout\": \"side-default\"\r\n            },\r\n            \"summaryItem\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"right\",\r\n                \"canvas\": \"summaryItem\",\r\n                \"type\": \"view\",\r\n                \"title\": \"\",\r\n                \"layout\": \"main-default\"\r\n            }\r\n        };\r\n\r\n        self.homePortalLayoutComplement = {\r\n            \"reportsChart\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"right\",\r\n                \"canvas\": \"reportsChart\",\r\n                \"title\": \"Reports\",\r\n                \"layout\": \"main-default-close\"\r\n            },\r\n            \"loadForm\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"right\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"loadForm\",\r\n                \"title\": \"Search Form\",\r\n                \"layout\": \"main-default-close-action\"\r\n            },\r\n            \"renderTemplates\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"right\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"renderTemplates\",\r\n                \"title\": \"Render Template\",\r\n                \"layout\": \"main-double-header\"\r\n            },\r\n            \"caseTemplates\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"right\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"caseTemplates\",\r\n                \"title\": \"\",\r\n                \"layout\": \"main-double-header-cases\"\r\n            },\r\n            \"caseTemplatesOptions\": {\r\n                \"position\": \"homePortal\",\r\n                \"direction\": \"left\",\r\n                \"type\": \"view\",\r\n                \"canvas\": \"caseTemplatesOptions\",\r\n                \"title\": \"\",\r\n                \"layout\": \"side-default-back\"\r\n            },\r\n            \"stakeHolder\": {\r\n                \"position\": \"homePortal\",\r\n                \"canvas\": \"menuHome\"\r\n            },\r\n            \"shortCut\": {\r\n                \"position\": \"menuHome\",\r\n                \"canvas\": \"shortCut\"\r\n            },\r\n            \"searchesList\": {\r\n                \"position\": \"menuHome\",\r\n                \"canvas\": \"searchesList\"\r\n            },\r\n            \"stuff\": {\r\n                \"position\": [\"dashBoard\"],\r\n                \"canvas\": [\"stuff\"]\r\n            }\r\n        };\r\n\r\n        bizagi.util.mobility.leftPaneViewShown = $.proxy(self.leftPaneViewShown, self);\r\n    },\r\n\r\n    _back: function(direction) {\r\n        var self = this;\r\n\r\n        // Add conditions to direction\r\n        if (direction === \"left\") {\r\n            $(\"#left-pane\").data(\"kendoMobilePane\").navigate(\"#:back\");\r\n        } else {\r\n            $(\"#right-pane\").data(\"kendoMobilePane\").navigate(\"#:back\");\r\n        }\r\n    },\r\n\r\n    _backRenderTemplates: function(transition) {\r\n        var self = this;\r\n\r\n        if (self.accumulatedContext.length > 1) {\r\n            var context = self.accumulatedContext[self.accumulatedContext.length - 1];\r\n            var accumulatedContext = self.popContext().context;\r\n            if (context.navigateFromRender) {\r\n                bizagi.kendoMobileApplication.navigate(\"renderSplitView\");\r\n                self.navigateFromRender = false;\r\n            } else {\r\n                var data = accumulatedContext[accumulatedContext.length - 1];\r\n                var args = {\r\n                    data: data,\r\n                    calculateFilters: data.calculateFilters || false,\r\n                    filters: [],\r\n                    eventType: \"DATA-NAVIGATION\"\r\n                };\r\n\r\n                bizagi.webpart.publish(\"homeportalShow\", {\r\n                    \"what\": \"stuffTemplates\",\r\n                    \"title\": args.data.displayName,\r\n                    \"params\": args,\r\n                    \"preventNavigate\": true\r\n                });\r\n            }\r\n        } else {\r\n            if (self.navigateFromRender) {\r\n                bizagi.kendoMobileApplication.navigate(\"renderSplitView\");\r\n                self.navigateFromRender = false;\r\n            }\r\n        }\r\n\r\n        self._back(transition);\r\n    },\r\n\r\n    _collapseHomePortalPane: function() {\r\n        $(\"#homePortal\").data(\"kendoMobileSplitView\").collapsePanes();\r\n    },\r\n\r\n    configureHandler: function() {\r\n        var self = this;\r\n        self._super();\r\n    },\r\n\r\n    navigateToRenderTemplates: function(pane) {\r\n        $(\"#homePortal #right-pane\").data(\"kendoMobilePane\").navigate(\"renderTemplates\");\r\n        bizagi.kendoMobileApplication.navigate(\"homePortal\");\r\n    },\r\n\r\n    /**\r\n     * navigation control\r\n     * @param navParams\r\n     */\r\n    homePortalNavigate: function(navParams) {\r\n        var destination = navParams.url;\r\n        var canvas = navParams.sender.element;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param context\r\n     */\r\n    homePortalViewInit: function(context) {\r\n        var self = this;\r\n        self._super(context);\r\n        self.destination = context.view.id.replace(/#/i, \"\");\r\n        self.content = context.view.element;\r\n        self.container = context.view.container;\r\n\r\n        switch (self.destination) {\r\n        case \"summaryItem\":\r\n            $(self.content).on(\"click\", \".bz-header-open-leftPane\", function(event) {\r\n                self._openLeftPane();\r\n            });\r\n            $(self.content).on(\"click\", \".btn-back\", function(event) {\r\n                self._back();\r\n            });\r\n            $(self.content).on(\"click\", \"#bz-workarea-newcase\", function(event) {\r\n                self.showNewCase();\r\n            });\r\n            break;\r\n        case \"dashBoard\":\r\n            $(\".km-view-title\", self.content).children().text(\"DashBoard\");\r\n            $(self.content).on(\"click\", \".bz-header-open-leftPane\", function(event) {\r\n                self._openLeftPane();\r\n            });\r\n            $(self.content).on(\"click\", \".btn-back\", function(event) {\r\n                self._back();\r\n            });\r\n            $(self.content).on(\"click\", \"#bz-workarea-newcase\", function(event) {\r\n                self.showNewCase();\r\n            });\r\n            break;\r\n        case \"discussionCase\":\r\n            $(self.content).on(\"click\", \".btn-back\", function(event) {\r\n                self._back();\r\n            });\r\n            $(self.content).on(\"click\", \"#bz-workarea-newcase\", function(event) {\r\n                self.showNewCase();\r\n            });\r\n            break;\r\n        case \"menuHome\":\r\n            $(self.content).data(\"kendoMobileView\").header.on(\"click\", \".btn-menu\", function(event) {\r\n                self.showMenu();\r\n            });\r\n            break;\r\n        case \"taskFeed\":\r\n            $(self.content).on(\"click\", \".bz-header-left-btn.btn-open-drawer\", function(event) {\r\n                self.showMenu();\r\n            });\r\n            break;\r\n        case \"caseTemplatesOptions\":\r\n            $(self.content).on(\"click\", \".bz-header-left-btn.btn-back\", function(event) {\r\n                self._back(\"right\");\r\n                self._back(\"left\");\r\n            });\r\n            break;\r\n        case \"caseTemplates\":\r\n            $(self.content).on(\"click\", \".bz-header-open-leftPane\", function(event) {\r\n                self._openLeftPane();\r\n            });\r\n            $(self.content).on(\"click\", \"#bz-workarea-newcase\", function(event) {\r\n                self.showNewCase();\r\n            });\r\n            break;\r\n        case \"renderTemplates\":\r\n            $(self.content).on(\"click\", \".btn-back\", function(event) {\r\n                self._backRenderTemplates();\r\n            });\r\n            $(self.content).on(\"click\", \"#bz-workarea-newdata\", function(event) {\r\n                bizagi.webpart.publish(\"newData\");\r\n            });\r\n            $(self.content).on(\"click\", \".bz-header-open-leftPane\", function(event) {\r\n                self._openLeftPane();\r\n            });\r\n            break;\r\n        case \"reportsChart\":\r\n            $(self.content).on(\"click\", \".btn-close\", function(event) {\r\n                $(\"iframe\", \".bz-wp-reports-chart\").remove();\r\n                $(\".bz-wp-reports-chart\", self.content).empty();\r\n\r\n                $(\"#left-pane\", self.conten).toggle();\r\n                $(\".km-view-title\", self.content).children().text(\"\");\r\n                self._back();\r\n            });\r\n            break;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * when view is shown\r\n     * @param navParams\r\n     */\r\n    homePortalViewShown: function(navParams) {\r\n        var self = this;\r\n        var navLength;\r\n\r\n        self.destination = navParams.view.id.replace(/#/i, \"\");\r\n        self.content = navParams.view.element;\r\n        self.container = navParams.view.container;\r\n\r\n        if (self.destination === \"renderTemplates\") {\r\n            $(\".km-view-title\", self.content).children().text(\"DashBoard\");\r\n        } else {\r\n            if (self.destination === \"caseTemplates\") {\r\n                //fix navigation bug\r\n                navLength = navParams.sender.history.length;\r\n                if (navParams.sender.history[navLength - 1] === navParams.sender.history[navLength - 3]) {\r\n                    navParams.sender.history.pop();\r\n                    navParams.sender.history.pop();\r\n                }\r\n\r\n                $(\"#left-pane\").getKendoMobilePane().navigate(\"caseTemplatesOptions\");\r\n            } else if (self.destination === \"reportsChart\") {\r\n                navLength = navParams.sender.history.length;\r\n                if (navParams.sender.history[navLength - 1] === navParams.sender.history[navLength - 3]) {\r\n                    navParams.sender.history.pop();\r\n                }\r\n\r\n                $(\".km-view-title\", self.content).children().text(\"\");\r\n\r\n                $(\".btn-close\", self.content).unbind(\"click\").bind(\"click\", function() {\r\n                    $(\"iframe\", \".bz-wp-reports-chart\").remove();\r\n                    $(\".bz-wp-reports-chart\", self.content).empty();\r\n\r\n                    $(\".km-view-title\", self.content).children().text(\"\");\r\n                    self._back();\r\n                });\r\n\r\n                // Ocultar pane left\r\n                $(\"#left-pane\", self.conten).toggle();\r\n            }\r\n        }\r\n    },\r\n\r\n    leftPaneViewShown: function(navParams) {\r\n        var self = this;\r\n\r\n        self.leftDestination = navParams.view.id.replace(/#/i, \"\");\r\n        self.leftContent = navParams.view.element;\r\n    },\r\n\r\n    _openLeftPane: function() {\r\n        var self = this;\r\n\r\n        var view = bizagi.kendoMobileApplication.view();\r\n        view.expandPanes();\r\n    },\r\n\r\n    homePortalLayoutInit: function(context) {\r\n    },\r\n\r\n    closeDrawers: function() {\r\n        $(\"#menu-drawer\").data(\"kendoMobileDrawer\").hide();\r\n        $(\"#newCase-drawer\").data(\"kendoMobileDrawer\").hide();\r\n    },\r\n\r\n    showNewCase: function() {\r\n        this.showDrawer(\"newCase\");\r\n    },\r\n    showMenu: function() {\r\n        this.showDrawer(\"menu\");\r\n    }\r\n});\r\n","/*\r\n *   Name:\r\n *   Author: RicharU <Richar.Urbano@Bizagi.com>\r\n *   Comments:\r\n *   -   This script will define homePortal Framework\r\n */\r\nbizagi = (typeof (bizagi) !== \"undefined\") ? bizagi : {};\r\nbizagi.webparts = (typeof (bizagi.webparts) !== \"undefined\") ? bizagi.webparts : {};\r\n\r\n\r\nbizagi.workportal.homeportalFramework.extend(\"bizagi.workportal.homeportalFramework\", {}, {\r\n\r\n    _backRenderTemplates: function(transition) {\r\n        var self = this;\r\n\r\n        if (self.accumulatedContext.length > 1) {\r\n            var context = self.accumulatedContext[self.accumulatedContext.length - 1];\r\n\r\n            if (context.navigateFromRender) {\r\n                bizagiapp.openRenderElement();\r\n            } else {\r\n                var accumulatedContext = self.popContext().context;\r\n                var position = accumulatedContext.length - 1;\r\n                var data = accumulatedContext[position];\r\n                var args = {\r\n                    data: data,\r\n                    calculateFilters: data.calculateFilters || false,\r\n                    filters: [],\r\n                    eventType: \"DATA-NAVIGATION\"\r\n                };\r\n\r\n                bizagi.webpart.publish(\"homeportalShow\", {\r\n                    \"what\": \"stuffTemplates\",\r\n                    \"title\": args.data.displayName,\r\n                    \"params\": args,\r\n                    \"preventNavigate\": true\r\n                });\r\n            }\r\n        } else {\r\n            if (self.navigateFromRender) {\r\n                bizagiapp.openRenderElement();\r\n            }\r\n        }\r\n\r\n        self._back(transition);\r\n    },\r\n\r\n    showNewCase: function() {\r\n        if (bizagi.util.isAndroidDevice()) {\r\n            bizagiapp.showNewCase();\r\n        } else {\r\n            this._super();\r\n        }\r\n    },\r\n\r\n    showMenu: function() {\r\n        if (bizagi.util.isAndroidDevice()) {\r\n            bizagiapp.showMainMenu();\r\n        } else {\r\n            this._super();\r\n        }\r\n    }\r\n\r\n});\r\n","/*\r\n*   Name: BizAgi Reporting Definition JSON\r\n*   Author: David Romero\r\n*   Comments:\r\n*   -   This script defines global components for reports\r\n*/\r\n\r\nif (!bizagi.reporting) {\r\n    bizagi.reporting = { };\r\n}\r\n\r\nbizagi.reporting = {\r\n    BAMProcess: {\r\n        defaultReport: \"bamprocessloadanalysis\",\r\n        info: {\r\n            reportSet: 1\r\n        },\r\n        reports: {\r\n            \"bamprocessloadanalysis\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\"],\r\n                resource: \"bz-rp-loadanalysis-tab\"\r\n            },\r\n            \"bamprocessworkinprogress\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\"],\r\n                resource: \"bz-rp-workinprogress-tab\"\r\n            }\r\n        }\r\n    },\r\n    BAMTask: {\r\n        defaultReport: \"bamtasksworkinprogress\",\r\n        info: {\r\n            reportSet: 2\r\n        },\r\n        reports: {\r\n            \"bamtasksworkinprogress\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\"],\r\n                resource: \"bz-rp-workinprogress-tab\"\r\n            },\r\n            \"bamtaskloadanalysis\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\"],\r\n                resource: \"bz-rp-loadanalysis-tab\"\r\n            }\r\n        }\r\n    },\r\n    AnalyticsProcess: {\r\n        defaultReport: \"analyticsprocesscycletime\",\r\n        info: {\r\n            reportSet: 3\r\n        },\r\n        reports: {\r\n            \"analyticsprocesscycletime\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-cycletime-tab\"\r\n            },\r\n            \"analyticsprocessdurationhistogram\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-durationhistogram-tab\"\r\n            },\r\n            \"analyticsprocessactivity\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-processactivity-tab\"\r\n            },\r\n            \"analyticsprocessactivationranking\": {\r\n                components: [\"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-activationranking-tab\"\r\n            },\r\n            \"analyticsprocessfrequentspaths\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-frequentspaths-tab\"\r\n            }\r\n        }\r\n    },\r\n    AnalyticsTask: {\r\n        defaultReport: \"analyticstaskcycletime\",\r\n        info: {\r\n            reportSet: 4\r\n        },\r\n        reports: {\r\n            \"analyticstaskcycletime\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-cycletime-tab\"\r\n            }\r\n        }\r\n    },\r\n    ResourceBAM: {\r\n        callBack: \"myTeamCallBack\",\r\n        defaultReport: \"bamresourcemonitorworkinprogress\",\r\n        info: {\r\n            reportSet: 6\r\n        },\r\n        reports: {\r\n            \"bamresourcemonitorworkinprogress\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-workinprogress-tab\"\r\n            },\r\n            \"bamresourcemonitorworkinprogressuser\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-workinprogressuser-tab\"\r\n            },\r\n            \"bamresourcemonitorworkinprogressteam\": {\r\n                components: [\"filters-processversion\", \"filters-dimension\", \"filters-time\"],\r\n                resource: \"bz-rp-workinprogressteam-tab\"\r\n            }\r\n        }\r\n    },\r\n    AnalyticsSensor: {\r\n        defaultReport: \"sensors\",\r\n        reports: {\r\n            \"sensors\": {\r\n                components: [\"filters-dimension\", \"filters-time\"]\r\n            }\r\n        },\r\n        info: {\r\n            reportSet: 5\r\n        }\r\n    }\r\n};","/*\r\n*   Name: BizAgi Workportal Search Command\r\n*   Author: Richar Urbano - RicharU\r\n*   Comments:\r\n*   -   This script will define a common class to access the search capability\r\n*/\r\n\r\n$.Class(\"bizagi.workportal.command.search\", {\r\n    SEARCH_PAGE_SIZE: 30,\r\n    SEARCH_DELAY: 700\r\n}, {\r\n    init: function (dataService) {\r\n        var self = this;\r\n\r\n        self.isTabletDevice = bizagi.util.isTabletDevice();\r\n        self.enableOfflineForm = bizagi.util.hasOfflineFormsEnabled();\r\n\r\n        self.dataService = dataService;\r\n    },\r\n\r\n    searchList: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Offline type of tray\r\n        params.inputtray = bizagi.util.inputTray(self.dataService.online);\r\n\r\n        var referrerParams = {\r\n            radNumber: $.trim(params.query),\r\n            idWorkflow: \"\",\r\n            taskState: \"all\",\r\n            onlyFavorites: false,\r\n            order: \"\",\r\n            numberOfFields: 2,\r\n            orderFieldName: \"\",\r\n            orderType: \"0\",\r\n            page: params.page || 1,\r\n            pageSize: self.Class.SEARCH_PAGE_SIZE,\r\n            inputtray: params.inputtray ? params.inputtray : \"inbox\"\r\n        };\r\n\r\n        if (bizagi.util.isQuickSearchEnabled()) {\r\n            return self.loadDataListBeta(referrerParams);\r\n        } else {\r\n            return self.loadDataList(referrerParams);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Load data by server\r\n    */\r\n    loadDataList: function (params) {\r\n        var self = this;\r\n\r\n        return self.dataService.getCasesByWorkflow(params).done(function (data) {\r\n            data.elements = [];\r\n            var elements = [];\r\n\r\n            if (data.totalPages === 0) {\r\n                elements.push({ noResults: true, message: bizagi.localization.getResource(\"workportal-menu-search-found-no-cases\") });\r\n            }\r\n\r\n            for (var counter = 0, length = data.rows.length; length > counter; counter++) {\r\n\r\n                var tmpElement = data.rows[counter][\"fields\"];\r\n                var radNumber = data.rows[counter].radnumber || data.rows[counter].id;\r\n                var element = {};\r\n                var solutionDateElement = tmpElement[tmpElement.length - 1];\r\n                var resultElement = {};\r\n\r\n                element.radNumber = radNumber;\r\n\r\n                // Get solutionDate                \r\n                if (typeof (solutionDateElement.Value) != \"string\") {\r\n\r\n                    for (var i = 0, elementLength = solutionDateElement.Value.length; i < elementLength; i++) {\r\n                        var dateValue = solutionDateElement.Value[i];\r\n                        if (dateValue !== \"\" && typeof (dateValue) == \"string\") {\r\n                            resultElement.solutionDate = dateValue;\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    resultElement.solutionDate = solutionDateElement.Value;\r\n                }\r\n\r\n                // Get format solutionDate\r\n                resultElement.solutionDate = bizagi.util.getTaskStatus(resultElement.solutionDate);\r\n\r\n                // Get process name\r\n                for (var j = 0; j < tmpElement.length; j++) {\r\n                    if (tmpElement[j].DisplayName === \"Process\") {\r\n                        resultElement.processName = tmpElement[j].Value;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // If not process name found, get the first row\r\n                if (!resultElement.processName) {\r\n                    resultElement.processName = tmpElement[0].Value;\r\n                }\r\n\r\n                // Get workItems data and build result element\r\n                if (typeof (data.rows[counter].workitems) != \"undefined\") {\r\n\r\n                    var dataRowWorkItems = data.rows[counter].workitems;\r\n                    for (var counterCase = 0; dataRowWorkItems.length > counterCase; counterCase++) {\r\n                        element[0] = data.rows[counter][\"id\"];\r\n                        element[1] = dataRowWorkItems[counterCase][\"idWorkItem\"];\r\n                        element[2] = dataRowWorkItems[counterCase][\"idTask\"];\r\n                        element[\"state\"] = dataRowWorkItems[counterCase][\"State\"].toLowerCase() || \"gray\";\r\n                        element[5] = dataRowWorkItems[counterCase][\"TaskName\"] || bizagi.localization.getResource(\"webpart-cases-summary-without-name\");\r\n                        element[6] = [];\r\n                        element[6][0] = [];\r\n                        element[6][0] = [0, data.rows[counter][\"id\"]];\r\n\r\n                        element[4] = resultElement.processName;\r\n                        element[3] = resultElement.solutionDate;\r\n\r\n                        // OfflineForm\r\n                        if (data.rows[counter].isOfflineForm) {\r\n                            element[7] = data.rows[counter].isOfflineForm;\r\n                            element[8] = data.rows[counter].isOpen;\r\n                        }\r\n\r\n                        // Clone element to a new one, to avoid that final result stays with the last element repeated\r\n                        var newObject = $.extend(true, {}, element);\r\n                        elements.push(newObject);\r\n                    }\r\n                } else {\r\n\r\n                    element[0] = data.rows[counter][\"id\"];\r\n                    element[1] = element[2] = 0;\r\n                    element[5] = bizagi.localization.getResource(\"webpart-cases-summary-without-name\");\r\n                    element[\"state\"] = \"gray\";\r\n                    element[6] = [];\r\n                    element[6][0] = [];\r\n                    element[6][0] = [0, data.rows[counter][\"id\"]];\r\n                    element[4] = resultElement.processName;\r\n                    element[3] = resultElement.solutionDate;\r\n\r\n                    // OfflineForm\r\n                    if (data.rows[counter].isOfflineForm) {\r\n                        var grouped = bizagi.getGroupedData(tmpElement[3]);\r\n                        element[7] = data.rows[counter].isOfflineForm;\r\n                        element[8] = data.rows[counter].isOpen;\r\n                        element[\"state\"] = grouped.status;\r\n                    }\r\n\r\n                    elements.push(element);\r\n                }\r\n            }\r\n\r\n            data.elements = elements;\r\n\r\n            return data.elements;\r\n        }).fail(function (msg) {\r\n            var data = { \"elements\": [], \"page\": 1, \"totalPages\": 1 };\r\n\r\n            data.elements.push({ noResults: true, message: bizagi.localization.getResource(\"workportal-menu-search-found-no-cases\") });\r\n            return data.elements;\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Load data by server\r\n    */\r\n    loadDataListBeta: function (params) {\r\n        var self = this;\r\n\r\n        return self.dataService.getCasesListBeta(params)\r\n            .done(function (data) {\r\n                if (data.elements.length === 0) {\r\n                    data.elements.push({ noResults: true, message: bizagi.localization.getResource(\"workportal-menu-search-found-no-cases\") });\r\n                }\r\n                return data.elements;\r\n            }).fail(function (msg) {\r\n                var data = { \"elements\": [], \"page\": 1, \"totalPages\": 1 };\r\n                data.elements.push({ noResults: true, message: bizagi.localization.getResource(\"workportal-menu-search-found-no-cases\") });\r\n                return data.elements;\r\n            });\r\n    },\r\n\r\n    /**\r\n    *  Render the case\r\n    */\r\n    getCaseData: function (params) {\r\n        var dataItem = params.dataItem;\r\n        var data = {};\r\n\r\n        if (dataItem && typeof (dataItem.noResults) === \"undefined\") {\r\n            if (dataItem[1] !== -1 && dataItem[2] !== -1) {\r\n                data.idCase = dataItem[0];\r\n                data.idWorkitem = bizagi.util.isNumeric(dataItem[1]) ? dataItem[1] : 0;\r\n                data.idTask = bizagi.util.isNumeric(dataItem[2]) ? dataItem[2] : 0;\r\n                data.displayName = dataItem[5] || dataItem[6];\r\n                data.radNumber = dataItem[\"radNumber\"];\r\n                data.isOfflineForm = dataItem[7] === true || false;\r\n                data.formsRenderVersion = dataItem[7] === true ? 2 : 0;\r\n            } else {\r\n                data.idCase = dataItem[0];\r\n                data.displayName = dataItem[4] || dataItem[0];\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n});","/*\r\n *   Name: BizAgi Case Actions Events\r\n *   Author: Andres Arenas V\r\n *   Comments:\r\n *   -   \r\n */\r\n$.Class.extend(\"bizagi.actionsEvents\", {}, {\r\n    /**\r\n     * Init constructor\r\n     * @param dataService The dataService for making request\r\n     * @param parent\r\n     *  - \"Entities\": When it comes from RenderTemplates\r\n     *  - \"Cases\": When it comes from CasesTemplates\r\n     * @param params\r\n     *  - \"homePortalFramework\": Used to handle Data Navigation and AccumulatedContext\r\n     */\r\n    init: function (dataService, parent, params) {\r\n        var self = this;\r\n        self.initialParams = params || {};\r\n        self.parent = parent || \"Entities\";\r\n        self.dataService = dataService;\r\n    },\r\n    /**\r\n     * Get the events of an specific entity\r\n     * @param entities A list with all the entities\r\n     * @return The promise with the events of the entity\r\n     */\r\n    getEvents: function (entities) {\r\n        var self = this;\r\n        var promises = $.map(entities, function (entity) {\r\n            var idCase = entity.idCase;\r\n            if (typeof idCase !== \"undefined\" && idCase > 0) {\r\n                return self.dataService.getEvents({caseId: idCase}).then(function (data) {\r\n                    entity.events = data.map(function (el) {\r\n                        el.isEvent = true;\r\n                        return el;\r\n                    });\r\n                });\r\n            }\r\n        });\r\n\r\n        return $.when.apply($, promises);\r\n    },\r\n    /**\r\n     * Get all actions of an specific entity.\r\n     * @params entities A list with all the entities.\r\n     * @return The promise with the actions of the entity.\r\n     */\r\n    getActions: function (entities) {\r\n        var self = this;\r\n\r\n        var promises = $.map(entities, function (entity) {\r\n            // Se pone esta condicion dado que si viene desde CasesTemplates solo debe sacar las acciones cuyo surrogateKey de la\r\n            // entidad sea mayor o igual a 0.\r\n            if (self.parent === \"Entities\" || (self.parent === \"Cases\" && entity.surrogateKey >= 0)) {\r\n                var data = {\r\n                    surrogateKey: entity.surrogateKey,\r\n                    guidEntity: entity.guid\r\n                }\r\n                if (typeof entity.idCase !== \"undefined\") {\r\n                    data.caseId = entity.idCase;\r\n                }\r\n\r\n                //promesa para el llamado de acciones de cada elemento\r\n                return self.dataService.getActionsData(data).then(function (actions) {\r\n                    entity.actions = actions;\r\n                    //promesa encadenada para el llamado de has start form para todas las acciones de tipo proceso\r\n                    return $.when.apply($, $.map(actions, function (action) {\r\n                        if (action.type == \"Process\") {\r\n                            return self.dataService.validateHasStartForm({processId: action.reference}).then(function (resp) {\r\n                                action.hasStartForm = resp.startForm;\r\n                                action.entityId = resp.entityId;\r\n                                action.entityName = resp.entityName;\r\n                            });\r\n                        }\r\n                    }));\r\n                });\r\n            }\r\n        });\r\n\r\n        return $.when.apply($, promises);\r\n    },\r\n    /**\r\n     * Build a list with all the common actions of the selected item. A common action is an action that:\r\n     *  - Is in all selected items.\r\n     *  - Has multiplicity 2.\r\n     *  - Is a process without startform.\r\n     * @param selectedItems The selected items.\r\n     * @return A list with the common actions of the selected items.\r\n     */\r\n    getCommomActions: function (selectedItems) {\r\n        var self = this;\r\n        var items = selectedItems || [];\r\n        var tempActions = [];\r\n        var i = -1, a;\r\n\r\n        while (a = items[++i]) {\r\n            tempActions[i] = a.actions || [];\r\n        }\r\n\r\n        return tempActions.shift().reduce(function (res, v) {\r\n            var actionExist = tempActions.every(function (a) {\r\n                return typeof a.find(function (el) {\r\n                        return el.id == v.id;\r\n                    }) !== 'undefined';\r\n            });\r\n            if (actionExist && typeof res.find(function (el) {\r\n                    return el.id == v.id;\r\n                }) === 'undefined' && actionAgreesRules(v)) {\r\n                res.push(v);\r\n            }\r\n            return res;\r\n        }, []);\r\n\r\n        function actionAgreesRules(action) {\r\n            if (typeof action.mode === \"undefined\" || action.mode === \"Entity\") {\r\n                if (action.multiplicity == 2) {\r\n                    return true;\r\n                }\r\n                else if (action.type == \"Form\") {\r\n                    return false;\r\n                }\r\n                else if (action.type == \"Process\" && action.hasStartForm) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n    /**\r\n     * Build the necesary params to process the action based on the action type.\r\n     * @param action The action to execute.\r\n     * @param entity The parent entity.\r\n     */\r\n    executeActionSingleData: function(action, entity) {\r\n        var self = this;\r\n\r\n        if (action.type === \"WorkOnIt\") {\r\n            bizagi.loading.start();\r\n\r\n            var idCase = (typeof action.idCase !== \"undefined\") ? action.idCase : entity.idCase;\r\n            self.executeChangeCaseEvent(idCase, action.idTask, action.idWorkitem, entity);\r\n        } else if (typeof action.isEvent !== \"undefined\" && action.isEvent) {\r\n            self.processEvent(action);\r\n        } else {\r\n            var actionType = action.type;\r\n            var isMultiInstance = action.multiplicity === 2 ? true : false;\r\n\r\n            if (actionType === \"Rule\") {\r\n                var params = {\r\n                    actionType: actionType,\r\n                    entityId: entity.guid,\r\n                    isMultiInstance: isMultiInstance,\r\n                    processId: action.reference,\r\n                    surrogateKey: entity.surrogateKey,\r\n                    displayName: action.displayName\r\n                };\r\n\r\n                self.processAction(params).then(function(resp) {\r\n                    var keyResource = \"workportal-widget-templateengine-action-rule-notification-singular\";\r\n                    var message = printf(bizagi.localization.getResource(keyResource), params.displayName, 1);\r\n\r\n                    if (resp.result === \"success\") {\r\n                        var summary = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-success\");\r\n                        message = message + \" \" + printf(summary, \"\");\r\n                        $.notifier.add({ title: params.displayName, text: message, sticky: true });\r\n                    } else {\r\n                        var summary = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-error\");\r\n                        message = message + \" \" + summary;\r\n                        $.notifier.add({ title: params.displayName, text: message, sticky: true, class_name: \"error\" });\r\n                    }\r\n\r\n                    self.refreshTemplate();\r\n                });\r\n            } else if (actionType === \"Form\" || actionType === \"Process\") {\r\n                var params = {\r\n                    actionType: actionType,\r\n                    displayName: action.displayName,\r\n                    entityGuid: entity.guid,\r\n                    entitySurrogateKey: entity.surrogateKey,\r\n                    id: action.id,\r\n                    isMultiInstance: isMultiInstance,\r\n                    isBatch: action.isBatch || null,\r\n                    reference: action.reference,\r\n                    readonlyform: action.readonlyform,\r\n                    showConfirmation: action.showConfirmation\r\n                };\r\n\r\n                if (actionType === \"Process\") {\r\n                    params.entityId = action.entityId;\r\n                    params.entityName = action.entityName;\r\n                    params.hasStartForm = action.hasStartForm;\r\n                }\r\n                if (typeof entity.idCase !== \"undefined\") {\r\n                    params.caseId = entity.idCase;\r\n                }\r\n                self.processAction(params);\r\n            }\r\n        }\r\n    },\r\n\r\n    executeChangeCaseEvent: function (idCase, idTask, idWorkitem, entity) {\r\n        var self = this;\r\n        $.when(bizagi.webpart.publish(\"changeCase\", {\r\n            idCase: idCase,\r\n            idTask: idTask,\r\n            idWorkitem: idWorkitem\r\n        })).fail(function (error) {\r\n            self.showErrorMessage(entity.idCase, error);\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Build the necesary params to process the action based on the action type and action multiplicity.\r\n     *  - When the multiplicity is 2 it should run one rule that contains all selected items.\r\n     *  - When the multiplicity is 1 it should create one case per selected item.\r\n     * @param action The action to execute.\r\n     * @param entity The parent entity.\r\n     * @param selectedItems The items that the action is going to execute.\r\n     */\r\n    executeActionMultipleData: function (action, entity, selectedItems) {\r\n        var self = this;\r\n        var isMultiInstance = action.multiplicity === 2 ? true : false;\r\n        var surrogatedKeys = selectedItems.map(function (el) {\r\n            return el.surrogateKey;\r\n        });\r\n\r\n        switch (action.type) {\r\n            case \"Process\":\r\n                var params = {\r\n                    actionType: action.type,\r\n                    displayName: action.displayName,\r\n                    entityGuid: entity.guid,\r\n                    entityId: action.entityId,\r\n                    entityName: action.entityName,\r\n                    id: action.id,\r\n                    isMultiInstance: isMultiInstance,\r\n                    reference: action.reference,\r\n                    hasStartForm: action.hasStartForm\r\n                };\r\n                if (self.parent === \"Cases\") {\r\n                    params.caseId = selectedItems.map(function (el) {\r\n                        return el.idCase;\r\n                    });\r\n                }\r\n                // When the multiplicity is 2 it should create one case that contains all selected items\r\n                if (isMultiInstance) {\r\n                    params.isBatch = false;\r\n                    params.entitySurrogateKey = surrogatedKeys;\r\n\r\n                    self.processAction(params);\r\n                }\r\n                // When the multiplicity is 1 it should create one case per selected item\r\n                else {\r\n                    params.isBatch = true;\r\n                    self.processBatchCreationAction(params, selectedItems);\r\n                }\r\n                break;\r\n\r\n            case \"Rule\":\r\n                var params = {\r\n                    actionType: action.type,\r\n                    entityId: entity.guid,\r\n                    isMultiInstance: isMultiInstance,\r\n                    processId: action.reference,\r\n                    displayName: action.displayName\r\n                }\r\n\r\n                // When the multiplicity is 2 it should run one rule that contains all selected items\r\n                if (isMultiInstance) {\r\n                    params.surrogatedKey = surrogatedKeys;\r\n                    self.processAction(params).then(function (resp) {\r\n\r\n                        var keyResource = \"workportal-widget-templateengine-action-rule-notification-singular\";\r\n\r\n                        var messageSummary = printf(bizagi.localization.getResource(keyResource), params.displayName, 1);\r\n                        var message = \"\";\r\n\r\n                        if (resp.result === \"success\") {\r\n                            message = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-success\");\r\n                            message = printf(message, 1);\r\n                        }\r\n                        else {\r\n                            message = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-error\");\r\n                        }\r\n                        $.notifier.add({title: message, text: messageSummary, sticky: true});\r\n\r\n\r\n                        self.refreshTemplate();\r\n                    });\r\n                }\r\n                // When the multiplicity is 1 it should run one rule per selected item\r\n                else {\r\n                    params.confirmation = false;\r\n\r\n                    var i = -1, a, promises = [];\r\n                    while (a = selectedItems[++i]) {\r\n                        params.surrogateKey = a.surrogateKey;\r\n                        promises.push(self.processAction(params));\r\n                    }\r\n\r\n                    $.when.apply($, promises).then(function () {\r\n\r\n                        var dirty_message = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-notification-plural\");\r\n                        var message = printf(dirty_message, params.displayName, selectedItems.length);\r\n                        var success_summary = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-success\");\r\n                        message += printf(success_summary, \"\");\r\n\r\n                        $.notifier.add({title: params.displayName, text: message, sticky: true});\r\n\r\n                        self.refreshTemplate();\r\n                    }).fail(function () {\r\n\r\n                        var dirty_message = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-notification-plural\");\r\n                        var message = printf(dirty_message, params.displayName, selectedItems.length);\r\n                        var success_summary = bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-error\");\r\n                        message += printf(success_summary, \"\");\r\n                        $.notifier.add({title: params.displayName, text: message, sticky: true, class_name: \"error\"});\r\n\r\n                    });\r\n                }\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Process the action type process in batch\r\n     *  - Process: Build the data and go to processAction.\r\n     *  - Form: Build the data, call the mapping and go to processAction.\r\n     * @param actionParams Contains the necesary data to process the action.\r\n     * @param selectedItems Contains the selected elements.\r\n     */\r\n    processBatchCreationAction: function (actionParams, selectedItems) {\r\n        var self = this;\r\n        var i = -1, a;\r\n        a = selectedItems[++i];\r\n\r\n        // This is the way to send requests in series not in parallel\r\n        function process() {\r\n            $.when(self.processAction(actionParams)).always(function () {\r\n                a = selectedItems[++i];\r\n                if (typeof a !== \"undefined\") {\r\n                    actionParams.itemSelected = a;\r\n                    process(actionParams);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (typeof a !== \"undefined\") {\r\n            actionParams.itemSelected = a;\r\n            process(actionParams);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Process the action base on the type\r\n     *  - Process: Build the data and go to processAction.\r\n     *  - Form: Build the data, call the mapping and go to processAction.\r\n     * @param action Contains the necesary data to process the action.\r\n     */\r\n    processAddAction: function (action) {\r\n        var self = this;\r\n        var params = {\r\n            actionType: action.type,\r\n            addAction: true,\r\n            displayName: action.displayName,\r\n            entityGuid: action.guidEntity,\r\n            entitySurrogateKey: null,\r\n            reference: action.reference\r\n        };\r\n\r\n        if (action.type === \"Process\") {\r\n            params.entityId = action.guidEntity;\r\n            params.entityName = action.xpathContext;\r\n            params.hasStartForm = action.startForm;\r\n\r\n            self.processAction(params);\r\n        }\r\n        else if (action.type === \"Form\") {\r\n            var actionParam = {\r\n                xpathContext: \"\",\r\n                guidEntity: action.guidEntity,\r\n                accumulatedContext: JSON.stringify(self.initialParams.homePortalFramework.getActionsContext())\r\n            };\r\n            $.when(self.dataService.getMapping(actionParam)).then(function (mapping) {\r\n                params.mapping = mapping;\r\n\r\n                self.processAction(params);\r\n            }).fail(function (error) {\r\n                self.showErrorMessage(action.displayName, error);\r\n            });\r\n        }\r\n    },\r\n    /**\r\n     * Process the action based on the Type.\r\n     *  - Process: Call the mapping and create a new case.\r\n     *  - Form: Load the startform based on params.\r\n     *  - Rule: Show confirmation dialog and if user agrees execute rule depending if it is multinstance or not.\r\n     * @param params Contains the necesary data to process the action.\r\n     */\r\n    processAction: function (params) {\r\n        var self = this;\r\n        var origin = (self.parent === \"Entities\") ? \"stuffTemplates\" : \"caseTemplates\";\r\n        params.confirmation = typeof params.confirmation !== \"undefined\" ? params.confirmation : true;\r\n        var defer = new $.Deferred();\r\n\r\n        switch (params.actionType) {\r\n            case \"Process\":\r\n                var actionParams = {xpathContext: params.entityName, guidEntity: params.entityId};\r\n\r\n                //Updates the las element in the context\r\n                var entitySurrogateKey = (typeof params.itemSelected !== \"undefined\") ? params.itemSelected.surrogateKey : params.entitySurrogateKey;\r\n                self.initialParams.homePortalFramework.extendCurrentContext({surrogateKeyToMapping: entitySurrogateKey});\r\n                var accumulatedContext = self.initialParams.homePortalFramework.getActionsContext();\r\n\r\n                actionParams.accumulatedContext = JSON.stringify(accumulatedContext);\r\n                $.when(self.dataService.getMapping(actionParams)).done(function (mapping) {\r\n                    var createParams = {\r\n                        guidProcess: params.reference,\r\n                        hasStartForm: params.hasStartForm,\r\n                        isBatch: (typeof params.isBatch !== \"undefined\") ? params.isBatch : null,\r\n                        isMultiInstance: params.isMultiInstance,\r\n                        mapping: mapping,\r\n                        notification: true,\r\n                        displayName: params.displayName,\r\n                        type: params.actionType,\r\n                        origin: origin\r\n                    };\r\n                    if (typeof params.caseId !== \"undefined\") {\r\n                        createParams.idParentCase = params.caseId;\r\n                    }\r\n                    $.when(bizagi.webpart.publish(\"createNewCase\", createParams)).then(function () {\r\n                        defer.resolve(createParams);\r\n                    }).fail(function () {\r\n                        defer.reject();\r\n                    });\r\n\r\n\r\n                }).fail(function (error) {\r\n                    self.showErrorMessage(params.displayName, error);\r\n                    defer.reject();\r\n                });\r\n                break;\r\n\r\n            case \"Form\":\r\n                bizagi.webpart.publish(\"render-start-form\", {\r\n                    params: {\r\n                        displayName: params.displayName,\r\n                        entityGuid: params.entityGuid,\r\n                        entitySurrogateKey: params.entitySurrogateKey,\r\n                        formGuid: params.reference,\r\n                        mapping: (typeof params.mapping !== \"undefined\") ? params.mapping : null,\r\n                        type: params.actionType,\r\n                        origin: origin,\r\n                        readonlyform: params.readonlyform,\r\n                        showConfirmation: params.showConfirmation\r\n                    }\r\n                });\r\n\r\n                defer.resolve();\r\n                break;\r\n            case \"Rule\":\r\n                if (params.confirmation) {\r\n                    bizagi.showConfirmationBox(\r\n                        bizagi.localization.getResource(\"workportal-widget-templateengine-action-rule-confirmation\"),\r\n                        \"Bizagi\",\r\n                        true,\r\n                        [{label: \"Ok\", action: \"resolve\"}, {label: \"Cancel\", action: \"reject\"}])\r\n                        .done(function () {\r\n                            self.executeRuleAction(params).then(function (resp) {\r\n                                defer.resolve(resp);\r\n                            }).fail(function (error) {\r\n                                defer.reject(error);\r\n                            });\r\n                        });\r\n                } else {\r\n                    self.executeRuleAction(params).then(function (resp) {\r\n                        defer.resolve(resp);\r\n                    }).fail(function (error) {\r\n                        defer.reject(error);\r\n                    });\r\n                }\r\n                break;\r\n\r\n            default:\r\n                defer.resolve();\r\n                break;\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n    /**\r\n     * Show an error message based on the code status response from server.\r\n     * @param title The title of the message to show.\r\n     * @param error The server error response.\r\n     */\r\n    showErrorMessage: function (title, error) {\r\n        //TODO capturar el codigo del error {404, 500, etc} y mandar el mensaje acorde al error\r\n        var message = bizagi.localization.getResource(\"workportal-widget-sortbar-execute-error-message\").replace(\"%s\", title);\r\n        $.notifier.add({\r\n            title: \"Error\",\r\n            text: message,\r\n            class_name: \"error\",\r\n            sticky: false\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Ejecuta una unica accion de tipo Regla\r\n     * @param params\r\n     * return promise*\r\n     */\r\n    executeRuleAction: function (params) {\r\n        var self = this;\r\n        var promiseData = (params.isMultiInstance) ? self.dataService.executeAction : self.dataService.actionRule;\r\n        return $.when(promiseData.apply(self.dataService, [params]));\r\n    },\r\n\r\n    /**\r\n     * Reload the template\r\n     */\r\n    refreshTemplate: function () {\r\n        var self = this;\r\n        var context = self.initialParams.homePortalFramework.accumulatedContext;\r\n        var args = {\r\n            calculateFilters: true,\r\n            data: context.length > 0 ? context[context.length - 1] : self.accumulatedContext,\r\n            filters: [],\r\n            eventType: \"DATA-NAVIGATION\"\r\n        };\r\n\r\n        bizagi.webpart.publish(\"homeportalShow\", {\r\n            \"what\": \"stuffTemplates\",\r\n            \"title\": args && args.data ? args.data.displayName : \"\",\r\n            \"params\": args,\r\n            \"preventNavigate\": true\r\n        });\r\n        //TODO dejar unicamente el homeportalShow con el refresh cuando se soporte la actualizaci�n de un solo resgitro\r\n        //self.publish(\"homeportalShow\", {\"what\": origin, params : {refresh:true, surrogateKey: self._renderParams.h_surrogateKey, idCase: bizagi.context.idCase}});\r\n    },\r\n\r\n    /**\r\n     * Perform the process action and send it throught \"executeRoutingAction\"\r\n     * @param params\r\n     */\r\n    processEvent: function (eventParams) {\r\n        bizagi.webpart.publish(\"executeRoutingAction\", {\r\n            idCase: eventParams.idCase,\r\n            idWorkItem: eventParams.idWorkitem,\r\n            idTask: eventParams.idTask,\r\n            idWorkflow: eventParams.idWorkflow,\r\n            isEvent: true\r\n        });\r\n    }\r\n});","/*\r\n *   Name: Bizagi Case Actions Events\r\n *   Author: Andres Arenas V\r\n *   Comments:\r\n *   -   \r\n */\r\nbizagi.actionsEvents.extend(\"bizagi.actionsEvents\", {\r\n    /**\r\n     * Init constructor\r\n     * @param dataService The dataService for making request\r\n     * @param parent\r\n     *  - \"Entities\": When it comes from RenderTemplates\r\n     *  - \"Cases\": When it comes from CasesTemplates\r\n     * @param params\r\n     *  - \"homePortalFramework\": Used to handle Data Navigation and AccumulatedContext\r\n     */\r\n    init: function(dataService, parent, params) {        \r\n        // Call base\r\n        this._super(dataService, parent, params);\r\n    },\r\n    /**\r\n     * Build the necesary params to process the action based on the action type.\r\n     * @param action The action to execute.\r\n     * @param entity The parent entity.\r\n     */\r\n    executeActionSingleData: function(action, entity) {\r\n        var self = this;\r\n\r\n        if (action.type === \"WorkOnIt\") {\r\n            var idCase = (typeof action.idCase !== \"undefined\") ? action.idCase : entity.idCase;\r\n            bizagiapp.openRenderElement({\r\n                \"idCase\": idCase,\r\n                \"radNumber\": entity.radNumber || (entity.data != null ? entity.data.Casenumber : idCase),\r\n                \"idTask\": action.idTask,\r\n                \"idWorkitem\": action.idWorkitem\r\n            });\r\n        } else if (typeof action.isEvent !== \"undefined\" && action.isEvent) {\r\n            self.processEvent(action);\r\n        } else {\r\n            var actionType = action.type;\r\n            var isMultiInstance = action.multiplicity === 2 ? true : false;\r\n\r\n            if (actionType === \"Rule\") {\r\n                var params = {\r\n                    actionType: actionType,\r\n                    entityId: entity.guid,\r\n                    isMultiInstance: isMultiInstance,\r\n                    processId: action.reference,\r\n                    surrogateKey: entity.surrogateKey\r\n                };\r\n\r\n                self.processAction(params).then(function() {\r\n                    self.refreshTemplate();\r\n                });\r\n            } else if (actionType === \"Form\" || actionType === \"Process\") {\r\n                var params = {\r\n                    actionType: actionType,\r\n                    displayName: action.displayName,\r\n                    entityGuid: entity.guid,\r\n                    entitySurrogateKey: entity.surrogateKey,\r\n                    id: action.id,\r\n                    isMultiInstance: isMultiInstance,\r\n                    isBatch: action.isBatch || null,\r\n                    reference: action.reference,\r\n                    readonlyform: action.readonlyform,\r\n                    showConfirmation: action.showConfirmation\r\n                };\r\n\r\n                if (actionType === \"Process\") {\r\n                    params.entityId = action.entityId;\r\n                    params.entityName = action.entityName;\r\n                    params.hasStartForm = action.hasStartForm;\r\n                }\r\n                if (typeof entity.idCase !== \"undefined\") {\r\n                    params.caseId = entity.idCase;\r\n                }\r\n                self.processAction(params);\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * Process the action based on the Type.\r\n     *  - Process: Call the mapping and create a new case.\r\n     *  - Form: Load the startform based on params.\r\n     *  - Rule: Show confirmation dialog and if user agrees execute rule depending if it is multinstance or not.\r\n     * @param params Contains the necesary data to process the action.\r\n     */\r\n    processAction: function(params) {\r\n        var self = this;\r\n        return $.when(this._super(params)).done(function(createParams) {\r\n            if (params.actionType === \"Process\") {\r\n                createParams.mapping = JSON.stringify(createParams.mapping);\r\n                bizagiapp.newCase(createParams);\r\n            } else if (params.actionType === \"Form\" && bizagi.util.isNativeHeaderEnabled()) {\r\n                var mapping = (typeof params.mapping !== \"undefined\") ? JSON.stringify(params.mapping) : \"\";\r\n                var origin = (self.parent === \"Entities\") ? \"stuffTemplates\" : \"caseTemplates\";\r\n\r\n                if (typeof(params.entitySurrogateKey) !== \"undefined\" && !bizagi.util.isEmpty(params.entitySurrogateKey)) {\r\n                    var readOnly = params.readonlyform || false;\r\n                    var showConfirmation = params.showConfirmation || false;\r\n\r\n                    bizagiapp.openEntity(params.displayName, params.entityGuid, params.entitySurrogateKey,\r\n                        params.reference, mapping, readOnly, showConfirmation, origin);\r\n                } else {\r\n                    bizagiapp.addEntityValue(params.displayName, params.entityGuid, params.reference, mapping, origin);\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    processEvent: function(eventParams) {\r\n        bizagiapp.openEvent(eventParams.idCase, eventParams.idWorkitem);\r\n    },\r\n\r\n    executeChangeCaseEvent: function(idCase, idTask, idWorkitem, entity) {\r\n        var params = {\r\n            \"idCase\": idCase,\r\n            \"idTask\": idTask,\r\n            \"idWorkitem\": idWorkitem\r\n        };\r\n\r\n        bizagiapp.openRenderElement(params);\r\n        bizagi.loading.stop();\r\n    }\r\n});","/*\r\n *   Name: BizAgi Case Users\r\n *   Author: Andres Arenas V\r\n *   Comments:\r\n *   -   \r\n */\r\n$.Class.extend(\"bizagi.caseUsers\", {}, {\r\n    /**\r\n     * Init constructor\r\n     * @param dataService The dataService for making request\r\n     * @param parent\r\n     *  - \"Entities\": When it comes from RenderTemplates\r\n     *  - \"Cases\": When it comes from CasesTemplates\r\n     * @param params Additional data\r\n     */\r\n    init: function (dataService, parent, params) {\r\n        var self = this;\r\n        self.initialParams = params || {};\r\n        self.parent = parent || \"Entities\";\r\n        self.dataService = dataService;\r\n        self.userDataPromise = {};\r\n    },\r\n    /**\r\n     * Get the users of an specific entity\r\n     * @param entities A list with all the entities\r\n     * @return The promise with the users of the entity\r\n     */\r\n    getUsers: function (entities) {\r\n        var self = this;\r\n        var users = [];\r\n\r\n        var promises = $.map(entities, function (entity) {\r\n            return self.dataService.getUsers({ caseId: entity.idCase}).done(function(data){\r\n                entity[\"assignees\"] = $.map(data.assignees, function(el){return $.extend(el, {initials: self._getInitials(el.name)})});\r\n                entity[\"createdBy\"] = $.extend(data.createdBy, {initials: self._getInitials(data.createdBy.name)});\r\n                //Obtiene instancias unicas del usuario para el caso\r\n                entity[\"users\"] = self._getUniqueUsers($.merge([entity.createdBy], entity.assignees));\r\n                entity[\"workOnIt\"] = self._canWorkOnIt(data.assignees);\r\n\r\n                //Se crea un array con los usuarios unicos para retornarlos\r\n                var i= -1, user;\r\n                while(user = entity.users[++i]){\r\n                    var exist = users.find(function(el){\r\n                        return user.idUser == el.idUser;\r\n                    });\r\n                    if (!exist){\r\n                        users.push(user);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        return $.when.apply($, promises).then(function (data) {\r\n            return users;\r\n        });\r\n    },\r\n    /**\r\n     * Extract initials from specified name\r\n     * @param name The name of the user\r\n     * @return The first letter of the name and the first letter of the last name\r\n     */\r\n    _getInitials: function(name){\r\n        var names = name.split(' ');\r\n        var firstInitial = (typeof(names[0]) !== 'undefined') ? names[0].charAt(0) : \"\";\r\n        var secondInitial = (typeof(names[1]) !== 'undefined') ? names[1].charAt(0) : \"\";\r\n\r\n        return firstInitial + secondInitial;\r\n    },\r\n    /**\r\n     * Remove the duplicated users from a list\r\n     * @param users A list with all the users of an entity\r\n     * @return A list with unique users\r\n     */\r\n    _getUniqueUsers: function(users){\r\n        var i= -1, user, uniqueUsers = [];\r\n\r\n        while(user = users[++i]){\r\n            var exist = uniqueUsers.find(function(el){\r\n                return user.idUser == el.idUser;\r\n            });\r\n            if (!exist){\r\n                uniqueUsers.push({\r\n                    idUser: user.idUser,\r\n                    name: user.name,\r\n                    initials: user.initials\r\n                });\r\n            }\r\n        }\r\n\r\n        if(uniqueUsers.length > 0){\r\n            uniqueUsers[0].isAssignee = true;\r\n        }\r\n\r\n        return uniqueUsers;\r\n    },\r\n    /**\r\n     * Determines if the current user can work on it case\r\n     * @param assignees\r\n     * @return {boolean}\r\n     */\r\n    _canWorkOnIt: function(assigneesUsers){\r\n        var user, i = -1, canWorkOnIt = false;\r\n\r\n        while(user = assigneesUsers[++i]){\r\n            if(user.idUser === bizagi.currentUser.idUser){\r\n                canWorkOnIt = true;\r\n                break;\r\n            }\r\n        }\r\n        return canWorkOnIt;\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Services Rendering End Points\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script defines all the end-points used to retrieve ajax stuff\r\n*   -   All urls must be relative to the base application\r\n*/\r\n\r\n// Create or define namespace\r\nbizagi.render = (typeof (bizagi.render) !== \"undefined\") ? bizagi.render : {};\r\nbizagi.render.services = (typeof (bizagi.render.services) !== \"undefined\") ? bizagi.render.services : {};\r\nbizagi.render.services.endPoints = [];\r\n\r\n// Creates a endpoint hash factory to resolve custom requirements\r\nbizagi.render.services.getEndPoints = function (params) {\r\n\r\n    var renderHandlerPathRest = \"Rest/Handlers/Render\";\r\n    var renderUploadHandlerPathRest = \"Rest/Handlers/Render/Upload\";\r\n    var renderFileHandlerPathRest = \"Rest/Handlers/RenderFile\";\r\n    var letterHandlerPathRest = \"Rest/Handlers/Letter\";\r\n    var multiActionHandlerPathRest = \"Rest/Handlers/MultiAction\";\r\n    var metadataHandlerPathRest = \"Rest/Handlers/Metadata\";\r\n    var metadataMultiactionHandlerPathRest = \"Rest/Handlers/MetadataMultiAction\";\r\n    // Default workportal end-points\r\n    if (params.context == \"workflow\") {\r\n        return {\r\n            \"form-get-data\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data-upload\": params.proxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-property-refresh\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-multiaction\": params.proxyPrefix + multiActionHandlerPathRest,\r\n            \"render-upload-cancel-image\": params.proxyPrefix + \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.proxyPrefix + renderFileHandlerPathRest,\r\n            \"render-upload-add-url\": params.proxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-upload-delete-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-ecm-upload-url\": params.proxyPrefix + metadataHandlerPathRest,\r\n            \"render-multiaction-metadata\": params.proxyPrefix + metadataMultiactionHandlerPathRest,\r\n            \"render-grid-edit-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-save-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-add-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-rollback-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-commit-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-checkpoint-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-save-entity\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-stakeholder-associated\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-search-default-image\": params.proxyPrefix + \"jquery/rendering/css/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.proxyPrefix + \"Rest/Handlers/Query\",\r\n            \"render-letter-notEditable-url\": params.proxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-content-url\": params.proxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-save-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-letter-content-icons\": params.proxyPrefix + \"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif\",\r\n            \"render-userfield-definition\": params.proxyPrefix + \"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}\",\r\n            \"render-document-generate\": params.proxyPrefix + \"Rest/DocumentTemplates/CaseTemplates\",\r\n            \"render-document-generateAllDocuments\": params.proxyPrefix + \"Rest/DocumentTemplates/TemplatesConcatFilesToPDF\",\r\n            \"render-processes-startform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-processes-getstartform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-entity-layout-image64\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Base64\",\r\n            \"render-entity-layout-imageByteArray\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}\" + \"&xsrf=\" + bizagi.getXSRFToken(),\r\n            \"render-entity-layout-upload-files\": params.proxyPrefix + \"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}\",\r\n            \"case-handler-getCaseSummary\": params.proxyPrefix + \"Rest/Cases/{idCase}/SummaryGuid\",\r\n            \"case-handler-getCaseSummaryByGuid\": params.proxyPrefix + \"Rest/Cases/{guid}/SummaryByGuid\",\r\n            \"case-handler-getCaseAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/AssigneesGuid\",\r\n            \"case-handler-getWorkItems\": params.proxyPrefix + \"Rest/Cases/{idCase}/WorkItems\",\r\n            \"case-handler-getWorkItemsByGuid\": params.proxyPrefix + \"Rest/Cases/{guid}/WorkItemsByGuid\",\r\n            \"admin-getUsersList\": params.proxyPrefix + \"Rest/Users/SearchUsers\",\r\n            \"admin-getUsersList-FromPreferences\": params.proxyPrefix + \"Rest/Users/SearchUsersFromPreferences\",\r\n            \"admin-getUsersList-ForStakeholders\": params.proxyPrefix + \"Rest/Users/SearchUsersForStakeholders\",\r\n            \"admin-getUsersForAssignation\": params.proxyPrefix + \"Rest/Users/UsersForAssignation\",\r\n            \"admin-users-config\": params.proxyPrefix + \"Api/Authentication/BizagiConfig\",\r\n            //users administration\r\n            \"admin-usersform\": params.proxyPrefix + \"Rest/Handlers/Render\",\r\n            \"admin-GenerateDataToSendByEmail\": params.proxyPrefix + \"Rest/Users/GenerateDataToSendByEmail\",\r\n            \"admin-sendUserEmail\": params.proxyPrefix + \"Rest/Users/SendUserEmail\"\r\n        };\r\n    }\r\n    // Sharepoint end-points (must be customized for each project)\r\n    if (params.context == \"sharepoint\" || params.context == \"portal\") {\r\n        if (typeof (params.sharepointProxyPrefix) === \"undefined\") alert(\"sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'\");\r\n        return {\r\n            \"form-get-data\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data-upload\": params.sharepointProxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-property-refresh\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-multiaction\": params.sharepointProxyPrefix + multiActionHandlerPathRest,\r\n            \"render-upload-cancel-image\": \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.sharepointProxyPrefix + renderFileHandlerPathRest,\r\n            \"render-upload-add-url\": params.sharepointProxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-upload-delete-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-ecm-upload-url\": params.sharepointProxyPrefix + metadataHandlerPathRest,\r\n            \"render-grid-edit-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-save-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-add-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-rollback-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-commit-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-checkpoint-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-save-entity\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-stakeholder-associated\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-search-default-image\": \"jquery/css/bizagi/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.sharepointProxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.sharepointProxyPrefix + \"Rest/Handlers/Query\",\r\n            \"render-letter-notEditable-url\": params.sharepointProxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-content-url\": params.sharepointProxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-save-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-letter-content-icons\": \"jquery/css/plugins/other/images/nicEditorIcons.gif\",\r\n            \"render-userfield-definition\": params.sharepointProxyPrefix + \"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}\",\r\n            \"render-document-generate\": params.sharepointProxyPrefix + \"Rest/DocumentTemplates/CaseTemplates\",\r\n            \"render-document-generateAllDocuments\": params.sharepointProxyPrefix + \"Rest/DocumentTemplates/TemplatesConcatFilesToPDF\",\r\n            \"render-processes-startform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-processes-getstartform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-entity-layout-image64\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Base64\",\r\n            \"render-entity-layout-imageByteArray\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}\" + \"&xsrf=\" + bizagi.getXSRFToken(),\r\n            \"case-handler-getCaseSummary\": params.sharepointProxyPrefix + \"Rest/Cases/{idCase}/Summary\",\r\n            \"case-handler-getCaseSummaryByGuid\": params.sharepointProxyPrefix + \"Rest/Cases/{guid}/SummaryByGuid\",\r\n            \"case-handler-getWorkItems\": params.sharepointProxyPrefix + \"Rest/Cases/{idCase}/WorkItems\",\r\n            \"case-handler-getWorkItemsByGuid\": params.proxyPrefix + \"Rest/Cases/{guid}/WorkItemsByGuid\"\r\n        };\r\n    }\r\n\r\n    if (params.context == \"entitymanagement\") {\r\n        return {\r\n            \"form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"form-submit-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"form-submit-data-upload\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-property-refresh\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-upload-cancel-image\": \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.proxyPrefix + renderFileHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-upload-add-url\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-upload-delete-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-edit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-add-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-rollback-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-commit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-checkpoint-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-search-default-image\": \"jquery/rendering/css/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.proxyPrefix + \"Rest/Handlers/Query\" + \"?h_contexttype=entity\",\r\n            \"render-letter-notEditable-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-letter-content-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-letter-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-letter-content-icons\": \"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif\"\r\n        };\r\n    }\r\n\r\n    if (params.context == \"search\") {\r\n        return {\r\n            \"form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"form-submit-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"form-submit-data-upload\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-property-refresh\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-upload-cancel-image\": \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.proxyPrefix + renderFileHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-upload-add-url\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-upload-delete-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-edit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-add-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-rollback-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-commit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-checkpoint-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-default-image\": \"jquery/rendering/css/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.proxyPrefix + \"Rest/Handlers/Query\" + \"?h_contexttype=metadata\",\r\n            \"render-letter-notEditable-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-letter-content-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-letter-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-letter-content-icons\": \"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif\"\r\n        };\r\n    }\r\n\r\n    return {};\r\n};\r\n","/*\r\n*   Name: BizAgi Rendering Service Context Factory\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script will define the endpoints to be used based on the given context\r\n*/\r\n\r\n$.Class.extend(\"bizagi.render.services.context\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (params) {\r\n        this.context = params.context;\r\n        this.endPoints = bizagi.render.services.getEndPoints(params);\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n    },\r\n\r\n    /*\r\n    *   Returns the given url for a specified service\r\n    */\r\n    getUrl: function (service) {\r\n        if (this.endPoints[service] == null) {\r\n            alert(\"No endpoint defined for: \" + service);\r\n        }\r\n        return this.endPoints[service];\r\n    },\r\n\r\n    setProxyPrefix: function(params){\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n        this.endPoints = bizagi.render.services.getEndPoints(params);\r\n    }\r\n});","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra\r\n *   Comments:\r\n *   -   This class will provide a facade to access to rendering REST services\r\n */\r\n\r\n$.Class.extend(\"bizagi.render.services.service\",\r\n    {\r\n        // Statics\r\n        BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n        BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n        BA_PAGE_CACHE: \"pageCacheId\"\r\n    },\r\n    {\r\n        /*\r\n         *   Constructor\r\n         */\r\n        init: function(params) {\r\n            params = params || {};\r\n            params.context = params.context || \"workflow\";\r\n            params.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n            this.serviceLocator = new bizagi.render.services.context(params);\r\n            this.multiactionService = new bizagi.render.services.multiactionservice(this);\r\n            this.guid = Math.guid();\r\n\r\n            if (bizagi.override.enableECMMetadataMultiaction) {\r\n                this.multiactionMetadataService = new bizagi.render.services.metadatamultiactionservice(this);\r\n            }\r\n\r\n            // Userfield definitions mini-cache\r\n            this.userfieldRequests = {};\r\n\r\n            this.deviceType = params.deviceType || (bizagi.util.isSmartphoneDevice() ? bizagi.deviceEnum.smartphone: (bizagi.util.isTabletDevice() ? bizagi.deviceEnum.tablet: bizagi.deviceEnum.desktop));\r\n            this.deviceCode = bizagi.util.getDeviceCode();\r\n        },\r\n        /*\r\n         *   Return the multiaction-service\r\n         */\r\n        multiaction: function() {\r\n            return this.multiactionService;\r\n        },\r\n\r\n        metadataECMMultiaction: function () {\r\n            return bizagi.override.enableECMMetadataMultiaction ? this.multiactionMetadataService: this;\r\n        },\r\n        /*\r\n         *   SINGLE SERVICES METHODS\r\n         */\r\n\r\n        /*\r\n         *   Gets form data\r\n         *   Returns a promise of the data being retrieved\r\n         */\r\n        getFormData: function(params) {\r\n            var self = this;\r\n\r\n            // Check if the params contains mocked data\r\n            if (params && params.data) {\r\n                return params.data;\r\n            }\r\n\r\n            // Define data\r\n            params = params || {};\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = params.action || \"LOADFORM\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = self.deviceType;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicecode\"] = self.deviceCode;\r\n\r\n            if (params.idProcess)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idProcess\"] = params.idProcess;\r\n            if (params.idForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idForm\"] = params.idForm;\r\n            if (params.idEntity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idEntity\"] = params.idEntity;\r\n            if (params.surrogateKey)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogateKey;\r\n            if (params.idRender)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            if (params.xpathContext)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.requestedForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"requestedForm\"] = params.requestedForm;\r\n            if (params.recordXPath)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"recordXPath\"] = params.recordXPath;\r\n            if (params.summaryForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"summaryForm\"] = params.summaryForm;\r\n            if (params.idCase)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idCase\"] = params.idCase;\r\n            if (params.idWorkitem)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idWorkitem\"] = params.idWorkitem;\r\n            if (params.idTask)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idTask\"] = params.idTask;\r\n            if (params.idPageCache)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.contextType)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contextType;\r\n            if (params.guidEntity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidEntity;\r\n            if (!bizagi.util.isEmpty(params.isRefresh))\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isRefresh\"] = params.isRefresh;\r\n            if (params.isActionStartForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isActionStartForm\"] = params.isActionStartForm;\r\n            if (params.additionalXpaths)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"additionalXpaths\"] = params.additionalXpaths;\r\n            if (params.idStartScope)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idStartScope\"] = params.idStartScope;\r\n            if (typeof params.readOnlyForm !== \"undefined\")\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"readonlyform\"] = params.readOnlyForm;\r\n            if (typeof params.printversion !== \"undefined\")\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"printForm\"] = params.printversion;\r\n            if (typeof params.recordXpath !== \"undefined\")\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"recordlauncherxpath\"] = params.recordXpath;\r\n            if (params.guid)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guid\"] = params.guid;\r\n            if (params.downloadOfflineForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"downloadofflineform\"] = 1;\r\n\r\n            if (params.editable === false) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"DisplayFormAsReadOnly\"] = true;\r\n            }\r\n\r\n            // Support parameter from ui\r\n            // Parameters that affects all the same attributes of render\r\n            if (params.printversion) {\r\n                //Print limit grid rows\r\n                var BA_ALL_PARAMETER_PREFIX = \"all_\";\r\n\r\n                if (params[self.Class.BA_ACTION_PARAMETER_PREFIX + BA_ALL_PARAMETER_PREFIX + \"rows\"]) {\r\n                    data[self.Class.BA_ACTION_PARAMETER_PREFIX + BA_ALL_PARAMETER_PREFIX + \"rows\"] = params[self.Class.BA_ACTION_PARAMETER_PREFIX + BA_ALL_PARAMETER_PREFIX + \"rows\"];\r\n                }\r\n            }\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n\r\n            // Call ajax and returns promise\r\n            bizagi.chrono.initAndStart(\"data\");\r\n            var ajaxParams = {\r\n                url: params.url || self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: params.action || \"LOAD\"\r\n            };\r\n            if (params.downloadOfflineForm){\r\n                ajaxParams.avoidLoader = true;\r\n            }\r\n            return $.ajax(ajaxParams)\r\n                .pipe(function(response) {\r\n                    bizagi.chrono.stopAndLog(\"data\");\r\n\r\n                    // Transform data for read only version\r\n                    if (params.printversion) {\r\n                        try {\r\n                            response.form.properties.editable = \"False\";\r\n\r\n                            var transformGridDataToReadOnly = function(_data) {\r\n                                if (_data == null) {\r\n                                    return _data;\r\n                                }\r\n                                if (_data.hasOwnProperty('type') && _data.type == 'grid') {\r\n                                    _data.id = data.id + \"-print\";\r\n                                    _data.allowAdd = \"False\";\r\n                                    _data.allowDelete = \"False\";\r\n                                    _data.allowEdit = \"False\";\r\n                                    _data.allowGrouping = \"False\";\r\n                                    _data.allowMore = \"False\";\r\n                                    _data.allowSearch = \"False\";\r\n                                } else {\r\n                                    $.each(data, function(key, value) {\r\n                                        if (typeof (value) == 'object') {\r\n                                            _data[key] = transformGridDataToReadOnly(_data[key]);\r\n                                        }\r\n                                    });\r\n                                }\r\n                                return _data;\r\n                            };\r\n                            response = transformGridDataToReadOnly(response);\r\n                        } catch (e) {\r\n                        }\r\n                    }\r\n\r\n                    return response;\r\n                });\r\n        },\r\n        /*\r\n         *   Gets a search form data\r\n         *   Returns a promise of the data being retrieved\r\n         */\r\n        getSearchFormData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            params = params || {};\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SEARCHFORM\";\r\n            if (params.xpath)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            if (params.idRender)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            if (params.xpathContext)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.idSearchForm)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchForm\"] = params.idSearchForm;\r\n            if (params.idPageCache)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-search-form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SEARCHFORM\"\r\n            });\r\n        },\r\n\r\n        processDataValues: function(data) {\r\n            var o;\r\n            data = $.extend(true, {}, data);\r\n            for (o in data) {\r\n                if (data.hasOwnProperty(o) && $.type(data[o]) == \"object\") {\r\n                    // for search\r\n                    if (data[o].hasOwnProperty(\"id\")) {\r\n                        data[o] = data[o].id;\r\n                    }\r\n                }\r\n            }\r\n            return data;\r\n        },\r\n        /*\r\n         *   Sends a form action to the server\r\n         */\r\n        submitData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            data = self.resolveData(params.data || {}, params.xpathContext);\r\n            data = self.processDataValues(data);\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = params.action;\r\n\r\n            // Fill optional parameters\r\n            params = params || {};\r\n            if (params.xpath)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            if (params.idRender)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            if (params.xpathContext)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.idPageCache)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.guidEntity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidEntity;\r\n            if (params.contexttype)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            if (params.transitions)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"transitions\"] = params.transitions;\r\n            if (params.surrogatekey)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogatekey;\r\n            if (params.forcePlanCompletion)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"forcePlanCompletion\"] = params.forcePlanCompletion;\r\n\r\n            /* if (params.isActionStartForm)\r\n             data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isActionStartForm\"] = params.isActionStartForm;\r\n             */\r\n            var actionType = params.action.toString().toUpperCase();\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Data sent\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-submit-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: actionType\r\n            });\r\n        },\r\n        /*\r\n         * Get data processing xpathcontext\r\n         */\r\n        resolveData: function(data, xpathContext) {\r\n            var name, newName, value;\r\n            if (!$.isEmptyObject(data) && xpathContext) {\r\n                if (xpathContext.search(/\\[id=\\d+\\]/) !== -1) {\r\n                    for (name in data) {\r\n                        if (name.search(/\\[id=\\d+\\]/) !== -1 && xpathContext == name.substr(0, name.search(/\\]/) + 1)) {\r\n                            newName = name.substr(name.search(/\\]/) + 2);\r\n                            value = data[name];\r\n                            data[newName] = value;\r\n                            delete data[name];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return data;\r\n        },\r\n        /*\r\n         *   Fetch a property from the server\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         *   -   property\r\n         */\r\n        getPropertyData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.property;\r\n\r\n            if (params.sessionId)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            if (params.contexttype)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            if (params.guidentity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidentity;\r\n            if (params.surrogatekey)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogatekey;\r\n            if (params.pxpath)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"xpath\"] = params.pxpath;\r\n            if (params.prows)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"rows\"] = params.prows;\r\n            if (params.ppage)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"page\"] = params.ppage;\r\n            if (params.pfilter != undefined && params.pfilter != null)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"filter\"] = params.pfilter;\r\n            /*else\r\n             data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"filter\"] = \"\";*/\r\n            if (params.psort != undefined && params.psort != null)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = params.psort;\r\n            if (params.porder)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"order\"] = params.porder;\r\n            if (params.pcaseId)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"caseId\"] = params.pcaseId;\r\n            if (params.pguidEntity)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"guidEntity\"] = params.pguidEntity;\r\n            if (params.psurrogatedKey) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"surrogatedKey\"] = params.psurrogatedKey;\r\n            }\r\n            if (params.pactionXpath) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"actionXpath\"] = params.pactionXpath;\r\n            }\r\n            if (params.ptemplateGuid) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"templateGuid\"] = params.ptemplateGuid;\r\n            }\r\n            if (params.pparameters) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"parameters\"] = params.pparameters;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Property refresh for '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            // TODO: change REST library in order to support extra HTTP parameters\r\n            // Please be careful with dataType parameter\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\",\r\n                beforeSend: function(xhr, status) {\r\n                    bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                    bizagi.multiactionConnection.push(xhr);\r\n                }\r\n            });\r\n\r\n        },\r\n        /*\r\n         *   Refresh the data property from the server\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         */\r\n        getData: function(params) {\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"data\"\r\n            }));\r\n        },\r\n        /*\r\n         *   Refresh the data property from the server\r\n         *   This version is to fetch search data\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         *   -   term\r\n         */\r\n        getSearchData: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"term\"] = params.term;\r\n\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"data\"\r\n            }));\r\n        },\r\n\r\n        /*\r\n         * Refresh tha data property from the server\r\n         * Params:\r\n         *   -   collapsestate\r\n         */\r\n        getCollapseData: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"collapseState\"] = params.collapseState;\r\n\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"collapseState\"\r\n            }));\r\n        },\r\n\r\n        /*\r\n         *   Refresh the data property from the server\r\n         *   This version is to fetch grid data\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         *   -   sort\r\n         *   -   page\r\n         *   -   rows\r\n         */\r\n        getGridData: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = params.sort;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"order\"] = params.order;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"page\"] = params.page;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"rows\"] = params.rows;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchFilter\"] = params.searchFilter;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"value\"] = params.value;\r\n\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"data\"\r\n            }));\r\n        },\r\n\r\n        getGridDataExclusivesSelected: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"rows\"] = params.rows;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"value\"] = params.value;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"xpathfilter\"] = params.xpathfilter;\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"exclusivesSelected\"\r\n            }));\r\n        },\r\n\r\n        /*\r\n         *   Returns the upload plugin cancel image\r\n         */\r\n        getUploadCancelImage: function() {\r\n            return bizagi.services.ajax.pathToBase + this.serviceLocator.getUrl(\"render-upload-cancel-image\");\r\n        },\r\n        /*\r\n         *   Returns the upload file url for each file\r\n         */\r\n        getUploadFileUrl: function(params) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-data-url\");\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"fileContent\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"fileId\"] = params.fileId;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n\r\n        getUploadFileEntityUrl: function(params) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-data-url\");\r\n            var data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUETEMPLATE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"fileContent\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"fileId\"] = params.fileId;\r\n            if (params.isContextContainerWidgetRender) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"xpathactions\"] = params.xpathActions;\r\n            } else {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogatekey;\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidentity;\r\n            }\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n\r\n        /*\r\n         *   Returns the upload add url\r\n         */\r\n        getUploadAddUrl: function() {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-add-url\");\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ADDFILE\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n        },\r\n        /*\r\n         *   Returns the upload add url\r\n         */\r\n        getUploadAddFileUrl: function(isUserPreferences) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"form-submit-data-upload\");\r\n            var data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = (isUserPreferences === true) ? \"SAVEUSERIMAGE\" : \"savefile\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n        },\r\n\r\n        deleteImage: function(params) {\r\n            var self = this;\r\n\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"DELETEUSERIMAGE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Removing image '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-upload-delete-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Returns the upload add url\r\n         */\r\n        deleteUploadFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REMOVERELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Removing file in upload '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-upload-delete-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n\r\n            });\r\n        },\r\n        /*\r\n         * Return file meta data\r\n         */\r\n        getECMMetadata: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"getECMMetadata\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            if (params.sessionId) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            }\r\n            // Log submit data\r\n            bizagi.debug(\"Get file metadata '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                interceptor: {\r\n                    intercept: true,\r\n                    source: \"rendering_\" + self.guid,\r\n                }\r\n            });\r\n\r\n        },\r\n        /*\r\n         * Checkout a file\r\n         **/\r\n        checkOutFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"checkOutFile\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"file checkout '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         * cancelCheckOut\r\n         **/\r\n        cancelCheckOut: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"cancelCheckOut\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"file checkout '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         * Checkout a file\r\n         **/\r\n        deleteECMFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"delete\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"delete file'\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         *  Update ECM file content\r\n         **/\r\n        updateECMFileContent: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"updateECMFileContent\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n\r\n            data.metaValues = params.metaValues;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Update file content '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         *  Update file content\r\n         **/\r\n        updateECMMetadata: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"updateECMMetadata\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n\r\n            data.metaValues = params.metaValues;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Update file meta data '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        getFileProperties: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"getFileProperties\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Get file properties '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                interceptor: {\r\n                    intercept: true,\r\n                    source: \"rendering_\" + self.guid,\r\n                }\r\n            });\r\n        },\r\n        uploadECMFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"uploadECMFile\";\r\n            data.fileUpload = params.fileUpload; // Content of file\r\n            data.xPath = params.xPath;\r\n\r\n            data.idAttrib = params.idAttrib;\r\n            data.fileName = params.fileName;\r\n            data.metaValues = params.metaValues;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Upload ECM file '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        getECMFileUrl: function(params) {\r\n            var self = this;\r\n            var url = params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\") + \"File\";\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data.action = \"viewECMFile\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n\r\n            data.fileName = params.fileName;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n            if (params.sessionId) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            }\r\n            if (params.p_sessionId) {\r\n                data.p_sessionId = params.p_sessionId;\r\n            }\r\n\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"View uploaded file '\" + params.xPath + \"'\", data);\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n        /*\r\n         *\r\n         */\r\n        isFileOnECM: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = {};\r\n            data[\"action\"] = \"isFileOnECM\";\r\n            data[\"idUpload\"] = params.idUpload;\r\n\r\n            // Call ajax and returns promise\r\n            return $.read(self.serviceLocator.getUrl(\"render-ecm-upload-url\"), data);\r\n        },\r\n        /*\r\n         *   Start a grid record edition\r\n         */\r\n        editGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EDITRELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending edit request for relation '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-edit-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"EDITRELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Sends a grid request to add a new row\r\n         *   The server returns the new row in json\r\n         */\r\n        addGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ADDRELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending add request for grid '\" + params.xpath + \"'\", data);\r\n\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-add-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"ADDRELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Sends a grid request to add a new row, and sending the data at the same time\r\n         *   The server returns the new row in json\r\n         */\r\n        addGridRecordData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ADDRELATIONWITHDATA\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Build data to submit\r\n            var submitData = params.submitData || {};\r\n            for (key in submitData) {\r\n                data[key] = submitData[key];\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending add request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-add-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"ADDRELATIONWITHDATA\"\r\n            });\r\n        },\r\n        /*\r\n         *   Submits the grid record data to the server\r\n         */\r\n        saveGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SAVERELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"disableServerGridValidations\"] = params.disableServerGridValidations || false;\r\n\r\n            // Send the submitted data page cache because it cointains the grid's form page cache\r\n            if (params.submitData.idPageCache) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.submitData.idPageCache;\r\n                delete params.submitData.idPageCache;\r\n            }\r\n\r\n            var submitData = params.submitData || {};\r\n\r\n            // Build data to submit\r\n            submitData = self.processDataValues(submitData);\r\n\r\n            for (key in submitData) {\r\n                data[key] = submitData[key];\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending save request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-save-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SAVERELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Deletes a grid record in the server\r\n         */\r\n        deleteGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REMOVERELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending delete request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-save-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"REMOVERELATION\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         * Get association flipped status\r\n         */\r\n        getFlipAssociation: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.id;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"flipped\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"flipstate\"] = params.flipstate;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log request data\r\n            bizagi.debug(\"Sending request for flip association control '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"text\"\r\n            }).pipe(function(response) {\r\n                try {\r\n                    // Try to attempt to parse JSON\r\n                    return bizagi.services.ajax.parseJSON(response);\r\n                } catch (e) {\r\n                    // If JSON is not valid we need to return the original text response\r\n                    return response;\r\n                }\r\n            });\r\n        },\r\n        /*\r\n         *   Cancels an add or edit request for a grid\r\n         */\r\n        rollbackGridAction: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ROLLBACK\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending rollback request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-rollback-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"ROLLBACK\"\r\n            });\r\n        },\r\n        /*\r\n         *   Returns the search render default image\r\n         */\r\n        getSearchDefaultImage: function() {\r\n            return bizagi.services.ajax.pathToBase + this.serviceLocator.getUrl(\"render-search-default-image\");\r\n        },\r\n\r\n        processDataCriteria: function(criteria) {\r\n            var o;\r\n            criteria = $.extend(true, [], criteria);\r\n            for (o in criteria) {\r\n                if (criteria.hasOwnProperty(o) && criteria[o].hasOwnProperty(\"value\") && $.type(criteria[o].value) == \"object\") {\r\n                    // for search\r\n                    if (criteria[o].value.hasOwnProperty(\"id\") && criteria[o].value.hasOwnProperty(\"label\")) {\r\n                        criteria[o].value = criteria[o].value.id;\r\n                    }\r\n                }\r\n            }\r\n            return criteria;\r\n        },\r\n\r\n        /*\r\n         *   Perform entity search in the server\r\n         */\r\n        submitSearch: function(params) {\r\n            var self = this, criteria;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            var sort = params.sort && params.sort !== \"\" ? params.sort : \"\";\r\n\r\n            if (params.order && params.order !== \"\" && sort !== \"\")\r\n                sort += \" \" + params.order;\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SEARCHENTITYFORRENDER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchForm\"] = params.idSearchForm;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = sort;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"page\"] = params.page;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"pageSize\"] = params.rows;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchFilter\"] = params.searchFilter;\r\n\r\n            criteria = self.processDataCriteria(params.criteria);\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchCriteria\"] = JSON.encode(criteria);\r\n\r\n            // Optional search params\r\n            if (params.allowFullSearch)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"allowFullSearch\"] = params.allowFullSearch;\r\n            if (params.maxRecords)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"maxRowsAllowed\"] = params.maxRecords;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Performing advanced search\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-search-advanced-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SEARCHENTITYFORRENDER\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Submits the stakeholder associated\r\n         */\r\n        associateStakeholder: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SAVE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogateKey;\r\n            data[\"associatedUser\"] = params.associatedUser;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidentity;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Property refresh for '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            // TODO: change REST library in order to support extra HTTP parameters\r\n            // Please be careful with dataType parameter\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-stakeholder-associated\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Refresh the stakeholder associated list\r\n         */\r\n        refreshAssociateStakeholder: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.property;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Property refresh for '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            // TODO: change REST library in order to support extra HTTP parameters\r\n            // Please be careful with dataType parameter\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-stakeholder-associated\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Gets the link to the letter\r\n         */\r\n        getLetterNotEditableUrl: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"GETLETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Call ajax and returns promise\r\n            var url = params.url || self.serviceLocator.getUrl(\"render-letter-notEditable-url\");\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n        },\r\n        /*\r\n         *   Gets the content for editable letters\r\n         */\r\n        getLetterContent: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"GETLETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-letter-content-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"html\"\r\n            }).pipe(function(response) {\r\n                try {\r\n                    return bizagi.services.ajax.parseJSON(response);\r\n                } catch (e) {\r\n                    return response;\r\n                }\r\n            });\r\n        },\r\n        /*\r\n         *   Get the can generate letter flag\r\n         */\r\n        getCanGenerateLetter: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"CANGENERATELETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"render-letter-content-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         *   Saves the content for editable letters\r\n         */\r\n        saveLetterContent: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"UPDATELETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Define content\r\n            var content = params.content || \"\";\r\n\r\n            // Define url\r\n            var url = params.url || (self.serviceLocator.getUrl(\"render-letter-save-url\"));\r\n            var fullUrl = url + \"?\" + jQuery.param(data);\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Save request for letter sent to: \" + fullUrl, content);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: fullUrl,\r\n                data: content,\r\n                type: \"POST\",\r\n                dataType: \"html\"\r\n            });\r\n        },\r\n        /*\r\n         *   Returns the icons path for the letter plugin\r\n         */\r\n        getLetterEditorIconsPath: function() {\r\n            return bizagi.services.ajax.pathToBase + this.serviceLocator.getUrl(\"render-letter-content-icons\");\r\n        },\r\n        /*\r\n         *   Executes a button action in the server\r\n         */\r\n        executeButton: function(params) {\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"buttonRule\"\r\n            }));\r\n        },\r\n        /*\r\n         *   Executes a fileprint action in the server\r\n         */\r\n        getFilePrintUrl: function(params) {\r\n\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-data-url\");\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"data\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"disposition\"] = params.disposition;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n\r\n        },\r\n        /*\r\n         *   Start a link form edition\r\n         */\r\n        editLinkForm: function(params) {\r\n            // Actually it does the same than edit grid records\r\n            return this.editGridRecord(params);\r\n        },\r\n        /*\r\n         *   Saves the content of the link form\r\n         */\r\n        saveLinkForm: function(params) {\r\n            // Actually it does the same than edit grid records\r\n            //return this.saveGridRecord(params);\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SAVEFORMLINKRELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Send the submitted data page cache because it cointains the grid's form page cache\r\n            if (params.submitData.idPageCache) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.submitData.idPageCache;\r\n                delete params.submitData.idPageCache;\r\n            }\r\n\r\n            var submitData = params.submitData || {};\r\n\r\n            // Build data to submit\r\n            submitData = self.processDataValues(submitData);\r\n\r\n            for (key in submitData) {\r\n                data[key] = submitData[key];\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending save request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-save-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SAVEFORMLINKRELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Rollbacks the link form edition\r\n         */\r\n        rollbackLinkForm: function(params) {\r\n            // Actually it does the same than rollback grid records\r\n            return this.rollbackGridAction(params);\r\n        },\r\n        /*   Commit the link form edition\r\n         */\r\n        commitLinkForm: function(params) {\r\n            // Actually it does the same than rollback grid records\r\n            return this.commitGridAction(params);\r\n        },\r\n        /*   Sends schekpoint action\r\n         */\r\n        sendCheckpoint: function(params) {\r\n            // Actually it does the same than rollback grid records\r\n            return this.sendCheckpointAction(params);\r\n        },\r\n        /*\r\n         *   Loads the userfield definition\r\n         */\r\n        getUserfieldDefinition: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            // Check in deferreds cache\r\n            if (self.userfieldRequests[params.userfield])\r\n                return self.userfieldRequests[params.userfield];\r\n\r\n            // Required params: idCase\r\n            self.userfieldRequests[params.userfield] = $.read(self.serviceLocator.getUrl(\"render-userfield-definition\"),\r\n                {\r\n                    guidUserfield: params.userfield,\r\n                    device: (params.device || \"desktop\")\r\n                }\r\n            );\r\n\r\n            // Return deferred\r\n            return self.userfieldRequests[params.userfield];\r\n        },\r\n        /**\r\n         *  Get render json for one render o container\r\n         *  @param {object} params object with idRender,idPageCache\r\n         */\r\n        refreshControl: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REFRESH\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n            (params.idForm) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idForm\"] = params.idForm : \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"PARTIALREFRESH\"\r\n            });\r\n        },\r\n        /**\r\n         *  Get render json for one render o container\r\n         *  @param {object} params object with idRender,idPageCache\r\n         */\r\n        refreshGridCell: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REFRESHGRIDCELL\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidcolumn\"] = params.column;\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.idForm) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idForm\"] = params.idForm : \"\";\r\n            (params.typeRender) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"typeRender\"] = params.typeRender : \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /**\r\n         * Request to execute rule on server\r\n         * @param {object} params h_pageCacheId, guidrule\r\n         */\r\n        executeRule: function(params) {\r\n            var self = this;\r\n\r\n\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTERULE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidrule\"] = params.rule || \"\";\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /**\r\n         * Request to execute interface on server\r\n         * @param {object} params h_pageCacheId, guidinterface\r\n         */\r\n        executeInterface: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTEINTERFACE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidinterface\"] = params.interface || \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext || \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /**\r\n         * Request to execute SAP Connecor\r\n         * @param {object} params h_pageCacheId, guidinterface\r\n         */\r\n        executeSAPConnector: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTESAP\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidsap\"] = params.guidsap || \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext || \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /**\r\n         * Request to execute a Bizagi connector\r\n         * @param params\r\n         * @return {{}}\r\n         */\r\n        executeConnector: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTECONNECTOR\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidConnector\"] = params.guidConnector || \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext || \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /*\r\n         *   Document Templates generate rest service\r\n         */\r\n        generateDocumentTemplate: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n            params.append = params.append ? params.append : false;\r\n\r\n            return $.create(\r\n                self.serviceLocator.getUrl(\"render-document-generate\"),\r\n                {\r\n                    h_pageCacheId: params.idPageCache,\r\n                    contextXpath: params.xpathcontext,\r\n                    groupMappingId: params.groupMapping,\r\n                    xpathAttribute: params.xpath,\r\n                    append: params.append,\r\n                    controlId: params.id\r\n                }\r\n            );\r\n        },\r\n        /*\r\n         *   Document Templates generate rest service\r\n         */\r\n        getAllDocumentsDownloadUrl: function(params) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-document-generateAllDocuments\");\r\n            var data = {};\r\n            data[\"h_pageCacheId\"] = params.idPageCache;\r\n            data[\"contextXpath\"] = params.xpathContext;\r\n            data[\"xpathAttribute\"] = params.xpath;\r\n            data[\"idCase\"] = params.idCase;\r\n            data[\"idWorkItem\"] = params.idWorkItem;\r\n            data[\"p_sessionId\"] = params.sessionId;\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n\r\n        },\r\n\r\n\r\n        getCaseNumber: function(params) {\r\n            var self = this;\r\n            //this function use sendEMail\r\n            //and not possible use dat ain ajax\r\n            //this is workaround (rhonyp)\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"case-handler-getCaseSummary\").replace(\"{idCase}\", params.idCase) + \"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice=\" + bizagi.isMobile(),\r\n                type: \"GET\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n\r\n        getCaseAssignees: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            // Required params: idCase\r\n            return $.read(\r\n                self.serviceLocator.getUrl(\"case-handler-getCaseAssignees\"), {\r\n                    idCase: params.idCase\r\n                }\r\n            ).pipe(function(response) {\r\n                    return response;\r\n                });\r\n        },\r\n\r\n        getWorkitems: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"case-handler-getWorkItems\"), {\r\n                idCase: params.idCase,\r\n                onlyUserWorkItems: params.onlyUserWorkItems || \"\"\r\n            });\r\n        },\r\n        /*\r\n         *   Executes a grid export action in the server\r\n         */\r\n        getGridExportUrl: function(params) {\r\n\r\n            var self = this,\r\n                url = this.serviceLocator.getUrl(\"render-upload-data-url\"),\r\n                data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.exportType; //\"data\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"disposition\"] = params.disposition;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = params.sort;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"idForm\"] = params.idForm;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n\r\n        /*\r\n         * Executes a send email action in the server\r\n         */\r\n        sendEmail: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.property || \"sendEmail\";\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n\r\n            // Email parameters\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"to\"] = params.to;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"subject\"] = params.subject;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"message\"] = params.message;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"selected\"] = JSON.encode(params.selected);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            var url = params.url || self.serviceLocator.getUrl(\"form-get-data\");\r\n\r\n            return $.create(url, data);\r\n        },\r\n\r\n        /*\r\n         * Request to invalidates page cache in server, since it is no needed anymore\r\n         */\r\n        invalidatePageCache: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"INVALIDATEPAGECACHE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-submit-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"INVALIDATEPAGECACHE\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         * Search users usign parameters suchs as userName, fullName, domain and organization\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersList: function(params) {\r\n            var self = this;\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"admin-getUsersList\"), params);\r\n        },\r\n        /*\r\n         * Search users for preferences usign parameters suchs as userName, fullName, domain and organization\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersListFromPreferences: function(params) {\r\n            return $.read(this.serviceLocator.getUrl(\"admin-getUsersList-FromPreferences\"), params);\r\n        },\r\n\r\n        /*\r\n         * Search users for Stakeholders\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersListForStakeholders: function(params) {\r\n            return $.read(this.serviceLocator.getUrl(\"admin-getUsersList-ForStakeholders\"), params);\r\n        },\r\n\r\n        /*\r\n         * Search users usign parameters suchs as userName, fullName, domain and organization\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersForAssignation: function(params) {\r\n            var self = this;\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"admin-getUsersForAssignation\"), params);\r\n        },\r\n\r\n        /**\r\n         * Get Users Creation/Edition Form\r\n         */\r\n        getUsersForm: function(params) {\r\n            var self = this;\r\n            return $.create(self.serviceLocator.getUrl(\"admin-usersform\"), params);\r\n        },\r\n        /**\r\n         *   Return generate Data To Send By Email\r\n         */\r\n        generateDataToSendByEmail: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n            var data = {\r\n                action: \"GenerateDataToSendByEmail\",\r\n                idUser: params.idUser,\r\n                password: params.password\r\n            };\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"admin-GenerateDataToSendByEmail\"),\r\n                data: params,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /**\r\n         * Return generate Send user password Mail\r\n         */\r\n        sendUserEmail: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n            var data = {\r\n                action: \"SendUserEmail\",\r\n                emailTo: params.eMailTo,\r\n                subject: params.subject,\r\n                body: params.body\r\n            };\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"admin-sendUserEmail\"),\r\n                data: params,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Get bizagi configuration\r\n         * @param {Function}   type callback function when the file load is succed\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getConfiguration: function() {\r\n            var self = this;\r\n            var url = self.serviceLocator.getUrl(\"admin-users-config\");\r\n\r\n            return $.read(url);\r\n        },\r\n\r\n        /**\r\n         * Validate if url has 'http' string, in that case is not necesary add the pathToBase prefix\r\n         */\r\n        verifyPathToBase: function(pathToBase, url) {\r\n\r\n            if (url.indexOf(\"http\") != -1 && pathToBase != \"\") {\r\n                return url;\r\n            } else {\r\n                return pathToBase + url;\r\n            }\r\n\r\n        },\r\n\r\n        /**\r\n         * Get template of entity\r\n         * @param params { guid, prepare}\r\n         */\r\n        getTemplate: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"LOADTEMPLATE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = \"entity\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guid;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isProcessData\"] = params.forcePersonalizedColumns;\r\n\r\n            if (params.templateType) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"templatetype\"] = params.templateType;\r\n            }\r\n\r\n            if (params.templateGuid) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"templateguid\"] = params.templateGuid;\r\n            }\r\n\r\n            if (params.isDefaultTemplate != undefined) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isDefaultTemplate\"] = params.isDefaultTemplate;\r\n            }\r\n\r\n            // Fix device type since on mobility there are tablet_ios, tablet_android, smartphone_ios, smartphone_ios\r\n            // and the service recives either tablet or smartphone\r\n            var deviceType = bizagi.util.detectDevice();\r\n            if (bizagi.util.isTabletDevice()) {\r\n                deviceType = \"tablet\";\r\n            } else if (bizagi.util.isSmartphoneDevice()) {\r\n                deviceType = \"mobile\";\r\n            }\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = deviceType;\r\n\r\n            // When prepare is true just return data, this feature is used by multiaction service\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-get-data\"), data);\r\n        },\r\n\r\n        /**\r\n         * Chek if an entity has startform\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        hasStartForm: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n\r\n            if (params.guidWFClass) {\r\n                data.guidWFClass = params.guidWFClass;\r\n            }\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"render-processes-startform\"), data);\r\n        },\r\n\r\n        /**\r\n         * Get the start form of the case\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        getStartForm: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"LOADSTARTFORM\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidprocess\"] = params.guidprocess;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isActionStartForm\"] = true;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = self.deviceType;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicecode\"] = self.deviceCode;\r\n\r\n            if (params.idStartScope) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idStartScope\"] = params.idStartScope;\r\n            }\r\n            if (params.idCase) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idCase\"] = params.idCase;\r\n            }\r\n            if (params.idStartScope) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idStartScope\"] = params.idStartScope;\r\n            }\r\n            if (params.idWorkitem) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idWorkitem\"] = params.idWorkitem;\r\n            }\r\n            if (params.additionalXpaths) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"additionalXpaths\"] = params.additionalXpaths;\r\n            }\r\n            if (params.surrogatedKey) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"surrogatedKey\"] = params.surrogatedKey;\r\n            }\r\n            if (params.recordXpath) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"recordlauncherxpath\"] = params.recordXpath;\r\n            }\r\n            if (params.mappingstakeholders) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"mappingstakeholders\"] = params.mappingstakeholders;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                cache: true\r\n            });\r\n        },\r\n        /*\r\n         *   Start a link form edition\r\n         */\r\n        editActionForm: function(params) {\r\n            // Actually it does the same than edit grid records\r\n            return this.editGridRecord(params);\r\n        },\r\n\r\n        /**\r\n         * Get list of actions in action launcher\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        getActions: function(params) {\r\n            var self = this;\r\n            var extendParams = $.extend(params, { prepare: true });\r\n\r\n            var data = self.getPropertyData(extendParams) || [];\r\n\r\n            if (params.ptags) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"tags\"] = params.ptags;\r\n            }\r\n\r\n            if (params.pmaxitems) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"maxitems\"] = params.pmaxitems;\r\n            }\r\n\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\",\r\n                beforeSend: function(xhr, status) {\r\n                    bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                    bizagi.multiactionConnection.push(xhr);\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        /**\r\n         * Execute actions or constructors\r\n         * @param params\r\n         */\r\n        executeActions: function(params) {\r\n            var self = this;\r\n            var extendParams = $.extend({}, params, { prepare: true });\r\n            var data = self.getPropertyData(extendParams) || [];\r\n\r\n            if (params.pguidConstructor) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"guidConstructor\"] = params.pguidConstructor;\r\n            }\r\n\r\n            if (params.pguidAction) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"guidAction\"] = params.pguidAction;\r\n            }\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\"\r\n            });\r\n\r\n        },\r\n\r\n        /**\r\n         * Get list of actions in action launcher\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        getPolymorphicActions: function(params) {\r\n            var self = this;\r\n            var extendParams = $.extend(params, { prepare: true });\r\n            var data = self.getPropertyData(extendParams) || [];\r\n\r\n            if (params.ptags) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"tags\"] = params.ptags;\r\n            }\r\n\r\n            if (params.additionalXpaths) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"additionalXpaths\"] = params.additionalXpaths;\r\n            }\r\n\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\"\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Make a JSON tree of polymorphic constructors categories\r\n         * @param values\r\n         * @return {Array}\r\n         */\r\n        serializePolymorphicActions: function(values) {\r\n            // json serializer\r\n            var actions = [];\r\n            var GUID_ENTITY = 0, DISPLAY_NAME = 1, XPATHCONTEXT = 2, TYPE = 3, GUID_OBJECT = 4, GUID_CONSTRUCTOR = 5, GUID_PARENT_ENTITY = 6;\r\n\r\n            /**\r\n             * Get children by guid of entity\r\n             * @param guid\r\n             * @return {Array}\r\n             */\r\n            var getChildren = function(guid) {\r\n                var children = [];\r\n                guid = guid || \"\";\r\n\r\n                $.each(values, function(key, value) {\r\n                    if (value[GUID_PARENT_ENTITY] == guid) {\r\n                        children.push(value);\r\n                    }\r\n                });\r\n                return children;\r\n            };\r\n\r\n            /**\r\n             * Get parents by action object\r\n             * @param node\r\n             * @return {string}\r\n             */\r\n            var getParents = function(node) {\r\n                node = node || {};\r\n                var parents = \"\";\r\n\r\n                $.each(values, function(key, value) {\r\n                    if (value[GUID_ENTITY] == node[GUID_PARENT_ENTITY]) {\r\n                        parents += getParents(value) + value[DISPLAY_NAME] + \" > \";\r\n                    }\r\n                });\r\n                return parents;\r\n            };\r\n\r\n\r\n            /**\r\n             * Make a tree of actions\r\n             * @param list\r\n             * @param guid\r\n             * @return {*}\r\n             */\r\n            var fillTree = function(list, guid) {\r\n                var node;\r\n                var children = getChildren(guid);\r\n                $.each(children, function(key, value) {\r\n                    var child = fillTree([], value[GUID_ENTITY]);\r\n                    node = {\r\n                        \"guidEntity\": value[GUID_ENTITY],\r\n                        \"displayName\": value[DISPLAY_NAME],\r\n                        \"hasConstructor\": (value[GUID_CONSTRUCTOR]) ? true : false,\r\n                        \"type\": value[TYPE],\r\n                        \"guidObject\": value[GUID_OBJECT],\r\n                        \"guidConstructor\": value[GUID_CONSTRUCTOR],\r\n                        \"xpathContext\": value[XPATHCONTEXT],\r\n                        \"children\": child,\r\n                        \"parents\": getParents(value)\r\n                    };\r\n                    if (node.guidConstructor !== \"\" || node.children.length > 0) {\r\n                        list.push(node);\r\n                    }\r\n                });\r\n\r\n                return list;\r\n            };\r\n            fillTree(actions, \"\");\r\n            return actions;\r\n        },\r\n\r\n        /**\r\n         * Gets the image for an entity xpath\r\n         * @param params\r\n         */\r\n        getEntityImage64: function(params) {\r\n            var self = this,\r\n                data = {\r\n                    width: params.data,\r\n                    height: params.height,\r\n                    xpath: params.xpath\r\n                },\r\n                url = self.serviceLocator.getUrl(\"render-entity-layout-image64\").replace(\"{entity}\", params.entity).replace(\"{surrogateKey}\", params.surrogateKey);\r\n\r\n            return $.ajax({\r\n                url: url,\r\n                data: data\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Get data files when user access from my stuff, because there is no scope\r\n         */\r\n        getFilesDataForLayoutUploadControl: function(params) {\r\n            var self = this;\r\n            return $.read(self.serviceLocator.getUrl(\"render-entity-layout-upload-files\"), params);\r\n        },\r\n\r\n        /**\r\n         * Process an upload file into the server\r\n         * @param {} params\r\n         * @returns {}\r\n         */\r\n        processUploadFile: function(params) {                \r\n            return $.ajax({\r\n                url: this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase || \"\", params.url),\r\n                data: params.formData,\r\n                type: \"POST\",\r\n                contentType: false,\r\n                processData: false\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Commit an add or edit request for a grid\r\n         * @param params\r\n         * @returns {*}\r\n         */\r\n        commitGridAction: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"COMMIT\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending rollback request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-commit-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"COMMIT\"\r\n            });\r\n        },\r\n        /*\r\n         *   Commit an add or edit request for a grid\r\n         */\r\n        sendCheckpointAction: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"CHECKPOINT\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending checkpoint request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-checkpoint-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"CHECKPOINT\"\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Validate if url has 'http' string, in that case is not necesary add the pathToBase prefix\r\n         */\r\n        verifyMobilePathToBase: function(pathToBase, url) {\r\n            return bizagi.util.isMashupContext() ? (url || \"\").replaceAll(pathToBase, \"\"): url;                \r\n        }\r\n\r\n    });\r\n","/*\r\n*   Name: Bizagi Rendering Services\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This class will provide a facade to access to workportal REST services\r\n*/\r\n\r\nbizagi.render.services.service.extend(\"bizagi.render.services.service\", {},\r\n{\r\n    /* \r\n     *   Constructor\r\n     */\r\n    init: function(params) {\r\n        // Call base\r\n        var self = this;\r\n\r\n        self._super(params);\r\n        self.database = params.database;\r\n    },\r\n\r\n    getFormData: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            if (bizagi.util.isNativePluginSupported() && typeof(bizagiapp.getNativeFormData) !== \"undefined\") {\r\n                return self.getFormDataFromNative(params)\r\n                    .then(function(result) {\r\n                        return self.database.mergeForm(result[1], result[0].data);\r\n                    });\r\n\r\n            } else {\r\n                if(params.offlineType === 'task'){\r\n                    //It is not a start event\r\n                    if(params.isEdited || !params.isOpen){\r\n                        var def = new $.Deferred();\r\n                        $.when(self.database.getTaskData(params)).then(function(formData){\r\n                            \r\n                            var formPromise = self.database.getTaskForm(params)\r\n                            $.when(self.database.mergeDataDocument(formData.data, null, formPromise)).done(function(complexData){\r\n                                var object = {\r\n                                    data: complexData, \r\n                                    isOpen: params.isOpen\r\n                                };\r\n                                self.database.mergeForm(object, formPromise).then(function(mergedForm){\r\n                                    def.resolve(mergedForm);\r\n                                });\r\n                            });\r\n    \r\n                        });\r\n                        return def.promise();\r\n                    }\r\n                    else\r\n                        return self.database.getTaskForm(params);\r\n                }\r\n                else {\r\n                    return $.when(self.database.getCase(params.idCase))\r\n                    .then(function(response) {\r\n                        var idWfClass = $.trim(response.idWfClass.toString());\r\n                        return self.database.mergeForm(response, self.database.getFormData(idWfClass));\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    getOfflineImage: function(params, fileType){\r\n        if(params.offlineType === \"task\")\r\n            return this.database.getActivityImage(params, fileType);\r\n        else\r\n            return this.database.getStartDataImage(params, fileType);\r\n    },\r\n\r\n    getOfflineActivityDataImage: function(params, fileFormat){\r\n        return this.database.getActivityDataImage(params, fileFormat);\r\n    },\r\n\r\n    saveOfflineImage: function(params, image){\r\n        if (params.operationType === \"synchronization\")\r\n            return this.database.saveActivityFormImage(params, image);\r\n        else if (params.operationType === \"edition\"){\r\n            if(params.offlineType === \"task\")\r\n                return this.database.saveActivityDataImage(params, image);\r\n            else\r\n                return this.database.saveStartDataImage(params, image);\r\n        }\r\n        else \r\n            return null;\r\n    },\r\n\r\n    saveOfflineFile: function(params, file, mimeType){\r\n        if (params.operationType === \"synchronization\")\r\n            return this.database.saveActivityFormFile(params, file, mimeType);\r\n        else if (params.operationType === \"edition\"){\r\n            if(params.offlineType === \"task\")\r\n                return this.database.saveActivityDataFile(params, file, mimeType);\r\n            else\r\n                return this.database.saveStartDataFile(params, file, mimeType);\r\n        }\r\n        else \r\n            return null;\r\n    },\r\n\r\n    getOfflineFile: function(params, fileType, mimeType){\r\n        if(params.offlineType === \"task\")\r\n            return this.database.getActivityFile(params, fileType, mimeType);\r\n        else\r\n            return this.database.getStartDataFile(params, fileType, mimeType);\r\n    },\r\n\r\n    getOfflineActivityDataFile: function(params, fileType, mimeType){\r\n        return this.database.getActivityDataFile(params, fileType, mimeType);\r\n    },\r\n\r\n    getFormDataFromNative: function(params) {\r\n        var def = new $.Deferred();\r\n\r\n        bizagiapp.getNativeFormData(params, function(form) {\r\n\r\n            bizagiapp.getCase(params.idCase, function(caseInfo) {\r\n\r\n                var result = [JSON.parse(form), JSON.parse(caseInfo)];\r\n\r\n                def.resolve(result);\r\n\r\n            }, function(error) {\r\n\r\n                def.reject(error);\r\n\r\n            });\r\n\r\n\r\n        }, function(error) {\r\n            def.reject(error);\r\n        })\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    submitData: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            var data = self.resolveData(params.data || {}, params.xpathContext);\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = params.action;\r\n\r\n            if (bizagi.util.isNativePluginSupported() && typeof (bizagiapp.getNativeFormData) !== \"undefined\") {\r\n                return self.saveNativeFormInfo(params, data);\r\n            }\r\n\r\n            if(params.offlineType === 'task'){\r\n                return self.database.saveTaskData(params,data);                 \r\n            }\r\n            else{\r\n                return self.database.saveStartData(params, data);   \r\n            }\r\n            \r\n        }\r\n    },\r\n\r\n    saveNativeFormInfo: function(params, data) {\r\n        var self = this;\r\n\r\n        var def = new $.Deferred();\r\n\r\n        self.getFormDataFromNative(params).then(function(result) {\r\n            return self.database.nativesaveStartData(data, result[1], result[0].data)\r\n                .done(function(doc) {\r\n                    bizagiapp.saveFormData(params, doc);\r\n                    def.resolve(doc);\r\n                });\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra\r\n *   Comments:\r\n *   -   This class will provide a facade to access to multiaction rendering REST services\r\n */\r\n$.Class.extend(\"bizagi.render.services.multiactionservice\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    BA_PAGE_CACHE: \"pageCacheId\"\r\n}, {\r\n\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (service) {\r\n        this.service = service;\r\n        this.serviceLocator = service.serviceLocator;\r\n\r\n        // Multiaction - batch stuff\r\n        this.batch = {};\r\n        this.batchTimer = 50;\r\n        this.circularDependencies = new bizagi.circularDependencies();\r\n\r\n        // Create proxyed version of methods\r\n        this.replicateServiceMethods();\r\n    },\r\n\r\n    /*\r\n    *   Returns the internal service\r\n    */\r\n    getService: function () {\r\n        return this.service;\r\n    },\r\n\r\n    /*\r\n    *   Create a proxied multiaction version for service calls\r\n    */\r\n    replicateServiceMethods: function () {\r\n        var self = this;\r\n        for (var key in this.service.Class.prototype) {\r\n            // Omit the folowing methods\r\n            if (key == \"init\" || key == \"constructor\" || key == \"Class\" || key == \"multiaction\") continue;\r\n\r\n            // Replicate instance methods\r\n            self[key] = eval('var tmp = function(){ return this.proxyMethod(this.getService().' + key + ', arguments);};tmp');\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Perform the proxy call for each service method\r\n    */\r\n    proxyMethod: function (method, arguments) {\r\n        var service = this.service;\r\n\r\n        // Check if has only one argument, else execute directly\r\n        if (!arguments || arguments.length != 1) {\r\n            return method.apply(service, arguments);\r\n        }\r\n\r\n        // Check if the argument is object, else execute directly\r\n        if (typeof (arguments[0]) != \"object\") {\r\n            return method.apply(service, arguments);\r\n        }\r\n\r\n        var params = arguments[0];\r\n\r\n        // If the caller is requesting a prepare call, just execute the method with the current arguments\r\n        if (params.prepare == true) return method.apply(service, arguments);\r\n\r\n        // Prepare the ajax instead of sending it\r\n        params.prepare = true;\r\n        var action = method.apply(service, arguments);\r\n\r\n        return this.add(action);\r\n    },\r\n\r\n    /**\r\n    * This method make a standard error message\r\n    */\r\n    makeCircularDependenciesError: function (error) {\r\n        var messageTmpl = bizagi.localization.getResource(\"render-actions-loop-validation\");\r\n\r\n        return printf(messageTmpl, error.dependencyFrom, error.dependencyTo);\r\n    },\r\n\r\n\r\n    /*\r\n    *   Add an action to be performed in a multiaction, and be resolved later\r\n    *   returns a deferred\r\n    */\r\n    add: function (action) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n\r\n        var name = action.h_action || \"unnamed\";\r\n\r\n        // Put here all actions to ignore in circular dependencies\r\n        var exceptionActions = [\"PROCESSPROPERTYVALUE\", \"LOADTEMPLATE\", \"ADDRELATIONWITHDATA\"];\r\n\r\n        if (exceptionActions.indexOf(name) < 0 && bizagi.override.detectCircularDependencies) {\r\n            self.circularDependencies.addNode(name, action);\r\n        }\r\n\r\n        // First clear previous timeout\r\n        clearTimeout(self.batchTimeout);\r\n        var tag = action.tag = Math.guid();\r\n        var singleAction = { action: action, deferred: deferred };\r\n        self.batch[tag] = singleAction;\r\n\r\n        // Start a new timeout\r\n        self.batchTimeout = setTimeout(function () {\r\n            var resolveDependencies = self.circularDependencies.resolve();\r\n\r\n            if (resolveDependencies.error) {\r\n                // Reset Queue\r\n                for (var i in self.batch) {\r\n                    var message = resolveDependencies.error.multiactionError;\r\n                    self.batch[i].deferred.reject(message);\r\n                }\r\n                self.batch = {};\r\n            } else {\r\n                self.fire();\r\n            }\r\n        }, self.batchTimer);\r\n\r\n        return deferred.promise();\r\n    },\r\n    /*\r\n    *   Fires up the multiaction\r\n    */\r\n    fire: function () {\r\n        var self = this;\r\n        var batch = {};\r\n\r\n        // Prepare actions and clone batch manually\r\n        var actions = [];\r\n        $.each(self.batch, function (tag, item) {\r\n            actions.push(item.action);\r\n            batch[tag] = item;\r\n        });\r\n\r\n        // Reset batch\r\n        self.batch = {};\r\n\r\n        // Fire ajax \r\n        $.when(self.execute({ actions: actions, rejectDeferreds: false }))\r\n                .done(function (responses) {\r\n\r\n                    // Process each response\r\n                    $.each(responses, function (i, response) {\r\n                        var tag = response.tag;\r\n                        if (!response.error) {\r\n                            batch[tag].deferred.resolve(response.result);\r\n                        } else {\r\n                            batch[tag].deferred.reject(response.error, response, response.error.message);\r\n                        }\r\n\r\n                        // Remove paired tag from collection\r\n                        delete batch[tag];\r\n                    });\r\n\r\n                    // Check if there are unpaired actions so we need to trigger fail deferred\r\n                    $.each(batch, function (i, item) {\r\n                        item.deferred.reject({ type: \"not-processed\", message: \"Operation didn't executed\" }, '', \"Operation didn't executed\");\r\n                    });\r\n                }).fail(function (xhr, type, error) {\r\n\r\n                    // Check if there are unpaired actions so we need to trigger fail deferred\r\n                    var errorMessage = typeof (error) !== \"undefined\" ? error.message : (error || \"Operation didn't executed\");\r\n                    $.each(batch, function (i, item) {\r\n                        item.deferred.reject({ type: \"not-processed\", message: errorMessage }, '', \"Operation didn't executed\");\r\n                    });\r\n                });\r\n    },\r\n    /*\r\n    *   Sends a multiaction to the server\r\n    */\r\n    execute: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        var rejectDeferreds = params.rejectDeferreds !== undefined ? params.rejectDeferreds : true;\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"multiaction\";\r\n\r\n        // Check action tag\r\n        $.each(params.actions, function (i, action) {\r\n            action[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"tag\"] = action.tag || i;\r\n            delete action.tag;\r\n        });\r\n\r\n        // Fill optional parameters\r\n        params = params || {};\r\n        if (params.actions) {\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"actions\"] = JSON.encode(params.actions);\r\n        }\r\n\r\n        // Log submit data\r\n        bizagi.debug(\"Performing multi-action\", data);\r\n\r\n        // Call ajax and returns promise\r\n        var deferred = new $.Deferred();\r\n        $.ajax({\r\n            url: self.serviceLocator.getUrl(\"render-multiaction\"),\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\",\r\n            serviceType: \"MULTIACTION\",\r\n            beforeSend: function (xhr, status) {\r\n                bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                bizagi.multiactionConnection.push(xhr);\r\n            }\r\n\r\n        }).done(function (responses) {\r\n            for (i in responses) {\r\n                if (typeof responses[i] !== \"function\") {\r\n                    var response = responses[i];\r\n                    if (response.error) {\r\n                        if (rejectDeferreds) {\r\n                            deferred.reject(this, \"servererror\", response);\r\n                            return;\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n            deferred.resolve(responses);\r\n\r\n        }).fail(function (xhr) {\r\n            var response = xhr.responseText || xhr;\r\n            var finalResponse;\r\n            // Try to parse the response\r\n            try {\r\n                finalResponse = JSON.parse(response);\r\n            } catch (e) { }\r\n            deferred.reject(xhr, \"servererror\", finalResponse);\r\n        });\r\n\r\n        return deferred.promise();\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Einer Perez\r\n *   Comments:\r\n *   -   This class will provide a facade to access to multiaction rendering REST services\r\n */\r\nbizagi.render.services.multiactionservice.extend(\"bizagi.render.services.metadatamultiactionservice\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    BA_PAGE_CACHE: \"h_pageCacheId\"\r\n}, {\r\n\r\n    /*\r\n    *   Sends a multiaction to the server\r\n    */\r\n    execute: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        var rejectDeferreds = params.rejectDeferreds !== undefined ? params.rejectDeferreds : true;\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"multiaction\";\r\n\r\n        // Check action tag\r\n        $.each(params.actions, function (i, action) {\r\n            action[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"tag\"] = action.tag || i;\r\n            if (action[self.Class.BA_PAGE_CACHE]) {\r\n                data[self.Class.BA_PAGE_CACHE] = action[self.Class.BA_PAGE_CACHE];\r\n            }\r\n            delete action[self.Class.BA_PAGE_CACHE];\r\n            delete action.tag;\r\n        });\r\n\r\n        // Fill optional parameters\r\n        params = params || {};\r\n        if (params.actions) {\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"actions\"] = JSON.encode(params.actions);\r\n        }\r\n\r\n        // Log submit data\r\n        bizagi.debug(\"Performing multi-action metadata\", data);\r\n\r\n        // Call ajax and returns promise\r\n        var deferred = new $.Deferred();\r\n        $.ajax({\r\n            url: self.serviceLocator.getUrl(\"render-multiaction-metadata\"),\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\",\r\n            serviceType: \"MULTIACTION\",\r\n            beforeSend: function (xhr, status) {\r\n                bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                bizagi.multiactionConnection.push(xhr);\r\n            }\r\n\r\n        }).done(function (responses) {\r\n            for (i in responses) {\r\n                if (typeof responses[i] !== \"function\") {\r\n                    var response = responses[i];\r\n                    if (response.error) {\r\n                        if (rejectDeferreds) {\r\n                            deferred.reject(this, \"servererror\", response);\r\n                            return;\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n            deferred.resolve(responses);\r\n\r\n        }).fail(function (xhr) {\r\n            var response = xhr.responseText || xhr;\r\n            var finalResponse;\r\n            // Try to parse the response\r\n            try {\r\n                finalResponse = JSON.parse(response);\r\n            } catch (e) { }\r\n            deferred.reject(xhr, \"servererror\", finalResponse);\r\n        });\r\n\r\n        return deferred.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: Ricardo Perez\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n//$.Class.extend\r\n$.Class(\"bizagi.workportal.services.db\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function() {\r\n        var self = this;\r\n\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? (\"\" + BIZAGI_USER + \"-\" + BIZAGI_PROXY_PREFIX + \"-\" + BIZAGI_DOMAIN).toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n\r\n        if (!self.disabledb) {\r\n            self.createDatabases();\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Delete all Documents (databases)\r\n    * Example for callback : function (err, info) { }\r\n    * \r\n    */\r\n    _destroy: function(callback) {\r\n        this.deleteDatabases(callback);\r\n    },\r\n\r\n    createDatabases: function(){\r\n        var self = this;\r\n        var globalIdHash = self.globalId.hashCode();\r\n        \r\n        self.dbRecentProcesses = new PouchDB(\"RecentProcesses\" + globalIdHash, { auto_compaction: true }); // Recent process\r\n        self.dbProcessesHierarchy =  new PouchDB(\"ProcessesHierarchy\" + globalIdHash, { auto_compaction: true }); // Process hierarchy to new cases creation\r\n        self.dbStartForms =  new PouchDB(\"StartForms\" + globalIdHash, { auto_compaction: true } ); // To save all forms for server\r\n        self.dbStartData =  new PouchDB(\"StartData\" + globalIdHash, { auto_compaction: true } ); // Save the data from forms    \r\n\r\n        //Offline forms in whole process\r\n        self.dbActivities = new PouchDB(\"Activities\" + globalIdHash, { auto_compaction: true } ); // Save the offline tasks that can be worked with offline forms\r\n        self.dbActivityForms = new PouchDB(\"ActivityForms\" + globalIdHash, { auto_compaction: true } ); \r\n        self.dbActivityData = new PouchDB(\"ActivityData\" + globalIdHash, { auto_compaction: true } ); // Cases in outbox that will be advanced\r\n    },\r\n\r\n    deleteDatabases: function(callback){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n\r\n        var databases = [\r\n            self.dbRecentProcesses,\r\n            self.dbProcessesHierarchy,\r\n            self.dbStartForms,\r\n            self.dbStartData,\r\n            self.dbActivities,\r\n            self.dbActivityForms,\r\n            self.dbActivityData\r\n        ]\r\n        \r\n        var databasesDeleted = 0;\r\n        if (typeof callback === \"undefined\") {\r\n            callback = function(err, info) {\r\n                if(err){\r\n                    def.reject(err);\r\n                }\r\n                else{\r\n                    databasesDeleted++;\r\n                    if(databasesDeleted == databases.length){\r\n                        def.resolve(\"All db deleted successfully\");\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        \r\n        databases.forEach(function(database){\r\n            database.destroy(callback);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    restartDatabases: function(){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.deleteDatabases())\r\n        .done( function(){\r\n            self.createDatabases();\r\n            def.resolve();\r\n        })\r\n        .fail( function(){\r\n            self.createDatabases();\r\n            def.resolve();\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n        return objects;\r\n    },\r\n\r\n    /*\r\n    *   This method return all the open cases for the user authenticated from de DB\r\n    *   Returns a promise\r\n    */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbStartData.query({ map: map }, { reduce: false }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\nvar STOREOBJECTNAME = \"offlineTasks\";\r\nbizagi.workportal.services.db.extend(\"bizagi.workportal.services.db\", {}, {\r\n\r\n    /**\r\n     * This method create a new case in the db to offline status\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n        var idWfClass = params.idWfClass,\r\n            id = new Date().toISOString(),\r\n            def = new $.Deferred();\r\n\r\n        var offlineCase = {\r\n            _id: id,\r\n            idWfClass: idWfClass.toString(),\r\n            idWorkFlow: idWfClass.toString(),\r\n            idCase: id,\r\n            isFavorite: false,\r\n            globalId: self.globalId,\r\n            createdBy: {\r\n                Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n            },\r\n            creationDate: new Date(),\r\n            process: params.process || \"Offline\",\r\n            categoryName: params.process || params.categoryName || \"Offline\",\r\n            displayName: params.displayName || \"Offline\",\r\n            radNumber: id,\r\n            // closed: false,\r\n            isOfflineForm: true,\r\n            formsRenderVersion: 2,\r\n            isOpen: true,\r\n            workItems: [\r\n                {\r\n                    idWorkItem: bizagi.util.uniqueID(),\r\n                    idTask: bizagi.util.uniqueID(),\r\n                    idCase: id,\r\n                    colorState: \"Green\",\r\n                    State: \"Green\",\r\n                    TaskName: params.process || \"Offline\"\r\n                }\r\n            ]\r\n        };\r\n\r\n        self.dbStartData.put(offlineCase, function callback(err, result) {\r\n            if (!err) {\r\n                def.resolve(offlineCase);\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Delete case\r\n     * @param {} params \r\n     * @returns {} promise \r\n     */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbStartData.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                self.dbStartData.remove(doc, function(error, response) {\r\n                    if (!error) {\r\n                        def.resolve(response);\r\n                    } else {\r\n                        bizagi.log(\"Error erasing case\");\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                bizagi.log(\"Error, the case do not exist\");\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this,\r\n            def = new $.Deferred();\r\n\r\n        if(params.fromWorkItemId){\r\n            var doc = {\r\n                workItems: [params.fromWorkItemId]}\r\n            def.resolve(doc);\r\n        }\r\n        else{\r\n        self.dbStartData.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                def.resolve(doc);\r\n            } else {\r\n\r\n                def.reject(err);\r\n            }\r\n        });\r\n        }\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the categories as the services if exists in the database\r\n     * @param {} data \r\n     * @returns {} promise\r\n     */\r\n    getCategories: function(data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (!data.enableOfflineForm) {\r\n            def.resolve({});\r\n        }\r\n        else{\r\n            var db = self.dbProcessesHierarchy;\r\n            $.when(bizagi.util.db.getDocument(db, self.globalId))\r\n            .then(function( processesHierarchyDoc ){\r\n                self.categories = processesHierarchyDoc.doc;\r\n                if (data.idApp || data.idCategory) {\r\n                    var groupCategory = getGroup(self.categories, data);\r\n                    def.resolve({\r\n                        category: groupCategory,\r\n                        totalApps: (data.idApp ? groupCategory.length : 0)\r\n                    });\r\n                } else {\r\n                    var tempCategories = self.categories;\r\n                    while (tempCategories.length == 1\r\n                        && (tempCategories[0].categories || tempCategories[0].subCategories)) {\r\n                        tempCategories = getGroup(\r\n                            tempCategories,\r\n                            tempCategories[0].appId ? { idApp: tempCategories[0].appId }\r\n                            : { idCategory: tempCategories[0].idCategory }\r\n                        );\r\n                    }\r\n\r\n                    def.resolve({\r\n                        category: tempCategories,\r\n                        totalApps: (tempCategories[0] && tempCategories[0].appId ? tempCategories.length : 0)\r\n                    });\r\n                }\r\n            })\r\n            .fail( function(){ //Document not found\r\n                def.resolve({\r\n                    category: [],\r\n                    totalApps: 0\r\n                });\r\n            });\r\n        }\r\n        return def.promise();\r\n\r\n        /**\r\n         * Get the group for new cases similar to service \r\n         * @param {} categories \r\n         * @param {} data \r\n         * @returns {} \r\n         */\r\n        function getGroup(categories, data) {\r\n            for (var i = 0, len = categories.length; i < len; i++) {\r\n                if (categories[i].appId && categories[i].appId == data.idApp) {\r\n                    return categories[i].categories;\r\n                }\r\n                if (categories[i].idCategory && categories[i].idCategory == data.idCategory) {\r\n                    return categories[i].subCategories;\r\n                } else {\r\n                    if (categories[i].categories) {\r\n                        var cat = getGroup(categories[i].categories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n\r\n                    if (categories[i].subCategories) {\r\n                        var cat = getGroup(categories[i].subCategories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This method return all the open cases for the user authenticated from de DB\r\n     * @returns {} promise\r\n     */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbStartData.query({\r\n            map: map\r\n        }, {\r\n            reduce: false\r\n        }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get case by id\r\n     * @param {} idCase \r\n     * @returns {} \r\n     */\r\n    getCase: function(idCase) {\r\n        var self = this;\r\n        var db = self.dbStartData;\r\n        return bizagi.util.db.getDocument(db, idCase);\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            params[\"radNumber\"] = params.radnumber ? params.radnumber : params.radNumber;\r\n        }\r\n\r\n        if (params.idcase || params.idCase) {\r\n            params[\"radNumber\"] = params.idcase ? params.idcase : params.idCase;\r\n        }\r\n\r\n        self.dbStartData.allDocs({\r\n            include_docs: true\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].id,\r\n                            idWFClass: resp.rows[i].idWFClass,\r\n                            idWorkFlow: resp.rows[i].id,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isOfflineForm: true,\r\n                            syncStatus: resp.rows[i].syncStatus,\r\n                            fields: [\r\n                                {\r\n                                    Value: resp.rows[i].value.process,\r\n                                    DisplayName: resp.rows[i].value.process,\r\n                                    DataType: \"VarChar\",\r\n                                    isRadNumber: false\r\n                                }, {\r\n                                    Value: resp.rows[i].value.creationDate,\r\n                                    DisplayName: \"Process creation date\",\r\n                                    DataType: \"DateTime\",\r\n                                    isRadNumber: false\r\n                                }\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local data base\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getAllProcesses: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (typeof (params.inputtray) === \"undefined\") {\r\n            params.inputtray = true;\r\n        }\r\n\r\n        // params.inputtry: draft | outbox | inbox disable\r\n        var response = {\r\n            \"workflows\": {\r\n                \"taskstate\": \"\",\r\n                \"workflow\": []\r\n            }\r\n        };\r\n\r\n        //Reduce and rereduce functions search in http://docs.couchdb.org/en/latest/ddocs.html#view-functions\r\n        var queryFun = {\r\n            map: function(doc) {//Trae los documentos del usuario segun el filtro de all, o si estan en favorites etc\r\n                if (doc.idWfClass) {\r\n                    emit({\r\n                        idWf: doc.idWfClass,\r\n                        isOpen: doc.isOpen.toString()\r\n                    }, 1);\r\n                }\r\n            },\r\n            reduce: \"_count\"\r\n        };\r\n\r\n        self.dbProcessesHierarchy.get(self.globalId, function(err, doc) {\r\n            if (!err) {\r\n\r\n                self.dbStartData.query(queryFun, {\r\n                    reduce: true\r\n                }, function(error, resp) {\r\n                    if (!error) {\r\n                        for (var i = 0, len = resp.rows.length; i < len; i++) {\r\n                            if (resp.rows[i].key.isOpen == params.inputtray.toString()) {\r\n                                // Revisar si es necesario agregar aqui el parametro\r\n                                var cat = self.getHierarchyObjects(doc, \"idCategory\", resp.rows[i].key.idWf);\r\n                                response.isOpen = params.inputtray;\r\n                                response.workflows.workflow.push({\r\n                                    category: \"Offline Procesess\",\r\n                                    name: cat[0] ? cat[0].categoryName : \"\",\r\n                                    idworkflow: resp.rows[i].key.idWf,\r\n                                    count: resp.rows[i].value,\r\n                                    isFavorite: false\r\n                                });\r\n                            }\r\n                        };\r\n                        def.resolve(JSON.stringify(response));\r\n                    } else {\r\n                        def.reject(\"error\");\r\n                    }\r\n                });\r\n            } else {\r\n                def.reject(\"error\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxCases: function() {\r\n        // body\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var isOpen = false;\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                // Get the user documents according to filter all, or if its are in favorites etc.\r\n                emit(doc.isOpen,doc);\r\n                \r\n            }\r\n        };\r\n\r\n        self.dbStartData.query(queryFun, {\r\n                reduce: false,\r\n                key: isOpen\r\n            },\r\n            function(err, doc) {\r\n                if (!err) {\r\n                    def.resolve(doc);\r\n                } else {\r\n                    bizagi.log(\"Error loading data before syncronization\");\r\n                    def.reject(err);\r\n                }\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxTaskCases: function(){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        self.dbActivityData.allDocs({include_docs:true}, function(err, resp) {\r\n            if (!err){\r\n                def.resolve(resp);\r\n            }\r\n            else\r\n                def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxTaskCasesFilteredBySyncStatus: function(pSyncStatus, includeDocs){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        pSyncStatus = pSyncStatus || \"none\";\r\n        var queryMap = {\r\n            map: function filterCaseBySyncStatus(doc, emit){\r\n                var emitValue = doc.syncStatus;\r\n                if( (pSyncStatus === \"any\" && emitValue) || (pSyncStatus === \"none\" && !emitValue) ){\r\n                    emitValue = pSyncStatus;\r\n                }\r\n                emit(emitValue);\r\n            }\r\n        };\r\n        \r\n\r\n        var filterParameters = {\r\n            key: pSyncStatus,\r\n            include_docs: includeDocs == true\r\n        }\r\n        self.dbActivityData.query(queryMap, filterParameters, function( error, result){\r\n            if(error){\r\n                def.reject(error);\r\n            }\r\n            else {\r\n                def.resolve(result.rows);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    existantCase: function(params, data) {\r\n        var self = this;\r\n        var idWfClass = params.idWfClass,\r\n            id = params.idCase + \"-\" + params.idWorkitem;\r\n\r\n        return offlineCase = {\r\n            _id: id,\r\n            idCase: id,\r\n            isFavorite: false,\r\n            globalId: self.globalId,\r\n            createdBy: {\r\n                Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n            },\r\n            creationDate: new Date(),\r\n            process: params.process || \"Offline\",\r\n            categoryName: params.process || params.categoryName || \"Offline\",\r\n            displayName: params.displayName || \"Offline\",\r\n            radNumber: id,\r\n            // closed: false,\r\n            isOfflineForm: true,\r\n            formsRenderVersion: 2,\r\n            isOpen: true,\r\n            workItems: [\r\n                {\r\n                    idWorkItem: bizagi.util.uniqueID(),\r\n                    idTask: bizagi.util.uniqueID(),\r\n                    idCase: id,\r\n                    colorState: \"Green\",\r\n                    State: \"Green\",\r\n                    TaskName: params.process || \"Offline\"\r\n                }\r\n            ]\r\n        };\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {}  Returns a promise\r\n     *  Struct: [\r\n     *   idCase, idWorkItem, idTask,\r\n     *   dueDate, processName, activityName,\r\n     *   customzedColumns: [key, value],\r\n     *   isOfflineForm, isOpen\r\n     * ]\r\n     */\r\n    getCasesList: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"page\": 1,\r\n            \"totalPages\": 1,\r\n            \"elements\": []\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"drafts\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.isOpen, doc);\r\n            }\r\n        };\r\n\r\n        self.dbStartData.query(queryFun, {\r\n            reduce: false,\r\n            key: isOpen\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.rows.length; i < len; i++) {\r\n                    if (typeof params.radNumber === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || resp.rows[i].value.radNumber.toString().indexOf(params.radNumber.toString()) != -1) {\r\n\r\n                        var localCase = [\r\n                            resp.rows[i].value.idCase,\r\n                            resp.rows[i].value.workItems[0][\"idWorkItem\"][0] || \"\",\r\n                            resp.rows[i].value.workItems[0][\"idTask\"][0] || \"\",\r\n                            resp.rows[i].value.creationDate,\r\n                            resp.rows[i].value.categoryName,\r\n                            resp.rows[i].value.displayName,\r\n                            [\r\n                                [\"Case No\", resp.rows[i].value.idCase],\r\n                                [\"Process\", resp.rows[i].value.process],\r\n                                [\"Process creation date\", bizagi.util.formatDateTime(resp.rows[i].value.creationDate)]\r\n                            ],\r\n                            resp.rows[i].value.isOfflineForm,\r\n                            resp.rows[i].value.isOpen\r\n                        ];\r\n                        localCase.syncStatus = resp.rows[i].value.syncStatus;\r\n                        cases.elements.push(localCase);\r\n                    }\r\n                }\r\n                def.resolve(cases);\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /*\r\n    *   This method return the cases created offline by idWorkflow\r\n    *   Returns a promise\r\n    */\r\n    getCustomizedColumnsNewData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.isOpen, doc);\r\n            }\r\n        };\r\n\r\n        self.dbStartData.query(queryFun, {\r\n            reduce: false,\r\n            key: isOpen\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.rows.length; i < len; i++) {\r\n                    if ( (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].value.idCase,\r\n                            idWFClass: resp.rows[i].value.idWfClass,\r\n                            idWorkFlow: resp.rows[i].value.idWorkFlow,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isAborted: false,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                resp.rows[i].value.idCase,\r\n                                resp.rows[i].value.process,\r\n                                {\r\n                                    \"workitems\": resp.rows[i].value.workItems\r\n                                },\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate),\r\n                                \"\",\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate)\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get recent processes\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n        var db = self.dbRecentProcesses;\r\n        $.when(bizagi.util.db.getDocument(db, self.globalId))\r\n        .then( function(recentProcesses){\r\n            deferred.resolve(recentProcesses);\r\n        })\r\n        .fail( function(error){\r\n            var emptyRecents = { \"processes\": [] };\r\n            deferred.resolve(emptyRecents);\r\n        })\r\n        return deferred.promise();\r\n    },\r\n    /**\r\n     * Save all the work items as a single object\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    saveOfflineTasks: function(tasksMap) {           \r\n        var self = this;\r\n        var saveQueue  = new bizagiQueue();\r\n        for( i in tasksMap) {\r\n            var currentTask = tasksMap[i];\r\n            var idWfClass = currentTask[10],\r\n            id = currentTask[0]+'-'+currentTask[1];\r\n\r\n            var offlineCase = {\r\n                _id: id,\r\n                endDate: currentTask.endDate,\r\n                group: currentTask.group,\r\n                icon: currentTask.icon,\r\n                state: currentTask.state,\r\n                taskState: currentTask.taskState,\r\n                shortEndDate: currentTask.shortEndDate,\r\n                atRiskTime: currentTask[11],\r\n                type: currentTask.type,\r\n                idWfClass: idWfClass.toString(),\r\n                idWorkFlow: idWfClass.toString(),\r\n                idCase: currentTask[0],\r\n                isFavorite: currentTask[9],\r\n                isEdited: false,\r\n                createdBy: {\r\n                    Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                    userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n                },\r\n                creationDate: currentTask[12],\r\n                process: currentTask[4],\r\n                categoryName: tasksMap.process || tasksMap.categoryName || \"Offline\",\r\n                displayName: tasksMap.displayName || \"Offline\",\r\n                radNumber: id,\r\n                wfClassDisplayName: \"\",\r\n                // closed: false,\r\n                isOfflineForm: true,\r\n                formsRenderVersion: 2,\r\n                isOpen: true,\r\n                workItems: [\r\n                    {\r\n                        idWorkItem: currentTask[1],\r\n                        idTask: currentTask[2],\r\n                        idCase: currentTask[0],\r\n                        colorState: currentTask.taskstate,\r\n                        State: currentTask.taskstate,\r\n                        TaskName: currentTask[5]\r\n                    }\r\n                ]\r\n            };\r\n            saveQueue.add(self.saveOrUpdateTask(id, offlineCase));\r\n        }\r\n        return saveQueue.execute();\r\n    },\r\n\r\n    saveOrUpdateTask: function( internalTaskId, offlineCase ){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        $.when(bizagi.util.db.getDocument(self.dbActivities, internalTaskId))\r\n        .then( function(currentDocument){\r\n            $.extend(true, currentDocument, offlineCase);\r\n            delete currentDocument.syncStatus;\r\n            return bizagi.util.db.saveDocument(self.dbActivities, currentDocument);\r\n        })\r\n        .then( function(){\r\n            def.resolve();\r\n        })\r\n        .fail( function( err ){\r\n            $.when(bizagi.util.db.saveDocument(self.dbActivities, offlineCase))\r\n            .then( function(){\r\n                def.resolve();\r\n            })\r\n            .fail( function( saveError){\r\n                def.reject(saveError);\r\n            })\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    \r\n\r\n    /**\r\n     * Clean all tasks\r\n     * @returns {} promise \r\n     */\r\n    cleanOfflineTasks: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbActivities.get(STOREOBJECTNAME, function(err, doc) {\r\n            if (!err) {\r\n                self.dbStartData.remove(doc, function(error, response) {\r\n                    if (!error) {\r\n                        def.resolve(response);\r\n                    } else {\r\n                        bizagi.log(\"Error erasing tasks\");\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                bizagi.log(\"Error, no offline tasks\");\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n    /**\r\n     * Get all offline tasks\r\n     * @returns {} promise \r\n     */\r\n    getOfflineCases: function(params) {\r\n        var self = this,\r\n        def = new $.Deferred();\r\n        var cases = {\r\n            \"page\": 1,\r\n            \"totalPages\": 1,\r\n            \"elements\": []\r\n        };\r\n        var isOpen = params.isOpen;\r\n        self.dbActivities.allDocs({include_docs:true}, function(err, resp) {  \r\n            if (!err){\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {   \r\n                    if(resp.rows[i].doc.isOpen == isOpen){\r\n                        var localCase = [\r\n                            resp.rows[i].doc.idCase,\r\n                            resp.rows[i].doc.workItems[0][\"idWorkItem\"] || \"\",\r\n                            resp.rows[i].doc.workItems[0][\"idTask\"] || \"\",\r\n                            resp.rows[i].doc.creationDate,\r\n                            resp.rows[i].doc.process,\r\n                            resp.rows[i].doc.workItems[0][\"TaskName\"],\r\n                            [\r\n                                [\"Case No\", resp.rows[i].doc.idCase],\r\n                                [\"Process\", resp.rows[i].doc.process],\r\n                                [\"Process creation date\", bizagi.util.formatDateTime(resp.rows[i].doc.creationDate)]\r\n                            ],\r\n                            resp.rows[i].doc.isOfflineForm,\r\n                            resp.rows[i].doc.isOpen,\r\n                            resp.rows[i].doc.isFavorite,\r\n                            resp.rows[i].doc.idWfClass,\r\n                            resp.rows[i].doc.atRiskTime,\r\n                            resp.rows[i].doc.creationDate\r\n                        ];\r\n                        localCase.isEdited = resp.rows[i].doc.isEdited; \r\n                        localCase.offlineType = 'task';\r\n                        localCase.endDate = resp.rows[i].doc.endDate;\r\n                        localCase.group = resp.rows[i].doc.group; \r\n                        localCase.icon = resp.rows[i].doc.icon;\r\n                        localCase.shortEndDate = resp.rows[i].doc.shortEndDate;\r\n                        localCase.state = resp.rows[i].doc.state;\r\n                        localCase.taskState = resp.rows[i].doc.taskState;\r\n                        localCase.type = resp.rows[i].doc.type;\r\n                        localCase.wfClassDisplayName = resp.rows[i].doc.wfClassDisplayName;\r\n                        localCase.syncStatus = resp.rows[i].doc.syncStatus;\r\n                        cases.elements.push(localCase);      \r\n                    }\r\n                }\r\n                def.resolve(cases);                \r\n            }                \r\n            else\r\n                def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Returns a map with the local activities in the db\r\n     */\r\n    getLocalActivities: function(){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        self.dbActivities.allDocs({include_docs:true}, function(err, resp) {\r\n            if(err) {\r\n                def.reject();\r\n            }\r\n            else {\r\n                var len = resp.total_rows;\r\n                var activities = {};\r\n                for ( var i = 0; i < len; i++ ) { \r\n                    var currentRow = resp.rows[i].doc;\r\n                    activities[currentRow._id] = currentRow;\r\n                }\r\n                def.resolve(activities);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    updateCaseSyncStatus: function(params){\r\n        \r\n        var self = this;        \r\n        var docId = params.id;\r\n        if(params.type === \"start\") {\r\n            return updateSyncAttribute(self.dbStartData, docId);\r\n        }\r\n        else {\r\n            return updateSyncAttribute(self.dbActivityData, docId)\r\n            .then(function() {\r\n                updateSyncAttribute(self.dbActivities, docId);\r\n            });\r\n        }\r\n                \r\n        function updateSyncAttribute(db,docId) {\r\n        return    $.when(bizagi.util.db.getDocument(db, docId))\r\n                    .then(function(doc){\r\n                        doc.syncStatus = params.syncStatus;\r\n                        if(params.syncDetails){\r\n                            doc.syncDetails = {\r\n                                serverResponse: params.syncDetails,\r\n                                responseTimestamp: Date.now()\r\n                            }\r\n                        }\r\n                        return $.when(bizagi.util.db.saveDocument(db,doc))\r\n                        \r\n                    })\r\n                    .then(function(saveResp){\r\n                        return saveResp\r\n                    });\r\n                    \r\n        }\r\n    },\r\n\r\n    wasActivityWorkedOffline: function(internalId){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when( bizagi.util.db.getDocument(self.dbActivityData, internalId))\r\n        //Data exists, so was worked offline\r\n        .then( function(activityData){\r\n            def.resolve(true);\r\n        })\r\n        //Data doesn't exist, so not was worked offline\r\n        .fail( function(err){\r\n            def.resolve(false);\r\n        })\r\n        return def.promise();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: oscaro\r\n*   Comments:\r\n*   -   This script creates a plugin to handler oll db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\nbizagi.workportal.services.db.extend(\"bizagi.workportal.services.db\", {}, {\r\n\r\n    /**\r\n     * This method return the form for a new case to offline status\r\n     * @param {} idWFClass\r\n     * @returns {} Returns a promise\r\n     */\r\n    getFormData: function(idWFClass) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbStartForms.get(idWFClass, function(err, doc) {\r\n            if (!err) {\r\n                if (typeof (doc.form) !== \"undefined\") {\r\n                    setTimeout(function() {\r\n                        def.resolve({ form: doc.form, type: \"form\" });\r\n                    }, 300);\r\n                } else {\r\n                    var responseText = {\r\n                        errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                        message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")                        \r\n                    };\r\n                    \r\n                    def.reject(JSON.stringify(responseText));\r\n                }\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method merge the form and the data to result form\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    mergeForm: function(doc, form) {\r\n\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        $.when(form).done(function(form) {\r\n            if (!doc.data) {\r\n                def.resolve(form);\r\n            } else {\r\n                // If it case is in outbox or closed, hide buttons in the form\r\n                if (!doc.isOpen) {\r\n                    form.form.buttons = [];\r\n                    if(Object.keys(doc.data).length === 0) {\r\n                        fillForm(form.form.elements, {\r\n                            key: \"«read-only-form»\",\r\n                            value: \"\"\r\n                        });    \r\n                    }\r\n                }\r\n\r\n                for (prop in doc.data) {\r\n                    fillForm(form.form.elements, {\r\n                        key: prop,\r\n                        value: doc.data[prop]\r\n                    });\r\n                }\r\n\r\n                function fillForm(element, data) {\r\n                    if (Array.isArray(element)) {\r\n                        for (var i = 0, len = element.length; i < len; i++) {\r\n                            fillForm(element[i], data);\r\n                        }\r\n                    } else {\r\n                        if (element.container) {\r\n                            fillForm(element.container.elements, data);\r\n                        } else {\r\n                            // If it case is in outbox or closed, make all renders in the form not editable\r\n                            if (!doc.isOpen) {\r\n                                element.render.properties.editable = false;\r\n                            }\r\n\r\n                            if (element.render.properties.xpath == data.key) {\r\n                                if (element.render.properties.type === \"grid\") {\r\n                                    self.setRenderGridValues(element.render);\r\n                                }\r\n                                self.setRenderValues(element.render.properties, data.value);\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n\r\n                def.resolve(form);\r\n            }\r\n        }).fail(function(cause) {\r\n            if (!cause.responseText)\r\n                var responseText = {\r\n                    errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                    message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")\r\n                };\r\n\r\n            cause.responseText = JSON.stringify(responseText);\r\n\r\n            def.reject(cause);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Set render Grid values\r\n     * @param {} render\r\n     * @returns {}\r\n     */\r\n    setRenderGridValues: function(render) {\r\n        render.properties.data.columns = [];\r\n        for (var i = 0, length = render.elements.length; i < length; i++) {\r\n            render.properties.data.columns.push(render.elements[i].render.properties.xpath);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This function sets the type of each xpath\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    setDataType: function(doc, form) {\r\n\r\n    },\r\n\r\n    /**\r\n     *  This method return the categories like the services if exists in the database\r\n     * @param {} params\r\n     * @param {} data\r\n     * @returns {} Returns a promise\r\n     */\r\n    setRenderValues: function(params, data) {\r\n        var type = params.type;\r\n\r\n        if (!type) type = \"label\";\r\n\r\n        var typeGroupBasic = [\"text\", \"label\", \"number\", \"money\", \"date\", \"boolean\", \"geolocation\", \"hidden\", \"upload\"];\r\n        var typeGroupCombo = [\"combo\", \"cascadingCombo\", \"radio\", \"list\"];\r\n\r\n        if (typeGroupBasic.indexOf(type) !== -1) {\r\n            params.value = data.value;\r\n            return;\r\n        }\r\n\r\n        if (typeGroupCombo.indexOf(type) !== -1) {\r\n            for (var i = 0, len = params.data.length; i < len; i++) {\r\n                if (params.data[i].id == data.value) {\r\n                    params.value = [{ id: data.value, value: params.data[i].value }];\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (type === \"search\") {\r\n            for (var j = 0, lengthData = params.data.length; j < lengthData; j++) {\r\n                if (params.data[j].id == data.value.id) {\r\n                    params.value = data.value;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (type === \"image\") {\r\n            params.value = data;\r\n            return;\r\n        }\r\n\r\n        if (type === \"grid\") {\r\n            //New complex object for grids\r\n            params[\"deleted-records\"] = data.value[\"deleted-records\"] ? data.value[\"deleted-records\"] : {};\r\n            data.value = data.value.rows;\r\n            \r\n            params.data.records = data.value.length;\r\n            params.data.total = 1;\r\n            params.data.page = 1;\r\n\r\n            var lengthColumns = params.data.columns.length;\r\n            var tmpEditAndVisible = [];\r\n            var lengthRows = data.value.length;\r\n            params.data.rows = [];\r\n            for (var row = 0; row < lengthRows; row++) {\r\n                // Add random value\r\n                var details = data.value[row].length>lengthColumns ? data.value[row][lengthColumns] : undefined;\r\n                var idRow = details ? details.idRow : bizagi.util.randomNumber(); \r\n                \r\n                var tmpElement = [];\r\n                var tempRow = [];                \r\n                tmpElement[0] = idRow;\r\n\r\n                for (var col = 0; col < lengthColumns; col++) {                    \r\n                    var index = -1;\r\n                    if (data.value[row][col]) {\r\n                        if(data.value[row][col].xpath){\r\n                            index = params.data.columns.indexOf(data.value[row][col].xpath);\r\n                            tempRow[index] = data.value[row][col];    \r\n                        }\r\n                        else if(!data.value[row][col].changes){\r\n                            tempRow[col] = data.value[row][col];\r\n                        }\r\n                    }\r\n                    tempRow[col] = (tempRow[col]) ? tempRow[col] : null;\r\n                    tmpElement[tmpElement.length] = \"true\";\r\n                }\r\n                var mergedRow = $.merge([idRow], tempRow);\r\n                                 \r\n                if(details && details.isNew) {\r\n                    params[\"new-records\"] = params[\"new-records\"] ? params[\"new-records\"] : {};\r\n                    params[\"new-records\"][idRow] = details.changes;\r\n                }\r\n                params.data.rows.push(mergedRow);\r\n                tmpEditAndVisible[tmpEditAndVisible.length] = tmpElement;\r\n            }\r\n\r\n            params.data.editable = tmpEditAndVisible;\r\n            params.data.visible = tmpEditAndVisible;\r\n\r\n            return;\r\n        }\r\n\r\n        // No type supported\r\n        try {\r\n            params.value = data.value;\r\n        } catch (e) {\r\n        }\r\n\r\n        bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * This method simulate a summary response\r\n     * @param {} params\r\n     * @returns {} Returns a promise\r\n     */\r\n    getSummary: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        if(params.offlineType && params.offlineType === \"task\"){\r\n            var activityCaseId = params.idCase + \"-\" + params.idWorkitem;\r\n            self.dbActivities.get(activityCaseId, function(err, doc) {\r\n                if (!err)\r\n                    def.resolve($.extend(doc, {\r\n                        processPath: \"/\",\r\n                        currentState: doc.workItems,\r\n                        countAssigness: 0,\r\n                        countEvents: 0,\r\n                        isOpen: doc.isOpen.toString(),\r\n                        countSubProcesses: 0\r\n                    }));\r\n                else\r\n                    def.reject(err);\r\n            });\r\n        }\r\n        else {\r\n            self.dbStartData.get(params.idCase, function(err, doc) {\r\n                if (!err)\r\n                    def.resolve($.extend(doc, {\r\n                        processPath: \"/\",\r\n                        currentState: doc.workItems,\r\n                        countAssigness: 0,\r\n                        countEvents: 0,\r\n                        isOpen: doc.isOpen.toString(),\r\n                        countSubProcesses: 0\r\n                    }));\r\n                else\r\n                    def.reject(err);\r\n            });\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save the image as an attachment to the form.\r\n     * This function only is called for store locally images in tasks \r\n     * that already exists in the server. For save new images use the saveActivityDataImage function.\r\n     * @param {*} params \r\n     * @param {*} image The blob corresponding to the image\r\n     */\r\n    saveActivityFormImage: function(params, image){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        var mimeType = \"image/png\";\r\n        return bizagi.util.db.saveAttachment(self.dbActivityForms, documentId, attachmentId, mimeType, image, true);\r\n    },\r\n\r\n    /**\r\n     * Save the image as an attachment to the Activity Data.\r\n     * This function only is called for store images uploaded in offline mode. \r\n     * @param {*} params \r\n     * @param {*} image The blob corresponding to the image\r\n     */\r\n    saveActivityDataImage: function(params, image){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        var mimeType = \"image/png\";\r\n        return bizagi.util.db.saveAttachment(self.dbActivityData, documentId, \r\n            attachmentId, mimeType, image, true);\r\n    },\r\n\r\n    getActivityDataImage: function(params, fileType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        bizagi.util.db.getAttachment(self.dbActivityData,documentId, attachmentId, fileType, \"image/png\",\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    getActivityImage: function(params, fileType){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        if ( params.loadImageFromForm ) {\r\n            bizagi.util.db.getAttachment(self.dbActivityForms, documentId, attachmentId, fileType, undefined, \r\n                function(formImage){\r\n                    if(formImage !== undefined){\r\n                        def.resolve(formImage);\r\n                    }\r\n                    else{\r\n                        def.resolve(\"\");\r\n                    }\r\n                }\r\n            );\r\n        }\r\n        else {\r\n            bizagi.util.db.getAttachment(self.dbActivityData, documentId, attachmentId, fileType, undefined, \r\n                function(dataImage){\r\n                    if(dataImage !== undefined){\r\n                        def.resolve(dataImage);\r\n                    }\r\n                    else{\r\n                        def.resolve(\"\");\r\n                    }\r\n                }\r\n            );\r\n        }\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save the image as an attachment to the Start Form Data.\r\n     * This function only is called for store images uploaded in offline mode. \r\n     * @param {*} params \r\n     * @param {*} image The blob corresponding to the image\r\n     */\r\n    saveStartDataImage: function(params, image){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        var mimeType = \"image/png\";\r\n        return bizagi.util.db.saveAttachment(self.dbStartData, documentId, attachmentId, mimeType, image, true);\r\n    },  \r\n    \r\n    getStartDataImage: function(params, fileType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        bizagi.util.db.getAttachment(self.dbStartData,documentId, attachmentId, fileType, \"image/png\",\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    saveActivityFormFile: function(params, file, mimeType){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        return bizagi.util.db.saveAttachment(self.dbActivityForms, documentId, attachmentId, mimeType, file, true);\r\n    },\r\n\r\n    saveActivityDataFile: function(params, file, mimeType){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        return bizagi.util.db.saveAttachment(self.dbActivityData, documentId, attachmentId, mimeType, file, true);\r\n    },\r\n\r\n    getActivityDataFile: function(params, fileType, mimeType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        bizagi.util.db.getAttachment(self.dbActivityData,documentId, attachmentId, fileType, mimeType,\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    getActivityFile: function(params, fileType, mimeType){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        bizagi.util.db.getAttachment(self.dbActivityData, documentId, attachmentId, fileType, mimeType, \r\n            function(dataResult){\r\n                if(dataResult !== undefined){\r\n                    def.resolve(dataResult);\r\n                }\r\n                else{\r\n                    bizagi.util.db.getAttachment(self.dbActivityForms, documentId, attachmentId, fileType, mimeType, \r\n                        function(formResult){\r\n                            if(formResult !== undefined){\r\n                                def.resolve(formResult);\r\n                            }\r\n                            else{\r\n                                def.resolve(null);\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            } \r\n        );\r\n\r\n        return def.promise();\r\n    },\r\n    \r\n    /**\r\n     * Save the file as an attachment to the Start Form Data.\r\n     * This function only is called for store files uploaded in offline mode. \r\n     * @param {*} params \r\n     * @param {*} file The blob corresponding to the file\r\n     */\r\n    saveStartDataFile: function(params, file, mimeType){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        return bizagi.util.db.saveAttachment(self.dbStartData, documentId, \r\n            attachmentId, mimeType, file, true);\r\n    },\r\n    \r\n    getStartDataFile: function(params, fileType, mimeType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        bizagi.util.db.getAttachment(self.dbStartData,documentId, attachmentId, fileType, mimeType,\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n    \r\n    \r\n    /**\r\n     * Save the form with all xpaths resolved\r\n     * @param {R} params, workitem id, case id\r\n     * @param {*} data: form data\r\n     */\r\n    saveTaskForm: function(params, formData){\r\n        var db = this.dbActivityForms;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        formData._id = documentId;\r\n        formData.dataChangeset = params.dataChangeset;\r\n        return bizagi.util.db.saveDocument(db, formData)\r\n    },\r\n\r\n    getTaskForm: function(params){\r\n        var db = this.dbActivityForms;\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n        var def = new $.Deferred();\r\n        $.when(bizagi.util.db.getDocument(db, docId))\r\n        .then( function(data){\r\n            if(data && data.form){\r\n                def.resolve(data);\r\n            }\r\n            else {\r\n                var responseText = {\r\n                    errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                    message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")     \r\n                } ;                            \r\n                def.reject({responseText: JSON.stringify(responseText)});\r\n            }\r\n        })\r\n        .fail(function(err){\r\n            def.reject(err);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    deleteTaskForm: function(params){\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        var db = this.dbActivityForms;\r\n        return bizagi.util.db.deleteDocument(db, documentId);\r\n    },\r\n\r\n    updateTaskForm: function(params, formData){\r\n        this.saveTaskForm(params, formData);\r\n    },\r\n\r\n    getStartForm: function(params){\r\n        var db = this.dbStartForms;\r\n        var docId = params.idProcess.toString();\r\n        return bizagi.util.db.getDocument(db, docId);\r\n    },\r\n\r\n    saveStartForm: function(params, form){\r\n        var db = this.dbStartForms;\r\n        form._id = params.idProcess;\r\n        return bizagi.util.db.saveDocument(db, form);\r\n    },\r\n\r\n    mergeTaskAction: function( oldAction, newAction ){\r\n        Object.keys(newAction).forEach( function(key){\r\n                oldAction[key] = newAction[key];                        \r\n        } );\r\n        return oldAction;\r\n    },\r\n\r\n    /*\r\n    *   This method save the form data of the created case\r\n    *   Returns a promise\r\n    */\r\n    saveTaskData: function(params, data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n        var db = self.dbActivityData;\r\n        $.when( bizagi.util.db.getDocument(db, docId))\r\n        .then( function(document){  \r\n            var dataUpdated = document.data?\r\n                self.mergeTaskAction(document.data, data) :\r\n                data;\r\n            performSaveTaskData(dataUpdated);\r\n        })\r\n        //First save\r\n        .fail( function(){\r\n            performSaveTaskData(data);\r\n        });\r\n        \r\n        function performSaveTaskData(dataToSave){\r\n            var doc = {\r\n                _id: docId,\r\n                data: dataToSave,\r\n                idForm: params.idForm\r\n            }\r\n            $.when(bizagi.util.db.saveDocument(db, doc))\r\n            .then( function(saveResult){\r\n                var markTaskPromise;\r\n                if(params.action === \"next\"){\r\n                    markTaskPromise = self.closeOfflineTask(params);\r\n                }else if(params.action === \"save\"||params.action===\"SAVE\"){\r\n                    markTaskPromise = self.markTaskEdited(params);\r\n                }\r\n                $.when(markTaskPromise)\r\n                .then( function(markResponse){\r\n                    def.resolve(markResponse);\r\n                })\r\n                .fail( function(markError){\r\n                    def.reject(markError);\r\n                });\r\n            })\r\n            .fail( function(saveError){\r\n                def.reject(saveError);\r\n            });\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    separateComplexControls: function(params, data){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var mergePromise;\r\n        if(params.offlineType && params.offlineType !== \"task\"){\r\n            mergePromise = new $.Deferred(),\r\n            mergePromise.resolve(data);\r\n        }\r\n        else{\r\n            mergePromise = self.mergeDataDocument(data, null, self.getTaskForm(params));\r\n        }\r\n        $.when(mergePromise)\r\n        .done( function(mergeRes){\r\n            var images = [];\r\n            var uploads = [];\r\n            var grids = [];\r\n            Object.keys(mergeRes).forEach(function(key){\r\n                var value = mergeRes[key];\r\n                if(value && value.renderId && value.type && value.type === \"image\"){\r\n                    value.xpath = key;\r\n                    images.push(value);\r\n                    delete data[key];\r\n                }\r\n                else if (value && value.renderId && value.type && value.type === \"upload\"){\r\n                    value.xpath = key;\r\n                    uploads.push(value);\r\n                    delete data[key];\r\n                }\r\n                else if (value && value.renderId && value.type && value.type === \"grid\"){\r\n                    value.xpath = key;\r\n                    grids.push(value);\r\n                    delete data[key];\r\n                }\r\n            });\r\n            def.resolve({\r\n                data: data,\r\n                images: images,\r\n                uploads: uploads,\r\n                grids: grids});\r\n        })\r\n        .fail( function(mergeError){\r\n            def.reject(mergeError);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    markTaskEdited: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var db = self.dbActivities;\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        $.when(bizagi.util.db.getDocument(db, docId))\r\n        .then(function(document){\r\n            document.isEdited = true;\r\n            $.when(bizagi.util.db.saveDocument(db, document))\r\n            .then( function(updateResponse){\r\n                def.resolve(updateResponse);\r\n            })\r\n            .fail( function(updateErr){\r\n                def.reject(updateErr);\r\n            });\r\n        })\r\n        .fail(function(getErr){\r\n            def.reject(getErr);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    closeOfflineTask: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var db = self.dbActivities;\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        $.when(bizagi.util.db.getDocument(db, docId))\r\n        .then(function(document){\r\n            document.isOpen = false;\r\n            $.when(bizagi.util.db.saveDocument(db, document))\r\n            .then( function(updateResponse){\r\n                def.resolve(updateResponse);\r\n            })\r\n            .fail( function(updateErr){\r\n                def.reject(updateErr);\r\n            });\r\n        })\r\n        .fail(function(getErr){\r\n            def.reject(getErr);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    getTaskData: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var id = params.idCase + '-' + params.idWorkitem;\r\n        self.dbActivityData.get(id, function(err, resp) {\r\n            if (!err)\r\n                def.resolve(resp);\r\n            else\r\n                def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    deleteTaskData: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var id = params.idCase + '-' + params.idWorkitem;\r\n        self.dbActivityData.get(id, function(getErr, getResp) {\r\n            if (!getErr){\r\n                self.dbActivityData.remove(getResp, function(err, resp) {\r\n                    if(!err){\r\n                        console.log(\"Case deleted of outbox\", params);\r\n                        def.resolve(resp);\r\n                    }\r\n                    else{\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n            }\r\n            else{\r\n                def.resolve(getErr);\r\n                console.log(\"Case not exists in outbox\", params);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n    \r\n    /*\r\n    *   This method saves the form info in the db\r\n    *   Returns a promise\r\n    */\r\n   saveStartData: function(params, data) {\r\n    var self = this;\r\n    var def = new $.Deferred();\r\n\r\n    self.dbStartData.get(params.idCase, function(err, doc) {\r\n        if (!err) {\r\n            self.mergeDataDocument(data, doc, self.getFormData(doc.idWfClass.toString()))\r\n                .done(function(resp) {\r\n                    doc = self.mergeData(data, doc, resp);\r\n                    if(params.idForm){\r\n                        doc.idForm = params.idForm;\r\n                    }\r\n                    self.dbStartData.put(doc, function(error, response) {\r\n                        if (!error)\r\n                            def.resolve(response);\r\n                        else\r\n                            def.reject(error);\r\n                    });\r\n                })\r\n                .fail( function(mergeError){\r\n                    def.reject(mergeError);\r\n                });\r\n        } else {\r\n            def.reject(err);\r\n        }\r\n    });\r\n\r\n    return def.promise();\r\n    },\r\n\r\n    filterXpathsByType: function(form, type){\r\n        var xpaths = [];\r\n        var elements = form.form.elements;\r\n        extractRenderElements(elements, xpaths);\r\n\r\n        function extractRenderElements(elements, xpaths){\r\n            if(elements){\r\n                for (var i = 0; i < elements.length; i++) {\r\n                    var isContainer = elements[i].container;\r\n                    if( isContainer ){\r\n                        extractRenderElements(elements[i].container.elements, xpaths);\r\n                    }\r\n                    else {\r\n                        extractXpathFromRenderProperties(elements[i].render.properties, xpaths);\r\n                    }\r\n                }\r\n            }            \r\n        }\r\n\r\n        function extractXpathFromRenderProperties(renderProperties, xpaths){ \r\n            if (renderProperties.xpath && renderProperties.type === type) {\r\n                xpaths.push({\r\n                    xpath: renderProperties.xpath,\r\n                    renderId: renderProperties.id,\r\n                    value: renderProperties.value\r\n                });\r\n            }\r\n        }\r\n\r\n        return xpaths;\r\n\r\n    },\r\n\r\n    mergeDataDocument: function(data, doc, form) {\r\n        var defer = new $.Deferred();\r\n        var response = {};\r\n\r\n        $.when(form).done(function(resp) {\r\n\r\n            for (prop in data) {\r\n                if (prop != \"h_action\") {\r\n                    response[prop] = {};\r\n                    response[prop].value = data[prop];\r\n                    fillForm(resp.form.elements, {\r\n                        key: prop,\r\n                        value: data[prop]\r\n                    });\r\n                }\r\n            }\r\n\r\n            function fillForm(element, datafill) {\r\n                if (element.length && element.length > 0) {\r\n                    for (var i = 0, len = element.length; i < len; i++) {\r\n                        fillForm(element[i], datafill);\r\n                    }\r\n                } else {\r\n                    if (element.container) {\r\n                        fillForm(element.container.elements, datafill);\r\n                    } else {\r\n                        if (element.render.properties.xpath == datafill.key) {\r\n                            response[datafill.key].DataType = element.render.properties.dataType || \"\";\r\n                            response[datafill.key].type = element.render.properties.type || \"\";\r\n                            response[datafill.key].renderId = element.render.properties.id;                            \r\n                        }                        \r\n                    }\r\n                }\r\n            }\r\n\r\n            defer.resolve(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    mergeData: function (data, doc, resp) {\r\n\r\n        if (data.h_action == \"next\") {\r\n            doc.isOpen = false;\r\n        }\r\n\r\n        doc.data = doc.data || {};\r\n\r\n        for (var i in resp) {\r\n\r\n            var assigned = false;\r\n\r\n            for (var j in doc.data) {\r\n\r\n                if (i == j) {\r\n\r\n                    if (bizagi.util.isEmpty(resp[i]) || bizagi.util.isEmpty(resp[i].value)) {\r\n                        delete doc.data[j];\r\n                        assigned = true;\r\n                    } else {\r\n                        doc.data[j] = resp[i];\r\n                        assigned = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!assigned) {\r\n                doc.data[i] = resp[i];\r\n            }\r\n        }\r\n\r\n        return doc;\r\n\r\n    },\r\n\r\n    nativeSaveFormInfo: function (data, doc, form) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.mergeDataDocument(data, doc, form)\r\n            .done(function (resp) {\r\n                doc = self.mergeData(data, doc, resp);\r\n                def.resolve(doc);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    deleteNextButton: function(data){\r\n        if(data.form && data.form.buttons){\r\n\r\n            data.form.buttons = data.form.buttons.filter(function(value){\r\n                var properties = value.button.properties;\r\n                if(properties){\r\n                    return !(properties.caption && properties.caption===\"render-form-button-next\");\r\n                }\r\n                return true;\r\n            });\r\n        }\r\n        return data;\r\n    }\r\n\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n$.Class.extend(\"bizagi.workportal.services.pullWorker\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        var queryString = bizagi.readQueryString();\r\n\r\n        self.services = params;\r\n        self.database = params.database;\r\n        \r\n        var querydisable = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n        self.disabledb = querydisable;\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? (\"\" + BIZAGI_USER + \"-\" + BIZAGI_PROXY_PREFIX + \"-\" + BIZAGI_DOMAIN).toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    pull: function() {\r\n        var self = this;\r\n        if (self.disabledb) {\r\n            return false;\r\n        }\r\n        return self.syncOfflineCases();\r\n    },\r\n    \r\n    /**\r\n     * This function send to the server the offline cases created\r\n     * @param {} argument \r\n     * @returns {} \r\n     */\r\n    syncOfflineCases: function(argument) {\r\n        var self = this;\r\n        if (typeof (self.database) !== \"undefined\") {\r\n            self.synchronizing = self.synchronizing || false;\r\n\r\n            if (!self.synchronizing) {\r\n                self.synchronizing = true;\r\n                self.pushInProgressPromise = new $.Deferred();\r\n                var syncCasesQueue = new bizagiQueue();\r\n                var syncStarts = self.syncOfflineStartCases(syncCasesQueue);\r\n                var syncTasks = self.syncOfflineTaskCases(syncCasesQueue);\r\n\r\n                $.when(syncStarts, syncTasks)\r\n                .then( function( startRes, taskRes){\r\n                    return syncCasesQueue.execute();\r\n                })\r\n                .then(function(){\r\n                    self.synchronizing = false;\r\n                    self.pushInProgressPromise.resolve(true);\r\n                })\r\n                .fail( function( queueErr, startErr, taskErr ){\r\n                    console.log(\"Error pushing cases to server with errors\", startErr, taskErr,  queueErr);\r\n                    self.synchronizing = false;\r\n                    self.pushInProgressPromise.reject([queueErr, startErr, taskErr]);\r\n                });\r\n            }\r\n        }\r\n        \r\n        return self.pushInProgressPromise.promise();\r\n    },\r\n\r\n    syncSingleOfflineTaskCase: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.database.getTaskData(params))\r\n        .then( function(taskData){\r\n            var syncCaseParams = {\r\n                idCase: params.idCase,\r\n                idWorkitem: params.idWorkitem,\r\n                data: taskData.data || {},\r\n                type : \"task\",\r\n                id: params.idCase +  \"-\" + params.idWorkitem,\r\n                syncStatus : \"started\"\r\n            }\r\n            return self.generateSyncCasePromise(syncCaseParams);\r\n        })\r\n        .then( function(syncResult){\r\n            def.resolve(syncResult);\r\n        })\r\n        .fail( function(err){\r\n            def.reject(err);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    syncSingleOfflineStartCase: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.database.getCase(params.idCase))\r\n        .then( function(newCase){\r\n            var syncCaseParams = {\r\n                idCase: newCase.idCase,\r\n                data: newCase.data || {},\r\n                idProcess: newCase.idWorkFlow,\r\n                type : \"start\",\r\n                id: newCase.idCase,\r\n                syncStatus : \"started\"\r\n            }\r\n            return self.generateSyncCasePromise(syncCaseParams);\r\n        })\r\n        .then( function(syncResponse){\r\n            def.resolve(syncResponse);\r\n        })\r\n        .fail( function(err){\r\n            def.reject(err);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    syncOfflineStartCases: function(synchCasesQueue){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.database.getOutboxCases())\r\n        .done(function(response) {\r\n            for (var i = 0; i < response.rows.length; i++) {  \r\n                var newCase = response.rows[i].value;\r\n                \r\n                if(newCase.syncStatus){\r\n                    continue;\r\n                }\r\n\r\n                var syncCaseParams = {\r\n                    idCase: newCase.idCase,\r\n                    data: newCase.data || {},\r\n                    idProcess: newCase.idWorkFlow,\r\n                    type : \"start\",\r\n                    id: newCase.idCase,\r\n                    syncStatus : \"started\"\r\n                }                \r\n                \r\n                synchCasesQueue.add(self.generateSyncCasePromise(syncCaseParams));\r\n            }\r\n            def.resolve({\"Start\" : response.rows.length});\r\n        })\r\n        .fail(function(err){\r\n            def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    syncOfflineTaskCases: function(synchCasesQueue){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var syncStatusCriteria = \"none\";\r\n        self.database.getOutboxTaskCasesFilteredBySyncStatus(syncStatusCriteria, true).done(\r\n            function(responses){\r\n                for (var i = 0; i < responses.length; i++) {                      \r\n                    var caseData = responses[i].doc;\r\n                    var itemId = responses[i].id;\r\n                    var id = itemId.split('-');\r\n                    var syncCaseParams = {\r\n                        idCase: id[0],\r\n                        idWorkitem: id[1],\r\n                        data: caseData.data || {},\r\n                        type : \"task\",\r\n                        id: itemId,\r\n                        syncStatus : \"started\"\r\n                    }\r\n                    synchCasesQueue.add(self.generateSyncCasePromise(syncCaseParams));\r\n                }\r\n                def.resolve({\"Tasks\" : responses.length});\r\n            }\r\n        )\r\n        .fail(function(err){\r\n            def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    generateSyncCasePromise: function(syncCaseParams){\r\n        var self = this;\r\n        var syncDeferred = new $.Deferred(); \r\n        if( syncCaseParams.type === \"start\" || (syncCaseParams.data && syncCaseParams.data.h_action)) {               \r\n            $.when(self.database.updateCaseSyncStatus(syncCaseParams))\r\n            .then(function(){\r\n                var syncPromise;\r\n                if(syncCaseParams.type == \"start\")\r\n                    syncPromise = self.services.syncOfflineStartCase(syncCaseParams);\r\n                else\r\n                    syncPromise = self.services.syncOfflineTaskCase(syncCaseParams);\r\n                return syncPromise;\r\n            })\r\n            .then( function(successMsg){\r\n                syncDeferred.resolve(successMsg);\r\n            })\r\n            .fail( function(error){\r\n                syncDeferred.reject(error);\r\n            });\r\n        }\r\n        else {\r\n            //The h_action was not specified.\r\n            syncDeferred.resolve(\"The case will not be synchronized\");\r\n        }\r\n        return syncDeferred.promise();\r\n    }\r\n\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author:Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.fetchWorker\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        self.services = params;\r\n        self.db = params.database;\r\n        self.maxOfflineCases = 100;\r\n        self.secondsBeforeAllowFetchAgain = 2;\r\n        self.tasksSyncDelda = 8;\r\n        self.startSyncDelta = 8;\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? (\"\" + BIZAGI_USER + \"-\" + BIZAGI_PROXY_PREFIX + \"-\" + BIZAGI_DOMAIN).toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n\r\n        self.fetchInProgress = false;\r\n        \r\n    },\r\n\r\n    triggerOfflineSyncEvent: function(params){\r\n        if ( bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice()) {\r\n            bizagiapp.synchronizeDownloadOfflineState(params);\r\n        }else{\r\n            bizagi.webpart.publish(\"offline.sync\", params);\r\n        }\r\n    },\r\n\r\n    fetch: function(argument){\r\n        var self = this;\r\n\t\t\t   \r\n        var timeBeforeFetch = self.secondsBeforeAllowFetchAgain * 1000;\r\n        if( self.lastFetch){\r\n            if( self.lastFetch + timeBeforeFetch < Date.now() && !self.fetchInProgress){\r\n                executeFetch();\r\n\t\t\t}\r\n        }\r\n        else if (!self.fetchInProgress){\r\n            executeFetch();\r\n        }        \r\n\r\n        function executeFetch(){\r\n            self.triggerOfflineSyncEvent({type:\"download-started\"});\r\n            self.fetchInProgress = true;\r\n            self.fetchInProgressPromise = new $.Deferred();\r\n\r\n            var getOfflineTasksProm = self.services.getOfflineTasks();\r\n            var getOfflineProcessesProm = self.services.getOfflineProcessesHierarchy();            \r\n            var formsToDownloadCountPromise = new $.Deferred();\r\n\r\n            var downloadStartFormsPromise;\r\n            var downloadTaskFormsPromise;\r\n\r\n            var offlineWorkAvailable = 0;\r\n\r\n            $.when(getOfflineProcessesProm, getOfflineTasksProm)\r\n            .then( function(offlineProcessesHierarchy, offlineTasksResponse){\r\n                \r\n                offlineProcessesHierarchy = Array.isArray(offlineProcessesHierarchy) && offlineProcessesHierarchy.length > 0 ?\r\n                    offlineProcessesHierarchy[0]: offlineProcessesHierarchy;\r\n                var offlineProcessesList = self.getProcessesListFromHierarchy(offlineProcessesHierarchy);\r\n                \r\n                \r\n                offlineTasksResponse = Array.isArray(offlineTasksResponse) && offlineTasksResponse.length > 0 ? \r\n                    offlineTasksResponse[0] : offlineTasksResponse;\r\n                var serializedOfflineActivities = self.serializeActivities(offlineTasksResponse);\r\n                offlineWorkAvailable = offlineProcessesList.length + Object.keys(serializedOfflineActivities).length;\r\n\r\n                $.when(self.getTasksToDownload(serializedOfflineActivities), self.getStartFormsToDownload(offlineProcessesList))\r\n                .then( function(tasksToDownloadResponse, startFormsToDownload){\r\n                    downloadTaskFormsPromise = self.processTasksToFetchForms(serializedOfflineActivities, tasksToDownloadResponse.items);\r\n                    downloadStartFormsPromise = self.fetchStartForms(offlineProcessesHierarchy, startFormsToDownload);\r\n                    formsToDownloadCountPromise.resolve(startFormsToDownload.length + tasksToDownloadResponse.count);\r\n                })\r\n                .fail( function(getTasksToDownloadErr, getStartFormsToDownloadErr){\r\n                    formsToDownloadCountPromise.reject({tasks: getTasksToDownloadErr, start: getStartFormsToDownloadErr});\r\n                });\r\n            })\r\n            .fail( function( startFormsSyncNeededError, offlineTasksError){\r\n                console.log(\"Forms download fails\", startFormsSyncNeededError, offlineTasksError);\r\n                formsToDownloadCountPromise.reject()\r\n            })\r\n\r\n            $.when(formsToDownloadCountPromise)\r\n            .then(function(count){\r\n                if(count > 0) {\r\n                    self.triggerOfflineSyncEvent({type:\"update-total-downloads\", argument: count});\r\n                }\r\n                else {\r\n                    if(offlineWorkAvailable > 0){\r\n                        self.triggerOfflineSyncEvent({type:\"up-to-date\", argument: offlineWorkAvailable});\r\n                    }\r\n                }\r\n                return $.when.apply($, [downloadStartFormsPromise, downloadTaskFormsPromise]);\r\n            })\r\n            .then(function(){\r\n                self.lastFetch = Date.now();\r\n                self.fetchInProgressPromise.resolve(true);\r\n                self.fetchInProgress = false;\r\n                self.triggerOfflineSyncEvent({type:\"download-finished\"});\r\n            })\r\n            .fail( function(){\r\n                //Wait for all downloads ends, because can fail only downloading start forms but not tasks or vice\r\n                $.when(downloadStartFormsPromise)\r\n                .always( function(startResult){\r\n                    $.when(downloadTaskFormsPromise)\r\n                    .always( function(tasksResult){\r\n                        self.fetchInProgressPromise.reject(\"Error executing fetch v2\");\r\n                        self.fetchInProgress = false;\r\n                        self.triggerOfflineSyncEvent({type:\"download-error\"});\r\n                    });\r\n                })\r\n            })\r\n\r\n            $.when(self.services.getRecentOfflineProcesses())\r\n            .then(function(recentProcceses){\r\n                self.saveRecentProcesses(recentProcceses);\r\n            })\r\n        }\r\n\t\t\t   \r\n        return self.fetchInProgressPromise.promise();\r\n    },\r\n\r\n    fetchStartForms: function(offlineProcessTree, processesList){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var offlineProcessTree;\r\n        $.when(self.saveProcessesHierarchy(offlineProcessTree))\r\n        .then( function(){\r\n            return self.downloadStartForms(processesList)\r\n        })\r\n        .then( function(){\r\n            console.log(\"Sv2: Offline start forms downloaded succesfully\");\r\n            def.resolve();\r\n        })\r\n        .fail( function(err){\r\n            console.log(\"Sv2: Problem downloading any offline start form\", err);\r\n            def.reject();\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getProcessesListFromHierarchy: function(offlineProcessTree){\r\n        var processes = [];\r\n\r\n        for(var i=0; i< offlineProcessTree.length; i++ ){\r\n            var currentApplication = offlineProcessTree[i];\r\n            var categories = currentApplication.categories;\r\n            for( var j = 0; j < categories.length; j++){\r\n                getProcessesFromCategory(categories[j]);\r\n            }\r\n        }\r\n\r\n        function getProcessesFromCategory(category){\r\n            if(category.isProcess === \"true\" && category.hasOfflineForm){\r\n                processes.push(category.idCategory);                \r\n            }\r\n            else if (category.subCategories){\r\n                for( var k = 0; k < category.subCategories.length; k++){\r\n                    var subCategory = category.subCategories[k];\r\n                    getProcessesFromCategory(subCategory);\r\n                }\r\n            }\r\n        }\r\n        return processes;\r\n    },\r\n\r\n    getStartFormsToDownload: function(processes) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var checksQueue = new bizagiQueue();\r\n        var processesToDownload = [];\r\n        processes.forEach( function(idProcess){\r\n            var checkProm = self.checkIfStartFormNeedsSync(idProcess);\r\n            $.when(checkProm)\r\n            .then( function(isSyncNeeded){\r\n                if(isSyncNeeded){\r\n                    processesToDownload.push(idProcess);\r\n                }\r\n            });\r\n            checksQueue.add(checkProm);\r\n        });\r\n\r\n        $.when(checksQueue.execute())\r\n        .always( function(){\r\n            def.resolve(processesToDownload);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    checkIfStartFormNeedsSync: function( idProcess ){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        $.when( self.services.database.getStartForm({idProcess: idProcess}))\r\n        .then( function(localForm){\r\n            var isSyncNeeded = false;\r\n            var lastSync = localForm.lastSynchronization;        \r\n            if(lastSync){\r\n                var currentTime = Date.now();   \r\n                isSyncNeeded = lastSync + ( self.startSyncDelta*60*60*1000 ) < currentTime;  \r\n            }\r\n            def.resolve(isSyncNeeded);\r\n        })\r\n        .fail( function(){\r\n            def.resolve(true);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    downloadStartForms: function(processes){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var downloadFormsQueue = new bizagiQueue();\r\n\r\n        var formsSuccessCount = 0;\r\n        var formsFailedCount = 0;\r\n\r\n        for(var i=0; i< processes.length; i++ ){\r\n            var downloadProm = self.services.downloadOfflineStartForm({\r\n                idProcess: processes[i]\r\n            });\r\n            $.when(downloadProm)\r\n            .then( function(){\r\n                self.triggerOfflineSyncEvent( {type:\"form-finished\", argument: \"success\"});\r\n                formsSuccessCount++;\r\n                checkIfDownloadStartFormsEnds();\r\n            })\r\n            .fail( function(){\r\n                self.triggerOfflineSyncEvent({type:\"form-finished\", argument: \"error\"});\r\n                formsFailedCount++;\r\n                checkIfDownloadStartFormsEnds();\r\n            })\r\n            downloadFormsQueue.add(downloadProm);\r\n        }\r\n        $.when(downloadFormsQueue.execute())\r\n        .then(function(){\r\n            def.resolve();\r\n        })\r\n        .fail(function(){\r\n            checkIfDownloadStartFormsEnds();\r\n        });\r\n\r\n        function checkIfDownloadStartFormsEnds(){\r\n            if(formsFailedCount + formsSuccessCount == processes.length){\r\n                if(formsFailedCount > 0){\r\n                    def.reject();\r\n                } \r\n                else{\r\n                    def.resolve();\r\n                }\r\n            }\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    serializeActivities: function(offlineTasksResponse){\r\n        var self = this;\r\n        var elementsMap = {};\r\n\r\n        var row, i = -1;    \r\n        var actualDate = new Date();\r\n        var statusFunction = offlineTasksResponse.advanceSearch ? self.services.defineActivityStateByTaskState :self.services.defineActivityStateByDate;\r\n\r\n        while ((row = offlineTasksResponse.rows[++i])) {\r\n            var tempElement = {}, el = [\"\", \"\", \"\", \"\", \"\", \"\", [], \"\", \"\", \"\", \"\",\"\",\"\"];\r\n            var field, j = -1;\r\n            while ((field = offlineTasksResponse.headers[++j])) {\r\n                tempElement[field.fieldName.toLowerCase()] = {\r\n                    \"displayName\": field.displayName,\r\n                    \"value\": row[j]\r\n                };\r\n                self.services.serializeActivity(el, field.fieldName.toLowerCase(), tempElement[field.fieldName.toLowerCase()]);\r\n            }\r\n            \r\n            var tmpElement = el;\r\n            var status = {};\r\n\r\n            status = statusFunction(tmpElement[3], tmpElement.taskstate);\r\n\r\n            // Time to atRiskTimeDelta\r\n            if (tmpElement.length >= 10 && parseInt(tmpElement[11], 10) > 0) {\r\n                var tmpEndDate = new Date(tmpElement[3]);\r\n\r\n                if (actualDate.getTime() > tmpEndDate.getTime()) {\r\n                    status.state = \"red\";\r\n                } else {\r\n                    if (actualDate.getTime() > (tmpEndDate.getTime() - (parseInt(tmpElement[11], 10) * 60000))) {\r\n                        status.state = \"yellow\";\r\n                    } else {\r\n                        status.state = \"green\";\r\n                    }\r\n                }\r\n            }\r\n\r\n            //Tasks are offline\r\n            tmpElement[7] = true;\r\n            tmpElement = $.extend({}, tmpElement, status, {\r\n                \"endDate\": tmpElement[3],\r\n                \"idworkitem\": tmpElement[1],\r\n                \"idwfclass\": !bizagi.util.validateFeatureSupport(\"advancedSearch\") ? tmpElement[7] : tmpElement[10]\r\n            })\r\n\r\n            var idCase = tmpElement[0];\r\n            var idWorkitem = tmpElement[1];\r\n            var internalId = idCase + \"-\" + idWorkitem;\r\n\r\n            elementsMap[internalId] = tmpElement;     \r\n        }\r\n\r\n        return elementsMap;\r\n    },\r\n\r\n    getTasksToDownload: function( serverActivities ){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.services.database.getLocalActivities())\r\n        .then( function(localCases) {\r\n            var itemsToDownload = {};\r\n            var itemsCount = 0;\r\n            var timeBeforeNextHardRedownload = 1000 * 60 * 60 * self.tasksSyncDelda;\r\n\r\n            Object.keys(serverActivities).forEach( function(servTaskId) {\r\n                var servTask = serverActivities[servTaskId];\r\n                var matchingLocalTask = localCases[servTaskId];\r\n                if( !matchingLocalTask || matchingLocalTask.dataChangeset === undefined \r\n                    || servTask.dataChangeset !== matchingLocalTask.dataChangeset \r\n                    || !matchingLocalTask.lastFullSync || (matchingLocalTask.lastFullSync + timeBeforeNextHardRedownload < Date.now())) {\r\n                    itemsToDownload[servTaskId] = {\r\n                        idCase: servTask[0],\r\n                        idWorkitem: servTask[1], \r\n                        syncDelda: self.tasksSyncDelda,            \r\n                        dataChangeset: servTask.dataChangeset\r\n                    };\r\n                    itemsCount++;\r\n                }\r\n            });\r\n            def.resolve({\r\n                items: itemsToDownload,\r\n                count: itemsCount\r\n            });\r\n        })\r\n        .fail( function(){\r\n            def.reject();\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    processTasksToFetchForms: function(serverTasks, tasksToDownload) {        \r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var queueReadyToProcess = new $.Deferred();\r\n        var processOfflineFormsQueue = new bizagiQueue();\r\n\r\n        var tasksSuccessfulCount = 0;\r\n        var tasksFailedCount = 0;\r\n        var tasksToDownloadCount = 0;\r\n\r\n        //Si el task fue trabajado y tiene error de sincronización no se actualiza.\r\n        $.when(self.db.getOutboxTaskCasesFilteredBySyncStatus(\"any\", false))\r\n        .then( function(result){\r\n            for(var i=0; i <result.length; i++){\r\n                delete tasksToDownload[result[i].id];\r\n                delete serverTasks[result[i].id];\r\n            }\r\n            return true;\r\n        })\r\n        //Buscar las actividades que están en el inbox offline\r\n        .then( function(){\r\n            var localActivitiesProm = new $.Deferred();\r\n            self.db.dbActivities.allDocs({include_docs:false}, function(err, response){\r\n                if(err)\r\n                    localActivitiesProm.reject();\r\n                else\r\n                    localActivitiesProm.resolve(response.rows);\r\n            });\r\n            return localActivitiesProm.promise();\r\n        })\r\n        //Si una actividad ya no está disponible (está local pero no en la lista del server) se debe eliminar la actividad, la forma y el caso\r\n        .then( function(localActivities) {\r\n            for(var i = 0; i < localActivities.length; i++){\r\n                localActivityInternalId = localActivities[i].id;\r\n                var isActivityAvailable = serverTasks[localActivityInternalId] ? true : false;\r\n                if(!isActivityAvailable){\r\n                    processOfflineFormsQueue.add(self.deleteLocalDataIfActivityWasNotWorked(localActivityInternalId));\r\n                }\r\n            }\r\n            queueReadyToProcess.resolve();\r\n        })\r\n        .fail( function(error){\r\n            console.log(\"Diff algorithm error\", error);\r\n            queueReadyToProcess.resolve();\r\n        });\r\n\r\n        $.when(queueReadyToProcess)\r\n        .then(function(){\r\n            return self.services.database.saveOfflineTasks(serverTasks);  \r\n        })\r\n        .then( function (saveResponse) {\r\n            Object.keys(tasksToDownload).forEach( function(key){\r\n                var internalId = key;\r\n                var downloadTaskParams = tasksToDownload[internalId];\r\n                tasksToDownloadCount++;\r\n                var processFormProm = self.services.downloadOfflineTaskForm(downloadTaskParams);\r\n                $.when(processFormProm)\r\n                .then( function(){\r\n                    return self.updateActivityDatachangesetAndSyncTimestamp( internalId, downloadTaskParams.dataChangeset )\r\n                })\r\n                .then( function(){\r\n                    self.triggerOfflineSyncEvent({type:\"form-finished\", argument: \"success\"});\r\n                    tasksSuccessfulCount++;\r\n                    checkIfDownloadTaskFormsEnds();\r\n                })\r\n                .fail( function(){\r\n                    self.triggerOfflineSyncEvent({type:\"form-finished\", argument: \"error\"});\r\n                    tasksFailedCount++;\r\n                    checkIfDownloadTaskFormsEnds();\r\n                })\r\n                processOfflineFormsQueue.add(processFormProm);\r\n            });\r\n            return processOfflineFormsQueue.execute();\r\n        })\r\n        .then(function(result){\r\n            console.log(\"Download of tasks forms finished SUCCESSFULL (Queue)\");\r\n            def.resolve(result);\r\n        })\r\n        .fail(function(err){\r\n            checkIfDownloadTaskFormsEnds();\r\n            if(tasksToDownloadCount == 0){\r\n                def.reject(err);\r\n                console.log(\"Error in tasks download's differential algorithm:\", err);\r\n            }\r\n        });\r\n        \r\n\r\n        function checkIfDownloadTaskFormsEnds(){\r\n            if(tasksFailedCount + tasksSuccessfulCount == tasksToDownloadCount){\r\n                if(tasksFailedCount > 0){\r\n                    console.log(\"Download of tasks forms finished with ERRORS\");\r\n                    def.reject();\r\n                }\r\n                else {\r\n                    console.log(\"Download of tasks forms finished SUCCESSFULL (Download count)\");\r\n                    def.resolve();\r\n                }\r\n            }\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    deleteLocalDataIfActivityWasNotWorked: function(internalId){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.db.wasActivityWorkedOffline(internalId))\r\n        .then( function(wasWorked){\r\n            if(!wasWorked){\r\n                var deleteActivity = bizagi.util.db.deleteDocument(self.db.dbActivities, internalId);\r\n                var deleteActivityForm = bizagi.util.db.deleteDocument(self.db.dbActivityForms, internalId);\r\n            }\r\n            def.resolve();\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // Only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n\r\n        return objects;\r\n    },\r\n\r\n\r\n    /**\r\n     * Save in the db the user permitions to create cases\r\n     * @param {} hierarchy \r\n     * @returns {} \r\n     */\r\n    saveProcessesHierarchy: function(hierarchy) {\r\n        var self = this;\r\n        var db = self.db.dbProcessesHierarchy;\r\n        var docHierarchy = {\r\n            _id: self.globalId,\r\n            doc: hierarchy,\r\n            lastSynchronization: Date.now()\r\n        };\r\n        return bizagi.util.db.saveDocument( db, docHierarchy);\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user recent processes to create cases\r\n     * @param {} processes \r\n     * @returns {} \r\n     */\r\n    saveRecentProcesses: function(processes) {\r\n        var self = this;\r\n        var db = self.db.dbRecentProcesses;\r\n        processes._id = self.globalId;\r\n        return bizagi.util.db.saveDocument( db, processes);\r\n    },\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    updateActivityDatachangesetAndSyncTimestamp: function(caseId, dataChangeset){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var db = self.db.dbActivities;\r\n        $.when(bizagi.util.db.getDocument(db, caseId))\r\n        .then( function(activity){\r\n            activity.dataChangeset = dataChangeset;\r\n            activity.lastFullSync = Date.now();\r\n            return bizagi.util.db.saveDocument(db, activity);\r\n        })\r\n        .then( function(saveResult){\r\n            def.resolve();\r\n        })\r\n        .fail( function(error){\r\n            def.reject(error);\r\n        });\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: Ricardo Perez\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n//$.Class.extend\r\n$.Class(\"bizagi.workportal.services.db.old\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function() {\r\n        var self = this;\r\n\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        if (!self.disabledb) {\r\n            self.dbProcessRecent = new PouchDB(\"DataProcessesRecent\"); // Recent process\r\n            self.dbProcessHierarchy = new PouchDB(\"DataProcessesHierarchy\"); // Process hierarchy to new cases creation\r\n            self.dbForms = new PouchDB(\"DataRenderForms\"); // To save all forms for server\r\n            self.dbCases = new PouchDB(\"DataRenderCases\"); // Save the data from forms            \r\n        }\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? BIZAGI_USER.toLowerCase() + \"-\" + BIZAGI_PROXY_PREFIX.toLowerCase() + \"-\" + BIZAGI_DOMAIN.toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    /*\r\n    * Delete all Documents (databases)\r\n    * Example for callback : function (err, info) { }\r\n    * \r\n    */\r\n    _destroy: function(callback) {\r\n        var self = this;\r\n        if (typeof callback === \"undefined\") {\r\n            callback = function(err, info) {\r\n            };\r\n        }\r\n\r\n        PouchDB.destroy(\"DataRenderForms\", callback);\r\n        PouchDB.destroy(\"DataRenderCases\", callback);\r\n        PouchDB.destroy(\"DataProcessesHierarchy\", callback);\r\n        PouchDB.destroy(\"DataProcessesRecent\", callback);        \r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n        return objects;\r\n    },\r\n\r\n    /*\r\n    *   This method return all the open cases for the user authenticated from de DB\r\n    *   Returns a promise\r\n    */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbCases.query({ map: map }, { reduce: false }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n\r\nbizagi.workportal.services.db.old.extend(\"bizagi.workportal.services.db.old\", {}, {\r\n\r\n    /**\r\n     * This method create a new case in the db to offline status\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n        var idWfClass = params.idWfClass,\r\n            id = new Date().toISOString(),\r\n            def = new $.Deferred();\r\n\r\n        var offlineCase = {\r\n            _id: id,\r\n            idWfClass: idWfClass.toString(),\r\n            idWorkFlow: idWfClass.toString(),\r\n            idCase: id,\r\n            isFavorite: false,\r\n            globalId: self.globalId,\r\n            createdBy: {\r\n                Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n            },\r\n            creationDate: new Date(),\r\n            process: params.process || \"Offline\",\r\n            categoryName: params.process || params.categoryName || \"Offline\",\r\n            displayName: params.displayName || \"Offline\",\r\n            radNumber: id,\r\n            // closed: false,\r\n            isOfflineForm: true,\r\n            formsRenderVersion: 2,\r\n            syncronized: false,\r\n            isOpen: true,\r\n            workItems: [\r\n                {\r\n                    idWorkItem: Math.guid(),\r\n                    idTask: Math.guid(),\r\n                    idCase: id,\r\n                    colorState: \"Green\",\r\n                    State: \"Green\",\r\n                    TaskName: params.process || \"Offline\"\r\n                }\r\n            ]\r\n        };\r\n\r\n        self.dbCases.put(offlineCase, function callback(err, result) {\r\n            if (!err) {\r\n                def.resolve(offlineCase);\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Delete case\r\n     * @param {} params \r\n     * @returns {} promise \r\n     */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                self.dbCases.remove(doc, function(error, response) {\r\n                    if (!error) {\r\n                        def.resolve(response);\r\n                    } else {\r\n                        bizagi.log(\"Error erasing case\");\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                bizagi.log(\"Error, the case do not exist\");\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this,\r\n            def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                def.resolve(doc);\r\n            } else {\r\n\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the categories as the services if exists in the database\r\n     * @param {} data \r\n     * @returns {} promise\r\n     */\r\n    getCategories: function(data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (!data.enableOfflineForm) {\r\n            def.resolve({});\r\n        }\r\n\r\n        self.dbProcessHierarchy.get(self.globalId, function(err, doc) {\r\n            if (!err) {\r\n                self.categories = doc.doc;\r\n\r\n                if (data.idApp || data.idCategory) {\r\n                    var groupCategory = getGroup(self.categories, data);\r\n                    def.resolve({\r\n                        category: groupCategory,\r\n                        totalApps: (data.idApp ? groupCategory.length : 0)\r\n                    });\r\n                } else {\r\n                    var tempCategories = self.categories;\r\n                    while (tempCategories.length == 1\r\n                        && (tempCategories[0].categories || tempCategories[0].subCategories)) {\r\n                        tempCategories = getGroup(\r\n                            tempCategories,\r\n                            tempCategories[0].appId ? { idApp: tempCategories[0].appId }\r\n                            : { idCategory: tempCategories[0].idCategory }\r\n                        );\r\n                    }\r\n\r\n                    def.resolve({\r\n                        category: tempCategories,\r\n                        totalApps: (tempCategories[0] && tempCategories[0].appId ? tempCategories.length : 0)\r\n                    });\r\n                }\r\n            } else {\r\n                def.reject(\"could not extract this document\");\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n\r\n        /**\r\n         * Get the group for new cases similar to service \r\n         * @param {} categories \r\n         * @param {} data \r\n         * @returns {} \r\n         */\r\n        function getGroup(categories, data) {\r\n            for (var i = 0, len = categories.length; i < len; i++) {\r\n                if (categories[i].appId && categories[i].appId == data.idApp) {\r\n                    return categories[i].categories;\r\n                }\r\n                if (categories[i].idCategory && categories[i].idCategory == data.idCategory) {\r\n                    return categories[i].subCategories;\r\n                } else {\r\n                    if (categories[i].categories) {\r\n                        var cat = getGroup(categories[i].categories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n\r\n                    if (categories[i].subCategories) {\r\n                        var cat = getGroup(categories[i].subCategories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This method return all the open cases for the user authenticated from de DB\r\n     * @returns {} promise\r\n     */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbCases.query({\r\n            map: map\r\n        }, {\r\n            reduce: false\r\n        }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get case by id\r\n     * @param {} idCase \r\n     * @returns {} \r\n     */\r\n    getCase: function(idCase) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(idCase, function(err, doc) {\r\n            if (!err) {\r\n                def.resolve(doc);\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            params[\"radNumber\"] = params.radnumber ? params.radnumber : params.radNumber;\r\n        }\r\n\r\n        if (params.idcase || params.idCase) {\r\n            params[\"radNumber\"] = params.idcase ? params.idcase : params.idCase;\r\n        }\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.globalId, doc);\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n            reduce: false,\r\n            key: self.globalId\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].id,\r\n                            idWFClass: resp.rows[i].idWFClass,\r\n                            idWorkFlow: resp.rows[i].id,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                {\r\n                                    Value: resp.rows[i].value.process,\r\n                                    DisplayName: resp.rows[i].value.process,\r\n                                    DataType: \"VarChar\",\r\n                                    isRadNumber: false\r\n                                }, {\r\n                                    Value: resp.rows[i].value.creationDate,\r\n                                    DisplayName: \"Process creation date\",\r\n                                    DataType: \"DateTime\",\r\n                                    isRadNumber: false\r\n                                }\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local data base\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getAllProcesses: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (typeof (params.inputtray) === \"undefined\") {\r\n            params.inputtray = true;\r\n        }\r\n\r\n        // params.inputtry: draft | outbox | inbox disable\r\n        var response = {\r\n            \"workflows\": {\r\n                \"taskstate\": \"\",\r\n                \"workflow\": []\r\n            }\r\n        };\r\n\r\n        //Reduce and rereduce functions search in http://docs.couchdb.org/en/latest/ddocs.html#view-functions\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                //Trae los documentos del usuario segun el filtro de all, o si estan en favorites etc\r\n                if (doc.idWfClass && doc.globalId) {\r\n                    emit({\r\n                        idWf: doc.idWfClass,\r\n                        gId: doc.globalId,\r\n                        isOpen: doc.isOpen.toString()\r\n                    }, 1);\r\n                }\r\n            },\r\n            reduce: \"_count\"\r\n        };\r\n\r\n        self.dbProcessHierarchy.get(self.globalId, function(err, doc) {\r\n            if (!err) {\r\n\r\n                self.dbCases.query(queryFun, {\r\n                    reduce: true\r\n                }, function(error, resp) {\r\n                    if (!error) {\r\n                        for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                            if (resp.rows[i].key.gId == self.globalId && resp.rows[i].key.isOpen == params.inputtray.toString()) {\r\n                                // Revisar si es necesario agregar aqui el parametro\r\n                                var cat = self.getHierarchyObjects(doc, \"idCategory\", resp.rows[i].key.idWf);\r\n                                response.isOpen = params.inputtray;\r\n                                response.workflows.workflow.push({\r\n                                    category: \"Offline Procesess\",\r\n                                    name: cat[0] ? cat[0].categoryName : \"\",\r\n                                    idworkflow: resp.rows[i].key.idWf,\r\n                                    count: resp.rows[i].value,\r\n                                    isFavorite: false\r\n                                });\r\n                            }\r\n                        };\r\n                        def.resolve(JSON.stringify(response));\r\n                    } else {\r\n                        def.reject(\"error\");\r\n                    }\r\n                });\r\n            } else {\r\n                def.reject(\"error\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxCases: function() {\r\n        // body\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                // Get the user documents according to filter all, or if its are in favorites etc.\r\n                if (!doc.isOpen) {\r\n                    //  emit({ idWfClass: doc.idWfClass, isOpen: doc.isOpen.toString() }, doc);\r\n                    emit(doc.globalId, doc);\r\n                }\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n                reduce: false,\r\n                key: self.globalId\r\n            },\r\n            function(err, doc) {\r\n                if (!err) {\r\n                    def.resolve(doc);\r\n                } else {\r\n                    bizagi.log(\"Error loading data before syncronization\");\r\n                    def.reject(err);\r\n                }\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {}  Returns a promise\r\n     *  Struct: [\r\n     *   idCase, idWorkItem, idTask,\r\n     *   dueDate, processName, activityName,\r\n     *   customzedColumns: [key, value],\r\n     *   isOfflineForm, isOpen\r\n     * ]\r\n     */\r\n    getCasesList: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"page\": 1,\r\n            \"totalPages\": 1,\r\n            \"elements\": []\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.globalId, doc);\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n            reduce: false,\r\n            key: self.globalId\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof params.radNumber === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || resp.rows[i].value.radNumber.toString().indexOf(params.radNumber.toString()) != -1)) {\r\n\r\n                        var localCase = [\r\n                            resp.rows[i].value.idCase,\r\n                            resp.rows[i].value.workItems[0][\"idWorkItem\"][0] || \"\",\r\n                            resp.rows[i].value.workItems[0][\"idTask\"][0] || \"\",\r\n                            resp.rows[i].value.creationDate,\r\n                            resp.rows[i].value.categoryName,\r\n                            resp.rows[i].value.displayName,\r\n                            [\r\n                                [\"Case No\", resp.rows[i].value.idCase],\r\n                                [\"Process\", resp.rows[i].value.process],\r\n                                [\"Process creation date\", bizagi.util.formatDateTime(resp.rows[i].value.creationDate)]\r\n                            ],\r\n                            resp.rows[i].value.isOfflineForm,\r\n                            resp.rows[i].value.isOpen\r\n                        ];\r\n\r\n                        cases.elements.push(localCase);\r\n                    }\r\n                }\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /*\r\n    *   This method return the cases created offline by idWorkflow\r\n    *   Returns a promise\r\n    */\r\n    getCustomizedColumnsNewData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.globalId, doc);\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n            reduce: false,\r\n            key: self.globalId\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].value.idCase,\r\n                            idWFClass: resp.rows[i].value.idWfClass,\r\n                            idWorkFlow: resp.rows[i].value.idWorkFlow,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isAborted: false,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                resp.rows[i].value.idCase,\r\n                                resp.rows[i].value.process,\r\n                                {\r\n                                    \"workitems\": resp.rows[i].value.workItems\r\n                                },\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate),\r\n                                \"\",\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate)\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get recent processes\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n        var recent = { \"processes\": [] };\r\n\r\n        if (!self.recentProcesses) {\r\n            self.dbProcessRecent.get(self.globalId, function(error, doc) {\r\n                if (!error) {\r\n                    self.recentProcesses = doc.doc;\r\n                    deferred.resolve(self.recentProcesses);\r\n                } else {\r\n                    bizagi.log(\"Could not extract this document\");\r\n                    deferred.reject(error);\r\n                }\r\n            });\r\n        } else {\r\n            deferred.resolve(self.recentProcesses);\r\n        }\r\n\r\n        return deferred.promise();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: oscaro\r\n*   Comments:\r\n*   -   This script creates a plugin to handler oll db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\nbizagi.workportal.services.db.old.extend(\"bizagi.workportal.services.db.old\", {}, {\r\n\r\n    /**\r\n     * This method return the form for a new case to offline status\r\n     * @param {} idWFClass\r\n     * @returns {} Returns a promise\r\n     */\r\n    getFormData: function(idWFClass) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbForms.get(idWFClass + \"-\" + idWFClass + \"-\" + self.globalId, function(err, doc) {\r\n            if (!err) {\r\n                if (typeof (doc.form) !== \"undefined\") {\r\n                    setTimeout(function() {\r\n                        def.resolve({ form: doc.form, type: \"form\" });\r\n                    }, 300);\r\n                } else {\r\n                    var responseText = {\r\n                        errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                        message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")                        \r\n                    };\r\n                    \r\n                    def.reject(JSON.stringify(responseText));\r\n                }\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method merge the form and the data to result form\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    mergeForm: function(doc, form) {\r\n\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        $.when(form).done(function(form) {\r\n            if (!doc.data) {\r\n                def.resolve(form);\r\n            } else {\r\n                // If it case is in outbox or closed, hide buttons in the form\r\n                if (!doc.isOpen) {\r\n                    form.form.buttons = [];\r\n                    if(Object.keys(doc.data).length === 0) {\r\n                        fillForm(form.form.elements, {\r\n                            key: \"«read-only-form»\",\r\n                            value: \"\"\r\n                        });    \r\n                    }\r\n                }\r\n\r\n                for (prop in doc.data) {\r\n                    fillForm(form.form.elements, {\r\n                        key: prop,\r\n                        value: doc.data[prop]\r\n                    });\r\n                }\r\n\r\n                function fillForm(element, data) {\r\n                    if (element.length && element.length > 0) {\r\n                        for (var i = 0, len = element.length; i < len; i++) {\r\n                            fillForm(element[i], data);\r\n                        }\r\n                    } else {\r\n                        if (element.container) {\r\n                            fillForm(element.container.elements, data);\r\n                        } else {\r\n                            // If it case is in outbox or closed, make all renders in the form not editable\r\n                            if (!doc.isOpen) {\r\n                                element.render.properties.editable = false;\r\n                            }\r\n\r\n                            if (element.render.properties.xpath == data.key) {\r\n                                if (element.render.properties.type === \"grid\") {\r\n                                    self.setRenderGridValues(element.render);\r\n                                }\r\n                                self.setRenderValues(element.render.properties, data.value);\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n\r\n                def.resolve(form);\r\n            }\r\n        }).fail(function(cause) {\r\n            if (!cause.responseText)\r\n                var responseText = {\r\n                    errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                    message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")\r\n                };\r\n\r\n            cause.responseText = JSON.stringify(responseText);\r\n\r\n            def.reject(cause);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Set render Grid values\r\n     * @param {} render\r\n     * @returns {}\r\n     */\r\n    setRenderGridValues: function(render) {\r\n        render.properties.data.columns = [];\r\n        for (var i = 0, length = render.elements.length; i < length; i++) {\r\n            render.properties.data.columns.push(render.elements[i].render.properties.xpath);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This function sets the type of each xpath\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    setDataType: function(doc, form) {\r\n\r\n    },\r\n\r\n    /**\r\n     *  This method return the categories like the services if exists in the database\r\n     * @param {} params\r\n     * @param {} data\r\n     * @returns {} Returns a promise\r\n     */\r\n    setRenderValues: function(params, data) {\r\n        var type = params.type;\r\n\r\n        if (!type) type = \"label\";\r\n\r\n        var typeGroupBasic = [\"text\", \"label\", \"number\", \"money\", \"date\", \"boolean\", \"geolocation\", \"hidden\", \"upload\"];\r\n        var typeGroupCombo = [\"combo\", \"cascadingCombo\", \"radio\", \"list\"];\r\n\r\n        if (typeGroupBasic.indexOf(type) !== -1) {\r\n            params.value = data.value;\r\n            return;\r\n        }\r\n\r\n        if (typeGroupCombo.indexOf(type) !== -1) {\r\n            for (var i = 0, len = params.data.length; i < len; i++) {\r\n                if (params.data[i].id == data.value) {\r\n                    params.value = [{ id: data.value, value: params.data[i].value }];\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (type === \"search\") {\r\n            for (var j = 0, lengthData = params.data.length; j < lengthData; j++) {\r\n                if (params.data[j].id == data.value.id) {\r\n                    params.value = data.value;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (type === \"image\") {\r\n            params.value = data;\r\n            return;\r\n        }\r\n\r\n        if (type === \"grid\") {\r\n            params.data.records = data.value.length;\r\n            params.data.total = 1;\r\n            params.data.page = 1;\r\n\r\n            var lengthColumns = params.data.columns.length;\r\n            var tmpEditAndVisible = [];\r\n            var lengthRows = data.value.length;\r\n\r\n            for (var row = 0; row < lengthRows; row++) {\r\n                // Add random value\r\n                var idRow = bizagi.util.randomNumber();\r\n\r\n                var tmpElement = [];\r\n                var tempRow = [];\r\n\r\n                tmpElement[tmpElement.length] = idRow;\r\n\r\n                for (var col = 0; col < lengthColumns; col++) {\r\n                    var index = typeof (data.value[row][col]) !== \"undefined\" ? params.data.columns.indexOf(data.value[row][col].xpath) : -1;\r\n\r\n                    if (index != -1) {\r\n                        tempRow[index] = data.value[row][col];\r\n                    }\r\n\r\n                    tempRow[col] = (typeof (tempRow[col]) === \"undefined\") ? {} : tempRow[col];\r\n                    tmpElement[tmpElement.length] = \"true\";\r\n                }\r\n\r\n                params.data.rows.push($.merge([idRow], tempRow));\r\n                tmpEditAndVisible[tmpEditAndVisible.length] = tmpElement;\r\n            }\r\n\r\n            params.data.editable = tmpEditAndVisible;\r\n            params.data.visible = tmpEditAndVisible;\r\n\r\n            return;\r\n        }\r\n\r\n        // No type supported\r\n        try {\r\n            params.value = data.value;\r\n        } catch (e) {\r\n        }\r\n\r\n        bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * This method simulate a summary response\r\n     * @param {} params\r\n     * @returns {} Returns a promise\r\n     */\r\n    getSummary: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err)\r\n                def.resolve($.extend(doc, {\r\n                    processPath: \"/\",\r\n                    currentState: doc.workItems,\r\n                    countAssigness: 0,\r\n                    countEvents: 0,\r\n                    isOpen: doc.isOpen.toString(),\r\n                    countSubProcesses: 0\r\n                }));\r\n            else\r\n                def.reject(err);\r\n        });\r\n\r\n        return def.promise();\r\n    },      \r\n\r\n    /*\r\n    *   This method save the form info in the DB\r\n    *   Returns a promise\r\n    */\r\n    saveFormInfo: function(params, data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                self.mergeDataDocument(data, doc, self.getFormData(doc.idWfClass.toString()))\r\n                    .done(function(resp) {\r\n\r\n                        doc = self.mergeData(data, doc, resp);\r\n\r\n                        self.dbCases.put(doc, function(error, response) {\r\n                            if (!error)\r\n                                def.resolve(response);\r\n                            else\r\n                                def.reject(error);\r\n                        });\r\n                    });\r\n\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    mergeDataDocument: function(data, doc, form) {\r\n        var defer = new $.Deferred();\r\n        var response = {};\r\n\r\n        $.when(form).done(function(resp) {\r\n\r\n            for (prop in data) {\r\n                if (prop != \"h_action\") {\r\n                    response[prop] = {};\r\n                    response[prop].value = data[prop];\r\n                    fillForm(resp.form.elements, {\r\n                        key: prop,\r\n                        value: data[prop]\r\n                    });\r\n                }\r\n            }\r\n\r\n            function fillForm(element, datafill) {\r\n                if (element.length && element.length > 0) {\r\n                    for (var i = 0, len = element.length; i < len; i++) {\r\n                        fillForm(element[i], datafill);\r\n                    }\r\n                } else {\r\n                    if (element.container) {\r\n                        fillForm(element.container.elements, datafill);\r\n                    } else {\r\n                        if (element.render.properties.xpath == datafill.key) {\r\n                            response[datafill.key].DataType = element.render.properties.dataType || \"\";\r\n                            response[datafill.key].type = element.render.properties.type || \"\";\r\n\r\n                            // Remove empty object of the Collection\r\n                            if (!bizagi.util.isEmpty(response[datafill.key])) {\r\n                                var lengthRows = response[datafill.key].value.length;\r\n\r\n                                for (var row = 0; row < lengthRows; row++) {\r\n                                    if (!bizagi.util.isEmpty(response[datafill.key].value[row])) {\r\n\r\n                                        if (response[datafill.key].type === \"image\") {\r\n                                            var url = response[datafill.key].value[row] || \"\";\r\n\r\n                                            response[datafill.key].value = url.replace(/^data:.*;base64,/, \"\");\r\n                                        } else {\r\n                                            var tempDataColumn = [];\r\n                                            var lengthCols = response[datafill.key].value[row].length;\r\n\r\n                                            for (var col = 0; col < lengthCols; col++) {\r\n                                                if (!bizagi.util.isEmpty(response[datafill.key].value[row][col])) {\r\n                                                    tempDataColumn.push(response[datafill.key].value[row][col]);\r\n                                                }\r\n                                            }\r\n\r\n                                            response[datafill.key].value[row] = tempDataColumn;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n\r\n            defer.resolve(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    mergeData: function (data, doc, resp) {\r\n\r\n        if (data.h_action == \"next\") {\r\n            doc.isOpen = false;\r\n        }\r\n\r\n        doc.data = doc.data || {};\r\n\r\n        for (var i in resp) {\r\n\r\n            var assigned = false;\r\n\r\n            for (var j in doc.data) {\r\n\r\n                if (i == j) {\r\n\r\n                    if (bizagi.util.isEmpty(resp[i]) || bizagi.util.isEmpty(resp[i].value)) {\r\n                        delete doc.data[j];\r\n                        assigned = true;\r\n                    } else {\r\n                        doc.data[j] = resp[i];\r\n                        assigned = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!assigned) {\r\n                doc.data[i] = resp[i];\r\n            }\r\n        }\r\n\r\n        return doc;\r\n\r\n    },\r\n\r\n    nativeSaveFormInfo: function (data, doc, form) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.mergeDataDocument(data, doc, form)\r\n            .done(function (resp) {\r\n                doc = self.mergeData(data, doc, resp);\r\n                def.resolve(doc);\r\n            });\r\n\r\n        return def.promise();\r\n    }\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n$.Class.extend(\"bizagi.workportal.services.pullWorker.old\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        var queryString = bizagi.readQueryString();\r\n\r\n        self.services = params;\r\n        self.database = params.database;\r\n\r\n        var querydisable = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n        self.disabledb = querydisable;\r\n\r\n        if (!self.disabledb) {\r\n            self.dbForms = new PouchDB(\"DataRenderForms\");\r\n            self.dbCases = new PouchDB(\"DataRenderCases\");\r\n            self.dbProcessHierarchy = new PouchDB(\"DataProcessesHierarchy\");\r\n            self.dbProcessRecent = new PouchDB(\"DataProcessesRecent\");\r\n        }\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? BIZAGI_USER.toLowerCase() + \"-\" + BIZAGI_PROXY_PREFIX\r\n            .toLowerCase() + \"-\" + BIZAGI_DOMAIN.toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    pull: function() {\r\n        var self = this;\r\n\r\n        if (self.disabledb) {\r\n            return false;\r\n        }\r\n\r\n        return $.when(self.syncOfflineCases())\r\n            .done(function() {\r\n                return true;\r\n            });\r\n    },\r\n    \r\n    /**\r\n     * This function send to the server the offline cases created\r\n     * @param {} argument \r\n     * @returns {} \r\n     */\r\n    syncOfflineCases: function(argument) {\r\n        var self = this;\r\n\r\n        if (typeof (self.database) !== \"undefined\") {\r\n            self.synchronizing = self.synchronizing || false;\r\n\r\n            if (!self.synchronizing) {\r\n                self.synchronizing = true;\r\n                return self.database.getOutboxCases().done(function(response) {\r\n                    var array_cases = [];\r\n                    for (var i = 0; i < response.total_rows; i++) {\r\n                        var obj = response.rows[i].value;\r\n                        var objToSend = [];\r\n                        for (var item in obj.data) {\r\n                            if (item != \"h_action\") {\r\n                                objToSend.push({\r\n                                    \"domain\": typeof (BIZAGI_DOMAIN) !== \"undefined\" ? BIZAGI_DOMAIN : \"domain\",\r\n                                    \"user\": typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                                    \"xpath\": item,\r\n                                    \"value\": self.processDataValues(obj.data[item].value, obj.data[item].type),\r\n                                    \"DataType\": obj.data[item].DataType,\r\n                                    \"type\": obj.data[item].type\r\n                                });\r\n                            }\r\n                        }\r\n\r\n                        obj = $.extend(obj, { \"objToSend\": objToSend });\r\n\r\n                        // idWfClass\r\n                        array_cases.push(\r\n                            self.services.syncOfflineCases(obj).pipe(\r\n                                function(rta) {\r\n                                    var formData = decodeURIComponent(this.data).split('&');\r\n                                    for (var i = formData.length - 1; i >= 0; i--) {\r\n                                        var pivot = formData[i].split(\"=\");\r\n                                        if (pivot[0] == \"idCase\") {\r\n                                            return self.database.deleteCase({\r\n                                                idCase: pivot[1]\r\n                                            });\r\n                                        }\r\n                                    }\r\n                                    // When it returns \"yes\" then remove the case of database\r\n                                }, function(fail) {\r\n                                    bizagi.log(fail);\r\n                                }\r\n                            )\r\n                        );\r\n                    }\r\n\r\n                    return $.when.apply($, array_cases).pipe(function() {                        \r\n                        // Show message to successfully synchronization\r\n                        self.synchronizing = false;                        \r\n                        return true;\r\n                    });\r\n                });\r\n            }\r\n        }        \r\n    },\r\n\r\n    processDataValues: function(data, fileType) {\r\n        var self = this; \r\n        if($.type(data) == \"array\" && fileType == \"upload\") {\r\n\r\n            for ( var i = 0 ; i < data.length; i++){\r\n                data[i] = data[i].filter(function(element){\r\n                    return element[\"xpath\"] != \"mimeType\";\r\n                });\r\n            }\r\n\r\n            return data;\r\n        }\r\n\r\n        if ($.type(data) == \"object\") {\r\n            // For search\r\n            if (data.hasOwnProperty(\"id\")) {\r\n                data = data.id;\r\n            }\r\n        }\r\n\r\n        if(fileType == \"grid\"){ \r\n            for(var rowPos = 0; rowPos < data.length; rowPos++){ \r\n                var row = data[rowPos]; \r\n                for(var cellPos= 0; cellPos< row.length; cellPos++){ \r\n                    var cell = row[cellPos]; \r\n                    cell.value = self.processDataValues(cell.value); \r\n                } \r\n            } \r\n        } \r\n\r\n        return data;\r\n    }\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author:Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.fetchWorker.old\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        self.services = params;\r\n\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        if (!self.disabledb) {\r\n            self.dbForms = new PouchDB(\"DataRenderForms\");\r\n            self.dbCases = new PouchDB(\"DataRenderCases\");\r\n            self.dbProcessHierarchy = new PouchDB(\"DataProcessesHierarchy\");\r\n            self.dbProcessRecent = new PouchDB(\"DataProcessesRecent\");\r\n        }\r\n\r\n        self.globalId = typeof (BIZAGI_USER) != \"undefined\"\r\n            ? BIZAGI_USER.toLowerCase() + \"-\" + BIZAGI_PROXY_PREFIX.toLowerCase() + \"-\" + BIZAGI_DOMAIN.toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    fetch: function(argument) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (self.disabledb) {\r\n            def.reject(\"Disable Sync\");\r\n            return def.promise();\r\n        }\r\n\r\n        $.when(self.services.processesHierarchy())\r\n            .done(function(dataCategory, dataRecents) {\r\n                $.when(self.saveProcessesHierarchy(dataCategory),\r\n                        self.processesHierarchyTofetchForms(),\r\n                        self.services.getRecentOfflineProcesses())\r\n                    .done(function(data1, data2, dataRecents) {\r\n                        self.saveRecentProcesses(dataRecents);\r\n                        def.resolve(\"All data fetched\");\r\n                    }).fail(function(data1, data2, data3) {\r\n                        if (data1 === \"nothing\") {\r\n                            def.reject(0);\r\n                        } else {\r\n                            def.reject(\"Error fetching data\");\r\n                        }\r\n                    });\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user permitions to create cases\r\n     * @returns {} \r\n     */\r\n    processesHierarchyTofetchForms: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var changeset = bizagi.util.getItemLocalStorage((\"formChangeset\" + self.globalId));\r\n        if (changeset === null || typeof changeset === \"undefined\") {\r\n            changeset = 0;\r\n        }\r\n\r\n        self.callSyncForms({\r\n            changeSet: changeset\r\n        }).done(function(data) {\r\n            console.log(data, \"Sync forms\");\r\n            def.resolve(data);\r\n        }).fail(function(error) {\r\n            if (error === \"nothing\") {\r\n                console.log(\"Nothing to sync\");\r\n            } else {\r\n                console.log(error, \"Error sync forms\");\r\n            }\r\n            def.reject(error);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    callSyncForms: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var changeSet = params.changeSet;\r\n\r\n        self.services.processesHierarchyTofetchForms(params)\r\n            .done(function(data) {\r\n                if (data.changeSet > changeSet) {\r\n                    // Add code to validate if form and save\r\n                    var prom = null;\r\n                    if (data.changeSetType === 1) // Form \r\n                        prom = self.saveProcessesHierarchyTofetchForms(data.result);\r\n                    if (data.changeSetType === 4) { // Grant acess\r\n                        prom = self.saveProcessInHierarchy(data.result);\r\n                    }\r\n\r\n                    $.when(prom).done(function() {\r\n                        self.callSyncForms({\r\n                            changeSet: data.changeSet\r\n                        }).done(function(resp) {\r\n                            def.resolve(resp);\r\n                        }).fail(function(error) {\r\n                            def.reject(error);\r\n                        });\r\n                    }).fail(function(err) {\r\n                        def.reject(err);\r\n                    });\r\n                } else {\r\n                    // Set the variable changeset in localStorage\r\n                    bizagi.util.setItemLocalStorage((\"formChangeset\" + self.globalId), data.changeSet);\r\n                    changeSet = parseInt(changeSet);\r\n                    if (data.changeSet === 0 && changeSet === 0) {\r\n                        // Nothing to sync                    \r\n                        def.reject(\"nothing\");\r\n                    } else {\r\n                        def.resolve(\"succesfully\");\r\n                    }\r\n                }\r\n            }).fail(function(error) {\r\n                def.reject(error);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    saveProcessInHierarchy: function(data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        def.resolve(\"\");\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // Only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n\r\n        return objects;\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user Forms\r\n     * @param {} result \r\n     * @returns {} \r\n     */\r\n    saveProcessesHierarchyTofetchForms: function(result) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var docHierarchy = {\r\n            _id: result.wfClass.toString() + \"-\" + result.wfClass.toString() + \"-\" + self.globalId,\r\n            globalid: self.globalId,\r\n            idWfClass: result.wfClass,\r\n            idWorkFlow: result.workFlow,\r\n            form: result.data.form\r\n        };\r\n\r\n        self.dbForms.get(docHierarchy._id, function(err, doc) {\r\n            // If error, then the doc doesn't exists and it's added\r\n            if (err) {\r\n                // If it does not exist then add\r\n                self.dbForms.put(docHierarchy, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not add the document\");\r\n                    }\r\n                });\r\n            } else {\r\n                // If no error, then the doc exists and must be replaced if is outdated\r\n                self.dbForms.put({\r\n                    _rev: doc._rev,\r\n                    _id: doc._id,\r\n                    form: docHierarchy.form\r\n                }, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not update the document\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user permitions to create cases\r\n     * @param {} hierarchy \r\n     * @returns {} \r\n     */\r\n    saveProcessesHierarchy: function(hierarchy) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var docHierarchy = {\r\n            _id: self.globalId,\r\n            doc: hierarchy\r\n        };\r\n\r\n        // Try to search de doc\r\n        self.dbProcessHierarchy.get(docHierarchy._id, function(err, doc) {\r\n            // If error, then the doc doesn't exists and it's add\r\n            if (err) {\r\n                // If it does not exist then add\r\n                self.dbProcessHierarchy.put(docHierarchy, function callback(err, result) {\r\n                    if (!err) {\r\n\r\n                        def.resolve(result);\r\n                    } else {\r\n\r\n                        def.reject(\"Could not add the document\");\r\n                    }\r\n                });\r\n            } else {\r\n                // If not error, then the doc exists and must be replaced if is outdated\r\n                self.dbProcessHierarchy.put({\r\n                    _id: doc._id,\r\n                    _rev: doc._rev,\r\n                    doc: hierarchy\r\n                }, function callback(err, result) {\r\n\r\n                    if (!err) {\r\n\r\n                        def.resolve(result);\r\n                    } else {\r\n\r\n                        def.reject(\"Could not update the document\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user recent processes to create cases\r\n     * @param {} processes \r\n     * @returns {} \r\n     */\r\n    saveRecentProcesses: function(processes) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var docRecent = {\r\n            _id: self.globalId,\r\n            doc: processes\r\n        };\r\n\r\n        self.dbProcessRecent.get(docRecent._id, function(err, doc) {\r\n            // If error, then the doc does not exists and it's added\r\n            if (err) {\r\n                // If it does not exist then add\r\n                self.dbProcessRecent.put(docRecent, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not add the document\");\r\n                    }\r\n                });\r\n            } else {\r\n                // If no error, then the doc exists and must be replaced if is outdated\r\n                self.dbProcessRecent.put({\r\n                    _rev: doc._rev,\r\n                    _id: doc._id,\r\n                    doc: processes\r\n                }, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not update the document\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra (based on Edward Morales version)\r\n *   Comments:\r\n *   -   This class will provide a facade to access to workportal REST services\r\n */\r\n\r\nbizagi.workportal.services.service.extend(\"bizagi.workportal.services.service\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function(params) {\r\n        // Call base\r\n        var self = this;\r\n\r\n        self.shouldSynchronize = !(bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice() && params.module !== \"offlineServices\");\r\n        self.isOfflineFormsV2Supported =  bizagi.util.isOfflineFormsV2Supported();\r\n        self._super(params);\r\n\r\n\r\n        // Create instance of database services\r\n        if(!params.oldOfflineServicesAlreadyEnabled){\r\n            self.database = typeof (bizagi.workportal.services.db) !== \"undefined\" && !bizagi.util.isMashupContext() ? new bizagi.workportal.services.db() : null;\r\n\r\n            self.enableOfflineEvents();\r\n\r\n        }        \r\n\r\n        if(self.isOfflineFormsV2Supported){\r\n            //Workflow context let us access to rendering services to retrieve offline forms\r\n            params.context=\"workflow\";\r\n            params.database = self.database;\r\n            self.renderDataService = typeof(bizagi.render.services.service) !== \"undefined\"\r\n                ? new bizagi.render.services.service(params): bizagi.render.services.service;            \r\n\r\n            self.fetchWorker = new bizagi.workportal.services.fetchWorker(this);\r\n            self.pullWorker = new bizagi.workportal.services.pullWorker(this);\r\n\t\t\t\t\t\t\t\t\t\t  \r\n            if(self.shouldSynchronize){\r\n            \tself.configureOfflineHandlers();\r\n            }\r\n            self.configurePushCaseHandler();\r\n        }\r\n\r\n        if (bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice() && bizagi.getNativeComponent() === \"offline\" ) {\r\n            bizagiapp.offlineModuleReady();\r\n        }\r\n        \r\n    },\r\n\r\n    /**\r\n     * Configure events handler specifically for native devices\r\n     * @returns {}\r\n     */\r\n    configureOfflineHandlers: function () {\r\n\r\n        var self = this;\r\n\r\n        $(document).on(\"fetch-offline-processes\", function() {\r\n            self.fetchOfflineData();\r\n        });\r\n\r\n\r\n        $(document).on(\"get-offline-categories\", function(e,params) {\r\n            console.log(params);\r\n            params = params || {};\r\n            params.enableOfflineForm = true;\r\n            $.when( self.getCategories(params) ).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.setOfflineCategories(resp);\r\n                }\r\n            }).fail(function(error){\r\n                return error;\r\n            });\r\n        });\r\n\r\n        $(document).on(\"get-offline-recent-processes\", function() {\r\n            $.when( self.getRecentProcesses() ).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.setOfflineRecentProcesses(resp);\r\n                }\r\n            }).fail(function(error){\r\n                return error;\r\n            });\r\n        });\r\n\r\n        $(document).on(\"create-startform-case\",function(e,params) {\r\n\r\n            params = params || {};\r\n            params.categoryName = \"\";\r\n            params.isOfflineForm = true;\r\n\r\n            $.when( self.createNewCase(params)).done( function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.openCreatedStartForm(resp);\r\n                }\r\n            }).fail(function(error){\r\n                console.log(\"error creating new offline case\");\r\n            });\r\n        });\r\n\r\n        $(document).on(\"get-offline-cases\", function(e,param){\r\n            var params = {};\r\n            params.enableOfflineForm = true;\r\n            params.inputtray = param;\r\n\r\n            $.when( self.getCasesListBeta(params)).done( function (resp){\r\n                resp.inboxType = param;\r\n                bizagiapp.setOfflineInboxCases(resp);\r\n            }).fail(function(error){\r\n                console.log(\"error gathering offline cases\");\r\n            });\r\n        });\r\n\r\n        $(document).on(\"get-offline-case-workitems\", function(e,params){\r\n            var params = params || {};\r\n            params.isOfflineForm = params.isOfflineForm || true;\r\n            params.idCase = params.idCase || \"\";\r\n\r\n            $.when(self.getWorkitems(params)).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.openCreatedStartForm(resp);\r\n                }\r\n            }).fail(function(error){\r\n                console.log(\"error gathering the workITems from the given caseId\");\r\n            });\r\n        });\r\n\r\n        $(document).on(\"delete-offline-case\", function(e,params){\r\n            var params = params || {};\r\n            params.idCase = params.idCase || \"\";\r\n\r\n            $.when(self.deleteCase(params)).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.offlineCaseDeleted(\"success\");\r\n                }\r\n            }).fail(function(error){\r\n                bizagiapp.offlineCaseDeleted(\"error\");\r\n                console.log(\"error gathering the workITems from the given caseId\");\r\n            });\r\n        });\r\n\r\n        // Execute this trigger in render on next event\r\n        $(document).off(\"tryPushData.offline\");\r\n        $(document).on(\"tryPushData.offline\", function(e) {\r\n            if (self.online) {\r\n                self.pushOfflineData();\r\n            }\r\n        });\r\n\r\n        //Clean databases\r\n        $(document).off(\"cleanDatabases.offline\");\r\n        $(document).on(\"cleanDatabases.offline\", function() {\r\n            $.when(self.database.restartDatabases())\r\n                .done(function(){\r\n                    var isIphoneNative = bizagi.util.isiOSSmartphoneDevice() && bizagi.util.isNativePluginSupported();\r\n                    if(! isIphoneNative ){\r\n                        bizagi.webpart.publish(\"bz-summary-item-clear\");\r\n                        bizagi.webpart.publish(\"bz-update-list-cases\", { updateDataList: true });\r\n                        if(!self.online){\r\n                            $(document).trigger(\"offline.inbox\");\r\n                        }\r\n                    }\r\n                });\r\n        });\r\n\r\n        $(document).off(\"retry-download-offline-forms\");\r\n        $(document).on(\"retry-download-offline-forms\", function() {\r\n            self.fetchOfflineData();\r\n        });\r\n    },\r\n    //Manage sync case if user has connection\r\n    configurePushCaseHandler: function() {\r\n        var self = this;\r\n        $(document).off(\"tryPushCase.offline\");\r\n        $(document).on(\"tryPushCase.offline\", function(event, params) {\r\n            if ( self.online && params ) {\r\n                var pushPromise = (params.offlineType === \"task\") ?  \r\n                    self.pullWorker.syncSingleOfflineTaskCase(params) :\r\n                    self.pullWorker.syncSingleOfflineStartCase(params);        \r\n                $.when(pushPromise)\r\n                    .then( function(syncResponse){\r\n                        if(params.offlineType === \"task\"){\r\n                            syncResponse.IdCase = params.idCase;\r\n                        }\r\n                        params.responsePromise.resolve(syncResponse);\r\n                    })\r\n                    .fail( function(syncError){\r\n                        params.responsePromise.reject(syncError);\r\n                    });\r\n            }\r\n            else {\r\n                var networkErrorMsg = bizagi.localization.getResource(\"workportal-login-network-error\",\r\n\t\t\t\t\t\t \"The internet connection appears to be offline. Please verify and try again\");\r\n                var networkError = {\r\n                    errorType: \"NetworkError\",\r\n                    message: networkErrorMsg\r\n                }\r\n                var errorString = JSON.stringify({\r\n                    error: networkError,\r\n                    message: networkErrorMsg,\r\n                    type: \"error\"\r\n                });\r\n                params.responsePromise.reject(errorString);\r\n            }\r\n        });\r\n    },\r\n\r\n    enableOfflineEvents: function() {\r\n        var self = this;\r\n\r\n        if (bizagi.isMobileDevice()) {\r\n            if (typeof navigator.connection != \"undefined\") {\r\n                if (typeof (Connection) !== \"undefined\"\r\n                    && (navigator.connection.type == Connection.NONE || navigator.connection.type == \"unknown\")) {\r\n                    self.online = false;\r\n                } else {\r\n                    self.online = true;\r\n                }\r\n            } else {\r\n                var queryString = bizagi.readQueryString();\r\n                var queryoffline = (queryString && queryString[\"online\"]) ? eval(queryString[\"online\"]) : true;\r\n                self.online = queryoffline;\r\n            }\r\n\t\t\t\r\n            $(document).off(\"online.services\");\r\n            $(document).on(\"online.services\", function() {\r\n                self.online = true;\r\n                if(self.isOfflineFormsV2Supported && self.shouldSynchronize ) {\r\n                    self.returnOnlineStatus();\r\n                }                \r\n            });\r\n\r\n            $(document).off(\"offline.services\");\r\n            $(document).on(\"offline.services\", function() {\r\n                self.online = false;\r\n            });\r\n\r\n        }\r\n\r\n\r\n    },\r\n    \r\n    getOutboxCasesCount: function(){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = 0;\r\n        $.when(self.database.getOutboxCases())\r\n        .then(function(response) {\r\n            cases += response.rows ? response.rows.length : 0;\r\n        })\r\n        .always(function(){\r\n            var syncStatusCriteria = \"none\";\r\n            $.when(self.database.getOutboxTaskCasesFilteredBySyncStatus(syncStatusCriteria, true))\r\n            .done( function(responses){\r\n                cases += responses.length;  \r\n            })\r\n            .always( function(){\r\n                def.resolve(cases);\r\n            })\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    returnOnlineStatus: function() {\r\n        var self = this;\r\n        var pushPromise = new $.Deferred();\r\n\r\n        $.when(self.getOutboxCasesCount())\r\n        .then( function(outboxCasesCount){\r\n            if(outboxCasesCount > 0){\r\n                if ( bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.openSyncDialog();     \r\n                }\r\n                //This code is not necessary because ajax refresh the tokens if it is necessary (The server is greater than 11.0)\r\n                // $.when(self.logoutUser()).always(function() {\r\n                //     $.when(self.authenticatedUser()).always(function() {\r\n                //         // $.when().always(function(pushStatus) {\r\n                //         //     $.when(self.fetchOfflineData(pushStatus))\r\n                //         //     .always( function(){\r\n                //         //         bizagi.webpart.publish(\"bz-update-list-cases\", { updateDataList: true });\r\n                //         //     });\r\n                //         // });\r\n                //     });\r\n                // });\r\n                pushPromise = self.pushOfflineData();\r\n            }\r\n            else {\r\n                pushPromise.resolve();\r\n            }\r\n        }); \r\n\r\n        $.when(pushPromise).always(function() {\r\n\r\n            if(!bizagi.util.isiOSSmartphoneDevice()){\r\n                bizagi.webpart.publish(\"bz-update-list-cases\", { updateDataList: true });\r\n            }\r\n\r\n            self.fetchOfflineData();\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Get all data from server : new case structure, forms data\r\n     */\r\n    fetchOfflineData: function() {\r\n        var self = this;\r\n        if(!self.isOfflineFormsV2Supported){\r\n            return;\r\n        }\r\n        self.fetchWorker.fetch();\r\n    },\r\n\r\n    \r\n\r\n    /*\r\n     * put all data to server : new case structure, forms data\r\n     */\r\n    pushOfflineData: function() { \r\n        var self = this;\r\n        if(!self.isOfflineFormsV2Supported){\r\n            return;\r\n        }\r\n        return $.when(self.pullWorker.pull())\r\n        .then( function(success) {\r\n            showSyncMessage(success);\r\n        })\r\n        .fail( function(error){\r\n            showSyncMessage(false);\r\n        });        \r\n        \r\n        function showSyncMessage(success){\r\n            var message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-successful\")\r\n                ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-successful\")\r\n                : \"Synchronization successful\";\r\n            var type = \"success\";\r\n            if(!success){\r\n                message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-fail\")\r\n                        ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-fail\")\r\n                        : \"Synchronization failed\";\r\n                type = \"error\";\r\n            }\r\n            if ( bizagi.util.isNativePluginSupported() ){\r\n                bizagiapp.synchronizationFinished(type);\r\n            }\r\n            else {\r\n                bizagi.util.showNotification({ text: message, type: type });\r\n            }\r\n        }\r\n    },\r\n    /*\r\n     *   Gets the current working user\r\n     */\r\n    getCurrentUser: function(params) {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            // Call ajax and returns promise\r\n            // save this response in the local storage and get when offline\r\n            var data = {\r\n                idUser: 1,\r\n                user: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                domain: typeof (BIZAGI_DOMAIN) !== \"undefined\" ? BIZAGI_DOMAIN : \"domain\",\r\n                delegateUserName: \"\",\r\n                idDelegateUser: -1,\r\n                groupSeparator: \",\",\r\n                language: \"en-US\",\r\n                decimalSeparator: \".\",\r\n                decimalDigits: \"2\",\r\n                symbol: \"$\",\r\n                ShortDateFormat: \"M/d/yyyy\",\r\n                TimeFormat: \"h:mm tt\",\r\n                LongDateFormat: \"dddd, MMMM d, yyyy\",\r\n                twoDigitYearMax: 2029,\r\n                twoDigitYearMaxDelta: 13,\r\n                uploadMaxFileSize: \"1048576\",\r\n                isMultiOrganization: \"false\",\r\n                associatedStakeholders: [],\r\n                sUserProperties : []\r\n            };\r\n\r\n            defer.resolve(data);\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getAllProcesses: function(params) {\r\n        var self = this;\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n        if (params.inputtray == \"inbox\") {\r\n            return self._super(params);\r\n        } else {\r\n            return $.when(self.database.getAllProcesses(params)).pipe(function(response) {\r\n                response = JSON.parse(response);\r\n                // Aggrupate workflows by categories\r\n                if (!!params.skipAggrupate)\r\n                    return response;\r\n                var responseData = {};\r\n                var categories = {};\r\n                var allProcesses = bizagi.localization.getResource(\"workportal-widget-inbox-all-processes\");\r\n                var allCases = {\r\n                    name: bizagi.localization.getResource(\"workportal-widget-inbox-all-cases\"),\r\n                    path: \"\",\r\n                    category: allProcesses,\r\n                    isFavorite: (params.onlyFavorites || false),\r\n                    guidFavorite: \"\",\r\n                    idworkflow: \"\",\r\n                    guidWFClass: \"\",\r\n                    count: 0\r\n                };\r\n\r\n                // Create a default category\r\n                categories[allProcesses] = [];\r\n                categories[allProcesses].workflows = [];\r\n                categories[allProcesses].workflows.push(allCases);\r\n                if (response.workflows) {\r\n                    $.each(response.workflows.workflow, function(i, workflow) {\r\n                        // Creates the category if it doesn't exist\r\n                        if (!categories[workflow.category]) {\r\n                            categories[workflow.category] = [];\r\n                            categories[workflow.category].workflows = [];\r\n                        }\r\n\r\n                        // Push the workflow\r\n                        categories[workflow.category].workflows.push(workflow);\r\n\r\n                        // Sum the cases count\r\n                        allCases.count += Number(workflow.count);\r\n                    });\r\n                }\r\n\r\n                // Build result array once grouped\r\n                responseData.categories = [];\r\n                for (key in categories) {\r\n                    responseData.categories.push({\r\n                        name: key,\r\n                        workflows: categories[key].workflows\r\n                    });\r\n                }\r\n                return responseData;\r\n            });\r\n\r\n        }\r\n    },\r\n    /*\r\n     *   Returns all the cases for the current user filtered by a workflow\r\n     */\r\n    getCasesByWorkflow: function(params) {\r\n        var self = this;\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            if (self.online) {\r\n                return self._super(params);\r\n            } else {\r\n                var defer = new $.Deferred();\r\n                $.when(self.getCustomizedColumnsDataTasks(params)).pipe(function(response) {\r\n                    response = JSON.parse(response);\r\n                    $.each(response.cases.rows, function(key, value) {\r\n                        var newFieldsValue = [];\r\n\r\n                        //  Set id of case to radnumber\r\n                        response.cases.rows[key][\"radnumber\"] = value.id;\r\n                        $.each(value.fields, function(fieldsKey, fieldsValue) {\r\n                            // when delete element from fields array, each function lose key value\r\n                            if (fieldsValue != undefined) {\r\n                                // Radnumber\r\n                                try {\r\n                                    if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == \"true\") {\r\n                                        response.cases.rows[key][\"radnumber\"] = fieldsValue.Value;\r\n                                    } else if (fieldsValue.workitems != undefined) {\r\n                                        response.cases.rows[key][\"workitems\"] = fieldsValue.workitems;\r\n                                    } else {\r\n                                        newFieldsValue.push(fieldsValue);\r\n                                    }\r\n                                } catch (e) {\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        // Update Fields\r\n                        response.cases.rows[key]['fields'] = newFieldsValue;\r\n                    });\r\n                    defer.resolve(response.cases);\r\n                });\r\n                return defer.promise();\r\n\r\n            }\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            $.when(self.database.getCustomizedColumnsData(params)).pipe(function(response) {\r\n                response = JSON.parse(response);\r\n                $.each(response.cases.rows, function(key, value) {\r\n                    var newFieldsValue = [];\r\n\r\n                    //  Set id of case to radnumber\r\n                    response.cases.rows[key][\"radnumber\"] = value.id;\r\n                    $.each(value.fields, function(fieldsKey, fieldsValue) {\r\n                        // when delete element from fields array, each function lose key value\r\n                        if (fieldsValue != undefined) {\r\n                            // Radnumber\r\n                            try {\r\n                                if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == \"true\") {\r\n                                    response.cases.rows[key][\"radnumber\"] = fieldsValue.Value;\r\n                                } else if (fieldsValue.workitems != undefined) {\r\n                                    response.cases.rows[key][\"workitems\"] = fieldsValue.workitems;\r\n                                } else {\r\n                                    newFieldsValue.push(fieldsValue);\r\n                                }\r\n                            } catch (e) {\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    // Update Fields\r\n                    response.cases.rows[key]['fields'] = newFieldsValue;\r\n                });\r\n                defer.resolve(response.cases);\r\n            });\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     * Get columns data from offline tasks\r\n     */\r\n    getCustomizedColumnsDataTasks: function(params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            params[\"radNumber\"] = params.radnumber ? params.radnumber : params.radNumber;\r\n        }\r\n\r\n        if (params.idcase || params.idCase) {\r\n            params[\"radNumber\"] = params.idcase ? params.idcase : params.idCase;\r\n        }\r\n\r\n\r\n\r\n        $.when(self.database.getOfflineCases({isOpen: true}))\r\n            .pipe(function(resp) {\r\n                tasks = resp.elements;\r\n                for (var i = 0, len = tasks.length; i < len; i++) {\r\n                    var currTask = tasks[i];\r\n                    if (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === currTask[0]) {\r\n                        var localCase = {\r\n                            id: currTask[0],\r\n                            idWFClass: currTask[10],\r\n                            idWorkFlow: currTask[10],\r\n                            taskState: currTask.taskState,\r\n                            isFavorite: currTask[9],\r\n                            isEdited: currTask.isEdited,\r\n                            offlineType: 'task',\r\n                            //guidFavorite: currTask.guidfavorite.value,\r\n                            isOpen: true,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                {\r\n                                    Value: currTask.wfclsdisplayname,\r\n                                    DisplayName: currTask.wfclsdisplayname,\r\n                                    DataType: \"VarChar\",\r\n                                    isRadNumber: false\r\n                                }, {\r\n                                    Value: currTask[12],\r\n                                    DisplayName: \"Process creation date\",\r\n                                    DataType: \"DateTime\",\r\n                                    isRadNumber: false\r\n                                }\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(currTask[0]);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                deferred.resolve(JSON.stringify(cases));\r\n            });\r\n\r\n        return deferred.promise();\r\n    },\r\n    /*\r\n     *  Get Menu Authorization\r\n     */\r\n    getMenuAuthorization: function() {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super();\r\n        } else {\r\n            // Call ajax and returns promise\r\n            var defer = new $.Deferred();\r\n            var data = {\r\n                \"permissions\": [\r\n                    { \"Cases\": [\"NewCase\", \"Pending\", \"Closed\", \"Search\"] },\r\n                    {\r\n                        \"AnalysisReports\": [\r\n                            \"BAMProcess\", \"BAMTask\", \"AnalyticsProcess\", \"AnalyticsTask\", \"AnalyticsSensor\",\r\n                            \"AnalysisQueries\", \"BAMResourceMonitor\"\r\n                        ]\r\n                    }, {\r\n                        \"Admin\": [\r\n                            \"UserAdmin\", \"Licenses\", \"EntityAdmin\", \"CaseAdmin\", \"AlarmAdmin\", \"EncryptionAdmin\",\r\n                            \"MobileUpdatesAdmin\", \"AsynchronousWorkitemRetries\", \"UserPendingRequests\",\r\n                            \"AuthenticationLogQuery\", \"BusinessPolicies\", \"Profiles\", \"UserDefaultAssignation\",\r\n                            \"GRDimensionAdmin\", \"ThemeBuilder\"\r\n                        ]\r\n                    }, { \"CurrentUserAdministration\": [\"CurrentUser\"] }, { \"LogOut\": [] }, { \"Search\": [] },\r\n                    { \"SmartFolders\": [] }, { \"CustomFolders\": [] }, { \"BizagiQueries\": [] }, { \"AnalysisQueries\": [] },\r\n                    { \"StateLog\": [] }, { \"PrintableVersion\": [] }\r\n                ]\r\n            };\r\n\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Gets the inbox summary for the current logged user\r\n     *   Returns a promise of the data being retrieved\r\n     */\r\n    getInboxSummary: function(params) {\r\n        var self = this;\r\n        var enableDefaultMethod = self.online;\r\n        if (params && (params.inputtray == \"false\" || params.inputtray == \"true\")) {\r\n            enableDefaultMethod = false;\r\n        }\r\n        if (enableDefaultMethod) {\r\n            return self._super(params);\r\n        } else {\r\n            // Call ajax and returns promise\r\n            var defer = new $.Deferred();\r\n            $.when('{\"inboxSummary\":{\"Red\":7,\"Yellow\":0,\"Green\":0,\"Black\":0,\"All\":7}}').pipe(function(response) {\r\n                var data = JSON.parse(response);\r\n                defer.resolve(data[\"inboxSummary\"]);\r\n            });\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Returns the available categories filtered by a parent category\r\n     *   If not parent category is sent, it will return the base categories\r\n     */\r\n    getCategories: function(params) {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            // Define data\r\n            params = params || {};\r\n            var data = {};\r\n\r\n            // Required params\r\n            if (params.idCategory)\r\n                data[\"idCategory\"] = params.idCategory;\r\n            if (params.idApp)\r\n                data[\"idApp\"] = params.idApp;\r\n\r\n            data[\"enableOfflineForm\"] = params.enableOfflineForm || false;\r\n\r\n\r\n            data[\"groupByApp\"] = params.groupByApp || false;\r\n\r\n            // Call ajax and returns promise\r\n            return self.database.getCategories(data);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * CREATE NEW CASES\r\n     */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            return self.database.createNewCase(params);\r\n        }\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            if (bizagi.util.isNativePluginSupported() && typeof (bizagiapp.getCase) !== \"undefined\") {\r\n                return self.getNativeWorkItems(params);\r\n            } else {\r\n                return self.database.getWorkitems(params);\r\n            }\r\n\r\n        }\r\n    },\r\n\r\n    getNativeWorkItems: function(params){\r\n        var defer = new $.Deferred();\r\n\r\n        bizagiapp.getCase(params.idCase, function(response){\r\n\r\n            var workItems = JSON.parse(response);\r\n\r\n            defer.resolve(workItems);\r\n\r\n        }, function(response){\r\n            defer.reject(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    getCaseSummary: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            return self.database.getSummary(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Delete offline cases created localy\r\n     *   return a promise\r\n     */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        return self.database.deleteCase(params);\r\n    },\r\n\r\n    /*\r\n     *   Get subprocesses\r\n     *   return a promise\r\n     */\r\n    getCaseSubprocesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            defer.resolve({ subProcesses: [] });\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This service get all overrides keys within configuration project\r\n     *\r\n     * @return {json}\r\n     */\r\n    getOverrides: function() {\r\n        return {};\r\n    },\r\n\r\n    /**\r\n     * Return all the available cases in bizagi and thinking for mobile response\r\n     * @param {} params: inputtray:  inbox | outbox-new | outbox-finished | drafts \r\n     * @returns {}\r\n     */\r\n    getCasesListBeta: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            if (self.online) {\r\n                self.fetchOfflineData();                \r\n                return self._super(params)\r\n            } else {\r\n                //Bring work items from db that contain offlineform\r\n                var deferred = new $.Deferred();\r\n                $.when(self.database.getOfflineCases({isOpen: true}))\r\n                    .pipe(function(tasks) {\r\n                        var taskFeedData = self.getTaskFeedData(tasks);\r\n                        deferred.resolve(taskFeedData);\r\n                    });\r\n\r\n                return deferred.promise();\r\n            }\r\n        } else if(params.inputtray === \"drafts\" || params.inputtray === \"outbox-new\"){\r\n            \r\n            var defer = new $.Deferred();\r\n            $.when(self.database.getCasesList(params))\r\n                .pipe(function(response) {\r\n                    var taskFeedData = self.getTaskFeedData(response);\r\n                    defer.resolve(taskFeedData);\r\n                });\r\n\r\n            return defer.promise();\r\n        } else {\r\n            var defer = new $.Deferred();            \r\n            $.when(self.database.getOfflineCases({isOpen: false}))\r\n                .pipe(function(tasks) {\r\n                    var taskFeedData = self.getTaskFeedData(tasks);\r\n                    defer.resolve(taskFeedData);\r\n                });\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    getMobileCasesList: function(params) {\r\n        var self = this;\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } else {\r\n            return getCasesListBeta(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Customize Columns\r\n     */\r\n    getTaskFeedData: function(response) {\r\n        var overdue = bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n        var today = bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n        var tomorrow = bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n        var upcoming = bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n\r\n        var groupedData = {\r\n            elements: [],\r\n            page: response.page,\r\n            totalPages: response.totalPages,\r\n            advanceSearch: false\r\n        };\r\n\r\n        var actualDate = new Date();\r\n        var actualMonth = actualDate.getMonth();\r\n        var actualDay = actualDate.getDate();\r\n        var actualYear = actualDate.getFullYear();\r\n\r\n        for (var counter = 0; response.elements.length > counter; counter++) {\r\n            var tmpElement = response.elements[counter];\r\n            if(tmpElement.offlineType !== undefined && tmpElement.offlineType === \"task\")\r\n                tmpElement[3] = tmpElement.endDate;\r\n            var status = {};\r\n\r\n            var originalEndDate = tmpElement[3];\r\n\r\n            if (tmpElement[3] !== \"\") {\r\n                var tmpdate = new Date(tmpElement[3]);\r\n                var tmpDay = tmpdate.getDate();\r\n                var tmpMonth = tmpdate.getMonth();\r\n                var tmpYear = tmpdate.getFullYear();\r\n                var dateDiff = ((new Date(tmpYear, tmpMonth, tmpDay, 0, 0, 0)\r\n                - new Date(actualYear, actualMonth, actualDay, 0, 0, 0)));\r\n\r\n                if (dateDiff < 0) {\r\n                    tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]),\r\n                        \"MMMM dd | hh:mm tt\");\r\n                    status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" };\r\n                } else {\r\n                    if (actualMonth === tmpMonth && actualDay === tmpDay) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n\r\n                        // Define if the case is overdue\r\n                        if (tmpdate.getTime() < actualDate.getTime()) {\r\n                            status = {\r\n                                group: \"2|\" + today + \", \"\r\n                                + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                state: \"red\",\r\n                                type: \"today\",\r\n                                icon: \"overdue\"\r\n                            };\r\n                        } else {\r\n                            status = {\r\n                                group: \"2|\" + today + \", \"\r\n                                + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                state: \"yellow\",\r\n                                type: \"today\",\r\n                                icon: \"ontime\"\r\n                            };\r\n                        }\r\n                    } else if (actualMonth === tmpMonth && (actualDay + 1) === tmpDay) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n                        status = {\r\n                            group: \"3|\" + tomorrow + \", \"\r\n                            + bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd\"),\r\n                            state: \"yellow\",\r\n                            type: \"tomorrow\",\r\n                            icon: \"ontime\"\r\n                        };\r\n                    } else {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd | hh:mm tt\");\r\n                        status = { group: \"4|\" + upcoming, state: \"green\", type: \"upcoming\", icon: \"upcoming\" };\r\n                    }\r\n                }\r\n            } else {\r\n                tmpElement[3] = \"--\";\r\n                status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" }\r\n            }\r\n\r\n            groupedData.elements.push($.extend({}, tmpElement, status,\r\n                { \"endDate\": originalEndDate, \"idworkitem\": tmpElement[1] }));\r\n        }\r\n\r\n        return groupedData;\r\n    },\r\n\r\n    /*\r\n     * Render Details\r\n     * @param idWorkitem\r\n     */\r\n    summaryCaseDetails: function(options) {\r\n        var self = this;\r\n        var params = options || {};\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            var def = $.Deferred();\r\n            var idWorkitem = options[\"idWorkitem\"] || 0;\r\n\r\n            $.when(self.getCaseSummaryDataContent(options))\r\n                .done(function(data) {\r\n\r\n                    data.currentState = data.currentState || [];\r\n                    var dataCurrentStateLength = data.currentState.length;\r\n\r\n                    // Show or hide tabs\r\n                    data[\"showEvents\"] = (data[\"countEvents\"] >= 1) ? true : false;\r\n                    data[\"showParentProcess\"] = (data[\"idParentCase\"] >= 1) ? true : false;\r\n                    data[\"parentProcess\"] = {\r\n                        'displayName': data[\"parentDisplayName\"],\r\n                        'idCase': data[\"idParentCase\"]\r\n                    };\r\n\r\n                    data[\"isClosed\"] = (data[\"isOpen\"] == \"true\") ? false : true;\r\n                    data[\"showAssignees\"] = (data[\"countAssigness\"] >= 1) ? true : false;\r\n                    data[\"showSubProcess\"] = (data[\"countSubProcesses\"] >= 1) ? true : false;\r\n                    data[\"showForm\"] = (data[\"hasGlobalForm\"] == \"true\") ? true : false;\r\n                    data[\"allowsReassign\"] = \"false\";\r\n\r\n                    for (var i = 0; i < dataCurrentStateLength; i++) {\r\n                        if (data[\"currentState\"][i][\"idWorkItem\"] == idWorkitem) {\r\n                            data[\"allowsReassign\"] = data[\"currentState\"][i][\"allowsReassign\"];\r\n                        }\r\n                    }\r\n\r\n                    // edit original data, no show events in activities tab\r\n                    var currentStateTypes = [];\r\n                    var m = 0; // counter for new activities array\r\n                    for (var j = 0; j < data[\"currentState\"].length; j++) {\r\n                        if (data[\"currentState\"][j][\"isEvent\"] == \"false\" &&\r\n                            data[\"currentState\"][j][\"assignToCurrentUser\"] == \"true\" &&\r\n                            data[\"currentState\"][j][\"idWorkItem\"] != idWorkitem) {\r\n                            currentStateTypes[m++] = data[\"currentState\"][j];\r\n                        }\r\n                    }\r\n\r\n                    data[\"currentStateTypes\"] = currentStateTypes;\r\n                    data[\"showActivities\"] = (currentStateTypes.length >= 1) ? true : false;\r\n\r\n                    def.resolve(data);\r\n                });\r\n\r\n            return def.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     *  Get json from cases service\r\n     */\r\n    getCaseSummaryDataContent: function(options) {\r\n        var self = this;\r\n        var promise = new $.Deferred();\r\n\r\n        $.when(self.getCaseSummary(options))\r\n            .done(function(data) {\r\n                // Completes data\r\n                data.taskState = self.icoTaskState;\r\n                data.process = data.process ? data.process : \"\";\r\n\r\n                if (data.createdBy) {\r\n                    data.createdByName = data.createdBy.Name;\r\n                    data.createdByUserName = data.createdBy.userName;\r\n                    data.caseDescription = (data.caseDescription == '' ? '' : data.caseDescription);\r\n                    data.processPath = data.processPath.replace(/\\//g, ' > ') + data.process;\r\n                    data.showWorkOnIt = true;\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n        return promise.promise();\r\n    },\r\n\r\n    /*\r\n     *   Returns the data for the inbox grid view\r\n     */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            $.when(self.database.getCustomizedColumnsNewData(params))\r\n                .pipe(function(response) {\r\n                    defer.resolve(JSON.parse(response));\r\n                });\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Returns the recent process\r\n     */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            return self.database.getRecentProcesses(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Start process in BizAgi\r\n     */\r\n    startProcess: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            var data = {\r\n                hasStartForm: false,\r\n                idProcess: params.idProcess,\r\n                displayName: params.displayName,\r\n                caseInfo: {}\r\n            }\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get stakeholder shortCurts\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    getShortCuts: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the available list of searches\r\n     * @returns {}\r\n     */\r\n    getSearchLists: function() {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super();\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get the icon of a given collection\r\n     * @param params\r\n     */\r\n    getCollectionIcon: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the recent process\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    getRecentOfflineProcesses: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        \r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('process-handler-getRecentProcesses'),\r\n            data: params,\r\n            dataType: 'json',\r\n            type: 'GET',\r\n            avoidLoader: true\r\n        })\r\n        .then(function (data) {\r\n\r\n            var processes = data[\"processes\"] || [];\r\n            var recentProcess = {\"processes\": []};\r\n\r\n            if (!bizagi.util.isObjectEmpty(processes)) {\r\n                var item;\r\n                var counter = -1;\r\n                while ((item = processes[++counter])) {\r\n                    if (item.hasOfflineForm) {\r\n                        recentProcess.processes.push(item);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return recentProcess;\r\n        });\r\n    },\r\n\r\n    downloadImage: function(params, form, imageRenderControl){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var getPropertyDataParams = {\r\n            prepare: false,\r\n            xpath: imageRenderControl.xpath,\r\n            idRender: imageRenderControl.renderId,\r\n            xpathContext: \"\",\r\n            idPageCache: form.pageCacheId,\r\n            sessionId : form.sessionId,\r\n            property: \"fileFullContent\"\r\n        };\r\n\r\n        $.when(self.renderDataService.getPropertyData(getPropertyDataParams))\r\n            .done( function (base64Image){\r\n                if(base64Image != undefined){\r\n                    var saveParams = {\r\n                        id: imageRenderControl.xpath,\r\n                        idCase: params.idCase,\r\n                        idWorkitem: params.idWorkitem,\r\n                        operationType: \"synchronization\"\r\n                    };\r\n                    $.when(self.database.saveActivityFormImage( saveParams, base64Image))\r\n                        .done( function(resp){\r\n                            def.resolve(resp);\r\n                        })\r\n                        .fail(function (err) {\r\n                            def.reject(err);\r\n                        });\r\n                }\r\n                else{\r\n                    def.resolve();\r\n                }\r\n            })\r\n            .fail(function(error){\r\n                def.reject(error);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    downloadBinaryFile: function( form, uploadControl, fileId, fileName ){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var getFileUrlParams = {\r\n            xpath: uploadControl.xpath,\r\n            idRender: uploadControl.renderId,\r\n            xpathContext: \"\",\r\n            idPageCache: form.form.pageCacheId,\r\n            fileId : fileId,\r\n            sessionId: form.form.sessionId\r\n        };\r\n\r\n        //Crear URL\r\n        var fileUrl = self.renderDataService.getUploadFileUrl(getFileUrlParams);\r\n        // var xhr = new XMLHttpRequest();\r\n        // xhr.open(\"GET\", fileUrl);\r\n        // xhr.responseType = \"blob\";\r\n        // xhr.onload = function () {\r\n        //     var blob = this.response;\r\n        //     blob.name = fileName;\r\n        //     def.resolve(blob);\r\n        // };\r\n        // xhr.onerror = function() {\r\n        //     def.resolve(null);\r\n        // }\r\n        // xhr.send();\r\n\r\n        $.ajax({\r\n            url: fileUrl,\r\n            type: \"GET\",\r\n            dataType: \"binary\",\r\n            processData: false //Always false for binary dataType\r\n        }).then(function (binary_file) {\r\n            if (binary_file.type == \"application/json\") {\r\n                var reader = new FileReader();\r\n                reader.onloadend = function () {\r\n                    // reader.result contains the contents of blob as a typed array\r\n                    def.reject({ responseText: reader.result });\r\n                };\r\n                reader.readAsText(binary_file);\r\n            } else {\r\n                if (typeof binary_file == \"string\") {\r\n                    var xhr = arguments[2];\r\n                    var contentType = xhr.getResponseHeader('Content-type');\r\n                    binary_file = self.byteArrayToBlob(self.stringToByteArray(binary_file), contentType);\r\n                }\r\n                binary_file.name = fileName;\r\n                def.resolve(binary_file);\r\n            }\r\n        }).fail(function (error) {\r\n            def.reject(error);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    downloadFilesInUploadControl: function(params, form, uploadControl, promisesArray){\r\n        var self = this;\r\n        if(uploadControl.value && Array.isArray(uploadControl.value)){\r\n            uploadControl.value.forEach( function(singleFileValue){\r\n                var fileId = singleFileValue[0];\r\n                var fileName = singleFileValue[1];\r\n                promisesArray.push(self.downloadSingleFile(params, form, uploadControl, fileId, fileName));\r\n            });\r\n        }\r\n    },\r\n\r\n    downloadSingleFile: function(params, form, uploadControl, fileId, fileName){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var downloadPromise = self.downloadBinaryFile(form, uploadControl, fileId, fileName);\r\n        $.when(downloadPromise)\r\n            .done( function(binaryFile){\r\n                if(binaryFile){\r\n                    params.operationType = \"synchronization\";\r\n                    params.id = uploadControl.xpath + '.' + fileId;\r\n                    self.renderDataService.saveOfflineFile(params, binaryFile, binaryFile.type);\r\n                }\r\n                def.resolve(binaryFile);\r\n            })\r\n            .fail( function(downloadError){\r\n                def.reject(downloadError);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    convertUploadOnlineValueInOfflineValue: function(uploadControl, data){\r\n        var self = this;\r\n        var offlineValue = [];\r\n        if(uploadControl.value && Array.isArray(uploadControl.value)){\r\n            uploadControl.value.forEach( function(singleFileValue){\r\n                var fileName = singleFileValue[1];\r\n                var fileExtension = bizagi.util.media.getFileExtension(fileName).toLowerCase();\r\n                offlineValue.push(\r\n                    {\r\n                        id: singleFileValue[0],\r\n                        fileName: fileName,\r\n                        mimeType: bizagi.util.media.getMIMETypeByExtension(fileExtension),\r\n                        status: \"existent\"\r\n                    }\r\n                );\r\n            });\r\n        }\r\n        data[uploadControl.xpath] = offlineValue;\r\n    },\r\n\r\n    syncOfflineStartCase: function(params){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n\r\n        var loadFormParams = {\r\n            action: \"LOADSTARTFORM\",\r\n            idProcess : params.idProcess,\r\n            downloadOfflineForm: true\r\n        };\r\n\r\n        $.when(self.renderDataService.getFormData(loadFormParams))\r\n            .then( function(serverResponse) {\r\n                if(serverResponse.errorType){\r\n                    self.database.updateCaseSyncStatus({\r\n                        type: \"start\",\r\n                        id: params.id || params.idCase,\r\n                        syncStatus: \"failed\",\r\n                        syncDetails: serverResponse\r\n                    });\r\n                    def.reject(serverResponse);\r\n                }\r\n                else if(serverResponse.form){\r\n                    $.when(self.database.separateComplexControls({ offlineType: \"start\" }, params.data))\r\n                        .then( function (separatedCaseData){\r\n                            params.pageCacheId = serverResponse.form.pageCacheId;\r\n                            params.sessionId = serverResponse.form.sessionId;\r\n                            params.offlineType = \"start\";\r\n                            return self.performSyncOfflineCase(params, separatedCaseData, def);\r\n                        })\r\n                        .fail( function(err){\r\n                            def.reject(err);\r\n                        });\r\n                }\r\n                else{\r\n                    def.reject(\"Form not found in server response\");\r\n                }\r\n            })\r\n            .fail( function(getFormErr){\r\n                self.database.updateCaseSyncStatus({\r\n                    type: \"start\",\r\n                    id: params.id || params.idCase,\r\n                    syncStatus: \"failed\",\r\n                    syncDetails: getFormErr\r\n                });\r\n                def.reject(getFormErr);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    performSyncOfflineCase: function(params, sData, promise){\r\n        var self = this;\r\n        var offlineType = params.offlineType;\r\n        var separatedCaseData = sData;\r\n        var data = sData.data;\r\n        var imageValues = separatedCaseData.images;\r\n        var uploadValues = separatedCaseData.uploads;\r\n        var gridValues = separatedCaseData.grids;\r\n        var uploadParams = {\r\n            pageCacheId: params.pageCacheId,\r\n            sessionId: params.sessionId,\r\n            idCase: params.idCase,\r\n            offlineType: offlineType,\r\n            idWorkitem: params.idWorkitem\r\n        };\r\n\r\n        var uploadPromises = [];\r\n        var actions = [];\r\n\r\n        if(uploadValues){\r\n            uploadValues.forEach( function(uploadControlValue){\r\n                self.generateUploadPromisesAndDeleteActionsForFilesInUploadControl(uploadParams,\r\n                    uploadControlValue, uploadPromises, actions);\r\n            });\r\n        }\r\n\r\n        if(imageValues){\r\n            imageValues.forEach( function(imageControlValue){\r\n                self.generateUploadPromiseForImageControl(uploadParams, imageControlValue,\r\n                    uploadPromises);\r\n            });\r\n        }\r\n\r\n        $.when.apply($, uploadPromises)\r\n        .then(function(){\r\n            processMultiAction();\r\n        })\r\n        .fail(function(failResponses){\r\n            console.log(\"SYNCH: ERROR in uploadPromises\");\r\n            console.log(failResponses);\r\n            promise.reject();\r\n        });\r\n\r\n        function processMultiAction() {\r\n            \r\n            if(gridValues){\r\n                var gridPromises = self.generateGridPromises(gridValues, params.pageCacheId);\r\n                if(gridPromises.bizAdditions && gridPromises.bizAdditions.length> 0)\r\n                    actions = actions.concat(gridPromises.bizAdditions)\r\n                if(gridPromises.bizDeletions && gridPromises.bizDeletions.length> 0)\r\n                    actions = actions.concat(gridPromises.bizDeletions)\r\n                \r\n            } \r\n\r\n            var multiActionData = {};\r\n            for (var key in data) {\r\n                var dataValue = data[key];\r\n                if(dataValue && dataValue.value !== undefined)\r\n                    multiActionData[key] = dataValue.value;\r\n                else\r\n                    multiActionData[key] = dataValue;\r\n            } \r\n\r\n            var syncAction;\r\n            if ( offlineType === \"start\" )\r\n                syncAction = \"createnewcase\";\r\n            else {\r\n                switch (data.h_action) {\r\n                    case \"save\":\r\n                        syncAction = \"trysave\";\r\n                        break;\r\n                    case \"next\":\r\n                        syncAction = \"trynext\"\r\n                        break;\r\n                    default:\r\n                        syncAction = data.h_action;\r\n                        break;\r\n                }\r\n            }\r\n            var performActionProm = self.renderDataService.submitData({\r\n                action: syncAction,\r\n                data: multiActionData,\r\n                idPageCache: params.pageCacheId,\r\n                prepare: true,\r\n                transitions: \"\"\r\n            });\r\n            actions.push(performActionProm);\r\n\r\n            $.when(self.renderDataService.multiaction().execute({actions: actions}))\r\n                .done( function(multiactionResponse){\r\n                    console.log('SYNCH: ' + offlineType + ' Case synchronized with server', multiactionResponse);\r\n                    var wasActionPerformed =  multiactionResponse.length > 0  && multiactionResponse[multiactionResponse.length-1].result && multiactionResponse[multiactionResponse.length-1].result.type === 'success';\r\n                    var deleteCasePromise;\r\n                    if(offlineType === \"start\"){\r\n                        deleteCasePromise = self.database.deleteCase(params);\r\n                    }\r\n                    else{\r\n                        deleteCasePromise = self.database.deleteTaskData(params);\r\n                    }\r\n                    $.when(deleteCasePromise)\r\n                        .done( function(deleteResponse){\r\n                            if(wasActionPerformed){\r\n                                var syncActionTagResponse = multiactionResponse[multiactionResponse.length-1].result;\r\n                                promise.resolve(syncActionTagResponse);\r\n                            }\r\n                            else {\r\n                                promise.reject(multiactionResponse);\r\n                            }\r\n                            console.log('SYNCH: Case data deleted of internal table', deleteResponse);\r\n                        })\r\n                        .fail( function(deleteError){\r\n                            promise.reject(deleteError);\r\n                            console.log('SYNCH: Error deleting Case data of internal table', deleteError);\r\n                        });\r\n\r\n                    if(offlineType === \"task\" && wasActionPerformed && syncAction === \"trynext\" ){\r\n                        self.database.deleteTaskForm(params).done( function(delFormResponse){\r\n                            console.log('SYNCH: Task form deleted of internal table', delFormResponse);\r\n                        });\r\n                    }\r\n                })\r\n                .fail( function(multiactionError){\r\n                    self.database.updateCaseSyncStatus({\r\n                        type: offlineType,\r\n                        id: params.id,\r\n                        syncStatus: \"failed\",\r\n                        syncDetails: multiactionError\r\n                    });\r\n                    console.log(\"Multiaction error\", multiactionError);\r\n                    promise.reject(multiactionError);\r\n                });\r\n        }\r\n    },\r\n\r\n    syncOfflineTaskCase: function(params) {\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var data  = params.data;\r\n        delete params[\"data\"];   \r\n        \r\n        params.downloadOfflineForm = true;     \r\n\r\n        //Retrieve the form from server in order to obtain a valid idPageCache\r\n        var serverFormProm = self.renderDataService.getFormData(params);\r\n        $.when(serverFormProm)\r\n        .then( function(serverResponse) {\r\n            if(serverResponse.errorType){\r\n                return $.when(self.database.updateCaseSyncStatus({\r\n                    type: \"task\",\r\n                    id: params.idCase + \"-\" + params.idWorkitem,\r\n                    syncStatus: \"failed\",\r\n                    syncDetails: serverResponse\r\n                }))\r\n                .always(function(updateResponse){\r\n                    def.reject(serverResponse);\r\n                });\r\n            }\r\n            else {\r\n                return $.when(self.database.separateComplexControls(params, data))\r\n                .then( function (separatedCaseData){\r\n                    params.pageCacheId = serverResponse.form.pageCacheId;\r\n                    params.sessionId = serverResponse.form.sessionId;\r\n                    params.offlineType = \"task\";\r\n                    params.id = params.idCase + \"-\" + params.idWorkitem;\r\n                    return self.performSyncOfflineCase(params, separatedCaseData, def);\r\n                })\r\n                .fail( function(syncError){\r\n                    def.reject(syncError);\r\n                });\r\n            }\r\n        })\r\n        .fail( function(getFormError){\r\n            self.database.updateCaseSyncStatus({\r\n                type: \"task\",\r\n                id: params.idCase + \"-\" + params.idWorkitem,\r\n                syncStatus: \"failed\",\r\n                syncDetails: getFormError\r\n            });\r\n            def.reject(getFormError);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    generateUploadPromisesAndDeleteActionsForFilesInUploadControl: function(params,\r\n                                                                            uploadControl, uploadPromises, deleteActions){\r\n\r\n        var self = this;\r\n        var files = uploadControl.value;\r\n        if(!files || files.length == 0){\r\n            return;\r\n        }\r\n        files.forEach( function(file){\r\n            var status = file.status;\r\n            if(\"new\" === status){\r\n                var uploadParams = {\r\n                    fileId: file.id,\r\n                    fileName: file.fileName,\r\n                    fileMimeType: file.mimeType\r\n                }\r\n                $.extend(uploadParams, params);\r\n                var uploadPromise  = self.generateFileUploadPromise(uploadParams, uploadControl);\r\n                uploadPromises.push(uploadPromise);\r\n            }\r\n            else if (\"deleted\" === status){\r\n                var deleteParams = {\r\n                    renderId: uploadControl.renderId,\r\n                    xpath: uploadControl.xpath,\r\n                    fileId: file.id,\r\n                    idPageCache: params.pageCacheId\r\n                }\r\n                var deleteAction = self.generateFileDeleteAction(deleteParams);\r\n                deleteActions.push(deleteAction);\r\n            }\r\n        });\r\n    },\r\n\r\n    generateFileUploadPromise: function(params, uploadControl){\r\n        var self = this;\r\n        var uploadDeferred = new $.Deferred();\r\n        var xpath = uploadControl.xpath;\r\n        var attachmentId = xpath + '.' + params.fileId;\r\n\r\n        var getFilePromise;\r\n        var offlineType = params.offlineType;\r\n        if( offlineType && offlineType === \"start\"){\r\n            var getFileParams = {\r\n                id: attachmentId,\r\n                idCase: params.idCase,\r\n                offlineType: offlineType\r\n            };\r\n            getFilePromise = self.renderDataService.getOfflineFile(getFileParams,\r\n                bizagi.util.db.AttachmentType.Blob , params.fileMimeType);\r\n        }\r\n        else{\r\n            var getFileParams = {\r\n                id: attachmentId,\r\n                idCase: params.idCase,\r\n                idWorkitem: params.idWorkitem\r\n            };\r\n            getFilePromise = self.renderDataService.getOfflineActivityDataFile(getFileParams,\r\n                bizagi.util.db.AttachmentType.Blob , params.fileMimeType);\r\n        }\r\n\r\n\r\n        $.when(getFilePromise)\r\n            .done( function(blobFile){\r\n                if(blobFile){\r\n                    var uploadFileParams = {\r\n                        xpath: xpath,\r\n                        renderId: uploadControl.renderId,\r\n                        pageCacheId: params.pageCacheId,\r\n                        sessionId: params.sessionId,\r\n                        fileName: params.fileName\r\n                    };\r\n                    $.when(self.uploadFile(uploadFileParams, blobFile))\r\n                        .done( function(resp){\r\n                            uploadDeferred.resolve(resp);\r\n                        })\r\n                        .fail( function(err){\r\n                            uploadDeferred.reject(err);\r\n                        });\r\n                }\r\n                else{\r\n                    uploadDeferred.reject();\r\n                }\r\n            });\r\n        return uploadDeferred.promise();\r\n    },\r\n\r\n    generateFileDeleteAction: function( params ){\r\n        var self = this;\r\n        var fileId = params.fileId;\r\n        var fileXpath = params.xpath + (bizagi.util.isNumeric(fileId) ? \"[id=\" + fileId + \"]\" : \"[id='\" + fileId + \"']\");\r\n        var deleteParams = {\r\n            xpath: fileXpath,\r\n            idRender: params.renderId,\r\n            xpathContext: \"\",\r\n            idPageCache: params.idPageCache,\r\n            prepare: true\r\n        };\r\n        return self.renderDataService.deleteUploadFile(deleteParams);\r\n    },\r\n\r\n    uploadFile: function(params, binaryFile){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n\r\n        var formData = new FormData();\r\n        formData.append(\"h_xpath\", params.xpath);\r\n        formData.append(\"h_idRender\", params.renderId);\r\n        formData.append(\"h_xpathContext\", \"\");\r\n        formData.append(\"h_pageCacheId\", params.pageCacheId);\r\n        formData.append(\"p_sessionId\", params.sessionId);\r\n        formData.append(params.xpath, binaryFile, params.fileName);\r\n        try {\r\n            (BIZAGI_SESSION_NAME != undefined) ?\r\n                formData.append(BIZAGI_SESSION_NAME, params.sessionId) :\r\n                formData.append(\"JSESSIONID\", params.sessionId);\r\n        } catch (e) {\r\n            formData.append(\"JSESSIONID\", params.sessionId);\r\n        }\r\n\r\n        $.when(self.renderDataService.processUploadFile({\r\n            url: self.renderDataService.getUploadAddUrl(),\r\n            formData: formData\r\n        })).done( function(res){\r\n            if(res.type && res.type === \"error\"){\r\n                def.reject(res);\r\n            }\r\n            else{\r\n                console.log(\"File uploaded\", res);\r\n                def.resolve(res);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    generateUploadPromiseForImageControl: function(params, imageControl, uploadPromises){\r\n        var self = this;\r\n        var uploadImageDeferred = new $.Deferred();\r\n\r\n        var offlineType = params.offlineType;\r\n        var getImagePromise;\r\n        var uploadParams = {\r\n            id: imageControl.value,\r\n            offlineType: offlineType\r\n        }\r\n        $.extend(uploadParams, params);\r\n\r\n        if(offlineType && offlineType === \"start\"){\r\n            getImagePromise = self.renderDataService.getOfflineImage(\r\n                uploadParams, bizagi.util.db.AttachmentType.Blob)\r\n        }\r\n        else{\r\n            getImagePromise = self.renderDataService.getOfflineActivityDataImage(\r\n                uploadParams, bizagi.util.db.AttachmentType.Blob);\r\n        }\r\n\r\n        $.when(getImagePromise)\r\n            .done(function(blobImage){\r\n                if(blobImage){\r\n                    $.extend(uploadParams, imageControl);\r\n                    $.when(self.uploadImage(uploadParams, blobImage))\r\n                        .done( function(){\r\n                            uploadImageDeferred.resolve();\r\n                        })\r\n                        .fail( function(){\r\n                            uploadImageDeferred.reject()\r\n                        });\r\n                }\r\n                else{\r\n                    uploadImageDeferred.reject();\r\n                }\r\n            });\r\n\r\n        uploadPromises.push(uploadImageDeferred);\r\n    },\r\n\r\n    uploadImage: function(params, blob){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var addParams = {};\r\n        addParams[\"h_xpath\"] = params.xpath;\r\n        addParams[\"h_idRender\"] = params.renderId;\r\n        addParams[\"h_xpathContext\"] = \"\";\r\n        addParams[\"h_pageCacheId\"] = params.pageCacheId;\r\n        addParams[\"p_sessionId\"] = params.sessionId;\r\n        addParams[\"h_action\"] = 'savefile';\r\n\r\n        try {\r\n            (BIZAGI_SESSION_NAME != undefined) ?\r\n                addParams[BIZAGI_SESSION_NAME] = params.sessionId :\r\n                addParams[\"JSESSIONID\"] = params.sessionId;\r\n        } catch (e) {\r\n            addParams[\"JSESSIONID\"] = params.sessionId;\r\n        }\r\n        addParams.queueID = \"q_\" + bizagi.util.encodeXpath(params.xpath);\r\n        var uploadParams = {};\r\n\r\n        uploadParams.data = addParams;\r\n        uploadParams.options = {};\r\n        uploadParams.options.fileKey = \"file\";\r\n        uploadParams.options.fileName = blob.name||\"offlineImage_\" + bizagi.util.randomNumber() + \".png\";\r\n        uploadParams.options.mimeType = \"image/png\";\r\n        uploadParams.options.uploadKey = {key: addParams[\"h_xpath\"]};\r\n        uploadParams.options.addUrl = self.renderDataService.getUploadAddFileUrl(false);\r\n\r\n\r\n        var vFD = new FormData();\r\n        //Copy all the atributes to the FormData object\r\n        $.each(uploadParams.data, function (key, item) {\r\n            vFD.append(key, item);\r\n        });\r\n        vFD.append(uploadParams.options.uploadKey.key, blob, uploadParams.options.fileName);\r\n\r\n        $.ajax({\r\n            url: uploadParams.options.addUrl,\r\n            type: \"POST\",\r\n            contentType: false,\r\n            processData: false,\r\n            data: vFD\r\n        }).done(function (resp) {\r\n            if(resp.type && resp.type === \"error\"){\r\n                def.reject(resp);\r\n            }\r\n            else{\r\n                console.log(\"Image uploaded\", resp);\r\n                def.resolve(resp);\r\n            }\r\n        }).fail(function (error) {\r\n            def.reject(error);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /*\r\n     * Retreives the process  from Hierarchy\r\n     *\r\n     */\r\n    getOfflineProcessesHierarchy: function () {\r\n        var self = this;\r\n        var data = {};\r\n        data['removeOnlineItems'] = 'true';\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('offline-getProcessTree'),\r\n            data: data,\r\n            dataType: 'json',\r\n            type: 'GET',\r\n            avoidLoader: true\r\n        });\r\n    },\r\n\r\n    getOfflineTasks: function(){\r\n        var self = this;\r\n        var data = {};\r\n        data[\"pageSize\"] = self.maxOfflineCases;\r\n        data[\"page\"] = 1;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"offline-tasks\"),\r\n            data: data,\r\n            dataType: 'json',\r\n            type: 'GET',\r\n            avoidLoader: true\r\n        });\r\n    },\r\n  \r\n    generateGridPromises: function(gridsData, idPageCache) {\r\n        var self = this;\r\n        var promisesResponse = {\r\n            bizAdditions: [],\r\n            bizDeletions: []\r\n        }\r\n        gridsData.forEach( function(currentGridData) {\r\n            //Addition promises\r\n            if(currentGridData.value[\"new-records\"]){\r\n                var keys = Object.keys(currentGridData.value[\"new-records\"]);\r\n                for(var i = 0; i< keys.length; i++){\r\n                    var rowData = currentGridData.value[\"new-records\"][keys[i]];\r\n                    rowData['idPageCache'] = idPageCache;\r\n                    promisesResponse.bizAdditions.push(self.renderDataService.addGridRecordData(rowData))\r\n                }\r\n            }\r\n            //Delition promises\r\n            if(currentGridData.value[\"deleted-records\"]){\r\n                var keys = Object.keys(currentGridData.value[\"deleted-records\"]);\r\n                for(var i = 0; i< keys.length; i++){\r\n                    var rowData = currentGridData.value[\"deleted-records\"][keys[i]];\r\n                    rowData['idPageCache'] = idPageCache;\r\n                    promisesResponse.bizDeletions.push(self.renderDataService.deleteGridRecord(rowData))\r\n                }\r\n            }\r\n        });\r\n        return promisesResponse;\r\n    },\r\n\r\n    \r\n    downloadOfflineStartForm: function(params){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        params.action = \"LOADSTARTFORM\";\r\n        params.downloadOfflineForm = true;\r\n\r\n        $.when(self.renderDataService.getFormData(params))\r\n        .then( function(serverResponse) {\r\n            if(serverResponse.errorType){\r\n                def.reject(serverResponse);\r\n            }                    \r\n            if(serverResponse.form){\r\n                serverResponse.form.properties.isTaskForm = false;\r\n                var offlineStartFormButtons = [\r\n                    {\r\n                        button: {\r\n                            properties: {\r\n                                actions: [\r\n                                    \"submitData\",\r\n                                    \"refresh\"\r\n                                ],\r\n                                caption: \"render-form-button-save\",\r\n                                id: \"ec0a5a02-0f81-44a7-8d64-ac090a01d61b\"\r\n                            }\r\n                        },\r\n                    },\r\n                    {\r\n                        button: {\r\n                            properties: {\r\n                                actions: [\r\n                                    \"validate\",\r\n                                    \"submitData\",\r\n                                    \"next\",\r\n                                    \"routing\"\r\n                                ],\r\n                                caption: \"render-form-button-next\",\r\n                                id: \"ba81c7af-0d83-4139-879d-b040f0f81bd7\"\r\n                            }\r\n                        }\r\n                    }\r\n                ];\r\n                serverResponse.form.buttons = offlineStartFormButtons;\r\n                serverResponse.lastSynchronization = Date.now();\r\n                return self.database.saveStartForm(params, serverResponse);\r\n            }\r\n            else {\r\n                def.reject(serverResponse);\r\n            } \r\n        })\r\n        .then( function(){\r\n            def.resolve();\r\n        })\r\n        .fail( function(err){\r\n            def.reject();\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    downloadOfflineTaskForm: function(params){        \r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        params.deleteNextButton = false;\r\n        \r\n        $.when(self.getServerTaskForm(params))\r\n        .then( function(form) {\r\n            form.form.properties.isTaskForm = true;\r\n            if (form.form.buttons === undefined || (Array.isArray(form.form.buttons) && form.form.buttons.length == 0 ) )\r\n            {\r\n                var offlineDefaultButtons = [\r\n                    {\r\n                        button: {\r\n                            properties: {\r\n                                actions: [\r\n                                    \"submitData\",\r\n                                    \"refresh\"\r\n                                ],\r\n                                caption: \"render-form-button-save\",\r\n                                id: \"ec0a5a02-0f81-44a7-8d64-ac090a01d61b\"\r\n                            }\r\n                        },\r\n                    },\r\n                    {\r\n                        button: {\r\n                            properties: {\r\n                                actions: [\r\n                                    \"validate\",\r\n                                    \"submitData\",\r\n                                    \"next\",\r\n                                    \"routing\"\r\n                                ],\r\n                                caption: \"render-form-button-next\",\r\n                                id: \"ba81c7af-0d83-4139-879d-b040f0f81bd7\"\r\n                            }\r\n                        }\r\n                    }\r\n                ];\r\n                form.form.buttons = offlineDefaultButtons;\r\n            }\r\n            return self.database.saveTaskForm(params, form);\r\n        })\r\n        .then( function(){ \r\n            def.resolve() \r\n        })\r\n        .fail(function(){ \r\n            def.reject() \r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getServerTaskForm: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var resolvedForm = undefined;\r\n        params.downloadOfflineForm = true;\r\n\r\n        $.when(self.renderDataService.getFormData(params))\r\n        .done( function(form){\r\n            if(form.errorType){\r\n                def.reject(form);\r\n            }\r\n            form.dataChangeset = params.dataChangeset;\r\n            if(params.deleteNextButton){\r\n                form = self.database.deleteNextButton(form);\r\n            }\r\n\r\n            var data = {};\r\n            var downloadPromises = [];\r\n            var uploads = self.database.filterXpathsByType(form, \"upload\");\r\n            uploads.forEach(function(upload){\r\n                self.downloadFilesInUploadControl(params, form, upload, downloadPromises);\r\n                self.convertUploadOnlineValueInOfflineValue(upload, data);\r\n            });\r\n\r\n            var downloadImagesPromise = self.downloadFormImages(form, params);\r\n            downloadPromises.push(downloadImagesPromise);\r\n            \r\n            var mergedFormPromise = new $.Deferred();\r\n            downloadPromises.push(mergedFormPromise);\r\n\r\n            var formPromise = new $.Deferred();\r\n            $.when(self.database.mergeDataDocument(data, null, formPromise))\r\n            .done( function(complexData){\r\n                var object = {data: data};\r\n                object.data = complexData;\r\n                object.isOpen = true;\r\n                self.database.mergeForm(object, formPromise).then(function(mergedForm){\r\n                    mergedFormPromise.resolve(mergedForm);\r\n                    resolvedForm = mergedForm;\r\n                });\r\n            })\r\n            .fail( function(err){\r\n                mergedFormPromise.reject(err);\r\n            });\r\n            formPromise.resolve(form);\r\n\r\n\r\n            $.when.apply($, downloadPromises).then(function(){\r\n                def.resolve(resolvedForm);\r\n            })\r\n            .fail( function() {\r\n                console.log(\"Error downloading task form\", params);\r\n                def.reject();\r\n            });\r\n\r\n        })\r\n        .fail( function(err){\r\n            def.reject(err);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    downloadFormImages: function(form, params){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var imageControls = self.database.filterXpathsByType(form, \"image\");\r\n        var downloadImagesPromises = [];\r\n        imageControls.forEach( function(currentImageControl){\r\n            downloadImagesPromises.push( self.downloadImage(params, form.form, currentImageControl) );\r\n        });\r\n        $.when.apply($, downloadImagesPromises).then(function(){\r\n            def.resolve();\r\n        }).fail( function(error){\r\n            console.log(\"Error downloading images\", params, error);\r\n            def.reject();\r\n        })\r\n        return def.promise();\r\n    },\r\n    // removeOfflineTaskFormsClosed: function(params) {\r\n    //     var self = this;\r\n    //     params = params || {};\r\n    //     var data = [];\r\n\r\n    //     if (typeof params.formsToDelete !== \"undefined\") {\r\n    //         data = params.formsToDelete;\r\n    //     }\r\n\r\n    //     data.forEach(currentForm => {\r\n    //         self.database.\r\n    //     });\r\n\r\n    // },\r\n\r\n});\r\n\r\n","/*\r\n*   Name: BizAgi Rendering Services\r\n*   Author: Diego Parra (based on Edward Morales version)\r\n*   Comments:\r\n*   -   This class will provide a facade to access to workportal REST services\r\n*/\r\n\r\nbizagi.workportal.services.service.extend(\"bizagi.workportal.services.service\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function(params) {\r\n        // Call base\r\n        var self = this;\r\n\r\n        params.oldOfflineServicesAlreadyEnabled = !bizagi.util.isOfflineFormsV2Supported();\r\n\r\n        self._super(params);\r\n\r\n        // Create instance of database services\r\n        if(!bizagi.util.isOfflineFormsV2Supported()){\r\n            if(typeof (bizagi.workportal.services.db.old) !== \"undefined\"){\r\n                self.database = new bizagi.workportal.services.db.old();\r\n            }\r\n            self.enableOfflineEvents();\r\n        }     \r\n    },\r\n\r\n    enableOfflineEvents: function() {\r\n        var self = this;\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            self._super();\r\n        }\r\n        else {\r\n            if (bizagi.util.isTabletDevice()) {\r\n                if (typeof navigator.connection != \"undefined\") {\r\n                    if (typeof (Connection) !== \"undefined\"\r\n                        && (navigator.connection.type == Connection.NONE || navigator.connection.type == \"unknown\")) {\r\n                        self.online = false;\r\n                    } \r\n                    else {\r\n                        self.online = true;\r\n                    }\r\n                } \r\n                else {\r\n                    var queryString = bizagi.readQueryString();\r\n                    var queryoffline = (queryString && queryString[\"online\"]) ? eval(queryString[\"online\"]) : true;\r\n                    self.online = queryoffline;\r\n                }\r\n\r\n                $(document).off(\"online.services\");\r\n                $(document).on(\"online.services\", function() {\r\n                    self.online = true;\r\n                    bizagi.log(\"online.services\");\r\n                    self.returnOnlineStatus();\r\n                });\r\n\r\n                $(document).off(\"offline.services\");\r\n                $(document).on(\"offline.services\", function() {\r\n                    bizagi.log(\"offline.services\");\r\n                    self.online = false;\r\n                });\r\n\r\n            }\r\n\r\n            // Execute this trigger in render on next event        \r\n            $(document).off(\"tryPushData.offline\");\r\n            $(document).on(\"tryPushData.offline\", function(e) {\r\n                if (self.online) {\r\n                    self.pushOfflineData();\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    returnOnlineStatus: function() {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            this._super();\r\n        }\r\n        else{\r\n            var self = this;\r\n            $.when(self.logoutUser()).always(function() {\r\n                $.when(self.authenticatedUser()).always(function() {\r\n                    $.when(self.pushOfflineData()).always(function(pushStatus) {\r\n                        self.fetchOfflineData(pushStatus);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Get all data from server : new case structure, forms data\r\n    */\r\n    fetchOfflineData: function(v2Param) {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            this._super(v2Param);\r\n        }\r\n        else if ( bizagi.util.hasOfflineFormsEnabled()) {\r\n            var synObject = new bizagi.workportal.services.fetchWorker.old(this);\r\n            var message = \"\";\r\n\r\n            $.when(synObject.fetch()).done(function(data) {\r\n                bizagi.log(\"Sync Completed\");\r\n                if (bizagi.util.isTabletDevice()) {\r\n                    message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-successful\")\r\n                        ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-successful\")\r\n                        : \"Successful Synchronization\";\r\n\r\n                    bizagi.util.showNotification({ text: message, type: \"success\" }); // Localizar texto\r\n                }\r\n            }).fail(function(data) {\r\n                bizagi.log(\"Sync Failed\");\r\n\r\n                if (bizagi.util.isTabletDevice()) {\r\n                    if (data !== 0) {\r\n                        message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-fail\")\r\n                            ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-fail\")\r\n                            : \"Failed Synchronization\";\r\n                        bizagi.util.showNotification({ text: message, type: \"error\" });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n    * put all data to server : new case structure, forms data\r\n    */\r\n    pushOfflineData: function() {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super();\r\n        }\r\n        else if (bizagi.util.hasOfflineFormsEnabled()) {\r\n            var self = this;\r\n            var pullObject = new bizagi.workportal.services.pullWorker.old(this);\r\n            return $.when(pullObject.pull())\r\n                    .then(function(data) {\r\n                    bizagi.log(\"Offline cases syncronized, all data sended\");\r\n                }, function(cause) {\r\n                    bizagi.log(\"Error syncronizing cases\");\r\n                });\r\n        }\r\n    },\r\n\r\n    /*\r\n     * this function send to the server the offline cases created\r\n     */\r\n    syncOfflineCases: function (params) {\r\n        var self = this;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('offline-sendForm'),\r\n            data: {\r\n                idCase: params.idCase,\r\n                idWFClass: params.idWfClass,\r\n                awCaseCreationContext: JSON.stringify(params.objToSend),\r\n                idWorkflow: params.idWfClass\r\n            },\r\n            type: 'POST',\r\n            dataType: 'json',\r\n            serviceType: 'LOAD'\r\n        });\r\n    },\r\n\r\n     /*\r\n     * Retreives Form structure + Form data\r\n     *\r\n     */\r\n    processesHierarchyTofetchForms: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        data['idChangeSet'] = params.changeSet;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('offline-getForms'),\r\n            data: data,\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Gets the current working user\r\n    */\r\n    getCurrentUser: function(params) {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super(params);\r\n        }\r\n        else{\r\n            var self = this;\r\n\r\n            if (self.online) {\r\n                return self._super(params);\r\n            } \r\n            else {\r\n                var defer = new $.Deferred();\r\n\r\n                // Call ajax and returns promise\r\n                // save this response in the local storage and get when offline\r\n                var data = {\r\n                    idUser: 1,\r\n                    user: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                    userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                    domain: typeof (BIZAGI_DOMAIN) !== \"undefined\" ? BIZAGI_DOMAIN : \"domain\",\r\n                    delegateUserName: \"\",\r\n                    idDelegateUser: -1,\r\n                    groupSeparator: \",\",\r\n                    language: \"en-US\",\r\n                    decimalSeparator: \".\",\r\n                    decimalDigits: \"2\",\r\n                    symbol: \"$\",\r\n                    ShortDateFormat: \"M/d/yyyy\",\r\n                    TimeFormat: \"h:mm tt\",\r\n                    LongDateFormat: \"dddd, MMMM d, yyyy\",\r\n                    twoDigitYearMax: 2029,\r\n                    twoDigitYearMaxDelta: 13,\r\n                    uploadMaxFileSize: \"1048576\",\r\n                    isMultiOrganization: \"false\",\r\n                    associatedStakeholders: [],\r\n                    sUserProperties : []\r\n                };\r\n\r\n                defer.resolve(data);\r\n\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Return all the available processes in bizagi\r\n    */\r\n    getAllProcesses: function(params) {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super(params);\r\n        }\r\n        else {\r\n            var self = this;\r\n            params.inputtray = params.inputtray || \"inbox\";\r\n            if (params.inputtray == \"inbox\") {\r\n                return self._super(params);\r\n            } \r\n            else {\r\n                return $.when(self.database.getAllProcesses(params)).pipe(function(response) {\r\n                    response = JSON.parse(response);\r\n                    // Aggrupate workflows by categories\r\n                    if (!!params.skipAggrupate)\r\n                        return response;\r\n                    var responseData = {};\r\n                    var categories = {};\r\n                    var allProcesses = bizagi.localization.getResource(\"workportal-widget-inbox-all-processes\");\r\n                    var allCases = {\r\n                        name: bizagi.localization.getResource(\"workportal-widget-inbox-all-cases\"),\r\n                        path: \"\",\r\n                        category: allProcesses,\r\n                        isFavorite: (params.onlyFavorites || false),\r\n                        guidFavorite: \"\",\r\n                        idworkflow: \"\",\r\n                        guidWFClass: \"\",\r\n                        count: 0\r\n                    };\r\n\r\n                    // Create a default category\r\n                    categories[allProcesses] = [];\r\n                    categories[allProcesses].workflows = [];\r\n                    categories[allProcesses].workflows.push(allCases);\r\n                    if (response.workflows) {\r\n                        $.each(response.workflows.workflow, function(i, workflow) {\r\n                            // Creates the category if it doesn't exist\r\n                            if (!categories[workflow.category]) {\r\n                                categories[workflow.category] = [];\r\n                                categories[workflow.category].workflows = [];\r\n                            }\r\n\r\n                            // Push the workflow\r\n                            categories[workflow.category].workflows.push(workflow);\r\n\r\n                            // Sum the cases count                        \r\n                            allCases.count += Number(workflow.count);\r\n                        });\r\n                    }\r\n\r\n                    // Build result array once grouped\r\n                    responseData.categories = [];\r\n                    for (key in categories) {\r\n                        responseData.categories.push({\r\n                            name: key,\r\n                            workflows: categories[key].workflows\r\n                        });\r\n                    }\r\n                    return responseData;\r\n                });\r\n\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Returns all the cases for the current user filtered by a workflow\r\n    */\r\n    getCasesByWorkflow: function(params) {\r\n        var self = this;\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return self._super(params);\r\n        }\r\n        else{\r\n            params.inputtray = params.inputtray || \"inbox\";\r\n\r\n            if (params.inputtray === \"inbox\") {\r\n                if (self.online) {\r\n                    return self._super(params);\r\n                } \r\n                else {\r\n                    var deferred = new $.Deferred();\r\n\r\n                    var cases = {\r\n                        \"rows\": [],\r\n                        \"totalPages\": 0,\r\n                        \"page\": 1,\r\n                        \"lstIdCases\": []\r\n                    };\r\n\r\n                    deferred.resolve(cases);\r\n                    return deferred.promise();\r\n                }\r\n            } \r\n            else {\r\n                var defer = new $.Deferred();\r\n                $.when(self.database.getCustomizedColumnsData(params)).pipe(function(response) {\r\n                    response = JSON.parse(response);\r\n                    $.each(response.cases.rows, function(key, value) {\r\n                        var newFieldsValue = [];\r\n\r\n                        //  Set id of case to radnumber\r\n                        response.cases.rows[key][\"radnumber\"] = value.id;\r\n                        $.each(value.fields, function(fieldsKey, fieldsValue) {\r\n                            // when delete element from fields array, each function lose key value\r\n                            if (fieldsValue != undefined) {\r\n                                // Radnumber\r\n                                try {\r\n                                    if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == \"true\") {\r\n                                        response.cases.rows[key][\"radnumber\"] = fieldsValue.Value;\r\n                                    } else if (fieldsValue.workitems != undefined) {\r\n                                        response.cases.rows[key][\"workitems\"] = fieldsValue.workitems;\r\n                                    } else {\r\n                                        newFieldsValue.push(fieldsValue);\r\n                                    }\r\n                                } catch (e) {\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        // Update Fields \r\n                        response.cases.rows[key]['fields'] = newFieldsValue;\r\n                    });\r\n                    defer.resolve(response.cases);\r\n                });\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *  Get Menu Authorization\r\n    */\r\n    getMenuAuthorization: function() {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super();\r\n        }\r\n        else{\r\n            var self = this;\r\n\r\n            if (self.online) {\r\n                return self._super();\r\n            } else {\r\n                // Call ajax and returns promise\r\n                var defer = new $.Deferred();\r\n                var data = {\r\n                    \"permissions\": [\r\n                        { \"Cases\": [\"NewCase\", \"Pending\", \"Closed\", \"Search\"] },\r\n                        {\r\n                            \"AnalysisReports\": [\r\n                                \"BAMProcess\", \"BAMTask\", \"AnalyticsProcess\", \"AnalyticsTask\", \"AnalyticsSensor\",\r\n                                \"AnalysisQueries\", \"BAMResourceMonitor\"\r\n                            ]\r\n                        }, {\r\n                            \"Admin\": [\r\n                                \"UserAdmin\", \"Licenses\", \"EntityAdmin\", \"CaseAdmin\", \"AlarmAdmin\", \"EncryptionAdmin\",\r\n                                \"MobileUpdatesAdmin\", \"AsynchronousWorkitemRetries\", \"UserPendingRequests\",\r\n                                \"AuthenticationLogQuery\", \"BusinessPolicies\", \"Profiles\", \"UserDefaultAssignation\",\r\n                                \"GRDimensionAdmin\", \"ThemeBuilder\"\r\n                            ]\r\n                        }, { \"CurrentUserAdministration\": [\"CurrentUser\"] }, { \"LogOut\": [] }, { \"Search\": [] },\r\n                        { \"SmartFolders\": [] }, { \"CustomFolders\": [] }, { \"BizagiQueries\": [] }, { \"AnalysisQueries\": [] },\r\n                        { \"StateLog\": [] }, { \"PrintableVersion\": [] }\r\n                    ]\r\n                };\r\n\r\n                defer.resolve(data);\r\n\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Gets the inbox summary for the current logged user\r\n    *   Returns a promise of the data being retrieved\r\n    */\r\n    getInboxSummary: function(params) {\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return this._super();\r\n        }\r\n        else {\r\n            var self = this;\r\n            var enableDefaultMethod = self.online;\r\n            if (params && (params.inputtray == \"false\" || params.inputtray == \"true\")) {\r\n                enableDefaultMethod = false;\r\n            }\r\n            if (enableDefaultMethod) {\r\n                return self._super(params);\r\n            } else {\r\n                // Call ajax and returns promise\r\n                var defer = new $.Deferred();\r\n                $.when('{\"inboxSummary\":{\"Red\":7,\"Yellow\":0,\"Green\":0,\"Black\":0,\"All\":7}}').pipe(function(response) {\r\n                    var data = JSON.parse(response);\r\n                    defer.resolve(data[\"inboxSummary\"]);\r\n                });\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Returns the available categories filtered by a parent category\r\n    *   If not parent category is sent, it will return the base categories\r\n    */\r\n    getCategories: function(params) {\r\n        var self = this;\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return self._super(params);\r\n        }\r\n        else{\r\n            if (self.online) {\r\n                return self._super(params);\r\n            } \r\n            else {\r\n                // Define data\r\n                params = params || {};\r\n                var data = {};\r\n\r\n                // Required params\r\n                if (params.idCategory)\r\n                    data[\"idCategory\"] = params.idCategory;\r\n                if (params.idApp)\r\n                    data[\"idApp\"] = params.idApp;\r\n\r\n                data[\"enableOfflineForm\"] = params.enableOfflineForm || false;\r\n\r\n\r\n                data[\"groupByApp\"] = params.groupByApp || false;\r\n\r\n                // Call ajax and returns promise\r\n                return self.database.getCategories(data);\r\n            }\r\n        }\r\n    },\r\n\r\n    /* \r\n    * CREATE NEW CASES\r\n    */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.createNewCase(params);\r\n        }\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            if (bizagi.util.isNativePluginSupported() && typeof (bizagiapp.getCase) !== \"undefined\") {\r\n                return self.getNativeWorkItems(params);\r\n            } \r\n            else {\r\n                return self.database.getWorkitems(params);\r\n            }\r\n        }\r\n    },\r\n\r\n    getNativeWorkItems: function(params){\r\n        var defer = new $.Deferred();\r\n\r\n        bizagiapp.getCase(params.idCase, function(response){\r\n           \r\n            var workItems = JSON.parse(response);\r\n\r\n            defer.resolve(workItems);\r\n\r\n        }, function(response){\r\n            defer.reject(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    getCaseSummary: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.getSummary(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Delete offline cases created localy\r\n    *   return a promise\r\n    */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.deleteCase(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Get subprocesses\r\n    *   return a promise\r\n    */\r\n    getCaseSubprocesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            defer.resolve({ subProcesses: [] });\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n    * This service get all overrides keys within configuration project\r\n    *\r\n    * @return {json}\r\n    */\r\n    getOverrides: function() {\r\n        return {};\r\n    },\r\n\r\n    /**\r\n     * Return all the available cases in bizagi and thinking for mobile response\r\n     * @param {} params: inputtray:  inbox | outbox (false) | drafts (true)\r\n     * @returns {} \r\n     */\r\n    getCasesListBeta: function(params) {\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return this._super(params);\r\n        }\r\n        else {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            params.inputtray = params.inputtray || \"inbox\";\r\n\r\n            if (params.inputtray === \"inbox\" || params.inputtray == \"outbox-finished\") {\r\n                if (self.online && params.inputtray === \"inbox\" ) {\r\n                    return self._super(params);\r\n                } else {\r\n                    var deferred = new $.Deferred();\r\n\r\n                    var response = { \"page\": 1, \"totalPages\": 1, \"elements\": [] };\r\n                    deferred.resolve(response);\r\n\r\n                    return deferred.promise();\r\n                }\r\n            } \r\n            else {\r\n                var defer = new $.Deferred();\r\n                $.when(self.database.getCasesList(params))\r\n                    .pipe(function(response) {\r\n                        response = JSON.parse(response);\r\n\r\n                        var taskFeedData = self.getTaskFeedData(response);\r\n\r\n                        defer.resolve(taskFeedData);\r\n                    });\r\n\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n\r\n    getMobileCasesList: function(params) {\r\n        var self = this;\r\n        if (bizagi.util.isOfflineFormsV2Supported() || params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return getCasesListBeta(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Customize Columns\r\n    */\r\n    getTaskFeedData: function(response) {\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return this._super(response);\r\n        }\r\n        else {                \r\n            var overdue = bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n            var today = bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n            var tomorrow = bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n            var upcoming = bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n\r\n            var groupedData = {\r\n                elements: [],\r\n                page: response.page,\r\n                totalPages: response.totalPages,\r\n                advanceSearch: false\r\n            };\r\n\r\n            var actualDate = new Date();\r\n            var actualMonth = actualDate.getMonth();\r\n            var actualDay = actualDate.getDate();\r\n            var actualYear = actualDate.getFullYear();\r\n\r\n            for (var counter = 0; response.elements.length > counter; counter++) {\r\n                var tmpElement = response.elements[counter];\r\n                var status = {};\r\n\r\n                var originalEndDate = tmpElement[3];\r\n\r\n                if (tmpElement[3] !== \"\") {\r\n                    var tmpdate = new Date(tmpElement[3]);\r\n                    var tmpDay = tmpdate.getDate();\r\n                    var tmpMonth = tmpdate.getMonth();\r\n                    var tmpYear = tmpdate.getFullYear();\r\n                    var dateDiff = ((new Date(tmpYear, tmpMonth, tmpDay, 0, 0, 0)\r\n                        - new Date(actualYear, actualMonth, actualDay, 0, 0, 0)));\r\n\r\n                    if (dateDiff < 0) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]),\r\n                            \"MMMM dd | hh:mm tt\");\r\n                        status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" };\r\n                    } else {\r\n                        if (actualMonth === tmpMonth && actualDay === tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n\r\n                            // Define if the case is overdue\r\n                            if (tmpdate.getTime() < actualDate.getTime()) {\r\n                                status = {\r\n                                    group: \"2|\" + today + \", \"\r\n                                        + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                    state: \"red\",\r\n                                    type: \"today\",\r\n                                    icon: \"overdue\"\r\n                                };\r\n                            } else {\r\n                                status = {\r\n                                    group: \"2|\" + today + \", \"\r\n                                        + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                    state: \"yellow\",\r\n                                    type: \"today\",\r\n                                    icon: \"ontime\"\r\n                                };\r\n                            }\r\n                        } else if (actualMonth === tmpMonth && (actualDay + 1) === tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n                            status = {\r\n                                group: \"3|\" + tomorrow + \", \"\r\n                                    + bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd\"),\r\n                                state: \"yellow\",\r\n                                type: \"tomorrow\",\r\n                                icon: \"ontime\"\r\n                            };\r\n                        } else {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd | hh:mm tt\");\r\n                            status = { group: \"4|\" + upcoming, state: \"green\", type: \"upcoming\", icon: \"upcoming\" };\r\n                        }\r\n                    }\r\n                } else {\r\n                    tmpElement[3] = \"--\";\r\n                    status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" }\r\n                }\r\n\r\n                groupedData.elements.push($.extend({}, tmpElement, status,\r\n                { \"endDate\": originalEndDate, \"idworkitem\": tmpElement[1] }));\r\n            }\r\n\r\n            return groupedData;\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Render Details\r\n    * @param idWorkitem\r\n    */\r\n    summaryCaseDetails: function(options) {\r\n        var self = this;\r\n        var params = options || {};\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            var def = $.Deferred();\r\n            var idWorkitem = options[\"idWorkitem\"] || 0;\r\n\r\n            $.when(self.getCaseSummaryDataContent(options))\r\n                .done(function(data) {\r\n\r\n                    data.currentState = data.currentState || [];\r\n                    var dataCurrentStateLength = data.currentState.length;\r\n\r\n                    // Show or hide tabs\r\n                    data[\"showEvents\"] = (data[\"countEvents\"] >= 1) ? true : false;\r\n                    data[\"showParentProcess\"] = (data[\"idParentCase\"] >= 1) ? true : false;\r\n                    data[\"parentProcess\"] = {\r\n                        'displayName': data[\"parentDisplayName\"],\r\n                        'idCase': data[\"idParentCase\"]\r\n                    };\r\n\r\n                    data[\"isClosed\"] = (data[\"isOpen\"] == \"true\") ? false : true;\r\n                    data[\"showAssignees\"] = (data[\"countAssigness\"] >= 1) ? true : false;\r\n                    data[\"showSubProcess\"] = (data[\"countSubProcesses\"] >= 1) ? true : false;\r\n                    data[\"showForm\"] = (data[\"hasGlobalForm\"] == \"true\") ? true : false;\r\n                    data[\"allowsReassign\"] = \"false\";\r\n\r\n                    for (var i = 0; i < dataCurrentStateLength; i++) {\r\n                        if (data[\"currentState\"][i][\"idWorkItem\"] == idWorkitem) {\r\n                            data[\"allowsReassign\"] = data[\"currentState\"][i][\"allowsReassign\"];\r\n                        }\r\n                    }\r\n\r\n                    // edit original data, no show events in activities tab\r\n                    var currentStateTypes = [];\r\n                    var m = 0; // counter for new activities array\r\n                    for (var j = 0; j < data[\"currentState\"].length; j++) {\r\n                        if (data[\"currentState\"][j][\"isEvent\"] == \"false\" &&\r\n                            data[\"currentState\"][j][\"assignToCurrentUser\"] == \"true\" &&\r\n                            data[\"currentState\"][j][\"idWorkItem\"] != idWorkitem) {\r\n                            currentStateTypes[m++] = data[\"currentState\"][j];\r\n                        }\r\n                    }\r\n\r\n                    data[\"currentStateTypes\"] = currentStateTypes;\r\n                    data[\"showActivities\"] = (currentStateTypes.length >= 1) ? true : false;\r\n\r\n                    def.resolve(data);\r\n                });\r\n\r\n            return def.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n    *  Get json from cases service\r\n    */\r\n    getCaseSummaryDataContent: function(options) {\r\n        var self = this;\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return self._super(options);\r\n        }\r\n        else {\r\n            var promise = new $.Deferred();\r\n\r\n            $.when(self.getCaseSummary(options))\r\n                .done(function(data) {\r\n                    // Completes data\r\n                    data.taskState = self.icoTaskState;\r\n                    data.process = data.process ? data.process : \"\";\r\n\r\n                    if (data.createdBy) {\r\n                        data.createdByName = data.createdBy.Name;\r\n                        data.createdByUserName = data.createdBy.userName;\r\n                        data.caseDescription = (data.caseDescription == '' ? '' : data.caseDescription);\r\n                        data.processPath = data.processPath.replace(/\\//g, ' > ') + data.process;\r\n                        data.showWorkOnIt = true;\r\n                    }\r\n\r\n                    promise.resolve(data);\r\n                });\r\n            return promise.promise();\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Returns the data for the inbox grid view\r\n    */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n\r\n            $.when(self.database.getCustomizedColumnsNewData(params))\r\n                .pipe(function(response) {\r\n                    defer.resolve(JSON.parse(response));\r\n                });\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n    *   Returns the recent process\r\n    */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.getRecentProcesses(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Start process in BizAgi\r\n    */\r\n    startProcess: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n\r\n            var data = {\r\n                hasStartForm: false,\r\n                idProcess: params.idProcess,\r\n                displayName: params.displayName,\r\n                caseInfo: {}\r\n            }\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get stakeholder shortCurts\r\n     * @param {} params \r\n     * @returns {} \r\n     */\r\n    getShortCuts: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the available list of searches\r\n     * @returns {} \r\n     */\r\n    getSearchLists: function() {\r\n        var self = this;\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super();\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get the icon of a given collection\r\n     * @param params\r\n     */\r\n    getCollectionIcon: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    }\r\n});\r\n","/**\r\n* Routing service\r\n*\r\n* @author Edward J Morales\r\n* @description This class has been created based on jira story DRAGON-4943\r\n*/\r\n\r\nbizagi.workportal.services.routing.extend(\"bizagi.workportal.services.routing\", {}, {\r\n    /**\r\n    * Main method\r\n    *\r\n    * @param params <object> json with parameters to route\r\n    * @return object deferred\r\n    */\r\n    init: function (args) {\r\n        this._super(args);\r\n    },\r\n\r\n    /**\r\n    * Define the next route to take\r\n    * @param params object\r\n    * @return deferred with specific path\r\n    */\r\n    getRoute: function (params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        // Params Override\r\n        self.params = (params) ? params : self.params;\r\n\r\n        if (typeof (params.offlineAction) !== \"undefined\" && params.offlineAction === \"next\") {\r\n            var defer = new $.Deferred();\r\n            defer.resolve(self.routeToGlobalFormWithoutData());\r\n            bizagi.loading.stop();\r\n            return defer.promise();\r\n        }\r\n        else {\r\n            return self._super(params);\r\n        }\r\n    }\r\n});\r\n"]}