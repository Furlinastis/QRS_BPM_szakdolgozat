{"version":3,"sources":["jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.container.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.render.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.form.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.panel.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.contentPanel.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.nestedForm.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.tab.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.tabItem.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.horizontal.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.layout.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.accordion.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.accordionItem.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.group.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.searchForm.js","jquery/rendering/js/smartphone/container/slide/bizagi.rendering.smartphone.slide.searchForm.js","jquery/rendering/js/smartphone/container/slide/bizagi.rendering.smartphone.startForm.js","jquery/rendering/js/smartphone/container/slide/bizagi.rendering.smartphone.slide.adhocForm.js","jquery/rendering/js/smartphone/container/slide/bizagi.rendering.smartphone.slide.form.js","jquery/rendering/js/smartphone/container/slide/bizagi.rendering.smartphone.slide.ecm.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.text.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.extendedText.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.label.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.number.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.money.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.date.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.actionLauncher.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.entityTemplate.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.polymorphicLauncher.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.yesno.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.check.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.checkList.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.list.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.multiSelect.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.radio.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.cascadingCombo.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.combo.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.collectionnavigator.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.hidden.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.upload.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.upload.offline.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.ecm.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.grid.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.grid.offline.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.grid.grouped.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.search.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.letter.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.button.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.fileprint.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.link.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.image.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.formLink.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.geolocation.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.association.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.searchList.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.userfield.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.activityCheckList.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.numberScientificNotation.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.range.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.rangeDate.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.rangeMoney.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.rangeNumber.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.render.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.image.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.placeholder.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.boolean.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.link.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.label.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.text.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.dateTime.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.number.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.money.js","jquery/rendering/js/smartphone/render/layout/bizagi.rendering.smartphone.layout.upload.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.column.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.combo.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.document.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.date.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.text.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.number.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.image.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.upload.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.link.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.search.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.uploadecm.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.button.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.radio.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.list.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.exclusiveCheck.js","jquery/rendering/js/smartphone/render/column/bizagi.rendering.smartphone.columns.readonly.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.document.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.queryForm.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.formTemplate.js","jquery/rendering/js/smartphone/container/bizagi.rendering.smartphone.usersForm.js","jquery/rendering/js/smartphone/render/bizagi.rendering.smartphone.specific_text.js","jquery/rendering/js/smartphone/bizagi.rendering.smartphone.factory.js"],"names":["bizagi","rendering","container","extend","startLoading","endLoading","render","base","prototype","smartphone","initializeData","data","this","_super","formContainer","getFormContainer","formParams","getParams","internalPostRender","element","changeDisplayOption","postRender","getLabel","label","$","observableElement","getContainerRender","getAlignClass","alignType","getControl","control","length","getControlFiller","controlFiller","getContainerMessage","containerMessage","getColumnContainerMessage","changeLabelAlign","changeValueAlign","customizeRenderWidth","submitOnChange","bRefreshForm","noCollect","self","defer","Deferred","util","when","isReadyToSave","done","internalSubmitOnChange","resolve","fail","reject","always","stopLoading","promise","setValidationMessage","message","dataType","properties","type","isGridControl","normalizeType","$message","column","test","replace","attr","text","addClass","removeClass","setDisplayValue","value","setValue","editable","display","displayValue","getDisplayValue","html","actionSave","inputEdition","val","configureLabel","displayName","getElementsToStylize","context","getDisplayOptionClass","displayType","getFormattingLabel","clearDisplayValue","input","find","filter","index","ele","getValue","getFormParams","getRTLDisplayType","changeVisibility","argument","visible","parseBoolean","show","css","hide","changeRequired","required","triggerRenderValidate","changeRequiredLabel","changeEditabilityCellControl","key","xpath","form","init","params","warnings","errors","postRenderContainer","buttons","getButtons","document","unbind","bind","e","deferredSave","allowOnlineActions","autoSaveEvents","window","newData","collectRenderValues","isEmptyObject","localization","getResource","saveBox","isStartForm","formtype","showSaveBox","saveForm","handler","processButtons","saveButton","nextButton","i","action","navigation","getNavigation","view_container","getViewContainer","setNavigationButtons","bindTouchEvents","refreshForm","focus","getFocus","options","idCase","idWorkitem","idTask","selectedTabs","getSelectedTabs","xpathContext","idPageCache","isRefresh","getEndPointAction","idStartScope","postRenderEdit","originalParams","triggerHandler","delay","configureHandlers","configureComplexGateway","validationController","command","controllers","validation","validations","actionController","actions","readyDeferred","modalViewDidAppear","clearValidationMessages","modalViewDidDisappear","configureNetworkHandlers","internalSubmitForm","buttonProperties","submitDataAction","executeButtonAction","performAction","checkpointAction","commitAction","submitData","executeRule","createnewcase","collectRenderValuesForSubmit","animate","scrollTop","dataService","prepare","tag","prepareCheckpointAction","id","executeButton","idRender","prepareCommitAction","next","back","save","nextWithoutValidations","transitions","each","activeTransitions","push","countProps","messageComplexGateway","errorComplexGateway","showMessageBox","forcePlanCompletion","contexttype","contextType","surrogatekey","surrogateKey","flowControlDeferred","deferreds","apply","response","console","log","multiaction","execute","responses","isNativePluginSupported","isiOSSmartphoneDevice","bHasValidations","result","addValidationMessage","messages","sendRollbackAction","postProcessButton","refresh","routing","IdCase","caseNumber","CaseNumber","nonSupportedMethods","_","messageError","error","indexOf","errorType","showConfirmationBox","then","_params","failHandler","validateFeatureSupport","isFloatingButtonsEnabled","isFormButtonsEnabled","dispose","triggerGlobalHandler","eventType","parent","trigger","error_obj","JSON","parse","code","notifier","add","title","sticky","time","setTimeout","renderContainer","template","renderFactory","getTemplate","fasttmpl","uniqueId","helptext","helpText","mode","getMode","queryForm","getFormType","summaryForm","globalForm","displayAsReadOnly","processPath","breadCrumb","orientation","replaceChildrenHtml","renderChildrenHtml","touchMoveStart","event","preventDefault","currentPossitionY","originalEvent","targetTouches","pageY","blur","currentPositionY","changedTouches","ordinal","processButton","complexGatewayContainer","children","hasClass","on","$selected","transitionId","is","panel","contentPanel","tab","material_bizagi_tabs","direction","active_index_tab","activeTab","ev","info","stopPropagation","setActiveTab","rippleEffect","tabItem","setAsActiveContainer","ready","tabs","click","activate","counter","horizontal","layout","accordion","accordionItem","group","toggleClass","collapse","isOpen","expand","toogleContainer","searchForm","renderResult","skipInitialLoad","rowsPerPage","sortBy","sortOrder","overrideGetRemoteData","getRemoteData","elements","columns","caption","parseAdditionalProperties","columnVisible","allowDecimals","showTime","grid","getRender","allowAdd","allowEdit","allowDelete","resultsGrid","results","postRenderElement","configureDesignView","configureLayoutView","criteriaContainer","resultsContainer","ui","searchParams","hasOwnProperty","refreshResults","records","rows","Class","searchForms","searchFormParams","searchFormDeferred","renderEdition","renderSearchForm","searchContainer","createRenderContainer","getSearchContainerData","getContainer","Object","keys","map","firstChild","tabContainer","loadSearchTab","currentSearchForm","navigate","containerGridResults","containerSearchCriteria","applyButtons","hasSessionFormException","goToStartPage","errorTemplate","getCommonTemplate","appendTo","renderAddForm","addContainer","guidEntity","entity","requestedForm","getFormData","addFormParams","style","callback","saveDataAddForm","destroy","maxRows","performSearch","innerHTML","indicator","currentAddForm","handleSearchFormZindex","refreshParams","getErrorFormatted","validateForm","forceCollectData","formData","isMapEmpty","mapping","found","obj","setDisplayValueToControl","renderControlSearchForm","addForm","displayBottomButtons","getSearchFormData","pipe","searchFormContainer","detach","append","deferred","searchFormToLoad","otherElements","isDefault","searchFormData","Math","guid","idSearchForm","url","containerButtons","empty","templateBtn","btnSearch","tmpl","name","btnSelect","btnAdd","btnCancel","setSearchState","toggle","allowNew","pop","virtual","option","modalViewDisplayed","grep","n","slideFormParams","slideContainer","configureViewHandlers","goBack","renderSlideForm","getStartForm","formClass","submitForm","getPageCache","onSave","renders","getRenders","updateOriginalValue","addErrorMessage","containerParams","saveButtonLabel","onCancel","cancelButtonLabel","remove","delegate","xhr","error_message","slideFormDeferred","transformData","allowEdition","shift","buttonContainer","row","isAddForm","pageCacheId","sessionId","transformActions","transformValidations","item","mapRenderType","mapValue","recalculate","isColumn","concat","additionallabel","undefined","includes","replaceAll","toLowerCase","gridActions","isEmpty","bDependencyFound","dependencies","newAction","encode","transformConditions","conditions","transformCommands","commands","elseCommands","gridValidations","newValidation","condition","expressions","simple","complex","argumentType","refreshIndex","splice","_renderButtons","content","arguments","getMetadataForm","$renderEdition","onSaveDataMetadataForm","fileData","metadata","renderType","getRenderType","metadataType","newRender","assign","metadataId","description","readOnly","toUpperCase","thousands","maxLength","autoExtend","update","metadataValues","idMetadata","idFileUpload","fileName","xPath","idAttrib","metaValues","loading","start","updateECMMetadata","fileProperties","stop","renderReadOnly","sanitizeHTML","decodedValue","decodeURI","validateValue","br2nl","attachRetypeDouble","retypeDouble","currentValue","tooltip","createTooltip","$context","currentTitle","cloneRender","extendedText","minLines","maxLines","maxCharactersToShow","textarea","resize","isOfflineForm","showChar","startString","substr","endString","toString","actualMaxLength","which","prop","updateTextareaSize","configureHandlersReadOnly","$control","delegateTarget","currentRows","scrollHeight","offsetHeight","previousValue","newValue","number","isDesign","numericInput","executeFormatCurrencyPlugin","money","date","MAX_YEARS_DISPLAY","getFormattedDate","dateFormatter","formatDate","fullFormat","postRenderReadOnly","getDateControl","controlElements","defaultDateControl","minDateControl","minValue","maxDateControl","maxValue","timeFormat","getTimeFormat","isNaN","Date","setFullYear","getFullYear","setHours","mobiscroll","calendar","controls","min","max","defaultValue","showScrollArrows","lang","languages","BIZAGI_LANGUAGE","headerText","inst","timeS","onChangeHandler","clear","onSet","valueText","getVal","day","getDate","month","getMonth","year","hours","getHours","minutes","getMinutes","is24h","onBeforeShow","changeMinValue","changeMaxValue","isiOSDevice","onClose","onShow","isCordovaSupported","isAndroidDevice","cordova","plugins","Keyboard","disableScroll","close","initializer","isObjectEmpty","getTime","currentDate","split","getDateFromInvariant","currentTime","fullDateFormated","setHour","getFullFormatedDate","getDateFromISO","dateControl","formatInvariant","preprocessDateValue","parseInt","isClearButton","formatedFullDate","setNewDateValue","fullDate","formatISO","dateFromFormat","getDateFromFormat","applyDateFormat","initIndexTime","endIndexTime","substring","isValid","invalidElements","bValid","validateMinAndMaxValue","hasValue","showMandatoryMessage","isMinValue","vValue","resultValue","formatedDate","propertiee","isValidMinMaxValue","formattedDate","actionLauncher","getActions","processPropertyValueArgs","getPropertiesActionLaucher","deferredActions","isHorizontal","templatetype","getPropertyData","processPropertyValueDataTmplArgs","templateData","engine","isDefaultTemplate","wrap","configureActionsHandlers","configureTemplateHandlers","guidProcess","guidAction","actionType","readOnlyForm","xpathActions","processAction","actionSheet","actionClicked","expr","FilterAction","array","search","RegExp","keyup","not","subscribe","filters","multipleSelection","countSameActions","actionManager","act","executeAction","showConfirmationDialog","notifyExecution","class_name","processActionForm","additionalXpaths","additionalXpath","join","def","slideForm","slide","detailLabel","showSaveButton","isActionStartForm","savedData","editMode","IdScope","renderParams","idForm","caseId","typeForm","surrogatedKey","recordXpath","rewriteContextType","processActionFormCollection","xpathContextWithKey","printf","idEntity","xpathContextWithoutKey","addGridRecordData","IdEntity","addActionToQueue","processStartForm","args","startForm","guidprocess","mappingstakeholders","executeActionImmediately","actionsToExecuteContainer","configureQueueVisibility","listOfActions","removeActionSelector","openActionSelector","removeActionToQueue","target","extraParams","dataAction","actionsToExecuteTitle","allowactions","len","calculateFilters","polymorphicLauncher","getPolymorphicActions","serializePolymorphicActions","totalActions","clone","lessActions","templateArguments","allowSearch","treeActionsList","getTreeItems","bindHandlers","level","templateTreeItem","$targetData","guidObject","guidConstructor","onActionClicked","status","pageCache","maximized","$target","yesno","radio","parsedValue","change","cleanData","check","removeAttr","evt","isCheck","checkList","unique","ceil","random","itemId","onCheckListGroupChange","checked","items","combo","list","renderControl","mobileView","customHeader","contentTemplate","open","configureActions","isDependant","getParentCombo","parentValue","BA_ACTION_PARAMETER_PREFIX","renderCombo","configureModalViewHandlers","processComboData","forEach","comboValue","isNumeric","selected","findDataValueById","isArray","formatItem","selectedValue","valueObjet","$elementsList","$clearButton","header","$searchInput","filterList","$li","stringContainer","stringToSearch","renderComboTemplate","selectedId","hasItems","validateItem","multiSelect","MORE_OPTION_WIDTH","SEARCH_MIN_LENGTH","isExecutionMode","getData","openModalView","el","template_content","values","isChecked","template_footer","footer","footerTemplate","transition","afterOpenAnimation","view","modalView","$listContainer","$suggestInput","newList","call","querySelector","getAttribute","findItemById","trim","siblings","getSelectedValue","cascadingCombo","services","service","BA_CONTEXT_PARAMETER_PREFIX","parentCombo","initializingCascadingCombo","isInitialValue","isRendered","deferredVisible","configureCombo","changeCombo","valueItem","getTemplateName","itemSelected","enableTyping","collectionnavigator","hidden","BA_PAGE_CACHE","upload","QUALITY_PICTURE","LIMIT","EXTENSIONSIMG","EXTENSIONSFILE","EXTENSIONSVIDEO","EXTENSIONSAUDIO","isNative","renderItem","noFiles","filesCount","file","files","renderUploadItem","replaceFilesHtml","$contentFile","$inputFile","$nativeFile","checkFileExtensions","attachEvents","media","downloadFile","executeFormFailHandler","counterChoseFiles","off","chooseFile","removeFile","getUploadChoices","handlerUploadFile","appear","cancelClicked","getImageResolutionSizes","withoutCancel","handlerResolutionUpload","addFile","navigator","camera","getPicture","dataImage","extensions","checkMaxSize","getFileDataInfo","checkFileTypes","version","getAndroidVersion","saveImage","isAndroid","modalResolutionUpload","buttonIndex","getImageResolutionItems","onFail","quality","correctOrientation","sourceType","Camera","PictureSourceType","PHOTOLIBRARY","CAMERA","mediaType","MediaType","PICTURE","destinationType","DestinationType","FILE_URI","targetWidth","targetHeight","device","capture","captureVideo","dataVideo","checkMaxSizeVideo","saveVideo","limit","actionSelected","ResolutionType","ORIGINAL","resolution","getImageResolution","transformImageSize","editedImageURL","localUrl","base64Image","dataItem","dataFile","getImagePath","mimeType","uploadFile","fullPath","addParams","buildAddParams","queueID","encodeXpath","getUploadXpath","FileUploadOptions","fileKey","uploadKey","addUrl","decodeURIComponent","onUploadFileCompleted","processFailMessage","isValidResource","$wrapper","newItem","slice","checkMaxFiles","isMaxFilesReached","maxFiles","maxfiles","actualFiles","validExtensions","validOptions","video","image","fileAPISupported","buildAddFileParams","prefix","FormData","BIZAGI_SESSION_NAME","processUploadFile","itemsUpload","errorResponse","responseText","checkMaxSizeFile","deleteUploadItem","triggerRenderChange","getTemplateItemName","maxFileSizeOfProperty","Number","maxSize","maxFileSizeOfUser","BIZAGI_SETTINGS","UploadMaxFileSize","updateFilesCount","openOfflineFile","handlerWebUploadFile","removeOfflineFile","fileId","randomNumber","getBlobFromPath","blob","saveOfflineFile","saveResponse","onUploadOfflineFileCompleted","addInteractions","collectData","renderValues","originalValue","method","fileUploaded","itemTemplate","filename","canBeSent","failReadFile","fileIndex","fileValue","triggerEvents","dataIndex","getFileParams","offlineType","getOfflineFile","binaryFile","handleBinaryFile","path","blobPromise","normalizeIOSFilePath","errorHandler","resolveLocalFileSystemURL","fileEntry","reader","FileReader","onloadend","Blob","readAsArrayBuffer","blobFile","parameters","operationType","ecm","ERROR_ECM_NO_AVAILABLE","ACTION_DETAILS","ACTION_EDIT","getXpathContext","originalData","buildItemUrl","getFileProperties","renderFileLayout","metadataECMMultiaction","getECMMetadata","metaData","Array","showMetadata","Filename","attackMenuEvents","addMenuEvents","$fileItem","viewMore","fn","processActionByType","allowUpdateMetadata","allowCheckOut","lockECMFile","allowCancelCheckOut","unlockECMFile","deleteECMFile","overflowMenu","lockUploadItem","replaceWith","unlockUploadItem","performValidationMessage","isFailResponse","lastIndexOf","singleInstance","cellMetadata","setDisplayValueEdit","updateAffectedCellManually","getRowIndexByKey","showMore","buildColumnModel","columnsTotalizers","jQuery","a","bizagi_grid_smartphone","waiting","table","emptyTable","specialColumn","rowButtons","cell","specialCell","pager","edit","withEditForm","details","allowDetail","inlineAdd","allowMore","totalizer","showSummary","hasTotalizer","pageRequested","submitGridData","onPageRequested","sortRequested","fetchData","page","sortType","isValidGrid","drawCell","isNewRow","cellReady","onCellReady","rowSelected","totalData","onTotalData","gridControlReady","processLayout","isLabelFormat","textFormat","valueFormat","addRow","grantPerformAction","subType","addVirtualRow","editRow","editVirtualRow","deleteRow","showFormDetails","showDetailForm","updateData","changed","changeBackgroundColor","color","setHeaderStyles","label_style","headerFormat","format","bold","background","italic","underline","strikethru","size","fetchTotalData","operationState","showTotal","columnIndex","bizAgiProperties","totalize","operation","sum","return_value","defaultvalue","count","avg","toFixed","formatTotalizedResult","total","showTotals","dataUrl","sort","searchFilter","getGridData","isRTL","changeOrderData","controlType","formatMonetaryCell","cssClass","showBorder","columnModel","align","columnLabel","gridColumn","summarizeBy","dataReady","dataReadyDeferred","setCellOverrides","triggerGridPluginHandler","omitKeys","changes","newRecords","renderColumn","originalProperties","cellOverride","getCellOverride","labelAlign","columntitlealign","valueAlign","columnAlign","j","cellOverrides","bindRenderChange","newFontSize","outerHTML","originalEditable","getDecorated","submitOnChangexpathContext","dataservice","submitAddRequest","newid","propertiesGridForm","recordXPath","addPage","addLabel","idAsigned","enableEditSubmitRequest","hideLabel","disableProcessButons","hasExclusiveCheck","argumentsfl","formlink","formLink","contextEdit","actionSaveNewRow","actionCancel","actionCancelRow","_sendRelation","_getData","addExclusiveChange","_InternalRenderLinkForm","currentRow","adhocForm","saveAddedRow","containerForm","editPage","editLabel","submitEditRequest","collectGridChange","dataToSend","submitDeleteRequest","rowDeleted","submitRollbackRequest","submitSaveRequest","resp","applyActionUpdateGrid","originalMethod","decorated","selfIntern","child","getElementType","ELEMENT_TYPE_CONTAINER","ELEMENT_TYPE_RENDER","parentPromise","inlineAddPromise","inlineAddDeferred","setError","changeCellValue","getControlCell","_value","compositeValue","getCompositeValue","changeCellBackgroundColor","background-color","background-image","changeCellColor","changeCellVisibility","findIndex","getColumn","changeCellEditability","changeEditability","changeCellMinValue","changeCellMaxValue","cleanCellData","rowLength","errorsMessage","showValidationMessage","isBinding","setSeconds","setMilliseconds","isExclusive","getIndexes","merge","getDataNewRows","reduce","acum","current","success","stringify","exclusiveChanges","simpleXpath","originalRows","completeRows","isTaskForm","newRowKeys","k","createdOffline","groupBy","groupSummary","addWarning","initialLoadDone","applyGridPlugin","pendingActions","enableXlsExport","enablePdfExport","processChanges","internalRedersValues","temporalNew","sortArray","currentChanges","columnXpath","canColumnBeSent","columnNumber","match","buildCellXpathFilter","columnValue","addRowData","idRow","isNew","processOldRows","newRows","tempRows","col","leng","temp","processRow","setSurrogateKey","drawEditableCell","drawReadonlyCell","overrideProperties","onCellChange","originalFormat","renderSummary","newRow","createAddRowData","editInline","saveInlineAddedRows","bRefresh","removeNewRecords","delInfo","deleteUrl","ADVANCED_SEARCH_ID","ADVANCED_ADDITION_ID","CLEAR_SEARCH_ID","NO_RESULTS_SEARCH_ID","DEFAULT_SEARCH_ID","SEARCH_DELAY","SEARCH_MAX_RECORDS","deferredReference","searchInput","advancedSearch","_simplySearchView","_advanceSearchView","readyActionExecution","modalViewList","suggestFilter","debounce","autoCompleteSearchResults","selectItem","formSearchParams","helpers","allowFullSearch","maxRecords","refreshControl","getContentTemplate","processRequest","term","renderSearchItem","searchItem","req","suggestions","allowSuggest","searchLength","getSuggestData","getOfflineData","state","hideStatus","parseValue","highlightMatches","inputText","allowClear","dataList","startsWith","letter","button","needsUserConfirmation","userConfirmationMessage","pressed","runButtonAction","fileprint","link","preventDefaultForAnchorTag","isValidValue","getFullyDecodedURI","linkEncode","encodeURI","linkSolver","linktarget","linkTarget","offlineImageId","originalOfflineImageId","isDisposed","isDesignMode","showAsyncImage","choosePhoto","imageAdd","resolutionButtonHandler","imagePreview","useCamera","coordinates","getBoundingClientRect","popoverOptions","CameraPopoverOptions","left","top","performUploadFile","imageDelete","deleteImage","uploadFileCompleted","msg","saveImageOffline","saveOfflineError","htmlImage","configureMenu","baseParams","zoom","useNativeScrolling","imageData","img","onPreviewActionBack","buildFullItemUrl","$preview","originalImageWidth","width","$viewMore","buildItemUrlOffline","dataUrlToSave","isOfflineFormsV2Supported","imageId","paramsRender","proxyPrefix","serviceLocator","originalElement","orgiginalDisplayType","_isRefreshForm","getFormLinkXpathContext","getFormLinkXpath","hasentryrule","openLink","resolveCheckpointRequest","openLinkRule","paintFormLink","rollbackForm","property","getPropertyValue","dataRuleResp","showErrorMessage","propertyName","extra","jqXHR","textStatus","errorThrown","withAddForm","hideSaveButton","wiew_container","saveRecord","error_code","executeSubmitOnChange","hasexitrule","closeExitRule","resolveSubmitCommitRequest","ex","err","saveGridRecord","saveUrl","submitCommitRequest","submitCheckpointRequest","parentXpathContext","geolocation","ALLOW_UPDATE","coordinate","updateDisplayValue","performPrecision","onSuccess","position","coords","latitude","longitude","getCurrentPosition","association","getFlipAssociation","flip","makeJsonBase","flipped","columnData","getColumnData","getRightAssociation","formatJson","dataAssociation","rightData","leftData","isExecution","addEventControl","showDefaultGroupList","$groups","slideDown","$input","parentId","addElement","removeElement","flipstate","$element","$groupList","parents","closeAccordionSection","active","slideUp","searchList","SEARCH_ELEMENTS","searchListInput","_searchListViewModal","getHeaderTemplate","getFooterTemplate","cssClassHeader","adjustResize","finalValue","deleteItem","templateItem","getTagTemplate","modalViewTagList","modalFooter","modalHeader","getListItems","initialScreenSize","innerHeight","height","emptyItems","userfieldWrapper","getUserfieldControl","sControl","userfieldName","exists","eval","createUserfieldInstance","getUserfieldDefinition","userfield","userfieldGuid","loadUserfield","dynamicFunction","initialParams","getUserFieldInstance","isUserField","userfieldInstance","replicateUserfieldMethods","styleContent","styleGuid","str","loadStyle","defaultUserField","designUserField","userfieldDefinition","basicUserField","renderSingle","renderUserfieldControl","getEditableControl","isSupported","getReadonlyControl","controlName","goal","activityDescription","newItemName","addEditButton","cancelEditButton","additionalElements","notifyLoadItems","resolvedItems","resolved","setItemLocalStorage","hasChanges","idActivity","itemsResolved","progress","activityWork","webpart","publish","prepareNewItem","that","contentHolder","closest","itemPosition","repaintControl","itemSelectedName","itemContent","setSelectionRange","addSelectedHandlers","keypress","addItem","guidItem","checkListHtml","refreshValue","completed","floor","controlValueIsChanged","numberScientificNotation","range","rangeDate","defineRangeControl","rangeMoney","rangeNumber","layoutRender","layoutImage","templateUri","getImageUri","ajax","processData","contentType","getResponseHeader","byteArrayToBlob","stringToByteArray","imageUrl","URL","webkitURL","createObjectURL","hash","getUrl","replaceMultiple","layoutPlaceholder","layoutBoolean","layoutLink","proxy","onClickElement","navigateFromRender","reference","referenceType","kendoMobileApplication","layoutLabel","layoutText","layoutDateTime","layoutNumber","formatCurrency","symbol","positiveFormat","negativeFormat","decimalSymbol","digitGroupSymbol","groupDigits","roundToDecimalPlace","numDecimals","colorize","layoutMoney","layoutUpload","getValueFilesByData","valueResult","getHTMLFiles","getUploadFileEntityUrl","isContextContainerWidgetRender","guidentity","applyOverrides","originalGetControl","isValueValid","propertyOverrides","applyColumnStyles","cellIcon","getXpath","getDocumentXpath","getContextXpath","documentTemplateGenerate","preRenderControl","deleteDocumentTemplate","xpathcontext","generateDocumentTemplate","autoOpenDocuments","xpathPath","tableCell","deleteUploadFile","columnXpathSplit","nameFile","getUploadFileUrl","calculateInitialLayoutProperties","refreshCell","getECMXpathContext","idSession","enabledChecks","overrideDecoratedRenderProperties","simpleXpathArray","readonly","valueToDisplay","ACTION_SHOW","ACTION_DOWNLOAD","ACTION_DELETE","documents","downloadalldocuments","allowgenerate","allowGenerate","renderDocumentsHtml","renderActionsHtml","replaceActionsHtml","$inputDocument","$listDocuments","$listActions","getTemplateReadonly","buttonExecuted","validate","validateContainer","documentFile","renderAllDocumentDownload","getTemplateDownload","buildAllDocumentsUrl","joined","redrawDocuments","downloadAllDocuments","$documentContainer","$actionContainer","showDocumentPreview","resolveDocumentTemplateGenerate","resolveDeleteDocumentTemplate","formTemplate","regularExpressionExpression","regularExpression","expression","regularExpressionMessage","isEmptyField","retype","mask","validationMessages","keyUnicode","charCode","keyCode","decodedDisplayValue","isNull","performDesignModeMethods","internalSetInitialValue","factory","loadTemplates","loadTemplate","getFileTemplate","tmplIcons","src","onDemand","detectDevice","usersForm","nestedForm","mobileform","mobilegroup","columnParams","isExtended","exclusiveCheck","uploadecm","offline","enableQuerySuggestBehavior","entityTemplate","getSearchRender","activityCheckList","getLayoutRender","getRangeRender","specific_text"],"mappings":"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","sourcesContent":["/**\r\n *   Name: Bizagi Smartphone Container Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the container class to adjust to smartphone devices\r\n */\r\n\r\n// Extends itself\r\nbizagi.rendering.container.extend(\"bizagi.rendering.smartphone.container\", {}, {\r\n    /**\r\n     * Starts waiting signal for async stuff\r\n     */\r\n    startLoading: function () {\r\n    },\r\n\r\n    /**\r\n     * Ends waiting for async stuff\r\n     */\r\n    endLoading: function () {\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render base\r\nbizagi.rendering.render.extend(\"bizagi.rendering.smartphone.render\", bizagi.rendering.render.base.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.render\", {}, {\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n\r\n        var formContainer = this.getFormContainer();\r\n        this.formParams = formContainer.getParams();\r\n    },\r\n\r\n    /**\r\n     * Override internal rendering in order to apply new smartphone layout\r\n     */\r\n    internalPostRender: function (element) {\r\n        this._super(element);\r\n\r\n        this.changeDisplayOption();\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Returns the label element usually to apply styles\r\n     */\r\n    getLabel: function() {\r\n        if (!this.label)\r\n            this.label = $(\".bz-form-label label\", this.element || this.observableElement);\r\n\r\n        return this.label;\r\n    },\r\n\r\n    getContainerRender: function () {\r\n        return $(this.element);\r\n    },\r\n\r\n    /**\r\n     * Return the right align class\r\n     */\r\n    getAlignClass: function (alignType) {\r\n        return alignType;\r\n    },\r\n\r\n    /**\r\n     * Template method to get the control element\r\n     */\r\n    getControl: function () {\r\n        if (!this.control || this.control.length === 0)\r\n            this.control = $(\".bz-control\", this.element || this.observableElement);\r\n\r\n        if (!this.control || this.control.length === 0) return null;\r\n\r\n        return this.control;\r\n    },\r\n\r\n    /**\r\n     * Template method to get the control filler element\r\n     */\r\n    getControlFiller: function () {\r\n        if (!this.controlFiller)\r\n            this.controlFiller = $(\".bz-form-item__control\", this.element || this.observableElement);\r\n\r\n        return this.controlFiller;\r\n    },\r\n\r\n    getContainerMessage: function () {\r\n        if (!this.containerMessage)\r\n            this.containerMessage = $(\".bz-form-message__text\", this.element || this.observableElement);\r\n\r\n        return this.containerMessage;\r\n    },\r\n\r\n    getColumnContainerMessage: function () {\r\n        if (!this.containerMessage)\r\n            this.containerMessage = $(\".bz-form-cell-message__text\", this.element || this.observableElement);\r\n\r\n        return this.containerMessage;\r\n    },\r\n\r\n    /**\r\n     * Customizes render label align\r\n     */\r\n    changeLabelAlign: function (alignType) {\r\n    },\r\n\r\n    /**\r\n     * Customizes render value align\r\n     */\r\n    changeValueAlign: function (alignType) {\r\n    },\r\n\r\n    /**\r\n     * Customizes render label and value width\r\n     * @returns {}\r\n     */\r\n    customizeRenderWidth: function () {\r\n    },\r\n\r\n    /**\r\n     * Sends all the info to the server then refreshes the form. Returns a deferred\r\n     */\r\n    submitOnChange: function (data, bRefreshForm, noCollect) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // TODO: Review loader for smartphone\r\n        bizagi.util.smartphone.startLoading();\r\n\r\n        $.when(self.isReadyToSave()).done(function () {\r\n            $.when(self.internalSubmitOnChange(data, bRefreshForm, noCollect))\r\n                .done(function () {\r\n                    defer.resolve();\r\n                }).fail(function () {\r\n                defer.reject();\r\n            }).always(function () {\r\n                bizagi.util.smartphone.stopLoading();\r\n            });\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * Adds a validation message to the render\r\n     */\r\n    setValidationMessage: function (message) {\r\n        // Call base\r\n        this._super(message);\r\n        var dataType = this.properties.type;\r\n        var isGridControl = (bizagi.util.normalizeType(dataType) === \"grid\");\r\n        var isColumn = (this.column && /column/.test(dataType));\r\n        var $message = isColumn ? this.getColumnContainerMessage() : this.getContainerMessage();\r\n\r\n        if (message && message.length > 0) {\r\n            message = message.replace(/<\\w+>([^<]*)<\\/\\w+>/g, \"$1\");\r\n\r\n            $message.attr(\"data-error\", message);\r\n            $message.text(message);\r\n\r\n            isGridControl ? this.element.addClass(\"bz-form-item-grid--error\") : this.element.addClass(\"bz-form-item--error\");\r\n        } else {\r\n            $message.text(\"\");\r\n            isGridControl ? this.element.removeClass(\"bz-form-item-grid--error\") : this.element.removeClass(\"bz-form-item--error\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        // Set internal value\r\n        self.setValue(value, false);\r\n\r\n        if (!self.properties.editable && self.properties.display !== \"check\") {\r\n            // Render as simple value\r\n            var displayValue = self.getDisplayValue(value);\r\n\r\n            if (typeof (displayValue) == \"string\" || typeof (displayValue) == \"number\") {\r\n                $(control).html(\"<label class='bz-form-label'>\" + displayValue + \"</label>\");\r\n            }\r\n        }\r\n    },\r\n\r\n    actionSave: function () {\r\n        this.setValue(this.inputEdition.val(), false);\r\n    },\r\n\r\n    configureLabel: function () {\r\n        return this.properties.displayName;\r\n    },\r\n\r\n    /**\r\n     * Starts waiting signal for async stuff\r\n     */\r\n    startLoading: function () {\r\n    },\r\n\r\n    /**\r\n     * Ends waiting for async stuff\r\n     */\r\n    endLoading: function () {\r\n    },\r\n\r\n    /**\r\n     * In mobiles, don't apply styles to icon's elements\r\n     * @param context\r\n     * @returns {jQuery|HTMLElement}\r\n     */\r\n    getElementsToStylize: function (context) {\r\n        return $(\".bz-input\", context);\r\n    },\r\n\r\n    /**\r\n     * Return the right display option class\r\n     * @param displayType\r\n     * @returns {string}\r\n     */\r\n    getDisplayOptionClass: function (displayType) {\r\n        if (displayType === \"reversed\") {\r\n            return \"bz-form-item--display-reversed\";\r\n        } else if (displayType === \"label\") {\r\n            return \"bz-form-item--display-label\";\r\n        } else if (displayType === \"value\") {\r\n            return \"bz-form-item--display-value\";\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Return the label\r\n     */\r\n    getFormattingLabel: function () {\r\n        // TODO: Despues de cambiar a genome desktop, validar se solo se deja este metodo en la base\r\n        return this.getLabel();\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     */\r\n    clearDisplayValue: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        var input = control.find(\"input\").filter(function (index, ele) {\r\n            return ele.type !== \"file\" && ele.type !== \"radio\" && ele.type !== \"checkbox\"\r\n        });\r\n\r\n        if (input.length > 0) {\r\n            input.val(self.getValue());\r\n        } else {\r\n            self.setDisplayValue(\"\");\r\n        }\r\n    },\r\n\r\n    getFormParams: function () {\r\n        return this.formParams || {};\r\n    },\r\n\r\n    /**\r\n     * Transform the display type when using RTL orientation\r\n     */\r\n    getRTLDisplayType: function (displayType) {\r\n        return displayType;\r\n    },\r\n\r\n    /**\r\n     * Changes the render visibility\r\n     * @param argument\r\n     */\r\n    changeVisibility: function (argument) {\r\n        // Update properties\r\n        this.properties.visible = argument;\r\n\r\n        // Hide - show the render\r\n        if (bizagi.util.parseBoolean(argument)) {\r\n            if (this.properties.type !== \"hidden\") {\r\n                this.element.show();\r\n                this.element.css(\"display\", \"\");\r\n            }\r\n        } else if (this.element) {\r\n            this.element.hide();\r\n        }\r\n    },\r\n\r\n    /**\r\n     *  Changes the render required\r\n     * @param argument\r\n     */\r\n    changeRequired: function (argument) {\r\n        // Update properties\r\n        this.properties.required = argument;\r\n\r\n        if (bizagi.util.parseBoolean(argument) && this.properties.editable) {\r\n            this.element.addClass(\"bz-form-item--required\");\r\n        } else {\r\n            this.element.removeClass(\"bz-form-item--required\");\r\n        }\r\n\r\n        // Perform validations again to check if the form is valid after this change\r\n        this.triggerRenderValidate();\r\n    },\r\n\r\n    /**\r\n     * This method just make a toggle of red label indicator\r\n     * @argument {boolean} argument\r\n     */\r\n    changeRequiredLabel: function (argument) {\r\n        // Prevent take the base\r\n    },\r\n\r\n    /**\r\n     * Change cell editability and attach bindings\r\n     * @param argument\r\n     * @param key\r\n     * @param xpath\r\n     */\r\n    changeEditabilityCellControl: function (argument, key, xpath) {\r\n        this._super(argument, key, xpath);\r\n    }\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Form Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the form class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.form\", bizagi.rendering.form.prototype);\r\n// Auto extend\r\nbizagi.rendering.smartphone.form.extend(\"bizagi.rendering.smartphone.form\", {}, {\r\n\r\n    init: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        // Define variables\r\n        self.warnings = {};\r\n        self.errors = {};\r\n\r\n        // Call base\r\n        this._super(params);\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each container after processed\r\n     */\r\n    postRenderContainer: function (container) {\r\n        var self = this;\r\n\r\n        self._super(container);\r\n\r\n        //Set button length\r\n        var buttons = self.getButtons();\r\n        var lengthButtons = buttons ? buttons.length : 0;\r\n\r\n        if (lengthButtons) {\r\n\r\n            $(document).data('auto-save', 'auto-save');\r\n\r\n            // Bind event auto-save\r\n            $(document).unbind(\"save-form\").bind(\"save-form\", function (e, deferredSave) {\r\n                if (self.allowOnlineActions()) {\r\n                    self.autoSaveEvents(deferredSave);\r\n                } else {\r\n                    deferredSave.resolve();\r\n                }\r\n            });\r\n\r\n            //bind event beforeunload\r\n            $(window).unbind('beforeunload').bind('beforeunload', function (e) {\r\n                var newData = {};\r\n                self.collectRenderValues(newData);\r\n\r\n                //if there are changes in the form show a message\r\n                if (!$.isEmptyObject(newData) && $(document).data('auto-save'))\r\n                    return bizagi.localization.getResource(\"confirmation-savebox-message2\");\r\n\r\n                return;\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Auto Save Events\r\n     */\r\n    autoSaveEvents: function (deferredSave, saveBox) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        self.collectRenderValues(data);\r\n\r\n        if (!$.isEmptyObject(data)) {\r\n            var isStartForm = self.properties.formtype === \"startform\";\r\n            var message = isStartForm ? bizagi.localization.getResource(\"confirmation-savebox-message4\") : bizagi.localization.getResource(\"confirmation-savebox-message1\");\r\n\r\n            $.when(bizagi.showSaveBox(message, \"Bizagi\", \"warning\"))\r\n            .done(function () {\r\n                if (!isStartForm){\r\n                    $.when(self.saveForm())\r\n                    .always( function() {\r\n                        deferredSave.resolve();\r\n                    });\r\n                }\r\n                else {\r\n                    deferredSave.resolve();\r\n                }\r\n            }).fail(function () {\r\n                if (isStartForm) {\r\n                    deferredSave.reject();\r\n                } else {\r\n                    deferredSave.resolve();\r\n                }\r\n            });\r\n        } else {\r\n            deferredSave.resolve();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * TEMPLATE METHOD TO GET THE BUTTONS OBJECTS\r\n     */\r\n    getButtons: function () {\r\n        var self = this;\r\n\r\n        if (self.getParams() && (handler = self.getParams().getButtons))\r\n            handler(self);\r\n\r\n        return $(\".ui-bizagi-button-container :button\", self.container);\r\n    },\r\n\r\n    processButtons: function () {\r\n        var self = this;\r\n        var params = self.getParams();\r\n\r\n        if (params && params.processButtons) {\r\n            var handler = params.processButtons;\r\n            handler(self);\r\n        }\r\n\r\n        var properties = self.properties;\r\n        properties.buttons = self.buttons;\r\n\r\n        // To cache a submit Data Buttom if exist\r\n        self.saveButton = null;\r\n        self.nextButton = null;\r\n\r\n        // Set saveButton and nextButton if exist\r\n        for (var i = 0, length = properties.buttons.length; i < length; i++) {\r\n            if (properties.buttons[i].action === \"save\") {\r\n                self.saveButton = properties.buttons[i];\r\n            } else if (properties.buttons[i].action === \"next\") {\r\n                self.nextButton = properties.buttons[i];\r\n            }\r\n        }\r\n\r\n        var navigation = self.getNavigation();\r\n\r\n        if (typeof (navigation) !== \"undefined\") {\r\n            //si tiene un viewConteiner sera porque es una forma dentro de container de edicion\r\n            var view_container = self.getViewContainer();\r\n            if (typeof view_container !== \"undefined\") {\r\n                view_container.setNavigationButtons(self);\r\n            } else {\r\n                navigation.setNavigationButtons(self);\r\n            }\r\n        }\r\n\r\n        // bind de touch events\r\n        self.bindTouchEvents(self.getButtons());\r\n    },\r\n\r\n    refreshForm: function (focus) {\r\n        var self = this;\r\n        var params = self.getParams();\r\n        var defer = new $.Deferred();\r\n\r\n        focus = focus || self.getFocus();\r\n\r\n        var options = {\r\n            idCase: self.params.idCase || \"\",\r\n            idWorkitem: self.params.idWorkitem || \"\",\r\n            idTask: self.params.idTask || \"\",\r\n            focus: focus,\r\n            selectedTabs: self.getSelectedTabs(),\r\n            xpathContext: self.properties.xpathContext,\r\n            idPageCache: self.properties.idPageCache,\r\n            isRefresh: true,\r\n            action: self.getEndPointAction(),\r\n            idStartScope: self.properties.idStartScope || \"\",\r\n            navigation: params.navigation,\r\n            view_container: params.view_container\r\n        };\r\n\r\n        if (params.postRenderEdit || params.processButtons) {\r\n            options.postRenderEdit = params.postRenderEdit;\r\n            options.processButtons = params.processButtons;\r\n            options.originalParams = params.originalParams || {};\r\n            options.getButtons = params.getButtons;\r\n        }\r\n\r\n        // Notify the refresh event so the consumer takes the decision about what to do\r\n        self.startLoading();\r\n\r\n        $.when(self.triggerHandler(\"refresh\", options)).done(function () {\r\n            defer.resolve();\r\n        }).fail(function () {\r\n            defer.reject();\r\n        }).always(function () {\r\n            self.endLoading();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    startLoading: function (delay) {\r\n        bizagi.util.smartphone.startLoading();\r\n    },\r\n\r\n    endLoading: function () {\r\n        bizagi.util.smartphone.stopLoading();\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the container's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var form = self.container;\r\n\r\n        // Process complex-gateway\r\n        self.configureComplexGateway();\r\n\r\n        // Process buttons\r\n        self.processButtons(form);\r\n\r\n        // Check for dom included event\r\n        self.bind(\"ondomincluded\", function () {\r\n            // Creates validation controller after the form is ready\r\n            self.validationController = new bizagi.command.controllers.validation(self, self.validations);\r\n\r\n            // Creates action controller after the form is ready\r\n            self.actionController = new bizagi.command.controllers.action(self, self.actions);\r\n\r\n            // Resolve this deferred to start executing DOM dependant plugins\r\n            self.readyDeferred.resolve();\r\n        });\r\n\r\n        //Event to notify the native code the form will be showing a modal view\r\n        self.bind(\"modalViewDidAppear\", function () {\r\n            self.params.navigation.modalViewDidAppear();\r\n        });\r\n\r\n        self.bind(\"closeModalValidationMessage\", function () {\r\n            self.validationController.clearValidationMessages();\r\n        });\r\n\r\n        //Event to notify the native code the form will be hiding a modal view\r\n        self.bind(\"modalViewDidDisappear\", function () {\r\n            self.params.navigation.modalViewDidDisappear();\r\n        });\r\n\r\n        // Add network listener\r\n        self.configureNetworkHandlers();\r\n    },\r\n\r\n    internalSubmitForm: function (buttonProperties) {\r\n        var self = this;\r\n        var actions = [];\r\n        var defer = $.Deferred();\r\n        var submitDataAction = null;\r\n        var executeButtonAction = null;\r\n        var performAction = null;\r\n        var checkpointAction = null;\r\n        var commitAction = null;\r\n        var data;\r\n\r\n        // Fill data hash | Collect data\r\n        if (buttonProperties.submitData || buttonProperties.executeRule || buttonProperties.createnewcase)\r\n            data = self.collectRenderValuesForSubmit();\r\n\r\n        // Start asynchronous operation\r\n        $.when(self.startLoading()).done(function () {\r\n            $('html, body').animate({scrollTop: $('.ui-bizagi-loading-icon')}, 'slow');\r\n        });\r\n\r\n        // Prepare actions\r\n        // When the button has to execute any rule (MUST SUBMIT DATA BEFORE ALWAYS)\r\n        if (buttonProperties.executeRule) {\r\n            submitDataAction = self.dataService.submitData({\r\n                action: \"SUBMITDATA\",\r\n                data: data,\r\n                xpathContext: self.properties.xpathContext,\r\n                idPageCache: self.properties.idPageCache,\r\n                prepare: true\r\n            });\r\n\r\n            submitDataAction.tag = \"submitData\";\r\n            checkpointAction = self.prepareCheckpointAction(buttonProperties.id);\r\n\r\n            // Reset data because when an execute rule operation has been performed, it saved already all the data\r\n            data = {};\r\n            executeButtonAction = self.dataService.executeButton({\r\n                idRender: buttonProperties.id,\r\n                xpathContext: self.properties.xpathContext || \"\",\r\n                idPageCache: self.properties.idPageCache,\r\n                prepare: true\r\n            });\r\n\r\n            executeButtonAction.tag = \"executeRule\";\r\n            commitAction = self.prepareCommitAction(buttonProperties.id);\r\n        }\r\n\r\n        if (buttonProperties.next || buttonProperties.back || buttonProperties.save || buttonProperties.createnewcase || buttonProperties.nextWithoutValidations) {\r\n            // Verify transitions\r\n            if (self.transitions) {\r\n                var transitions = [];\r\n                $.each(this.activeTransitions, function (key, value) {\r\n                    (value) ? transitions.push(key) : \"\";\r\n                });\r\n\r\n                if (bizagi.util.countProps(transitions) == 0) {\r\n                    var messageComplexGateway = bizagi.localization.getResource(\"render-widget-complexgateway-path\");\r\n                    var errorComplexGateway = bizagi.localization.getResource(\"render-widget-complexgateway-error\");\r\n\r\n                    bizagi.showMessageBox(messageComplexGateway, errorComplexGateway, \"info\", false);\r\n                    self.endLoading();\r\n                    defer.reject();\r\n                    return defer.promise();\r\n                }\r\n            }\r\n\r\n            performAction = self.dataService.submitData({\r\n                action: buttonProperties.action,\r\n                forcePlanCompletion: buttonProperties.forcePlanCompletion,\r\n                data: data,\r\n                xpathContext: self.properties.xpathContext,\r\n                idPageCache: self.properties.idPageCache,\r\n                prepare: true,\r\n                transitions: transitions || \"\",\r\n                contexttype: self.properties.contextType,\r\n                surrogatekey: self.properties.surrogateKey\r\n            });\r\n\r\n            performAction.tag = \"performAction\";\r\n        }\r\n\r\n        if (executeButtonAction) {\r\n            actions.push(submitDataAction);\r\n\r\n            //Validates if the method CHECKPOINT is supported\r\n            if (checkpointAction) {\r\n                actions.push(checkpointAction);\r\n            }\r\n\r\n            actions.push(executeButtonAction);\r\n\r\n            //Validates if the method COMMIT is supported\r\n            if (commitAction) {\r\n                actions.push(commitAction);\r\n            }\r\n\r\n            actions.push(executeButtonAction);\r\n        }\r\n\r\n        if (performAction)\r\n            actions.push(performAction);\r\n\r\n        //Evaluate if there are deferreds to evaluate, like inline add in grid, that must send a ADDRELATIONWITHDATA before to savedata\r\n        var flowControlDeferred = new $.Deferred();\r\n\r\n        if (data && data.deferreds) {\r\n            $.when.apply(this, data.deferreds)\r\n                .done(function (response) {\r\n                    flowControlDeferred.resolve(response);\r\n                }).fail(function () {\r\n                console.log(\"Error: It was not possible resolve async actions on form \")\r\n                flowControlDeferred.reject();\r\n            })\r\n        } else {\r\n            flowControlDeferred.resolve();\r\n        }\r\n\r\n        $.when(flowControlDeferred).done(function () {\r\n            bizagi.util.smartphone.startLoading();\r\n            $.when(self.dataService.multiaction().execute({actions: actions})).done(function (responses) {\r\n                //Hard refresh buttons\r\n                if(bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice()){\r\n                    var navigation = self.getNavigation();\r\n                    if (typeof (navigation) !== \"undefined\") {\r\n                            navigation.setNavigationButtons(self);\r\n                    }\r\n                }\r\n                // End asynchronous operation\r\n                self.endLoading();\r\n                // Find validations\r\n                var bHasValidations;\r\n                $.each(responses, function (i, response) {\r\n                    // Something went wrong, we gotta display messages in notifications grid\r\n                    if (response.result.type == \"validationMessages\") {\r\n                        self.addValidationMessage(response.result.messages);\r\n                        bHasValidations = true;\r\n                    }\r\n                });\r\n\r\n                if (!bHasValidations) {\r\n                    // Everything went ok .. succesfully response from the server\r\n                    if (!self.postProcessButton(responses, buttonProperties))\r\n                        return;\r\n\r\n                    // After successfully response refresh the form\r\n                    if (buttonProperties.refresh)\r\n                        self.refreshForm();\r\n\r\n                    // If needs routing publish an event\r\n                    if (buttonProperties.routing) {\r\n                        self.triggerHandler(\"routing\", {idCase: self.params.idCase});\r\n                    }\r\n\r\n                    // Create case\r\n                    if (buttonProperties.createnewcase) {\r\n                        if (responses.length > 0) {\r\n                            self.triggerHandler(\"routing\", {\r\n                                idCase: responses[0].result.IdCase,\r\n                                caseNumber: responses[0].result.CaseNumber\r\n                            });\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (buttonProperties.executeRule)\r\n                        self.sendRollbackAction(buttonProperties.id);\r\n                }\r\n\r\n                //Removes the nonSupportedMethods to prevent further iterations\r\n                delete self.nonSupportedMethods;\r\n\r\n                defer.resolve();\r\n            }).fail(function (_, _, response) {\r\n                var messageError = \"\";\r\n                var errorTypeList = [\"WaitForCompletionPlanException\", \"InvalidPlanStateException\", \"CustomMessageException\"];\r\n\r\n                if (buttonProperties.executeRule) self.sendRollbackAction(buttonProperties.id);\r\n\r\n                if (response && response.error && errorTypeList.indexOf(response.error.errorType) !== -1) {\r\n                    messageError = bizagi.localization.getResource(response.error.message);\r\n                    self.endLoading();\r\n\r\n                    $.when(bizagi.showConfirmationBox(messageError, null, false)).then(function () {\r\n                        var _params = $.extend({}, buttonProperties, {forcePlanCompletion: true});\r\n\r\n                        return $.when(self.internalSubmitForm(_params));\r\n                    }).done(function () {\r\n                        defer.resolve();\r\n                    }).fail(function () {\r\n                        defer.reject();\r\n                    });\r\n                } else {\r\n                    messageError = typeof (response) === \"undefined\" ? bizagi.localization.getResource(\"workportal-general-error\") : response;\r\n                    self.failHandler({\"error\": messageError});\r\n                    defer.reject(response);\r\n                }\r\n            }).always(function () {\r\n                bizagi.util.smartphone.stopLoading();\r\n            });\r\n        }).always(function () {\r\n            bizagi.util.smartphone.stopLoading();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    prepareCheckpointAction: function (id) {\r\n        return bizagi.util.validateFeatureSupport(\"commitRollbackActions\") ? this._super(id) : null;\r\n    },\r\n\r\n    prepareCommitAction: function (id) {\r\n        return bizagi.util.validateFeatureSupport(\"commitRollbackActions\") ? this._super(id) : null;\r\n    },\r\n\r\n    getNavigation: function () {\r\n        var params = this.getFormContainer().getParams();\r\n        return params.navigation;\r\n    },\r\n\r\n    getViewContainer: function () {\r\n        var params = this.getFormContainer().getParams();\r\n        return params.view_container;\r\n    },\r\n\r\n    isFloatingButtonsEnabled: function () {\r\n        var navigation = this.getNavigation();\r\n        return navigation && navigation.isFloatingButtonsEnabled();\r\n    },\r\n\r\n    isFormButtonsEnabled: function () {\r\n        var navigation = this.getNavigation();\r\n        return navigation && navigation.isFormButtonsEnabled();\r\n    },\r\n\r\n    dispose: function (params) {\r\n        // Active refresh on smartphone\r\n        if (typeof (params) === \"undefined\" || (typeof (params.isRefresh) === \"undefined\" || params.isRefresh == false)) {\r\n            this._super();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Publish a global event that the facade will replicate, also will be triggered in the form\r\n     */\r\n    triggerGlobalHandler: function (eventType, data) {\r\n        var self = this;\r\n\r\n        if (!self.parent) {\r\n            if (self.observableElement) {\r\n                self.observableElement.trigger(eventType, data);\r\n            }\r\n        } else {\r\n            self.parent.triggerGlobalHandler(eventType, data);\r\n        }\r\n\r\n        return self._super(eventType, data);\r\n    },\r\n\r\n    // TODO: REVIEW, ADD NOTIFIER PLUGIN!!!\r\n    failHandler: function (error) {\r\n        var self = this;\r\n        self._super(error);\r\n\r\n        var error_obj = {};\r\n\r\n        try {\r\n            error_obj = JSON.parse(error) || {};\r\n        } catch (e) {\r\n            error_obj = (error.length && error.length > 1) ? error[0] : error;\r\n        } finally {\r\n            //This double validation has the purpose to get the real error object from two different levels ( error.error or error.error.error )\r\n            if (error_obj.error) error_obj = error_obj.error;\r\n            if (error_obj.error) error_obj = error_obj.error;\r\n\r\n            // trigger the routing event in order to refresh the case\r\n            if (typeof error_obj.code !== \"undefined\" && error_obj.code === \"AUTH_ERROR\") {\r\n\r\n                $.notifier.add({\r\n                    title: bizagi.localization.getResource(\"workportal-sessiontimeout-expired-title\", \"Your session has expired\"),\r\n                    text: bizagi.localization.getResource(\"render-idle-expired-error\", \"Idle timer expired. For safety reasons this view will be refreshed automatically in 5 seconds. Note that any unsaved data is lost.\").replace(\"%s\", \"5\"),\r\n                    sticky: false,\r\n                    time: 5000\r\n                });\r\n\r\n                setTimeout(function () {\r\n                    self.triggerHandler(\"routing\", {\r\n                        idCase: self.params.idCase,\r\n                        idWorkitem: self.params.idWorkitem\r\n                    });\r\n                }, 5000);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Build the container html\r\n     */\r\n    renderContainer: function () {\r\n        var self = this;\r\n        var properties = this.properties;\r\n        var template = self.renderFactory.getTemplate(\"form\");\r\n        var idCase = \"\";\r\n\r\n        // Render the form\r\n        var html = $.fasttmpl(template, {\r\n            buttons: self.buttons,\r\n            transitions: self.transitions,\r\n            uniqueId: properties.uniqueId,\r\n            helptext: properties.helpText,\r\n            mode: self.getMode(),\r\n            queryForm: self.getFormType() == \"queryForm\",\r\n            summaryForm: self.params.summaryForm || false,\r\n            globalForm: self.properties.displayAsReadOnly || false,\r\n            idCase: idCase,\r\n            displayName: self.params.displayName || idCase,\r\n            processPath: properties.processPath,\r\n            breadCrumb: properties.breadCrumb,\r\n            orientation: properties.orientation\r\n        });\r\n\r\n        // Render children\r\n        return self.replaceChildrenHtml(html, self.renderChildrenHtml());\r\n    },\r\n\r\n    bindTouchEvents: function (buttons) {\r\n        var self = this;\r\n        var touchMoveStart = 0;\r\n\r\n        // Don't process buttons if they are undefined in the template\r\n        if (!buttons || buttons.length === 0) return;\r\n\r\n        buttons.bind(\"touchstart\", function (event) {\r\n            event.preventDefault();\r\n\r\n            var pointer = event.originalEvent.targetTouches ? event.originalEvent.targetTouches[0] : event;\r\n            var currentPossitionY = pointer.pageY;\r\n\r\n            touchMoveStart = currentPossitionY;\r\n        });\r\n\r\n        buttons.bind(\"touchend\", function (event) {\r\n            event.preventDefault();\r\n\r\n            // Trigger the blur of the focused element in order to catch the render Change in the last changed control\r\n            $(\":focus\", self.container).blur();\r\n            var pointer = event.originalEvent.changedTouches ? event.originalEvent.changedTouches[0] : event;\r\n            var currentPositionY = pointer.pageY;\r\n\r\n            self.startLoading();\r\n\r\n            // If the finger is too far from the button when you stop touching the screen, then do nothing\r\n            if (event.type !== \"click\" && currentPositionY > touchMoveStart + 40 || currentPositionY < touchMoveStart - 40) {\r\n                self.endLoading();\r\n            } else {\r\n                var button = $(this);\r\n                var ordinal = button.attr(\"ordinal\");\r\n                var buttonProperties = self.buttons[ordinal];\r\n\r\n                // Execute button\r\n                $.when(self.processButton(buttonProperties)).always(function () {\r\n                    self.endLoading();\r\n                });\r\n            }\r\n        });\r\n\r\n        buttons.bind(\"click\", function () {\r\n            self.startLoading();\r\n            var ordinal = $(this).attr(\"ordinal\");\r\n            var buttonProperties = self.buttons[ordinal];\r\n\r\n            // Execute button\r\n            $.when(self.processButton(buttonProperties)).always(function () {\r\n                self.endLoading();\r\n            });\r\n        });\r\n\r\n        return;\r\n    },\r\n\r\n    /**\r\n     * Configure actions to complex-gateway\r\n     */\r\n    configureComplexGateway: function () {\r\n        var self = this;\r\n        var complexGatewayContainer;\r\n        var form = self.container;\r\n\r\n        if (form.length > 1) {\r\n            $(form.children()).each(function () {\r\n                if ($(this).hasClass('.bz-complex-gateway'))\r\n                    complexGatewayContainer = this;\r\n            });\r\n        } else {\r\n            complexGatewayContainer = $(\".bz-complex-gateway\", form);\r\n        }\r\n\r\n        // activeTransitions is used to store ids of activities in Complex Gateway\r\n        self.activeTransitions = {};\r\n\r\n        // Set events for complex gateway interface\r\n        $(\".bz-checkbox__input\", complexGatewayContainer).on(\"click\", function () {\r\n            var $selected = $(this);\r\n            var transitionId = $selected.data(\"value\") || \"\";\r\n\r\n            if (typeof self.activeTransitions[transitionId] == \"undefined\") {\r\n                self.activeTransitions[transitionId] = false;\r\n            }\r\n\r\n            self.activeTransitions[transitionId] = $selected.is(':checked') || false;\r\n\r\n        });\r\n    }\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphone Panel Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the container class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.panel\", bizagi.rendering.panel.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.panel.extend(\"bizagi.rendering.smartphone.panel\", {}, {});\r\n","/**\r\n *   Name: Bizagi Smartphone ContentPanel Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the content panel class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.contentPanel\", bizagi.rendering.contentPanel.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.contentPanel.extend(\"bizagi.rendering.smartphone.contentPanel\", {}, {});\r\n","/*\r\n*   Name: Bizagi Smartphone Nested Form Extension\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script will define a nested form container class for smartphone devices\r\n*/\r\n\r\n// Extends from panel smartphone base\r\nbizagi.rendering.smartphone.panel.extend(\"bizagi.rendering.smartphone.nestedForm\", {}, {\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphone Tab Container Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the container class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.tab\", bizagi.rendering.tab.prototype);\r\n// Auto extend\r\nbizagi.rendering.smartphone.tab.extend(\"bizagi.rendering.smartphone.tab\", {}, {\r\n\r\n    /* POST RENDER CONTAINER ACTIONS\r\n    =================================================*/\r\n    postRenderContainer: function (container) {\r\n        var self = this;\r\n\r\n        this._super(container);\r\n\r\n        container.material_bizagi_tabs({\r\n            direction: this.properties.orientation,\r\n            active_index_tab: this.activeTab\r\n        }).on(\"updateActive\", function (ev, info) {\r\n            ev.stopPropagation();\r\n\r\n            self.setActiveTab(info.index);\r\n        });\r\n\r\n        $(\"> .bz-tabs > .bz-tab\", container).rippleEffect();\r\n    }\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Panel Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the container class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.tabItem\", bizagi.rendering.tabItem.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.tabItem.extend(\"bizagi.rendering.smartphone.tabItem\", {}, {\r\n\r\n    /**\r\n     * Change selected item\r\n     *\r\n     * @param {} argument\r\n     * @returns {}\r\n     */\r\n    setAsActiveContainer: function (argument) {\r\n        var self = this;\r\n\r\n        $.when(self.ready()).done(function () {\r\n            var tabItem = $(\"[data-reference='#ui-bizagi-tab-\" + self.properties.id + \"']\", self.parent.tabs);\r\n\r\n            tabItem.css(\"display\", \"\");\r\n            tabItem.click();\r\n        });\r\n    },\r\n    /* \r\n    *   Focus on container\r\n    */\r\n    focus: function () {\r\n        // Activate the tab if it hasn't been loaded\r\n        this.activate();\r\n\r\n        // Set this tab as an active container\r\n        this.setAsActiveContainer();\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     *  Hides / Show container\r\n     *\r\n     * @param {} argument\r\n     * @returns {}\r\n     */\r\n    changeVisibility: function (argument) {\r\n        var self = this;\r\n\r\n        // Store in properties\r\n        self.properties.visible = bizagi.util.parseBoolean(argument);\r\n\r\n        $.when(self.ready()).done(function () {\r\n            var tabItem = $(\"[data-reference='#ui-bizagi-tab-\" + self.properties.id + \"']\", self.parent.tabs);\r\n            var activeTab = self.parent.container.material_bizagi_tabs(\"getActiveTab\");\r\n\r\n            // Hide - show the render\r\n            if (self.properties.visible) {\r\n                self.container.css(\"display\", \"\");\r\n                tabItem.css(\"display\", \"\");\r\n\r\n\r\n                if (self.properties.counter === activeTab.index) {\r\n                    tabItem.css(\"display\", \"\");\r\n                    self.setAsActiveContainer();\r\n                } else {\r\n                    self.container.css(\"display\", \"none\");\r\n                }\r\n            } else {\r\n                self.container.css(\"display\", \"none\");\r\n                tabItem.css(\"display\", \"none\");\r\n\r\n                // If we are focus in the same tab is going to be invisible\r\n                activeTab = self.parent.container.material_bizagi_tabs(\"getActiveTab\");\r\n\r\n                if (self.properties.counter === activeTab.index) {\r\n                    self.parent.container.material_bizagi_tabs(\"moveToNextTab\");\r\n                } else {\r\n                    self.parent.container.material_bizagi_tabs(\"refreshPositions\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Horizontal Container Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the horizontal container class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.horizontal\", bizagi.rendering.horizontal.prototype);\r\n// Auto extend\r\nbizagi.rendering.smartphone.horizontal.extend(\"bizagi.rendering.smartphone.horizontal\", {}, {\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Layout Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the layout class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from container desktop base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.layout\", bizagi.rendering.layout.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.layout.extend(\"bizagi.rendering.smartphone.layout\", {}, {\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi smartphone Accordion Container Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the accordion class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.accordion\", bizagi.rendering.accordion.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.accordion.extend(\"bizagi.rendering.smartphone.accordion\", {}, {\r\n\r\n});","/*\r\n*   Name: Bizagi smartphone AccordionItem Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the accordion item class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.accordionItem\", bizagi.rendering.accordionItem.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.accordionItem.extend(\"bizagi.rendering.smartphone.accordionItem\", {}, {\r\n\r\n});","/*\r\n *   Name: Bizagi Smartphones Group Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the group class to adjust to smartphones devices\r\n */\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.container.extend(\"bizagi.rendering.smartphone.group\", bizagi.rendering.group.prototype);\r\n// Auto extend\r\nbizagi.rendering.smartphone.group.extend(\"bizagi.rendering.smartphone.group\", {}, {\r\n\r\n    /**\r\n    * Method to customize the container's behaviour to add handlers\r\n    */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        $(\">h5.bz-collapsible__header\", self.container).bind(\"click\", function () {\r\n            $(self.container).toggleClass(\"bz-collapsible--collapsed\");\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each container after processeds\r\n     * @param {} group      \r\n     */\r\n    postRenderContainer: function (group) {\r\n        // Call base\r\n        this._super(group);\r\n        if (this.properties.collapse){\r\n            this.collapse();\r\n        }\r\n    },\r\n\r\n    /**\r\n    * Check if group its open\r\n    * \r\n    * @return boolean\r\n    */\r\n    isOpen: function () {\r\n        return this.container.hasClass(\"bz-collapsible--collapsed\") ? false : true;\r\n    },\r\n\r\n    /**\r\n     * Focus on container     \r\n     */\r\n    focus: function () {\r\n        // Expand container\r\n        this.expand();\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Expands group container \r\n     * @returns {} \r\n     */\r\n    expand: function () {\r\n        if (!this.isOpen()){\r\n            $(\">h5.bz-collapsible__header\", this.container).trigger(\"click\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Collapses group container \r\n     * @returns {} \r\n     */\r\n    collapse: function () {\r\n        if (this.isOpen()){\r\n            $(\">h5.bz-collapsible__header\", this.container).trigger(\"click\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Expands or collapse the container from actions\r\n     * @param {} argument      \r\n     */\r\n    toogleContainer: function (argument) {\r\n        if (argument) {\r\n            this.expand();\r\n        } else {\r\n            this.collapse();\r\n        }\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Search Form Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the container class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from container smartphone base\r\nbizagi.rendering.smartphone.form.extend(\"bizagi.rendering.smartphone.searchForm\", bizagi.rendering.searchForm.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.searchForm.extend(\"bizagi.rendering.smartphone.searchForm\", {}, {\r\n\r\n    /*\r\n    *   Render the results of the query\r\n    *   Resolved in each device\r\n    */\r\n    renderResult: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Creates grid definition\r\n        var data = {};\r\n        data.properties = {\r\n            displayName: self.getResource(\"render-search-advanced-results-label\"),\r\n            type: \"grid\",\r\n            xpath: \"searchForm\" + properties.id,\r\n            id: properties.id,\r\n            skipInitialLoad: true,\r\n            rowsPerPage: 10,\r\n            sortBy: properties.sortBy,\r\n            sortOrder: properties.sortOrder,\r\n            overrideGetRemoteData: function (params) {\r\n                return self.getRemoteData(params);\r\n            }\r\n        };\r\n        data.elements = [];\r\n\r\n        // Creates columns\r\n        var columns = properties.columns;\r\n        $.each(columns, function (i) {\r\n            var column = {\r\n                render: {}\r\n            };\r\n            column.render.properties = {\r\n                displayName: columns[i].caption,\r\n                xpath: columns[i].xpath,\r\n                editable: false\r\n            };\r\n\r\n            $.extend(column.render.properties, self.parseAdditionalProperties(columns[i].dataType));\r\n\r\n            // Next conditional added to print only columns and not labels\r\n            // if type = label then column is not rendered on the results table\r\n            if (columns[i].dataType == 0)\r\n                column.render.properties.columnVisible = false;\r\n\r\n            // if column is number or monetary push allowDecimals property\r\n            if (columns[i].dataType == 7 || columns[i].dataType == 8)\r\n                column.render.properties.allowDecimals = columns[i].allowDecimals;\r\n\r\n            // if column is real or float set allowDecimals property to true\r\n            if (columns[i].dataType == 10 || columns[i].dataType == 11)\r\n                column.render.properties.allowDecimals = true;\r\n\r\n            // if column is date push showtime property\r\n            if (columns[i].dataType == 12)\r\n                column.render.properties.showTime = columns[i].showTime;\r\n\r\n            data.elements.push(column);\r\n        });\r\n\r\n        var grid = self.renderFactory.getRender({\r\n            type: \"grid\",\r\n            data: data,\r\n            parent: self,\r\n            mode: self.getMode()\r\n        });\r\n\r\n        grid.properties.allowAdd = false;\r\n        grid.properties.allowEdit = false;\r\n        grid.properties.allowDelete = false;\r\n\r\n        // Saves reference\r\n        self.resultsGrid = grid;\r\n\r\n        return grid.render();\r\n    },\r\n\r\n    /*\r\n    *   Template method to implement in each device to customize each container after processed\r\n    */\r\n    postRenderContainer: function (container) {\r\n        var self = this;\r\n        self._super(container);\r\n\r\n        var results = container.find(\".bz-container__search-results\");\r\n        var mode = self.getMode();\r\n\r\n        // Process children elements\r\n        self.container = container;\r\n\r\n        // Process result\r\n        var grid = $(results.children()[0]);\r\n        self.resultsGrid.postRenderElement(grid);\r\n\r\n        // Apply handlers\r\n        if (mode == \"execution\") {\r\n            self.configureHandlers();\r\n        }\r\n\r\n        // Configure view\r\n        if (mode == \"design\") {\r\n            self.configureDesignView();\r\n        }\r\n\r\n        // Configure view\r\n        if (mode == \"layout\") {\r\n            self.configureDesignView();\r\n            self.configureLayoutView();\r\n        }\r\n    },\r\n\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        // Saves reference\r\n        self.criteriaContainer = $(\".bz-container__search-criteria\", self.container);\r\n        self.resultsContainer = $(\".bz-container__search-results\", self.container);\r\n\r\n        // Bind to grid row select event\r\n        self.resultsGrid.bind(\"rowSelected\", function (e, ui) {\r\n            if (self.properties.searchParams.hasOwnProperty(\"multiSelect\")) {\r\n                self.trigger(\"multiSelect\", ui);\r\n            } else {\r\n                // Trigger event to bubble up to main container\r\n                self.trigger(\"instanceSelected\", ui);\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Refresh the result panel, making it to query data with current criteria\r\n    */\r\n    refreshResults: function () {\r\n        var self = this;\r\n        self.trigger(\"instancerefresh\");\r\n\r\n        $.when(self.resultsGrid.refresh()).done(function () {\r\n            self.trigger(\"instancerefreshdone\");\r\n\r\n            if (self.resultsGrid.properties.data && self.resultsGrid.properties.data.records == 0 && self.resultsGrid.properties.data.rows.length == 0) {\r\n                var message = bizagi.localization.getResource(\"workportal-general-no-records-found\");\r\n                var title = bizagi.localization.getResource(\"render-dialog-sendemail-message\");\r\n\r\n                bizagi.showMessageBox(message, title);\r\n            }\r\n        });\r\n    },\r\n    /*\r\n     *   Publish a global event that the facade will replicate, also will be triggered by the principal form\r\n     */\r\n    triggerGlobalHandler: function (eventType, data) {\r\n        var self = this;\r\n        self._super(eventType, data);\r\n        if (!self.parent) {\r\n            if (self.observableElement) {\r\n                return self.observableElement.trigger(eventType, data);\r\n            } else {\r\n                return null;\r\n            }\r\n        } else {\r\n            return self.parent.triggerGlobalHandler(eventType, data);\r\n        }\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Search Slide Implementation\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will shows a search form\r\n */\r\n$.Class.extend(\"bizagi.rendering.smartphone.helpers.searchForm\", {}, {\r\n\r\n    /**\r\n     * Constructor\r\n     */\r\n    init: function (dataService, renderFactory, searchForms, searchParams, searchFormParams) {\r\n        this.dataService = dataService;\r\n        this.renderFactory = renderFactory;\r\n        this.searchForms = searchForms;\r\n        this.searchParams = searchParams;\r\n        this.searchFormParams = searchFormParams;\r\n\r\n        this.searchFormDeferred = new $.Deferred();\r\n    },\r\n\r\n    /**\r\n     * Render the edition form,... if is an addform, then show the currentAddForm view\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    renderEdition: function (params) {\r\n        this.properties = params;\r\n\r\n        // Render the search form\r\n        this.renderSearchForm(params);\r\n\r\n        // Return promise\r\n        return this.searchFormDeferred.promise();\r\n    },\r\n\r\n    /**\r\n     * Get the searchform and render it!\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    renderSearchForm: function (params) {\r\n        var self = this;\r\n\r\n        // Creates a container, be careful you must destroy it later\r\n        self.searchContainer = self.searchFormParams.navigation.createRenderContainer({title: params.displayName});\r\n\r\n        var container = self.searchContainer;\r\n\r\n        $.when(self.getSearchContainerData(params)).then(function (data) {\r\n            if (params.editable === false) {\r\n                data.form.properties.editable = false;\r\n            }\r\n\r\n            if (data.form.properties) {\r\n                data.form.properties.orientation = self.searchParams.orientation || \"ltr\";\r\n            }\r\n\r\n            var form = self.renderFactory.getContainer($.extend({}, self.searchFormParams, {\r\n                type: \"form\",\r\n                data: data.form,\r\n                navigation: self.searchFormParams.navigation,\r\n                view_container: container\r\n            }));\r\n\r\n            self.form = form;\r\n\r\n            (Object.keys(form.children) || [])\r\n                .map(function (key) {\r\n                    form.children[key].params = $.extend({}, form.children[key].params, self.searchFormParams);\r\n                });\r\n\r\n            return form.render();\r\n\r\n        }).done(function (element) {\r\n            var firstChild = self.form.firstChild();\r\n            var tabContainer = firstChild.properties.type === \"tab\" ? firstChild : null;\r\n\r\n            if (tabContainer) {\r\n                // Bind select tab event\r\n                tabContainer.bind(\"selected\", function (e, ui) {\r\n                    var searchForm = self.searchForms[ui.index];\r\n                    $.when(self.loadSearchTab(params, ui.tab, searchForm))\r\n                        .done(function () {\r\n                            // Set currents search form\r\n                            self.currentSearchForm = ui.tab.firstChild();\r\n                            self.currentSearchForm.triggerHandler(\"ondomincluded\");\r\n                        });\r\n                });\r\n\r\n                tabContainer.container.tabs(\"select\", 0);\r\n                self.currentSearchForm = tabContainer.firstChild().firstChild();\r\n\r\n                if (!self.currentSearchForm.readyDeferred)\r\n                    self.currentSearchForm.readyDeferred = new $.Deferred();\r\n\r\n                self.currentSearchForm.triggerHandler(\"ondomincluded\");\r\n            } else {\r\n                // Set currents search form\r\n                self.currentSearchForm = self.form.firstChild();\r\n\r\n                if (!self.currentSearchForm.readyDeferred)\r\n                    self.currentSearchForm.readyDeferred = new $.Deferred();\r\n\r\n                self.currentSearchForm.triggerHandler(\"ondomincluded\");\r\n            }\r\n\r\n            container.element.html(element);\r\n            self.searchFormParams.navigation.navigate(container.id);\r\n\r\n            self.containerGridResults = self.currentSearchForm.container.find(\".bz-container__search-results\");\r\n            self.containerSearchCriteria = self.currentSearchForm.container.find(\".bz-container__search-criteria\");\r\n\r\n            self.applyButtons(container);\r\n        }).fail(function (error_obj) {\r\n            if (self.hasSessionFormException(error_obj)) {\r\n                self.goToStartPage(error_obj);\r\n            } else {\r\n                var errorTemplate = self.renderFactory.getCommonTemplate(\"form-error\");\r\n                var message = error_obj && error_obj.message ? error_obj.message : error_obj;\r\n\r\n                $($.fasttmpl(errorTemplate, {message: message}))\r\n                    .appendTo(container.element);\r\n\r\n                self.searchFormParams.navigation.navigate(container.id);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get the addform and show it\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    renderAddForm: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var properties = self.properties;\r\n\r\n        if (typeof self.addContainer === \"undefined\") {\r\n            var message = bizagi.localization.getResource(\"render-dialog-entity\");\r\n            self.addContainer = self.searchFormParams.navigation.createRenderContainer({title: message});\r\n\r\n            // Binds the view close event, and send the RollBack\r\n            self.addContainer.element.bind(\"close\", function () {\r\n                delete self.addContainer;\r\n            });\r\n        }\r\n\r\n        var isRefresh = params.isRefresh || false;\r\n\r\n        var getFormParams = {\r\n            idPageCache: params.idPageCache,\r\n            guidEntity: properties.entity,\r\n            contextType: \"entity\"\r\n        };\r\n\r\n        if (isRefresh) {\r\n            getFormParams.isRefresh = true;\r\n            getFormParams.idStartScope = params.idStartScope;\r\n        } else {\r\n            getFormParams.idRender = properties.idRender;\r\n            getFormParams.requestedForm = \"addForm\";\r\n        }\r\n\r\n        // Get the addform\r\n        $.when(self.dataService.getFormData(getFormParams)).then(function (data) {\r\n            if (params.editable === false) {\r\n                data.form.properties.editable = false;\r\n            }\r\n\r\n            if (typeof (data.form.properties) !== \"undefined\") {\r\n                data.form.properties.orientation = self.searchParams.orientation || \"ltr\";\r\n            }\r\n\r\n            data.form.contextType = \"entity\";\r\n\r\n            var form = self.renderFactory.getContainer($.extend({}, self.addFormParams, {\r\n                type: \"form\",\r\n                data: data.form,\r\n                focus: params.focus || false,\r\n                selectedTabs: params.selectedTabs,\r\n                isRefresh: isRefresh,\r\n                requestedForm: params.requestedForm,\r\n                navigation: self.searchFormParams.navigation,\r\n                view_container: self.addContainer\r\n            }));\r\n\r\n            form.buttons = [\r\n                $.extend(\r\n                    form.buttons[0] || {},\r\n                    {\r\n                        \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n                        \"actions\": [\"submitData\", \"refresh\"],\r\n                        \"submitData\": true,\r\n                        \"refresh\": true,\r\n                        \"ordinal\": 0,\r\n                        \"action\": \"save\",\r\n                        \"save\": true,\r\n                        \"style\": \"\",\r\n                    },\r\n                    {\r\n                        //This callback avoid to call the default processButton in the form\r\n                        callback: function () {\r\n                            // When the data is saved then\r\n                            return self.saveDataAddForm(form).done(function () {\r\n\r\n                                self.addContainer.destroy();\r\n                                delete self.addContainer;\r\n\r\n                                // Force a search after a new item is created!\r\n                                self.searchParams.maxRows = 1;\r\n                                self.currentSearchForm.performSearch(self.searchParams);\r\n                            })\r\n                        }\r\n                    }),\r\n                $.extend(\r\n                    form.buttons[1] || {},\r\n                    {\r\n                        \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n                        \"actions\": [\"submitData\", \"refresh\"],\r\n                        \"submitData\": true,\r\n                        \"refresh\": true,\r\n                        \"ordinal\": 1,\r\n                        \"action\": \"back\",\r\n                        \"save\": true,\r\n                        \"style\": \"\"\r\n                    },\r\n                    {\r\n                        // This callback avoid to call the default processButton in the form\r\n                        callback: function () {\r\n                            self.addContainer.destroy();\r\n                            delete self.addContainer;\r\n                        }\r\n                    })\r\n            ];\r\n\r\n            $.extend(form, {\r\n                processButtons: function () {\r\n                    // Not send information set in memory and save\r\n                    $.each(form.buttons, function (index, element) {\r\n                        switch (element[\"ordinal\"]) {\r\n                            case 1: //next button will behave as a cancel button\r\n                                $(form.getButtons()[index]).click(function () {\r\n                                    self.addContainer.destroy();\r\n                                    delete self.addContainer;\r\n                                });\r\n\r\n                                form.getButtons()[index].innerHTML = bizagi.localization.getResource(\"render-form-dialog-box-close\");\r\n                                form.buttons[index].caption = bizagi.localization.getResource(\"render-form-dialog-box-close\");\r\n                                form.buttons[index].action = \"back\";\r\n                                break;\r\n\r\n                            default:\r\n                                $(form.getButtons()[index]).click(function () {\r\n                                    self.saveDataAddForm(form);\r\n\r\n                                    self.addContainer.destroy();\r\n                                    delete self.addContainer;\r\n                                });\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            (Object.keys(form.children) || [])\r\n                .map(function (indicator) {\r\n                    form.children[indicator].params = $.extend({}, form.children[indicator].params, self.addFormParams);\r\n                });\r\n\r\n            return $.when(form.render()).done(function (element) {\r\n                // Set currents search form\r\n                self.currentAddForm = form.firstChild();\r\n                self.addContainer.element.html(element);\r\n\r\n                if (!isRefresh) {\r\n                    self.searchFormParams.navigation.navigate(self.addContainer.id);\r\n                }\r\n\r\n                self.addContainer.setNavigationButtons(form);\r\n\r\n                form.triggerHandler(\"ondomincluded\");\r\n\r\n                // if is any modal view displayed, hide it to allow this search form been displayed\r\n                self.handleSearchFormZindex(\"show\");\r\n\r\n                form.bind(\"refresh\", function (_, refreshParams) {\r\n                    refreshParams.scrollTop = self.form.container.parent().scrollTop();\r\n                    refreshParams = $.extend({\r\n                        focus: focus,\r\n                        selectedTabs: self.form.getSelectedTabs(),\r\n                        isRefresh: true,\r\n                        contextType: self.properties.contextType || \"\",\r\n                        navigation: self.searchFormParams.navigation,\r\n                        view_container: self.addContainer\r\n                    }, refreshParams);\r\n\r\n                    return self.renderAddForm(refreshParams);\r\n                });\r\n\r\n            });\r\n        }).fail(function (error) {\r\n            var error_obj = bizagi.util.getErrorFormatted(error);\r\n\r\n            if (self.hasSessionFormException(error_obj)) {\r\n                self.goToStartPage(error_obj);\r\n            } else {\r\n                self.addContainer.destroy();\r\n                delete self.addContainer;\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Save data to add form\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    saveDataAddForm: function (form) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n\r\n        if (form.validateForm()) {\r\n            var data = {};\r\n            $.forceCollectData = true;\r\n\r\n            form.collectRenderValues(data);\r\n            data.idPageCache = form.idPageCache;\r\n\r\n            var params = {\r\n                action: \"SAVE\",\r\n                data: data,\r\n                idPageCache: data.idPageCache,\r\n                guidEntity: form.properties.entity,\r\n                contexttype: \"entity\"\r\n            };\r\n\r\n            // Check if the add form has data\r\n            var formData = {};\r\n\r\n            form.collectRenderValuesForSubmit(formData);\r\n\r\n            // Turn off flag\r\n            $.forceCollectData = false;\r\n\r\n            if (!bizagi.util.isMapEmpty(formData)) {\r\n                $.when(self.dataService.submitData(params))\r\n                    .done(function (response) {\r\n                        function dataHasXpath(xpath) {\r\n                            var render = self.currentSearchForm.getRender(xpath);\r\n\r\n                            if (typeof render === \"object\" && render !== null)\r\n                                return {\"found\": true, \"obj\": render};\r\n                            return {\"found\": false, \"obj\": {}};\r\n                        }\r\n\r\n                        for (var i in formData) {\r\n                            var mapping = dataHasXpath(i);\r\n                            if (mapping.found) {\r\n                                mapping.obj.setValue(formData[i]);\r\n                                self.setDisplayValueToControl(mapping.obj, form, i, formData);\r\n                            }\r\n                        }\r\n\r\n                        defer.resolve();\r\n                    }).fail(function (error) {\r\n                    var error_obj = bizagi.util.getErrorFormatted(error);\r\n\r\n                    if (self.hasSessionFormException(error_obj)) {\r\n                        self.goToStartPage(error_obj);\r\n                    } else {\r\n                        var message = error_obj.message || bizagi.localization.getResource(\"workportal-general-error\");\r\n\r\n                        form.addValidationMessage(message);\r\n                    }\r\n\r\n                    defer.reject();\r\n                });\r\n            } else {\r\n                // Form has not data\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"render-search-advanced-no-filters\"));\r\n                defer.reject();\r\n            }\r\n        } else {\r\n            defer.reject();\r\n        }\r\n\r\n        return defer;\r\n    },\r\n\r\n    /***\r\n     * Set display value by control type, when add new record\r\n     * @param renderControlSearchForm\r\n     * @param addForm\r\n     * @param xpath\r\n     * @param formData\r\n     */\r\n    setDisplayValueToControl: function (renderControlSearchForm, addForm, xpath, formData) {\r\n        if (renderControlSearchForm.properties.type === \"searchSuggest\") {\r\n            renderControlSearchForm.setDisplayValue(addForm.getRender(xpath).getDisplayValue());\r\n        } else {\r\n            renderControlSearchForm.setDisplayValue(formData[xpath]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * configure searchform buttons\r\n     * */\r\n    applyButtons: function (container) {\r\n        var self = this;\r\n\r\n        self.displayBottomButtons(container);\r\n\r\n        container.element.bind(\"close\", function () {\r\n            self.searchFormDeferred.reject();\r\n        });\r\n    },\r\n\r\n    loadSearchTab: function (params, tab, searchForm) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // If the tab has children it is loaded already\r\n        if (tab.children.length > 0) return null;\r\n\r\n        // Load search form data\r\n        $.when(self.getSearchFormData(params, searchForm))\r\n            .pipe(function (data) {\r\n                // Render data inside selected tab\r\n                var searchFormContainer = self.renderFactory.getContainer({\r\n                    type: \"searchForm\",\r\n                    data: data.form\r\n                });\r\n\r\n                tab.children.push(searchFormContainer);\r\n                return searchFormContainer.render();\r\n            })\r\n            .done(function (element) {\r\n                // Remove button container\r\n                $(\".ui-bizagi-button-container\", element).detach();\r\n                tab.container.append(element);\r\n                defer.resolve();\r\n            });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * Creates the search dialog sub-containers\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    getSearchContainerData: function (params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n        var data = {\r\n            form: {\r\n                properties: {},\r\n                elements: []\r\n            }\r\n        };\r\n\r\n        var container = data.form;\r\n        var searchFormToLoad = self.searchForms[0];\r\n\r\n        // When there are more than one search form, render a tab container\r\n        if (self.searchForms.length > 1) {\r\n            var tabContainer = {\r\n                properties: {\r\n                    type: \"tab\"\r\n                },\r\n                elements: []\r\n            };\r\n\r\n            var otherElements = [];\r\n\r\n            $.each(self.searchForms, function (i, searchForm) {\r\n                var isDefault = searchForm[\"default\"] || false;\r\n                // Create tab item\r\n                var tab = {\r\n                    properties: {\r\n                        id: i,\r\n                        type: \"tabItem\",\r\n                        displayName: searchForm.caption\r\n                    },\r\n                    elements: []\r\n                };\r\n\r\n                // Append children\r\n                if (isDefault) {\r\n                    tabContainer.elements.push({container: tab});\r\n                    // Set properties to load default container\r\n                    container = tab;\r\n                    searchFormToLoad = self.searchForms[0];\r\n                } else {\r\n                    otherElements.push({container: tab});\r\n                }\r\n            });\r\n\r\n            // Append no defaults elements\r\n            $.each(otherElements, function (i, element) {\r\n                tabContainer.elements.push(element);\r\n            });\r\n\r\n            data.form.elements.push({container: tabContainer});\r\n        }\r\n\r\n        // Loads default form\r\n        $.when(self.getSearchFormData(params, searchFormToLoad))\r\n            .done(function (searchFormData) {\r\n                container.elements.push(searchFormData);\r\n                container.properties.id = Math.guid();\r\n\r\n                // Resolve deferred\r\n                deferred.resolve(data);\r\n            }).fail(function (error) {\r\n            var message = bizagi.util.getErrorFormatted(error);\r\n            deferred.reject(message);\r\n        });\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    /**\r\n     * Loads a search form\r\n     * @param {} params\r\n     * @param {} searchForm\r\n     * @returns {}\r\n     */\r\n    getSearchFormData: function (params, searchForm) {\r\n        var self = this;\r\n\r\n        return self.dataService.getSearchFormData($.extend(params, {\r\n            idSearchForm: searchForm.id,\r\n            url: searchForm.url\r\n        })).pipe(function (data) {\r\n            // Append search render properties\r\n            data.form.properties.idRender = params.idRender;\r\n            return data;\r\n        });\r\n    },\r\n\r\n    displayBottomButtons: function (container) {\r\n        var self = this;\r\n        var containerButtons = self.currentSearchForm.container.find(\".bz-container__button-edit\").empty().show();\r\n        var templateBtn = \"<button class='ui-bizagi-form-button ${name}'>${text}</button>\";\r\n\r\n        var btnSearch = $.tmpl(templateBtn, {\r\n            name: \"bz-btn-search\",\r\n            text: bizagi.localization.getResource(\"render-form-dialog-box-search\")\r\n        }).appendTo(containerButtons);\r\n\r\n        var btnSelect = $.tmpl(templateBtn, {\r\n            name: \"bz-btn-select\",\r\n            text: bizagi.localization.getResource(\"render-search-advanced-results-button\")\r\n        }).appendTo(containerButtons);\r\n\r\n        var btnAdd = $.tmpl(templateBtn, {\r\n            name: \"bz-btn-add\",\r\n            text: bizagi.localization.getResource(\"render-form-dialog-box-add\")\r\n        }).appendTo(containerButtons);\r\n        var btnCancel = $.tmpl(templateBtn, {\r\n            name: \"bz-btn-cancel\",\r\n            text: bizagi.localization.getResource(\"render-form-dialog-box-cancel\")\r\n        }).appendTo(containerButtons);\r\n\r\n        container.element.bind(\"close\", function (e) {\r\n            //If the view results is in front, shouldn't go back, but change the showed panel\r\n            if (self.containerSearchCriteria.css(\"display\") === \"none\") {\r\n                e.preventDefault();\r\n                setSearchState();\r\n            }\r\n        });\r\n\r\n        var setSearchState = function setSearchButtons() {\r\n            // List possible buttons for search\r\n            var buttons = [\r\n                {\r\n                    \"ordinal\": 1,\r\n                    \"action\": \"search\",\r\n                    \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-search\"),\r\n                    \"callback\": function () {\r\n                        // The Grid only support one row per page in smartphone (DRAGON-41733 / QAF-3916)\r\n                        self.searchParams.maxRows = 1;\r\n                        return self.currentSearchForm.performSearch(self.searchParams);\r\n                    },\r\n                },\r\n                {\r\n                    \"ordinal\": 2,\r\n                    \"action\": \"cancel\",\r\n                    \"caption\": \"cancel\",\r\n                    \"callback\": function () {\r\n                        self.searchFormDeferred.reject();\r\n                        container.destroy();\r\n                    },\r\n                },\r\n                {\r\n                    \"ordinal\": 3,\r\n                    \"action\": \"add\",\r\n                    \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-add\"),\r\n                    \"callback\": function () {\r\n                        var params = {\r\n                            \"idCase\": self.searchFormParams.idCase,\r\n                            \"idRender\": self.properties.idRender,\r\n                            \"displayName\": self.properties.displayName,\r\n                            \"idPageCache\": self.properties.idPageCache,\r\n                        };\r\n\r\n                        self.renderAddForm(params);\r\n                    },\r\n                },\r\n            ];\r\n\r\n            self.containerSearchCriteria.show();\r\n            self.containerGridResults.hide();\r\n\r\n            // Add only seen when allowed\r\n            $(btnAdd).toggle(self.searchParams.allowNew);\r\n            btnSearch.show();\r\n            btnSelect.hide();\r\n\r\n            if (!self.searchParams.allowNew) {\r\n                buttons.pop();\r\n            }\r\n\r\n            self.form.buttons = buttons;\r\n            delete self.form.properties.virtual;\r\n            container.setNavigationButtons(self.form);\r\n        };\r\n\r\n        var setResultState = function setSearchButtons() {\r\n\r\n            // List posible buttons for result\r\n            var buttons = [\r\n                {\r\n                    \"ordinal\": 4,\r\n                    \"action\": \"select\",\r\n                    \"caption\": bizagi.localization.getResource(\"render-search-advanced-results-button\"),\r\n                    \"callback\": function () {\r\n                        self.searchFormDeferred.resolve(container.element.find(\".bz-container__search-results [data-key]\").data(\"business-key\"));\r\n                        container.destroy();\r\n                    },\r\n                },\r\n                {\r\n                    \"ordinal\": 5,\r\n                    \"action\": \"cancel\",\r\n                    \"caption\": \"cancel\",\r\n                    \"callback\": function () {\r\n                        setSearchState();\r\n                    },\r\n                },\r\n                {\r\n                    \"ordinal\": 3,\r\n                    \"action\": \"add\",\r\n                    \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-add\"),\r\n                    \"callback\": function () {\r\n                        var params = {\r\n                            \"idCase\": self.searchFormParams.idCase,\r\n                            \"idRender\": self.properties.idRender,\r\n                            \"displayName\": self.properties.displayName,\r\n                            \"idPageCache\": self.properties.idPageCache,\r\n                        };\r\n\r\n                        self.renderAddForm(params);\r\n                    },\r\n                },\r\n            ];\r\n\r\n            self.containerSearchCriteria.hide();\r\n            self.containerGridResults.show();\r\n\r\n            // Add only seen when allowed\r\n            $(btnAdd).toggle(self.searchParams.allowNew);\r\n            btnSearch.hide();\r\n            btnSelect.show();\r\n\r\n            if (!self.searchParams.allowNew) {\r\n                buttons.pop();\r\n            }\r\n\r\n            self.form.buttons = buttons;\r\n            self.form.properties.virtual = true;\r\n            container.setNavigationButtons(self.form);\r\n        };\r\n\r\n        btnSearch.bind(\"click\", function () {\r\n            // The Grid only support one row per page in smartphone (DRAGON-41733 / QAF-3916)\r\n            self.searchParams.maxRows = 1;\r\n            self.currentSearchForm.performSearch(self.searchParams);\r\n        });\r\n\r\n        btnAdd.bind(\"click\", function () {\r\n            var params = {\r\n                \"idCase\": self.searchFormParams.idCase,\r\n                \"idRender\": self.properties.idRender,\r\n                \"displayName\": self.properties.displayName,\r\n                \"idPageCache\": self.properties.idPageCache\r\n            };\r\n\r\n            self.renderAddForm(params);\r\n        });\r\n\r\n        btnCancel.bind(\"click\", function () {\r\n            self.searchFormDeferred.reject();\r\n            container.destroy();\r\n        });\r\n\r\n        btnSelect.bind(\"click\", function () {\r\n            self.searchFormDeferred.resolve(container.element.find(\".bz-container__search-results [data-key]\").data(\"business-key\"));\r\n            container.destroy();\r\n        });\r\n\r\n        self.currentSearchForm.bind(\"instancerefreshdone\", function () {\r\n            // Show search results container\r\n            if (self.currentSearchForm.resultsGrid.properties.data !== null &&\r\n                !$.isEmptyObject(self.currentSearchForm.resultsGrid.properties.data.rows) &&\r\n                self.currentSearchForm.resultsGrid.properties.data.rows.length > 0\r\n            ) {\r\n                setResultState();\r\n            } else {\r\n                setSearchState();\r\n            }\r\n        });\r\n\r\n        setSearchState();\r\n    },\r\n\r\n    handleSearchFormZindex: function (option) {\r\n        // If there is an open modal, change z-index to make searchForm visible\r\n        var modalViewDisplayed = $.grep($(\".km-modalview-root\"), function (n, i) {\r\n            return ($(n).css(\"display\") === \"block\");\r\n        });\r\n\r\n        if (modalViewDisplayed.length > 0) {\r\n            var index = option === \"show\" ? 0 : 10001;\r\n            $(modalViewDisplayed).css(\"z-index\", index);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Idle timer expired exception\r\n     * @param error\r\n     * @returns {boolean}\r\n     */\r\n    hasSessionFormException: function (error) {\r\n        return typeof (error) !== \"undefined\" && error.code === \"AUTH_ERROR\";\r\n    },\r\n\r\n    /**\r\n     * Navigate to main page\r\n     * @param error\r\n     */\r\n    goToStartPage: function (error) {\r\n        if (this.searchFormParams.navigation) {\r\n            this.searchFormParams.navigation.goToStartPage(error);\r\n        }\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: BizAgi Smartphone slide StartForm implementation\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   Serves as an slide form that can render a inner form\r\n */\r\n\r\n// Extends itself\r\n$.Class.extend(\"bizagi.rendering.smartphone.startForm\", {}, {\r\n\r\n    /* CONSTRUCTOR\r\n     =====================================================*/\r\n    init: function (dataService, renderFactory, slideFormParams) {\r\n        var self = this;\r\n\r\n        // Define instance variables\r\n        self.dataService = dataService;\r\n        self.renderFactory = renderFactory;\r\n        self.slideFormParams = slideFormParams || {};\r\n\r\n        // Create container    \t\r\n        self.slideContainer = self.slideFormParams.navigation.createRenderContainer({title: self.slideFormParams.title});\r\n        self.configureViewHandlers();\r\n    },\r\n\r\n    /**\r\n     * Handlers de la vista de kendo\r\n     */\r\n    configureViewHandlers: function () {\r\n    },\r\n\r\n    /**\r\n     * go back and destroy\r\n     */\r\n    goBack: function () {\r\n        var self = this;\r\n        self.slideContainer.destroy();\r\n    },\r\n\r\n    /*\r\n     *   Render the form\r\n     *   The params are the same that will be send to the ajax service\r\n     *   Returns a deferred\r\n     */\r\n    render: function (params) {\r\n        var self = this;\r\n        // Fill content\r\n        self.renderSlideForm(params);\r\n    },\r\n\r\n    /* RENDERS slideForm\r\n     =====================================================*/\r\n    renderSlideForm: function (params) {\r\n\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // Load template and data\r\n        $.when(self.dataService.getStartForm(params)).then(function (data) {\r\n            /*** SUCCESS FILTER **/\r\n            // Apply editable param\r\n            if (params.editable === false) {\r\n                data.form.properties.editable = false;\r\n            }\r\n\r\n            // Render dialog template\r\n            var formClass = bizagi.rendering.smartphone.form.extend({\r\n                submitForm: function () {\r\n                    if (self.form) {\r\n                        this.endLoading();\r\n                        // Perform validations\r\n                        if (self.form.validateForm()) {\r\n                            // Collect data\r\n                            var data = {};\r\n                            self.form.collectRenderValues(data);\r\n                            // Add page cache for this form\r\n                            data.idPageCache = self.form.getPageCache();\r\n                            // Call user callback\r\n                            if (self.slideFormParams.onSave) {\r\n                                $.when(self.slideFormParams.onSave(data))\r\n                                    .done(function (result) {\r\n                                        if (result === null || result === true || result.type === \"success\") {\r\n                                            defer.resolve();\r\n                                            self.goBack();\r\n                                        } else if (result.type === \"validationMessages\") {\r\n                                            // Add validation messages\r\n                                            self.form.addValidationMessage(result.messages);\r\n                                            // Update original value to use as reference to other futures changes in the dialogBox\r\n                                            $.each(data, function (key) {\r\n                                                var renders = self.form.getRenders(key);\r\n                                                $.each(renders, function (i, render) {\r\n                                                    render.updateOriginalValue();\r\n                                                });\r\n                                            });\r\n                                        } else if (result.type === \"error\") {\r\n                                            // Add error messages\r\n                                            self.form.addErrorMessage(result.message);\r\n                                        }\r\n                                    });\r\n\r\n                            } else {\r\n                                defer.resolve();\r\n                                self.goBack();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            var containerParams = $.extend({\r\n                    type: \"form\",\r\n                    data: data.form,\r\n                    navigation: self.slideFormParams.navigation,\r\n                    view_container: self.slideContainer\r\n                },\r\n                {\r\n                    renderFactory: self.renderFactory,\r\n                    dataService: self.renderFactory.dataService\r\n                });\r\n            self.form = new formClass(containerParams);\r\n            // Attach a refresh handler to recreate all the form\r\n            self.form.bind(\"refresh\", function (_, refreshParams) {\r\n                refreshParams = $.extend({\r\n                    selectedTabs: self.form.getSelectedTabs(),\r\n                    isRefresh: true\r\n                }, params, refreshParams, {idStartScope: self.form.properties.idStartScope});\r\n\r\n                self.renderSlideForm(refreshParams);\r\n            });\r\n            // Return rendering promise\r\n\r\n            self.form.buttons = [\r\n                $.extend(\r\n                    self.form.buttons[0] || {},\r\n                    {\r\n                        \"caption\": self.slideFormParams.saveButtonLabel,\r\n                        \"actions\": [\"submitData\", \"refresh\"],\r\n                        \"submitData\": true,\r\n                        \"refresh\": true,\r\n                        \"ordinal\": 0,\r\n                        \"action\": \"save\",\r\n                        \"save\": true,\r\n                        \"style\": \"\",\r\n                    },\r\n                    {\r\n                        //This callback avoid to call the default processButton in the form\r\n                        callback: function () {\r\n                            // When the data is saved then\r\n                            self.form.submitForm();\r\n                        },\r\n                    }),\r\n                $.extend(\r\n                    self.form.buttons[1] || {},\r\n                    {\r\n                        \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n                        \"actions\": [\"submitData\", \"refresh\"],\r\n                        \"submitData\": true,\r\n                        \"refresh\": true,\r\n                        \"ordinal\": 1,\r\n                        \"action\": \"back\",\r\n                        \"save\": true,\r\n                        \"style\": \"\",\r\n                    },\r\n                    {\r\n                        //This callback avoid to call the default processButton in the form\r\n                        callback: function () {\r\n                            if (self.slideFormParams.onCancel) {\r\n                                self.slideFormParams.onCancel();\r\n                            }\r\n                            self.goBack();\r\n                        },\r\n                    }),\r\n            ];\r\n\r\n            return self.form.render();\r\n        }).done(function (element) {\r\n            var saveButtonLabel = (self.slideFormParams.saveButtonLabel ? self.slideFormParams.saveButtonLabel : bizagi.localization.getResource(\"render-form-dialog-box-save\"));\r\n            var cancelButtonLabel = bizagi.localization.getResource(\"render-form-dialog-box-cancel\");\r\n            // Append form  in the view\r\n            self.slideContainer.element.html(element);\r\n\r\n            if (!params.isRefresh) {\r\n                self.slideFormParams.navigation.navigate(self.slideContainer.id);\r\n            }\r\n\r\n            $(\".ui-bizagi-button-container div\", self.form.container).remove();\r\n\r\n            $(\".ui-bizagi-button-container\", self.form.container)\r\n                .append(\"<div ordinal='0' id='formButton0' class='action-button ui-bizagi-form-button'>\" +\r\n                    saveButtonLabel + \"</div>\").delegate(\"div[ordinal='0']\", \"click\", function () {\r\n                self.form.submitForm();\r\n            });\r\n\r\n            $(\".ui-bizagi-button-container\", self.form.container)\r\n                .append(\"<div ordinal='1' id='formButton1' class='action-button ui-bizagi-form-button'>\" +\r\n                    cancelButtonLabel + \"</div>\").delegate(\"div[ordinal='1']\", \"click\", function () {\r\n                self.slideFormParams.onCancel && self.slideFormParams.onCancel();\r\n                self.goBack();\r\n            });\r\n\r\n            //self.view.scroller.reset();\r\n            // Publish an event to check if the form has been set in the DOM\r\n            self.form.triggerHandler(\"ondomincluded\");\r\n        }).fail(function (xhr, errorType, message) {\r\n            /*** FAIL FILTER **/\r\n            var errorTemplate = self.renderFactory.getCommonTemplate(\"form-error\");\r\n            var error_message = message.message || \"Error\";\r\n\r\n            $.tmpl(errorTemplate, {message: error_message}).appendTo(self.slideContainer.element);\r\n            // Navigate on view\r\n            self.slideFormParams.navigation.navigate(self.slideContainer.id);\r\n        });\r\n\r\n        return defer.promise();\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Tablet slide form implementation\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   Serves as an slide form that can render a inner form\r\n */\r\n\r\n// Extends itself\r\n$.Class.extend('bizagi.rendering.smartphone.slide.adhocForm', {}, {\r\n\r\n   /* CONSTRUCTOR\r\n     =====================================================*/\r\n     init: function (renderFactory, slideFormParams) {\r\n\r\n        var self = this;\r\n\r\n        // Define instance variables\r\n        this.renderFactory = renderFactory;\r\n        this.slideFormDeferred = new $.Deferred();\r\n        this.slideFormParams = slideFormParams || {};\r\n\r\n        // Create container\r\n        self.container = self.slideFormParams.navigation.createRenderContainer({title: self.slideFormParams.title});\r\n    },\r\n\r\n    /**\r\n     * Render the grid view form\r\n     * The params are the same that will be send to the ajax service\r\n     * @param {} params\r\n     * @returns {} Returns a deferred\r\n     */\r\n    render: function (params) {\r\n        var self = this;\r\n\r\n        // Fill content\r\n        self.renderSlideForm(params);\r\n        // Return promise\r\n        return self.slideFormDeferred.promise();\r\n    },\r\n\r\n    /* RENDERS slideForm\r\n     =====================================================*/\r\n    renderSlideForm: function (params) {\r\n\r\n        var self = this;\r\n        var data = self.transformData(params);\r\n\r\n        // Load template and data\r\n        self.form = self.renderFactory.getContainer({\r\n            type: \"form\",\r\n            data: data.form,\r\n            navigation: this.slideFormParams.navigation,\r\n            view_container: self.container\r\n        });\r\n\r\n        self.form.buttons = [$.extend(self.form.buttons[0] || {},\r\n            {\r\n                \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n                \"actions\": [\"submitData\", \"refresh\"],\r\n                \"submitData\": true,\r\n                \"refresh\": true,\r\n                \"ordinal\": 0,\r\n                \"action\": \"save\",\r\n                \"save\": true,\r\n                \"style\": \"\",\r\n                // This callback avoid to call the default processButton in the form\r\n                callback: function () {\r\n                    if(self.form.validateForm()) {\r\n                        self.goBack();\r\n                        // Resolve deferred with form data\r\n                        var data = {};\r\n                        self.form.collectRenderValues(data);\r\n                        self.slideFormDeferred.resolve(data);\r\n                    }\r\n                }\r\n            }),\r\n            $.extend(self.form.buttons[1] || {},\r\n                {\r\n                    \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n                    \"actions\": [\"submitData\", \"refresh\"],\r\n                    \"submitData\": true,\r\n                    \"refresh\": true,\r\n                    \"ordinal\": 1,\r\n                    \"action\": \"back\",\r\n                    \"save\": true,\r\n                    \"style\": \"\",\r\n                    //This callback avoid to call the default processButton in the form\r\n                    callback: function () {\r\n                        // Close slide\r\n                        self.goBack();\r\n                        self.slideFormDeferred.reject();\r\n                    }\r\n                })\r\n        ];\r\n\r\n        // Add save button if the form is editable\r\n        if (!self.slideFormParams.allowEdition) {\r\n            self.form.buttons.shift();\r\n        }\r\n\r\n        //self._renderButtons(self.form);\r\n\r\n        $.when(self.form.render())\r\n            .done(function (element) {\r\n\r\n                // Append form in the slide view\r\n                self.container.element.html(element);\r\n\r\n                self.slideFormParams.navigation.navigate(self.container.id);\r\n\r\n                self.container.setNavigationButtons(self.form);\r\n\r\n                // Remove default form buttons\r\n                $(\".ui-bizagi-button-container .action-button\", self.form.container).remove();\r\n\r\n                // Add Button\r\n                $(\".ui-bizagi-button-container\", self.form.container).append(self.buttonContainer);\r\n\r\n                // Publish an event to check if the form has been set in the DOM\r\n                self.form.triggerHandler(\"ondomincluded\");\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Transform data into a JSON standard rendering format\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    transformData: function (params) {\r\n        var self = this;\r\n        var row = params.row;\r\n        var columns = params.columns;\r\n        var isAddForm = false;\r\n\r\n        // Set xpath context\r\n        var xpathContext = params.xpathContext.length > 0\r\n            ? params.xpathContext + \".\" + params.xpath + \"[\" + params.row[0] + \"]\"\r\n            : params.xpath + \"[id=\" + params.row[0] + \"]\";\r\n\r\n        var data = {\r\n            type: \"form\",\r\n            form: {\r\n                elements: [],\r\n                pageCacheId: params.pageCacheId,\r\n                sessionId: params.sessionId,\r\n                properties: {\r\n                    xpathContext: xpathContext\r\n                },\r\n                actions: self.transformActions(params.xpath, params.actions),\r\n                validations: self.transformValidations(params.xpath, params.validations)\r\n            }\r\n        };\r\n\r\n        if(row[0] == \"mock_id\") {\r\n            isAddForm = true;\r\n        }\r\n\r\n        $.each(row, function (i, item) {\r\n\r\n            // Skip first data (key not need to be rendered)\r\n            if (i > 0) {\r\n                var element = {render: {properties: $.extend({}, columns[i - 1].properties)}};\r\n\r\n                // Hack properties\r\n                element.render.properties.type = self.mapRenderType(element.render.properties.type);\r\n                element.render.properties.displayType = 'both';\r\n                if (self.slideFormParams.allowEdition == false) element.render.properties.editable = false;\r\n                element.render.properties.value = self.mapValue(element.render.properties.type, item);\r\n                if (element.render.properties.recalculate) element.render.properties.data = null;\r\n\r\n                // Check columnVisible property\r\n                if (typeof (element.render.properties.columnVisible) != \"undefined\") {\r\n                    element.render.properties.visible = element.render.properties.columnVisible;\r\n                }\r\n\r\n                // Fix upload columns\r\n                if (element.render.properties.type == \"readonly\") {\r\n                    element.render.properties.type = \"text\"\r\n                    element.render.properties.editable = false;\r\n                }\r\n\r\n                // Fix upload columns\r\n                if (element.render.properties.type == \"upload\") {\r\n                    element.render.properties.isColumn = true;\r\n                }\r\n\r\n                // Fix search columns\r\n                if (element.render.properties.type == \"search\") {\r\n                    var value = element.render.properties.value;\r\n                    if (value == null) {\r\n                        element.render.properties.value = {};\r\n                    } else if (value.length > 0) {\r\n                        value = [].concat(value[0]);\r\n                        element.render.properties.value = {\r\n                            id: value[0],\r\n                            label: value[1],\r\n                            additionallabel: value[2] || undefined\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (isAddForm && [\"document\", \"formLink\", \"upload\", \"uploadecm\", \"image\", \"search\"].includes(element.render.properties.type)) {\r\n                    element.render.properties.editable = false;\r\n                }\r\n\r\n\r\n                // Add element\r\n                data.form.elements.push(element);\r\n            }\r\n        });\r\n\r\n        return data;\r\n    },\r\n\r\n    /**\r\n     * Map column renderType into normal render\r\n     * @param {} type\r\n     * @returns {}\r\n     */\r\n    mapRenderType: function (type) {\r\n        type = type.replaceAll(\"tablet\", \"\").replaceAll(\"column\", \"\");\r\n\r\n        //some exceptions\r\n        if (type === \"FormLink\") {\r\n            return \"formLink\";\r\n        }\r\n\r\n        type = type.toLowerCase();\r\n        return type;\r\n    },\r\n\r\n    /**\r\n     * Method to traslate grid values into render values\r\n     * @param {} type\r\n     * @param {} value\r\n     * @returns {}\r\n     */\r\n    mapValue: function (type, value) {\r\n        if ([\"combo\", \"radio\", \"list\"].includes(type)) {\r\n            if (value && value.length > 0) {\r\n\r\n                // Transform the value property\r\n                return [{\r\n                    id: value[0][0],\r\n                    value: value[0].length > 2 ? $.grep(value[0], function (item, i) {\r\n                        return i !== 0;\r\n                    }) : value[0][1]\r\n                }];\r\n\r\n            } else {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        // Else: Don't do anything\r\n        return value;\r\n    },\r\n\r\n    /**\r\n     * Parse form actions into just grid form actions\r\n     * @param {} xpath\r\n     * @param {} actions\r\n     * @returns {}\r\n     */\r\n    transformActions: function (xpath, actions) {\r\n        var self = this;\r\n        var gridActions = [];\r\n\r\n        if (bizagi.util.isEmpty(actions)) return gridActions;\r\n\r\n        $.each(actions, function (i, action) {\r\n            var bDependencyFound = false;\r\n            for (var i = 0; i < action.dependencies.length; i++) {\r\n                if (action.dependencies[i].indexOf(xpath) != -1) {\r\n                    bDependencyFound = true;\r\n                }\r\n            }\r\n\r\n            if (bDependencyFound) {\r\n                var newAction = JSON.parse(JSON.encode(action));\r\n\r\n                // Replace dependencies\r\n                for (var i = 0; i < newAction.dependencies.length; i++) {\r\n                    newAction.dependencies[i] = newAction.dependencies[i].replaceAll(xpath + \"[].\", \"\");\r\n                }\r\n\r\n                // Replace conditions\r\n                self.transformConditions(xpath, newAction.conditions);\r\n\r\n                // Replace commands\r\n                self.transformCommands(xpath, newAction.commands);\r\n                self.transformCommands(xpath, newAction.elseCommands);\r\n\r\n                // Add to grid actions\r\n                gridActions.push(newAction);\r\n            }\r\n        });\r\n\r\n        return gridActions;\r\n    },\r\n\r\n    /*\r\n     *   Parse form validations into just grid form validations\r\n     */\r\n    transformValidations: function (xpath, validations) {\r\n        var self = this;\r\n        var gridValidations = [];\r\n\r\n        if (bizagi.util.isEmpty(validations)) return gridValidations;\r\n\r\n        $.each(validations, function (i, validation) {\r\n            var newValidation = JSON.parse(JSON.encode(validation));\r\n\r\n            // Replace conditions\r\n            self.transformConditions(xpath, newValidation.conditions);\r\n\r\n            // Add to grid actions\r\n            gridValidations.push(newValidation);\r\n\r\n        });\r\n\r\n        return gridValidations;\r\n    },\r\n\r\n    /**\r\n     * Parse a single condition or a complex condition in order to prepare a grid action/validation\r\n     * @param {} xpath\r\n     * @param {} condition\r\n     * @returns {}\r\n     */\r\n    transformConditions: function (xpath, condition) {\r\n        var self = this;\r\n\r\n        if (condition.expressions) {\r\n            for (i in condition.expressions) {\r\n                self.transformConditions(xpath, condition.expressions[i]);\r\n            }\r\n\r\n        } else if (condition.simple) {\r\n            self.transformConditions(xpath, condition.simple);\r\n\r\n        } else if (condition.complex) {\r\n            self.transformConditions(xpath, condition.complex);\r\n\r\n        } else {\r\n            if (condition.xpath) {\r\n                condition.xpath = condition.xpath.replaceAll(xpath + \"[].\", \"\");\r\n                if (condition.argumentType == 'xpath') {\r\n                    condition.argument = condition.argument.replaceAll(xpath + \"[].\", \"\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Parse a command action to prepare a grid action\r\n     * @param {} xpath\r\n     * @param {} commands\r\n     * @returns {}\r\n     */\r\n    transformCommands: function (xpath, commands) {\r\n        var self = this;\r\n        var refreshIndex = null;\r\n        if (commands == null || commands.length === 0) return;\r\n\r\n        for (var i = 0; i < commands.length; i++) {\r\n            if (commands[i].command === \"refresh\") {\r\n                refreshIndex = i;\r\n            } else {\r\n                if (commands[i].xpath) {\r\n                    commands[i].xpath = commands[i].xpath.replaceAll(xpath + \"[].\", \"\");\r\n                }\r\n                if (commands[i].argumentType === 'xpath') {\r\n                    commands[i].argument = commands[i].argument.replaceAll(xpath + \"[].\", \"\");\r\n                }\r\n            }\r\n        }\r\n\r\n        if (refreshIndex != null) {\r\n            commands.splice(i, 1);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Go back and destroy\r\n     * @returns {}\r\n     */\r\n    goBack: function () {\r\n        var self = this;\r\n        self.container.destroy();\r\n    },\r\n\r\n    /**\r\n     * Process render buttons\r\n     * @param {} options\r\n     * @returns {}\r\n     */\r\n    _renderButtons: function (form) {\r\n        var self = this;\r\n        var content = $(\"<div class='bz-slide-button-container'></div>\");\r\n\r\n        $.each(form.buttons, function (ui, value) {\r\n            var button = $(\"<div class='action-button'>\" + value.caption + \"</div>\").click(\r\n                value.callback\r\n            ).appendTo(content);\r\n        });\r\n\r\n        self.buttonContainer = content;\r\n    }\r\n});","/**\r\n *   Name: Bizagi Smartphone slide form implementation\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   Serves as an slide form that can render a inner form\r\n */\r\n$.Class.extend(\"bizagi.rendering.smartphone.slide.form\", {}, {\r\n    init: function (dataService, renderFactory, slideFormParams) {\r\n        var self = this;\r\n\r\n        // Define instance variables\r\n        self.dataService = dataService;\r\n        self.renderFactory = renderFactory;\r\n        self.slideFormParams = slideFormParams || {};\r\n\r\n        // Create container\r\n        self.slideContainer = self.slideFormParams.navigation.createRenderContainer({title: self.slideFormParams.title});\r\n        self.configureViewHandlers();\r\n    },\r\n\r\n    /**\r\n     * go back and destroy\r\n     */\r\n    goBack: function () {\r\n        this.slideContainer.destroy();\r\n    },\r\n\r\n    /**\r\n     * Handlers de la vista de kendo\r\n     */\r\n    configureViewHandlers: function () {\r\n    },\r\n\r\n    /*\r\n     *   Render the form\r\n     *   The params are the same that will be send to the ajax service\r\n     *   Returns a deferred\r\n     */\r\n    render: function (params) {\r\n        this.renderSlideForm(params);\r\n    },\r\n\r\n    /* RENDERS slideForm\r\n     =====================================================*/\r\n    renderSlideForm: function (params) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // Load template and data\r\n        $.when(self.dataService.getFormData(params))\r\n            .pipe(function (data) {\r\n                /*** SUCCESS FILTER **/\r\n                // Apply editable param\r\n                if (params.editable === false) {\r\n                    data.form.properties.editable = false;\r\n                }\r\n\r\n                // Render dialog template\r\n                var formClass = bizagi.rendering.smartphone.form.extend({\r\n                    submitForm: function (arguments) {\r\n                        if (self.form) {\r\n                            this.endLoading();\r\n                            // Perform validations\r\n                            if (self.form.validateForm()) {\r\n                                // Collect data\r\n                                var data = {};\r\n                                self.form.collectRenderValues(data);\r\n                                // Add page cache for this form\r\n                                data.idPageCache = self.form.getPageCache();\r\n                                // Call user callback\r\n                                if (self.slideFormParams.onSave) {\r\n                                    $.when(self.slideFormParams.onSave(data))\r\n                                        .done(function (result) {\r\n                                            if (result === null || result === true || result.type === \"success\") {\r\n                                                defer.resolve();\r\n                                                self.goBack();\r\n                                            } else if (result.type === \"validationMessages\") {\r\n                                                // Add validation messages\r\n                                                self.form.addValidationMessage(result.messages);\r\n                                                // Update original value to use as reference to other futures changes in the dialogBox\r\n                                                $.each(data, function (key, value) {\r\n                                                    var renders = self.form.getRenders(key);\r\n                                                    $.each(renders, function (i, render) {\r\n                                                        render.updateOriginalValue();\r\n                                                    });\r\n                                                });\r\n                                            } else if (result.type === \"error\") {\r\n                                                // Add error messages\r\n                                                self.form.addErrorMessage(result.message);\r\n                                            }\r\n                                        });\r\n\r\n                                } else {\r\n                                    defer.resolve();\r\n                                    self.goBack();\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                var containerParams = $.extend({\r\n                    type: \"form\",\r\n                    data: data.form,\r\n                    navigation: self.slideFormParams.navigation,\r\n                    view_container: self.slideContainer\r\n                }, {\r\n                    renderFactory: self.renderFactory,\r\n                    dataService: self.renderFactory.dataService\r\n                });\r\n                self.form = new formClass(containerParams);\r\n\r\n                self.form.buttons = [\r\n                    $.extend(\r\n                        self.form.buttons[0] || {},\r\n                        {\r\n                            \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n                            \"actions\": [\"submitData\", \"refresh\"],\r\n                            \"submitData\": true,\r\n                            \"refresh\": true,\r\n                            \"ordinal\": 0,\r\n                            \"action\": \"save\",\r\n                            \"save\": true,\r\n                            \"style\": \"\",\r\n                        },\r\n                        {\r\n                            //This callback avoid to call the default processButton in the form\r\n                            callback: function () {\r\n                                // When the data is saved then\r\n                                self.form.submitForm();\r\n                            },\r\n                        }),\r\n                    $.extend(\r\n                        self.form.buttons[1] || {},\r\n                        {\r\n                            \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n                            \"actions\": [\"submitData\", \"refresh\"],\r\n                            \"submitData\": true,\r\n                            \"refresh\": true,\r\n                            \"ordinal\": 1,\r\n                            \"action\": \"back\",\r\n                            \"save\": true,\r\n                            \"style\": \"\",\r\n                        },\r\n                        {\r\n                            //This callback avoid to call the default processButton in the form\r\n                            callback: function () {\r\n                                if (self.slideFormParams.onCancel) {\r\n                                    self.slideFormParams.onCancel();\r\n                                }\r\n                                self.goBack();\r\n                            },\r\n                        }),\r\n                ];\r\n\r\n                // Return rendering promise\r\n                return self.form.render();\r\n            }).done(function (element) {\r\n            var saveButtonLabel = (self.slideFormParams.saveButtonLabel ? self.slideFormParams.saveButtonLabel\r\n                : bizagi.localization.getResource(\"render-form-dialog-box-save\"));\r\n            var cancelButtonLabel = bizagi.localization.getResource(\"render-form-dialog-box-cancel\");\r\n\r\n            // Append form  in the view\r\n            self.slideContainer.element.html(element);\r\n            // Navigate on view\r\n            self.slideFormParams.navigation.navigate(self.slideContainer.id);\r\n\r\n            $(\".ui-bizagi-button-container div\", self.form.container).remove();\r\n            $(\".ui-bizagi-button-container\", self.form.container)\r\n                .append(\"<div ordinal=\\\"0\\\" id=\\\"formButton0\\\" class=\\\"action-button ui-bizagi-form-button\\\">\" +\r\n                    saveButtonLabel + \"</div>\").delegate(\"div[ordinal=\\\"0\\\"]\", \"click\", function () {\r\n                self.form.submitForm();\r\n            });\r\n            $(\".ui-bizagi-button-container\", self.form.container)\r\n                .append(\"<div ordinal=\\\"1\\\" id=\\\"formButton1\\\" class=\\\"action-button ui-bizagi-form-button\\\">\" +\r\n                    cancelButtonLabel + \"</div>\").delegate(\"div[ordinal=\\\"1\\\"]\", \"click\", function () {\r\n                self.slideFormParams.onCancel && self.slideFormParams.onCancel();\r\n                self.goBack();\r\n            });\r\n\r\n            // Publish an event to check if the form has been set in the DOM\r\n            self.form.triggerHandler(\"ondomincluded\");\r\n            // Attach a refresh handler to recreate all the form\r\n            self.form.bind(\"refresh\", function () {\r\n                self.renderSlideForm(params);\r\n            });\r\n        }).fail(function (message) {\r\n            /*** FAIL FILTER **/\r\n            var errorTemplate = self.renderFactory.getCommonTemplate(\"form-error\");\r\n            var error_message = message.message || \"Error\";\r\n\r\n            $.tmpl(errorTemplate, {message: error_message}).appendTo(self.slideContainer.element);\r\n            // Navigate on view\r\n            self.slideFormParams.navigation.navigate(self.slideContainer.id);\r\n        });\r\n\r\n        return defer.promise();\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone ECM Slide Implementation\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will shows a ECM form\r\n */\r\n$.Class.extend(\"bizagi.rendering.smartphone.slide.ecm\", {}, {\r\n\r\n    /**\r\n     * Constructor\r\n     * @param dataService\r\n     * @param renderFactory\r\n     * @param slideFormParams\r\n     */\r\n    init: function (dataService, renderFactory, slideFormParams) {\r\n        var self = this;\r\n\r\n        // Define instance variables\r\n        self.dataService = dataService;\r\n        self.renderFactory = renderFactory;\r\n\r\n        self.slideFormParams = slideFormParams || {};\r\n        self.slideFormDeferred = new $.Deferred();\r\n\r\n        // Create container\r\n        self.container = self.slideFormParams.navigation.createRenderContainer({title: self.slideFormParams.title});\r\n    },\r\n\r\n    /**\r\n     * Render the form\r\n     * @param params\r\n     */\r\n    render: function (params) {\r\n\r\n        // Fill content\r\n        this.renderSlideForm(params);\r\n\r\n        // Return promise\r\n        return this.slideFormDeferred.promise();\r\n    },\r\n\r\n    renderSlideForm: function (params) {\r\n        var self = this;\r\n        var data = self.getMetadataForm(params);\r\n\r\n        // Load template and data\r\n        self.form = self.renderFactory.getContainer({\r\n            type: \"form\",\r\n            data: data.form,\r\n            navigation: self.slideFormParams.navigation,\r\n            view_container: self.container\r\n        });\r\n\r\n        // Binds the view close event\r\n        /*self.container.element.bind(\"close\", function () {\r\n            // delete self.container;\r\n            console.log(\"closed!\");\r\n        });*/\r\n\r\n        $.when(self.form.render())\r\n            .done(function ($renderEdition) {\r\n\r\n                // Append form in the slide view\r\n                self.container.element.html($renderEdition);\r\n\r\n                self.slideFormParams.navigation.navigate(self.container.id);\r\n\r\n                self.processButtons(self.form, params);\r\n                self.container.setNavigationButtons(self.form);\r\n\r\n                // Publish an event to check if the form has been set in the DOM\r\n                self.form.triggerHandler(\"ondomincluded\");\r\n\r\n                // Attach a refresh handler to recreate all the form\r\n                /*self.form.bind(\"refresh\", function () {\r\n                    // self.renderSlideForm(params);\r\n                });*/\r\n\r\n            }).always(function () {\r\n            self.slideFormDeferred.resolve();\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Shows the slideForm form container in the browser\r\n     * @returns {} Returns a promise that the dialog will be closed\r\n     */\r\n    processButtons: function (form, params) {\r\n        var self = this;\r\n\r\n        form.buttons = [\r\n            {\r\n                ordinal: 0,\r\n                action: \"save\",\r\n                caption: bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n                callback: self.onSaveDataMetadataForm.bind(self, params.fileData)\r\n            },\r\n            {\r\n                ordinal: 1,\r\n                action: \"back\",\r\n                caption: bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n                callback: function () {\r\n                    self.slideFormParams.onCancel({});\r\n\r\n                    self.goBack();\r\n                }\r\n            }\r\n        ];\r\n\r\n        // Add save button if the form is editable\r\n        if (!self.slideFormParams.editable) {\r\n            form.buttons.shift();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Process render data\r\n     * @param params\r\n     * @returns {{form: *, type: string}}\r\n     */\r\n    getMetadataForm: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            type: \"form\",\r\n            form: {\r\n                elements: [],\r\n                pageCacheId: params.pageCacheId,\r\n                sessionId: params.sessionId,\r\n                properties: {\r\n                    id: 101,\r\n                    xpathContext: params.xpathContext,\r\n                    editable: self.slideFormParams.editable,\r\n                    orientation: self.slideFormParams.orientation || \"ltr\"\r\n                }\r\n            }\r\n        };\r\n\r\n        // Mapping metadata to render\r\n        $.each(params.metadata, function (index, item) {\r\n            var renderType = self.getRenderType(item.metadataType);\r\n\r\n            var newRender = Object.assign({\r\n                \"id\": (index + 1),\r\n                \"xpath\": item.metadataId,\r\n                \"displayName\": item.description,\r\n                \"required\": bizagi.util.parseBoolean(item.required) === true,\r\n                \"editable\": bizagi.util.parseBoolean(item.readOnly) === false,\r\n                \"value\": item.value\r\n            }, renderType);\r\n\r\n            data.form.elements.push({\"render\": {\"properties\": newRender}});\r\n        });\r\n\r\n        return data;\r\n    },\r\n\r\n    /**\r\n     * Get type of render\r\n     * @param type\r\n     * @returns {*}\r\n     */\r\n    getRenderType: function (type) {\r\n        switch (type.toUpperCase()) {\r\n            case \"INTEGER\":\r\n                return {\r\n                    type: \"number\",\r\n                    dataType: 2,\r\n                    allowDecimals: false,\r\n                    thousands: false\r\n                };\r\n            case \"DECIMAL\":\r\n                return {\r\n                    type: \"number\",\r\n                    dataType: 10,\r\n                    allowDecimals: true,\r\n                    thousands: true\r\n                };\r\n            case \"DATETIME\":\r\n                return {type: \"date\", dataType: 12};\r\n            case \"BOOL\":\r\n                return {type: \"boolean\", dataType: 5};\r\n            case \"STRING\":\r\n            default:\r\n                return {\r\n                    type: \"text\",\r\n                    dataType: 15,\r\n                    maxLength: 50,\r\n                    autoExtend: false\r\n                };\r\n\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Save data to ECM form\r\n     * @returns {jQuery}\r\n     * @param fileData\r\n     */\r\n    onSaveDataMetadataForm: function (fileData) {\r\n        var self = this;\r\n        var deferred = $.Deferred();\r\n\r\n        if (self.form.validateForm()) {\r\n            // Check if the add form has data\r\n            var formData = {};\r\n            self.form.collectRenderValuesForSubmit(formData);\r\n\r\n            // Turn off flag\r\n            $.forceCollectData = false;\r\n\r\n            if (!bizagi.util.isMapEmpty(formData)) {\r\n\r\n                var metadataValues = Object.keys(formData)\r\n                    .map(function (key, index) {\r\n                        return {\"idMetadata\": key, \"value\": formData[key]};\r\n                    });\r\n\r\n                var params = {\r\n                    \"idFileUpload\": fileData.idFileUpload,\r\n                    \"fileName\": fileData.fileName,\r\n                    \"idPageCache\": fileData.idPageCache,\r\n                    \"xpathContext\": fileData.xpathContext,\r\n                    \"xPath\": fileData.xpath,\r\n                    \"idAttrib\": fileData.idAttrib\r\n                };\r\n\r\n                params.metaValues = JSON.encode({metadataValues: metadataValues});\r\n                bizagi.loading.start();\r\n\r\n                $.when(self.dataService.updateECMMetadata(params))\r\n                    .done(function (fileProperties) {\r\n                        if (fileProperties && fileProperties.idFileUpload) {\r\n\r\n                            self.slideFormParams.onSave({\r\n                                update: true,\r\n                                idFileUpload: fileProperties.idFileUpload,\r\n                                fileName: fileData.fileName\r\n                            });\r\n\r\n                            deferred.resolve({update: true});\r\n                        }\r\n\r\n                        self.goBack();\r\n\r\n                    }).fail(function (message) {\r\n                    self.form.addValidationMessage(message.message);\r\n                    deferred.reject();\r\n                }).always(function () {\r\n                    bizagi.loading.stop();\r\n                });\r\n            } else {\r\n                self.slideFormParams.onSave({update: false});\r\n                deferred.resolve({update: false});\r\n                self.goBack();\r\n            }\r\n        }\r\n\r\n        deferred.promise();\r\n    },\r\n\r\n    /**\r\n     * Go back and destroy\r\n     */\r\n    goBack: function () {\r\n        this.container.destroy();\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Text Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the text render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.text\", bizagi.rendering.text.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.text.extend(\"bizagi.rendering.smartphone.text\", {}, {\r\n\r\n    //#region Side effects functions\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        // Call base \r\n        this._super();\r\n\r\n        // Define max length of element\r\n        if (this.properties.maxLength > 0)\r\n            this.input.attr(\"maxlength\", this.properties.maxLength);\r\n    },\r\n\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"text-read-only\");\r\n        var value = this.getValue();\r\n        value = (typeof value !== \"undefined\" && value !== null) ? bizagi.util.sanitizeHTML(value) : \"\";\r\n\r\n        var data = {\r\n            value: value,\r\n            editable: this.properties.editable\r\n        };\r\n\r\n        return $.fasttmpl(template, data);\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var decodedValue = bizagi.util.decodeURI(value);\r\n        value = this.validateValue((typeof (decodedValue) == \"string\" ? decodedValue : \"\"), self.properties.maxLength);\r\n\r\n        // Set internal value\r\n        self.setValue(value, false);\r\n\r\n        if (value) {\r\n            value = $.br2nl(value).replaceAll('\\\\n', '\\n');\r\n        }\r\n\r\n        // Set value in input\r\n        if (self.properties.editable) {\r\n            self.input.val(value);\r\n        } else {\r\n            $(\".bz-text-readonly\", self.getControl()).html(bizagi.util.sanitizeHTML(value));\r\n        }\r\n    },\r\n\r\n    attachRetypeDouble: function () {\r\n        var self = this;\r\n        var element = self.element;\r\n\r\n        var input = $(\"input\", element);\r\n        if (!input || input.length === 0) return;\r\n\r\n        // Apply blur handler to check value\r\n        input.blur(function () {\r\n            var control = $(this);\r\n            self.retypeDouble(control);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retype actions\r\n     * @param {} control\r\n     */\r\n    retypeDouble: function (control) {\r\n        var self = this;\r\n        var currentValue = control.val();\r\n        var isVisible = $(control).attr(\"type\") !== \"hidden\" && $(control).css(\"display\") !== \"none\" && $(control).css(\"visibility\") !== \"hidden\";\r\n\r\n        if (isVisible) {\r\n            if (!control.data(\"oldValue\") || $(this).data(\"oldValue\") === \"\") {\r\n\r\n                // Check that there is something in the value or if a value has already been set\r\n                if (currentValue === \"\" || currentValue === control.attr(\"newValue\")) return;\r\n\r\n                self.createTooltip(control, currentValue, self.getResource(\"render-number-retype\"))\r\n\r\n            } else {\r\n                // Check that there is something in the value\r\n                if (currentValue === \"\") return;\r\n\r\n                if (currentValue !== control.data(\"oldValue\")) {\r\n                    self.setValue(\"\");\r\n\r\n                    self.setValidationMessage(self.getResource(\"render-text-retype-error\"));\r\n                    control.val(\"\");\r\n\r\n                    setTimeout(function () {\r\n                        control.focus();\r\n                    }, 100);\r\n\r\n                } else {\r\n                    control.data(\"newValue\", currentValue);\r\n                }\r\n                control.data(\"oldValue\", \"\");\r\n                if (control.data('ui-tooltip')) control.tooltip('destroy');\r\n            }\r\n        }\r\n    },\r\n\r\n    getElementsToStylize: function ($context) {\r\n        return this.properties.editable ? $(\"input\", $context) : $(\".bz-text-readonly\", $context);\r\n    },\r\n\r\n    /**\r\n     * Helptext tooltip\r\n     * @param {} control\r\n     * @param {} currentValue\r\n     * @param {} currentTitle\r\n     */\r\n    createTooltip: function (control, currentValue, currentTitle) {\r\n        this._super(control, currentValue, currentTitle);\r\n\r\n        $('body').bind('touchmove', function (e) {\r\n            $('body').unbind('touchmove');\r\n            if (control.data('ui-tooltip')) control.tooltip('destroy');\r\n        });\r\n    },\r\n\r\n    setValidationMessage: function (message) {\r\n        // Call base\r\n        this._super(message);\r\n\r\n        if (this.cloneRender) {\r\n            this.cloneRender.setValidationMessage(message);\r\n        }\r\n    }\r\n\r\n    //#endregion Side effects functions\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Text Extension\r\n *   Author: UI Forms Team\r\n *   Comments: Extended text implementation\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.extendedText\", bizagi.rendering.extendedText.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.extendedText.extend(\"bizagi.rendering.smartphone.extendedText\", {\r\n    minLines: 2,\r\n    maxLines: 8,\r\n    maxCharactersToShow: 100\r\n}, {\r\n\r\n    //#region Side effects functions\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n        self._super();\r\n        self.textarea = self.getControl().find(\"textarea\");\r\n        if (self.textarea) self.textarea.css({resize: \"vertical\"});\r\n    },\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param {} data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n        var maxLines = this.properties.maxLines;\r\n        this.properties.maxLines = maxLines > this.Class.maxLines ? this.Class.maxLines : (maxLines < this.Class.minLines ? this.Class.minLines : maxLines);\r\n\r\n        // Check if offline forms is supported\r\n        this.isOfflineForm = bizagi.util.isOfflineForm({context: this});\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"extendedText-readOnly\");\r\n        var value = this.getValue();\r\n        value = (typeof value !== \"undefined\" && value !== null) ? bizagi.util.sanitizeHTML(value) : \"\";\r\n        var showChar = this.Class.maxCharactersToShow;\r\n\r\n        var startString = value.substr(0, showChar);\r\n        var endString = value.substr(showChar - 1, value.length - showChar);\r\n\r\n        var data = {\r\n            \"value\": value,\r\n            \"startString\": startString,\r\n            \"endString\": endString\r\n        };\r\n\r\n        return $.fasttmpl(template, data);\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the redered control\r\n     * @param {} value\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var decodedValue = bizagi.util.decodeURI(value);\r\n        decodedValue = (!bizagi.util.isEmpty(decodedValue) && typeof (decodedValue) !== \"string\") ? decodedValue.toString() : decodedValue;\r\n        value = self.validateValue(typeof (decodedValue) == \"string\" ? decodedValue : \"\", self.properties.maxLength);\r\n\r\n        // Call base        \r\n        self.setValue(value, false);\r\n\r\n        if (value) {\r\n            value = $.br2nl(value).replaceAll('\\\\n', '\\n');\r\n        }\r\n\r\n        // Set value in input\r\n        if (self.properties.editable) {\r\n            self.textarea.val(value);\r\n        } else {\r\n            $(\".bz-textarea-readonly\", self.getControl()).html(bizagi.util.sanitizeHTML(value));\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Implement to customize the render's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super();\r\n\r\n        // Define max length of element\r\n\r\n        // Cuando el tipo de dato es extended manda como maxlength 0 por lo que la validacion no puede ir sobre todo el metodo\r\n        if (self.properties.maxLength > 0) {\r\n            self.textarea.attr(\"maxlength\", self.properties.maxLength);\r\n            self.actualMaxLength = self.properties.maxLength;\r\n        }\r\n\r\n        $(self.textarea).bind(\"focus keyup paste\", function (e) {\r\n            if (e.which === 8 || e.which === 46) {\r\n                var currentRow = self.textarea.prop(\"rows\");\r\n                if (currentRow > self.properties.maxLines) {\r\n                    self.textarea.prop(\"rows\", self.properties.maxLines);\r\n                }\r\n            }\r\n            self.updateTextareaSize(this);\r\n        });\r\n\r\n        $(self.textarea).bind(\"blur\", function (e) {\r\n            self.textarea.prop(\"rows\", self.properties.maxLines);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Sets the functions when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        var self = this;\r\n\r\n        var $control = this.getControl();\r\n        $(\".bz-textarea-readonly\", $control).on(\"click\", \".bz-read-more\", function (e) {\r\n            if ($(e.delegateTarget).hasClass(\"bz-textarea-readonly--active\")) {\r\n                $(e.delegateTarget).removeClass(\"bz-textarea-readonly--active\");\r\n                $(this).html(self.getResource(\"workportal-project-discussion-comment-viewmore\"));\r\n            } else {\r\n                $(e.delegateTarget).addClass(\"bz-textarea-readonly--active\");\r\n                $(this).html(self.getResource(\"workportal-project-discussion-comment-viewless\"));\r\n            }\r\n            return false;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Changes control's height when it's auto extended\r\n     * @param {Object} control HTML Object\r\n     */\r\n    updateTextareaSize: function (textarea) {\r\n        if (this.properties.autoExtend) {\r\n            var currentRows = $(textarea).prop(\"rows\");\r\n            if (textarea.scrollHeight > textarea.offsetHeight && currentRows >= this.Class.minLines && currentRows < this.Class.maxLines) {\r\n                //Extend the rows\r\n                $(textarea).prop(\"rows\", (currentRows + 1));\r\n                this.updateTextareaSize(textarea);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Handler of retype double actions\r\n     */\r\n    attachRetypeDouble: function () {\r\n        var self = this;\r\n        var element = self.element;\r\n\r\n        var input = $(\"input, textarea\", element);\r\n        if (!input || input.length === 0) return;\r\n\r\n        // Apply blur handler to check value\r\n        input.blur(function () {\r\n            var control = $(this);\r\n            var previousValue = self.previousValue;\r\n            var value = self.value;\r\n\r\n            if (previousValue != null && value != previousValue) {\r\n                if ($(this).data(\"newValue\") != undefined && control.val() != $(this).data(\"newValue\")) {\r\n                    $(this).data().newValue = undefined;\r\n                }\r\n            }\r\n\r\n            self.retypeDouble(control);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retype actions\r\n     * @param {} control\r\n     */\r\n    retypeDouble: function (control) {\r\n        var self = this;\r\n        var currentValue = control.val();\r\n        var isVisible = $(control).attr(\"type\") !== \"hidden\" && $(control).css(\"display\") !== \"none\" && $(control).css(\"visibility\") !== \"hidden\";\r\n\r\n        if (isVisible) {\r\n            if (!control.data(\"oldValue\") || $(this).data(\"oldValue\") === \"\") {\r\n\r\n                // Check that there is something in the value or if a value has already been set\r\n                if (currentValue === \"\" || currentValue === control.attr(\"newValue\")) return;\r\n\r\n                self.createTooltip(control, currentValue, self.getResource(\"render-number-retype\"))\r\n\r\n            } else {\r\n                // Check that there is something in the value\r\n                if (currentValue === \"\") return;\r\n\r\n                if (currentValue !== control.data(\"oldValue\")) {\r\n                    self.setValue(\"\");\r\n\r\n                    self.setValidationMessage(self.getResource(\"render-text-retype-error\"));\r\n                    control.val(\"\");\r\n\r\n                    setTimeout(function () {\r\n                        control.focus();\r\n                    }, 100);\r\n\r\n                } else {\r\n                    control.data(\"newValue\", currentValue);\r\n                }\r\n                control.data(\"oldValue\", \"\");\r\n                if (control.data('ui-tooltip')) control.tooltip('destroy');\r\n            }\r\n        }\r\n    },\r\n\r\n    getElementsToStylize: function ($context) {\r\n        return this.properties.editable ? $(\"textarea\", $context) : $(\".bz-textarea-readonly\", $context);\r\n    },\r\n\r\n    /**\r\n     * Helptext tooltip\r\n     * @param {} control\r\n     * @param {} currentValue\r\n     * @param {} currentTitle\r\n     */\r\n    createTooltip: function (control, currentValue, currentTitle) {\r\n        this._super(control, currentValue, currentTitle);\r\n\r\n        $('body').bind('touchmove', function (e) {\r\n            $('body').unbind('touchmove');\r\n            if (control.data('ui-tooltip')) control.tooltip('destroy');\r\n        });\r\n    },\r\n\r\n    setValidationMessage: function (message) {\r\n        // Call base\r\n        this._super(message);\r\n\r\n        if (this.cloneRender) {\r\n            this.cloneRender.setValidationMessage(message);\r\n        }\r\n    }\r\n\r\n    //#endregion Side effects functions\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Label Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the label render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.label\", bizagi.rendering.label.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.label.extend(\"bizagi.rendering.smartphone.label\", {}, {});","/**\r\n *   Name: Bizagi Smartphone Render Number Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the number render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.number\", bizagi.rendering.number.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.number.extend(\"bizagi.rendering.smartphone.number\", {}, {\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"number\");\r\n\r\n        return $.fasttmpl(template, {\r\n            value: self.getDisplayValue(),\r\n            editable: self.properties.editable,\r\n            type: \"text\",\r\n            isDesign: self.getMode() !== \"execution\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param value\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self.setValue(value, false);\r\n\r\n        // Set value in input\r\n        if (value != null && self.properties.editable) {\r\n            self.numericInput.val(value);\r\n\r\n            self.value = self.properties.value = value;\r\n\r\n            // Formats the input\r\n            self.executeFormatCurrencyPlugin();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Retype function\r\n     */\r\n    attachRetypeDouble: function () {\r\n        var self = this;\r\n        var element = self.element;\r\n\r\n        var input = $(\"input\", element);\r\n        if (!input || input.length === 0) return;\r\n\r\n        // Apply blur handler to check value\r\n        input.blur(function () {\r\n            var control = $(this);\r\n            var previousValue = self.previousValue;\r\n            var value = self.value;\r\n            var typeControl = self.parent.properties.type;\r\n\r\n            if (typeControl === \"grid\") {\r\n                if (previousValue != null && value !== previousValue) {\r\n                    if ($(this).data(\"newValue\") !== undefined && control.val() !== $(this).data(\"newValue\"))\r\n                        $(this).data().newValue = undefined;\r\n                }\r\n\r\n                self.retypeDouble(control);\r\n            } else {\r\n                self.retypeDouble(control);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retype function\r\n     * @param control\r\n     */\r\n    retypeDouble: function (control) {\r\n        var self = this;\r\n        var currentValue = control.val();\r\n        var isVisible = $(control).attr(\"type\") !== \"hidden\" && $(control).css(\"display\") !== \"none\" && $(control).css(\"visibility\") !== \"hidden\";\r\n\r\n        if (isVisible && $(this).data(\"newValue\") === undefined) {\r\n\r\n            if (!control.data(\"oldValue\") || $(this).data(\"oldValue\") === \"\") {\r\n\r\n                // Check that there is something in the value or if a value has already been set\r\n                if (currentValue === \"\" || currentValue === control.attr(\"newValue\")) return;\r\n\r\n                self.createTooltip(control, currentValue, self.getResource(\"render-number-retype\"))\r\n\r\n            } else {\r\n                // Check that there is something in the value\r\n                if (currentValue === \"\") return;\r\n\r\n                if (currentValue !== control.data(\"oldValue\")) {\r\n                    self.setValue(\"\");\r\n\r\n                    self.createTooltip(control, \"\", self.getResource(\"render-text-retype-error\"))\r\n                } else {\r\n                    control.data(\"newValue\", currentValue);\r\n                    control.data(\"oldValue\", \"\");\r\n                    try {\r\n                        // Destroy tooltips\r\n                        control.tooltip(\"destroy\");\r\n                    } catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Context to apply styles\r\n     * @param context\r\n     * @returns {jQuery|HTMLElement}\r\n     */\r\n\r\n    getElementsToStylize: function($context){\r\n        return $(\"input\", $context); \r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Money Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the money render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.money\", bizagi.rendering.number.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.money.extend(\"bizagi.rendering.smartphone.money\", bizagi.rendering.money.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.money.extend(\"bizagi.rendering.smartphone.money\", {}, {\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"number\");\r\n\r\n        return $.fasttmpl(template, {\r\n            value: self.getDisplayValue(),\r\n            editable: self.properties.editable,\r\n            type: \"text\",\r\n            isDesign: self.getMode() !== \"execution\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     * @returns {}\r\n     */\r\n    setDisplayValue: function (value) {\r\n        // Call base\r\n        this.setValue(value, false);\r\n\r\n        // Set value in input\r\n        if (value !== undefined && value !== null && this.properties.editable) {\r\n            this.numericInput.val(value);\r\n\r\n            // Formats the input\r\n            this.executeFormatCurrencyPlugin();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Context to apply styles\r\n     * @param context\r\n     * @returns {jQuery|HTMLElement}\r\n     */\r\n    /*getElementsToStylize: function (context) {\r\n        return $(\".bz-input\", context);\r\n    }*/\r\n\r\n    \r\n    getElementsToStylize: function($context){\r\n        return  $(\"input\", $context);\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Date Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the date render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.date\", bizagi.rendering.date.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.date.extend(\"bizagi.rendering.smartphone.date\", {\r\n    MAX_YEARS_DISPLAY: 100\r\n}, {\r\n\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var value = this.getFormattedDate(this.getValue(), this.properties.showTime, true)\r\n        value = bizagi.util.dateFormatter.formatDate(value, this.properties.fullFormat);\r\n        var data = {value: value, editable: this.properties.editable};\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n        return $.fasttmpl(template, data);\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        this.input = $(\"input\", this.getDateControl());\r\n    },\r\n\r\n    /**\r\n     * To configure the mobiscroll plugin\r\n     */\r\n    postRender: function () {\r\n        // Call base\r\n        this._super();\r\n        this.input = $(\"input\", this.getDateControl());\r\n    },\r\n\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var controlElements = self.properties.showTime ? [\"calendar\", \"time\"] : [\"calendar\"];\r\n\r\n        var defaultDateControl = self.getFormattedDate(self.properties.value, self.properties.showTime, true);\r\n        var minDateControl = self.getFormattedDate(self.properties.minValue, self.properties.showTime, false);\r\n        var maxDateControl = self.getFormattedDate(self.properties.maxValue, self.properties.showTime, false);\r\n\r\n        var timeFormat = self.properties.showTime ? self.getTimeFormat() : \"\";\r\n\r\n        // Adds a gap of years to show if the user doest not include min years\r\n        if (isNaN(Date.parse(minDateControl))) {\r\n            minDateControl = new Date();\r\n            minDateControl.setFullYear(minDateControl.getFullYear() - self.Class.MAX_YEARS_DISPLAY);\r\n            minDateControl.setHours(0, 0, 0, 0);\r\n        }\r\n\r\n        // Adds a gap of years to show if the user doest not include min years\r\n        if (isNaN(Date.parse(maxDateControl))) {\r\n            maxDateControl = new Date();\r\n            maxDateControl.setFullYear(maxDateControl.getFullYear() + self.Class.MAX_YEARS_DISPLAY);\r\n            maxDateControl.setHours(23, 59, 59);\r\n        }\r\n\r\n        $(\".bz-input-icon\", this.getControl()).mobiscroll().calendar({\r\n            mode: \"mixed\", // Specify scroller mode like: mode: 'mixed' or omit setting to use default\r\n            display: \"bottom\", // Specify display mode like: display: 'bottom' or omit setting to use default\r\n            controls: controlElements,\r\n            min: minDateControl,\r\n            max: maxDateControl,\r\n            defaultValue: defaultDateControl,\r\n            timeFormat: timeFormat,\r\n            showScrollArrows: true,\r\n            lang: bizagi.util.languages[BIZAGI_LANGUAGE] || \"en\",\r\n            headerText: \"{value}\",\r\n            buttons: [\r\n                \"set\",\r\n                {\r\n                    text: this.getResource(\"render-plugin-search-users-clear-button-name\"),\r\n                    handler: function (e, inst) {\r\n                        self.date = undefined;\r\n                        self.time = undefined;\r\n                        self.timeS = undefined;\r\n                        self.onChangeHandler(true);\r\n                        inst.clear();\r\n                    }\r\n                },\r\n                \"cancel\"\r\n            ],\r\n            onSet: function (valueText, inst) {\r\n                var data = inst.getVal();\r\n                self.date = {\"day\": data.getDate(), \"month\": data.getMonth(), \"year\": data.getFullYear()};\r\n\r\n                //Checks if its has time, and included it\r\n                if (self.properties.showTime) {\r\n                    self.time = {\"hours\": data.getHours(), \"minutes\": data.getMinutes()};\r\n                    if (!self.is24h) {\r\n                        self.timeS = data.getHours() < 12 ? \"am\" : \"pm\";\r\n                    }\r\n                }\r\n\r\n                self.onChangeHandler();\r\n            },\r\n            onBeforeShow: function (event, inst) {\r\n                // Your custom event handler goes here\r\n                self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n\r\n                self.changeMinValue(self.properties.minValue);\r\n                self.changeMaxValue(self.properties.maxValue);\r\n\r\n                //TODO temporal fix in ios smartphone when a notification container is already displayed (QAF-6385 / MOB-171), review mobiscroll.min versions\r\n                if (bizagi.util.isiOSDevice()) {\r\n                    $(\".ui-bizagi-notifications-container\").css(\"display\", \"none\");\r\n                }\r\n            },\r\n            onClose: function (event, inst) {\r\n                // Your custom event handler goes here\r\n                self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                $(\".mbsc-fr-scroll\").css(\"overflow-y\", \"auto\");\r\n            },\r\n            onShow: function (event, inst) {\r\n                $(\".mbsc-fr-scroll\").css(\"overflow-y\", \"hidden\");\r\n            }\r\n        });\r\n\r\n        // Bind event for change value\r\n        this.input.on(\"focus\", function (e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (bizagi.util.isCordovaSupported() && bizagi.util.isAndroidDevice()) {\r\n                cordova.plugins.Keyboard.disableScroll(true);\r\n                cordova.plugins.Keyboard.close();\r\n            }\r\n        });\r\n\r\n        //Set input displayValue if it has default value\r\n        if (self.properties.displayValue === \"\" && self.properties.value) {\r\n            var date = self.getFormattedDate(self.properties.value, self.properties.showTime, true, false);\r\n            if (typeof (date) !== \"undefined\") {\r\n                var displayValue = bizagi.util.dateFormatter.formatDate(date, self.properties.fullFormat);\r\n                this.input.prop(\"value\", displayValue);\r\n            }\r\n        }\r\n\r\n        this.input.attr(\"keyboard\", \"disable\");\r\n    },\r\n\r\n    /**\r\n     * Configure the timeformat\r\n     */\r\n    getTimeFormat: function () {\r\n        if (this.properties.timeFormat.indexOf(\"H\") !== -1 || this.properties.timeFormat.indexOf(\"HH\") !== -1) {\r\n            this.is24h = true;\r\n            return \"HH:ii\";\r\n        } else {\r\n            this.is24h = false;\r\n            return \"hh:ii A\";\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get Date whit the Invariant and ISO Format applied.\r\n     */\r\n    getFormattedDate: function (date, showTime, initializer) {\r\n        var self = this;\r\n        \r\n        if (!date || bizagi.util.isObjectEmpty(date)) return;\r\n        date = (typeof date != \"string\") ? date.toString() : date;\r\n\r\n        //There are some dates that haven't time,... actions and validations for example or when we have to put a initial value (default value without time),\r\n        //in that cases we should identify the case and if the date haven't the time value, we have to add (00:00:00) it to can apply the format (getDateFromInvariant).\r\n        var time = (showTime && (self.getTime() === \"0:0\" || initializer)) ? \" \" + date.substr(date.length - 8, date.length) : \"\";\r\n\r\n        var currentDate = (initializer && showTime && time.split(\"/\").length > 1) || (date.split(\":\").length === 1) ? date += \" 00:00:00\" : date;\r\n        date = bizagi.util.dateFormatter.getDateFromInvariant(currentDate, showTime);\r\n\r\n        var currentTime = showTime ? time !== \"\" ? time : \" \" + self.getTime() : \" 00:00\";\r\n        var fullDateFormated = self.setHour(self.getFullFormatedDate(date, currentTime));\r\n\r\n        fullDateFormated = bizagi.util.dateFormatter.getDateFromISO(fullDateFormated, true);\r\n\r\n        return fullDateFormated;\r\n    },\r\n\r\n    /**\r\n     * Changes the render min value\r\n     * @param {} value\r\n     */\r\n    changeMinValue: function (value) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var dateControl = self.getDateControl();\r\n\r\n        // Set value in control\r\n        if (value && self.properties.editable) {\r\n            if (typeof (value) === \"number\") {\r\n                value = new Date(value);\r\n                dateControl.mobiscroll('option', {min: value});\r\n                value = bizagi.util.dateFormatter.formatInvariant(value, properties.showTime); // Set as invariant\r\n            } else {\r\n                dateControl.mobiscroll('option', {min: bizagi.util.dateFormatter.getDateFromInvariant(value, true)});\r\n            }\r\n\r\n            properties.minValue = value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Changes the render max value\r\n     * @param {} value\r\n     */\r\n    changeMaxValue: function (value) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var dateControl = self.getDateControl();\r\n\r\n        // Set value in control\r\n        if (value && self.properties.editable) {\r\n            if (typeof (value) === \"number\") {\r\n                value = new Date(value);\r\n                dateControl.mobiscroll('option', {max: value});\r\n                value = bizagi.util.dateFormatter.formatInvariant(value, properties.showTime); // Set as invariant\r\n            } else {\r\n                dateControl.mobiscroll('option', {max: bizagi.util.dateFormatter.getDateFromInvariant(value, true)});\r\n            }\r\n\r\n            properties.maxValue = value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Set the display value on input\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var date = self.getFormattedDate(value, self.properties.showTime, false);\r\n        var displayValue = self.preprocessDateValue(date);\r\n\r\n        self.input = self.input ? self.input : self.getDateControl();\r\n\r\n        if (self.properties.editable === false) {\r\n            // Render as simple value\r\n            if (typeof (displayValue) === \"string\" || typeof (displayValue) === \"number\") {\r\n                self.input.html(displayValue);\r\n            }\r\n        } else {\r\n            self.input.prop(\"value\", displayValue);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get the DOM Control\r\n     */\r\n    getDateControl: function () {\r\n        return $(\".bz-input-icon\", this.getControl());\r\n    },\r\n\r\n    /**\r\n     * Get Time from mobiscroll\r\n     */\r\n    getTime: function () {\r\n        var self = this;\r\n\r\n        //Converting the time in 24h format.\r\n        if (self.properties.showTime && (self.time && self.time[\"minutes\"] !== \"\")) {\r\n            var time = self.time[\"hours\"] + \":\" + self.time[\"minutes\"];\r\n            time += self.timeS;\r\n\r\n            if (time.indexOf(\"am\") != -1 && self.time[\"hours\"] == 12) {\r\n                time = time.replace(\"12\", \"0\");\r\n            }\r\n\r\n            if (time.indexOf(\"pm\") != -1 && self.time[\"hours\"] < 12) {\r\n                time = time.replace(self.time[\"hours\"], (parseInt(self.time[\"hours\"]) + 12));\r\n            }\r\n\r\n            return time.replace(/(am|pm)/, '');\r\n        } else {\r\n            return \"\";\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get Date from mobiscroll\r\n     * */\r\n    getDate: function () {\r\n        if (this.date && this.date[\"month\"] !== \"\") {\r\n            return this.date[\"year\"] + \"-\" + (parseInt(this.date[\"month\"]) + 1) + \"-\" + this.date[\"day\"];\r\n        } else {\r\n            return \"\";\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Set the control value when the control change\r\n     */\r\n    onChangeHandler: function (isClearButton) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var currentDate = self.getDate();\r\n        var currentTime = (properties.showTime) ? \" \" + self.getTime() : \" 0:00\";\r\n\r\n        // If curren date is empty reset actual value\r\n        if ((currentDate === \"\" && !properties.showTime) || (currentDate === \"\" && currentTime === \"\") || (isClearButton)) {\r\n            self.setValue(\"\");\r\n            self.input.prop('value', \"\");\r\n            properties.displayValue = \"\";\r\n        } else {\r\n            var formatedFullDate = self.setHour(self.getFullFormatedDate(currentDate, currentTime));\r\n\r\n            formatedFullDate = bizagi.util.dateFormatter.getDateFromISO(formatedFullDate, true);\r\n\r\n            if (!formatedFullDate || formatedFullDate == 0) return;\r\n\r\n            // Set date value\r\n            self.setNewDateValue(formatedFullDate, properties.showTime);\r\n\r\n            var displayValue = self.preprocessDateValue(formatedFullDate);\r\n            properties.displayValue = displayValue;\r\n\r\n            self.input.prop(\"value\", self.properties.displayValue);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Apply the final format that will be showed on the input\r\n     */\r\n    getFullFormatedDate: function (currentDate, currentTime) {\r\n        var fullDate = \"\";\r\n\r\n        if (currentDate.length > 0) {\r\n            fullDate = currentDate;\r\n        } else if (currentDate !== undefined) {\r\n            fullDate = bizagi.util.dateFormatter.formatISO(currentDate, false);\r\n        } else {\r\n            fullDate = bizagi.util.dateFormatter.formatISO(new Date(), false);\r\n        }\r\n\r\n        fullDate += currentTime;\r\n        var dateFromFormat = bizagi.util.dateFormatter.getDateFromFormat(fullDate, \"yyyy-MM-dd H:m\");\r\n\r\n        return bizagi.util.dateFormatter.formatDate(dateFromFormat !== 0 ? dateFromFormat : currentDate, \"yyyy-MM-dd H:mm:ss\");\r\n    },\r\n\r\n    /**\r\n     * Set the control value\r\n     */\r\n    setNewDateValue: function (formatedFullDate, showTime) {\r\n        var value = \"\";\r\n\r\n        if (formatedFullDate != \"\")\r\n            value = bizagi.util.dateFormatter.formatInvariant(formatedFullDate, showTime);\r\n\r\n        this.setValue(value);\r\n    },\r\n\r\n    /**\r\n     * Removing the time when be necesary\r\n     */\r\n    applyDateFormat: function (date, showTime) {\r\n        if (!showTime) {\r\n            var initIndexTime = null;\r\n\r\n            if (date.indexOf(\"00:00\") != -1) {\r\n                initIndexTime = date.indexOf(\"00:00\");\r\n            } else if (date.indexOf(\"0:00\") != -1) {\r\n                initIndexTime = date.indexOf(\"0:00\");\r\n            } else if (date.indexOf(\"12:00\") != -1) {\r\n                initIndexTime = date.indexOf(\"12:00\");\r\n            } else {\r\n                initIndexTime = \"-1\";\r\n            }\r\n\r\n            var endIndexTime = initIndexTime + 8;\r\n            date = initIndexTime === -1 ? date : date.replace(date.substring(initIndexTime, endIndexTime), \"\").replace(\" am\", \"\").replace(\" pm\", \"\");\r\n        }\r\n\r\n        return date;\r\n    },\r\n\r\n    /*\r\n     *  Checks if the date could be localized using site language\r\n     */\r\n    preprocessDateValue: function (date) {\r\n        return bizagi.util.dateFormatter.formatDate(date, this.properties.fullFormat);\r\n    },\r\n\r\n    /**\r\n     * Public method to determine if a value is valid or not\r\n     */\r\n    isValid: function (invalidElements) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var bValid = true;\r\n        var value = self.getValue();\r\n\r\n        if (value) {\r\n            if (bizagi.util.parseBoolean(properties.editable)) {\r\n                value = bizagi.util.dateFormatter.getDateFromInvariant(value);\r\n\r\n                if (value != 0) {\r\n                    // Clear time for validations\r\n                    value.setHours(0, 0, 0, 0);\r\n\r\n                    // Check min value and max value\r\n                    if (properties.minValue && typeof (properties.minValue) === 'string') {\r\n                        bValid = self.validateMinAndMaxValue(value, true, properties, invalidElements) ? false : bValid;\r\n                    }\r\n\r\n                    if (properties.maxValue && typeof (properties.maxValue) === 'string') {\r\n                        bValid = self.validateMinAndMaxValue(value, false, properties, invalidElements) ? false : bValid;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (bizagi.util.parseBoolean(properties.editable)) {\r\n            // Check required\r\n            if (properties.required && !self.hasValue()) {\r\n                self.showMandatoryMessage(properties, invalidElements);\r\n            }\r\n        }\r\n\r\n        if (bValid) {\r\n            // Clear error message\r\n            self.setValidationMessage(\"\");\r\n        }\r\n\r\n        return bValid;\r\n    },\r\n\r\n    /**\r\n     * To validate the min and max values\r\n     * @param {} value\r\n     * @param {} isMinValue\r\n     * @param {} properties\r\n     * @param {} invalidElements\r\n     */\r\n    validateMinAndMaxValue: function (value, isMinValue, properties, invalidElements) {\r\n        var vValue = bizagi.util.dateFormatter.getDateFromInvariant(isMinValue ? properties.minValue : properties.maxValue);\r\n\r\n        //In case the value from the minValue or maxValue are assigned from a Date control that does not have the option  \"showTime!\r\n        if (vValue == 0) {\r\n            var resultValue = \"\";\r\n            if (properties.timeFormat.indexOf(\":ss\") == -1) {\r\n                if (isMinValue) {\r\n                    resultValue = properties.minValue + \":00\";\r\n                } else {\r\n                    resultValue = properties.maxValue + \":00\";\r\n                }\r\n            }\r\n\r\n            vValue = bizagi.util.dateFormatter.getDateFromFormat(resultValue, properties.fullFormat + \":ss\");\r\n        }\r\n\r\n        vValue.setHours(0, 0, 0, 0);\r\n\r\n        if ((isMinValue && value < vValue) || (!isMinValue && value > vValue)) {\r\n            var formatedDate = bizagi.util.dateFormatter.formatDate(vValue, properties.fullFormat);\r\n            var message = \"\";\r\n\r\n            if (isMinValue) {\r\n                message = this.getResource(\"render-date-minimum-validation\").replaceAll(\"#label#\", properties.displayName).replaceAll(\"#minValue#\", formatedDate);\r\n            } else {\r\n                message = this.getResource(\"rendr-date-maximum-validation\").replaceAll(\"#label#\", propertiee).replaceAll(\"#maxValue#\", formatedDate);\r\n            }\r\n\r\n            invalidElements.push({xpath: properties.xpath, message: message});\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    },\r\n\r\n    /**\r\n     * To show the mandatory values message\r\n     * */\r\n    showMandatoryMessage: function (properties, invalidElements) {\r\n        var self = this;\r\n        var message = self.getResource(\"render-required-text\").replaceAll(\"#label#\", properties.displayName);\r\n\r\n        invalidElements.push({xpath: properties.xpath, message: message});\r\n\r\n        return false;\r\n    },\r\n\r\n    setHour: function (date) {\r\n        return date.replace(\" 0:\", \" 00:\").replace(\" 1:\", \" 01:\").replace(\" 2:\", \" 02:\").replace(\" 3:\", \" 03:\").replace(\" 4:\", \" 04:\").replace(\" 5:\", \" 05:\").replace(\" 6:\", \" 06:\").replace(\" 7:\", \" 07:\").replace(\" 8:\", \" 08:\").replace(\" 9:\", \" 09:\");\r\n    },\r\n\r\n    /**\r\n     * Cleans the control fields as it requires\r\n     */\r\n    clearDisplayValue: function () {\r\n        var self = this;\r\n\r\n        self.date = undefined;\r\n        self.time = undefined;\r\n        self.timeS = undefined;\r\n        self.onChangeHandler(true);\r\n        self.setDisplayValue('');\r\n    },\r\n    isValidMinMaxValue: function () {\r\n        var self = this;\r\n        var isValid = true;\r\n        var value = self.getValue();\r\n\r\n        if (value) {\r\n            value = bizagi.util.dateFormatter.getDateFromInvariant(value);\r\n\r\n            if (value !== 0) {\r\n                // Clear time for validations\r\n                value.setHours(0, 0, 0, 0);\r\n\r\n                // Check min value and max value\r\n                if (self.properties.minValue && typeof (self.properties.minValue) === 'string')\r\n                    isValid = self.validateMinAndMaxValue(value, true);\r\n\r\n                if (self.properties.maxValue && typeof (self.properties.maxValue) === 'string')\r\n                    isValid = self.validateMinAndMaxValue(value, false);\r\n            }\r\n        }\r\n\r\n        return isValid;\r\n    },\r\n\r\n    validateMinAndMaxValue: function (currentDate, isMinValue) {\r\n        var self = this;\r\n        var date = isMinValue ? self.properties.minValue : self.properties.maxValue;\r\n        var formattedDate = bizagi.util.dateFormatter.getDateFromInvariant(date);\r\n\r\n        formattedDate.setHours(0, 0, 0, 0);\r\n\r\n        return !((isMinValue && currentDate < formattedDate) || (!isMinValue && currentDate > formattedDate));\r\n\r\n    },\r\n\r\n    getElementsToStylize: function ($context) {        \r\n        return $(\"input\", $context); \r\n    }\r\n});","/**\r\n * Tablet definition of Action Launcher\r\n *\r\n * @author: Ricardo Pérez\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.actionLauncher\", bizagi.rendering.actionLauncher.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.actionLauncher.extend(\"bizagi.rendering.smartphone.actionLauncher\", {}, {\r\n    \r\n    /**\r\n     * Render a specific implementation for Desktop device\r\n     */\r\n    postRender: function () {\r\n        if (this.getMode() == \"design\"){\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var control = self.getControl();\r\n        self.actions = [];\r\n        self.startLoading();\r\n\r\n        // Define params to get list of actions        \r\n        $.when(self.dataService.multiaction().getActions(self.processPropertyValueArgs))\r\n            .then(function (response) {\r\n                response = self.getPropertiesActionLaucher(response);\r\n                self.actions = response;\r\n                self.deferredActions.resolve(response);\r\n\r\n                if (self.actions.length > 0) {\r\n                    $(\"[data-element='actions-add-btn']\", control).show();\r\n                }\r\n                else{\r\n                    $(\"[data-element='actions-add-btn']\", control).hide();\r\n                }\r\n\r\n                if (properties.isHorizontal) {\r\n                    if (properties.templatetype != \"none\") {\r\n                        return self.dataService.multiaction().getPropertyData(self.processPropertyValueDataTmplArgs)\r\n                            .then(function (templateData) {\r\n                                return self.engine.render($.extend(templateData, {\r\n                                    isDefaultTemplate: properties.templatetype === \"default\",\r\n                                    sessionId: self.properties.sessionId\r\n                                }), self.processPropertyValueDataTmplArgs);\r\n                            }).then(function (tmpl) {\r\n                                template = self.renderFactory.getTemplate(\"render-actionLauncher-horizontal\");\r\n                                var html = $($.fasttmpl(template, {\r\n                                    template: true\r\n                                }));\r\n\r\n                                $(\".bz-template\", html.wrap(\"<div>\").parent()).append(tmpl);\r\n                                return html;\r\n                            });\r\n                    }\r\n                }\r\n                else{\r\n                    template = self.renderFactory.getTemplate(\"render-actionLauncher-horizontal\");\r\n                    return $.fasttmpl(template, {\r\n                        template: false\r\n                    });\r\n                }\r\n            }).done(function (html) {\r\n                $(\"[data-element='template-container']\", control).append(html);\r\n                self.configureActionsHandlers();\r\n                self.configureTemplateHandlers();\r\n            }).always(function () {\r\n                self.endLoading();\r\n            });\r\n    },\r\n\r\n\r\n    /**\r\n     * Validates if the action launcher control contains a valid value\r\n     * @returns {boolean}\r\n     */\r\n    hasValue: function () {\r\n        var value = this.getValue();\r\n        return typeof value !== \"undefined\" && value !== null && value.length > 0;\r\n    },\r\n\r\n    /**\r\n     * Add binding to html elements\r\n     */\r\n    configureActionsHandlers: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var actionLauncherControls = $(\".action-launcher-control\", control);\r\n\r\n        //Binding for click action on buttons\r\n        actionLauncherControls.on(\"click\", function () {\r\n            var item = self.actions[parseInt($(this).data(\"index\"))];\r\n            var action = {\r\n                guidProcess: item[0],\r\n                guidAction: item[4],\r\n                displayName: item[1],\r\n                actionType: item[3],\r\n                xpathContext: typeof item[5] !== \"undefined\" && item[5] === \"true\",\r\n                readOnlyForm: item[6] || false,\r\n                guidEntity: self.properties.guidEntity,\r\n                xpathActions: self.properties.xpathActions || \"\"\r\n            };\r\n\r\n            self.processAction(action);\r\n        });\r\n\r\n        var actions = [];\r\n        for (var i = 0, length = self.actions.length; i < length; i++) {\r\n            actions.push({\r\n                guid: self.actions[i][0],\r\n                displayName: self.actions[i][1]\r\n            });\r\n        }\r\n\r\n\r\n        //Binding for click action sheet\r\n        $(\"[data-element='actions-add-btn']\", control).actionSheet({\r\n            actions: actions,\r\n            actionClicked: function (action) {\r\n                var item = self.actions.find(function (element) {\r\n                    return element[0] == action.guid;\r\n                });\r\n\r\n                self.processAction({\r\n                    guidProcess: item[0],\r\n                    guidAction: item[4],\r\n                    displayName: item[1],\r\n                    actionType: item[3],\r\n                    xpathContext: typeof item[5] !== \"undefined\" && item[5] === \"true\",\r\n                    readOnlyForm: item[6] || false,\r\n                    xpathActions: self.properties.xpathActions || \"\"\r\n                });\r\n            }\r\n        });\r\n\r\n        //Catch the typed text in the search field and filter the action list\r\n        $.expr[\":\"].FilterAction = function (entity, i, array) {\r\n            var search = array[3];\r\n            if (!search) {\r\n                return false;\r\n            }\r\n            return new RegExp(search, \"i\").test($(entity).text());\r\n        };\r\n        $(\"input#ui-bizagi-render-action-launcher-filter-input\", control).keyup(function () {\r\n            var search = $(this).val();\r\n            $(\".action-launcher-control\", control).show();\r\n            if (search) {\r\n                $(\".action-launcher-control\", control)\r\n                    .not(\":FilterAction(\" + search + \")\").hide();\r\n            }\r\n        });\r\n    },\r\n    /**\r\n     *\r\n     */\r\n    configureTemplateHandlers: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        //Catch the event from the layout link\r\n        self.engine.subscribe(\"onLoadDataNavigation\", function (ev, params) {\r\n            params.filters = [];\r\n            self.triggerGlobalHandler(\"dataNavigation\", params);\r\n        });\r\n\r\n        $(\".bz-template-more-or-less\", control).bind(\"click\", function(){\r\n            $(\".bz-template\", control).toggleClass(\"bz-template--collapsed\");\r\n        });\r\n    },\r\n    /**\r\n     *\r\n     * @param action\r\n     */\r\n    processAction: function (action) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var properties = self.properties;\r\n        var multipleSelection = (typeof properties.multipleSelection == \"undefined\") ? true : properties.multipleSelection;\r\n\r\n        if (multipleSelection) {\r\n            // If this is a form and has been queued, so open it\r\n            if (action.actionType == \"Form\" && self.countSameActions(action) >= 1 && !action.xpathContext) {\r\n                //Open action\r\n                $(\".action-to-execute-control[data-guidaction='\" + action.guidAction + \"'] label\", control).click();\r\n            } else {\r\n                $.when(self.actionManager(action)).done(function (act) {\r\n                    self.executeAction(act);\r\n                });\r\n            }\r\n        } else if (self.getValue().length > 0) {\r\n            self.showConfirmationDialog(action);\r\n        } else {\r\n            $.when(self.actionManager(action)).done(function (act) {\r\n                self.executeAction(act);\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @param action\r\n     */\r\n    notifyExecution: function (data, action) {\r\n        var self = this;\r\n\r\n        if (data.response == \"success\") {\r\n            $.notifier.add({\r\n                class_name: \"success\",\r\n                title: action.displayName,\r\n                text: self.getResource(\"render-action-launcher-success-excecution\").replace('%s', action.displayName),\r\n                sticky: false\r\n            });\r\n        } else {\r\n            $.notifier.add({\r\n                class_name: \"error\",\r\n                title: action.displayName,\r\n                text: self.getResource(\"render-action-launcher-failed-excecution\").replace('%s', action.displayName),\r\n                sticky: false\r\n            });\r\n        }\r\n    },\r\n    /**\r\n     *\r\n     * @param action\r\n     * @returns {*}\r\n     */\r\n    processActionForm: function (action) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var formParams = self.getParams();\r\n\r\n        var additionalXpaths = self.properties.additionalXpath.join(\",\");\r\n        var xpathContext = (action.xpathContext) ? self.properties.xpathActions + \".\" + action.xpathContext : self.properties.xpathActions;\r\n        var def = new $.Deferred();\r\n\r\n        // Show dialog with new form after that\r\n        var slideForm = new bizagi.rendering.smartphone.slide.form(self.dataService, self.renderFactory, {\r\n            title: properties.detailLabel || bizagi.localization.getResource(\"render-grid-details-form\"),\r\n            navigation: formParams.navigation,\r\n            showSaveButton: true,\r\n            cancelButtonLabel: bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n            onSave: function (data) {\r\n                // Submit the form\r\n                return self.dataService.multiaction().submitData({\r\n                    action: \"SAVE\",\r\n                    data: data,\r\n                    xpathContext: slideForm.form.properties.xpathContext,\r\n                    idPageCache: data.idPageCache,\r\n                    isOfflineForm: false,\r\n                    isActionStartForm: true\r\n                }).done(function (savedData) {\r\n                    if (!action.editMode && self.countSameActions(action) === 0) {\r\n                        action.idStartScope = savedData.IdScope;\r\n                    }\r\n                    def.resolve(savedData.IdScope);\r\n                });\r\n            },\r\n            onCancel: function (data) {\r\n\r\n            }\r\n        });\r\n\r\n        var renderParams = {\r\n            \"idForm\": action.guidProcess,\r\n            \"contextType\": \"start\",\r\n            \"idCase\": self.properties.caseId,\r\n            \"idWorkitem\": self.typeForm != \"SummaryForm\" ? formParams.idWorkitem : undefined,\r\n            \"additionalXpaths\": additionalXpaths,\r\n            \"xpathContext\": xpathContext,\r\n            \"idStartScope\": action.idStartScope,\r\n            \"surrogateKey\": self.properties.surrogatedKey,\r\n            \"readOnlyForm\": action.readOnlyForm,\r\n            \"recordXpath\": action.recordXpath\r\n        };\r\n\r\n        if (action.actionType === \"Form\") {\r\n            renderParams.contextType = \"entitytemplate\";\r\n            renderParams.xpathContext = undefined;\r\n            renderParams.guidEntity = action.guidEntity;\r\n            renderParams.rewriteContextType = true;\r\n        }\r\n\r\n        slideForm.render(renderParams);\r\n\r\n        return def.promise();\r\n    },\r\n    /**\r\n     *\r\n     * @param action\r\n     * @returns {*}\r\n     */\r\n    processActionFormCollection: function (action) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var form = self.getFormContainer();\r\n        var additionalXpaths = self.properties.additionalXpath.join(\",\");\r\n        var def = new $.Deferred();\r\n        var xpathContext = (action.xpathContext) ? self.properties.xpathActions + \".\" + action.xpathContext : self.properties.xpathActions;\r\n        var xpathPattern = \"%s[id=%s]\";\r\n        var xpathPatternWithoutkey = \"%s[]\";\r\n        var xpathContextWithKey = (xpathContext !== \"\") ? printf(xpathPattern, xpathContext, action.idEntity) : xpathContext;\r\n        var xpathContextWithoutKey = (xpathContext !== \"\") ? printf(xpathPatternWithoutkey, xpathContext) : xpathContext;\r\n        var formParams = form.getParams();\r\n\r\n        var slideForm = new bizagi.rendering.smartphone.slide.form(self.dataService, self.renderFactory, {\r\n            title: properties.detailLabel || bizagi.localization.getResource(\"render-grid-details-form\"),\r\n            navigation: formParams.navigation,\r\n            showSaveButton: true,\r\n            cancelButtonLabel: bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n            onSave: function (data) {\r\n                if (action.editMode) {\r\n                    return self.dataService.multiaction().submitData({\r\n                        action: \"SAVE\",\r\n                        data: data,\r\n                        xpathContext: xpathContextWithKey,\r\n                        idPageCache: data.idPageCache,\r\n                        isOfflineForm: false,\r\n                        isActionStartForm: true\r\n                    }).done(function (savedData) {\r\n                        def.resolve(savedData.IdScope);\r\n                    });\r\n                } else {\r\n                    return self.dataService.addGridRecordData({\r\n                        idRender: properties.id,\r\n                        //xpath: properties.xpath,\r\n                        xpathContext: xpathContext,\r\n                        contexttype: \"start\",\r\n                        idPageCache: data.idPageCache,\r\n                        submitData: data\r\n                    }).done(function (savedData) {\r\n                        action.idStartScope = savedData.IdScope;\r\n                        action.idEntity = savedData.IdEntity;\r\n                        self.addActionToQueue(action);\r\n                        def.resolve(savedData.IdScope);\r\n                    });\r\n                }\r\n            },\r\n            onCancel: function (data) {\r\n\r\n            }\r\n        });\r\n\r\n        slideForm.render({\r\n            \"idForm\": action.guidProcess,\r\n            \"contextType\": \"start\",\r\n            \"idCase\": formParams.idCase,\r\n            \"additionalXpaths\": additionalXpaths,\r\n            \"xpathContext\": (action.editMode) ? xpathContextWithKey : xpathContextWithoutKey,\r\n            \"idStartScope\": action.idStartScope,\r\n            \"surrogateKey\": self.properties.surrogatedKey,\r\n            \"readOnlyForm\": action.readOnlyForm,\r\n            \"recordXpath\": action.recordXpath\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /**\r\n     * Process a start form\r\n     * @param args\r\n     * @return {*}\r\n     */\r\n    processStartForm: function (args) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        args = args || {};\r\n        var formParams = self.getFormContainer().getParams();\r\n\r\n        // Show dialog\r\n        var slideForm = new bizagi.rendering.smartphone.startForm(self.dataService, self.renderFactory, {\r\n            title: args.title || \"\",\r\n            navigation: formParams.navigation,\r\n            saveButtonLabel: (self.typeForm == \"GlobalForm\" || self.typeForm == \"SummaryForm\")\r\n                ? bizagi.localization.getResource(\"render-form-button-create\")\r\n                : bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n            onSave: function (data) {\r\n                // Submit the form\r\n                return self.dataService.multiaction().submitData({\r\n                    action: \"SAVE\",\r\n                    data: data,\r\n                    xpathContext: self.properties.xpathContext,\r\n                    idPageCache: data.idPageCache,\r\n                    isOfflineForm: false,\r\n                    isActionStartForm: true\r\n                }).done(function (savedData) {\r\n                    def.resolve(savedData.IdScope);\r\n                });\r\n            }\r\n        });\r\n        // Render the search form\r\n        slideForm.render({\r\n            guidprocess: args.guidprocess,\r\n            idStartScope: args.idStartScope,\r\n            idCase: self.properties.caseId,\r\n            idWorkitem: self.typeForm != \"SummaryForm\" ? formParams.idWorkitem : undefined,\r\n            additionalXpaths: self.properties.additionalXpath.join(\",\"),\r\n            surrogatedKey: self.properties.surrogatedKey,\r\n            recordXpath: args.recordXpath,\r\n            mappingstakeholders: true\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /**\r\n     *\r\n     * @param action\r\n     */\r\n    executeAction: function (action) {\r\n        var self = this;\r\n\r\n        if (self.typeForm == \"GlobalForm\" || self.typeForm == \"SummaryForm\") {\r\n            var message = bizagi.localization.getResource(\"render-action-launcher-immediatly-action-confirmation\");\r\n\r\n            $.when(bizagi.showConfirmationBox(message, \"Bizagi\", \"info\"))\r\n                .done(function () {\r\n                    self.executeActionImmediately(action);\r\n                });\r\n        } else {\r\n            self.addActionToQueue(action);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show the confirmation dialog\r\n     * bizagi.createOkCancelPopup\r\n     * @param action\r\n     * */\r\n    showConfirmationDialog: function (action) {\r\n        var self = this;\r\n        var message = bizagi.localization.getResource(\"render-action-launcher-single-action-confirmation\");\r\n\r\n        $.when(bizagi.showConfirmationBox(message, \"Bizagi\", \"info\"))\r\n            .done(function () {\r\n                self.setValue([]);\r\n\r\n                $.when(self.actionManager(action)).done(function (act) {\r\n                    self.executeAction(act);\r\n                });\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Render actual value of control and set events\r\n     * @param data\r\n     */\r\n    setDisplayValue: function (data) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var actionsToExecuteContainer = $(\"[data-element='actions-container']\", control);\r\n        var template = self.renderFactory.getTemplate(\"render-actionLauncher-actions-to-execute\");\r\n\r\n        self.configureQueueVisibility();\r\n\r\n        $.when(self.deferredActions).done(function (listOfActions) {\r\n            var getMappingAction = function (guidAction) {\r\n                var mapping = [];\r\n                $.each(listOfActions, function (key, value) {\r\n                    if (value[4] == guidAction) {\r\n                        mapping = value;\r\n                    }\r\n                });\r\n\r\n                return mapping;\r\n\r\n            };\r\n\r\n            $.each(data, function (key, value) {\r\n                var mapping = getMappingAction(value.guidAction);\r\n                data[key].displayName = mapping[1];\r\n                data[key].guidProcess = mapping[0];\r\n                data[key].actionType = mapping[3];\r\n                data[key].xpathContext = mapping[5];\r\n                data[key].readOnlyForm = mapping[6];\r\n\r\n                if (data[key].params && data[key].params.idStartScope) {\r\n                    data[key].idStartScope = data[key].params.idStartScope;\r\n                }\r\n                if (data[key].params && data[key].params.idPageCache) {\r\n                    data[key].idPageCache = data[key].params.idPageCache;\r\n                }\r\n                if (data[key].params && data[key].params.idEntity) {\r\n                    data[key].idEntity = data[key].params.idEntity;\r\n                }\r\n            });\r\n\r\n            if (data.length > 0){\r\n                $.when($.fasttmpl(template, { actions: data })).done(function (html) {\r\n                    actionsToExecuteContainer.empty();\r\n                    actionsToExecuteContainer.append(html);\r\n\r\n                    var removeActionSelector = $(\".bz-actions-to-execute .bz-btn-icn\", actionsToExecuteContainer);\r\n                    var openActionSelector = $(\"label\", actionsToExecuteContainer);\r\n\r\n                    removeActionSelector.on(\"click\", function () {\r\n                        var index = $(this).parent().data(\"index\");\r\n                        self.removeActionToQueue(index);\r\n                    });\r\n\r\n                    openActionSelector.on(\"click\", function () {\r\n                        var target = $(this).parent();\r\n                        var type = target.data(\"actiontype\");\r\n                        var guidprocess = target.data(\"guidprocess\");\r\n                        var idStartScope = target.data(\"idstartscope\");\r\n                        var title = target.data(\"title\");\r\n                        // When undefined return string \"undefined\" instead of type \"undefined\"\r\n                        var xpathContext = target.data(\"xpathcontext\");\r\n                        var readOnlyForm = target.data(\"readonlyform\") || false;\r\n                        var idEntity = target.data(\"identity\") || \"\";\r\n                        var guidAction = target.data(\"guidaction\");\r\n                        var recordXpath = xpathContext || self.properties.xpathContext;\r\n                        switch (type) {\r\n                            case \"Process\":\r\n                                if (idStartScope) {\r\n                                    self.processStartForm({\r\n                                        guidprocess: guidprocess,\r\n                                        idStartScope: idStartScope,\r\n                                        title: title,\r\n                                        xpathContext: xpathContext,\r\n                                        recordXpath: recordXpath\r\n                                    });\r\n                                }\r\n                                break;\r\n                            case \"Form\":\r\n                                var action = {\r\n                                    guidProcess: guidprocess,\r\n                                    idStartScope: idStartScope,\r\n                                    editMode: true,\r\n                                    xpathContext: xpathContext,\r\n                                    readOnlyForm: readOnlyForm,\r\n                                    idEntity: idEntity,\r\n                                    recordXpath: recordXpath\r\n                                };\r\n\r\n                                if (action.xpathContext) {\r\n                                    self.processActionFormCollection(action);\r\n                                } else {\r\n                                    // Convert string \"undefined\" into type \"undefined\"\r\n                                    action.xpathContext = undefined;\r\n\r\n                                    // Add parameters if action form\r\n                                    var extraParams = {};\r\n                                    var dataAction = self.value.filter(function (item) {\r\n                                        return item.guidAction == guidAction;\r\n                                    });\r\n\r\n                                    if (dataAction.length > 0) {\r\n                                        extraParams = {\r\n                                            actionType: \"Form\",\r\n                                            contextType: \"entitytemplate\",\r\n                                            guidEntity: self.properties.guidEntity || dataAction[0].guidEntity\r\n                                        }\r\n                                    }\r\n\r\n                                    self.processActionForm($.extend(action, extraParams));\r\n                                }\r\n                                break;\r\n                            case \"Rule\":\r\n                                // Rules dont have forms or something like that\r\n                                break;\r\n                        }\r\n                    });\r\n                });\r\n            }else{\r\n                actionsToExecuteContainer.empty();\r\n            }\r\n\r\n        });\r\n    },\r\n    /**\r\n     * Show container if it has actions\r\n     */\r\n    configureQueueVisibility: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var actionsToExecuteContainer = $(\".bz-action-launcher-actions-to-execute-container\", control);\r\n        var actionsToExecuteTitle = $(\".action-to-execute-label\", control);\r\n\r\n        if (self.getValue().length > 0) {\r\n            actionsToExecuteContainer.show();\r\n            actionsToExecuteTitle.show();\r\n        } else {\r\n            actionsToExecuteContainer.hide();\r\n            actionsToExecuteTitle.hide();\r\n        }\r\n    }\r\n});","/**\r\n * Tablet definition of entity template\r\n *\r\n * @author: Ricardo Pérez\r\n */\r\n\r\nbizagi.rendering.smartphone.actionLauncher.extend(\"bizagi.rendering.smartphone.entityTemplate\", {}, {\r\n\r\n    /**\r\n     * Render a specific implementation for smartphone device\r\n     */\r\n    postRender: function() {\r\n        if (this.getMode() == \"design\"){\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var control = self.getControl();\r\n        self.actions = [];\r\n        self.configureQueueVisibility();\r\n        self.startLoading();\r\n\r\n        // Define params to get template               \r\n        self.dataService.multiaction().getPropertyData(self.processPropertyValueDataTmplArgs)\r\n            .then(function(templateData) {\r\n                return self.engine.render(templateData, self.processPropertyValueDataTmplArgs)\r\n                    .then(function(tmpl) {\r\n                        var template = self.renderFactory.getTemplate(\"render-actionLauncher-horizontal\")\r\n                        var html = $($.fasttmpl(template, { template: true }));\r\n                        $(\".bz-template\", html.wrap(\"<div>\").parent()).append(tmpl);\r\n\r\n                        if (properties.allowactions) {\r\n                           return self.dataService.multiaction().getActions(self.processPropertyValueArgs)\r\n                                .then(function(response) {\r\n                                    self.deferredActions.resolve(response);\r\n                                    self.actions = response;\r\n\r\n                                    if (self.actions.length > 0) {\r\n                                        $(\"[data-element='actions-add-btn']\", control).show();\r\n                                    }\r\n                                    else{\r\n                                        $(\"[data-element='actions-add-btn']\", control).hide();\r\n                                    }\r\n                                    return html;\r\n                                });\r\n                        }\r\n                        else{\r\n                            return html;    \r\n                        }\r\n                    });\r\n                    \r\n            }).done(function(html) {\r\n                $(\"[data-element='template-container']\", control).append(html);\r\n                self.configureActionsHandlers();\r\n                self.configureTemplateHandlers();\r\n            }).always(function() {\r\n                self.endLoading();\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Add binding to html elements\r\n     */\r\n    configureActionsHandlers: function() {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var entityTemplateControls = $(\".action-launcher-control\", control);\r\n\r\n        /**\r\n         * Binding for click action on buttons\r\n         */\r\n        entityTemplateControls.on(\"click\", function() {\r\n            var item = self.actions[parseInt($(this).data(\"index\"))];\r\n            var action = {\r\n                guidProcess: item[0],\r\n                guidAction: item[4],\r\n                displayName: item[1],\r\n                actionType: item[3],\r\n                xpathContext: (typeof item[5] !== \"undefined\" && item[5] === \"true\"),\r\n                xpathActions: self.properties.xpathActions || \"\"\r\n            };\r\n\r\n            if (action.actionType === \"Form\") {\r\n                action.xpathContext = undefined;\r\n                action.contextType = \"entitytemplate\";\r\n                action.guidEntity = self.properties.guidEntity;\r\n            }\r\n\r\n            self.processAction(action);\r\n        });\r\n\r\n        var actions = [];\r\n        for (var i = 0, len = self.actions.length; i < len; i++) {\r\n            actions.push({\r\n                guid: self.actions[i][0],\r\n                displayName: self.actions[i][1]\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Binding for click action sheet\r\n         */\r\n        $(\"[data-element='actions-add-btn']\", control).actionSheet({\r\n            actions: actions,\r\n            actionClicked: function(action) {\r\n                var item = self.actions.find(function(e) {\r\n                    return e[0] == action.guid;\r\n                });\r\n                self.processAction({\r\n                    guidProcess: item[0],\r\n                    guidAction: item[4],\r\n                    displayName: item[1],\r\n                    actionType: item[3],\r\n                    xpathContext: (typeof item[5] !== \"undefined\" && item[5] === \"true\")\r\n                });\r\n            }\r\n        });\r\n\r\n    },\r\n\r\n    configureTemplateHandlers: function() {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        /**\r\n         * Catch the event from the layout link\r\n         */\r\n        self.engine.subscribe(\"onLoadDataNavigation\", function(ev, params) {\r\n            params.filters = [];\r\n            params.calculateFilters = params.calculateFilters || true;\r\n\r\n            self.triggerGlobalHandler(\"dataNavigation\", params);\r\n        });\r\n\r\n        $(\".bz-template-more-or-less\", control).bind(\"click\", function(){\r\n            $(\".bz-template\", control).toggleClass(\"bz-template--collapsed\");\r\n        });\r\n    }\r\n\r\n});","/**\r\n * Device definition of Polymorphic launcher\r\n *\r\n * @author: Andres Felipe Arenas\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.polymorphicLauncher\", bizagi.rendering.polymorphicLauncher.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.polymorphicLauncher.extend(\"bizagi.rendering.smartphone.polymorphicLauncher\", {}, {\r\n    /**\r\n      * Render a specific implementation for Smartphone device\r\n      */\r\n    postRender: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var mode = self.getMode();\r\n        var html, template;\r\n\r\n        if (mode == \"design\" || !self.properties.surrogatedKey) {\r\n            return \"\";\r\n        }\r\n\r\n        self.configureQueueVisibility();\r\n\r\n\t\t/**\r\n\t\t * Define params to get list of actions\r\n\t\t */\r\n        return $.when(self.dataService.multiaction().getPolymorphicActions(self.processPropertyValueArgs)).done(function (response) {\r\n            // Convert default response to tree data structure\r\n            response = self.dataService.serializePolymorphicActions(response);\r\n            self.totalActions = bizagi.clone(response);\r\n            var actions = bizagi.clone(response);\r\n            self.lessActions = bizagi.clone(actions);\r\n\r\n            // NOTE: Code extracted\r\n            var templateArguments = {\r\n                actions: actions,\r\n                allowSearch: properties.allowSearch,\r\n                treeActionsList: self.getTreeItems(actions)\r\n            };\r\n            template = self.renderFactory.getTemplate(\"render-polymorphicLauncher-vertical-tree\");\r\n\r\n            var control = self.getControl();\r\n            var actionsContainer = $(\".bz-polymorphic-launcher__constructors\", control);\r\n            actionsContainer.append($.fasttmpl(template, templateArguments));\r\n            self.bindHandlers();\r\n        });\r\n    },\r\n\r\n\t/**\r\n\t * Get rendered html of each node of constructors\r\n\t * @param actions\r\n\t * @param level\r\n\t * @return {string}\r\n\t */\r\n    getTreeItems: function (actions, level) {\r\n        var self = this;\r\n        var item = \"<ul>\";\r\n        var templateTreeItem = self.renderFactory.getTemplate(\"render-polymorphicLauncher-vertical-tree-item\");\r\n        actions = actions || {};\r\n        level = level || 1;\r\n\r\n        $.each(actions, function (key, value) {\r\n            item += $.fasttmpl(templateTreeItem, value);\r\n\r\n            if (value.children) {\r\n                item += self.getTreeItems(value.children, level + 1);\r\n            }\r\n        });\r\n        item += \"</ul>\";\r\n        return item;\r\n    },\r\n\r\n\t/**\r\n\t * Add binding to html elements\r\n\t */\r\n    bindHandlers: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var actionLauncherControls = $(\".bz-polymorphic-launcher__constructors li span\", control);\r\n\r\n        //Binding for click action on buttons\r\n        actionLauncherControls.on(\"click\", function () {\r\n            var $targetData = $(this).parent();\r\n            var action = {\r\n                guidEntity: $targetData.data(\"guidentity\"),\r\n                guidObject: $targetData.data(\"guidobject\"),\r\n                guidConstructor: $targetData.data(\"guidconstructor\"),\r\n                displayName: $targetData.data(\"display-name\"),\r\n                actionType: $targetData.data(\"action-type\"),\r\n                xpathContext: $targetData.data(\"xpathcontext\")\r\n            };\r\n            self.onActionClicked(action);\r\n        });\r\n        //Catch the typed text in the search field and filter the action list\r\n        $.expr[\":\"].FilterAction = function (entity, i, array) {\r\n            var search = array[3];\r\n            if (!search) {\r\n                return false;\r\n            }\r\n            return new RegExp(search, \"i\").test($(entity).text());\r\n        };\r\n        $(\"input[data-action=search]\", control).keyup(function () {\r\n            var search = $(this).val();\r\n            $(\".bz-polymorphic-launcher__constructors li\", control).show();\r\n            if (search) {\r\n                $(\".bz-polymorphic-launcher__constructors li\", control).not(\":FilterAction(\" + search + \")\").hide();\r\n            }\r\n        });\r\n\r\n    },\r\n\t/**\r\n\t * Execute an Action\r\n\t * @param action\r\n\t */\r\n    onActionClicked: function (action) {\r\n        var self = this;\r\n\r\n        $.when(self.actionManager(action)).done(function (act) {\r\n            self.executeAction(act);\r\n        });\r\n    },\r\n\t/**\r\n\t * Show a message when action has been executed\r\n\t * @param status\r\n\t * @param action\r\n\t */\r\n    notifyExecution: function (status, action) {\r\n        var self = this;\r\n        if (status == \"success\") {\r\n            $.notifier.add({\r\n                class_name: \"success\",\r\n                title: action.displayName,\r\n                text: self.getResource(\"render-action-launcher-success-excecution\").replace('%s', action.displayName),\r\n                sticky: false\r\n            });\r\n\r\n        } else {\r\n            $.notifier.add({\r\n                class_name: \"error\",\r\n                title: action.displayName,\r\n                text: self.getResource(\"render-action-launcher-failed-excecution\").replace('%s', action.displayName),\r\n                sticky: false\r\n            });\r\n        }\r\n    },\r\n\t/**\r\n\t * Show a dialog with a form\r\n\t * @param action\r\n\t * @return {*}\r\n\t */\r\n    processActionForm: function (action) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var form = self.getFormContainer();\r\n        var additionalXpaths = self.properties.additionalXpath.join(\",\");\r\n        var def = new $.Deferred();\r\n        var xpathContext = action.xpathContext || \"\";\r\n        var formParams = form.getParams();\r\n\r\n        var recordXpath = self.properties.recordXpath;\r\n\r\n        // Show dialog with new form after that\r\n        var slideForm = new bizagi.rendering.smartphone.slide.form(self.dataService, self.renderFactory, {\r\n            title: properties.detailLabel || bizagi.localization.getResource(\"render-grid-details-form\"),\r\n            navigation: formParams.navigation,\r\n            showSaveButton: true,\r\n            cancelButtonLabel: bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n            onSave: function (data) {\r\n                var pageCache = data.idPageCache;\r\n                data.idPageCache = null;\r\n                // Submit the form\r\n                return self.dataService.multiaction().submitData({\r\n                    action: \"SAVE\",\r\n                    data: data,\r\n                    xpathContext: slideForm.form.properties.xpathContext, //self.properties.xpathContext,\r\n                    idPageCache: pageCache,\r\n                    isOfflineForm: false,\r\n                    isActionStartForm: true\r\n                }).done(function (savedData) {\r\n                    if (!action.editMode && self.countSameActions(action) == 0) {\r\n                        action.idStartScope = savedData.IdScope;\r\n                    }\r\n                    def.resolve(savedData.IdScope);\r\n                });\r\n            },\r\n            onCancel: function (data) {\r\n\r\n            }\r\n        });\r\n\r\n        slideForm.render({\r\n            \"idForm\": action.guidObject,\r\n            \"contextType\": \"entity\",\r\n            \"guidEntity\": action.guidEntity,\r\n            \"idCase\": self.properties.caseId,\r\n            \"idWorkitem\": self.typeForm != \"SummaryForm\" ? formParams.idWorkitem : undefined,\r\n            \"additionalXpaths\": additionalXpaths,\r\n            //\"xpathContext\": xpathContext,\r\n            \"idStartScope\": action.idStartScope,\r\n            \"surrogateKey\": self.properties.surrogatedKey,\r\n            \"recordXpath\": recordXpath\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n\t/**\r\n\t * Process a start form\r\n\t * @param args\r\n\t * @return {*}\r\n\t */\r\n    processStartForm: function (args) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var form = self.getFormContainer();\r\n        var def = new $.Deferred();\r\n        var formParams = form.getParams();\r\n        args = args || {};\r\n\r\n\r\n        var slideForm = new bizagi.rendering.smartphone.startForm(self.dataService, self.renderFactory, {\r\n            //showSaveButton: properties.editable,\r\n            maximized: properties.maximized,\r\n            title: args.title || \"\",\r\n            navigation: formParams.navigation,\r\n            saveButtonLabel: (self.typeForm == \"GlobalForm\" || this.typeForm == \"SummaryForm\") ? bizagi.localization.getResource(\"render-form-button-create\") : bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n            onSave: function (data) {\r\n                form.startLoading();\r\n\r\n                // Submit the form\r\n                return self.dataService.multiaction().submitData({\r\n                    action: \"SAVE\",\r\n                    data: data,\r\n                    xpathContext: self.properties.xpathContext,\r\n                    idPageCache: data.idPageCache,\r\n                    isOfflineForm: false,\r\n                    isActionStartForm: true\r\n                }).done(function (savedData) {\r\n                    form.endLoading();\r\n                    def.resolve(savedData.IdScope);\r\n                });\r\n            }\r\n        });\r\n\r\n        slideForm.render({\r\n            guidprocess: args.guidprocess,\r\n            idStartScope: args.idStartScope,\r\n            idCase: self.properties.caseId,\r\n            idWorkitem: self.typeForm != \"SummaryForm\" ? formParams.idWorkitem : undefined,\r\n            additionalXpaths: self.properties.additionalXpath.join(\",\"),\r\n            surrogatedKey: self.properties.surrogatedKey,\r\n            recordXpath: args.recordXpath,\r\n            mappingstakeholders: true\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\t/**\r\n\t * Execute and action if a form is global form or summary, or send to queue\r\n\t * @param action\r\n\t */\r\n    executeAction: function (action) {\r\n        var self = this;\r\n\r\n        if (self.typeForm == \"GlobalForm\" || self.typeForm == \"SummaryForm\") {\r\n            var message = bizagi.localization.getResource(\"render-action-launcher-immediatly-action-confirmation\");\r\n\r\n            $.when(bizagi.showConfirmationBox(message, \"Bizagi\", \"info\"))\r\n                .done(function () {\r\n                    self.executeActionImmediately(action);\r\n                });\r\n        } else {\r\n            self.addActionToQueue(action);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show confirmation dialog\r\n     * @param action\r\n     */\r\n    showConfirmationDialog: function (action) {\r\n        var self = this;\r\n        var message = bizagi.localization.getResource(\"render-action-launcher-single-action-confirmation\");\r\n\r\n        $.when(bizagi.showConfirmationBox(message, \"Bizagi\", \"info\"))\r\n            .done(function () {\r\n                self.setValue([]);\r\n\r\n                $.when(self.actionManager(action))\r\n                    .done(function (act) {\r\n                        self.executeAction(act);\r\n                    });\r\n            });\r\n    },\r\n\r\n\t/**\r\n\t * Render actual value of control and set events\r\n\t * @param data\r\n\t */\r\n    setDisplayValue: function (data) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var actionsToExecuteContainer = $(\".bz-polymorphic-launcher-constructors-to-execute-container\", control);\r\n        var template = self.renderFactory.getTemplate(\"render-polymorphicLauncher-actions-to-execute\");\r\n        self.configureQueueVisibility();\r\n\r\n        $.when($.fasttmpl(template, { actions: data })).done(function (html) {\r\n            actionsToExecuteContainer.empty();\r\n            actionsToExecuteContainer.append(html);\r\n            var removeActionSelector = $(\".bz-pill .bz-btn-icn\", actionsToExecuteContainer);\r\n            var openActionSelector = $(\".bz-pill__label\", actionsToExecuteContainer);\r\n            removeActionSelector.on(\"click\", function () {\r\n                var index = $(this).parent().data(\"index\");\r\n                self.removeActionToQueue(index);\r\n            });\r\n            openActionSelector.bind(\"click\", function () {\r\n                var $target = $(this).parent();\r\n                var type = $target.data(\"actiontype\");\r\n                var guidprocess = $target.data(\"guidprocess\");\r\n                var idStartScope = $target.data(\"idstartscope\");\r\n                var title = $target.data(\"title\");\r\n                var xpathContext = $target.data(\"xpathcontext\");\r\n                var idEntity = $target.data(\"identity\") || \"\";\r\n                var guidEntity = $target.data(\"guidentity\");\r\n                var recordXpath = xpathContext || self.properties.xpathContext;\r\n\r\n                switch (type) {\r\n                    case \"Process\":\r\n                        if (idStartScope) {\r\n                            self.processStartForm({\r\n                                guidprocess: guidprocess,\r\n                                idStartScope: idStartScope,\r\n                                title: title,\r\n                                xpathContext: xpathContext,\r\n                                recordXpath: recordXpath\r\n                            });\r\n                        }\r\n                        break;\r\n                    case \"Form\":\r\n                        var action = {\r\n                            guidProcess: guidprocess,\r\n                            idStartScope: idStartScope,\r\n                            editMode: true,\r\n                            xpathContext: xpathContext,\r\n                            idEntity: idEntity,\r\n                            guidEntity: guidEntity,\r\n                            guidObject: guidprocess\r\n                        };\r\n\r\n                        self.processActionForm(action);\r\n                        break;\r\n                    case \"Rule\":\r\n                        // Rules dont have forms or something like that\r\n                        break;\r\n                }\r\n            });\r\n        });\r\n    },\r\n\t/**\r\n\t * Show container if it has actions\r\n\t */\r\n    configureQueueVisibility: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var actionsToExecuteContainer = $(\".bz-polymorphic-launcher-constructors-to-execute-container\", control);\r\n        var actionsToExecuteTitle = $(\".bz-polymorphic-launcher__title\", control);\r\n        if (self.getValue().length > 0) {\r\n            actionsToExecuteContainer.show();\r\n            actionsToExecuteTitle.show();\r\n        } else {\r\n            actionsToExecuteContainer.hide();\r\n            actionsToExecuteTitle.hide();\r\n        }\r\n    }\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Yes-No Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the Yes-No render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.yesno\", bizagi.rendering.yesno.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.yesno.extend(\"bizagi.rendering.smartphone.yesno\", {}, {\r\n\r\n    /**\r\n     * Method to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n        this.radio = $control.find(\"input[type=radio]\");\r\n\r\n        if (this.properties.editable && (this.value == null || this.value === undefined) && this.properties.value != null) {\r\n            this.value = this.properties.value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n\r\n        return $.fasttmpl(template, {value: this.getDisplayValue()});\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n        this.radio = $control.find(\"input\");\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var $control = this.getControl();\r\n        var parsedValue = bizagi.util.parseBoolean(value);\r\n\r\n        this.setValue(parsedValue, false);\r\n\r\n        if (this.properties.editable) {\r\n            if (parsedValue) {\r\n                $control.find(\"input[value=true]\").prop('checked', true);\r\n                $control.find(\"input[value=false]\").prop('checked', false);\r\n            } else {\r\n                $control.find(\"input[value=false]\").prop('checked', true);\r\n                $control.find(\"input[value=true]\").prop('checked', false);\r\n            }\r\n        } else {\r\n            this.radio.val((this.getDisplayValue()));\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to customize the render's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        self.radio.change(function () {\r\n            var $selected = $(this);\r\n            var value = $selected.prop('value');\r\n\r\n            if (self.value !== value) {\r\n                self.setValue(value);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Context to apply styles\r\n     * @param context\r\n     * @returns {jQuery|HTMLElement}\r\n     */\r\n    getElementsToStylize: function (context) {\r\n        return $(\"label.bz-radio__label\", context);\r\n    },\r\n\r\n    /**\r\n     * Cleans current data\r\n     */\r\n    cleanData: function () {\r\n        var value = {id: \"\", label: \"\"};\r\n        this.setValue(value, false);\r\n\r\n        this.clearDisplayValue();\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     */\r\n    clearDisplayValue: function () {\r\n        if (this.properties.editable) {\r\n            this.radio.prop('checked', false);\r\n        } else {\r\n            this.radio.val(this.getDisplayValue());\r\n        }\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Check\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the Yes-No render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.check\", bizagi.rendering.check.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.check.extend(\"bizagi.rendering.smartphone.check\", {}, {\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n        this.check = $control.find(\"input\");\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n\r\n        return $.fasttmpl(template, {value: this.getDisplayValue()});\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n        this.check = $control.find(\"input\");\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     */\r\n    setDisplayValue: function (value) {\r\n        // Render as simple value\r\n        var displayValue = bizagi.util.parseBoolean(value);\r\n\r\n        // Set internal value\r\n        this.setValue(displayValue, false);\r\n\r\n        if (this.properties.editable) {\r\n            if (displayValue) {\r\n                this.check.attr(\"checked\", \"checked\");\r\n            } else {\r\n                this.check.removeAttr(\"checked\");\r\n            }\r\n        } else {\r\n            this.check.val((this.getDisplayValue()));\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to customize the render's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        this.check.on(\"click\", function (evt) {\r\n            var isCheck = $(this).is(':checked');\r\n\r\n            self.setValue(isCheck, true);\r\n\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Cleans current data\r\n     */\r\n    cleanData: function () {\r\n        this.setDisplayValue(false);\r\n        this.setValue(false, false);\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render list Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the list render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.checkList\", bizagi.rendering.checkList.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.checkList.extend(\"bizagi.rendering.smartphone.checkList\", {}, {\r\n\r\n    /**\r\n     *   Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        this._super();        \r\n        this.properties.unique = Math.ceil(Math.random() * 1000);        \r\n        this.properties.required = true;\r\n    },\r\n\r\n    /**\r\n     *   Template method to implement in each device to customize the render's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        // Call base\r\n        self._super();\r\n        $(\"input[type=checkbox]\", self.getControl()).bind(\"change\", function () {\r\n            var itemId = $(this).data(\"item-guid\");\r\n            self.onCheckListGroupChange(itemId, this.checked);\r\n        });\r\n    },\r\n\r\n    onCheckListGroupChange: function (itemId, checked) {\r\n        var self = this;\r\n        var item;\r\n        var items = $.grep(self.properties.items, function (element, index) {\r\n            return element.guid === itemId;\r\n        });\r\n        if (items && items.length > 0) {\r\n            item = items[0];\r\n        }\r\n        item.checked = checked;\r\n    },\r\n\r\n    /**\r\n     *   Sets the value in the rendered control\r\n     */\r\n    clearDisplayValue: function () {\r\n        $(\"input[type=checkbox]\", this.getControl()).removeAttr(\"checked\");\r\n    },\r\n\r\n    setDisplayValue : function (value){\r\n        var self = this;\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi smartphone Render list Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the list render class to adjust to smartphone devices\r\n */\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.list\", bizagi.rendering.combo.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.list.extend(\"bizagi.rendering.smartphone.list\", bizagi.rendering.list.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.list.extend(\"bizagi.rendering.smartphone.list\", {}, {\r\n    \r\n    /*\r\n    *   Template method to implement in each children to customize each control\r\n    */\r\n    renderControl: function () {\r\n        var template = this.renderFactory.getTemplate(\"list\");\r\n\r\n        return $.fasttmpl(template, {\r\n            editable: this.properties.editable,\r\n            value: this.getDisplayValue()\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Add event handlers to the combo control\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        if (self.getMode() !== \"execution\") {\r\n            return;\r\n        }\r\n\r\n        $(\".bz-form-list\", control).bind(\"click\", function () {\r\n\r\n            $(this).mobileView({\r\n                customHeader: $.fasttmpl(self.renderFactory.getTemplate(\"modal-header-search\"), {}),\r\n                displayName: self.properties.displayName || \"\",\r\n                orientation: self.properties.orientation || \"\",\r\n                contentTemplate: \"\",\r\n\r\n                close: function () {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                },\r\n\r\n                open: function () {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n\r\n                configureActions: function (context) {\r\n                    var params = {};\r\n                    if (self.isDependant && self.properties && /^cascadingcombo$/i.test(self.properties.type) && self.getParentCombo) {\r\n                        var parentValue = self.getParentCombo().getValue();\r\n                        if (parentValue && parentValue.id) {\r\n                            params[self.Class.BA_ACTION_PARAMETER_PREFIX + \"parent\"] = parentValue.id;\r\n                        }\r\n                    }\r\n\r\n                    $.when(self.renderCombo(params)).done(function (list) {\r\n                        $(\".bz-modal-view__content\", context.content).html(list);\r\n                        self.configureModalViewHandlers(context);\r\n                    })\r\n                }\r\n            });\r\n        });\r\n\r\n    },\r\n\r\n    processComboData: function (data) {\r\n        var self = this;\r\n        data.forEach(function (value) {\r\n            self.validateValue(value);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Setting the display value, always you call a setDisplayValue yor are performinng a setValue under the hood.\r\n     * */\r\n    setDisplayValue: function (value) {\r\n        var comboValue;\r\n        value = this.mapValue(value);\r\n\r\n        if (value && (typeof value === \"object\" && typeof value.label !== \"undefined\")) {\r\n\r\n            if (value.label !== \"\" && !bizagi.util.isNumeric(value.label)) {\r\n                comboValue = value.label;\r\n            } else {\r\n                var selected = this.findDataValueById(value.value);\r\n                comboValue = selected ? selected.value : \"\";\r\n            }\r\n\r\n            if ($.isArray(comboValue)) {\r\n                comboValue = comboValue.join(\" - \");\r\n            }\r\n            value = ({ \"id\": value.id, \"value\": comboValue });\r\n        }\r\n\r\n        var control = this.getControl();\r\n        $(\"input\", control).val(this.formatItem(value.value));\r\n\r\n        //Set Value\r\n        this.selectedValue = value;\r\n        this.setValue(value);\r\n    },\r\n\r\n    /**\r\n     * Set the handlers for the modal elements\r\n     * @param {kendoModalObject} context full modal object\r\n     */\r\n    configureModalViewHandlers: function (context) {\r\n        var self = this;\r\n\r\n        $(\".bz-list__item\", context.content).on(\"click\", function () {\r\n            var valueObjet = {\r\n                \"id\": $(this).data(\"value\"),\r\n                \"value\": $(this).text()\r\n            };\r\n\r\n            if (valueObjet.id == \"\") {\r\n                valueObjet.value = \"\";\r\n            }\r\n\r\n            self.setDisplayValue(valueObjet);\r\n            self.trigger(\"select\", [valueObjet, false]);\r\n            context.close();\r\n        });\r\n\r\n        var $elementsList = $(\".bz-list li\", context.content);\r\n        var $clearButton = $(\".bz-modal-view__clear\", context.header);\r\n        var $searchInput = $(\".bz-modal-view__search\", context.header);\r\n\r\n        $(\"[data-action=close]\", context.header).bind(\"click\", function () {\r\n            context.close();\r\n        });\r\n\r\n        $clearButton.bind(\"click\", function () {\r\n            $searchInput.val(\"\").trigger(\"change\");\r\n        });\r\n        // Filtering list\r\n        $searchInput.bind(\"change keyup\", function () {\r\n            if (this.value == \"\") {\r\n                $clearButton.removeClass(\"bz-modal-view__clear--visible\");\r\n            } else {\r\n                $clearButton.addClass(\"bz-modal-view__clear--visible\");\r\n            }\r\n            self.filterList(this.value, $elementsList);\r\n        }).focus();\r\n    },\r\n\r\n    /**\r\n     * Filtering list of elements\r\n     * @returns {}\r\n     */\r\n    filterList: function (search, $li) {\r\n\r\n        $li.filter(function () {\r\n            var stringContainer = $(this).text().toUpperCase();\r\n            var stringToSearch = search.toUpperCase();\r\n\r\n            if (stringContainer.indexOf(stringToSearch) >= 0) {\r\n                return $(this);\r\n            } else {\r\n                $(this).hide();\r\n            }\r\n        }).show();\r\n    },\r\n\r\n    /**\r\n     * Print the list of elements to show in the modal\r\n     * @param {object} data list of elements to print\r\n     */\r\n    renderComboTemplate: function (data) {\r\n        var template = this.renderFactory.getTemplate(\"list-items\");\r\n        var value = this.getValue();\r\n        value = (value !== null && typeof value !== \"undefined\") ? value : {\"id\": \"\", \"value\": \"\"};\r\n\r\n        return $.fasttmpl(template, {\r\n            \"items\": data,\r\n            \"selectedId\": value.id,\r\n            \"hasItems\": data.length > 0\r\n        }, {\r\n            \"validateItem\": this.validateValue\r\n        });\r\n    },\r\n\r\n\r\n    getElementsToStylize: function ($context) {\r\n        return this.properties.editable ? $(\"input\", $context) : $(\".readonly-control\", $context);\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Yes-No Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the multiSelect render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render tablet base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.multiSelect\", bizagi.rendering.multiSelect.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.multiSelect.extend(\"bizagi.rendering.smartphone.multiSelect\", {\r\n    MORE_OPTION_WIDTH: 40,\r\n    SEARCH_MIN_LENGTH: 1\r\n}, {\r\n\r\n\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"searchList.readonly\");\r\n\r\n        // Render template\r\n        var content = $.fasttmpl(template, {\r\n            items: self.properties.value || {},\r\n            editable: self.properties.editable || true\r\n        }, {\r\n            formatItem: self.formatItem\r\n        });\r\n\r\n        return content;\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        if (this.isExecutionMode()) {\r\n            this.getData().done(function (data) {\r\n                self.properties.data = data;\r\n            });\r\n        }\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n        $(\"[data-action=modal]\", $control).bind(\"click\", function () {\r\n            self.openModalView();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Sets the value and display, avoid to include setValue in this method.\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        this._super(value);\r\n\r\n        if (value !== undefined) {\r\n            $(\".bz-input-icon__input\", this.getControl()).html(value.map(function (el) {\r\n                return self.formatItem(el.value);\r\n            }).join(\", \"));\r\n        }\r\n    },\r\n    /**\r\n     * Opens the modal view\r\n     */\r\n    openModalView: function () {\r\n        var self = this;\r\n        self.getData().done(function (result) {\r\n            var template_content = self.renderFactory.getTemplate('multiselect-list');\r\n            var value = self.getValue();\r\n\r\n            if (!$.isArray(value)) {\r\n                value = typeof (value) === \"string\" ? JSON.parse(value).value : value.value;\r\n            }\r\n\r\n            var data = {\r\n                values: result,\r\n                isChecked: function (id) {\r\n                    return self.isChecked(value, id);\r\n                }\r\n            };\r\n\r\n            var content = $.fasttmpl(template_content, data, {\r\n                formatItem: self.formatItem\r\n            });\r\n\r\n            var template_footer = self.renderFactory.getTemplate(\"modal-footer-done\");\r\n            var footer = $.fasttmpl(template_footer, {});\r\n\r\n            self.getControl().mobileView({\r\n                customHeader: $.fasttmpl(self.renderFactory.getTemplate(\"modal-header-search\"), {}),\r\n                // displayName: self.properties.displayName || \"\",\r\n                orientation: self.properties.orientation || \"\",\r\n                contentTemplate: content,\r\n                footerTemplate: footer,\r\n                transition: \"slideIn:up\",\r\n                close: function () {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                },\r\n                afterOpenAnimation: function (event) {\r\n                    $(\".bz-modal-view__search\", event.view.header).focus();\r\n                },\r\n                open: function () {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                configureActions: function (modalView) {\r\n                    self.configureModalViewHandlers(modalView);\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Configure the modalView Handlers for the new combo control.\r\n     * */\r\n    configureModalViewHandlers: function (modalView) {\r\n        var self = this;\r\n\r\n        var $listContainer = $(\".bz-checkbox-list li\", modalView.content);\r\n        //clear button\r\n        var $clearButton = $(\".bz-modal-view__clear\", modalView.header);\r\n        // Suggest input\r\n        var $suggestInput = $(\".bz-modal-view__search\", modalView.header);\r\n\r\n        $suggestInput.on(\"change keyup\", function () {\r\n            if (this.value == \"\") {\r\n                $clearButton.removeClass(\"bz-modal-view__clear--visible\");\r\n            } else {\r\n                $clearButton.addClass(\"bz-modal-view__clear--visible\");\r\n            }\r\n            self.filterList(this.value, $listContainer);\r\n        }).on(\"focus\", function () {\r\n            modalView.header.addClass(\"bz-modal-view__header--active\");\r\n        }).on(\"blur\", function () {\r\n            modalView.header.removeClass(\"bz-modal-view__header--active\");\r\n        });\r\n\r\n        //Clear the search\r\n        $clearButton.on(\"click\", function () {\r\n            $suggestInput.val(\"\").trigger(\"change\");\r\n        });\r\n\r\n        $(\"[data-action=close]\", modalView.header).on(\"click\", function () {\r\n            modalView.close();\r\n        });\r\n\r\n        $(modalView.footer).on(\"click\", \"[data-action=save]\", function (evt) {\r\n            // Create a temporal array\r\n            var newList = [];\r\n\r\n            $.each.call(this, $listContainer, function (index, item) {\r\n                var check = item.querySelector(\"input\");\r\n\r\n                if (check.checked) {\r\n                    var id = check.getAttribute(\"data-id\");\r\n                    var element = this.findItemById(id);\r\n                    var value = element.value;\r\n                    newList.push({id: id, value: value});\r\n                }\r\n            }.bind(self));\r\n\r\n            self.setDisplayValue(newList);\r\n\r\n            modalView.close();\r\n        });\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render list Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the radio render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.radio\", bizagi.rendering.combo.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.radio.extend(\"bizagi.rendering.smartphone.radio\", bizagi.rendering.radio.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.radio.extend(\"bizagi.rendering.smartphone.radio\", {}, {\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n        this.radio = $control.find(\"input[type=radio]\");\r\n\r\n        if (this.properties.editable && (this.value == null || this.value === undefined) && (this.properties.value != null)) {\r\n            this.value = this.properties.value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n\r\n        return $.fasttmpl(template, {value: this.getDisplayValue()});\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n        this.radio = $control.find(\"input\");\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param value\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // Map data from actions\r\n        value = self.mapValue(value);\r\n\r\n        // Set internal value\r\n        self.setValue(value, false);\r\n\r\n        if (value !== undefined && value.id != null && value.id !== \"\") {\r\n\r\n            if (this.properties.editable) {\r\n\r\n                var radioItem = $control\r\n                    .find('input[type=\"radio\"][value=\"' + value.id + '\"]');\r\n\r\n                radioItem.prop('checked', 'checked');\r\n            } else {\r\n                self.radio.val((this.getDisplayValue()));\r\n                self.radio.attr(\"id\", value.id);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Add action handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        this.radio.change(function () {\r\n            var $selected = $(this);\r\n\r\n            var newValue = {\r\n                id: $selected.prop('value'),\r\n                value: $.trim($selected.siblings(\"label\").text())\r\n            };\r\n\r\n            self.setValue(newValue);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Context to apply styles\r\n     * @param context\r\n     * @returns {jQuery|HTMLElement}\r\n     */\r\n    getElementsToStylize: function (context) {\r\n        return $(\"label.bz-radio__label\", context);\r\n    },\r\n\r\n    /**\r\n     * Cleans current data\r\n     */\r\n    cleanData: function () {\r\n        var value = {id: \"\", label: \"\"};\r\n        this.setValue(value, false);\r\n\r\n        this.clearDisplayValue();\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     */\r\n    clearDisplayValue: function () {\r\n        if (this.properties.editable) {\r\n            this.radio.prop('checked', false);\r\n        } else {\r\n            this.radio.val(this.getDisplayValue());\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the selected value in the template\r\n     * @returns {*}\r\n     */\r\n    getSelectedValue: function () {\r\n        return this.selectedValue;\r\n    }\r\n\r\n});\r\n","/**\r\n*   Name: BizAgi Smartphone Render Cascading combo Extension\r\n*   Author: Forms team\r\n*   Comments:\r\n*   -   This script will redefine the cascading combo render class to adjust to tablet devices\r\n*/\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.cascadingCombo\", bizagi.rendering.combo.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.cascadingCombo.extend(\"bizagi.rendering.smartphone.cascadingCombo\", bizagi.rendering.cascadingCombo.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.cascadingCombo.extend(\"bizagi.rendering.smartphone.cascadingCombo\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,\r\n    BA_CONTEXT_PARAMETER_PREFIX: bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX\r\n}, {\r\n\r\n    /*\r\n   *   Template method to implement in each children to customize each control\r\n   */\r\n    renderControl: function () {\r\n        var mode = this.getMode();\r\n\r\n        // Check if this is a dependant combo\r\n        this.parentCombo = this.getParentCombo();\r\n        if (this.parentCombo != null) {\r\n\r\n            if ((/cascadingcombo/i.test(this.parentCombo.properties.type))) {\r\n                this.isDependant = true;\r\n            }\r\n        }\r\n\r\n        // Apply element plugin, set a flag to avoid dependant combo ajax requests\r\n        this.initializingCascadingCombo = true;\r\n\r\n        if (mode != \"execution\") {\r\n            this.initializingCascadingCombo = false;\r\n        }\r\n\r\n        return bizagi.rendering.smartphone.combo.prototype.renderControl.apply(this, arguments);\r\n    },\r\n\r\n    postRender: function () {\r\n        bizagi.rendering.smartphone.combo.prototype.postRender.apply(this, arguments);\r\n    },\r\n\r\n    /*\r\n   *   Template method to implement in each device to customize the render's behaviour to add handlers\r\n   */\r\n    configureHandlers: function () {\r\n        // Call base\r\n        this._super();\r\n\r\n        // Call desktop.combo method\r\n        bizagi.rendering.smartphone.combo.prototype.configureHandlers.apply(this, arguments);\r\n    },\r\n\r\n    /**\r\n     * Override to avoid the trigguer\r\n     */\r\n    cleanData: function () {\r\n        bizagi.rendering.smartphone.combo.prototype.cleanData.apply(this, arguments);\r\n    },\r\n\r\n    /*\r\n    *   Refresh the combo, after it has been painted\r\n    */\r\n    refresh: function (params, isInitialValue) {\r\n        var self = this;\r\n        // Wait until current element is rendered\r\n        $.when(self.isRendered()).done(function () {\r\n            // Clear current control\r\n            var control = self.getControl();\r\n            var mode = self.getMode();\r\n            control.empty();\r\n\r\n            // Render combo again\r\n            $.when(self.renderControl()).then(function (html) {\r\n                // Append new element\r\n                control.html(html);\r\n                // Post-render method\r\n                self.postRender();\r\n\r\n                if (mode == \"execution\") {\r\n                    self.configureHandlers();\r\n                }\r\n\r\n                // Set current value\r\n                if (isInitialValue) {\r\n                    self.setDisplayValue(self.getValue());\r\n                } else {\r\n                    self.setDisplayValue({\r\n                        \"id\": \"\",\r\n                        \"value\": \"\"\r\n                    });\r\n                }\r\n\r\n                if (self.deferredVisible) {\r\n                    self.deferredVisible.resolve();\r\n                }\r\n\r\n                self.trigger(\"select\", [self.getValue(), isInitialValue]);\r\n            });\r\n        });\r\n    },\r\n    /*\r\n    *   Sets the value in the rendered control\r\n    */\r\n    setDisplayValue: function (value) {\r\n        bizagi.rendering.smartphone.combo.prototype.setDisplayValue.apply(this, arguments);\r\n    },\r\n\r\n    processComboData: function () {\r\n        bizagi.rendering.smartphone.combo.prototype.processComboData.apply(this, arguments);\r\n    },\r\n\r\n    validateValue: function () {\r\n        return bizagi.rendering.smartphone.combo.prototype.validateValue.apply(this, arguments);\r\n    },\r\n\r\n    renderComboTemplate: function () {\r\n        return bizagi.rendering.smartphone.combo.prototype.renderComboTemplate.apply(this, arguments);\r\n    },\r\n\r\n    configureModalViewHandlers: function () {\r\n        bizagi.rendering.smartphone.combo.prototype.configureModalViewHandlers.apply(this, arguments);\r\n    },\r\n\r\n    configureCombo: function () {\r\n        bizagi.rendering.smartphone.combo.prototype.configureCombo.apply(this, arguments);\r\n    },\r\n\r\n    changeCombo: function (valueItem, valueObjet) {\r\n        bizagi.rendering.smartphone.combo.prototype.changeCombo.apply(this, arguments);\r\n    },\r\n\r\n    /*\r\n    *   Returns the selected value in the template\r\n    */\r\n    getSelectedValue: function () {\r\n        return bizagi.rendering.smartphone.combo.prototype.getSelectedValue.call(this, arguments);\r\n    },\r\n\r\n    getTemplateName: function () {\r\n        return \"combo\";\r\n    },\r\n    /**\r\n     * Filtering list of elements\r\n     * @returns {}\r\n     */\r\n    filterList: function (search, $li) {\r\n        return bizagi.rendering.smartphone.combo.prototype.filterList.call(this, search, $li);\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi smartphone Render option select\r\n *   Author: Ricardo Pérez\r\n *   Comments:\r\n *   -   Renders an option html input with attached handlers\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.combo\", bizagi.rendering.combo.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.combo.extend(\"bizagi.rendering.smartphone.combo\", {}, {\r\n\r\n    /*\r\n    *   Template method to implement in each children to customize each control\r\n    */\r\n    renderControl: function () {\r\n        var template = this.renderFactory.getTemplate(\"combo\");\r\n\r\n        return $.fasttmpl(template, {\r\n            editable: this.properties.editable,\r\n            value: this.getDisplayValue()\r\n        });\r\n\r\n    },\r\n\r\n    postRender: function() {\r\n        var $control = this.getControl();\r\n\r\n        this._super();\r\n\r\n        this.combo = $control.find(\"input\");\r\n        this.itemSelected = undefined;\r\n    },\r\n\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n\r\n        return $.fasttmpl(template, {value: this.getDisplayValue()});\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n        this.combo = $control.find(\"input\");\r\n    },\r\n\r\n    /**\r\n     * Add event handlers to the combo control\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        if (self.getMode() !== \"execution\") {\r\n            return;\r\n        }\r\n\r\n        $(\".bz-form-combo\", control).bind(\"click\", function () {\r\n\r\n            $(this).mobileView({\r\n                customHeader: $.fasttmpl(self.renderFactory.getTemplate(\"modal-header-search\"), {}),\r\n                displayName: self.properties.displayName || \"\",\r\n                orientation: self.properties.orientation || \"\",\r\n                contentTemplate: \"\",\r\n\r\n                close: function () {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                },\r\n\r\n                open: function () {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n\r\n                configureActions: function (context) {\r\n                    var params = {};\r\n\r\n                    if (self.isDependant && self.properties && (/cascadingcombo/i.test(self.properties.type)) && self.getParentCombo) {\r\n                        var parentValue = self.getParentCombo().getValue();\r\n                        if (parentValue && parentValue.id) {\r\n                            params[self.Class.BA_ACTION_PARAMETER_PREFIX + \"parent\"] = parentValue.id;\r\n                        }\r\n                    }\r\n\r\n                    $.when(self.renderCombo(params)).done(function (list) {\r\n                        $(\".bz-modal-view__content\", context.content).html(list);\r\n                        self.configureModalViewHandlers(context);\r\n                    })\r\n                }\r\n            });\r\n        });\r\n\r\n    },\r\n\r\n    processComboData: function (data) {\r\n        var self = this;\r\n        data.forEach(function (value) {\r\n            self.validateValue(value);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Setting the display value, always you call a setDisplayValue yor are performing a setValue under the hood.\r\n     * */\r\n    setDisplayValue: function (value) {\r\n        var comboValue;\r\n        value = this.mapValue(value);\r\n\r\n        if (value && (typeof value === \"object\" && typeof value.label !== \"undefined\")) {\r\n\r\n            if (value.label !== \"\" && !bizagi.util.isNumeric(value.label)) {\r\n                comboValue = value.label;\r\n            } else {\r\n                var selected = this.findDataValueById(value.value);\r\n                comboValue = selected ? selected.value : \"\";\r\n            }\r\n\r\n            if ($.isArray(comboValue)) {\r\n                comboValue = comboValue.join(\" - \");\r\n            }\r\n\r\n            value = ({ \"id\": value.id, \"value\": comboValue });\r\n        }\r\n\r\n        this.combo.val(this.formatItem(value.value));\r\n\r\n        //Set Value\r\n        this.selectedValue = value;\r\n        this.setValue(value);\r\n    },\r\n\r\n    /**\r\n     * Set the handlers for the modal elements\r\n     * @param {kendoModalObject} context full modal object\r\n     */\r\n    configureModalViewHandlers: function (context) {\r\n        var self = this;\r\n\r\n        $(\".bz-list__item\", context.content).on(\"click\", function () {\r\n            var valueObjet = {\r\n                \"id\": $(this).data(\"value\"),\r\n                \"value\": $(this).text()\r\n            };\r\n\r\n            if (valueObjet.id == \"\") {\r\n                valueObjet.value = \"\";\r\n            }\r\n\r\n            self.itemSelected = true; //must be before the setDisplayValue\r\n            self.setDisplayValue(valueObjet);\r\n            self.trigger(\"select\", [valueObjet, false]);\r\n            context.close();\r\n        });\r\n\r\n        var $elementsList = $(\".bz-list li\", context.content);\r\n        var $clearButton = $(\".bz-modal-view__clear\", context.header);\r\n        var $searchInput = $(\".bz-modal-view__search\", context.header);\r\n\r\n        \r\n\r\n        $(\"[data-action=close]\", context.header).bind(\"click\", function () {\r\n            context.close();\r\n        });\r\n\r\n        if(!this.properties.enableTyping) {\r\n            $searchInput.prop(\"disabled\", true);\r\n            $searchInput.attr(\"placeholder\", \"\");\r\n        } else {\r\n            $clearButton.bind(\"click\", function () {\r\n                $searchInput.val(\"\").trigger(\"change\");\r\n            });\r\n            // Filtering list\r\n            $searchInput.bind(\"change keyup\", function () {\r\n                if (this.value == \"\") {\r\n                    $clearButton.removeClass(\"bz-modal-view__clear--visible\");\r\n                } else {\r\n                    $clearButton.addClass(\"bz-modal-view__clear--visible\");\r\n                }\r\n                self.filterList(this.value, $elementsList);\r\n            }).focus();\r\n        }\r\n        \r\n    },\r\n\r\n    cleanData: function () {\r\n        var self = this;\r\n        var value = {id: \"\", label: \"\"};\r\n\r\n        self.setDisplayValue(value);\r\n    },\r\n\r\n    /**\r\n     * Filtering list of elements\r\n     * @returns {}\r\n     */\r\n    filterList: function (search, $li) {\r\n\r\n        $li.filter(function () {\r\n            var stringContainer = $(this).text().toUpperCase();\r\n            var stringToSearch = search.toUpperCase();\r\n\r\n            if (stringContainer.indexOf(stringToSearch) >= 0) {\r\n                return $(this);\r\n            } else {\r\n                $(this).hide();\r\n            }\r\n        }).show();\r\n    },\r\n\r\n    /**\r\n     * Print the list of elements to show in the modal\r\n     * @param {object} data list of elements to print\r\n     */\r\n    renderComboTemplate: function (data) {\r\n        var template = this.renderFactory.getTemplate(\"combo-list\");\r\n        var value = this.getValue();\r\n        value = (value !== null && typeof value !== \"undefined\") ? value : {\"id\": \"\", \"value\": \"\"};\r\n\r\n        return $.fasttmpl(template, {\r\n            \"items\": data,\r\n            \"selectedId\": value.id,\r\n            \"hasItems\": data.length > 0\r\n        }, {\r\n            \"validateItem\": this.validateValue\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Returns the selected value in the template\r\n     * @returns {{id: *, value: *}}\r\n     */\r\n    getSelectedValue: function () {\r\n        return this.selectedValue;\r\n    },\r\n\r\n    getElementsToStylize: function ($context) {\r\n        return this.properties.editable ? $(\"input\", $context) : $(\".readonly-control\", $context);\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Collection Navigator Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the collection Navigator class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.collectionnavigator\", bizagi.rendering.collectionnavigator.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.collectionnavigator.extend(\"bizagi.rendering.smartphone.collectionnavigator\", {}, {\r\n\r\n    /**\r\n     * Method to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        this.getControlFiller().addClass(\"bz-form-item__control--hidden\");\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        this.getControlFiller().addClass(\"bz-form-item__control--hidden\");\r\n    }\r\n\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphones Render Hidden Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the hidden render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.hidden\", bizagi.rendering.hidden.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.hidden.extend(\"bizagi.rendering.smartphone.hidden\", {}, {});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Upload Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the upload render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.upload\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,\r\n    BA_CONTEXT_PARAMETER_PREFIX: bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,\r\n    BA_PAGE_CACHE: bizagi.render.services.service.BA_PAGE_CACHE\r\n}, bizagi.rendering.upload.prototype);\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.upload.extend(\"bizagi.rendering.smartphone.upload\", {\r\n    QUALITY_PICTURE: 50,\r\n    LIMIT: 1, // The maximum number of media in the device user can record in a single capture operation.\r\n    EXTENSIONSIMG: [\"image/jpeg\", \"jpeg\", \"image\", \"png\", \"jpg\", \"bmp\"],\r\n    EXTENSIONSFILE: [\"doc\", \"docx\", \"xls\", \"xlsx\", \"ppt\", \"pptx\", \"pdf\", \"zip\", \"rar\", \"txt\"],\r\n    EXTENSIONSVIDEO: [\"video/quicktime\", \"quicktime\", \"qt\", \"mov\"],\r\n    EXTENSIONSAUDIO: [\"audio/wav\", \"audio\", \"wav\", \"mp3\"]\r\n}, {\r\n    /**\r\n     * Whether or not is a native device\r\n     * @var isNative boolean\r\n     */\r\n    isNative: false,\r\n\r\n    /**\r\n     * Whether or not we are offline\r\n     * @var isOfflineForm boolean\r\n     */\r\n    isOfflineForm: false,\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param {} data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n\r\n        // Check if offline forms is supported\r\n        this.isOfflineForm = bizagi.util.isOfflineForm({context: this});\r\n        this.isNative = bizagi.util.isCordovaSupported();\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each children to customize each control\r\n     * @returns {}\r\n     */\r\n    renderControl: function () {\r\n        var template = this.renderFactory.getTemplate(\"upload\");\r\n\r\n        return this.renderItem(template, {});\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"upload-readonly\");\r\n        var data = {\r\n            noFiles: this.filesCount === 0\r\n        };\r\n\r\n        return this.renderItem(template, data);\r\n    },\r\n\r\n    /**\r\n     * Method to render items\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderItem: function (template, data) {\r\n        var self = this;\r\n        var items = \"\";\r\n\r\n        // Render template\r\n        var html = $.fasttmpl(template, data);\r\n\r\n        // Render current children\r\n        for (var i = 0; i < self.filesCount; i++) {\r\n            var file = {id: self.files[i][0], fileName: self.files[i][1]};\r\n            var item = self.renderUploadItem(file);\r\n            items += item;\r\n        }\r\n\r\n        html = self.replaceFilesHtml(html, items);\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n\r\n        this.$contentFile = $(\".bz-file-upload__container\", $control);\r\n        this.$inputFile = $(\".bz-file-upload__input\", $control);\r\n        this.$nativeFile = $(\".bz-file-upload__native\", $control);        \r\n    },\r\n\r\n    /**\r\n     * Add action handlers\r\n     */\r\n    configureHandlers: function () {\r\n        this.checkFileExtensions();\r\n        this.attachEvents();\r\n    },\r\n\r\n    /**\r\n     * Method to customize the render's behaviour to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // Handler to download a file\r\n        $(\"ul.bz-readonly-lists\", $control).on(\"click\", \".bz-file .bz-file-name\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            var file = item.data();\r\n\r\n            bizagi.loading.start();\r\n\r\n            $.when(bizagi.util.media.downloadFile(file.url, file.title)).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Method to configure the actions with control\r\n     * @return {}\r\n     */\r\n    attachEvents: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n        var counterChoseFiles = 0;\r\n        // Attach all events\r\n        this.$contentFile.off(\"click\").on(\"click\", function (evt) {\r\n            if(!self.isNative || counterChoseFiles > 0){                \r\n                self.chooseFile();             \r\n            }else{\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"render-upload-error-files-extension-supported-app\", \"You can only add images or videos.\"), 'Userfield error');\r\n            }            \r\n            \r\n        });\r\n\r\n        // Handler to download the file\r\n        $(\"ul.bz-files\", $control).on(\"click\", \".bz-file .bz-file-name\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            var file = item.data();\r\n\r\n            bizagi.loading.start();\r\n\r\n            $.when(bizagi.util.media.downloadFile(file.url, file.title)).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        });\r\n\r\n        // Attach delete option & Removes a file from the upload control\r\n        $(\"ul.bz-files\", $control).on(\"click\", \".bz-file .bz-icn\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            var file = item.data();\r\n\r\n            self.removeFile(item, file.id);\r\n        });\r\n\r\n        if (self.isNative) {\r\n            // Upload files\r\n            var actions = self.getUploadChoices();\r\n            counterChoseFiles = actions.length;\r\n            this.$nativeFile.off(\"click\").actionSheet({                \r\n                actions: actions,\r\n                actionClicked: function (action) {\r\n                    self.handlerUploadFile(action.guid);\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n\r\n            // Resolution upload\r\n            $(\".bz-file-upload__resolution\", $control).off(\"click\").actionSheet({\r\n                actions: bizagi.util.media.getImageResolutionSizes(),\r\n                withoutCancel: true,\r\n                actionClicked: function (action) {\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(self.handlerResolutionUpload(action.guid)).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n        } else {\r\n\r\n            // Attach event to web upload-control\r\n            this.$inputFile.off(\"change\").on(\"change\", function () {\r\n                self.addFile();\r\n                this.value = \"\";\r\n            });\r\n\r\n            // Just in case\r\n            this.$inputFile.off(\"click\").on(\"click\", function (evt) {\r\n                evt.stopPropagation();\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Handler of upload files\r\n     * @param {} ordinal\r\n     * @returns {}\r\n     */\r\n    handlerUploadFile: function (ordinal) {\r\n        var self = this;\r\n        var actionSelected = ordinal || 0;\r\n\r\n        switch (actionSelected) {\r\n            case 2:\r\n\r\n                navigator.camera.getPicture(function (dataImage) {\r\n                    self.dataImage = dataImage;\r\n                    var extensions = self.Class.EXTENSIONSIMG.concat(self.Class.EXTENSIONSVIDEO);\r\n\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties))\r\n                        .then(function () {\r\n                            //Gets the real properties for the file\r\n                            return $.when(bizagi.util.media.getFileDataInfo(self.dataImage))\r\n                                .then(function (fileData) {\r\n                                    self.fileProperties = fileData;\r\n\r\n                                    if (bizagi.util.media.checkFileTypes(fileData, self.properties, extensions)) {\r\n                                        // \"new Blob\" constructor is not supported in android version 4.2.2\r\n                                        var version = bizagi.util.getAndroidVersion();\r\n\r\n                                        if ((version && version <= 4.2) || self.isOfflineForm) {\r\n                                            return self.saveImage(self.dataImage);\r\n                                        } else {\r\n\r\n                                            if (!bizagi.util.isAndroid()) {\r\n                                                return $.when(bizagi.util.media.modalResolutionUpload()).then(function (buttonIndex) {\r\n                                                    if (buttonIndex <= bizagi.util.media.getImageResolutionItems().length) {\r\n                                                        return self.handlerResolutionUpload(buttonIndex);\r\n                                                    }\r\n                                                });\r\n\r\n                                            } else {\r\n                                                // Force click to show actionSheet menu\r\n                                                $(\".bz-file-upload__resolution\", self.getControl()).click();\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                });\r\n                        }).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n\r\n                }, self.onFail.bind(self), {\r\n                    quality: self.Class.QUALITY_PICTURE,\r\n                    correctOrientation: true,\r\n                    sourceType: Camera.PictureSourceType.PHOTOLIBRARY\r\n                });\r\n                break;\r\n            case 1:\r\n                navigator.camera.getPicture(function (dataImage) {\r\n                        bizagi.loading.start();\r\n\r\n                        $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties)).then(function () {\r\n                                return $.when(bizagi.util.media.getFileDataInfo(dataImage)).then(function (fileData) {\r\n                                    self.fileProperties = fileData;\r\n                                    return self.saveImage(dataImage);\r\n                                });\r\n                            }).always(function () {\r\n                            bizagi.loading.stop();\r\n                        });\r\n                    },\r\n                    self.onFail.bind(self), {\r\n                        quality: self.Class.QUALITY_PICTURE,\r\n                        sourceType: navigator.camera.PictureSourceType.CAMERA,\r\n                        mediaType: navigator.camera.MediaType.PICTURE,\r\n                        destinationType: Camera.DestinationType.FILE_URI,\r\n                        correctOrientation: true,\r\n                        targetWidth: 1280,\r\n                        targetHeight: 960\r\n                    });\r\n                break;\r\n            case 3:\r\n                navigator.device.capture.captureVideo(function (dataVideo) {\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(bizagi.util.media.checkMaxSizeVideo(dataVideo, self.properties))\r\n                        .then(function () {\r\n                            return self.saveVideo(dataVideo);\r\n                        }).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n\r\n                }, self.onFail.bind(self), {limit: self.Class.LIMIT});\r\n                break;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Handler of resolution upload\r\n     * @param {} ordinal\r\n     * @returns {}\r\n     */\r\n    handlerResolutionUpload: function (ordinal) {\r\n        var self = this;\r\n        var actionSelected = ordinal || 0;\r\n\r\n        // If original, save image normally, if not, reduce quality and size\r\n        if (actionSelected === bizagi.util.media.ResolutionType.ORIGINAL) {\r\n            return self.saveImage(self.dataImage);\r\n        } else {\r\n            var resolution = bizagi.util.media.getImageResolution(actionSelected);\r\n\r\n            return $.when(bizagi.util.media.transformImageSize(self.dataImage, resolution)).then(function (result) {\r\n                self.editedImageURL = result.localUrl;\r\n                self.properties.url = result.base64Image;\r\n\r\n                return self.saveImage(self.dataImage);\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Send image using HTTP\r\n     * @param {} dataImage\r\n     */\r\n    saveImage: function (dataImage) {\r\n        var self = this;\r\n        var dataItem = \"\";\r\n\r\n        if (self.editedImageURL) {\r\n            dataItem = self.editedImageURL;\r\n        } else if (self.fileProperties) {\r\n            dataItem = self.fileProperties.url;\r\n        }\r\n\r\n        // Fix android 4.4 getting images from recent folder\r\n        var dataFile = bizagi.util.media.getImagePath(dataItem);\r\n        var data = {\r\n            dataFile: dataFile,\r\n            fileName: self.fileProperties.name,\r\n            mimeType: \"image/jpeg\"\r\n        };\r\n\r\n        // Cleans variables related previous uploads\r\n        self.editedImageURL = null;\r\n        self.fileProperties = null;\r\n\r\n        return this.uploadFile(data);\r\n    },\r\n\r\n    /**\r\n     * Method to save a video file\r\n     * @param {} dataVideo\r\n     * @returns {}\r\n     */\r\n    saveVideo: function (dataVideo) {\r\n        var data = {\r\n            dataFile: dataVideo[0].fullPath,\r\n            fileName: dataVideo[0].name,\r\n            mimeType: \"video/quicktime\"\r\n        };\r\n\r\n        return this.uploadFile(data);\r\n    },\r\n\r\n    /**\r\n     * Method to save a file\r\n     * @param data\r\n     * @returns {*|void}\r\n     */\r\n    uploadFile: function (data) {\r\n        var self = this;\r\n        var params = {};\r\n        var addParams = self.buildAddParams();\r\n        addParams.queueID = \"q_\" + bizagi.util.encodeXpath(self.getUploadXpath());\r\n\r\n        params.data = addParams;\r\n        params.options = new FileUploadOptions();\r\n        params.options.fileKey = \"file\";\r\n        params.options.fileName = data.fileName;\r\n        params.options.uploadKey = {key: addParams[\"h_xpath\"]};\r\n        params.options.addUrl = self.properties.addUrl;\r\n        params.dataFile = data.dataFile;\r\n\r\n        if (data.mimeType)\r\n            params.options.mimeType = data.mimeType;\r\n\r\n        return $.when(bizagi.util.media.uploadFile(params)).then(function (result) {\r\n            var response = JSON.parse(decodeURIComponent(result.response));\r\n\r\n            if (response.type === \"error\") {\r\n                bizagi.showMessageBox(response.message, response.errorType);\r\n            } else {\r\n                self.onUploadFileCompleted(response);\r\n            }\r\n        }).fail(function (error) {\r\n            self.executeFormFailHandler(error);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * onFail\r\n     * @param {} error\r\n     */\r\n    onFail: function (error) {\r\n        var messageError = bizagi.util.processFailMessage(error);\r\n\r\n        bizagi.loading.stop();\r\n\r\n        if (messageError && typeof (messageError) === \"string\" && messageError.indexOf(\"No Activity found to handle Intent\") !== -1) {\r\n            var hasResource = bizagi.util.isValidResource(\"render-upload-error-media-app\");\r\n            var message = hasResource ? bizagi.localization.getResource(\"render-upload-error-media-app\") : \"Your device does not have an app to execute this action.\";\r\n\r\n            bizagi.showMessageBox(message);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * onUploadFileCompleted\r\n     * @param {} result\r\n     */\r\n    onUploadFileCompleted: function (result) {\r\n        var self = this;\r\n        var $wrapper = $(\".bz-files\", self.getControl());\r\n\r\n        if (result.id && result.fileName) {\r\n            // Locate it before the upload wrapper\r\n            var newItem = self.renderUploadItem(result);\r\n            $wrapper.append(newItem);\r\n\r\n            // Increment counter\r\n            self.filesCount = self.filesCount + 1;\r\n\r\n            // Copy the files value but not its reference\r\n            var files = self.files.slice();\r\n\r\n            //Add the new item to this temporal array\r\n            files.push([result.id, result.fileName]);\r\n\r\n            // Update value\r\n            self.setValue(files, true);\r\n\r\n            // Check maxFiles\r\n            self.checkMaxFiles();\r\n\r\n            self.editedImageURL = null;\r\n        } else {\r\n            bizagi.showMessageBox(result.message, \"Error\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Check maximum number of files\r\n     */\r\n    checkMaxFiles: function () {\r\n        if (this.isMaxFilesReached()) {\r\n            $(this.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        } else {\r\n            $(this.$contentFile).removeClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Check if the maximum number of files than can be uploaded has been reached\r\n     * @returns {}\r\n     */\r\n    isMaxFilesReached: function () {\r\n        var maxFiles = this.properties.maxfiles;\r\n        var actualFiles = this.properties.value ? this.properties.value.length : 0;\r\n\r\n        return maxFiles !== 0 && (this.filesCount >= maxFiles && actualFiles >= maxFiles);\r\n    },\r\n\r\n    /**\r\n     * Check allow extensions and define possible choices\r\n     * @returns {}\r\n     */\r\n    checkFileExtensions: function () {\r\n        var self = this;\r\n        var validExtensions = self.properties.validExtensions || \"\";\r\n\r\n        self.validOptions = {video: false, image: false, file: false};\r\n\r\n        // Preprocess the extensions string\r\n        validExtensions = validExtensions.replace(/\\s+/g, \"\").toLowerCase();\r\n\r\n        if (typeof (validExtensions) === \"undefined\" || validExtensions === \"\") {\r\n            self.validOptions = {video: true, image: true, file: true};\r\n        } else {\r\n            validExtensions = validExtensions.split(\";\");\r\n\r\n            if (validExtensions.length === 1 && validExtensions[0].indexOf(\"*.*\") !== -1) {\r\n                self.validOptions.video = true;\r\n                self.validOptions.image = true;\r\n            } else {\r\n                for (var i = 0, length = validExtensions.length; i < length; i++) {\r\n                    validExtensions[i] = validExtensions[i].replace(\"*.\", \"\");\r\n\r\n                    if (self.Class.EXTENSIONSFILE.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.file = true;\r\n                    } else if (self.Class.EXTENSIONSIMG.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.image = true;\r\n                    } else if (self.Class.EXTENSIONSVIDEO.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.video = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Media is not supported then upload control is disabled\r\n        if (!self.validOptions.file && !self.validOptions.image && !self.validOptions.video) {\r\n            $(self.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n\r\n        // Limit of files is reached then upload control is disabled\r\n        if (self.isMaxFilesReached() || (!self.isNative && (!bizagi.util.media.fileAPISupported() || self.isOfflineForm))) {\r\n            $(this.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Build add params to send to the server\r\n     * @param {} dataFile\r\n     */\r\n    buildAddFileParams: function (dataFile) {\r\n        var self = this;\r\n        var prefix = self.Class.BA_CONTEXT_PARAMETER_PREFIX;\r\n\r\n        // Get form data for POSTing\r\n        var formData = new FormData();\r\n        var form = self.getFormContainer();\r\n\r\n        // Build add params to send to the server\r\n        formData.append(prefix + \"xpath\", self.getUploadXpath());\r\n        formData.append(prefix + \"idRender\", self.properties.id);\r\n        formData.append(prefix + \"xpathContext\", self.properties.xpathContext);\r\n        formData.append(prefix + self.Class.BA_PAGE_CACHE, self.properties.idPageCache);\r\n        formData.append(self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\", form.properties.sessionId);\r\n        formData.append(self.properties.xpath, dataFile);\r\n\r\n        if (self.properties.contexttype)\r\n            formData.append(prefix + \"contexttype\", self.properties.contexttype);\r\n\r\n        try {\r\n            if (typeof (BIZAGI_SESSION_NAME) !== \"undefined\") {\r\n                formData.append(BIZAGI_SESSION_NAME, form.properties.sessionId);\r\n            } else {\r\n                formData.append(\"JSESSIONID\", form.properties.sessionId);\r\n            }\r\n        } catch (e) {\r\n            formData.append(\"JSESSIONID\", form.properties.sessionId);\r\n        }\r\n\r\n        return formData;\r\n    },\r\n\r\n    /**\r\n     * Process an upload file into the server\r\n     * @param {} dataFile\r\n     * @returns {}\r\n     */\r\n    processUploadFile: function (dataFile) {\r\n        var data = {\r\n            url: this.properties.addUrl,\r\n            formData: this.buildAddFileParams(dataFile)\r\n        };\r\n\r\n        return this.dataService.processUploadFile(data);\r\n    },\r\n\r\n    /**\r\n     * Remove data of file upload\r\n     */\r\n    clearDisplayValue: function () {\r\n        var self = this;\r\n        var items = $(\".bz-files\", self.getControl());\r\n\r\n        $(\".bz-file\", items).each(function (index, item) {\r\n            item = $(item);\r\n            var file = item.data();\r\n\r\n            self.removeFile(item, file.id);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Add upload options\r\n     */\r\n    getUploadChoices: function () {\r\n        var self = this;\r\n        var itemsUpload = [];\r\n\r\n        // Take photo, Choose photo\r\n        if (self.validOptions.image) {\r\n            itemsUpload.push({\r\n                \"guid\": 1,\r\n                \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-take-photo\")\r\n            });\r\n            itemsUpload.push({\r\n                \"guid\": 2,\r\n                \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-choose-photo\")\r\n            });\r\n        }\r\n\r\n        // Take video\r\n        if (self.validOptions.video) {\r\n            itemsUpload.push({\r\n                \"guid\": 3,\r\n                \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-take-video\")\r\n            });\r\n        }\r\n        \r\n        // Stores the upload options        \r\n        return [].concat(itemsUpload);\r\n    },\r\n\r\n    /**\r\n     * Call the form failhandler with an specific error\r\n     * @param {} error\r\n     * @returns {}\r\n     */\r\n    executeFormFailHandler: function (error) {\r\n        var errorResponse = \"\";\r\n\r\n        if (error && error.responseText) {\r\n            errorResponse = error.responseText;\r\n        } else {\r\n            errorResponse = bizagi.localization.getResource(\"workportal-general-error\");\r\n        }\r\n\r\n        this.getFormContainer().failHandler(errorResponse);\r\n    },\r\n\r\n    /**\r\n     * Method to add new file from native or hybrid environment\r\n     */\r\n    chooseFile: function () {\r\n        if (this.isNative) {\r\n            this.$nativeFile.click();\r\n        } else if (bizagi.util.media.fileAPISupported() && !this.isOfflineForm) {\r\n            this.$inputFile.click();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to add new file\r\n     */\r\n    addFile: function () {\r\n        var self = this;\r\n        var dataFile = this.$inputFile[0].files[0];\r\n        var extensions = self.Class.EXTENSIONSIMG.concat(self.Class.EXTENSIONSFILE, self.Class.EXTENSIONSVIDEO);\r\n\r\n        dataFile.fullPath = this.$inputFile[0].value;\r\n        bizagi.loading.start();\r\n\r\n        if (bizagi.util.media.checkMaxSizeFile(dataFile, self.properties) && bizagi.util.media.checkFileTypes(dataFile, self.properties, extensions)) {\r\n\r\n            $.when(self.processUploadFile(dataFile))\r\n                .then(function (result) {\r\n                    self.onUploadFileCompleted(JSON.parse(decodeURIComponent(result)));\r\n                }).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        } else {\r\n            bizagi.loading.stop();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to remove item\r\n     * @param item\r\n     * @param id\r\n     */\r\n    removeFile: function (item, id) {\r\n        var self = this;\r\n\r\n        $.when(self.deleteUploadItem(item, id)).done(function () {\r\n            // Remove item\r\n            item.hide();\r\n            item.remove();\r\n\r\n            // Update value\r\n            self.setValue(self.files, false);\r\n\r\n            // Check maxFiles\r\n            self.checkMaxFiles();\r\n\r\n            // Trigger change\r\n            self.triggerRenderChange();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Template for upload items\r\n     */\r\n    getTemplateItemName: function () {\r\n        return \"upload-item\";\r\n    },\r\n\r\n    getElementsToStylize: function(context){\r\n        return $(\".bz-input-icon__input\", context);\r\n    }\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphone Render upload Extension\r\n *   Author: Mobile SWAT Team\r\n */\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.upload.extend(\"bizagi.rendering.smartphone.upload.offline\", {\r\n    QUALITY_PICTURE: 50,\r\n    LIMIT: 1, // The maximum number of media in the device user can record in a single capture operation.\r\n    EXTENSIONSIMG: [\"image/jpeg\", \"jpeg\", \"image\", \"png\", \"jpg\", \"bmp\"],\r\n    EXTENSIONSFILE: [\"doc\", \"docx\", \"xls\", \"xlsx\", \"ppt\", \"pptx\", \"pdf\", \"zip\", \"rar\", \"txt\"],\r\n    EXTENSIONSVIDEO: [\"video/quicktime\", \"quicktime\", \"qt\", \"mov\"],\r\n    EXTENSIONSAUDIO: [\"audio/wav\", \"audio\", \"wav\", \"mp3\"]\r\n}, {\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param {} data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        var self = this;\r\n        this._super(data);\r\n\r\n        var maxFileSizeOfProperty = Number(this.properties.maxSize) || 1048576;\r\n        var maxFileSizeOfUser = typeof (BIZAGI_SETTINGS) !== \"undefined\" && typeof (BIZAGI_SETTINGS.UploadMaxFileSize) !== \"undefined\" ? Number(BIZAGI_SETTINGS.UploadMaxFileSize) : 1048576;\r\n\r\n        this.properties.maxSize = maxFileSizeOfProperty < maxFileSizeOfUser ? maxFileSizeOfProperty : maxFileSizeOfUser;\r\n\r\n        this.updateFilesCount();\r\n    },\r\n    /**\r\n     * Method to render items\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderItem: function (template, data) {\r\n        var self = this;\r\n        var items = \"\";\r\n\r\n        // Render template\r\n        var html = $.fasttmpl(template, data);\r\n\r\n        // Render current children\r\n        for (var i = 0; i < self.files.length; i++) {\r\n            var file = self.files[i];\r\n            if(file.status && file.status !== \"deleted\" && file.status !== \"new-deleted\"){\r\n                var item = self.renderUploadItem(file, i);\r\n                items += item;\r\n            }\r\n        }\r\n\r\n        html = self.replaceFilesHtml(html, items);\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Method to customize the render's behaviour to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // Handler to download the file\r\n        $(\"ul.bz-files\", $control).on(\"click\", \".bz-file .bz-file-name\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            self.openOfflineFile(item);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Method to configure the actions with control\r\n     * @return {}\r\n     */\r\n    attachEvents: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // Attach all events\r\n        this.$contentFile.off(\"click\").on(\"click\", function (evt) {\r\n            if(self.isNative)\r\n                self.$nativeFile.click();\r\n            else\r\n                self.$inputFile.click();\r\n                self.$inputFile.off(\"change\").on(\"change\", function(){\r\n                    self.handlerWebUploadFile();\r\n                });\r\n        });\r\n\r\n        // Handler to download the file\r\n        $(\"ul.bz-files\", $control).on(\"click\", \".bz-file .bz-file-name\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            self.openOfflineFile(item);\r\n        });\r\n\r\n        // Attach delete option & Removes a file from the upload control\r\n        $(\"ul.bz-files\", $control).on(\"click\", \".bz-file .bz-icn\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            self.removeOfflineFile(item);\r\n        });\r\n\r\n        if (self.isNative) {\r\n            // Upload files\r\n            this.$nativeFile.off(\"click\").actionSheet({\r\n                actions: self.getUploadChoices(),\r\n                actionClicked: function (action) {\r\n                    // this.getBoundingClientRect()\r\n                    self.handlerUploadFile(action.guid);\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    //Only should be used for testing purposes\r\n    handlerWebUploadFile: function(){\r\n        var self = this;\r\n        var dataFile = self.$inputFile[0].files[0];\r\n        \r\n        var fileId = bizagi.util.randomNumber();\r\n        var fileName, mimeType;\r\n        \r\n        $.when(self.getBlobFromPath(dataFile))\r\n        .then( function(blob){            \r\n            bizagi.loading.start();\r\n            mimeType = blob.type;\r\n            fileName = blob.name;\r\n            return self.saveOfflineFile(blob, fileId, mimeType);\r\n        }).then( function(saveResponse){\r\n            self.onUploadOfflineFileCompleted(fileName, mimeType, fileId);\r\n        }).always( function(){\r\n            bizagi.loading.stop();\r\n        })\r\n        self.$inputFile[0].value = \"\";\r\n    },\r\n\r\n    /**\r\n     * Handler of upload image\r\n     * @param {} ordinal\r\n     * @returns {}\r\n     */\r\n    handlerUploadFile: function (ordinal) {\r\n        var self = this;\r\n        var actionSelected = ordinal || 0;\r\n        switch (actionSelected) {\r\n            case 2:\r\n                navigator.camera.getPicture(function (dataImage) {\r\n                    self.dataImage = dataImage;\r\n                    var extensions = self.Class.EXTENSIONSIMG.concat(self.Class.EXTENSIONSVIDEO);\r\n\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties))\r\n                        .then(function () {\r\n                            //Gets the real properties for the file\r\n                            return $.when(bizagi.util.media.getFileDataInfo(self.dataImage))\r\n                                .then(function (fileData) {\r\n                                    self.fileProperties = fileData;\r\n                                    if (bizagi.util.media.checkFileTypes(fileData, self.properties, extensions)) {\r\n                                        return self.saveImage(self.dataImage);\r\n                                    }\r\n                                });\r\n                        }).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n\r\n                }, self.onFail.bind(self), {\r\n                    quality: self.Class.QUALITY_PICTURE,\r\n                    sourceType: Camera.PictureSourceType.PHOTOLIBRARY,\r\n                    correctOrientation: true\r\n                });\r\n                break;\r\n            case 1:\r\n                navigator.camera.getPicture(function (dataImage) {\r\n                        bizagi.loading.start();\r\n\r\n                        $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties)).then(function () {\r\n                            return $.when(bizagi.util.media.getFileDataInfo(dataImage)).then(function (fileData) {\r\n                                self.fileProperties = fileData;\r\n                                return self.saveImage(dataImage);\r\n                            });\r\n                        }).always(function () {\r\n                            bizagi.loading.stop();\r\n                        });\r\n                    },\r\n                    self.onFail.bind(self), {\r\n                        quality: self.Class.QUALITY_PICTURE,\r\n                        sourceType: navigator.camera.PictureSourceType.CAMERA,\r\n                        mediaType: navigator.camera.MediaType.PICTURE,\r\n                        destinationType: Camera.DestinationType.FILE_URI,\r\n                        correctOrientation: true,\r\n                        targetWidth: 1280,\r\n                        targetHeight: 960\r\n                    });\r\n                break;\r\n            default:\r\n                console.log(\"The option is not supported!\")\r\n                break;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Add the interactions to the upload control items\r\n     * @return {}\r\n     */\r\n    addInteractions: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        // Attach delete option & Removes a file from the upload control\r\n        $(\"ul.bz-files\", control).on(\"click\", \".bz-file .bz-file__delete\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            self.removeOfflineFile(item);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Collect Data\r\n     * @param {} renderValues\r\n     * @returns {}\r\n     */\r\n    collectData: function (renderValues) {\r\n        var self = this;\r\n        if (self.properties.originalValue === self.files) {\r\n            return;\r\n        }\r\n        if (self.filesCount > 0) {\r\n            renderValues[self.properties.xpath] = self.files;\r\n        } else if (self.properties.method === \"delete\") {\r\n            renderValues[self.properties.xpath] = [];\r\n\r\n            delete self.properties.method;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Send image using HTTP\r\n     * @param {} dataImage\r\n     */\r\n    saveImage: function (dataImage) {\r\n        var self = this;\r\n        bizagi.loading.start();\r\n\r\n        var fileId = bizagi.util.randomNumber();\r\n        var fileName = self.fileProperties.name\r\n        var mimeType;\r\n\r\n        //TODO: SWAT Check if the file already exists\r\n        $.when(self.getBlobFromPath(dataImage))\r\n        .always( function(){\r\n            bizagi.loading.stop();\r\n        })\r\n        .then( function(blob){\r\n            mimeType = blob.type;\r\n            fileName = blob.name;\r\n            return self.saveOfflineFile(blob, fileId, mimeType);\r\n        }).then( function(saveResponse){            \r\n            self.onUploadOfflineFileCompleted(fileName, mimeType, fileId);            \r\n        });\r\n        self.$inputFile[0].value = \"\";\r\n    },\r\n\r\n    /**\r\n     * Check allow extensions and define possible choices\r\n     * Only support to image in offline capability\r\n     * @returns {}\r\n     */\r\n    checkFileExtensions: function () {\r\n        var self = this;\r\n        var validExtensions = self.properties.validExtensions || \"\";\r\n\r\n        self.validOptions = {video: false, image: false, file: false};\r\n\r\n        // Preprocess the extensions string\r\n        validExtensions = validExtensions.replace(/\\s+/g, \"\").toLowerCase();\r\n\r\n        if (typeof (validExtensions) === \"undefined\" || validExtensions === \"\") {\r\n            self.validOptions.image = true;\r\n        } else {\r\n            validExtensions = validExtensions.split(\";\");\r\n\r\n            if (validExtensions.length === 1 && validExtensions[0].indexOf(\"*.*\") !== -1) {\r\n                self.validOptions.image = true;\r\n            } else {\r\n                for (var i = 0, length = validExtensions.length; i < length; i++) {\r\n                    validExtensions[i] = validExtensions[i].replace(\"*.\", \"\");\r\n\r\n                    if (self.Class.EXTENSIONSIMG.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.image = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Media is not supported then upload control is disabled\r\n        if (!self.validOptions.image) {\r\n            $(self.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n\r\n        // Limit of files is reached then upload control is disabled\r\n        if (self.isMaxFilesReached() || !bizagi.util.media.fileAPISupported() ) {\r\n            $(this.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * onUploadOfflineFileCompleted\r\n     * @param {} result\r\n     */\r\n    onUploadOfflineFileCompleted: function (fileName, mimeType, fileId) {\r\n        var self = this;\r\n        var $wrapper = $(\".bz-files\", self.getControl());\r\n\r\n        var fileUploaded = {\r\n            id: fileId,\r\n            fileName: fileName,\r\n            mimeType: mimeType,\r\n            status: \"new\"\r\n        };\r\n\r\n        // Locate it before the upload wrapper\r\n        var newItem = self.renderUploadItem(fileUploaded, self.files.length);\r\n        $wrapper.append(newItem);\r\n\r\n        // Increment counter\r\n        self.filesCount = self.filesCount + 1;\r\n\r\n        // Copy the files value but not its reference\r\n        var files = self.files.slice();\r\n\r\n        //Add the new item to this temporal array\r\n        files.push(fileUploaded);\r\n\r\n        // Update value\r\n        self.setValue(files, false);\r\n\r\n        // Check maxFiles\r\n        self.checkMaxFiles(); \r\n    },\r\n\r\n    /**\r\n     * Renders a single upload item\r\n     * @param file\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderUploadItem: function (file, index) {\r\n        var self = this;\r\n        var itemTemplate = self.getTemplateItemName();\r\n        var template = self.renderFactory.getTemplate(itemTemplate);\r\n\r\n        var html = $.fasttmpl(template, {\r\n            url: \"javascript:void(0);\",\r\n            id: file.id,\r\n            allowDelete: self.properties.allowDelete || false,\r\n            filename: file.fileName,\r\n            index: index\r\n        });\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * This render cannot be sent because it is full ajax\r\n     * @returns {}\r\n     */\r\n    canBeSent: function () {\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * Fail action\r\n     * @param {} evt\r\n     * @returns {}\r\n     */\r\n    failReadFile: function (evt) {\r\n        try {\r\n            bizagi.log(\"Error code: \" + evt.target.error.code);\r\n        } catch (e) {\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Fail action\r\n     * @param {} error\r\n     * @returns {}\r\n     */\r\n    onFail: function (error) {\r\n        this._super(error);\r\n    },\r\n\r\n    /**\r\n     * Method to remove item\r\n     * @param item\r\n     * @param id\r\n     */\r\n    removeOfflineFile: function (item) {\r\n        var self = this;\r\n        var file = item.data();\r\n        var fileIndex = file.index;\r\n\r\n\r\n\r\n        // Mark the file as deleted\r\n        var fileValue = self.files[fileIndex];\r\n        if( !fileValue){\r\n            //Nothing to do\r\n            return;\r\n        }\r\n        if(fileValue.status !== \"new\"){\r\n            fileValue.status = \"deleted\";\r\n        }\r\n        else {\r\n            fileValue.status = \"new-deleted\";\r\n        }\r\n        \r\n\r\n        // Remove item\r\n        item.hide();\r\n        item.remove();\r\n\r\n        // Update value\r\n        self.setValue(self.files, false);\r\n\r\n        // Check maxFiles\r\n        self.checkMaxFiles();\r\n\r\n        // Trigger change\r\n        self.triggerRenderChange();\r\n    },\r\n    /**\r\n     * Update the filesCount attribute based on the status (new|deleted) of each file\r\n     */\r\n    updateFilesCount: function(){\r\n        var self = this;\r\n        var files = this.properties.value;\r\n        for(var i=0; i < files.length; i++){\r\n            var status = files[i].status;\r\n            if( status && status.includes(\"deleted\") ) {\r\n                self.filesCount= self.filesCount - 1;\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * Sets the internal value\r\n     * @param value\r\n     * @param triggerEvents\r\n     */\r\n    setValue: function (value, triggerEvents) {\r\n        var self = this;\r\n        self._super(value, triggerEvents);\r\n        self.updateFilesCount();\r\n        if (self.filesCount === 0) {\r\n            self.properties.method = \"delete\";\r\n        }\r\n    },\r\n    /**\r\n     * Check if the maximum number of files than can be uploaded has been reached\r\n     * @returns {}\r\n     */\r\n    isMaxFilesReached: function () {\r\n        var maxFiles = this.properties.maxfiles;\r\n        return maxFiles !== 0 && (this.filesCount >= maxFiles);\r\n    },\r\n\r\n    openOfflineFile: function(item) {\r\n        var self = this;\r\n        var file = item.data();\r\n        var dataIndex = file.index;\r\n        var selectedValue = typeof (dataIndex) == \"number\" ? self.properties.value[dataIndex] : null;\r\n        if (selectedValue) {\r\n            var formParams = self.getFormParams();\r\n            var getFileParams = {\r\n                idCase: formParams.idCase,\r\n                idWorkitem: formParams.idWorkitem,\r\n                id: self.properties.xpath + '.' + selectedValue.id,\r\n                offlineType: formParams.offlineType\r\n            }\r\n            bizagi.loading.start();\r\n            $.when(self.dataService.getOfflineFile( getFileParams, \"blob\", selectedValue.mimeType))\r\n            .done( function(binaryFile){\r\n                var fileName = file.title;\r\n                bizagi.util.media.handleBinaryFile( binaryFile, fileName);\r\n            })\r\n            .fail( function(error){\r\n                console.log(\"Error opening offline file\", error);\r\n            })\r\n            .always( function() {\r\n                bizagi.loading.stop();\r\n            });\r\n        }\r\n    },\r\n\r\n    getBlobFromPath: function(path){\r\n        var blobPromise = new $.Deferred();\r\n        var self = this;\r\n\r\n        if(self.isNative){\r\n            var fileName = self.fileProperties.name;            \r\n            if (!bizagi.util.isAndroidDevice()) {\r\n                path = bizagi.util.media.normalizeIOSFilePath(path);\r\n            }\r\n            else{\r\n                // Fix android 4.4 getting images from recent folder\r\n                path = bizagi.util.media.getImagePath(path);\r\n            }\r\n            \r\n            var errorHandler = function (error) {\r\n                console.log('Error converting path to blob', error);  \r\n                blobPromise.reject(error);\r\n            };\r\n    \r\n            window.resolveLocalFileSystemURL(path, function (fileEntry) {\r\n                fileEntry.file(function (file) {    \r\n                    var reader = new FileReader();\r\n                    reader.onloadend = function () {\r\n                        var blob = new Blob([this.result], {type: file.type});\r\n                        blob.name = fileName;\r\n                        blobPromise.resolve(blob);\r\n                    }\r\n                    reader.readAsArrayBuffer(file);\r\n                }, errorHandler);\r\n            }, errorHandler);\r\n        }\r\n        else {\r\n            //In browser is the File\r\n            blobPromise.resolve(path);\r\n        }\r\n        return blobPromise;\r\n    },\r\n\r\n    saveOfflineFile: function(blobFile, fileId, mimeType){\r\n        var self = this;\r\n        var formParams = self.getFormParams();\r\n        var parameters = {\r\n            idCase: formParams.idCase,\r\n            idWorkitem: formParams.idWorkitem,\r\n            id: self.properties.xpath + '.' + fileId,\r\n            operationType: \"edition\",\r\n            offlineType: formParams.offlineType\r\n        }        \r\n        return self.dataService.saveOfflineFile(parameters, blobFile, mimeType);\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render ECM Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the ecm render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.ecm\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,\r\n    BA_CONTEXT_PARAMETER_PREFIX: bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,\r\n    BA_PAGE_CACHE: bizagi.render.services.service.BA_PAGE_CACHE\r\n}, bizagi.rendering.ecm.prototype);\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.ecm.extend(\"bizagi.rendering.smartphone.ecm\", {\r\n    QUALITY_PICTURE: 50,\r\n    LIMIT: 1, // The maximum number of media in the device user can record in a single capture operation.\r\n    EXTENSIONSIMG: [\"image/jpeg\", \"jpeg\", \"image\", \"png\", \"jpg\", \"bmp\"],\r\n    EXTENSIONSFILE: [\"doc\", \"docx\", \"xls\", \"xlsx\", \"ppt\", \"pptx\", \"pdf\", \"zip\", \"rar\", \"txt\"],\r\n    EXTENSIONSVIDEO: [\"video/quicktime\", \"quicktime\", \"qt\", \"mov\"],\r\n    EXTENSIONSAUDIO: [\"audio/wav\", \"audio\", \"wav\", \"mp3\"],\r\n    ERROR_ECM_NO_AVAILABLE: 3,\r\n    ACTION_DETAILS: \"details\",\r\n    ACTION_EDIT: \"edit\"\r\n}, {\r\n\r\n    /**\r\n     * Whether or not is a native device\r\n     * @var isNative boolean\r\n     */\r\n    isNative: false,\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param {} data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n\r\n        this.isNative = bizagi.util.isCordovaSupported();\r\n        this.fileData = [];\r\n    },\r\n\r\n    /**\r\n     * Method to customize each control\r\n     * @returns {}\r\n     */\r\n    renderControl: function () {\r\n        var self = this;\r\n        var template = this.renderFactory.getTemplate(\"ecm\");\r\n\r\n        // Set files property\r\n        self.files = self.properties.value || [];\r\n        self.filesCount = self.files.length;\r\n\r\n        return this.renderItem(template, {});\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"ecm-readonly\");\r\n        var data = {\r\n            noFiles: this.filesCount === 0\r\n        };\r\n\r\n        return this.renderItem(template, data);\r\n    },\r\n\r\n    /**\r\n     * Method to render items\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderItem: function (template, data) {\r\n        var self = this;\r\n        var items = \"\";\r\n        var html = $.fasttmpl(template, data);\r\n\r\n        // Render current children\r\n        for (var i = 0; i < self.filesCount; i++) {\r\n            var item = self.renderUploadItem(self.files[i]);\r\n\r\n            items += item;\r\n        }\r\n\r\n        html = self.replaceFilesHtml(html, items);\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Renders a single upload item\r\n     * @param file\r\n     * @returns {*}\r\n     */\r\n    renderUploadItem: function (file) {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"ecm-item\");\r\n        var form = self.getFormContainer();\r\n\r\n        var data = {\r\n            id: self.properties.id,\r\n            idFileUpload: file[0],\r\n            fileName: file[1],\r\n            editable: self.properties.editable,\r\n            xPath: self.properties.xpath,\r\n            xpathContext: self.getXpathContext() || form.properties.xpathContext || \"\",\r\n            idPageCache: self.properties.idPageCache,\r\n            idAttrib: self.properties.idAttrib,\r\n            sessionId: form.properties.sessionId\r\n        };\r\n\r\n        // Builds the upload item url\r\n        var originalData = $.extend({}, data);\r\n        data.url = self.buildItemUrl(originalData);\r\n\r\n        // Define File Properties\r\n        file.getFileProperties = $.when(self.renderFileLayout(data));\r\n\r\n        var html = $.fasttmpl(template, data);\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Method to get properties and metadata of ECM item\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    renderFileLayout: function (data) {\r\n        var self = this;\r\n        var form = self.getFormContainer();\r\n        var deferred = new $.Deferred();\r\n\r\n        var originalData = $.extend({}, data);\r\n\r\n        $.when(\r\n            self.dataService.metadataECMMultiaction().getECMMetadata(data),\r\n            self.dataService.metadataECMMultiaction().getFileProperties(originalData)\r\n        ).done(function (metaData, fileProperties) {\r\n\r\n            if (Array.isArray(fileProperties)) {\r\n                fileProperties = fileProperties[0];\r\n            }\r\n\r\n            if (Array.isArray(metaData)) {\r\n                metaData = metaData[0];\r\n            }\r\n\r\n            fileProperties.idAttrib = self.properties.idAttrib;\r\n            fileProperties.showMetadata = self.properties.showMetadata;\r\n            fileProperties.xpathContext = self.getXpathContext() || form.properties.xpathContext || \"\";\r\n            fileProperties.xpath = self.properties.xpath;\r\n            fileProperties.fileName = data.fileName;\r\n            fileProperties.idPageCache = self.properties.idPageCache;\r\n            fileProperties.fileData = originalData;\r\n\r\n            var result = $.extend({}, fileProperties, metaData);\r\n\r\n            deferred.resolve(result);\r\n\r\n        });\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    /**\r\n     * Replaces a {{files}} tag in the container for the specified \"replace\" element\r\n     * @param html\r\n     * @param replace\r\n     * @returns {*}\r\n     */\r\n    replaceFilesHtml: function (html, replace) {\r\n        return html.replace(\"{{files}}\", replace);\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n\r\n        this.$contentFile = $(\".bz-file-upload__container\", $control);\r\n        this.$inputFile = $(\".bz-file-upload__input\", $control);\r\n        this.$nativeFile = $(\".bz-file-upload__native\", $control);        \r\n    },\r\n\r\n    configureHandlers: function () {\r\n        this.checkFileExtensions();\r\n        this.attachEvents();\r\n    },\r\n\r\n    /**\r\n     * Method to customize the render's behaviour to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // Handler to download the file\r\n        $(\"ul.bz-readonly-lists\", $control).on(\"click\", \".bz-file .bz-file-name\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            var file = item.data();\r\n\r\n            bizagi.loading.start();\r\n\r\n            $.when(bizagi.util.media.downloadFile(file.url, file.title)).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Send image using HTTP\r\n     */\r\n    saveImage: function () {\r\n        var self = this;\r\n        var dataItem = \"\";\r\n\r\n        if (self.editedImageURL) {\r\n            dataItem = self.editedImageURL;\r\n        } else if (self.fileProperties) {\r\n            dataItem = self.fileProperties.url;\r\n        }\r\n\r\n        // Fix android 4.4 getting images from recent folder\r\n        var dataFile = bizagi.util.media.getImagePath(dataItem);\r\n        var data = {\r\n            dataFile: dataFile,\r\n            fileName: self.fileProperties.name,\r\n            mimeType: \"image/jpeg\"\r\n        };\r\n\r\n        // Cleans variables related previous uploads\r\n        self.editedImageURL = null;\r\n        self.fileProperties = null;\r\n\r\n        return this.uploadFile(data);\r\n    },\r\n\r\n    /**\r\n     * Method to save a video file\r\n     * @param {} dataVideo\r\n     * @returns {}\r\n     */\r\n    saveVideo: function (dataVideo) {\r\n        var data = {\r\n            dataFile: dataVideo[0].fullPath,\r\n            fileName: dataVideo[0].name,\r\n            mimeType: \"video/quicktime\"\r\n        };\r\n\r\n        return this.uploadFile(data);\r\n    },\r\n\r\n    /**\r\n     * Method to save a file\r\n     * @param data\r\n     * @returns {*|void}\r\n     */\r\n    uploadFile: function (data) {\r\n        var self = this;\r\n        var params = {};\r\n        var addParams = self.buildAddParams();\r\n\r\n        addParams.queueID = \"q_\" + bizagi.util.encodeXpath(self.getUploadXpath());\r\n        addParams[\"xPath\"] = addParams[\"xPath\"];\r\n        addParams.Filename = data.fileName;\r\n\r\n        params.data = addParams;\r\n        params.options = new FileUploadOptions();\r\n        params.options.fileKey = \"file\";\r\n        params.options.fileName = data.fileName;\r\n        params.options.uploadKey = {key: \"Filedata\"};\r\n        params.options.addUrl = self.properties.addUrl;\r\n        params.dataFile = data.dataFile;\r\n\r\n        if (data.mimeType)\r\n            params.options.mimeType = data.mimeType;\r\n\r\n        return $.when(bizagi.util.media.uploadFile(params)).then(function (result) {\r\n            self.onUploadFileCompleted(JSON.parse(decodeURIComponent(result.response)));\r\n        }).fail(function (error) {\r\n            self.executeFormFailHandler(error);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Method to configure the actions with control\r\n     * @return {}\r\n     */\r\n    attachEvents: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // Handlers to management of menu actions\r\n        $.each(self.files, function (i, file) {\r\n            self.attackMenuEvents(file);\r\n        });\r\n\r\n        // Attach all events\r\n        this.$contentFile.off(\"click\").on(\"click\", function (evt) {\r\n            self.chooseFile();\r\n        });\r\n\r\n        // Handler to download the file\r\n        $(\"ul.bz-files\", $control).on(\"click\", \".bz-file .bz-file-name\", function () {\r\n            var item = $(this).parent(\".bz-file\");\r\n            var file = item.data();\r\n\r\n            bizagi.loading.start();\r\n\r\n            $.when(bizagi.util.media.downloadFile(file.url, file.title)).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        });\r\n\r\n\r\n        if (self.isNative) {\r\n            // Upload files\r\n            this.$nativeFile.off(\"click\").actionSheet({\r\n                actions: self.getUploadChoices(),\r\n                actionClicked: function (action) {\r\n                    self.handlerUploadFile(action.guid);\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n\r\n            // Resolution upload\r\n            $(\".bz-file-upload__resolution\", $control).off(\"click\").actionSheet({\r\n                actions: bizagi.util.media.getImageResolutionSizes(),\r\n                withoutCancel: true,\r\n                actionClicked: function (action) {\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(self.handlerResolutionUpload(action.guid)).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n        } else {\r\n\r\n            // Attach event to web upload-control\r\n            this.$inputFile.off(\"change\").on(\"change\", function () {\r\n                self.addFile();\r\n                this.value = \"\";\r\n            });\r\n\r\n            // Just in case\r\n            this.$inputFile.off(\"click\").on(\"click\", function (evt) {\r\n                evt.stopPropagation();\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Update menu options\r\n     * @param $fileItem\r\n     * @param fileProperties\r\n     */\r\n    addMenuEvents: function ($fileItem, fileProperties) {\r\n        var self = this;\r\n        var viewMore = $fileItem.find(\".bz-file-menu\");\r\n        var items = [];\r\n\r\n        if (fileProperties.showMetadata) {\r\n            items.push({\r\n                name: self.getResource(\"render-collection-navigator-details-form\"),\r\n                fn: function () {\r\n                    self.processActionByType(self.Class.ACTION_DETAILS, fileProperties, $fileItem);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (fileProperties.showMetadata && fileProperties.allowUpdateMetadata)\r\n            items.push({\r\n                name: self.getResource(\"render-collection-navigator-edit-form\"),\r\n                fn: function () {\r\n                    self.processActionByType(self.Class.ACTION_EDIT, fileProperties, $fileItem);\r\n                }\r\n            });\r\n\r\n        if (fileProperties.allowCheckOut) {\r\n            items.push({\r\n                name: self.getResource(\"render-ecm-bt-lock\"),\r\n                fn: function () {\r\n                    self.lockECMFile($fileItem, fileProperties);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (fileProperties.allowCancelCheckOut) {\r\n            items.push({\r\n                name: self.getResource(\"render-ecm-bt-unlock\"),\r\n                fn: function () {\r\n                    self.unlockECMFile($fileItem, fileProperties);\r\n                }\r\n            });\r\n        }\r\n\r\n        /*if (fileProperties.allowUpdateContent) {\r\n            items.push({\r\n                name: self.getResource(\"render-ecm-bt-upgrade\"),\r\n                fn: function () {\r\n                    self.processActionByType(\"upgrade\", fileProperties);\r\n                }\r\n            });\r\n        }*/\r\n\r\n        if (fileProperties.allowDelete) {\r\n            items.push({\r\n                name: self.getResource(\"render-ecm-bt-delete\"),\r\n                fn: function () {\r\n                    self.deleteECMFile($fileItem, fileProperties.idFileUpload);\r\n                }\r\n            });\r\n        }\r\n\r\n        // TODO: Check items has data\r\n        viewMore.overflowMenu({items: items});\r\n    },\r\n\r\n    /**\r\n     * Removes a file from the ECM control\r\n     * @param $fileItem\r\n     * @param fileId\r\n     */\r\n    deleteECMFile: function ($fileItem, fileId) {\r\n        var self = this;\r\n\r\n        bizagi.showConfirmationBox(this.getResource(\"render-ecm-confirm-message\"))\r\n            .done(function () {\r\n                $.when(self.deleteUploadItem($fileItem, fileId))\r\n                    .done(function () {\r\n                        // Detach item\r\n                        $fileItem.hide();\r\n                        $fileItem.remove();\r\n\r\n                        // Update value\r\n                        self.setValue(self.files, false);\r\n\r\n                        // Check maxFiles\r\n                        self.checkMaxFiles();\r\n\r\n                        // Trigger change\r\n                        self.triggerRenderChange();\r\n                    });\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Check maximum number of files\r\n     */\r\n    checkMaxFiles: function () {\r\n        if (this.isMaxFilesReached()) {\r\n            $(this.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        } else {\r\n            $(this.$contentFile).removeClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Check if the maximum number of files than can be uploaded has been reached\r\n     * @returns {}\r\n     */\r\n    isMaxFilesReached: function () {\r\n        var maxFiles = this.properties.maxfiles;\r\n        var actualFiles = this.properties.value ? this.properties.value.length : 0;\r\n\r\n        return maxFiles !== 0 && (this.filesCount >= maxFiles && actualFiles >= maxFiles);\r\n    },\r\n\r\n    /**\r\n     * Call the form failhandler with an specific error\r\n     * @param {} error\r\n     * @returns {}\r\n     */\r\n    executeFormFailHandler: function (error) {\r\n        var errorResponse = \"\";\r\n\r\n        if (error && error.code === this.Class.ERROR_ECM_NO_AVAILABLE) {\r\n            errorResponse = this.getResource(\"render-ecm-service-not-available\");\r\n        } else if (error && error.responseText) {\r\n            errorResponse = error.responseText;\r\n        } else {\r\n            errorResponse = this.getResource(\"render-ecm-service-general-error\");\r\n        }\r\n\r\n        this.getFormContainer().failHandler(errorResponse);\r\n    },\r\n\r\n    lockECMFile: function ($fileItem, fileProperties) {\r\n        var self = this;\r\n\r\n        $.when(self.lockUploadItem(fileProperties.idFileUpload)).done(\r\n            function (result) {\r\n                var file = [result.idFileUpload, fileProperties.fileName];\r\n                var newItem = self.renderUploadItem(file);\r\n\r\n                $fileItem.replaceWith(newItem);\r\n                self.attackMenuEvents(file);\r\n            });\r\n    },\r\n\r\n    unlockECMFile: function ($fileItem, fileProperties) {\r\n        var self = this;\r\n\r\n        $.when(self.unlockUploadItem(fileProperties.idFileUpload))\r\n            .done(function (result) {\r\n                var file = [result.idFileUpload, fileProperties.fileName];\r\n                var newItem = self.renderUploadItem(file);\r\n\r\n                $fileItem.replaceWith(newItem);\r\n                self.attackMenuEvents(file);\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Method to add new file from native or hybrid environment\r\n     */\r\n    chooseFile: function () {\r\n        if (this.isNative) {\r\n            this.$nativeFile.click();\r\n        } else if (bizagi.util.media.fileAPISupported()) {\r\n            this.$inputFile.click();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Check allow extensions and define possible choices\r\n     * @returns {}\r\n     */\r\n    checkFileExtensions: function () {\r\n        var self = this;\r\n        var validExtensions = self.properties.validExtensions || \"\";\r\n\r\n        self.validOptions = {video: false, image: false, file: false};\r\n\r\n        // Preprocess the extensions string\r\n        validExtensions = validExtensions.replace(/\\s+/g, \"\").toLowerCase();\r\n\r\n        if (typeof (validExtensions) === \"undefined\" || validExtensions === \"\") {\r\n            self.validOptions = {video: true, image: true, file: true};\r\n        } else {\r\n            validExtensions = validExtensions.split(\";\");\r\n\r\n            if (validExtensions.length === 1 && validExtensions[0].indexOf(\"*.*\") !== -1) {\r\n                self.validOptions.video = true;\r\n                self.validOptions.image = true;\r\n            } else {\r\n                for (var i = 0, length = validExtensions.length; i < length; i++) {\r\n                    validExtensions[i] = validExtensions[i].replace(\"*.\", \"\");\r\n\r\n                    if (self.Class.EXTENSIONSFILE.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.file = true;\r\n                    } else if (self.Class.EXTENSIONSIMG.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.image = true;\r\n                    } else if (self.Class.EXTENSIONSVIDEO.toString().indexOf(validExtensions[i]) >= 0) {\r\n                        self.validOptions.video = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Media is not supported then upload control is disabled\r\n        if (!self.validOptions.file && !self.validOptions.image && !self.validOptions.video) {\r\n            $(self.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n\r\n        // Limit of files is reached then upload control is disabled\r\n        if (self.isMaxFilesReached() || (!self.isNative && !bizagi.util.media.fileAPISupported())) {\r\n            $(this.$contentFile).addClass(\"bz-file-upload__container--hidden\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Add upload options\r\n     */\r\n    getUploadChoices: function () {\r\n        var self = this;\r\n        var itemsUpload = [];\r\n\r\n        // Take photo, Choose photo\r\n        if (self.validOptions.image) {\r\n            itemsUpload.push({\r\n                \"guid\": 1,\r\n                \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-take-photo\")\r\n            });\r\n            itemsUpload.push({\r\n                \"guid\": 2,\r\n                \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-choose-photo\")\r\n            });\r\n        }\r\n\r\n        // Take video\r\n        if (self.validOptions.video) {\r\n            itemsUpload.push({\r\n                \"guid\": 3,\r\n                \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-take-video\")\r\n            });\r\n        }\r\n\r\n        // Stores the upload options\r\n        return [].concat(itemsUpload);\r\n    },\r\n\r\n    /**\r\n     * Handler of upload files\r\n     * @param {} ordinal\r\n     * @returns {}\r\n     */\r\n    handlerUploadFile: function (ordinal) {\r\n        var self = this;\r\n        var actionSelected = ordinal || 0;\r\n\r\n        switch (actionSelected) {\r\n            case 2:\r\n\r\n                navigator.camera.getPicture(function (dataImage) {\r\n                    self.dataImage = dataImage;\r\n                    var extensions = self.Class.EXTENSIONSIMG.concat(self.Class.EXTENSIONSVIDEO);\r\n\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties))\r\n                        .then(function () {\r\n                            // Gets the real properties for the file\r\n                            return $.when(bizagi.util.media.getFileDataInfo(self.dataImage))\r\n                                .then(function (fileData) {\r\n                                    self.fileProperties = fileData;\r\n\r\n                                    if (bizagi.util.media.checkFileTypes(fileData, self.properties, extensions)) {\r\n                                        if (!bizagi.util.isAndroid()) {\r\n                                            return $.when(bizagi.util.media.modalResolutionUpload()).then(function (buttonIndex) {\r\n                                                if (buttonIndex <= bizagi.util.media.getImageResolutionItems().length) {\r\n                                                    return self.handlerResolutionUpload(buttonIndex);\r\n                                                }\r\n                                            });\r\n\r\n                                        } else {\r\n                                            // Force click to show actionsheet menu\r\n                                            $(\".bz-file-upload__resolution\", self.getControl()).click();\r\n                                        }\r\n                                    }\r\n                                });\r\n                        }).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n\r\n                }, self.onFail.bind(self), {\r\n                    quality: self.Class.QUALITY_PICTURE,\r\n                    sourceType: Camera.PictureSourceType.PHOTOLIBRARY\r\n                });\r\n                break;\r\n            case 1:\r\n                navigator.camera.getPicture(function (dataImage) {\r\n                        bizagi.loading.start();\r\n\r\n                        $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties)).then(function () {\r\n                            return $.when(bizagi.util.media.getFileDataInfo(dataImage)).then(function (fileData) {\r\n                                self.fileProperties = fileData;\r\n                                return self.saveImage(dataImage);\r\n                            });\r\n                        }).always(function () {\r\n                            bizagi.loading.stop();\r\n                        });\r\n                    },\r\n                    self.onFail.bind(self), {\r\n                        quality: self.Class.QUALITY_PICTURE,\r\n                        sourceType: navigator.camera.PictureSourceType.CAMERA,\r\n                        mediaType: navigator.camera.MediaType.PICTURE,\r\n                        destinationType: Camera.DestinationType.FILE_URI,\r\n                        correctOrientation: true,\r\n                        targetWidth: 1280,\r\n                        targetHeight: 960\r\n                    });\r\n                break;\r\n            case 3:\r\n                navigator.device.capture.captureVideo(function (dataVideo) {\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(bizagi.util.media.checkMaxSizeVideo(dataVideo, self.properties))\r\n                        .then(function () {\r\n                            return self.saveVideo(dataVideo);\r\n                        }).always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n\r\n                }, self.onFail.bind(self), {limit: self.Class.LIMIT});\r\n                break;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Catch errors\r\n     * @param {} error\r\n     */\r\n    onFail: function (error) {\r\n        var messageError = bizagi.util.processFailMessage(error);\r\n\r\n        bizagi.loading.stop();\r\n\r\n        if (messageError && typeof (messageError) === \"string\" && messageError.indexOf(\"No Activity found to handle Intent\") !== -1) {\r\n            var hasResource = bizagi.util.isValidResource(\"render-upload-error-media-app\");\r\n            var message = hasResource ? bizagi.localization.getResource(\"render-upload-error-media-app\") : \"Your device does not have an app to execute this action.\";\r\n\r\n            self.performValidationMessage(message);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Adds a validation message to the render\r\n     * @param message\r\n     */\r\n    performValidationMessage: function (message) {\r\n        var fail = bizagi.util.processFailMessage(message);\r\n\r\n        bizagi.showMessageBox(fail);\r\n    },\r\n\r\n    /**\r\n     * Handler of resolution upload\r\n     * @param {} ordinal\r\n     * @returns {}\r\n     */\r\n    handlerResolutionUpload: function (ordinal) {\r\n        var self = this;\r\n        var actionSelected = ordinal || 0;\r\n\r\n        // If original, save image normally, if not, reduce quality and size\r\n        if (actionSelected === bizagi.util.media.ResolutionType.ORIGINAL) {\r\n            return self.saveImage(self.dataImage);\r\n        } else {\r\n            var resolution = bizagi.util.media.getImageResolution(actionSelected);\r\n\r\n            return $.when(bizagi.util.media.transformImageSize(self.dataImage, resolution)).then(function (result) {\r\n\r\n                self.editedImageURL = result.localUrl;\r\n                self.properties.url = result.base64Image;\r\n\r\n                return self.saveImage(self.dataImage);\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method to add new file\r\n     */\r\n    addFile: function () {\r\n        var self = this;\r\n        var dataFile = this.$inputFile[0].files[0];\r\n        var extensions = self.Class.EXTENSIONSIMG.concat(self.Class.EXTENSIONSFILE, self.Class.EXTENSIONSVIDEO);\r\n\r\n        dataFile.fullPath = this.$inputFile[0].value;\r\n        bizagi.loading.start();\r\n\r\n        if (bizagi.util.media.checkMaxSizeFile(dataFile, self.properties) && bizagi.util.media.checkFileTypes(dataFile, self.properties, extensions)) {\r\n\r\n            $.when(self.processUploadFile(dataFile)).done(function (result) {\r\n                if (!bizagi.util.isFailResponse(result)) {\r\n                    self.onUploadFileCompleted(JSON.parse(decodeURIComponent(result)));\r\n                } else {\r\n                    self.performValidationMessage(result)\r\n                }\r\n            }).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        } else {\r\n            bizagi.loading.stop();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Build add params to send to the server\r\n     * @param {} dataFile\r\n     */\r\n    buildAddFileParams: function (dataFile) {\r\n        var self = this;\r\n        var prefix = self.Class.BA_CONTEXT_PARAMETER_PREFIX;\r\n\r\n        // Get form data for POSTing\r\n        var formData = new FormData();\r\n        var form = self.getFormContainer();\r\n        var data = self.buildAddParams();\r\n\r\n        // Build add params to send to the server\r\n        var keys = Object.keys(data);\r\n\r\n        keys.map(function (key) {\r\n            formData.append(key, data[key]);\r\n        });\r\n\r\n        formData.append(\"Filedata\", dataFile);\r\n        formData.append(\"Filename\", dataFile.name.substr(dataFile.name.replace(/([\\\\\\/]+)/g, \"/\").lastIndexOf(\"/\") + 1));\r\n        formData.append(self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\", form.properties.sessionId);\r\n\r\n        if (self.properties.contexttype)\r\n            formData.append(prefix + \"contexttype\", self.properties.contexttype);\r\n\r\n        try {\r\n            if (typeof (BIZAGI_SESSION_NAME) !== \"undefined\") {\r\n                formData.append(BIZAGI_SESSION_NAME, form.properties.sessionId);\r\n            } else {\r\n                formData.append(\"JSESSIONID\", form.properties.sessionId);\r\n            }\r\n        } catch (e) {\r\n            formData.append(\"JSESSIONID\", form.properties.sessionId);\r\n        }\r\n\r\n        return formData;\r\n    },\r\n\r\n    /**\r\n     * Process an upload file into the server\r\n     * @param {} dataFile\r\n     * @returns {}\r\n     */\r\n    processUploadFile: function (dataFile) {\r\n        var data = {\r\n            url: this.properties.addUrl,\r\n            formData: this.buildAddFileParams(dataFile)\r\n        };\r\n\r\n        return this.dataService.processUploadFile(data);\r\n    },\r\n\r\n    /**\r\n     * onUploadFileCompleted\r\n     * @param {} result\r\n     */\r\n    onUploadFileCompleted: function (result) {\r\n        var self = this;\r\n        var $wrapper = $(\".bz-files\", self.getControl());\r\n\r\n        if (result.idFileUpload && result.fileName) {\r\n            var file = [result.idFileUpload, result.fileName];\r\n            var newItem = self.renderUploadItem(file);\r\n\r\n            // Locate it before the upload wrapper\r\n            $wrapper.append(newItem);\r\n\r\n            // Copy the files value but not its reference\r\n            var files = self.files.slice();\r\n\r\n            //Add the new item to this temporal array\r\n            files.push(file);\r\n\r\n            // Update value\r\n            self.setValue(files, true);\r\n\r\n            // Check maxFiles\r\n            self.checkMaxFiles();\r\n            self.attackMenuEvents(file);\r\n\r\n            self.editedImageURL = null;\r\n        } else {\r\n            self.performValidationMessage(result.message);\r\n        }\r\n    },\r\n\r\n    attackMenuEvents: function (file) {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        if (file && file.getFileProperties) {\r\n            $.when(file.getFileProperties).done(function (fileProperties) {\r\n                // TODO: Fail scenario...\r\n                var $fileItem = $(\".\" + self.properties.id + \"-\" + fileProperties.idFileUpload, $control);\r\n\r\n                self.fileData[fileProperties.idFileUpload] = fileProperties.metadata || [];\r\n                self.addMenuEvents($fileItem, fileProperties);\r\n            });\r\n        }\r\n    },\r\n\r\n    processActionByType: function (type, fileData, $fileItem) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var form = self.getFormContainer();\r\n\r\n        bizagi.loading.start();\r\n\r\n        // Instantiate slide form object\r\n        var slideView = new bizagi.rendering.smartphone.slide.ecm(self.dataService, self.renderFactory, {\r\n            title: self.properties.displayName || \"\",\r\n            container: form.container,\r\n            navigation: self.getParams().navigation,\r\n            editable: properties.editable && type !== self.Class.ACTION_DETAILS,\r\n            orientation: properties.orientation || \"ltr\",\r\n            onSave: function (result) {\r\n                if (result.update) {\r\n                    var file = [result.idFileUpload, result.fileName];\r\n                    var newItem = self.renderUploadItem(file);\r\n\r\n                    $fileItem.replaceWith(newItem);\r\n                    self.attackMenuEvents(file);\r\n                }\r\n            },\r\n            onCancel: function () {\r\n                // console.log(\"CANCEL\");\r\n            }\r\n        });\r\n\r\n        slideView.render({metadata: fileData.metadata, fileData: fileData})\r\n            .always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Grid Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the grid render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.grid\", bizagi.rendering.grid.prototype);\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.grid.extend(\"bizagi.rendering.smartphone.grid\", {}, {\r\n\r\n    init: function (params) {\r\n        var self = this;\r\n        var data = params.data;\r\n\r\n        //support multiples instances of decorates objects   the object in false means \r\n        //enable the decorated is an array and so can save several renderings\r\n        data.properties.singleInstance = false;\r\n\r\n        data.properties.rowsPerPage = 1;\r\n        data.properties.displayType = \"vertical\";\r\n\r\n        // Call base\r\n        self._super(params);\r\n\r\n        // Create a data-structure to keep track of each cell properties\r\n        this.cellMetadata = {};\r\n\r\n        // Fill default properties\r\n        var properties = this.properties;\r\n\r\n        // Just apply display-type: vertical, align it to the left\r\n        properties.displayType = \"vertical\";\r\n        properties.rowsPerPage = 1;\r\n\r\n        //revisar base para mejorar comportamiento cuando esta en false los elementos\r\n        $.each(self.columns, function (index, value) {\r\n            // Enable to apply edit and next send request\r\n            if (this.properties && this.properties.editable)\r\n                this.properties.editable = (properties.allowEdit == true) ? true : false;\r\n        });\r\n\r\n        // Just for smartphones we need to take only one row if there is data in the json,\r\n        // because we use just one row per page\r\n        if (properties.data && properties.data.rows && properties.data.rows.length > 1) {\r\n            var newData = [];\r\n            newData.push(properties.data.rows[0]);\r\n            properties.data.rows = newData;\r\n        }\r\n    },\r\n\r\n    /* method overrides\r\n    *  from base or virtual\r\n    */\r\n    setDisplayValue: function (value) {\r\n    },\r\n\r\n    setDisplayValueEdit: function (value) {\r\n    },\r\n\r\n    actionSave: function () {\r\n    },\r\n\r\n    /*\r\n    * Updates manually the affected cell \r\n    */\r\n    updateAffectedCellManually: function () {\r\n    },\r\n\r\n    /*\r\n    * Get the row index using the key as a reference\r\n    */\r\n    getRowIndexByKey: function () {\r\n    },\r\n\r\n    /**\r\n     *  Shows more info about a grid row\r\n     * in smartphones not implemented\r\n     */\r\n    showMore: function (id) {\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        // Call base \r\n        self._super();\r\n\r\n        var properties = self.properties;\r\n        properties.rowsPerPage = 1;\r\n\r\n        self.getLabel().hide();\r\n        var control = self.getControl();\r\n        var grid = self.grid = $(\".bz-mobile-grid\", control);\r\n\r\n        var mode = self.getMode();\r\n        var columns = self.buildColumnModel();\r\n\r\n        var columnsTotalizers = jQuery.grep(columns, function (a) {\r\n            return (a.summarizeBy);\r\n        });\r\n\r\n        //bizagi_grid_smartphone\r\n        grid.bizagi_grid_smartphone({\r\n            columns: columns,\r\n            title: properties.displayName,\r\n            mode: self.getMode(),\r\n            template: {\r\n                grid: self.renderFactory.getTemplate(\"bizagi.grid.grid\"),\r\n                waiting: self.renderFactory.getTemplate(\"bizagi.grid.waiting\"),\r\n                table: self.renderFactory.getTemplate(\"bizagi.grid.table\"),\r\n                emptyTable: self.renderFactory.getTemplate(\"bizagi.grid.table.empty\"),\r\n                column: self.renderFactory.getTemplate(\"bizagi.grid.column\"),\r\n                specialColumn: self.renderFactory.getTemplate(\"bizagi.grid.column.special\"),\r\n                row: self.renderFactory.getTemplate(\"bizagi.grid.row\"),\r\n                rowButtons: self.renderFactory.getTemplate(\"bizagi.grid.row.buttons\"),\r\n                cell: self.renderFactory.getTemplate(\"bizagi.grid.cell\"),\r\n                specialCell: self.renderFactory.getTemplate(\"bizagi.grid.cell.special\"),\r\n                pager: self.renderFactory.getTemplate(\"bizagi.grid.pager\"),\r\n                buttons: self.renderFactory.getTemplate(\"bizagi.grid.buttons\")\r\n            },\r\n            actions: {\r\n                add: properties.allowAdd,\r\n                edit: (properties.allowEdit && properties.withEditForm),\r\n                details: properties.allowDetail,\r\n                remove: properties.allowDelete,\r\n                inlineAdd: properties.inlineAdd,\r\n                allowMore: false,\r\n                totalizer: properties.showSummary,\r\n                hasTotalizer: columnsTotalizers.length > 0 && properties.data.rows.length > 0 ? true : false\r\n            },\r\n\r\n            pageRequested: function (ui) {\r\n                if (mode != \"execution\") return;\r\n\r\n                self.submitGridData().then(function(){\r\n                    self.onPageRequested(ui);\r\n                });\r\n            },\r\n            sortRequested: function (ui) {\r\n                if (mode != \"execution\") return;\r\n                self.fetchData(ui.page, ui.sortBy, ui.sortType);\r\n            },\r\n            isValid: function (invalidElements) {\r\n                return self.isValidGrid(invalidElements);\r\n            },\r\n            drawCell: function (ui) {\r\n                return self.drawCell(ui.column, ui.key, ui.value, ui.isNewRow);\r\n            },\r\n            cellReady: function (ui) {\r\n                return self.onCellReady(ui.column, ui.key, ui.cell, ui.isNewRow);\r\n            },\r\n            rowSelected: function (ui) {\r\n                //self.triggerHandler(\"rowSelected\", { id: ui.key });\r\n            },\r\n            totalData: function (ui) {\r\n                if (mode != \"execution\") return;\r\n\r\n                self.onTotalData();\r\n            },\r\n            gridControlReady: function () {\r\n                self.processLayout(isLabelFormat, self.properties.textFormat || {});\r\n                self.processLayout(!isLabelFormat, self.properties.valueFormat || {});\r\n            },\r\n            addRow: function (ui) {\r\n                if (mode != \"execution\") return;\r\n                self.grantPerformAction(\"addRow\", function() {\r\n                    if (self.properties.subType == \"adhocGrid\" || self.properties.inlineAdd) {\r\n                        self.addVirtualRow();\r\n                    } else {\r\n                        self.addRow();\r\n                    }\r\n                });\r\n            },\r\n            editRow: function (ui) {\r\n                if (mode != \"execution\") return;\r\n                if (self.properties.subType == \"adhocGrid\"){\r\n                    self.editVirtualRow(ui.key);\r\n                } else{\r\n                    self.editRow(ui.key);\r\n                }\r\n            },\r\n            deleteRow: function (ui) {\r\n                if (mode != \"execution\") return;\r\n                self.deleteRow(ui.key);\r\n            },\r\n            showFormDetails: function (ui) {\r\n                self.showDetailForm(ui.key);\r\n            },\r\n            showMore: function (ui) {\r\n                self.showMore(ui.key);\r\n            }\r\n        });\r\n\r\n\r\n        // Just for smartphones we need to take only one row if there is data in the json, because we use just one row per page\r\n        if (properties.data && properties.data.rows && properties.data.rows.length > 1) {\r\n            var newData = [];\r\n            newData.push(properties.data.rows[0]);\r\n            properties.data.rows = newData;\r\n        }\r\n\r\n        properties.skipInitialLoad = properties.skipInitialLoad || false;\r\n        // Set initial data\r\n        if (!properties.skipInitialLoad) {\r\n            if (properties.data) {\r\n                self.updateData(properties.data);\r\n\r\n                // Trigger change in order to start up the actions when the controls is ready\r\n                $.when(self.ready())\r\n                    .done(function () {\r\n                        self.triggerRenderChange({changed: false});\r\n                    });\r\n            } else {\r\n                self.fetchData(properties.page, properties.sortBy, properties.sortOrder);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n   *   Method to render non editable values\r\n   */\r\n    postRenderReadOnly: function () {\r\n        var self = this;\r\n\r\n        // Do the same as the post-render\r\n        self.postRender();\r\n    },\r\n\r\n    changeBackgroundColor: function (color) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        if (control) {\r\n            if (color != 'none') {\r\n                $(\".bz-mobile-grid\", control).css(\"background-color\", color);\r\n            } else {\r\n                $(\".bz-mobile-grid\", control).css(\"background-color\", \"\");\r\n            }\r\n        }\r\n\r\n        return this;\r\n    },\r\n\r\n    setHeaderStyles: function (cell) {\r\n        var self = this;\r\n        var label_style = \"font-weight: bold; \";\r\n        var properties = self.properties;\r\n\r\n        if (properties.headerFormat) {\r\n            var format = properties.headerFormat;\r\n\r\n            if (typeof format.bold !== \"undefined\") {\r\n                label_style = \"font-weight: normal; \";\r\n            }\r\n\r\n            if (format.color) {\r\n                label_style += \"color: \" + format.color + \";\";\r\n            }\r\n\r\n            if (format.background) {\r\n                label_style += \"background-color: \" + format.background + \";\";\r\n            }\r\n\r\n            if (format.italic) {\r\n                label_style += \"font-style: italic; \";\r\n            }\r\n\r\n            if (format.underline || format.strikethru) {\r\n                var strikethru = bizagi.util.parseBoolean(format.strikethru) ? \"line-through \" : \"\";\r\n                var underline = bizagi.util.parseBoolean(format.underline) ? \"underline \" : \"\";\r\n\r\n                label_style += \"text-decoration: \" + strikethru + underline + \";\";\r\n            }\r\n\r\n            if (format.size && format.size != \"0\") {\r\n                var newFontSize = (100 + Number(format.size) * 10) + \"%\";\r\n                label_style += \"font-size: \" + newFontSize + \";\";\r\n            }\r\n        }\r\n        return cell.replace(\"%labelStyle%\", label_style);\r\n    },\r\n\r\n    onTotalData: function (ui) {\r\n\r\n        var self = this;\r\n        var containerForm = self.getFormContainer();\r\n        containerForm.saveForm();\r\n\r\n        //defered que retorne la respuesta del servidor\r\n        bizagi.loading.start();\r\n        $.when(self.fetchTotalData()).done(function (data) {\r\n            var rows = data.rows;\r\n            var rowsLength = rows.length;\r\n\r\n            //calcula los totalizadores y crea el html\r\n            var showTotal = [];\r\n\r\n            var columnsModel = self.buildColumnModel();\r\n            var result;\r\n\r\n            var operationState;\r\n\r\n            columnsModel.forEach(function callback(column, columnIndex) {\r\n                if (column.bizAgiProperties) {\r\n                    operationState = column.bizAgiProperties.totalize.operation;\r\n\r\n                    switch (operationState) {\r\n                        case \"sum\":\r\n                            result = rows.sum(function (row) {\r\n                                var return_value = row[columnIndex] !== null ? row[columnIndex] : column.bizAgiProperties.defaultvalue;\r\n                                return Number(return_value)\r\n                            }, columnIndex);\r\n                            break;\r\n\r\n                        case \"count\":\r\n                            result = rows.count(function (row) {\r\n                                //Checks if there is a DefaultValue, so assign it to the returnedvalu in case it doesn't have value\r\n                                var return_value = row[columnIndex] !== null ? row[columnIndex] : column.bizAgiProperties.defaultvalue;\r\n\r\n                                if (!bizagi.util.isArray(return_value)) {\r\n                                    return return_value;\r\n                                }\r\n\r\n                                if (bizagi.util.isArray(return_value) && return_value.length > 0) {\r\n                                    return return_value; //If the returned value is not undefined, neither null, it will count +1\r\n                                }\r\n                            }, column, columnIndex);\r\n\r\n                            break;\r\n\r\n                        case \"max\":\r\n                            result = rows.max(function (row) {\r\n                                var return_value = row[columnIndex] !== null ? row[columnIndex] : column.bizAgiProperties.defaultvalue;\r\n                                return Number(return_value)\r\n                            }, columnIndex);\r\n\r\n                            break;\r\n\r\n                        case \"min\":\r\n                            result = rows.min(function (row) {\r\n                                var return_value = row[columnIndex] !== null ? row[columnIndex] : column.bizAgiProperties.defaultvalue;\r\n                                return Number(return_value);\r\n                            }, columnIndex);\r\n                            break;\r\n\r\n                        case \"avg\":\r\n                            result = rows.avg(function (row) {\r\n                                var return_value = row[columnIndex] !== null ? row[columnIndex] : column.bizAgiProperties.defaultvalue;\r\n                                return Number(return_value);\r\n                            }, columnIndex);\r\n\r\n                            result = result.toFixed(2);\r\n                            break;\r\n                    }\r\n\r\n                    if (operationState) {\r\n                        result = self.formatTotalizedResult(operationState, column.bizAgiProperties.type, result);\r\n                        showTotal.push({label: column.label, total: result});\r\n                    }\r\n                }\r\n            });\r\n\r\n            self.showTotals(showTotal);\r\n        }).fail(function (error) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"render-grid-no-records\"), \"Error\");\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Fetch Sum Data\r\n     */\r\n    fetchTotalData: function (params) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        params = params || {};\r\n        $.extend(params, {\r\n            url: properties.dataUrl,\r\n            xpath: properties.xpath,\r\n            idRender: properties.id,\r\n            xpathContext: properties.xpathContext,\r\n            contexttype: properties.contextType,\r\n            idPageCache: properties.idPageCache,\r\n            sort: properties.sort,\r\n            page: 1,\r\n            rows: self.properties.data.records,\r\n            searchFilter: properties.searchFilter\r\n        });\r\n\r\n        // Check if a custom method has been given\r\n        if (properties.overrideGetRemoteData) {\r\n            var result = properties.overrideGetRemoteData(params);\r\n            return result != null ? result.promise() : null;\r\n        }\r\n\r\n        // Default ajax call\r\n        var defer = new $.Deferred();\r\n\r\n        // Resolve with remote data\r\n        self.dataService.multiaction().getGridData(params).done(function (data) {\r\n            // Check RTL\r\n            if (self.isRTL()) {\r\n                data.rows = self.changeOrderData(data.rows);\r\n            }\r\n\r\n            defer.resolve(data);\r\n        }).fail(function (fail) {\r\n\r\n            defer.reject(fail);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    formatTotalizedResult: function (operation, controlType, value) {\r\n        switch (operation) {\r\n            case 'sum':\r\n            case 'avg':\r\n            case 'min':\r\n            case 'max':\r\n                if (controlType == \"columnMoney\" || controlType == \"money\") {\r\n                    return bizagi.util.formatMonetaryCell(value);\r\n                }\r\n                break;\r\n        }\r\n\r\n        return value || 0;\r\n    },\r\n\r\n    showTotals: function (params) {\r\n        var self = this;\r\n        var content = $.fasttmpl(self.renderFactory.getTemplate('bizagi.grid.totalizer'), {items: params});\r\n\r\n        self.grid.mobileView({\r\n            displayName: bizagi.localization.getResource(\"render-grid-totalizer\"),\r\n            orientation: self.properties.orientation,\r\n            style: \"width: 90%; height: 70%\",\r\n            transition: \"fade:in\",\r\n            cssClass: \"bz-modal-view--totalizer\",\r\n            showBorder: true,\r\n            contentTemplate: content\r\n        });\r\n    },\r\n\r\n    buildColumnModel: function () {\r\n        var self = this;\r\n        var columns = self.columns;\r\n\r\n        // Create id column first\r\n        var keyColumn = {\r\n            name: \"id\",\r\n            index: 0,\r\n            label: \"id\",\r\n            hidden: true,\r\n            align: \"\",\r\n            key: true\r\n        };\r\n\r\n        // Add to column model\r\n        var columnModel = [];\r\n        columnModel.push(keyColumn);\r\n\r\n        $.each(columns, function (index, column) {\r\n            // Set grid column\r\n            column.columnIndex = index + 1;\r\n            var columnLabel = !bizagi.util.isEmpty(column.properties.displayName) ? column.properties.displayName : \" \";\r\n            var gridColumn = {\r\n                name: column.properties.xpath,\r\n                index: index + 1,\r\n                label: columnLabel,\r\n                key: false,\r\n                hidden: (!column.properties.visible || column.properties.type === \"columnHidden\" || column.properties.columnVisible === false),\r\n                summarizeBy: (column.properties.totalize && column.properties.totalize.operation ? column.properties.totalize.operation : undefined),\r\n                bizAgiProperties: column.properties\r\n            };\r\n            columnModel.push(gridColumn);\r\n        });\r\n\r\n        return columnModel;\r\n    },\r\n\r\n    /**\r\n     * Makes the grid to refresh\r\n     */\r\n    refresh: function () {\r\n        return $.when(this.fetchData());\r\n    },\r\n\r\n    /*\r\n    *   Holds the execution until the grid data is ready after a load operation\r\n    */\r\n    dataReady: function () {\r\n        return this.dataReadyDeferred != null ? this.dataReadyDeferred.promise() : null;\r\n    },\r\n\r\n    /*\r\n    *   Method to set data and update the grid\r\n    */\r\n    updateData: function (data) {\r\n        var self = this;\r\n        var columns = self.columns;\r\n\r\n        // Set value in control\r\n        if (data && self.properties) {\r\n            self.properties.data = data;\r\n            self.setCellOverrides(data, columns);\r\n\r\n            self.triggerGridPluginHandler(\"setData\", data);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Method to fetch data from the server and then update the data\r\n    */\r\n    fetchData: function (page, sortBy, sortType) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Define defaults\r\n        page = page || 1;\r\n        sortBy = sortBy || \"\";\r\n        sortType = sortType || \"asc\";\r\n\r\n        // Update control properties\r\n        properties.page = page;\r\n        properties.sort = sortBy + \" \" + sortType;\r\n\r\n        bizagi.loading.start();\r\n\r\n        return $.when(self.getRemoteData())\r\n            .then(function (data) {\r\n\r\n                if (data) {\r\n                    $.when(self.updateData(data)).done(function () {\r\n                        self.triggerRenderChange({changed: false});\r\n                    });\r\n                }\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n    },\r\n\r\n    /*\r\n    *   Add the render data to the given collection in order to send data to the server\r\n    */\r\n    collectData: function (renderValues) {\r\n        var self = this;\r\n        var grid = self.grid;\r\n\r\n        // Remove changes for inline added rows\r\n        if (grid && self.properties.inlineAdd) {\r\n            var omitKeys = grid.bizagi_grid_smartphone.hasOwnProperty(\"getNewRowKeys\") ? grid.bizagi_grid_smartphone(\"getNewRowKeys\") : [];\r\n            for (var i = 0, length = omitKeys.length; i < length; i++) {\r\n                if (self.changes[omitKeys[i]]) {\r\n                    delete self.changes[omitKeys[i]];\r\n                }\r\n            }\r\n        }\r\n\r\n        self._super(renderValues);\r\n    },\r\n\r\n    onPageRequested: function (ui) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var data = {};\r\n\r\n        if (!jQuery.isEmptyObject(data)) {\r\n\r\n            self.dataService.submitData({\r\n                action: \"SUBMITDATA\",\r\n                data: data,\r\n                idRender: properties.id,\r\n                xpath: properties.xpath,\r\n                xpathContext: properties.xpathContext,\r\n                idPageCache: properties.idPageCache\r\n            });\r\n\r\n        }\r\n\r\n        self.fetchData(ui.page, ui.sortBy, ui.sortType);\r\n    },\r\n\r\n    /*\r\n    *   Customizes the content drawing inside the cell\r\n    */\r\n    drawCell: function (column, key, value, isNewRow) {\r\n        //revisar ya que en las demas implementacion en desktop y tablet utilizan una validacion para edicion en linea o no\r\n        var self = this;\r\n        self.newRecords = {};\r\n\r\n        if (column.key) {\r\n            return value;\r\n        }\r\n\r\n        // Get render column\r\n        var columnIndex = column.index - 1;\r\n        var renderColumn = self.columns[columnIndex];\r\n\r\n        if (!self.cellMetadata[key]) self.cellMetadata[key] = {};\r\n        if (!self.cellMetadata[key][columnIndex]) {\r\n            self.cellMetadata[key][columnIndex] = {};\r\n        }\r\n        var properties = self.cellMetadata[key][columnIndex].properties || renderColumn.originalProperties;\r\n        var visible = properties.visible !== undefined ? properties.visible : true;\r\n        var editable = properties.editable !== undefined ? properties.editable : true;\r\n\r\n        renderColumn.properties.displayType = 'value';\r\n\r\n        // Show editable cell when we are performing inline add operation\r\n        if (isNewRow) editable = true;\r\n\r\n        var cellOverride = self.getCellOverride(key, column.index - 1);\r\n\r\n        if (cellOverride) {\r\n            visible = cellOverride.visible;\r\n            editable = (properties.editable) ? cellOverride.editable : false;\r\n\r\n        }\r\n\r\n        // Set the value of labelAlign and valueAlign to use the rendering in the base\r\n        //TODO: validar despues que sucede si se adiciona a la base para todos los dispositivos\r\n        renderColumn.properties.labelAlign = \"default\"\r\n        if (renderColumn.properties.columntitlealign) {\r\n            renderColumn.properties.labelAlign = renderColumn.properties.columntitlealign;\r\n        }\r\n\r\n        renderColumn.properties.valueAlign = \"default\"\r\n        if (renderColumn.properties.columnAlign) {\r\n            renderColumn.properties.valueAlign = renderColumn.properties.columnAlign;\r\n        }\r\n\r\n\r\n        if (visible) {\r\n            //&& self.properties.inlineEdit\r\n            if (editable) {\r\n                var defer = new $.Deferred();\r\n\r\n                $.when(renderColumn.render(key, value)).done(function (cell) {\r\n\r\n                    if (cell && $(cell).css(\"display\") !== \"none\") {\r\n                        //cell = self.setHeaderStyles(cell);\r\n                    }\r\n\r\n                    // Register array with new records\r\n                    if (isNewRow && !self.newRecords[key]) {\r\n                        self.newRecords[key] = {};\r\n                    }\r\n\r\n                    for (var j = 0, length = self.columns.length; j < length; j++) {\r\n                        self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n                        self.getCellOverride(key, j).visible = true;\r\n                    }\r\n\r\n                    self.bindRenderChange(renderColumn, key, true);\r\n\r\n                    defer.resolve(cell);\r\n                });\r\n                return defer.promise();\r\n            } else {\r\n                /**/\r\n                //return renderColumn.renderReadOnly(key, value);\r\n\r\n                return $.when(renderColumn.renderReadOnly(key, value)).then(function (cell) {\r\n\r\n                    if (cell && $(cell).css(\"display\") !== \"none\") {\r\n                        //cell = self.setHeaderStyles(cell);\r\n                        var item = $(cell);\r\n\r\n                        if (typeof (self.properties.textFormat) !== \"undefined\") {\r\n\r\n                            if (typeof (self.properties.textFormat.color) !== \"undefined\") {\r\n                                $('label', item).css('color', self.properties.textFormat.color);\r\n                            }\r\n\r\n                            if ((typeof (self.properties.textFormat.size) !== \"undefined\") && (self.properties.textFormat.size > 0)) {\r\n                                var newFontSize = (100 + Number(self.properties.textFormat.size) * 10) + \"%\";\r\n                                $('label', item).css('font-size', newFontSize);\r\n                            }\r\n                        }\r\n                        // TODO: Review template cell.readonly\r\n                        cell = item && item[0] ? item[0].outerHTML : cell;\r\n                    }\r\n\r\n                    return (cell || \"\");\r\n                });\r\n\r\n            }\r\n\r\n\r\n        } else {\r\n            return \"\";\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n    *   Executes when the cell is ready and inserted into the DOM\r\n    */\r\n    onCellReady: function (column, key, cell, isNewRow) {\r\n        var self = this;\r\n\r\n        // Get render column\r\n        var columnIndex = column.index - 1;\r\n        var renderColumn = self.columns[columnIndex];\r\n        var properties = ((self.cellMetadata[key][columnIndex] != undefined) ? self.cellMetadata[key][columnIndex].properties : undefined) || renderColumn.originalProperties;\r\n        var visible = properties.visible !== undefined ? properties.visible : true;\r\n        var editable = properties.editable !== undefined ? properties.editable : true;\r\n\r\n        $(\".bz-rn-messages\", cell).toggleClass(\"bz-rn-messages\", \"bz-rn-messages-grid\");\r\n\r\n        // If the cell we are drawing is the summary cell, we need to make it readonly\r\n        if (key == \"summary\") {\r\n            editable = false;\r\n        }\r\n\r\n        // Show editable cell when we are performing inline add operation\r\n        if (isNewRow) {\r\n            editable = true;\r\n        }\r\n\r\n        if (visible) {\r\n            if (editable) {\r\n                // Set editable\r\n                var originalEditable = renderColumn.properties.editable;\r\n                renderColumn.properties.editable = editable;\r\n\r\n                // Set xpath context for submitonchange action\r\n                if (renderColumn.properties.submitOnChange) {\r\n                    var control = renderColumn.getDecorated(key);\r\n                    if (control) {\r\n                        control.properties.submitOnChangexpathContext = self.properties.xpath + \"[]\";\r\n                    }\r\n                }\r\n\r\n\r\n                // Execute cell post render\r\n                renderColumn.postRender(key, cell);\r\n\r\n                // Restore editable\r\n                renderColumn.properties.editable = originalEditable;\r\n            } else {\r\n\r\n                if (renderColumn.properties.submitOnChange) {\r\n                    var control = renderColumn.getDecorated(key);\r\n\r\n                    if (control) {\r\n                        control.properties.submitOnChangexpathContext = self.properties.xpath + \"[]\";\r\n                    }\r\n                }\r\n\r\n                renderColumn.postRender(key, cell);\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n     *  Adds a row to the grid\r\n     */\r\n    addRow: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var container = self.getFormContainer().container;\r\n        var dataservice = self.dataService;\r\n\r\n        bizagi.loading.start();\r\n\r\n        $.when(self.submitAddRequest())\r\n            .done(function (newid) {\r\n                var recordXpath = properties.xpath + \"[id=\" + newid + \"]\";\r\n                var propertiesGridForm = {\r\n                    idRender: properties.id,\r\n                    \"recordXPath\": recordXpath,\r\n                    url: properties.addPage,\r\n                    xpathContext: properties.xpathContext,\r\n                    idPageCache: properties.idPageCache,\r\n                    xpath: recordXpath,\r\n                    editable: true,\r\n                    requestedForm: \"addForm\",\r\n                    displayName: properties.addLabel,\r\n                    idAsigned: newid,\r\n                    enableEditSubmitRequest: false,\r\n                    hideLabel: true,\r\n                    disableProcessButons: true,\r\n                    hasExclusiveCheck : properties.hasExclusiveCheck\r\n                };\r\n\r\n                var argumentsfl = {\r\n                    \"renderFactory\": self.renderFactory,\r\n                    \"dataService\": dataservice,\r\n                    \"parent\": self,\r\n                    \"data\": {\r\n                        properties: propertiesGridForm\r\n                    }\r\n                };\r\n\r\n                var formlink = new bizagi.rendering.smartphone.formLink(argumentsfl);\r\n                jQuery.extend(formlink, {\r\n                    contextEdit: $(container).find(\".bz-container__item-edit\"),\r\n                    element: self.element,\r\n                    actionSave: self.actionSaveNewRow,\r\n                    actionCancel: self.actionCancelRow,\r\n                    _sendRelation: function () {\r\n                        return true;\r\n                    },\r\n                    _getData: self.dataService.getFormData,\r\n                    _params: propertiesGridForm,\r\n                    addExclusiveChange : self.addExclusiveChange\r\n                });\r\n\r\n                self._InternalRenderLinkForm(formlink);\r\n\r\n            }).fail(function (error) {\r\n            self.executeFormFailHandler(error);\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n    addVirtualRow: function(){\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var form = self.getFormContainer();\r\n        var formParams = self.getFormParams();\r\n\r\n        // Create mock row\r\n        var currentRow = [\"mock_id\"];\r\n        self.columns.forEach(function(){\r\n            currentRow.push(null);\r\n        });\r\n\r\n        // Render grid view\r\n        var slideView = new bizagi.rendering.smartphone.slide.adhocForm( self.renderFactory, {\r\n            title: self.properties.displayName || \"\",\r\n            allowEdition: true,\r\n            navigation: formParams.navigation\r\n        });\r\n\r\n        slideView.render({\r\n            row: currentRow,\r\n            columns: self.columns,\r\n            pageCacheId: properties.idPageCache,\r\n            xpath: properties.xpath,\r\n            xpathContext: properties.xpathContext,\r\n            sessionId: form.properties.sessionId,\r\n            actions: form.actions\r\n        }).done(function (data) {\r\n            $.when(self.saveAddedRow(data)).done(function () {\r\n                //Update the grid again\r\n                if (!properties.submitOnChange) {\r\n                    // Reload grid\r\n                    self.fetchData();\r\n                } else {\r\n                    // Submits the entire form\r\n                    self.submitOnChange();\r\n                }\r\n            });\r\n        });\r\n    },\r\n    \r\n    /*\r\n    *   Prepares the add action\r\n    */\r\n   saveAddedRow: function (data) {\r\n    var self = this;\r\n    var properties = self.properties;\r\n\r\n    return self.dataService.multiaction().addGridRecordData({\r\n        url: properties.addUrl,\r\n        idRender: properties.id,\r\n        xpath: properties.xpath,\r\n        xpathContext: properties.xpathContext,\r\n        contexttype: properties.contexttype,\r\n        idPageCache: properties.idPageCache,\r\n        submitData: data\r\n    });\r\n},\r\n    \r\n    /**\r\n     * Edit form in the grid\r\n     * @param id\r\n     */\r\n    editRow: function (id) {\r\n        var self = this;\r\n        var containerForm = self.getFormContainer();\r\n        var properties = self.properties;\r\n        var container = self.getFormContainer().container;\r\n        var dataservice = self.dataService;\r\n\r\n        var recordXpath = properties.xpath + \"[id=\" + id + \"]\";\r\n\r\n        bizagi.loading.start();\r\n        $.when(containerForm.saveForm()).done(function () {\r\n\r\n            var propertiesGridForm = {\r\n                idRender: properties.id,\r\n                id: properties.id,\r\n                xpathContext: properties.xpathContext,\r\n                idPageCache: properties.idPageCache,\r\n                recordXPath: recordXpath,\r\n                xpath: recordXpath,\r\n                editable: true,\r\n                url: properties.editPage,\r\n                requestedForm: \"editForm\",\r\n                displayName: properties.editLabel,\r\n                idAsigned: id,\r\n                disableProcessButons: true,\r\n                hasExclusiveCheck : properties.hasExclusiveCheck\r\n            };\r\n\r\n            var argumentsfl = {\r\n                \"renderFactory\": self.renderFactory,\r\n                \"dataService\": dataservice,\r\n                \"parent\": self,\r\n                \"data\": {\r\n                    properties: propertiesGridForm\r\n                }\r\n            };\r\n\r\n            var formlink = new bizagi.rendering.smartphone.formLink(argumentsfl);\r\n\r\n            jQuery.extend(formlink, {\r\n                contextEdit: $(container).find(\".bz-container__item-edit\"),\r\n                element: self.element,\r\n                //disable if you want only save at the end (submit the form)\r\n                actionSave: self.actionSaveNewRow,\r\n                actionCancel: self.actionCancelRow,\r\n                _sendRelation: formlink.submitEditRequest,\r\n                _getData: self.dataService.getFormData,\r\n                _params: propertiesGridForm,\r\n                addExclusiveChange : self.addExclusiveChange\r\n            });\r\n\r\n            self._InternalRenderLinkForm(formlink);\r\n        }).fail(function (error) {\r\n            self.executeFormFailHandler(error);\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n    editVirtualRow: function(id){\r\n        var self = this;\r\n        var data = self.properties.data;\r\n        var properties = self.properties;\r\n        var form = self.getFormContainer();\r\n        var formParams = self.getFormParams();\r\n\r\n        // Search row\r\n        var currentRow = [];\r\n        for (var i = 0, length = data.rows.length; i < length; i++) {\r\n            if (data.rows[i][0] == id) {\r\n                currentRow = data.rows[i];\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Render grid view\r\n        var slideView = new bizagi.rendering.smartphone.slide.adhocForm( self.renderFactory, {\r\n            title: self.properties.displayName || \"\",\r\n            allowEdition: true,\r\n            navigation: formParams.navigation\r\n        });\r\n\r\n        slideView.render({\r\n            row: currentRow,\r\n            columns: self.columns,\r\n            pageCacheId: properties.idPageCache,\r\n            xpath: properties.xpath,\r\n            xpathContext: properties.xpathContext,\r\n            sessionId: form.properties.sessionId,\r\n            actions: form.actions\r\n        }).done(function (formData) {\r\n            // This code is executed when the user press save on the slide\r\n            // Update internal data\r\n            for (xpath in formData) {\r\n                self.collectGridChange({ id: id, xpath: xpath, value: formData[xpath], trigger: false });\r\n            }\r\n\r\n            // Prepare grid data\r\n            var dataToSend = {};\r\n            self.collectData(dataToSend);\r\n\r\n            // Send the data\r\n\r\n            self.dataService.submitData({\r\n                action: \"SUBMITONCHANGE\",\r\n                data: dataToSend,\r\n                idRender: properties.id,\r\n                xpath: properties.xpath,\r\n                xpathContext: properties.xpathContext,\r\n                idPageCache: properties.idPageCache\r\n            }).done(function () {\r\n                // After successfully response refresh the grid\r\n                self.fetchData();\r\n            });\r\n        });\r\n    },\r\n    _InternalRenderLinkForm: function (formlink) {\r\n        $.when(formlink.renderEdition()).done(function () {\r\n            formlink.endLoading();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Show details form\r\n     * @param id\r\n     */\r\n    showDetailForm: function (id) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var container = self.getFormContainer().container;\r\n        var dataservice = self.dataService;\r\n\r\n        var recordXpath = properties.xpath + \"[id=\" + id + \"]\";\r\n\r\n        var propertiesGridForm = {\r\n            idRender: properties.id,\r\n            id: properties.id,\r\n            xpathContext: properties.xpathContext,\r\n            idPageCache: properties.idPageCache,\r\n            recordXPath: recordXpath,\r\n            xpath: recordXpath,\r\n            editable: false,\r\n            url: properties.editPage,\r\n            requestedForm: \"detailForm\",\r\n            displayName: properties.editLabel,\r\n            idAsigned: id,\r\n            disableProcessButons: true\r\n        };\r\n\r\n        var argumentsfl = {\r\n            \"renderFactory\": self.renderFactory,\r\n            \"dataService\": dataservice,\r\n            \"parent\": self,\r\n            \"data\": {\r\n                properties: propertiesGridForm\r\n            }\r\n        };\r\n\r\n        var formlink = new bizagi.rendering.smartphone.formLink(argumentsfl);\r\n\r\n        jQuery.extend(formlink, {\r\n            contextEdit: $(container).find(\".bz-container__item-edit\"),\r\n            element: self.element,\r\n            _getData: self.dataService.getFormData,\r\n            _params: propertiesGridForm\r\n        });\r\n\r\n        self._InternalRenderLinkForm(formlink);\r\n    },\r\n\r\n    /**\r\n     *  Deletes  a row to the grid\r\n     */\r\n    deleteRow: function (id) {\r\n        var self = this;\r\n\r\n        bizagi.showConfirmationBox(this.getResource(\"render-grid-delete-confirmation\"))\r\n            .done(function () {\r\n                // Do a grid record deletion\r\n                $.when(self.submitDeleteRequest(id))\r\n                    .done(function (data) {\r\n                        // Reload grid\r\n                        self.fetchData();\r\n\r\n                        if (data.type == \"success\") {\r\n                            // Trigger the event\r\n                            //'key' must be included to trigger a single call to actions and validations\r\n                            //line 310 bizagi.command.controllers.action\r\n                            self.triggerRenderChange({rowDeleted: true, changed: false, key: id});\r\n                        }\r\n                    }).fail(function (error) {\r\n                    self.executeFormFailHandler(error);\r\n                });\r\n            });\r\n    },\r\n\r\n    actionCancelRow: function () {\r\n        var self = this;\r\n        var deferred = $.Deferred();\r\n\r\n        $.when(self.submitRollbackRequest()).done(function () {\r\n            deferred.resolve();\r\n        });\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    /*\r\n     * Save data in the form link related\r\n     * parameter: data data collected in the related form link\r\n     */\r\n    actionSaveNewRow: function (data) {\r\n        var self = this;\r\n        var deferred = $.Deferred();\r\n\r\n        if (self.form.validateForm() === true) {\r\n            var properties = self.properties;\r\n\r\n            if (!data) {\r\n                self.form.collectRenderValues(data);\r\n            }\r\n\r\n            data.idPageCache = self.form.getPageCache();\r\n\r\n            $.when(\r\n                self.parent.submitSaveRequest(properties.idAsigned, data)).done(function (resp) {\r\n                if (resp.type == \"validationMessages\") {\r\n                    self.form.addValidationMessage(resp.messages);\r\n                    properties.submitOnChange = false;\r\n                    deferred.reject(resp.messages);\r\n                } else {\r\n                    self.parent.fetchData();\r\n                    if (!properties.submitOnChange) {\r\n                        properties.submitOnChange = true;\r\n                    }\r\n                    self.submitOnChange({}, true);\r\n                    deferred.resolve();\r\n                }\r\n            });\r\n        } else {\r\n            deferred.reject();\r\n        }\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    applyActionUpdateGrid: function (column, context) {\r\n        var self = context;\r\n        var properties = self.properties;\r\n        var originalMethod = column.decorated.actionSave;\r\n\r\n        jQuery.extend(column.decorated, {\r\n            actionSave: function () {\r\n                var selfIntern = this;\r\n                $.when(originalMethod.apply(selfIntern, arguments)).done(function () {\r\n                    var data = {};\r\n                    self.collectRenderValues(data);\r\n\r\n                    $.when(self.submitSaveRequest(selfIntern.surrogateKey, data)).done(function () {\r\n                        self.fetchData();\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    },\r\n\r\n\r\n    collectRenderValues: function (renderValues) {\r\n        var self = this;\r\n\r\n        $.each(self.columns, function (i, child) {\r\n\r\n            child = child.decorated;\r\n\r\n            if (child.getElementType() == bizagi.rendering.element.ELEMENT_TYPE_CONTAINER) {\r\n                // Go though container\r\n                child.collectRenderValues(renderValues);\r\n            } else if (child.getElementType() == bizagi.rendering.element.ELEMENT_TYPE_RENDER) {\r\n                // Check if the render can be sent to the server\r\n                if (child.canBeSent()) {\r\n                    child.collectData(renderValues);\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Returns a promise that will resolve when the element is ready\r\n    */\r\n    ready: function () {\r\n        var self = this;\r\n        var parentPromise = self._super();\r\n        var inlineAddPromise = self.inlineAddDeferred ? self.inlineAddDeferred.promise() : null;\r\n\r\n        return $.when(parentPromise, inlineAddPromise);\r\n    },\r\n\r\n    /*   Sets an error on the cell\r\n    */\r\n    setError: function (key, xpath) {\r\n        var self = this;\r\n    },\r\n\r\n    /*\r\n    *  Changes the required for cell\r\n    */\r\n    changeCellValue: function (key, xpath, argument) {\r\n        var self = this;\r\n\r\n        var control = self.getControlCell(key, xpath);\r\n        if (control) {\r\n            if (argument != null)\r\n                control.setDisplayValue(argument);\r\n\r\n            //ISUPP 3866\r\n            var _value = control.column.getValue(key);\r\n            var compositeValue = control.column.getCompositeValue(key);\r\n\r\n            if (argument != null)\r\n                control.setDisplayValue(argument);\r\n\r\n            var trigger = false;\r\n            self.collectGridChange({\r\n                id: key,\r\n                xpath: xpath,\r\n                value: _value,\r\n                compositeValue: compositeValue,\r\n                columnIndex: control.column,\r\n                trigger: trigger\r\n            });\r\n        }\r\n    },\r\n    /*\r\n    *\r\n    */\r\n    changeCellBackgroundColor: function (key, xpath, argument) {\r\n        var self = this,\r\n            control = self.getControlCell(key, xpath);\r\n\r\n        if (control) {\r\n            control.changeCellBackgroundColor(argument);\r\n\r\n            //Exclusive for complex elements such as checkboxes, and list\r\n            if (control.element) {\r\n                control.element.find(\".bz-container-render-cell1, .bz-control\").css({\r\n                    \"background-color\": argument,\r\n                    \"background-image\": argument\r\n                });\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Changes the background for a cell\r\n    */\r\n    changeCellColor: function (key, xpath, argument) {\r\n        var self = this;\r\n\r\n        var control = self.getControlCell(key, xpath);\r\n        if (control)\r\n            control.changeCellColor(argument);\r\n\r\n    },\r\n    /*\r\n    *   Changes the visibility for a cell\r\n    */\r\n    changeCellVisibility: function (key, xpath, argument) {\r\n        var self = this;\r\n        var control = self.getControlCell(key, xpath);\r\n\r\n        if (control) {\r\n\r\n            control.changeCellVisibility(argument);\r\n            var index = (self.columns || [])\r\n                .findIndex(function (item) {\r\n                    return (\r\n                        item.properties.xpath == xpath ||\r\n                        item.properties.id == xpath ||\r\n                        item.properties.xpath + \".\" + item.properties.id == xpath\r\n                    );\r\n                }) || 0;\r\n\r\n            self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n            self.getCellOverride(key, index).visible = argument;\r\n\r\n            // Bind/Unbind the render change, so it can works with actions and validations as needed\r\n            if (control.properties.editable && argument) {\r\n                self.bindRenderChange(self.getColumn(xpath), key, true);\r\n            } else {\r\n                self.bindRenderChange(self.getColumn(xpath), key, false);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n    *   Changes the editability for a cell\r\n    */\r\n    changeCellEditability: function (key, xpath, argument) {\r\n        var self = this;\r\n        var control = self.getControlCell(key, xpath);\r\n        if (control) {\r\n            control.changeEditability(argument);\r\n            for (var j = 0, length = self.columns.length; j < length; j++) {\r\n                if (\r\n                    self.columns[j].properties.xpath == xpath ||\r\n                    self.columns[j].properties.id == xpath ||\r\n                    self.columns[j].properties.xpath + \".\" + self.columns[j].properties.id  == xpath\r\n                ){\r\n                    break;\r\n                }                   \r\n            }\r\n            self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n            self.getCellOverride(key, j).editable = argument;\r\n\r\n            // Bind/Unbind the render change, so it can works with actions and validations as neededn\r\n            if (control.properties.visible && argument) {\r\n                self.bindRenderChange(self.getColumn(xpath), key, true);\r\n            } else {\r\n                self.bindRenderChange(self.getColumn(xpath), key, false);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n    *   Changes the min value for a cell\r\n    */\r\n    changeCellMinValue: function (key, xpath, argument) {\r\n        var self = this;\r\n        var control = self.getControlCell(key, xpath);\r\n\r\n        if (control) {\r\n            control.changeMinValue(argument);\r\n            for (var j = 0, length = self.columns.length; j < length; j++) {\r\n                if (\r\n                    self.columns[j].properties.xpath == xpath ||\r\n                    self.columns[j].properties.id == xpath ||\r\n                    self.columns[j].properties.xpath + \".\" + self.columns[j].properties.id  == xpath\r\n                ){\r\n                    break;\r\n                }                   \r\n            }\r\n\r\n            self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n            self.getCellOverride(key, j).minValue = argument;\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Changes the max value for a cell\r\n     */\r\n    changeCellMaxValue: function (key, xpath, argument) {\r\n        var self = this;\r\n        var control = self.getControlCell(key, xpath);\r\n\r\n        if (control) {\r\n            control.changeMaxValue(argument);\r\n            for (var j = 0, length = self.columns.length; j < length; j++) {\r\n                if (\r\n                    self.columns[j].properties.xpath == xpath ||\r\n                    self.columns[j].properties.id == xpath ||\r\n                    self.columns[j].properties.xpath + \".\" + self.columns[j].properties.id  == xpath\r\n                ){\r\n                    break;\r\n                }                   \r\n            }\r\n\r\n            self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n            self.getCellOverride(key, j).maxValue = argument;\r\n        }\r\n    },\r\n\r\n    cleanCellData: function (key, xpath) {\r\n        var self = this;\r\n        var control = self.getControlCell(key, xpath);\r\n\r\n        if (control) {\r\n            control.cleanData();\r\n            for (var j = 0; j < self.columns.length; j++) {\r\n                if (\r\n                    self.columns[j].properties.xpath == xpath ||\r\n                    self.columns[j].properties.id == xpath ||\r\n                    self.columns[j].properties.xpath + \".\" + self.columns[j].properties.id  == xpath\r\n                ){\r\n                    break;\r\n                }                   \r\n            }\r\n\r\n            var rows = self.properties.data.rows, i = 0, rowLength = rows.length;\r\n            for (; i < rowLength; i++) {\r\n                if (Number(key) === rows[i][0]) {\r\n                    rows[i][j + 1] = [[\"\", \"\"]];\r\n                    break;\r\n                }\r\n            }\r\n            self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n            self.getCellOverride(key, j).value = null;\r\n        }\r\n    },\r\n\r\n    isValidGrid: function (invalidElements) {\r\n        var self = this;\r\n        var errorsMessage = [];\r\n        var form = self.getFormContainer();\r\n\r\n        if (typeof (form.validationController) !== \"undefined\")\r\n            form.validationController.clearValidationMessages();\r\n\r\n        self.isValid(errorsMessage);\r\n\r\n        if (errorsMessage.length > 0) {\r\n            if (typeof (form.validationController) !== \"undefined\") {\r\n                for (var i = 0, length = errorsMessage.length; i < length; i++) {\r\n                    // Show validation message\r\n                    form.validationController.showValidationMessage(errorsMessage[i].message, errorsMessage[i].xpath);\r\n                }\r\n            }\r\n\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Triggers the grid plugin event\r\n     * @returns {}\r\n     */\r\n    triggerGridPluginHandler: function () {\r\n        var self = this;\r\n        var args = Array.prototype.slice.call(arguments, 0);\r\n\r\n        return self.grid.bizagi_grid_smartphone.apply(self.grid, args);\r\n    },\r\n\r\n    /**\r\n     *  Adds a row to the grid\r\n     */\r\n    bindRenderChange: function (renderColumn, key, isBinding) {\r\n        var self = this;\r\n\r\n        if (isBinding) {\r\n\r\n            renderColumn.getDecorated(key).bind(\"renderchange\", function (render, args) {\r\n\r\n                var value = renderColumn.getValue(args.render.surrogateKey);\r\n                var compositeValue = renderColumn.getCompositeValue(args.render.surrogateKey);\r\n\r\n                if (renderColumn.properties.type == \"columnDate\") {\r\n                    if (!bizagi.util.isEmpty(value)) {\r\n                        var date = bizagi.util.dateFormatter.getDateFromInvariant(value, true);\r\n                        date.setSeconds(0);\r\n                        date.setMilliseconds(0);\r\n\r\n                        value = bizagi.util.dateFormatter.formatInvariant(date, true);\r\n                    } else if (value === \"\") {\r\n                        value = \"\";\r\n                    }\r\n                }\r\n                if(renderColumn.properties && !renderColumn.properties.isExclusive){\r\n                    self.collectGridChange($.extend(args, {\r\n                        id: args.render.surrogateKey,\r\n                        xpath: renderColumn.properties.xpath || renderColumn.properties.id,\r\n                        value: value,\r\n                        compositeValue: compositeValue,\r\n                        columnIndex: renderColumn.columnIndex\r\n                    }));\r\n                }\r\n\r\n                // Update change in grid's component data\r\n                self.grid.bizagi_grid_smartphone(\"changeCellValue\", args.render.surrogateKey, renderColumn.columnIndex,\r\n                    value);\r\n\r\n                // If the column has totalizers then we need to refresh the summary\r\n                if (renderColumn.properties.totalize && renderColumn.properties.totalize.operation) {\r\n                    self.grid.bizagi_grid_smartphone(\"refreshSummary\", renderColumn.columnIndex);\r\n                }\r\n            });\r\n        } else {\r\n            renderColumn.getDecorated(key).unbind(\"renderchange\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Call the form failhandler with an specific error\r\n     * @param {} error\r\n     * @returns {}\r\n     */\r\n    executeFormFailHandler: function (error) {\r\n        var self = this;\r\n        var errorResponse = error.responseText ? error.responseText : bizagi.localization.getResource(\"workportal-general-error\");\r\n        self.getFormContainer().failHandler(errorResponse);\r\n    },\r\n\r\n    /**\r\n     * Returns the indexes of all elements in the grid\r\n     * @returns {*}\r\n     */\r\n    getIndexes: function () {\r\n        var self = this;\r\n        var data = $.merge(self.properties.data.rows, self.getDataNewRows());\r\n\r\n        return data.reduce(function (acum, current) {\r\n            if (typeof acum.find(function (el) {\r\n                return el[0] == current[0];\r\n            }) === 'undefined') {\r\n                acum.push(current);\r\n            }\r\n            return acum;\r\n        }, []).map(function (item) {\r\n            return item[0];\r\n        });\r\n    },\r\n\r\n    startLoading: function () {\r\n        bizagi.loading.start();\r\n    },\r\n\r\n    endLoading: function () {\r\n        bizagi.loading.stop();\r\n    },\r\n\r\n    /**\r\n     * Checks if it is possible to perform the related action \r\n     */\r\n    grantPerformAction: function(action, success, error){\r\n        var self = this;\r\n        if(action == \"addRow\" || action  == \"navigateToPage\"){\r\n            var data = self.properties.data;\r\n            var rows = data && data.rows ? data.rows : [];\r\n            if (rows.length === 0) {\r\n                success();\r\n            } else if (self.isValidGrid()) {\r\n                self.submitGridData().then(function(){\r\n                    if (success) \r\n                        success();\r\n                }).fail(function(){\r\n                    if (error) \r\n                        error();\r\n                });\r\n            } else {\r\n                if (error) \r\n                    error();\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * Saves just changes in the grid\r\n     */\r\n    submitGridData: function(){\r\n        var data = {},\r\n            def = new $.Deferred();\r\n        this.collectData(data);\r\n        if (JSON.stringify(data) === JSON.stringify({})){\r\n            def.resolve();\r\n        } else {\r\n            //submit without refresh and not collect\r\n            this.submitOnChange(data, false, true).then(function(){\r\n                def.resolve();\r\n            }).fail(function(){\r\n                def.reject();\r\n            });\r\n        }\r\n        return def.promise();\r\n    },\r\n    \r\n    addExclusiveChange : function(id, data, grid){\r\n        var self = grid? grid : this;            \r\n        if(self.properties.hasExclusiveCheck){\r\n            for(xpath in data){\r\n                 var column = self.columns.find(function(el){\r\n                     return el.properties.xpath == xpath;\r\n                 });\r\n                 // Check if some of the changes from the edit or add form match with the exclusive controls in the grid\r\n                 var value = data[xpath];\r\n                 if(column && column.properties.isExclusive && value){\r\n                     self.exclusiveChanges[xpath] =  {\r\n                         xpath : xpath,\r\n                         simpleXpath: xpath,\r\n                         value : value,\r\n                         key:id\r\n                     }\r\n                 }\r\n            }                    \r\n        }\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Grid Offline Extension\r\n *   Author: Daniel Ordonez\r\n *   Comments:\r\n *   -   This script will redefine the offline grid render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.grid.extend(\"bizagi.rendering.smartphone.grid.offline\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (params) {\r\n        var self = this;\r\n        var originalRows = bizagi.clone(params.data.properties.data.rows);     \r\n        var completeRows = bizagi.clone(params.data.properties.data.rows);     \r\n        // Call base\r\n        this._super(params);\r\n        var properties = this.properties;\r\n        properties.data.originalRows = originalRows;\r\n        properties.data.completeRows = completeRows;\r\n        // Check if offline forms is supported\r\n        this.isOfflineForm = bizagi.util.isOfflineForm({context: self});\r\n\r\n        // Fill default properties\r\n        var form = self.getFormContainer();        \r\n    \r\n        properties.isTaskForm = form.properties.isTaskForm\r\n        self.newRecords = {};\r\n        //Preload new lines previously added offline\r\n        if(properties[\"new-records\"]) {            \r\n            var newRowKeys = Object.keys(properties[\"new-records\"]);\r\n            for(var k = 0; k< newRowKeys.length;k++) {\r\n                self.newRecords[newRowKeys[k]] = { createdOffline: true };\r\n                self.changes[newRowKeys[k]] = properties[\"new-records\"][newRowKeys[k]];                \r\n            }\r\n        }\r\n        self[\"deleted-records\"] = properties[\"deleted-records\"] ? properties[\"deleted-records\"] : {};\r\n\r\n        if (properties.groupBy || properties.groupSummary) {\r\n            // Add warning\r\n            form.addWarning(self.getResource(\"render-tablet-warning-grid\"));\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Template method to implement in each device to customize each render after processed\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var control = self.getControl();\r\n\r\n        self.initialLoadDone = false;\r\n\r\n        // Find component holder\r\n        self.grid = $(\">div\", control);\r\n\r\n        // Hide common label\r\n        self.getLabel().hide();\r\n\r\n        // Grid plugin\r\n        self.applyGridPlugin();\r\n\r\n        // Just for smartphones we need to take only one row if there is data in the json, because we use just one row per page\r\n        if (properties.data && properties.data.completeRows && properties.data.completeRows.length > 0) {\r\n            var newData = [];\r\n            newData.push(properties.data.completeRows[0]);\r\n            properties.data.rows = newData;\r\n        }\r\n\r\n        // Set initial data\r\n        if (properties.data) {\r\n\r\n            self.updateData(properties.data);\r\n\r\n            // Trigger change in order to start up the actions when the controls is ready\r\n            $.when(self.ready()).done(function () {\r\n                    self.triggerRenderChange({changed: false});\r\n                });\r\n        }\r\n\r\n        // Execute pending actions\r\n        self.initialLoadDone = true;\r\n\r\n        for (var i in self.pendingActions) {\r\n            self.pendingActions[i].method.apply(self, self.pendingActions[i].arguments);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Method to render non editable values\r\n    */\r\n    postRenderReadOnly: function () {\r\n        var self = this;\r\n\r\n        // Do the same as the post-render            \r\n        self.postRender();\r\n    },\r\n\r\n    /*\r\n    *   Method to render non editable values\r\n    */\r\n    applyGridPlugin: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var grid = self.grid;\r\n        var mode = self.getMode();\r\n\r\n        // Build column metadata\r\n        var columns = self.buildColumnModel();\r\n\r\n        // Apply grid plugin\r\n        grid.bizagi_grid_smartphone({\r\n            columns: columns,\r\n            title: properties.displayName,\r\n            isOfflineForm: this.isOfflineForm || false,\r\n            mode: self.getMode(),\r\n            template: {\r\n                grid: self.renderFactory.getTemplate(\"bizagi.grid.grid\"),\r\n                waiting: self.renderFactory.getTemplate(\"bizagi.grid.waiting\"),\r\n                table: self.renderFactory.getTemplate(\"bizagi.grid.table\"),\r\n                emptyTable: self.renderFactory.getTemplate(\"bizagi.grid.table.empty\"),\r\n                column: self.renderFactory.getTemplate(\"bizagi.grid.column\"),\r\n                specialColumn: self.renderFactory.getTemplate(\"bizagi.grid.column.special\"),\r\n                row: self.renderFactory.getTemplate(\"bizagi.grid.row\"),\r\n                rowButtons: self.renderFactory.getTemplate(\"bizagi.grid.row.buttons\"),\r\n                cell: self.renderFactory.getTemplate(\"bizagi.grid.cell\"),            \r\n                pager: self.renderFactory.getTemplate(\"bizagi.grid.pager\"),                \r\n                specialCell: self.renderFactory.getTemplate(\"bizagi.grid.offline.cell.special\"),\r\n                buttons: self.renderFactory.getTemplate(\"bizagi.grid.buttons\")\r\n            },\r\n            actions: {\r\n                add: properties.allowAdd,\r\n                edit: (properties.allowEdit && properties.withEditForm && properties.data != null),\r\n                remove: properties.allowDelete,               \r\n                inlineAdd: properties.inlineAdd,\r\n                details: false,\r\n                allowMore: false,\r\n                enableXlsExport: false,\r\n                enablePdfExport: false,\r\n                hasTotalizer: false\r\n            },\r\n            isValid: function () {\r\n                return self.isValidGrid();\r\n            },\r\n            pageRequested: function (ui) {\r\n                if (mode !== \"execution\") return;\r\n                self.onPageRequested(ui)\r\n            },\r\n            totalData: function(ui) {\r\n                if (mode != \"execution\") return;\r\n                //self.onTotalData();\r\n            },\r\n            drawCell: function (ui) {\r\n                return self.drawCell(ui.column, ui.key, ui.value, ui.isNewRow);\r\n            },\r\n            cellReady: function (ui) {\r\n                return self.onCellReady(ui.column, ui.key, ui.cell, ui.isNewRow);\r\n            },\r\n            rowSelected: function (ui) {                \r\n                //self.triggerHandler(\"rowSelected\", {id: ui.key, data: ui});\r\n            },\r\n            addRow: function (ui) {\r\n                if (mode !== \"execution\") return;\r\n                self.addRow();\r\n            },\r\n            editRow: function (ui) {\r\n                if (mode !== \"execution\") return;\r\n                self.editRow(ui.key);\r\n            },\r\n            deleteRow: function (ui) {\r\n                if (mode !== \"execution\") return;\r\n                self.deleteRow(ui.key);\r\n            },\r\n            showMore: function (ui) {\r\n                self.showMore(ui.key);\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Method to fetch data from the server and then update the data\r\n    */\r\n    fetchData: function (page, sortBy, sortType) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Define defaults\r\n        page = page || 1;\r\n        sortBy = sortBy || \"\";\r\n        sortType = sortType || \"asc\";\r\n\r\n        // Update control properties\r\n        properties.page = page;\r\n        properties.sort = sortBy + \" \" + sortType;\r\n\r\n        self.dataReadyDeferred = new $.Deferred();\r\n\r\n        // Start loading to avoid multiple calls to the server\r\n        self.startLoading();\r\n\r\n        $.when(self.getRemoteData()).then(function (data) {\r\n            self.endLoading();\r\n            if (data) {\r\n                self.updateData(data);\r\n                self.triggerRenderChange();\r\n                self.dataReadyDeferred.resolve();\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n    * Method not required in smartphone implementation\r\n    */\r\n    processChanges: function () {\r\n        var self = this;\r\n        var rowsList = [];\r\n        return rowsList;\r\n    },\r\n\r\n    /*\r\n    *   Add the render data to the given collection in order to send data to the server\r\n    */\r\n    collectData: function (renderValues) {\r\n        var self = this;\r\n        var errorsMessage = [];\r\n        var internalRedersValues = [];\r\n        var properties = self.properties;\r\n        var data = self.properties.data;\r\n        var temporalNew = {};\r\n        // Save pending inline add rows\r\n        if (self.isValid(errorsMessage)) {\r\n            for (var id in self.changes) {\r\n                var sortArray = [];\r\n                var currentChanges = {};                \r\n                for (var columnXpath in self.changes[id]) {\r\n\r\n                    // Check if the render can submit data\r\n                    if (self.canColumnBeSent(id, columnXpath)) {\r\n                        var columnNumber = self.getColumn(columnXpath).columnIndex - 1;\r\n                        var value = self.changes[id][columnXpath];\r\n\r\n                        if (typeof value === \"string\") {\r\n                            if (value.match(/\\n/gm) !== null) {\r\n                                value = value.replaceAll(\"\\n\", \"\\\\n\");\r\n                            }\r\n                        }\r\n\r\n                        sortArray[columnNumber] = value;                                  \r\n                        var xpath = properties.xpath + self.buildCellXpathFilter(id) + \".\" + columnXpath;\r\n                        var columnValue = self.changes[id][columnXpath];\r\n                        var value = columnValue && columnValue.value ? columnValue.value : columnValue;                                \r\n                        renderValues[xpath] = value;\r\n                        //Changes are store to delete them if the row is new, the rest of changes can be saved by xpath\r\n                        currentChanges[xpath] = value;\r\n                    }\r\n                }\r\n                //If new record store action data\r\n                if(self.newRecords[id]) {\r\n                    //Use - to avoid issues with possible xpaths in renderValues used both in new and deleted records\r\n                    var addRowData = {\r\n                        url: properties.addUrl,\r\n                        idRender: properties.id,\r\n                        xpath: properties.xpath,\r\n                        xpathContext: properties.xpathContext,\r\n                        contexttype: properties.contexttype,\r\n                        idPageCache: properties.idPageCache,\r\n                        submitData: self.changes[id],\r\n                        prepare: true,\r\n                        idRow: parseInt(id+'')\r\n                    }\r\n                    temporalNew[id] = addRowData;\r\n                    for(change in currentChanges) {\r\n                        delete renderValues[change];\r\n                    }\r\n                    var details = {}; \r\n                    details.idRow = parseInt(id+'');     \r\n                    details.isNew = true; \r\n                    details.changes = self.changes[id]; \r\n                    sortArray.push(details); \r\n                    if (!self.newRecords[id].createdOffline)                         \r\n                        internalRedersValues[internalRedersValues.length] = sortArray;                                            \r\n                } \r\n            }\r\n        }\r\n\r\n        // Get data\r\n        if (JSON.stringify(data.completeRows) !== JSON.stringify(data.originalRows) || internalRedersValues.length > 0) {\r\n            renderValues[properties.xpath] = renderValues[properties.xpath]? renderValues[properties.xpath]: {} \r\n            if (typeof (data.completeRows) !== \"undefined\" && data.completeRows.length > 0) {\r\n                renderValues[properties.xpath].rows = self.processOldRows(data.completeRows);\r\n            } else {\r\n                renderValues[properties.xpath].rows = internalRedersValues;\r\n            }\r\n            if(self[\"deleted-records\"] && Object.keys(self[\"deleted-records\"]).length > 0 )\r\n                renderValues[properties.xpath][\"deleted-records\"] = self[\"deleted-records\"];\r\n            if(temporalNew && Object.keys(temporalNew).length > 0)\r\n                renderValues[properties.xpath][\"new-records\"] = temporalNew;\r\n        }\r\n        \r\n\r\n    },\r\n\r\n    /*\r\n    *   Delete field id array objects\r\n    */\r\n    processOldRows: function (rows) {\r\n        var newRows = [];\r\n        var tempRows = rows;\r\n        var self = this;\r\n\r\n        for (var col = 0, leng = tempRows.length; col < leng; col++) {\r\n            var temp = tempRows[col];\r\n            newRows[col] = $.grep(temp, function (n, i) {\r\n                return i > 0;\r\n            });\r\n            var details = {}; \r\n            details.idRow = parseInt(temp[0]+'');     \r\n            details.isNew = self.newRecords[temp[0]]? true : false; \r\n            details.changes = self.changes[temp[0]] ? self.changes[temp[0]] : {}; \r\n            newRows[col].push(details); \r\n        }\r\n\r\n        return newRows;\r\n    },\r\n    /*\r\n    *   Delete field id array\r\n    */\r\n    processRow: function (row) {\r\n        return $.grep(row, function (n, i) {\r\n            return i > 0;\r\n        });\r\n    },\r\n\r\n    onPageRequested: function (ui) {\r\n        var self = this;\r\n        self.fetchData(ui.page, ui.sortBy, ui.sortType);\r\n    },\r\n\r\n    /*\r\n    *   Customizes the content drawing inside the cell\r\n    */\r\n    drawCell: function (column, key, value, isNewRow) {\r\n        var self = this;\r\n\r\n        if (column.key) return value;\r\n\r\n        if (typeof (value) === \"object\" && value!==null && !isNewRow) {\r\n            value = value.hasOwnProperty(\"value\") ? value.value : value;\r\n        }\r\n\r\n        // Get render column                \r\n        var columnIndex = column.index - 1;\r\n        var renderColumn = self.columns[columnIndex];\r\n        var cellOverride = self.getCellOverride(key, column.index - 1);\r\n\r\n        self.newRecords = self.newRecords || {};\r\n\r\n        // Get cell properties\r\n        if (!self.cellMetadata[key]) self.cellMetadata[key] = {};\r\n        if (!self.cellMetadata[key][columnIndex]) self.cellMetadata[key][columnIndex] = {};\r\n        var properties = self.cellMetadata[key][columnIndex].properties || renderColumn.originalProperties;\r\n\r\n        var visible = properties.visible !== undefined ? properties.visible : true;\r\n        var editable = properties.editable !== undefined ? properties.editable : true;\r\n\r\n        // Apply overrides from cellOverrides\r\n        visible = cellOverride.visible;\r\n        editable = properties.editable ? cellOverride.editable : false;\r\n\r\n        // Show editable cell when we are performing inline add operation\r\n        if (isNewRow) editable = true;\r\n\r\n        // If the cell we are drawing is the summary cell, we need to make it readonly\r\n        if (key === \"summary\") editable = false;\r\n\r\n        renderColumn.properties.displayType = 'value';\r\n        renderColumn.setValue(key, value);\r\n        renderColumn.setSurrogateKey(key);\r\n        renderColumn.properties.data = renderColumn.properties.data || [];\r\n\r\n        // Column search\r\n        if (renderColumn.properties.type === \"columnSearch\" && value != null) {\r\n            for (var i = 0, len = renderColumn.properties.data.length; i < len; i++) {\r\n                if (renderColumn.properties.data[i].id == value) {\r\n                    value = {id: renderColumn.properties.data[i].id, label: renderColumn.properties.data[i].value};\r\n                }\r\n            }\r\n        }\r\n\r\n        if ((renderColumn.properties.type === \"columnCombo\" || renderColumn.properties.type === \"columnList\") && value != null) { //|| renderColumn.properties.type == \"columnRadio\"\r\n            for (var i = 0, len = renderColumn.properties.data.length; i < len; i++) {\r\n                if (renderColumn.properties.data[i].id == value) {\r\n                    value = [[renderColumn.properties.data[i].id, renderColumn.properties.data[i].value]];\r\n                }\r\n            }\r\n        }\r\n\r\n        // Column text\r\n        if (renderColumn.properties.type === \"columnText\" && bizagi.util.isEmpty(value) && value != null) {\r\n            value = \"\";\r\n        }\r\n\r\n        // Do the render\r\n        if (visible) {\r\n            if (editable) {\r\n                return self.drawEditableCell(renderColumn, properties, key, value, isNewRow);\r\n            } else {\r\n                return self.drawReadonlyCell(renderColumn, properties, key, value);\r\n            }\r\n        } else {\r\n            return \"\";\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Draws the editable version for the cell\r\n    */\r\n    drawEditableCell: function (renderColumn, properties, key, value, isNewRow) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        // Set editable\r\n        var originalEditable = renderColumn.properties.editable;\r\n        renderColumn.properties.editable = true;\r\n\r\n        // Fix problem when required property lose\r\n        renderColumn.overrideProperties({required: properties.required});\r\n\r\n        // Render cell\r\n        $.when(renderColumn.render(key, value)).done(function (cell) {\r\n            // Register array with new records, just when this is a new-record\r\n            if (isNewRow && !self.newRecords[key]) {\r\n                self.newRecords[key] = {};\r\n            }\r\n\r\n            // convert all row visible\r\n            for (var j = 0; j < self.columns.length; j++) {\r\n                self.cellOverrides[key] = self.cellOverrides[key] || {};\r\n                self.getCellOverride(key, j).visible = (self.getCellOverride(key, j).visible != undefined) ? self.getCellOverride(key, j).visible : true;\r\n            }\r\n\r\n            // Add change handler  \r\n            renderColumn.getDecorated(key).bind(\"renderchange\", function (render) {\r\n                self.onCellChange(renderColumn, cell, key);\r\n            });\r\n\r\n            // Resolve cell\r\n            defer.resolve(cell);\r\n        });\r\n\r\n        // Restore editable\r\n        renderColumn.properties.editable = originalEditable;\r\n\r\n        // Return promise\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n    *   Draws the readonly version for the cell\r\n    */\r\n    drawReadonlyCell: function (renderColumn, properties, key, value) {\r\n        var result = \"\";\r\n\r\n        // Use totalizer format when printing summary row\r\n        if (key === \"summary\") {\r\n            var originalFormat = renderColumn.properties.textFormat;\r\n            if (renderColumn.properties.totalize) {\r\n                renderColumn.properties.textFormat = renderColumn.properties.totalize.format;\r\n            }\r\n\r\n            result = renderColumn.renderSummary(key, value);\r\n\r\n            // Restore column format\r\n            renderColumn.properties.textFormat = originalFormat;\r\n        } else {\r\n            result = renderColumn.renderReadOnly(key, value);\r\n        }\r\n        return result;\r\n    },\r\n\r\n    /*\r\n    *   Defines the handler when a cell changes its value\r\n    */\r\n    onCellChange: function (renderColumn, cell, key) {\r\n\r\n        var self = this;\r\n        var _value = renderColumn.getValue(key);\r\n        var compositeValue = renderColumn.getCompositeValue(key);\r\n\r\n        if (renderColumn.properties.type === \"columnDate\" && renderColumn.data.properties.showTime == true) {\r\n\r\n            if (!bizagi.util.isEmpty(_value)) {\r\n                var date = bizagi.util.dateFormatter.getDateFromInvariant(_value, true);\r\n                _value = bizagi.util.dateFormatter.formatInvariant(date, true);\r\n            } else if (_value === \"\") {\r\n                _value = \"\";\r\n            }\r\n        } else if (renderColumn.properties.type === \"columnDate\") {\r\n\r\n            if (!bizagi.util.isEmpty(_value)) {\r\n                var date = bizagi.util.dateFormatter.getDateFromInvariant(_value, false);\r\n                date.setHours(0, 0, 0, 0);\r\n                _value = bizagi.util.dateFormatter.formatInvariant(date, true);\r\n            } else if (_value === \"\") {\r\n                _value = \"\";\r\n            }\r\n        }\r\n\r\n        if (self.properties.allowEdit || self.grid.bizagi_grid_smartphone(\"isNewRecord\", key)) {\r\n            var trigger = self.grid.bizagi_grid_smartphone(\"isNewRecord\", key) ? false : true;\r\n            self.collectGridChange({\r\n                id: key,\r\n                xpath: renderColumn.properties.xpath,\r\n                value: _value,\r\n                compositeValue: compositeValue,\r\n                columnIndex: renderColumn.columnIndex,\r\n                trigger: trigger\r\n            });\r\n        }\r\n\r\n        // Update change in grid's component data\r\n        self.grid.bizagi_grid_smartphone(\"changeCellValue\", key, renderColumn.columnIndex, _value);\r\n\r\n        // If the column has totalizers then we need to refresh the summary\r\n        if (renderColumn.properties.totalize && renderColumn.properties.totalize.operation) {\r\n            self.grid.bizagi_grid_smartphone(\"refreshSummary\", renderColumn.columnIndex);\r\n        }\r\n    },\r\n    /*\r\n    *   Collect a single cell change made in the grid to send the data when the user saves the form\r\n    */\r\n    collectGridChange: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var id = params.id;\r\n        var xpath = params.xpath;\r\n        var value = params.value;\r\n        var trigger = typeof (params.trigger) !== \"undefined\" ? params.trigger : true;\r\n\r\n        self.changes[id] = self.changes[id] || {};\r\n        self.changes[id][xpath] = value;\r\n\r\n        if (trigger)\r\n            self.triggerRenderChange({key: id, column: xpath});\r\n    },\r\n\r\n    /**\r\n     *  Adds a row to the grid\r\n     */\r\n    addRow: function () {\r\n\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var data = properties.data;\r\n        // Handle information stored offline based on data        \r\n        var newData = [];\r\n        var newRow = self.createAddRowData();\r\n        newData.push(newRow);\r\n\r\n        //Support for deletion and new rows\r\n        self.newRecords[newRow[0]] = { createdOffline: true };\r\n\r\n        data.rows = newData;\r\n        data.completeRows.push(newRow);\r\n        data.records++;\r\n        data.page = data.records;        \r\n        \r\n        self.updateData(data);\r\n        self.triggerRenderChange();\r\n    },\r\n\r\n    /**\r\n     * Creates a dummy data for the new row\r\n     * @returns {}\r\n     */\r\n    createAddRowData: function () {\r\n        var self = this;\r\n        \r\n        var row = [];\r\n        var key = Math.ceil(Math.random() * 100000);\r\n        row.push(key);\r\n        $.each(self.columns, function (i) {\r\n                row.push(null);            \r\n        });\r\n\r\n        return row;\r\n    },\r\n\r\n    /**\r\n     *  Edits a row in the grid\r\n     */\r\n    editRow: function (id) {\r\n    },\r\n\r\n    /**\r\n     *  Deletes a row to the grid\r\n     */\r\n    deleteRow: function (id) {\r\n        var self = this;\r\n\r\n        if (!id || id == 0) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"render-grid-message-no-selected-row\"), bizagi.localization.getResource(\"render-grid-header-no-selected-row\"));\r\n            return;\r\n        }\r\n\r\n        bizagi.showConfirmationBox(this.getResource(\"render-grid-delete-confirmation\")).done(function () {\r\n            // Do a grid record deletion\r\n            $.when(self.submitDeleteRequest(id))\r\n                .done(function () {\r\n                    // Reload grid\r\n                    self.fetchData();\r\n                });\r\n        });\r\n    },\r\n\r\n    /**\r\n     *  Edits the entire row (inline) in another slide\r\n     */\r\n    editInline: function (id) {\r\n    },\r\n    /*\r\n    *   Retrieve the data for the new rows and push them into the server\r\n    */\r\n    saveInlineAddedRows: function (keys, bRefresh) {\r\n        var self = this;\r\n        var rows = self.processChanges();\r\n\r\n        if (!bizagi.util.isEmpty(rows)) {\r\n            self.properties.data.rows = $.merge(self.properties.data.rows, rows);\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Removes invalid records \r\n    */\r\n    removeNewRecords: function (ui) {\r\n        var self = this;\r\n\r\n        if (ui && ui.keys) {\r\n            $.each(ui.keys, function (_, key) {\r\n                if (self.newRecords[key]) {\r\n                    delete self.newRecords[key];\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Fetch the data into a deferred\r\n    */\r\n    getRemoteData: function (params) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Set params\r\n        params = params || {};\r\n\r\n        // Check if a custom method has been given\r\n        if (properties.overrideGetRemoteData) {\r\n            var result = properties.overrideGetRemoteData(params);\r\n            return result != null ? result.promise() : null;\r\n        }\r\n\r\n        // Default ajax call\r\n        var defer = new $.Deferred();\r\n\r\n        \r\n        // Resolve with remote data\r\n        var data = properties.data;\r\n        // Handle information stored offline based on data\r\n        if (properties.data && properties.data.completeRows && properties.data.completeRows.length > 0) {\r\n            var newData = [];\r\n            newData.push(properties.data.completeRows[(properties.page-1)]);\r\n            properties.data.rows = newData;\r\n            properties.data.page = properties.page;\r\n        }\r\n        else if (properties.data.completeRows && properties.data.completeRows.length == 0 ) {\r\n            properties.data.rows = [];            \r\n        }                \r\n\r\n        // Check RTL\r\n        if (self.isRTL()) {\r\n            data.rows = self.changeOrderData(data.rows);\r\n        }\r\n\r\n        defer.resolve(data);\r\n\r\n        return defer.promise();\r\n    },\r\n    /*\r\n    *   Submits a grid delete record request for the given id \r\n    *   Returns a deferred\r\n    */\r\n    submitDeleteRequest: function (id) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var data = self.properties.data;\r\n        for (var i = 0, length = data.completeRows.length; i < length; i++) {\r\n            if (data.completeRows[i][0] == id) {\r\n\r\n                data.completeRows.splice(i, 1);\r\n                i--;\r\n\r\n                data.records--;\r\n                //Enters if it was created online\r\n                if(!self.newRecords[id])\r\n                {\r\n                    var xpath = properties.xpath + self.buildCellXpathFilter(id);\r\n\r\n                    var delInfo = {\r\n                        url: properties.deleteUrl,\r\n                        idRender: properties.id,\r\n                        xpath: xpath,\r\n                        xpathContext: properties.xpathContext,\r\n                        idPageCache: properties.idPageCache,\r\n                        contexttype: properties.contextType,\r\n                        prepare: true\r\n                    }\r\n                    self[\"deleted-records\"][id] = delInfo;\r\n                }else{\r\n                    delete self.newRecords[id];\r\n                    delete self.changes[id];\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return (data.completeRows);\r\n    },\r\n\r\n    isValidGrid: function () {\r\n        var self = this;\r\n        var errorsMessage = [];\r\n        var form = self.getFormContainer();\r\n\r\n        if (typeof (form.validationController) !== \"undefined\")\r\n            form.validationController.clearValidationMessages();\r\n\r\n        //self.isValid(errorsMessage);\r\n\r\n        if (errorsMessage.length > 0) {\r\n            if (typeof (form.validationController) !== \"undefined\") {\r\n                for (var index = 0; index < errorsMessage.length; index++) {\r\n                    form.validationController.showValidationMessage(errorsMessage[index].message, errorsMessage[index].xpath);\r\n                }\r\n            }\r\n\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Grouped Grid Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the Grouped Grid render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from Grid Smartphone base\r\nbizagi.rendering.smartphone.grid.extend(\"bizagi.rendering.smartphone.grid.grouped\", {}, {\r\n\r\n    /**\r\n     * Method to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        this.getControlFiller().addClass(\"bz-form-item__control--hidden\");\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        this.getControlFiller().addClass(\"bz-form-item__control--hidden\");\r\n    },\r\n\r\n    isValidGrid: function (invalidElements) {\r\n        return this._super(invalidElements);\r\n    }\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Search Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the search render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.search\", bizagi.rendering.search.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.search.extend(\"bizagi.rendering.smartphone.search\", {\r\n    ADVANCED_SEARCH_ID: -1,\r\n    ADVANCED_ADDITION_ID: -2,\r\n    CLEAR_SEARCH_ID: -3,\r\n    NO_RESULTS_SEARCH_ID: -4,\r\n    DEFAULT_SEARCH_ID: \"\",\r\n    SEARCH_MIN_LENGTH: 3,\r\n    SEARCH_DELAY: 250,\r\n    SEARCH_MAX_RECORDS: 50\r\n}, {\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param {} data submitData\r\n     * @returns {}\r\n     */\r\n    initializeData: function (data) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(data);\r\n\r\n        // Check if offline forms is supported\r\n        this.isOfflineForm = bizagi.util.isOfflineForm({context: this});\r\n        this.properties.submitOnChange = this.isOfflineForm ? false : this.properties.submitOnChange;\r\n\r\n        // Store reference of all ajax request in order to run only one instance of them\r\n        this.deferredReference = null;\r\n    },\r\n\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n        var value = this.getDisplayValue();\r\n        var label = value.label || value.value;\r\n\r\n        if (typeof label != \"undefined\") {\r\n            if (typeof label == \"object\")\r\n                label = label.join(\" - \");\r\n        } else {\r\n            label = \"\";\r\n        }\r\n\r\n        if (typeof label == \"string\") {\r\n            if (value.additionallabel) {\r\n                label += \" - \" + value.additionallabel;\r\n            }\r\n\r\n            label = bizagi.util.sanitizeHTML(label);\r\n        }\r\n\r\n        return $.fasttmpl(template, {\r\n            value: label,\r\n            editable: this.properties.editable\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     * @returns {}\r\n     */\r\n    postRender: function () {\r\n        this.searchInput = $(\".bz-input-icon\", this.getControl());\r\n    },\r\n\r\n    postRenderReadOnly: function () {\r\n        this.searchInput = $(\".bz-input-icon\", this.getControl());\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour\r\n     * to add handlers\r\n     * @returns {}\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        // Select new item\r\n        $(\".bz-input-icon\", control).on(\"click\", function () {\r\n            if (!self.properties.advancedSearch || self.isOfflineForm) {\r\n                self._simplySearchView();\r\n            } else {\r\n                self._advanceSearchView();\r\n            }\r\n        });\r\n\r\n        $(\".bz-icn--clear\", control).bind(\"click\", function (event) {\r\n            // Change display icon\r\n            $(\".bz-input-icon\", control).addClass(\"bz-input-icon--empty\");\r\n\r\n            // Call clean data\r\n            self.cleanData();\r\n\r\n            // Submit info to server\r\n            self.readyActionExecution().done(function () {\r\n                if (self.properties.submitOnChange) {\r\n                    self.submitData();\r\n                }\r\n            });\r\n\r\n            event.stopPropagation();\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Configure the modalView Handlers for the new suggest control\r\n     * @param {} inputContainer\r\n     * @returns {}\r\n     */\r\n    configureModalViewHandlers: function (modalView) {\r\n        var self = this;\r\n\r\n        // Configuring list as a selectable element\r\n        self.modalViewList = $(\".bz-list\", modalView.content);\r\n\r\n        // Suggest\r\n        var suggestFilter = bizagi.util.debounce(function (value) {\r\n            self.autoCompleteSearchResults($.trim(value));\r\n        }, self.Class.SEARCH_DELAY);\r\n\r\n        $(\"[data-action=close]\", modalView.header).bind(\"click\", function () {\r\n            modalView.close();\r\n        });\r\n\r\n        var $clearButton = $(\".bz-modal-view__clear\", modalView.header);\r\n        var $searchInput = $(\".bz-modal-view__search\", modalView.header);\r\n\r\n        $clearButton.bind(\"click\", function () {\r\n            $searchInput.val(\"\").trigger(\"clean\");\r\n        });\r\n\r\n        // Setting the initial selected display value\r\n        $(\".bz-list\", modalView.content).on(\"click\", \"li\", function () {\r\n            var item = $.data(this).item;\r\n            if (!item || (item && item.id == self.Class.NO_RESULTS_SEARCH_ID))\r\n                return;\r\n\r\n            self.selectItem(item);\r\n            modalView.close();\r\n        });\r\n\r\n        // Filtering list\r\n        $searchInput.bind(\"clean keyup\", function () {\r\n            if (this.value == \"\") {\r\n                $clearButton.removeClass(\"bz-modal-view__clear--visible\");\r\n            } else {\r\n                $clearButton.addClass(\"bz-modal-view__clear--visible\");\r\n            }\r\n            suggestFilter(this.value);\r\n        }).on(\"focus\", function () {\r\n            modalView.header.addClass(\"bz-modal-view__header--active\");\r\n        }).on(\"blur\", function () {\r\n            modalView.header.removeClass(\"bz-modal-view__header--active\");\r\n        });\r\n\r\n\r\n    },\r\n\r\n    /**\r\n     * Opens the search slide\r\n     * @private\r\n     */\r\n    _advanceSearchView: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var formSearchParams = $.extend({}, self.getParams(), {\r\n                navigation: self.getFormContainer().getNavigation()\r\n            }\r\n        );\r\n\r\n        var searchForm = new bizagi.rendering.smartphone.helpers.searchForm(\r\n            self.dataService, self.renderFactory,\r\n            properties.searchForms, {\r\n                allowFullSearch: properties.allowFullSearch,\r\n                maxRecords: properties.maxRecords,\r\n                allowNew: properties.allowNew || false,\r\n                orientation: properties.orientation || \"ltr\",\r\n                editable: properties.editable\r\n            },\r\n            formSearchParams\r\n        );\r\n\r\n        searchForm.renderEdition({\r\n            idRender: properties.id,\r\n            xpath: properties.xpath,\r\n            xpathContext: properties.xpathContext,\r\n            displayName: properties.displayName,\r\n            idPageCache: properties.idPageCache\r\n        }).done(function (itemId) {\r\n            self.setValue({id: itemId});\r\n            \r\n            self.readyActionExecution().done(function () {\r\n                var form = self.getFormContainer();\r\n                if (!self.properties.submitOnChange) {                    \r\n                    $.when(form.submitData()).done(function () {\r\n                        self.refreshControl();\r\n                    });                    \r\n                }                \r\n            });\r\n        }) ;\r\n    },\r\n\r\n    /**\r\n     * Simply search autocomplete\r\n     * @private\r\n     */\r\n    _simplySearchView: function () {\r\n        var self = this;\r\n        var content = self.getContentTemplate();\r\n\r\n        self.searchInput.mobileView({\r\n            customHeader: $.fasttmpl(self.renderFactory.getTemplate(\"modal-header-search\"), {}),\r\n            orientation: self.properties.orientation || \"\",\r\n            contentTemplate: content,\r\n            transition: \"slideIn:up\",\r\n            close: function () {\r\n                self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n            },\r\n            afterOpenAnimation: function (event) {\r\n                $(\".bz-modal-view__search\", event.view.header).focus();\r\n            },\r\n            open: function (event) {\r\n                self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n            },\r\n            configureActions: function (context) {\r\n                self.configureModalViewHandlers(context);\r\n            }\r\n        });\r\n    },\r\n\r\n    autoCompleteSearchResults: function (currentValue) {\r\n        var self = this;\r\n\r\n        $.when(self.processRequest({term: currentValue}))\r\n            .done(function (response) {\r\n\r\n                self.modalViewList.find(\"li\").remove();\r\n\r\n                for (var i = 0, length = response.length; i < length; i++) {\r\n                    var searchItem = self.renderSearchItem(response[i]);\r\n\r\n                    searchItem.appendTo(self.modalViewList);\r\n                }\r\n            });\r\n    },\r\n\r\n    renderSearchItem: function (item) {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"search.item\");\r\n\r\n        var searchItem = $.tmpl(template, {\r\n            id: item.id,\r\n            label: item.label,\r\n            value: item.value\r\n        });\r\n\r\n        searchItem.data(\"item\", item);\r\n\r\n        return searchItem;\r\n    },\r\n\r\n    processRequest: function (req) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var deferred = new $.Deferred();\r\n\r\n        // Create array for response objects\r\n        var suggestions = [];\r\n\r\n        if (self.properties.allowSuggest && (req.term.length >= self.properties.searchLength)) {\r\n\r\n            // Update term property to reflect the search\r\n            properties.term = req.term;\r\n\r\n            var getSuggestData = self.isOfflineForm ? self.getOfflineData() : self.getData();\r\n\r\n            // Cancel previous request in order to improve the performance\r\n            if (self.deferredReference && typeof (self.deferredReference.reject) === \"function\" && self.deferredReference.state() !== \"resolved\") {\r\n                self.deferredReference.reject({hideStatus: true});\r\n            }\r\n\r\n            self.deferredReference = getSuggestData.done(function (data) {\r\n                if (data && data.length > 0) {\r\n                    data = data.slice(0, properties.maxRecords);\r\n\r\n                    if (data.length > self.Class.SEARCH_MAX_RECORDS) {\r\n                        data = data.slice(0, self.Class.SEARCH_MAX_RECORDS);\r\n\r\n                        suggestions.push({\r\n                            id: self.Class.NO_RESULTS_SEARCH_ID,\r\n                            label: self.getResource(\"render-search-maximum-records-allowed\"),\r\n                            value: \"\"\r\n                        });\r\n\r\n\r\n                    } else {\r\n                        data = data.slice(0, properties.maxRecords);\r\n                    }\r\n\r\n                    // Default value\r\n                    suggestions.push({\r\n                        id: self.Class.DEFAULT_SEARCH_ID,\r\n                        label: self.getResource(\"render-combo-empty-value\"),\r\n                        value: \"\"\r\n                    });\r\n\r\n                    $.each(data, function (i, val) {\r\n                        if (properties.maxRecords === 0 || i < properties.maxRecords) {\r\n                            var parseValue = bizagi.util.highlightMatches(val, req.term);\r\n\r\n                            suggestions.push({id: val.id, label: parseValue, value: val.value});\r\n                        }\r\n                    });\r\n\r\n                } else {\r\n                    suggestions.push({\r\n                        id: self.Class.NO_RESULTS_SEARCH_ID,\r\n                        label: self.getResource(\"render-grid-no-records\"),\r\n                        value: \"\"\r\n                    });\r\n                }\r\n\r\n                deferred.resolve(suggestions);\r\n\r\n            }).fail(function () {\r\n                deferred.reject();\r\n            });\r\n\r\n        } else {\r\n            deferred.resolve(suggestions);\r\n        }\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    /**\r\n     * Sets the value to show and calls the method to sets the control value\r\n     * @param {object} value\r\n     * @param {int} value.id\r\n     * @param {string} value.label\r\n     * @param {string=} value.additionallabel\r\n     * @example\r\n     *   value = {\r\n     *     id: 123,\r\n     *     label: \"xx\",\r\n     *     additionallabel: \"yyyy\"\r\n     *   }\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var label = \"\";\r\n\r\n        value = self.mapValue(value);\r\n\r\n        if (value !== null && typeof value !== \"undefined\" && typeof value.id !== \"undefined\") {\r\n            if (value.additionallabel && value.label) {\r\n                label = value.label + \" - \" + value.additionallabel;\r\n            } else if (value.label) {\r\n                label = value.label;\r\n            } else {\r\n                label = \"\";\r\n            }\r\n\r\n            var inputText = self.searchInput.find(\"input\");\r\n            inputText.val(label);\r\n            inputText.attr(\"id\", value.id);\r\n\r\n            if (value.id !== \"\" && self.properties.allowClear) {\r\n                $(\".bz-input-icon\", self.getControl()).removeClass(\"bz-input-icon--empty\");\r\n            }\r\n\r\n            if (self.properties.editable) {\r\n                self.setValue(value, true);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * on the smartphone only sends the id to submit in the smartphone it send the id and the value\r\n     * @returns {}\r\n     */\r\n    submitData: function () {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        // Add current data\r\n        data[self.properties.xpath] = self.getValue();\r\n\r\n        // Executes submit on change\r\n        if (self.properties.submitOnChange && data[self.properties.xpath].id != undefined)\r\n            self.submitOnChange(data, true);\r\n    },\r\n\r\n    /**\r\n     * Cleans the control's data\r\n     * @returns {}\r\n     */\r\n    cleanData: function () {\r\n        var value = {id: \"\", value: \"\"};\r\n\r\n        if (bizagi.util.isEmpty(this.value)) {\r\n            value = {};\r\n        }\r\n\r\n        this.setValue(value);\r\n        this.setDisplayValue(value);\r\n    },\r\n\r\n    getContentTemplate: function () {\r\n        var template = this.renderFactory.getTemplate(\"search.items\");\r\n        var content = $.fasttmpl(template, {});\r\n\r\n        return $.trim(content);\r\n    },\r\n\r\n    selectItem: function (item) {\r\n        var self = this;\r\n        var previousValue = self.hasValue();\r\n        var label = Array.isArray(item.value) ? item.value.join(\" - \") : item.value;\r\n\r\n        self.setDisplayValue({id: item.id, label: label});\r\n\r\n        if (self.properties.allowClear) {\r\n\r\n            if (item.id === self.Class.DEFAULT_SEARCH_ID) {\r\n                self.searchInput.find(\".gn-bz-search__clear\").addClass(\"gn-bz-search--hidden\");\r\n                self.searchInput.find(\".gn-bz-search__icon\").removeClass(\"gn-bz-search--hidden\");\r\n            } else {\r\n                if (!previousValue && item.id !== self.Class.DEFAULT_SEARCH_ID) {\r\n                    self.searchInput.find(\".gn-bz-search__clear\").removeClass(\"gn-bz-search--hidden\");\r\n                    self.searchInput.find(\".gn-bz-search__icon\").addClass(\"gn-bz-search--hidden\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get offline data for request\r\n     * @param request\r\n     */\r\n    getOfflineData: function () {\r\n        var self = this;\r\n        var dataList = self.properties.data || [];\r\n        var filter = (self.properties.term || \"\").toLowerCase();\r\n\r\n        return $.when(filter.startsWith(\"%%\") ? dataList : dataList.filter(function (item) {\r\n            var value = item && item.value ? item.value : \"\";\r\n            if (typeof (value) === \"object\") {\r\n                value = value.toString();\r\n            }\r\n\r\n            return value.toLowerCase().indexOf(filter) > -1;\r\n        }));\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Letter Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the letter render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.letter\", bizagi.rendering.letter.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.label.extend(\"bizagi.rendering.smartphone.letter\", {}, {});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Button Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the button render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.button\", bizagi.rendering.button.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.button.extend(\"bizagi.rendering.smartphone.button\", {}, {\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour to add handlers\r\n     * @returns {}\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        $(\":button\", self.getControl()).on(\"click\", function () {\r\n            self.processButton();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Process the button actions workflow\r\n     * @returns {}\r\n     */\r\n    processButton: function () {\r\n        var self = this;\r\n\r\n        if (self.properties.editable) {\r\n\r\n            // Check if action need conformation\r\n            if (self.properties.needsUserConfirmation) {\r\n                $.when(bizagi.showConfirmationBox(self.properties.userConfirmationMessage, \"Bizagi\", \"warning\"))\r\n                    .done(function () {\r\n                        // Trigger change\r\n                        self.triggerRenderChange({pressed: true});\r\n                    });\r\n            } else {\r\n                if (!self.properties.preventDefault)\r\n                    self.runButtonAction();\r\n\r\n                // Trigger change\r\n                self.triggerRenderChange({pressed: true});\r\n            }\r\n        }\r\n    },\r\n\r\n    getElementsToStylize: function($context){\r\n        return  $(\"button\", $context);         \r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render fileprint Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the fileprint render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.fileprint\", bizagi.rendering.fileprint.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.fileprint.extend(\"bizagi.rendering.smartphone.fileprint\", {}, {\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        this.getControl().parent().hide();\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi smartphone Render Link Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the link render class to adjust to smartphoe devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.link\", bizagi.rendering.link.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.link.extend(\"bizagi.rendering.smartphone.link\", {}, {\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     * @returns {}\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n        this.link = $control.find(\".bz-link\");\r\n\r\n        this._super();\r\n\r\n        this.preventDefaultForAnchorTag();\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n        this.link = $control.find(\".bz-link\");\r\n\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     * @returns {}\r\n     */\r\n    setDisplayValue: function (value) {\r\n        // Set internal value\r\n        this.setValue(value, false);\r\n\r\n        if (this.isValidValue()) {\r\n            // Get the decoded version of the URL\r\n            value = getFullyDecodedURI($.trim(value));\r\n\r\n            this.link.attr(\"href\", value);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour to add handlers\r\n     * @returns {}\r\n     */\r\n    configureHandlers: function () {\r\n        this.attachEvents();\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour\r\n     * to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        this.attachEvents();\r\n    },\r\n\r\n    /**\r\n     * Configure event handlers\r\n     */\r\n    attachEvents: function () {\r\n        var self = this;\r\n\r\n        if (self.isValidValue()) {\r\n            self.link.on(\"click\", function (evt) {\r\n                evt.preventDefault();\r\n                evt.stopPropagation();\r\n\r\n                var linkEncode = encodeURI(this.getAttribute(\"href\"));\r\n\r\n                self.linkSolver(linkEncode, self.properties.linktarget);\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Checks if the value is a valid url (http/https valid urls)\r\n     * TODO: Check if this validation is necessary\r\n     * @param {} value\r\n     * @returns {}\r\n     */\r\n    isValidValue: function () {\r\n        if (!this.hasValue()) return false;\r\n        var value = $.trim(this.getValue() || \"\");\r\n\r\n        return (value.toLowerCase().match(/^(http|https):\\/\\//) !== null) || false;\r\n    },\r\n\r\n    /**\r\n     * Executes the link\r\n     * @param {} linkEncode\r\n     * @param {} linkTarget\r\n     * @returns {}\r\n     */\r\n    linkSolver: function (linkEncode, linkTarget) {\r\n        if (linkTarget === \"newwindow\" || bizagi.util.isCordovaSupported()) {\r\n            window.open(linkEncode, \"_system\", \"location=yes\");\r\n        } else {\r\n            window.open(linkEncode, \"_system\");\r\n        }\r\n    },\r\n    \r\n    processLayout: function (isLabelFormat) {\r\n        if(!isLabelFormat){\r\n             this._super(isLabelFormat, this.properties.textFormat);\r\n        } else {\r\n            if(typeof this.properties.textFormat.background !== \"undefined\"){\r\n                this._super(isLabelFormat, { background: this.properties.textFormat.background });\r\n            }\r\n        }\r\n    },\r\n\r\n    getElementsToStylize: function($context){\r\n        return $(\".bz-link\", $context); \r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Render Image Class\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the image render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.image\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,\r\n    BA_CONTEXT_PARAMETER_PREFIX: bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,\r\n    BA_PAGE_CACHE: bizagi.render.services.service.BA_PAGE_CACHE\r\n}, bizagi.rendering.image.prototype);\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.image.extend(\"bizagi.rendering.smartphone.image\", {\r\n    QUALITY_PICTURE: 80,\r\n    EXTENSIONSIMG: [\"jpeg\", \"jpg\", \"png\"]\r\n}, {\r\n\r\n    /**\r\n     * DOM input to handle HTML uploads\r\n     * @var $inputFile jQuery DOM\r\n     */\r\n    $inputFile: null,\r\n\r\n    /**\r\n     * Whether or not is a native device 'Just a shortcut\r\n     * @var isNative boolean\r\n     */\r\n    isNative: false,\r\n\r\n    /**\r\n     * Whether or not we are offline 'Just a shortcut\r\n     * @var isOfflineForm boolean\r\n     */\r\n    isOfflineForm: false,\r\n    \r\n    /**\r\n     * Update or init the element data\r\n     * @param {} data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n\r\n        // Check if offline forms is supported\r\n        this.isOfflineForm = bizagi.util.isOfflineForm({context: this});\r\n        this.isNative = bizagi.util.isCordovaSupported();\r\n\r\n        if (this.isOfflineForm) {\r\n            var maxFileSizeOfProperty = Number(this.properties.maxSize) || 1048576;\r\n            var maxFileSizeOfUser = typeof (BIZAGI_SETTINGS) !== \"undefined\" && typeof (BIZAGI_SETTINGS.UploadMaxFileSize) !== \"undefined\" ? Number(BIZAGI_SETTINGS.UploadMaxFileSize) : 1048576;\r\n\r\n            this.properties.maxSize = maxFileSizeOfProperty < maxFileSizeOfUser ? maxFileSizeOfProperty : maxFileSizeOfUser;\r\n            var originalValue = this.properties.originalValue;\r\n            if ( originalValue && !bizagi.util.isEmpty(originalValue.value) ){\r\n                this.properties.offlineImageId = originalValue.value;\r\n                this.properties.originalOfflineImageId = this.properties.offlineImageId;\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This method tries to get the HTML template an render the current object inside\r\n     * @return {jQuery} $.Deferred()\r\n     */\r\n    renderControl: function () {\r\n        var template = this.renderFactory.getTemplate(\"image\");\r\n\r\n        return $.fasttmpl(template, {url: \"\"});\r\n    },\r\n\r\n    getElementsToStylize: function (context) {\r\n        return $({});\r\n    },\r\n\r\n    /**\r\n     * There is no difference when rendering a readonly image, so...\r\n     * @return {jQuery} $.Deferred()\r\n     */\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var template = this.renderFactory.getTemplate(\"image-readonly\");\r\n        var def = new $.Deferred();\r\n\r\n        $.when(self.buildItemUrl()).done(function (dataUrl) {\r\n            var url = dataUrl || \"\";\r\n\r\n            if (!self.isDisposed()) {\r\n                self.properties.url = url;\r\n                self.properties.value = url.length > 0 ? [url] : null;\r\n\r\n                self.setValue(self.properties.value);\r\n\r\n                var html = $.fasttmpl(template, {url: self.properties.url});\r\n                def.resolve(html);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * After rendering element\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n        this.$inputFile = $(\".bz-image__input\", $control);\r\n        this.$nativeFile = $(\".bz-image__native\", $control);\r\n\r\n        if (!this.isDesignMode())\r\n            this.showAsyncImage();       \r\n    },\r\n\r\n    /**\r\n     * Add action handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var $control = this.getControl();\r\n\r\n        // Attach all events\r\n        $control.on(\"click\", \"[data-action=upload]\", function (evt) {\r\n            self.choosePhoto();\r\n        });\r\n\r\n        if (this.isNative) {\r\n            // Upload Image Options\r\n            this.$nativeFile.off(\"click\").actionSheet({\r\n                actions: self.getUploadChoices(),\r\n                actionClicked: function (action) {\r\n                    switch (action.guid) {\r\n                        case 1:\r\n                            self.imageAdd();\r\n                            break;\r\n                        case 2:\r\n                            self.imageAdd(true);\r\n                            break;\r\n                        default:\r\n                    }\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n\r\n            $(\".bz-image__resolution\", $control).off(\"click\").actionSheet({\r\n                actions: bizagi.util.media.getImageResolutionSizes(),\r\n                withoutCancel: true,\r\n                actionClicked: function (action) {\r\n                    bizagi.loading.start();\r\n\r\n                    $.when(self.resolutionButtonHandler(action.guid))\r\n                        .always(function () {\r\n                            bizagi.loading.stop();\r\n                        });\r\n\r\n                },\r\n                appear: function (action) {\r\n                    self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                    self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n                },\r\n                cancelClicked: function (action) {\r\n                    self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n                }\r\n            });\r\n        } else {\r\n\r\n            // Image change (Hybrid only)\r\n            this.$inputFile.off(\"change\").on(\"change\", function () {\r\n                self.imageAdd();\r\n                this.value = \"\";\r\n            });\r\n\r\n            // Just in case\r\n            this.$inputFile.off(\"click\").on(\"click\", function (evt) {\r\n                evt.stopPropagation();\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour\r\n     * to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        var self = this;\r\n        var $control = this.getControl();\r\n\r\n        $control.on(\"click\", \".bz-image\", function () {\r\n            self.imagePreview();\r\n        })\r\n    },\r\n\r\n    /**\r\n     * Add an image\r\n     * @param useCamera boolean Whether or not to use device's camera\r\n     */\r\n    imageAdd: function (useCamera) {\r\n        var self = this;\r\n\r\n        if (!this.isNative) {\r\n            var extensions = this.Class.EXTENSIONSIMG;\r\n            var dataFile = this.$inputFile[0].files[0];\r\n\r\n            dataFile.fullPath = this.$inputFile[0].value;\r\n\r\n            bizagi.loading.start();\r\n\r\n            if (bizagi.util.media.checkMaxSizeFile(dataFile, self.properties) && bizagi.util.media.checkFileTypes(dataFile, self.properties, extensions)) {\r\n\r\n                $.when(self.performUploadFile(dataFile))\r\n                    .always(function () {\r\n                        bizagi.loading.stop();\r\n                    });\r\n\r\n            } else {\r\n                bizagi.loading.stop();\r\n            }\r\n        } else {\r\n\r\n            var options = {\r\n                quality: self.Class.QUALITY_PICTURE,\r\n                targetWidth: 1280,\r\n                targetHeight: 960,\r\n                correctOrientation: true\r\n            };\r\n\r\n            if (!useCamera) {\r\n                var coordinates = self.getControl()[0].getBoundingClientRect();\r\n\r\n                options = {\r\n                    quality: self.Class.QUALITY_PICTURE,\r\n                    sourceType: Camera.PictureSourceType.PHOTOLIBRARY,\r\n                    popoverOptions: new CameraPopoverOptions(coordinates.left, coordinates.top - 20, 200, 100, 4),\r\n                    destinationType: navigator.camera.DestinationType.FILE_URI,\r\n                    correctOrientation: true\r\n                };\r\n            }\r\n\r\n            navigator.camera.getPicture(function (dataImage) {\r\n\r\n                bizagi.loading.start();\r\n\r\n                $.when(bizagi.util.media.checkMaxSize(dataImage, self.properties)).then(function () {\r\n                    return $.when(bizagi.util.media.getFileDataInfo(dataImage)).then(function (fileData) {\r\n                        if (bizagi.util.media.checkFileTypes(fileData, self.properties, self.Class.EXTENSIONSIMG)) {\r\n\r\n                            self.dataImage = dataImage;\r\n                            self.fileProperties = fileData;\r\n\r\n                            // \"new Blob\" constructor is not supported in android version 4.2.2\r\n                            var version = bizagi.util.getAndroidVersion();\r\n                            if ((version && version <= 4.2) || self.isOfflineForm) {\r\n\r\n                                return $.when(self.performUploadFile(self.dataImage))\r\n                                    .always(function () {\r\n                                        bizagi.loading.stop();\r\n                                    });\r\n\r\n                            } else {\r\n\r\n                                if (!bizagi.util.isAndroid()) {\r\n                                    return $.when(bizagi.util.media.modalResolutionUpload())\r\n                                        .then(function (buttonIndex) {\r\n                                            if (buttonIndex <= bizagi.util.media.getImageResolutionItems().length) {\r\n                                                return self.resolutionButtonHandler(buttonIndex);\r\n                                            }\r\n                                        });\r\n\r\n                                } else {\r\n                                    // Force click to show actionsheet menu\r\n                                    $(\".bz-image__resolution\", self.getControl()).click();\r\n                                }\r\n\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                }).always(function () {\r\n                    bizagi.loading.stop();\r\n                });\r\n            }, self.onFail, options);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * onFail\r\n     * @param {} error\r\n     * @returns {}\r\n     */\r\n    onFail: function (error) {\r\n        bizagi.loading.stop();\r\n    },\r\n\r\n    /**\r\n     * Remove the current image\r\n     */\r\n    imageDelete: function () {\r\n        var self = this;\r\n\r\n        bizagi.showConfirmationBox(self.getResource(\"render-grid-delete-confirmation\"))\r\n            .done(function () {\r\n                bizagi.loading.start();\r\n\r\n                $.when(self.dataService.deleteImage({\r\n                    url: self.properties.deleteUrl,\r\n                    idRender: self.properties.id,\r\n                    xpath: self.properties.xpath,\r\n                    xpathContext: self.properties.xpathContext,\r\n                    idPageCache: self.properties.idPageCache,\r\n                    contexttype: self.properties.contexttype\r\n                })).done(function () {\r\n                    self.uploadFileCompleted();\r\n                }).fail(function (msg) {\r\n                    var message;\r\n                    var responseText = msg.responseText;\r\n\r\n                    try {\r\n                        message = JSON.parse(responseText);\r\n                        message = message.message || responseText;\r\n                    } catch (e) {\r\n                        message = responseText;\r\n                    }\r\n\r\n                    self.setValidationMessage(message);\r\n\r\n                }).always(function () {\r\n                    bizagi.loading.stop();\r\n                });\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Send file using HTTP\r\n     * @param dataFile\r\n     * @return {jQuery} $.Deferred()\r\n     */\r\n    uploadFile: function (dataFile) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        if (!this.isOfflineForm) {\r\n            if (this.isNative) {\r\n\r\n                var params = {};\r\n                var addParams = self.buildAddParams();\r\n                var fileName = self.fileProperties.name;\r\n\r\n                if (self.editedImageURL) {\r\n                    params.dataFile = self.editedImageURL;\r\n                } else if (self.fileProperties) {\r\n                    params.dataFile = self.fileProperties.url;\r\n                }\r\n\r\n                addParams.queueID = \"q_\" + bizagi.util.encodeXpath(self.getUploadXpath());\r\n\r\n                params.data = addParams;\r\n                params.options = new FileUploadOptions();\r\n                params.options.fileKey = \"file\";\r\n                params.options.fileName = fileName;\r\n                params.options.mimeType = \"image/jpeg\";\r\n                params.options.uploadKey = {key: addParams[\"h_xpath\"]};\r\n                params.options.addUrl = self.properties.addUrl;\r\n\r\n                //Cleans variables related previous uploads\r\n                self.editedImageURL = null;\r\n                self.fileProperties = null;\r\n\r\n                // Fix android 4.4 getting images from recent folder\r\n                params.dataFile = bizagi.util.media.getImagePath(params.dataFile);\r\n\r\n                $.when(bizagi.util.media.uploadFile(params)).done(function (response) {\r\n                    var response = JSON.parse(decodeURIComponent(response.response));\r\n\r\n                    if (response.type === \"error\") {\r\n                        defer.reject(response);\r\n                    } else {\r\n                        defer.resolve(response);\r\n                    }\r\n                }).fail(function (error) {\r\n                    defer.reject(error);\r\n                });\r\n            } else {\r\n\r\n                if (bizagi.util.media.checkMaxSizeFile(dataFile, self.properties) &&\r\n                    bizagi.util.media.checkFileTypes(dataFile, self.properties, self.Class.EXTENSIONSIMG)) {\r\n\r\n                    self.dataService.processUploadFile({\r\n                        url: self.properties.addUrl,\r\n                        formData: self.buildAddFileParams(dataFile)\r\n                    }).done(function (response) {\r\n                        defer.resolve(response);\r\n                    }).fail(function (error) {\r\n                        defer.reject(error);\r\n                    });\r\n                } else {\r\n                    defer.reject();\r\n                }\r\n            }\r\n        } else {\r\n            // Save the image\r\n            $.when(self.saveImageOffline(dataFile))\r\n            .then( function(){\r\n                // Enables canbesent on offline mode\r\n                // In order to evaluate the xpath in synchronization phase\r\n                self.canBeSent = function () {\r\n                    return true;\r\n                };\r\n                defer.resolve();\r\n            })\r\n            .fail( function(saveOfflineError){\r\n                defer.reject();\r\n            });\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * File upload is done\r\n     * @param context\r\n     */\r\n    uploadFileCompleted: function () {\r\n        try {\r\n            this.showAsyncImage();\r\n            this.editedImageURL = null;\r\n        } catch (error) {\r\n            // TODO: Review scenario\r\n            this.getFormContainer().refreshForm();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show async image\r\n     * */\r\n    showAsyncImage: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n        var $wrapper = $(\".bz-input-icon\", $control);\r\n\r\n        $.when(self.renderUploadItem()).done(function (htmlImage) {\r\n            if (!self.isDisposed()) {\r\n\r\n                // Empty container and add new image\r\n                $wrapper.empty();\r\n                $wrapper.append(htmlImage);\r\n\r\n                var action = self.hasValue() ? \"update\" : \"upload\";\r\n\r\n                $wrapper.attr(\"data-action\", action);\r\n                self.setValue(self.properties.value);\r\n\r\n                // Attack events to overflow-menu\r\n                if (self.hasValue()) {\r\n                    self.configureMenu();\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * resolutionButtonHandler\r\n     * @param ordinal\r\n     */\r\n    resolutionButtonHandler: function (ordinal) {\r\n        var self = this;\r\n        var actionSelected = ordinal || 0;\r\n\r\n        // If original, save image normally, if not, reduce quality and size\r\n        if (actionSelected === bizagi.util.media.ResolutionType.ORIGINAL) {\r\n            return self.performUploadFile(self.dataImage);\r\n        } else {\r\n\r\n            var resolution = bizagi.util.media.getImageResolution(actionSelected);\r\n\r\n            return $.when(bizagi.util.media.transformImageSize(self.dataImage, resolution)).then(function (result) {\r\n\r\n                self.editedImageURL = result.localUrl;\r\n                self.properties.url = result.base64Image;\r\n\r\n                return self.performUploadFile(self.dataImage);\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Render edition view\r\n     * @returns {}\r\n     */\r\n    imagePreview: function () {\r\n        var self = this;\r\n        var baseParams = self.getParams();\r\n        var container = baseParams.navigation.createRenderContainer({\r\n            title: self.properties.displayName,\r\n            view: {\r\n                zoom: true,\r\n                useNativeScrolling: false\r\n            }\r\n        });\r\n\r\n        var template = self.renderFactory.getTemplate(\"image-preview\");\r\n        var imageData = {\"url\": self.value && self.value[0] !== \"\" ? self.value[0] : \"\"};\r\n        var img = $.fasttmpl(template, imageData);\r\n\r\n        container.element.css(\"display\", \"none\");\r\n        self.inputEdition = container.element.html(img);\r\n        baseParams.navigation.navigate(container.id);\r\n\r\n        if (self.isOfflineForm) {\r\n            container.element.on(\"close\", self.onPreviewActionBack.bind(self));\r\n        }\r\n\r\n        bizagi.loading.start();\r\n\r\n        // TODO: Review fail scenario, should it call the forms.failHandler method?\r\n        $.when(self.buildFullItemUrl()).done(function (dataUrl) {\r\n            container.element.css(\"display\", \"block\");\r\n\r\n            if (dataUrl.indexOf(\"error\") < 0) {\r\n                var $preview = $(\".bz-image__preview-item:first\", container.element).attr(\"src\", dataUrl);\r\n                var originalImageWidth = $preview.css(\"width\");\r\n\r\n                originalImageWidth = Number(originalImageWidth.substring(0, originalImageWidth.length - 2));\r\n\r\n                if (self.properties.width !== -1 && self.properties.width < originalImageWidth) {\r\n                    $preview.css(\"width\", \"100%\");\r\n                }\r\n            }\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Build add params to send to the server\r\n     * @param {} dataFile\r\n     * @returns {}\r\n     */\r\n    buildAddFileParams: function (dataFile) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var prefix = self.Class.BA_CONTEXT_PARAMETER_PREFIX;\r\n\r\n        // Get form data for POSTing\r\n        var formData = new FormData();\r\n        var form = self.getFormContainer();\r\n\r\n        // Build add params to send to the server\r\n        formData.append(prefix + \"xpath\", properties.xpath);\r\n        formData.append(prefix + \"idRender\", properties.id);\r\n        formData.append(prefix + \"xpathContext\", properties.xpathContext);\r\n        formData.append(prefix + self.Class.BA_PAGE_CACHE, properties.idPageCache);\r\n        formData.append(self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\", form.properties.sessionId);\r\n        formData.append(prefix + \"action\", \"savefile\");\r\n        formData.append(self.properties.xpath, dataFile);\r\n\r\n        if (properties.contexttype) {\r\n            formData.append(prefix + \"contexttype\", properties.contexttype);\r\n        }\r\n\r\n        try {\r\n            if (typeof (BIZAGI_SESSION_NAME) !== \"undefined\") {\r\n                formData.append(BIZAGI_SESSION_NAME, form.properties.sessionId);\r\n            } else {\r\n                formData.append(\"JSESSIONID\", form.properties.sessionId);\r\n            }\r\n        } catch (e) {\r\n            formData.append(\"JSESSIONID\", form.properties.sessionId);\r\n        }\r\n\r\n        return formData;\r\n    },\r\n\r\n    /**\r\n     * Call the form failhandler with an specific error\r\n     * @param {} error\r\n     * @returns {}\r\n     */\r\n    executeFormFailHandler: function (error) {\r\n        var self = this;\r\n        var errorResponse = error.responseText ? error.responseText : bizagi.localization.getResource(\"workportal-general-error\");\r\n\r\n        self.getFormContainer().failHandler(errorResponse);\r\n    },\r\n\r\n    /**\r\n     * Execute upload file\r\n     * @param {} context\r\n     * @param {} dataImage\r\n     * @returns {}\r\n     */\r\n    performUploadFile: function (dataImage) {\r\n        var self = this;\r\n\r\n        return $.when(self.uploadFile(dataImage))\r\n            .done(function (result) {\r\n                self.uploadFileCompleted();\r\n            }).fail(function (error) {\r\n                self.executeFormFailHandler(error);\r\n            });\r\n    },\r\n\r\n    /**\r\n     * Choose photo\r\n     */\r\n    choosePhoto: function () {\r\n        if (this.isNative) {\r\n            this.$nativeFile.click();\r\n        } else if (bizagi.util.media.fileAPISupported() && !self.isOfflineForm) {\r\n            this.$inputFile.click();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Process an action in order to do something with the image\r\n     */\r\n    configureMenu: function () {\r\n        var self = this;\r\n        var items = [];\r\n        var $control = this.getControl();\r\n        var $viewMore = $(\".bz-input-icon__input + .bz-icn\", $control);\r\n        var allowDelete = self.isOfflineForm ? false : self.properties.allowDelete && self.properties.editable;\r\n\r\n        items.push({\r\n            name: bizagi.localization.getResource(\"workportal-actionsheet-upload-image-preview\"),\r\n            fn: function () {\r\n                self.imagePreview();\r\n            }\r\n        });\r\n\r\n        items.push({\r\n            name: bizagi.localization.getResource(\"workportal-actionsheet-upload-choose-photo\"),\r\n            fn: function () {\r\n                self.choosePhoto();\r\n            }\r\n        });\r\n\r\n        if (allowDelete) {\r\n            items.push({\r\n                name: bizagi.localization.getResource(\"workportal-actionsheet-upload-remove-photo\"),\r\n                fn: function () {\r\n                    self.imageDelete();\r\n                }\r\n            });\r\n        }\r\n\r\n        $viewMore.overflowMenu({items: items});\r\n    },\r\n\r\n    /**\r\n     * Add upload options\r\n     */\r\n    getUploadChoices: function () {\r\n        return [\r\n            {\"guid\": 1, \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-choose-photo\")},\r\n            {\"guid\": 2, \"displayName\": bizagi.localization.getResource(\"workportal-actionsheet-upload-take-photo\")}\r\n        ];\r\n    },\r\n\r\n    /**\r\n     * Builds the upload item url\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    buildItemUrl: function (params) {\r\n        if (this.isOfflineForm) {\r\n            return this.buildItemUrlOffline(params);\r\n        } else {\r\n            return this._super(params);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Refresh data\r\n     * @param {} event\r\n     */\r\n    onPreviewActionBack: function (event) {\r\n        var self = this;\r\n        var dataUrl = $(\".bz-image__preview-item\", event.target).attr(\"src\") || \"\";\r\n\r\n        var dataUrlToSave = dataUrl.length > 0 ? [].concat(dataUrl) : null;\r\n        self.setValue(dataUrlToSave);\r\n    },\r\n\r\n    collectData: function (renderValues) {\r\n        var self = this;\r\n        if(self.isOfflineForm && bizagi.util.isOfflineFormsV2Supported()){\r\n            var imageId = self.properties.offlineImageId;\r\n            var originalImageId = self.properties.originalOfflineImageId;\r\n            if(imageId === originalImageId){\r\n                return;\r\n            }\r\n            var xpath = self.properties.xpath;\r\n            var imageId = self.properties.offlineImageId;\r\n            if (!bizagi.util.isEmpty(xpath)){\r\n                if(!bizagi.util.isEmpty(imageId)){\r\n                    renderValues[xpath] = imageId;\r\n                }\r\n                else {\r\n                    delete renderValues[xpath];\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            $._super(renderValues);\r\n        }\r\n    },\r\n\r\n});\r\n\r\n","/**\r\n *   Name: Bizagi Smartphone Render Form Link Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the link render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.formLink\", {\r\n    BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    BA_PAGE_CACHE: \"pageCacheId\"\r\n}, bizagi.rendering.formLink.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.formLink.extend(\"bizagi.rendering.smartphone.formLink\", {}, {\r\n\r\n    init: function (params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(params);\r\n\r\n        params.context = params.context || \"workflow\";\r\n\r\n        var paramsRender = $.extend({}, this._params, {\r\n            \"proxyPrefix\": this.dataService.serviceLocator.proxyPrefix,\r\n            \"context\": this.dataService.serviceLocator.context\r\n        });\r\n\r\n        this.serviceLocator = new bizagi.render.services.context(paramsRender);\r\n    },\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param data\r\n     */\r\n    initializeData: function (data) {\r\n        var self = this;\r\n\r\n        self._super(data);\r\n\r\n        var properties = self.properties;\r\n\r\n        self.originalElement = self.element;\r\n        properties.orgiginalDisplayType = properties.displayType;\r\n        properties.displayType = \"normal\";\r\n\r\n        self._sendRelation = self.submitEditRequest;\r\n        self._getData = self.dataService.getFormData;\r\n        self._isRefreshForm = false;\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        self._super();\r\n\r\n        self._params = {\r\n            idRender: properties.id,\r\n            xpathContext: self.getFormLinkXpathContext(),\r\n            idPageCache: properties.idPageCache,\r\n            recordXPath: self.getFormLinkXpath(),\r\n            requestedForm: \"linkform\",\r\n            editable: properties.editable,\r\n            url: properties.editPage\r\n        };\r\n\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        // Execute the same as post-render\r\n        this.postRender();\r\n    },\r\n\r\n    /**\r\n     * Para la grilla lo que se debe hacer es sobreescribir o crear los metodos params, sendrelation,getData\r\n     * @returns {*}\r\n     */\r\n    renderEdition: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        self.container = self.getParams().navigation.createRenderContainer({title: properties.displayName});\r\n        self.inputEdition = self.container.element;\r\n\r\n        if (self.properties.hasentryrule) {\r\n            var form = self.getFormContainer();\r\n\r\n            $.when(form.saveForm()).done(function () {\r\n                self.resolveCheckpointRequest().done(function () {\r\n                    return self.openLinkRule(\"entryrule\");\r\n                });\r\n            });\r\n        } else {\r\n            return self.openLink();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Open link display from inside a dialog\r\n     */\r\n    openLink: function () {\r\n        var self = this;\r\n\r\n        return $.when(self._sendRelation.apply(self)).done(function () {\r\n            bizagi.loading.start();\r\n\r\n            $.when(self.paintFormLink()).done(function () {\r\n                bizagi.loading.stop();\r\n            }).fail(function () {\r\n                //Executes Rollback action\r\n                bizagi.loading.start();\r\n                self.rollbackForm();\r\n            }).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        }).fail(function (error) {\r\n            var error_obj = bizagi.util.getErrorFormatted(error);\r\n            var message = error_obj.message || bizagi.localization.getResource(\"workportal-general-error\");\r\n            var form = self.getFormContainer();\r\n\r\n            if (typeof (form) !== \"undefined\") {\r\n                form.addValidationMessage(message);\r\n            }\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n\r\n    openLinkRule: function (property) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        bizagi.loading.start();\r\n\r\n        self.getPropertyValue(property, {})\r\n            .done(function (dataRuleResp) {\r\n                if (dataRuleResp.messages) {\r\n                    var message = dataRuleResp.messages[0];\r\n                    var form = self.getFormContainer();\r\n\r\n                    form.validationController.showErrorMessage(message);\r\n                    def.reject();\r\n                } else {\r\n                    if (property === \"entryrule\") {\r\n                        self.openLink();\r\n                    }\r\n                }\r\n                def.resolve();\r\n            }).fail(function () {\r\n            def.reject();\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    getPropertyValue: function (propertyName, params) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var defer = new $.Deferred();\r\n\r\n        self.dataService.multiaction().getPropertyData({\r\n            url: properties.dataUrl,\r\n            xpath: properties.xpath,\r\n            idRender: properties.id,\r\n            xpathContext: properties.xpathContext,\r\n            idPageCache: properties.idPageCache,\r\n            property: propertyName,\r\n            extra: params,\r\n            dataType: params ? params.dataType : null\r\n        }).done(function (data) {\r\n            if (data.type === \"error\") {\r\n                // Workflow engine error, we gotta show it with error\r\n                var form = self.getFormContainer();\r\n\r\n                form.validationController.showErrorMessage(data.message);\r\n                defer.reject(data);\r\n            } else {\r\n                defer.resolve(data);\r\n            }\r\n        }).fail(function (jqXHR, textStatus, errorThrown) {\r\n            // Add error messages\r\n            var form = self.getFormContainer();\r\n\r\n            form.validationController.showErrorMessage(jqXHR.message);\r\n\r\n            defer.reject(jqXHR, textStatus, errorThrown);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    paintFormLink: function () {\r\n        var self = this;\r\n        var deferred = $.Deferred();\r\n\r\n        $.extend(self._params, {\"proxyPrefix\": self.serviceLocator.proxyPrefix});\r\n\r\n        $.when(self._getData.call(self, self._params)).pipe(function (data) {\r\n            if (self._params.recordXPath) {\r\n                data.form.properties.recordXpath = self._params.recordXPath;\r\n            }\r\n\r\n            if (self._params.editable === false) {\r\n                data.form.properties.editable = false;\r\n            }\r\n\r\n            // Grid\r\n            if (self._params.hasOwnProperty(\"withAddForm\") && self._params.withAddForm) {\r\n                if (!data.form.elements || (data.form.elements && data.form.elements.length === 0)) {\r\n                    self._params.hideSaveButton = true;\r\n                }\r\n            }\r\n\r\n            /**\r\n             * This creation of form on every action like refresh or save\r\n             * is driving nuts the listeners in native apps\r\n             */\r\n            self.form = self.renderFactory.getContainer({\r\n                type: \"form\",\r\n                data: data.form,\r\n                navigation: self.getParams().navigation,\r\n                wiew_container: self.container\r\n            });\r\n\r\n            self.form.params = self.getFormContainer().getParams();\r\n\r\n            self.form.buttons = [\r\n                $.extend(\r\n                    self.form.buttons[0] || {},\r\n                    {\r\n                        \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-save\"),\r\n                        \"actions\": [\"submitData\", \"refresh\"],\r\n                        \"submitData\": true,\r\n                        \"refresh\": true,\r\n                        \"ordinal\": 0,\r\n                        \"action\": \"save\",\r\n                        \"save\": true,\r\n                        \"style\": \"\",\r\n                        // This callback avoid to call the default processButton in the form\r\n                        callback: function () {\r\n                            // When the data is saved then\r\n                            return self.saveRecord().then(function () {\r\n                                self.container.destroy();\r\n                            }).fail(function (error) {\r\n                                if (error && error.error_code && error.error_code == 1) {\r\n                                    //if doesn't support commit, rollback, etc.\r\n                                    $.when(self.actionSave(error.data)).then(function () {\r\n                                        self.container.destroy();\r\n                                    });\r\n                                } else if (error && error.type === \"validationMessages\") {\r\n                                    self.form.addValidationMessage(error.messages);\r\n                                } else if (error && error.responseText) {\r\n                                    var error_obj = bizagi.util.getErrorFormatted(error);\r\n                                    var message = error_obj && error_obj.message ? error_obj.message : (error_obj || bizagi.localization.getResource(\"workportal-general-error\"));\r\n\r\n                                    if (self.hasSessionFormException(error_obj)) {\r\n                                        self.goToStartPage(error_obj);\r\n                                    } else {\r\n                                        bizagi.showMessageBox(message, \"Error\");\r\n                                    }\r\n                                }\r\n                            });\r\n                        }\r\n                    }),\r\n                $.extend(\r\n                    self.form.buttons[1] || {},\r\n                    {\r\n                        \"caption\": bizagi.localization.getResource(\"render-form-dialog-box-close\"),\r\n                        \"actions\": [\"submitData\", \"refresh\"],\r\n                        \"submitData\": true,\r\n                        \"refresh\": true,\r\n                        \"ordinal\": 1,\r\n                        \"action\": \"back\",\r\n                        \"save\": true,\r\n                        \"style\": \"\",\r\n                        //This callback avoid to call the default processButton in the form\r\n                        callback: function () {\r\n                            self.container.destroy();\r\n                            deferred.reject();\r\n                        }\r\n                    })\r\n            ];\r\n\r\n            $.extend(self.form, {\r\n                processButtons: function () {\r\n                    //not send information set in memory and save\r\n                    $.each(self.form.buttons, function (index, element) {\r\n                        switch (element[\"ordinal\"]) {\r\n                            case 1: //next button will behave as a cancel button\r\n                                $(self.form.getButtons()[index]).click(function () {\r\n                                    self.container.destroy();\r\n                                    deferred.reject();\r\n                                });\r\n\r\n                                self.form.getButtons()[index].innerHTML = bizagi.localization.getResource(\"render-form-dialog-box-close\");\r\n\r\n                                self.form.buttons[index].caption = bizagi.localization.getResource(\"render-form-dialog-box-close\");\r\n                                self.form.buttons[index].action = \"back\";\r\n                                break;\r\n\r\n                            default:\r\n                                $(self.form.getButtons()[index]).click(function () {\r\n                                    if (self._params.hideSaveButton) {\r\n                                        $(self.form.getButtons()[index]).hide();\r\n                                    }\r\n\r\n                                    return self.saveRecord().then(function () {\r\n                                        self.container.destroy();\r\n                                    }).fail(function (error) {\r\n                                        if (error && error.error_code && error.error_code == 1) {\r\n                                            //if doesn't support commit, rollback, etc.\r\n                                            $.when(self.actionSave(error.data)).then(function () {\r\n                                                self.container.destroy();\r\n                                            });\r\n                                        } else {\r\n                                            var error_obj = bizagi.util.getErrorFormatted(error);\r\n                                            var message = error_obj && error_obj.message ? error_obj.message : (error_obj || bizagi.localization.getResource(\"workportal-general-error\"));\r\n\r\n                                            bizagi.showMessageBox(message, \"Error\");\r\n                                        }\r\n                                    });\r\n                                });\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            return self.form.render();\r\n\r\n        }, function (error) {\r\n            var error_obj = bizagi.util.getErrorFormatted(error);\r\n            var message = error_obj.message || bizagi.localization.getResource(\"workportal-general-error\");\r\n            var form = self.getFormContainer();\r\n\r\n            if (typeof (form) !== \"undefined\") {\r\n                form.addValidationMessage(message);\r\n            }\r\n\r\n            deferred.reject();\r\n        }).done(function (element) {\r\n            self.inputEdition.html(element);\r\n\r\n            if (!self._isRefreshForm) {\r\n                self.getParams().navigation.navigate(self.container.id);\r\n            }\r\n\r\n            self.container.setNavigationButtons(self.form);\r\n\r\n            // Publish an event to check if the form has been set in the DOM\r\n            self.form.triggerHandler(\"ondomincluded\");\r\n\r\n            // Attach a refresh handler to recreate all the form\r\n            self.form.bind(\"refresh\", function () {\r\n                //TODO the parent who call this class implement redraw. see smartphone.grid _InternalRenderLinkForm\r\n                self.inputEdition.empty();\r\n                self._isRefreshForm = true;\r\n\r\n                //Adds the events to capture the\r\n                $.when(self.paintFormLink()).done(function () {\r\n                }).fail(function () {\r\n                    self.submitRollbackRequest();\r\n                });\r\n            });\r\n\r\n            // Binds the view close event, and send the RollBack\r\n            self.container.element.bind(\"close\", function () {\r\n                self.rollbackForm();\r\n            });\r\n\r\n        }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    rollbackForm: function () {\r\n        var self = this;\r\n        var form = self.form || self.getFormContainer();\r\n\r\n        $.when(self.submitRollbackRequest({idPageCache: form.idPageCache})).done(function () {\r\n            // Sends additional rollback request to delete checkpoint from entry rule\r\n            if (self.properties.hasentryrule) {\r\n                self.submitRollbackRequest({idPageCache: form.idPageCache});\r\n            }\r\n        });\r\n    },\r\n\r\n    saveRecord: function () {\r\n        var self = this;\r\n        var deferred = $.Deferred();\r\n        var properties = self.properties;\r\n\r\n        if (self.form.validateForm()) {\r\n            var data = {};\r\n            self.form.collectRenderValues(data);\r\n            // Add page cache for this form\r\n            data.idPageCache = self.form.getPageCache();\r\n\r\n            $.when(self.submitSaveRequest(data)).done(function (result) {\r\n                try {\r\n                    if(self.properties.hasExclusiveCheck && self.addExclusiveChange){\r\n                        self.addExclusiveChange(self.properties.idAsigned, data, self.parent);\r\n                    }\r\n                    var executeSubmitOnChange = true;\r\n                    if (result && result.type === \"validationMessages\") {\r\n                        executeSubmitOnChange = false;\r\n                        deferred.reject(result);\r\n                    }\r\n                    if (properties.hasexitrule) {\r\n                        self.closeExitRule().done(function () {\r\n                            if (executeSubmitOnChange) {\r\n                                self.resolveSubmitCommitRequest().then(function () {\r\n                                    self.submitOnChange({}).then(function () {\r\n                                        deferred.resolve(result);\r\n                                        if (properties.hasentryrule) {\r\n                                            self.resolveSubmitCommitRequest();\r\n                                        }\r\n                                    });\r\n                                });\r\n                            } else {\r\n                                deferred.reject();\r\n                            }\r\n                        }).fail(function () {\r\n                            deferred.reject();\r\n                        });\r\n                    } else if (executeSubmitOnChange) {\r\n                        self.resolveSubmitCommitRequest().then(function () {\r\n                            if (properties.hasentryrule) {\r\n                                self.resolveSubmitCommitRequest().done(function () {\r\n                                    self.submitOnChange({}).then(function () {\r\n                                        deferred.resolve(result);\r\n                                    });\r\n                                });\r\n                            } else {\r\n                                self.submitOnChange({}).then(function () {\r\n                                    deferred.resolve(result);\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        deferred.reject();\r\n                    }\r\n                } catch (ex) {\r\n                    deferred.reject();\r\n                }\r\n            }).fail(function (error) {\r\n                var err = JSON.parse(error.responseText || '{\"message\":\"\",\"code\":\"\"}');\r\n\r\n                if (err.code === \"UNKNOWN_ERROR\" && err.message.indexOf(\"Requested value\") !== -1\r\n                    && err.message.indexOf(\"was not found\") !== -1) {\r\n                    deferred.reject({error_code: 1, data: data});\r\n                } else {\r\n                    deferred.reject(error);\r\n                }\r\n            });\r\n        } else {\r\n            deferred.reject();\r\n        }\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    submitSaveRequest: function (data) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Don't send request when the link is not editable\r\n        if (properties.editable === false && !properties.value) {\r\n            return null;\r\n        }\r\n\r\n        var xpath = self.getFormLinkXpath();\r\n        var xpathContext = xpath;\r\n\r\n        if (properties.xpathContext !== undefined && properties.xpathContext !== \"\") {\r\n            xpathContext = xpath ? properties.xpathContext + \".\" + xpath : properties.xpathContext;\r\n        }\r\n\r\n        // SaveGridRecord\r\n        return self.dataService.saveGridRecord({\r\n            url: properties.saveUrl,\r\n            idRender: properties.id,\r\n            xpathContext: xpathContext,\r\n            submitData: data\r\n        });\r\n    },\r\n\r\n    resolveSubmitCommitRequest: function () {\r\n        var def = new $.Deferred();\r\n\r\n        this.submitCommitRequest().done(function () {\r\n            def.resolve();\r\n        }).fail(function (error) {\r\n            var err = JSON.parse(error.responseText || \"{message:'', code: ''}\");\r\n            if (err.code === \"UNKNOWN_ERROR\") {\r\n                def.resolve();\r\n            } else {\r\n                def.reject();\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    resolveCheckpointRequest: function () {\r\n        var def = new $.Deferred();\r\n\r\n        this.submitCheckpointRequest().done(function () {\r\n            def.resolve();\r\n        }).fail(function (error) {\r\n            var err = JSON.parse(error.responseText || \"{message:'', code: ''}\");\r\n\r\n            if (err.code === \"UNKNOWN_ERROR\" && err.message.indexOf(\"Requested value\") !== -1\r\n                && err.message.indexOf(\"was not found\") !== -1) {\r\n                def.resolve();\r\n            } else {\r\n                def.reject();\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    closeExitRule: function () {\r\n        var def = new $.Deferred();\r\n\r\n        if (this.properties.hasexitrule) {\r\n            $.when(this.openLinkRule(\"exitrule\")).done(function (result) {\r\n                def.resolve(result);\r\n            }).fail(function () {\r\n                def.reject();\r\n            });\r\n        } else {\r\n            def.resolve();\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    getFormLinkXpathContext: function () {\r\n        var xpathContext = this.properties.xpathContext;\r\n        var parentXpathContext = this.getXpathContext();\r\n\r\n        if (parentXpathContext && xpathContext) {\r\n            return xpathContext.indexOf(parentXpathContext) === 0 ? xpathContext : parentXpathContext + \".\" + xpathContext;\r\n        } else {\r\n            return xpathContext;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        this.attachEvents();\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour\r\n     * to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        this.attachEvents();\r\n    },\r\n\r\n    /**\r\n     * Configure event handlers\r\n     */\r\n    attachEvents: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        $(\"[data-action=open]\", $control).on(\"click\", function () {\r\n            bizagi.loading.start();\r\n\r\n            $.when(self.renderEdition()).always(function () {\r\n                bizagi.loading.stop();\r\n            });\r\n        });\r\n    },\r\n\r\n    processLayout: function (isLabelFormat) {\r\n        if (!isLabelFormat) {\r\n            this._super(isLabelFormat, this.properties.textFormat);\r\n        } else {\r\n            if (typeof this.properties.textFormat.background !== \"undefined\") {\r\n                this._super(isLabelFormat, {background: this.properties.textFormat.background});\r\n            }\r\n        }\r\n    },\r\n\r\n    getElementsToStylize: function ($context) {\r\n        return $(\".bz-link\", $context);\r\n    },\r\n    /**\r\n     * Idle timer expired exception\r\n     * @param error\r\n     * @returns {boolean}\r\n     */\r\n    hasSessionFormException: function (error) {\r\n        return typeof (error) !== \"undefined\" && error.code === \"AUTH_ERROR\";\r\n    },\r\n\r\n    /**\r\n     * Navigate to main page\r\n     * @param error\r\n     */\r\n    goToStartPage: function (error) {\r\n        var navigation = this.getParams().navigation;\r\n        if (navigation) {\r\n            navigation.goToStartPage(error);\r\n        }\r\n    }\r\n\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Geolocation Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the geolocation render class to adjust to Smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.geolocation\", bizagi.rendering.geolocation.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.geolocation.extend(\"bizagi.rendering.smartphone.geolocation\", {\r\n    ALLOW_UPDATE: \"update\"\r\n}, {\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n        this.coordinate = $control.find(\"input\");\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var template = this.renderFactory.getTemplate(\"readonly\");\r\n\r\n        return $.fasttmpl(template, {value: this.getDisplayValue()});\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n        this.coordinate = $control.find(\"input\");\r\n\r\n        // Call base\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour to add handlers\r\n     * @returns {}\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        // If the control doesn't have a value set the position\r\n        if (self.value == null) {\r\n            self.updateDisplayValue();\r\n        }\r\n\r\n        $control.on(\"click\", \"[data-action=\" + self.Class.ALLOW_UPDATE + \"]\", self.processAction.bind(self));\r\n\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     * @returns {}\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (value != null && value !== \"\") {\r\n            if (self.coordinate)\r\n                self.coordinate.val(self.performPrecision(value));\r\n\r\n            // Set internal value \r\n            self.setValue(value, false);\r\n            def.resolve();\r\n        } else {\r\n            var onSuccess = function (position) {\r\n                var coordinates = position.coords.latitude + \" \" + position.coords.longitude;\r\n\r\n                self.coordinate.val(self.performPrecision(coordinates));\r\n\r\n                // Set internal value \r\n                self.setValue(coordinates, false);\r\n                def.resolve();\r\n            };\r\n\r\n            var onFail = function (message) {\r\n                def.reject(message);\r\n            };\r\n\r\n            if (bizagi.util.isCordovaSupported() && bizagi.util.isiOSDevice()) {\r\n                navigator.geolocation.getCurrentPosition(onSuccess, onFail);\r\n            } else {\r\n                self.getCurrentPosition(onSuccess, onFail);\r\n            }\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    updateDisplayValue: function () {\r\n        var self = this;\r\n\r\n        self.setDisplayValue().then(function () {\r\n            self.setValidationMessage(\"\");\r\n        }).fail(function (message) {\r\n            self.coordinate.val(\"\");\r\n            self.setValidationMessage(message);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Process an action in order to do something with the geolocation\r\n     */\r\n    processAction: function () {\r\n        this.coordinate.empty();\r\n        this.updateDisplayValue();\r\n    },\r\n\r\n    \r\n    getElementsToStylize: function($context){\r\n        return this.properties.editable ? $(\"input\", $context) : $(\".readonly-control\", $context); \r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi smartphone Render Association\r\n*   Author: UI Forms Team\r\n*   Comments: Defines the association control\r\n*/\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.association\", bizagi.rendering.association.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.association.extend(\"bizagi.rendering.smartphone.association\", {}, {\r\n\r\n   /**\r\n     * Template method to implement in each children to customize each control\r\n     * \r\n     * @returns {} \r\n     */\r\n    renderControl: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"association\");\r\n        var def = new $.Deferred();\r\n\r\n        self.properties.property = \"flipped\";\r\n        self.properties.idRender = self.properties.id;\r\n\r\n        // Define flipped\r\n        $.when(self.getFlipAssociation()).done(function (flip) {\r\n            // Make json base, create self.properties.formatJson\r\n            self.makeJsonBase();\r\n\r\n            self.properties.flipped = bizagi.util.parseBoolean(flip) || false;\r\n\r\n            var columnData = self.getColumnData();\r\n\r\n            var html = $.fasttmpl(template, $.extend(self.properties, { columnData: columnData }), {\r\n                getColumnData: self.getColumnData,\r\n                getRightAssociation: self.getRightAssociation\r\n            });\r\n\r\n            /* by default need set self.properties.formatJson */\r\n            self.setValue(JSON.encode(self.properties.formatJson));\r\n\r\n            def.resolve(html);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    /**\r\n     * Get Left Data, verify if flipper flags sets true\r\n     *\r\n     * @param column {'0'||'1'}\r\n     */\r\n    getColumnData: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var data = [];\r\n\r\n        self.data = properties;\r\n\r\n        var dataAssociation = properties.flipped ? properties.rightData : properties.leftData;\r\n\r\n        $.each(dataAssociation, function (key, item) {\r\n            data.push({\r\n                id: item.id,\r\n                value: item.value,\r\n                association: self.getRightAssociation(item.id)\r\n            });\r\n        });\r\n\r\n        return data;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        var isExecution = self.getMode() === \"execution\";\r\n        var $control = self.getControl();\r\n\r\n        // Cache control\r\n        self.association = $(\".bz-association\", $control);\r\n       \r\n        // Add Events at Association Control\r\n        if (isExecution) {self.addEventControl(); }\r\n               \r\n        self.showDefaultGroupList();\r\n    },\r\n\r\n    showDefaultGroupList: function(){\r\n        var self = this;\r\n        var $control = self.getControl();\r\n        var $groups = $('.bz-association-group', $control);\r\n\r\n        if($groups.length > 0){\r\n            $(\"[data-action='collapse']\", $groups[0]).toggleClass(\"bz-icn--expanded\")\r\n\r\n            $(\".bz-association-group__list\", $groups[0])\r\n                .slideDown(300, function(){                                               \r\n                    $(this).toggleClass(\"bz-association-group__list--hidden\")\r\n                });           \r\n        }\r\n    },\r\n\r\n    /**\r\n     * Add event to control\r\n     * @returns {} \r\n     */\r\n    addEventControl: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"association\");\r\n        var control = self.getControl();\r\n\r\n        // Bind check toggle\r\n        self.association\r\n            .on(\"change\", \"input:checkbox\", function () {\r\n                var $input = $(this);\r\n                var parentId = $input.data(\"parent-id\");\r\n                var id = $input.data(\"id\");\r\n\r\n                if ($input.prop(\"checked\")) { self.addElement(parentId, id);} \r\n                else { self.removeElement(parentId, id);}\r\n            });\r\n\r\n        // Bind flip actions\r\n        self.association\r\n            .find(\"[data-action='flip']\")\r\n            .click(function () {\r\n                $(control).empty();\r\n\r\n                // Define flipped\r\n                self.properties.flipped = !self.properties.flipped;\r\n\r\n                // Send flip data to server\r\n                self.properties.flipstate = self.properties.flipped;\r\n\r\n                self.dataService.getFlipAssociation(self.properties);\r\n\r\n                var columnData = self.getColumnData();\r\n\r\n                // Render template\r\n                $($.fasttmpl(template, $.extend(self.properties, { columnData: columnData }), {\r\n                    getColumnData: self.getColumnData,\r\n                    getRightAssociation: self.getRightAssociation\r\n                })).appendTo(control);\r\n\r\n                self.postRender();\r\n            });\r\n\r\n        //header\r\n        self.association.on(\"click\",  \"[data-action='collapse']\", function(){\r\n            var $element = $(this); \r\n            var $groupList = \r\n                $element\r\n                    .parents('.bz-association-group')\r\n                    .find(\".bz-association-group__list\");\r\n                            \r\n            self.closeAccordionSection();\r\n            if ($groupList.hasClass(\"bz-association-group__list--hidden\")) {\r\n\r\n                $element.toggleClass(\"bz-icn--expanded\");\r\n\r\n                $groupList.slideDown(300, function(){                    \r\n                    $(this).toggleClass(\"bz-association-group__list--hidden\");\r\n                });        \r\n            }                                               \r\n        });\r\n    },\r\n\r\n    closeAccordionSection: function(active){\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        $(\"[data-action='collapse']\", $control).removeClass('bz-icn--expanded'); \r\n\r\n        $(\".bz-association-group__list\", $control)\r\n            .slideUp(300, function(){\r\n                $(this).addClass(\"bz-association-group__list--hidden\");    \r\n            });\r\n    },\r\n\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n\r\n        return self.renderControl();\r\n    },\r\n\r\n    /**\r\n     * Render for readonly\r\n     * @returns {} \r\n     */\r\n    postRenderReadOnly: function () {\r\n        this.postRender();       \r\n    },\r\n\r\n    /* SET-DISPLAY-VALUE\r\n     =====================================================*/\r\n    setDisplayValue: function (value) {        \r\n        // Set internal value\r\n        this.setValue(value, false);\r\n    },\r\n\r\n    getLabel: function () {\r\n        if (!this.label) {\r\n            var label = $(\"> .bz-form-label\", this.element || this.observableElement);\r\n\r\n            if (label.length > 0)\r\n                this.label = label;\r\n\r\n            return label;\r\n        }\r\n        return this.label;\r\n    }\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Search List Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the search-list render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.searchList\", bizagi.rendering.searchList.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.searchList.extend(\"bizagi.rendering.smartphone.searchList\", {\r\n    SEARCH_MIN_LENGTH: 2,\r\n    SEARCH_MAX_RECORDS: 50,\r\n    SEARCH_DELAY: 250,\r\n    SEARCH_ELEMENTS: {}\r\n}, {\r\n\r\n    renderControl: function() {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var template = self.renderFactory.getTemplate(\"searchList\");\r\n\r\n        return $.fasttmpl(template, {\r\n            id: properties.id,\r\n            value: properties.value.map(function(el){\r\n                return self.formatItem(el.value);\r\n            }).join(\", \")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize each render after processed\r\n     * @returns {}\r\n     */\r\n    postRender: function () {\r\n        this.searchListInput = $(\".bz-search-list__input\", this.getControl());\r\n    },\r\n\r\n    postRenderReadOnly: function () {\r\n        this.searchListInput = $(\".bz-search-list__input\", this.getControl());\r\n    },\r\n\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"searchList.readonly\");\r\n\r\n        // Render template\r\n        var content = $.fasttmpl(template, {\r\n            items: self.properties.value || {},\r\n            editable: self.properties.editable || true\r\n        }, {\r\n            formatItem: self.formatItem\r\n        });\r\n\r\n        return content;\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each device to customize the render's behaviour\r\n     * to add handlers\r\n     * @returns {}\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        // Select new item\r\n        self.searchListInput.on(\"click\", function (evt) {\r\n            var parent = $(evt.target).parent() || {};\r\n            if (parent.hasClass('bz-pill')) return;\r\n\r\n            self._searchListViewModal();\r\n        });\r\n    },\r\n\r\n    _searchListViewModal: function () {\r\n        var self = this;\r\n        var header = self.getHeaderTemplate();\r\n        var content = self.getContentTemplate();\r\n        var footer = self.getFooterTemplate();\r\n\r\n        self.searchListInput.mobileView({\r\n            customHeader: header,\r\n            orientation: self.properties.orientation || \"\",\r\n            cssClassHeader: \"bz-modal-view__header-multiple\",\r\n            contentTemplate: content,\r\n            footerTemplate: footer,\r\n            transition: \"slideIn:up\",\r\n            close: function () {\r\n                $(window).unbind(\"resize\");\r\n                self.triggerGlobalHandler(\"modalViewDidDisappear\", {});\r\n            },\r\n            afterOpenAnimation: function(event){\r\n                $(\".bz-modal-view__search\", event.view.header).focus();\r\n            },\r\n            open: function () {\r\n                self.triggerGlobalHandler(\"closeModalValidationMessage\", {});\r\n                self.triggerGlobalHandler(\"modalViewDidAppear\", {});\r\n            },\r\n            configureActions: function (context) {\r\n                self.adjustResize();\r\n                self.configureModalViewHandlers(context);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Sets the value in the rendered control\r\n     * @param {} value\r\n     * @returns {}\r\n     */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var finalValue = typeof (value) === \"string\" ? JSON.parse(value).value : value.value;\r\n\r\n        // Set internal value\r\n        self.setValue(finalValue);\r\n\r\n        if (value !== undefined) {\r\n            if (self.properties.editable) {\r\n                self.searchListInput.html(finalValue.map(function(el){\r\n                    return self.formatItem(el.value);\r\n                }).join(\", \"));\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Remove a item from the list\r\n     * @param {} element\r\n     * @returns {}\r\n     */\r\n    deleteItem: function (element) {\r\n        var self = this;\r\n        var item = element.parent('div');\r\n\r\n        // Remove from main memory and set the new value\r\n        self.removeElement({ id: item.data(\"id\") });\r\n\r\n        // Remove list element\r\n        item.remove();\r\n    },\r\n\r\n    selectItem: function (item) {\r\n        var templateItem = this.getTagTemplate(item, this.properties.editable);\r\n        this.modalViewTagList.append(templateItem);\r\n    },\r\n\r\n    /**\r\n     * Configure the modalView Handlers for the new suggest control\r\n     * @param {} inputContainer\r\n     * @returns {}\r\n     */\r\n    configureModalViewHandlers: function (modalView) {\r\n        var self = this;\r\n        var modalFooter = modalView.footer;\r\n        var modalHeader = modalView.header;\r\n\r\n        // Initialize data\r\n        var elements = {};\r\n\r\n        if (self.hasValue()) {\r\n            var list = self.getListItems();\r\n            $.each(list, function (index, item) {\r\n                elements[item.id] = item;\r\n            });\r\n        }\r\n\r\n        // Configuring list as a selectable element\r\n        self.modalViewList = $(\".bz-list\", modalView.content);\r\n        self.modalViewTagList = $(\".bz-search-pill__results\", modalHeader);\r\n\r\n        var $clearButton = $(\".bz-modal-view__clear\", modalHeader);\r\n\r\n        // Suggest\r\n        var $suggestInput = $(\".bz-modal-view__search\", modalHeader);\r\n        var suggestFilter = bizagi.util.debounce(function () {\r\n            if (this.value === \"\") {\r\n                $clearButton.removeClass(\"bz-modal-view__clear--visible\");\r\n            } else {\r\n                $clearButton.addClass(\"bz-modal-view__clear--visible\");\r\n            }\r\n            self.autoCompleteSearchResults($.trim(this.value));\r\n        }, this.Class.SEARCH_DELAY);\r\n\r\n        $suggestInput.on(\"change keyup\", suggestFilter).on(\"focus\", function () {\r\n            modalView.header.addClass(\"bz-modal-view__header--active\");\r\n        }).on(\"blur\", function () {\r\n            modalView.header.removeClass(\"bz-modal-view__header--active\");\r\n        });\r\n\r\n        //Clear the search\r\n        $clearButton.bind(\"click\", function () {\r\n            $suggestInput.val(\"\").trigger(\"change\");\r\n        });\r\n\r\n        $(\"[data-action=close]\", modalView.header).bind(\"click\", function () {\r\n            modalView.close();\r\n        });\r\n\r\n        // Add tags to list\r\n        self.modalViewList.on(\"click\", \"li\", function () {\r\n            var item = $.data(this).item;\r\n\r\n            // Prevent duplicate elements\r\n            if (!item || (item && elements[item.id])) return;\r\n            elements[item.id] = item;\r\n\r\n            // Update state of button\r\n            $(modalFooter).find('.bz-btn').removeClass(\"bz-btn--secundary\");\r\n            $(modalFooter).find('.bz-btn').addClass(\"bz-btn--primary\");\r\n\r\n            // Update list\r\n            if ((Object.keys(elements) || []).length === 1) {\r\n                $(modalHeader).find(\".bz-search-pill__selected \")\r\n                    .removeClass(\"bz-search-pill__selected--hidden\");\r\n            }\r\n\r\n            self.selectItem(item);\r\n        });\r\n\r\n        // Remove tags of list\r\n        self.modalViewTagList.on(\"click\", '.bz-pill > .bz-btn-icn', function (evt) {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n\r\n            var element = $(this);\r\n            var tag = element.parent('div');\r\n\r\n            // Update state of button\r\n            $(modalFooter).find('.bz-btn').removeClass(\"bz-btn--secundary\");\r\n            $(modalFooter).find('.bz-btn').addClass(\"bz-btn--primary\");\r\n\r\n            // Remove from main memory and set the new value\r\n            delete elements[tag.data(\"id\")];\r\n\r\n            // Remove list element\r\n            tag.remove();\r\n\r\n            // Update list\r\n            if ((Object.keys(elements) || []).length === 0) {\r\n                $(modalHeader).find(\".bz-search-pill__selected \")\r\n                    .addClass(\"bz-search-pill__selected--hidden\");\r\n            }\r\n        });\r\n\r\n        $(modalFooter).delegate(\"[data-action=save]\", \"click\", function (evt) {\r\n            // Create a temporal array\r\n            var newList = [];\r\n            $.each(elements, function (index, item) {\r\n                newList.push(item);\r\n            });\r\n\r\n            self.setDisplayValue({value: newList});\r\n\r\n            modalView.close();\r\n        });\r\n    },\r\n\r\n    autoCompleteSearchResults: function (currentValue) {\r\n        var self = this;\r\n\r\n        $.when(self.processRequest({ term: currentValue }))\r\n            .done(function (response) {\r\n\r\n                self.modalViewList.find(\"li\").remove();\r\n\r\n                for (var i = 0, length = response.length; i < length; i++) {\r\n                    var searchItem = self.renderSearchItem(response[i]);\r\n\r\n                    searchItem.appendTo(self.modalViewList);\r\n                }\r\n            });\r\n    },\r\n\r\n    renderSearchItem: function (item) {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"searchList.item\");\r\n\r\n        var searchItem = $.tmpl(template, {\r\n            id: item.id,\r\n            label: item.label,\r\n            value: this.formatItem(item.value)\r\n        });\r\n\r\n        searchItem.data(\"item\", item);\r\n\r\n        return searchItem;\r\n    },\r\n\r\n    /**\r\n     * Process the request data for the autocomplete control\r\n     * @param {} req\r\n     * @returns {}\r\n     */\r\n    processRequest: function (req) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var deferred = new $.Deferred();\r\n\r\n        // Create array for response objects   \r\n        var suggestions = [];\r\n\r\n        if (req.term.length >= this.Class.SEARCH_MIN_LENGTH) {\r\n\r\n            // Update term property to reflect the search\r\n            properties.term = req.term;\r\n\r\n            // Cancel previous request in order to improve the performance\r\n            if (self.deferredReference && typeof (self.deferredReference.reject) === \"function\" &&\r\n                self.deferredReference.state() !== \"resolved\") {\r\n                self.deferredReference.reject({ hideStatus: true });\r\n            }\r\n\r\n            self.deferredReference = self.getData().done(function (data) {\r\n                if (data && data.length > 0) {\r\n                    data = data.slice(0, properties.maxRecords);\r\n\r\n                    if (data.length > self.Class.SEARCH_MAX_RECORDS) {\r\n                        data = data.slice(0, self.Class.SEARCH_MAX_RECORDS);\r\n\r\n                        suggestions.push({\r\n                            id: self.Class.NO_RESULTS_SEARCH_ID,\r\n                            label: self.getResource(\"render-search-maximum-records-allowed\"),\r\n                            value: \"\"\r\n                        });\r\n\r\n\r\n                    } else {\r\n                        data = data.slice(0, properties.maxRecords);\r\n                    }\r\n\r\n                    $.each(data, function (i, val) {\r\n                        if (properties.maxRecords === 0 || i < properties.maxRecords) {\r\n                            var parseValue = bizagi.util.highlightMatches(val, req.term);\r\n\r\n                            suggestions.push({ id: val.id, label: parseValue, value: val.value });\r\n                        }\r\n                    });\r\n\r\n                } else {\r\n                    suggestions.push({\r\n                        id: self.Class.NO_RESULTS_SEARCH_ID,\r\n                        label: self.getResource(\"render-grid-no-records\"),\r\n                        value: \"\"\r\n                    });\r\n                }\r\n\r\n                deferred.resolve(suggestions);\r\n\r\n            }).fail(function () {\r\n                deferred.reject();\r\n            });\r\n\r\n        } else {\r\n            deferred.resolve(suggestions);\r\n        }\r\n\r\n        return deferred.promise();\r\n    },\r\n\r\n    getContentTemplate: function () {\r\n        var self = this;\r\n        var value = self.getValue();\r\n        var finalValue = typeof (value) === \"string\" ? JSON.parse(value).value : value.value;\r\n\r\n        var template = this.renderFactory.getTemplate(\"searchList.items\");\r\n        var content = $.fasttmpl(template, {\r\n            items: finalValue || {},\r\n            editable: self.properties.editable || true\r\n        },{\r\n            formatItem: self.formatItem\r\n        });\r\n\r\n        return $.trim(content);\r\n    },\r\n\r\n    getFooterTemplate: function () {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(\"searchList.actions\");\r\n        var content = $.fasttmpl(template, {\r\n            items: self.properties.value || {},\r\n            editable: self.properties.editable || true\r\n        });\r\n\r\n        return $.trim(content);\r\n    },\r\n\r\n    getTagTemplate: function (item, editable) {\r\n        var template = this.renderFactory.getTemplate(\"searchList.tag\");\r\n        var content = $.fasttmpl(template, {\r\n            id: item.id,\r\n            label: item.label,\r\n            value: this.formatItem(item.value),\r\n            editable: editable\r\n        });\r\n        return $.trim(content);\r\n    },\r\n\r\n    adjustResize: function () {\r\n        var self = this;\r\n        var initialScreenSize = window.innerHeight;\r\n\r\n        $(window).off(\"resize\").on(\"resize\", bizagi.util.debounce(function () {\r\n            var that = $(this);\r\n\r\n            // Hide the footer\r\n            if (that.height() < initialScreenSize) {\r\n                $(\".bz-mobile-view__footer_content\").addClass(\"bz-hidden\");\r\n            } else {\r\n                $(\".bz-mobile-view__footer_content\").removeClass(\"bz-hidden\");\r\n            }\r\n        }, self.Class.SEARCH_DELAY));\r\n    },\r\n\r\n    getHeaderTemplate: function () {\r\n        var self = this;\r\n        var value = self.getValue();\r\n        var finalValue = typeof (value) === \"string\" ? JSON.parse(value).value : value.value;\r\n        var template = this.renderFactory.getTemplate(\"searchList-modal-header\");\r\n\r\n        var content = $.fasttmpl(template, {\r\n            items: finalValue || {},\r\n            editable: self.properties.editable || true,\r\n            emptyItems: (finalValue || []).length === 0,\r\n        }, {\r\n            formatItem: self.formatItem\r\n        });\r\n\r\n        return $.trim(content);\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi User Field render tablet Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will define the basic behaviour for userfields\r\n */\r\n\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.userfieldWrapper\", bizagi.rendering.userfieldWrapper.prototype);\r\nbizagi.rendering.smartphone.userfieldWrapper.extend(\"bizagi.rendering.smartphone.userfieldWrapper\", {}, {\r\n\r\n    /**\r\n     *   Load userfield\r\n     */\r\n    getUserfieldControl: function () {\r\n        var self = this;\r\n        var sControl = self.userfieldName;\r\n        var mode = self.getMode();\r\n        var exists = (mode !== \"execution\") || eval(\"bizagi.rendering.smartphone.\" + sControl + \" !== undefined\");\r\n        var def = new $.Deferred();\r\n\r\n        if (exists) {\r\n            // Creates the userfield instance\r\n            // Set true argument for tabItem\r\n            $.when(self.parent.ready()).done(function () {\r\n                def.resolve(self.createUserfieldInstance(sControl));\r\n            });\r\n\r\n        } else {\r\n            // Call ajax service in order to retrieve user field definitions\r\n            $.when(self.dataService.getUserfieldDefinition({\r\n                userfield: self.userfieldGuid,\r\n                device: \"smartphone\"\r\n            })).pipe(function (data) {\r\n                // Load userfield in memory\r\n                self.loadUserfield(data);\r\n\r\n                // Creates the userfield instance\r\n                def.resolve(self.createUserfieldInstance(sControl));\r\n            });\r\n        }\r\n\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Creates the userfield instance when the userfield prototype is loaded in memory\r\n     */\r\n    createUserfieldInstance: function (sControl) {\r\n        var self = this;\r\n        var control;\r\n        try {\r\n            // Create a dynamic function to avoid problem with eval calls when minifying the code\r\n            var dynamicFunction = \"var baDynamicFn = function(renderParams){ \\r\\n\";\r\n            dynamicFunction += \"return new bizagi.rendering.smartphone.\" + sControl + \"(renderParams);\\r\\n\";\r\n            dynamicFunction += \"}\\r\\n\";\r\n            dynamicFunction += \"baDynamicFn\";\r\n            dynamicFunction = eval(dynamicFunction);\r\n\r\n            // Call the dynamic function\r\n            control = dynamicFunction(self.initialParams);\r\n        } catch (e) {\r\n            // If the call fails, return the default user field\r\n            control = self.getUserFieldInstance(self.initialParams);\r\n        }\r\n        control.properties.isUserField = true;\r\n\r\n        // Save userfield instance\r\n        self.userfieldInstance = control;\r\n\r\n        // Create proxy methods from the wrapper to the userfield instance\r\n        self.replicateUserfieldMethods(control);\r\n\r\n        // Replicate renderchange event from wrapped element to grid if applies\r\n        self.userfieldInstance.bind(\"renderchange\", function () {\r\n            self.triggerHandler(\"renderchange\", arguments);\r\n        });\r\n\r\n        return control;\r\n    },\r\n\r\n    /**\r\n     * Load userfield into memory\r\n     */\r\n    loadUserfield: function (data) {\r\n        var self = this;\r\n        var styleContent = \"\";\r\n\r\n        self.properties.styleGuid = self.properties.styleGuid || Math.guid();\r\n\r\n        try {\r\n            // Parse data\r\n            try {\r\n                data = eval(data);\r\n            } catch (e) {\r\n                bizagi.log(\"Could not parse result userfield \" + self.userfieldName, e.message);\r\n            }\r\n\r\n            // Iterate elements\r\n            $.each(data, function (index, val) {\r\n                if (val.type === \"js\") {\r\n                    try {\r\n                        function replaceWithDevice(str) {\r\n                            return str.replace(/bizagi.rendering/gi, \"bizagi.rendering.smartphone\");\r\n                        }\r\n\r\n                        val.content = val.content.replace(/bizagi\\.rendering\\.[^\\s]+\\.extend(\\s|\\n|\\s)*\\((\\s|\\n|\\s)*\\\"bizagi\\.rendering\\.[^\\s]+\\\"/gmi, replaceWithDevice);\r\n                        window.eval(val.content);\r\n                    } catch (ex) {\r\n                        bizagi.log(\"Could not parse result userfield3 \" + self.userfieldName, ex.message);\r\n                    }\r\n                }\r\n                if (val.type === \"css\") {\r\n                    styleContent += val.content;\r\n                }\r\n            });\r\n\r\n            if ($.trim(styleContent) !== \"\") {\r\n                bizagi.util.loadStyle(styleContent, self.properties.styleGuid);\r\n            }\r\n\r\n            // Replicate userfield methods to the wrapper\r\n            var control = eval(\"bizagi.rendering.\" + self.userfieldName);\r\n\r\n        } catch (e) {\r\n            bizagi.log(\"Could not parse result userfield \" + self.userfieldName, e.message);\r\n        }\r\n    },\r\n\r\n    getUserFieldInstance: function (params) {\r\n        var mode = this.getMode();\r\n        // If the call fails, return the default user field\r\n        return (mode === \"execution\") ?\r\n            new bizagi.rendering.smartphone.defaultUserField(params) :\r\n            new bizagi.rendering.smartphone.designUserField(params);\r\n    }\r\n});\r\n\r\n// Auto-extension\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.basicUserField\", bizagi.rendering.userfieldDefinition.prototype);\r\nbizagi.rendering.smartphone.basicUserField.extend(\"bizagi.rendering.smartphone.basicUserField\", bizagi.rendering.basicUserField.prototype);\r\nbizagi.rendering.smartphone.basicUserField.extend(\"bizagi.rendering.smartphone.basicUserField\", {}, {\r\n\r\n    renderSingle: function () {\r\n        return this.postRender();\r\n    },\r\n\r\n    renderEdition: function () {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        $.when(self.postRender()).done(function () {\r\n            $.when(self.renderUserfieldControl()).done(function () {\r\n\r\n                self.inputEdition = self.input;\r\n                // alert(\"render Edition\");\r\n                defer.resolve();\r\n            });\r\n\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    getEditableControl: function () {\r\n        if (!this.isSupported()) {\r\n            return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this, arguments);\r\n        }\r\n    },\r\n\r\n    getReadonlyControl: function () {\r\n        if (!this.isSupported()) {\r\n            return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this, arguments);\r\n        }\r\n    },\r\n\r\n    isSupported: function () {\r\n        return true;\r\n    }\r\n});\r\n\r\n/*\r\n*   Default implementation for user fields\r\n*/\r\nbizagi.rendering.smartphone.basicUserField.extend(\"bizagi.rendering.smartphone.defaultUserField\", {}, {\r\n\r\n    /*\r\n    *   Template method to implement in each device to customize each render after processed\r\n    */\r\n    getEditableControl: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var container = self.getContainerRender();\r\n        var properties = self.properties;\r\n        var controlName = properties.control.replace(/column/g, \"\");\r\n\r\n        self.input = $(\"<label>Userfield: \" + controlName + \" not found</label>\").appendTo(control);\r\n        self.input.addClass(\"ui-bizagi-render-userfield-notSupported\");\r\n\r\n        container.addClass(\"bz-command-not-edit\");\r\n\r\n        return self.input;\r\n    },\r\n\r\n    /*\r\n    *  Dont send the data to the server\r\n    */\r\n    collectData: function (renderValues) {\r\n    },\r\n\r\n    getDisplayValue: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var controlName = properties.control;\r\n\r\n        return \"Userfield: \" + controlName + \" not found\";\r\n    },\r\n\r\n    getReadonlyControl: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var properties = self.properties;\r\n        var controlName = properties.control;\r\n        var mycontrol = $(\"<label>Userfield: \" + controlName + \" not found</label>\").appendTo(control);\r\n\r\n        return mycontrol;\r\n    }\r\n\r\n});","/*\r\n *   Name: Bizagi Smartphone Render list Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the activity checkList render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from base list\r\nbizagi.rendering.smartphone.checkList.extend(\"bizagi.rendering.smartphone.activityCheckList\", {}, {\r\n\r\n    /**\r\n     * Update or init the element data\r\n     * @param data\r\n     */\r\n    initializeData: function (data) {\r\n        // Call base\r\n        this._super(data);\r\n        var goal = (this.properties.activityDescription && this.properties.activityDescription !== \"\") \r\n        ?  bizagi.localization.getResource(\"workportal-project-plan-activity-goal\") + \": \" + this.properties.activityDescription : \"\";\r\n        this.properties.displayName = (goal !== \"\") ? goal : bizagi.localization.getResource(\"workportal-project-plan-activity-work-title\");\r\n        this.properties.displayType = \"vertical\";\r\n    },\r\n    /*\r\n     *   Template method to implement in each device to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n        // Call base\r\n        this._super();\r\n\r\n        self.newItemName = $(\".bz-checkList__input\", $control);\r\n        self.addEditButton = $(\".add-edit-item-button-checklist\", $control);\r\n        self.cancelEditButton = $(\".cancel-edit-item-button-checklist\", $control);\r\n\r\n        self.additionalElements();\r\n        self.notifyLoadItems();        \r\n    },\r\n\r\n    notifyLoadItems: function(){\r\n        var self = this;\r\n        setTimeout(function(){\r\n            var resolvedItems = self.properties.items.filter(function(i){\r\n                return i.resolved\r\n            }).length;\r\n            bizagi.util.setItemLocalStorage(\"newChanges\", JSON.stringify({\r\n                'hasChanges': true,\r\n                'idActivity': self.properties.idActivity,\r\n                'itemsResolved': resolvedItems,\r\n                'items': self.properties.items,\r\n                'progress': self.properties.activityWork\r\n            }));\r\n\r\n            bizagi.webpart.publish(\"onLoadDataItemsFromFormActivityPlan\", { \"items\": self.properties.items, \"activityWork\": self.properties.activityWork });\r\n        }, 100);\r\n    },\r\n\r\n    additionalElements: function () {\r\n        var self = this;\r\n\r\n        if (self.addEditButton && self.addEditButton.length > 0) {\r\n            self.addEditButton.hide();\r\n        }\r\n        if (self.cancelEditButton && self.cancelEditButton.length > 0) {\r\n            self.cancelEditButton.hide();\r\n        }\r\n        //control.parent().addClass(\"render-activity-check\");\r\n    },\r\n\r\n    configureHandlers: function() {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        this._super();\r\n        $(\"[data-action=add]\", control).unbind(\"click\").click(function() {\r\n            var itemSelected = $(\".bz-checkList__item.bz-checkList__item--selected\", self.control);\r\n            if (itemSelected.length <= 0) {\r\n                self.prepareNewItem();\r\n            } else {\r\n                $(\".bz-checkList__input\", itemSelected).focus();\r\n            }\r\n        });\r\n\r\n        $(\"[data-action=delete]\", self.control).bind(\"click\", function() {\r\n            var that = this;\r\n            var message = bizagi.localization.getResource(\"workportal-widget-reports-confirm\");\r\n            var contentHolder = $(this).closest(\".bz-checkList__item\");\r\n\r\n            contentHolder.addClass(\"ui-bizagi-to-remove\");\r\n           \r\n            $.when(bizagi.showConfirmationBox(message, \"Bizagi\", \"info\"))\r\n                .done(function() {\r\n\r\n                    var itemId = $(that).closest(\".bz-checkList__item\").data(\"item-guid\");\r\n\r\n                    self.deleteItem(itemId);\r\n                }).fail(function() {\r\n                    contentHolder.removeClass(\"ui-bizagi-to-remove\");\r\n                });\r\n        });\r\n\r\n        $(\"label[data-action=edit-item]\", self.control).bind(\"click\", function() {\r\n            var element = $(this).closest(\".bz-checkList__item\");\r\n            var itemId = element.data(\"item-guid\");\r\n            var itemPosition = element.data(\"item-position\");\r\n\r\n            self.selectItem(itemId, itemPosition);\r\n        });\r\n    },\r\n\r\n    selectItem: function(itemId) {\r\n        var self = this;\r\n\r\n        for (var i = 0, length = self.properties.items.length; i < length; i++) {\r\n            if (self.properties.items[i].guid === itemId) {\r\n                self.properties.items[i].selected = true;\r\n            } else {\r\n                self.properties.items[i].selected = false;\r\n            }\r\n        }\r\n\r\n        self.repaintControl();\r\n\r\n        var itemSelected = $(\".bz-checkList__item.bz-checkList__item--selected\", self.getControl());\r\n        var itemSelectedName = $(\".bz-checkList__input\", itemSelected);\r\n        var itemContent = itemSelectedName.val();\r\n\r\n        itemSelectedName.focus();\r\n        itemSelectedName[0].setSelectionRange(itemContent.length, itemContent.length);\r\n\r\n        self.addSelectedHandlers();\r\n    },\r\n\r\n    deleteItem: function(itemId) {\r\n        var self = this;\r\n\r\n        for (var i = 0, length = self.properties.items.length; i < length; i++) {\r\n            if (self.properties.items[i].guid === itemId) {\r\n                self.properties.items.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        self.setValue(self.properties.items);\r\n        self.repaintControl();\r\n        self.addSelectedHandlers();\r\n    },\r\n\r\n    prepareNewItem: function () {\r\n        var self = this;\r\n        var newItem = {\r\n            guid: Math.guid(),\r\n            resolved: false,\r\n            name: \"\",\r\n            selected: true\r\n        };\r\n\r\n        self.properties.items.push(newItem);\r\n        self.repaintControl();\r\n        self.newItemName.focus();\r\n\r\n        self.newItemName.blur(function () {\r\n             var itemSelected = $(\".bz-checkList__item.bz-checkList__item--selected\", self.control);\r\n             var itemSelectedName = $(\".bz-checkList__input\", itemSelected);\r\n             var valueInput = itemSelectedName.val();\r\n\r\n             if(valueInput === \"\" && self.properties.items && self.properties.items.length >= 1\r\n                    && self.properties.items.slice(-1)[0].name === \"\"){\r\n                self.properties.items.pop();\r\n             }\r\n         });\r\n        self.addSelectedHandlers();\r\n        self.newItemName.keypress(function (event) {\r\n            if (event.which == 13) {\r\n                event.preventDefault();\r\n                self.addItem();\r\n                self.prepareNewItem();\r\n            }\r\n        });\r\n    },\r\n\r\n    addSelectedHandlers: function () {\r\n        var self = this;\r\n        var itemSelected = $(\".bz-checkList__item.bz-checkList__item--selected\", self.control);\r\n        var itemSelectedName = $(\".bz-checkList__input\", itemSelected);\r\n        itemSelectedName.focus();\r\n        $(\"[data-action=accept-edit]\", itemSelected).bind(\"click\", function () {\r\n            var newItemName = itemSelectedName.val();\r\n            if (newItemName && newItemName !== \"\") {\r\n                self.addItem();\r\n            }\r\n        });\r\n\r\n        \r\n        $(\"[data-action=cancel-edit]\", itemSelected).bind(\"click\", function (e) {\r\n            var newItemName = itemSelectedName.val();\r\n            var element = $(this).closest(\".bz-checkList__item\");\r\n            var itemPosition = element.data(\"item-position\");\r\n            var guidItem = element.data(\"item-guid\");\r\n\r\n            if (newItemName && newItemName !== \"\" && self.properties.items[itemPosition].name !== \"\") {\r\n                self.properties.items[itemPosition].selected = false;\r\n            }\r\n            if (newItemName === \"\" || self.properties.items[itemPosition].name === \"\") {\r\n                self.deleteItem(guidItem);\r\n            }\r\n            //self.addButton.show();\r\n            self.repaintControl();\r\n        });\r\n    },\r\n\r\n    addItem: function () {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n\r\n        var itemSelected = $(\".bz-checkList__item.bz-checkList__item--selected\", $control);\r\n        var itemSelectedName = $(\".bz-checkList__input\", itemSelected);\r\n        var newItemName = itemSelectedName.val();\r\n\r\n        $.each(self.properties.items, function (index, item) {\r\n            if (item.selected) {\r\n                item.name = newItemName;\r\n                item.selected = false;\r\n            }\r\n        });\r\n        self.updateOriginalValue();\r\n        self.setValue(self.properties.items);\r\n        self.repaintControl();\r\n    },\r\n\r\n    repaintControl: function () {\r\n        var self = this;\r\n        var checkListHtml = self.renderControl();\r\n        $(\"[data-component=checkList]\", self.control).replaceWith(checkListHtml);\r\n        self.postRender();\r\n        self.configureHandlers();\r\n    },\r\n\r\n    onCheckListGroupChange: function (itemId, checked) {\r\n        var self = this;\r\n        var item;\r\n        var items = $.grep(self.properties.items, function (element, index) {\r\n            return element.guid === itemId;\r\n        });\r\n        if (items && items.length > 0) {\r\n            item = items[0];\r\n        }\r\n        item.resolved = checked;\r\n        self.setValue(self.properties.items);\r\n        self.refreshValue(self.properties.items);\r\n    },\r\n\r\n    refreshValue: function(items){\r\n        var self = this,\r\n            length = items.length,\r\n            completed = 0;\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (items[i].resolved) {\r\n                completed += 1;\r\n            }\r\n        }\r\n\r\n        if (length > 0) {\r\n            self.properties.activityWork = Math.floor(100 * completed / length);\r\n        }\r\n        else {\r\n            self.properties.activityWork = 100;\r\n        }\r\n\r\n        self.notifyLoadItems();\r\n    },\r\n\r\n    getValue: function () {\r\n        var self = this;\r\n        return self.value || [];\r\n    },\r\n\r\n    controlValueIsChanged: function () {\r\n        var self = this;\r\n        var originalValue = JSON.stringify(self.properties.originalValue);\r\n        var newValue = JSON.stringify(self.value);\r\n        return originalValue !== newValue;\r\n    },\r\n\r\n    /*\r\n     *   Updates original value for some comparisons\r\n     */\r\n    updateOriginalValue: function () {\r\n        var self = this;\r\n        self.properties.originalValue = bizagi.clone(self.value);\r\n    },\r\n\r\n    /*\r\n     *   Add the render data to the given collection in order to send data to the server\r\n     */\r\n    collectData: function (renderValues) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Add the render value\r\n        var xpath = properties.xpath;\r\n        var value = self.getValue();\r\n        var idActivity = self.properties.idActivity;\r\n\r\n        if (self.controlValueIsChanged()) {\r\n            // Filter by valid xpaths and valid values\r\n            if (!bizagi.util.isEmpty(xpath) && !bizagi.util.isEmpty(idActivity)) {\r\n                if (Array.isArray(value)) {\r\n                    renderValues[properties.xpath] = {\r\n                        idActivity: idActivity,\r\n                        items: value\r\n                    };\r\n                } else if (value === \"\") {\r\n                    renderValues[properties.xpath] = \"\";\r\n                }\r\n            }\r\n        }else{\r\n            bizagi.util.setItemLocalStorage(\"newChanges\", JSON.stringify({\r\n                'hasChanges': false\r\n            }));\r\n        }\r\n    },\r\n\r\n    isValid: function (invalidElements) {\r\n        var self = this,\r\n            properties = self.properties,\r\n            message;\r\n        var items = self.getValue();\r\n        message = self.getResource(\"render-activity-check-list-validation\");\r\n        for (var i = 0; i < items.length; i+=1) {\r\n            var item = items[i];\r\n            if (!item.resolved) {\r\n                invalidElements.push({\r\n                    xpath: properties.xpath,\r\n                    message: message\r\n                });\r\n                break;\r\n            }\r\n        }\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi smartphone Render Number Extension\r\n*   Author: Bizagi Mobile Team \r\n*   Comments:\r\n*   -   This script will redefine the number render class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from render smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.numberScientificNotation\", bizagi.rendering.numberScientificNotation.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.numberScientificNotation.extend(\"bizagi.rendering.smartphone.numberScientificNotation\", {}, {    \r\n\r\n});","/*  \r\n *   Name: Bizagi Smartphone Range Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the range render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render Smartphone base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.range\", bizagi.rendering.range.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.range.extend(\"bizagi.rendering.smartphone.range\", {}, {\r\n\r\n    /**\r\n     * Render a specific implementation for Smartphone device\r\n     */\r\n    postRender: function() {        \r\n        var properties = this.properties;\r\n    },\r\n    /**\r\n     * Render actual value of control and set events\r\n     * @param data\r\n     */\r\n    setDisplayValue: function(data) {\r\n        var control = this.getControl();\r\n    }\r\n\r\n});","/*  \r\n *   Name: Bizagi Smartphone Range Date Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the range date render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from range smartphone base\r\nbizagi.rendering.smartphone.range.extend(\"bizagi.rendering.smartphone.rangeDate\", bizagi.rendering.rangeDate.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.rangeDate.extend(\"bizagi.rendering.smartphone.rangeDate\", {}, {\r\n\r\n    /**\r\n     * Render a specific implementation for Desktop device\r\n     */\r\n    postRender: function() {\r\n        this.defineRangeControl();\r\n    }\r\n\r\n});","/*  \r\n *   Name: Bizagi Smartphone Money Date Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the range money render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from range smartphone base\r\nbizagi.rendering.smartphone.range.extend(\"bizagi.rendering.smartphone.rangeMoney\", bizagi.rendering.rangeMoney.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.rangeMoney.extend(\"bizagi.rendering.smartphone.rangeMoney\", {}, {\r\n\r\n    /**\r\n     * Render a specific implementation for Desktop device\r\n     */\r\n    postRender: function() {\r\n        this.defineRangeControl();\r\n    }\r\n\r\n});","/*  \r\n *   Name: Bizagi Smartphone Range Number Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the range number render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from range smartphone base\r\nbizagi.rendering.smartphone.range.extend(\"bizagi.rendering.smartphone.rangeNumber\", bizagi.rendering.rangeNumber.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.rangeNumber.extend(\"bizagi.rendering.smartphone.rangeNumber\", {}, {\r\n\r\n    /**\r\n     * Render a specific implementation for Desktop device\r\n     */\r\n    postRender: function() {\r\n        this.defineRangeControl();\r\n    }\r\n\r\n});","/*\r\n*   Name: BizAgi Desktop Render Template Text Extension\r\n*   Author: Andrés Fernando Muñoz\r\n*   Comments:\r\n*   -   This script will redefine the layout render class to adjust to desktop devices\r\n*/\r\n\r\n// Extends from render desktop base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.layoutRender\", bizagi.rendering.layoutRender.prototype);","/*\r\n *   Name: BizAgi Render Layout Image Class\r\n *   Author: Ricardo Pérez\r\n *   Comments:\r\n *   -   This script will define basic stuff for non editable image control inside templates\r\n *   -   This control is based on the image no flash render control\r\n */\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutImage\", bizagi.rendering.layoutImage.prototype);\r\n\r\nbizagi.rendering.smartphone.layoutImage.extend(\"bizagi.rendering.smartphone.layoutImage\", {\r\n}, {\r\n    \r\n    renderControl: function () {\r\n        var self = this;\r\n        var templateUri = self.renderFactory.getTemplate(\"layout-image\");\r\n        self.control = self.getControl();\r\n        return $.fasttmpl(templateUri, {});\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        if (self.value && typeof self.value.value !== \"undefined\" && self.value.value !== \"\" && self.value.value !== null) {\r\n            //Get image of customer in binary format\r\n            var url = self.getImageUri();\r\n            $.ajax({\r\n                url: url,\r\n                type: \"GET\",\r\n                dataType: \"binary\",\r\n                processData: false,\r\n                success: function (blob) {\r\n\r\n                    if (typeof blob == \"string\") {\r\n                        var xhr = arguments[2];\r\n                        var contentType = xhr.getResponseHeader('Content-type');\r\n                        blob = bizagi.util.media.byteArrayToBlob(bizagi.util.media.stringToByteArray(blob), contentType);\r\n                    }\r\n\r\n                    var urlCreator = window.URL || window.webkitURL;\r\n                    var imageUrl = urlCreator.createObjectURL(blob);\r\n\r\n                    $(control).find('img').attr(\"src\", imageUrl);\r\n                }\r\n            });\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Gets the url to get the array image\r\n     */\r\n    getImageUri: function () {\r\n        var self = this;\r\n\r\n        var map = {\r\n            entity: self.value.guid,\r\n            surrogateKey: self.value.surrogateKey,\r\n            xpath: self.properties.xpath,\r\n            width: 96,\r\n            height: 96,\r\n            hash: self.value.value\r\n        };\r\n\r\n        return self.dataService.serviceLocator.getUrl(\"render-entity-layout-imageByteArray\").replaceMultiple(map);\r\n    },\r\n    /**\r\n     *   Sets the value in the rendered control\r\n     */\r\n    getDisplayValue: function () {\r\n        var self = this;\r\n        return [self.value];\r\n    }\r\n});","/*\r\n *   Name: BizAgi Render Layout Label Class\r\n *   Author: Mauricio Sánchez\r\n *   Comments:\r\n *   -   This script will define basic stuff for labels inside templates\r\n */\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutPlaceholder\", bizagi.rendering.layoutPlaceholder.prototype);\r\n","/*\r\n*   Name: BizAgi Render Layout Boolean Class\r\n*   Author: Alexander Mejia\r\n*   Comments:\r\n*   -   This script will define basic stuff for boolean renders inside templates\r\n*/\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutBoolean\", bizagi.rendering.layoutBoolean.prototype);","/*\r\n *   Name: BizAgi Render Layout Simple Link Class\r\n *   Author: Ricardo Pérez\r\n *   Comments:\r\n *   -   This script will define basic stuff for non editable link renders inside templates\r\n *   -   This control is based on the link render control\r\n */\r\n\r\n \r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutLink\", bizagi.rendering.layoutLink.prototype);\r\n\r\nbizagi.rendering.smartphone.layoutLink.extend(\"bizagi.rendering.smartphone.layoutLink\", {\r\n\r\n    configureHandlers: function(){\r\n        var self= this;\r\n        var element = self.element;\r\n        if (element){\r\n            element.on(\"click\", $.proxy(self.onClickElement, self));\r\n        }\r\n    },\r\n\r\n    onClickElement: function(){\r\n        var self = this,\r\n            params = {\r\n                \"displayName\": self.properties.displayName,\r\n                \"navigateFromRender\": false,\r\n                \"reference\": self.properties.reference,\r\n                \"referenceType\": self.properties.referenceType,\r\n                \"xpath\": self.properties.xpath\r\n            };\r\n        if (bizagi.kendoMobileApplication && bizagi.kendoMobileApplication.view().id == \"#renderSplitView\"){\r\n            params.navigateFromRender = true;\r\n        }\r\n        self.triggerGlobalHandler(\"DATA-NAVIGATION\", params);\r\n    }\r\n});","/*\r\n*   Name: BizAgi Render Layout Label Class\r\n*   Author: Ricardo Pérez\r\n*   Comments:\r\n*   -   This script will define basic stuff for labels inside templates\r\n*/\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutLabel\", bizagi.rendering.layoutLabel.prototype);\r\n\r\nbizagi.rendering.smartphone.layoutLabel.extend(\"bizagi.rendering.smartphone.layoutLabel\", {\r\n\r\n    setValue: function (val, triggerEvents) {\r\n        var self = this;\r\n        self.properties.displayName = val;\r\n        this._super(val, triggerEvents);\r\n        var control = self.getControl();\r\n        if (control) {\r\n            $(\".ui-bizagi-render-label\", control).text(val);\r\n        }\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Render Layout Text Class\r\n*   Author: Ricardo Pérez\r\n*   Comments:\r\n*   -   This script will define basic stuff for text renders inside templates\r\n*/\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutText\", bizagi.rendering.layoutText.prototype);\r\n\r\nbizagi.rendering.smartphone.layoutText.extend(\"bizagi.rendering.smartphone.layoutText\", {\r\n    setDisplayValue: function (value) {\r\n    }\r\n});","/*\r\n*   Name: BizAgi Desktop Render Template dateTime Extension\r\n*   Author: Andres Fernando Muñoz\r\n*   Comments:\r\n*   -   This script will redefine the date time render class inside templates to adjust to desktop devices\r\n*/\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutDateTime\", bizagi.rendering.layoutDateTime.prototype);","/*\r\n *   Name: BizAgi Desktop Render Template number Extension\r\n *   Author: Mauricio Sanchez\r\n *   Comments:\r\n *   -   This script will redefine the number render class inside templates to adjust to desktop devices\r\n */\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutNumber\", bizagi.rendering.layoutNumber.prototype);\r\n\r\nbizagi.rendering.smartphone.layoutNumber.extend(\"bizagi.rendering.smartphone.layoutNumber\", {\r\n    /**\r\n     * Sets the value in the rendered control\r\n     */\r\n    setValue: function(val, triggerEvents) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        val = (typeof val === \"undefined\" || val === null) ?  \"\" : self.getDisplayValue(val);\r\n        self.properties.displayName = val;\r\n\r\n        this._super(val, triggerEvents);\r\n        if(control) {\r\n            $(\".ui-bizagi-render-number\", control).text(val);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the display value of the render\r\n     */\r\n    getDisplayValue: function (value) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var label = $('<label/>').html(value); // To get the display value by the format currency plugin, because it requires a control\r\n\r\n        label.formatCurrency({\r\n            symbol: properties.symbol,\r\n            positiveFormat: properties.positiveFormat,\r\n            negativeFormat: properties.negativeFormat,\r\n            decimalSymbol: properties.decimalSymbol,\r\n            digitGroupSymbol: properties.digitGroupSymbol,\r\n            groupDigits: properties.groupDigits,\r\n            roundToDecimalPlace: properties.numDecimals,\r\n            colorize: properties.colorize\r\n        });\r\n\r\n        return [label.text()];\r\n    }\r\n});","/**\r\n *   Name: Bizagi Smartphone Render Template Money Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the money render class inside templates to adjust to smartphone devices\r\n */\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutMoney\", bizagi.rendering.layoutNumber.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.layoutMoney.extend(\"bizagi.rendering.smartphone.layoutMoney\", bizagi.rendering.layoutMoney.prototype);\r\nbizagi.rendering.smartphone.layoutMoney.extend(\"bizagi.rendering.smartphone.layoutMoney\", {\r\n    /**\r\n     * Sets the value in the rendered control\r\n     */\r\n    setValue: function (val, triggerEvents) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n\r\n        val = (typeof val === \"undefined\" || val === null) ? \"\" : self.getDisplayValue(val);\r\n        self.properties.displayName = val;\r\n\r\n        this._super(val, triggerEvents);\r\n        if (control) {\r\n            $(\".ui-bizagi-render-number\", control).text(val);\r\n        }\r\n    }\r\n});","/*\r\n *   Name: BizAgi Desktop Render Layout Upload\r\n *   Author: Bizagi\r\n *   Comments:\r\n *   -   This script will define the upload on entity template\r\n */\r\n\r\nbizagi.rendering.smartphone.layoutRender.extend(\"bizagi.rendering.smartphone.layoutUpload\", bizagi.rendering.layoutUpload.prototype);\r\n\r\nbizagi.rendering.smartphone.layoutUpload.extend(\"bizagi.rendering.smartphone.layoutUpload\", {\r\n\t/**\r\n\t *   Template method to implement in each children to customize each control\r\n\t */\r\n\trenderControl: function () {\r\n\t\tvar self = this,\r\n\t\t\tproperties = self.properties,\r\n\t\t\tdefer = $.Deferred();\r\n\r\n\t\t$.when(self.getValueFilesByData(bizagi.clone(properties))).done(function(properties, valueResult){\r\n\t\t\tself.properties = properties;\r\n\t\t\tself.files = valueResult.files;\r\n\t\t\tdefer.resolve(self.getHTMLFiles());\r\n\t\t});\r\n\r\n\t\treturn defer.promise();\r\n\t},\r\n\r\n\tpostRender: function() {\r\n\t    var self = this;\r\n\t    var control = self.getControl();\r\n\t    var filesLinkElements = control.find(\".ui-bizagi-render-upload-item a\");\r\n\r\n\t    filesLinkElements.on(\"click\", function() {\r\n\t        bizagi.loading.start();\r\n\t        $.when(bizagi.util.media.downloadFile($(this).attr(\"data-url\"), this.title)).fail(function(error) {\r\n\t            if (error.responseText) {\r\n\t                self.getFormContainer().failHandler(error.responseText);\r\n\t            }\r\n\t        }).always(function() {\r\n\t            bizagi.loading.stop();\r\n\t        });\r\n\t    });\r\n\t},\r\n\r\n\tgetHTMLFiles: function(){\r\n\t\tvar self = this;\r\n\t\tvar files = $.map(self.files, function(el){\r\n\t\t\tvar file = {\"id\": el[0], \"filename\": el[1]};\r\n\t\t\tfile.url =  self.buildItemUrl(file);\r\n\t\t\treturn file;\r\n\t\t});\r\n\r\n\t\tvar template = self.renderFactory.getTemplate(\"layout-upload\");\r\n\t\treturn $.fasttmpl(template, {\"files\": files});\r\n\t},\r\n\r\n\t/**\r\n\t *   Builds the upload item url\r\n\t */\r\n\tbuildItemUrl: function (file) {\r\n\t\tvar self = this,\r\n\t\t\tproperties = self.properties;\r\n\r\n\t\tvar form = self.getFormContainer();\r\n\r\n\t\treturn self.dataService.getUploadFileEntityUrl({\r\n\t\t\tisContextContainerWidgetRender: self.isContextContainerWidgetRender(),\r\n\t\t\txpath: self.getUploadXpath(),\r\n\t\t\tfileId: file.id,\r\n\t\t\tidRender: form.properties.paramsRender.idRender || \"undefined\",\r\n\t\t\txpathContext: properties.xpathContext,\r\n\t\t\tidPageCache: form.properties.paramsRender.idPageCache || \"undefined\",\r\n\t\t\txpathActions: form.properties.paramsRender.xpathActions || \"undefined\",\r\n\t\t\tsessionId: form.properties.sessionId,\r\n\t\t\tsurrogatekey: self.properties.value.surrogateKey,\r\n\t\t\tguidentity: self.properties.value.guid\r\n\t\t});\r\n\t}\r\n});","/*\r\n*   Name: Bizagi Smartphone Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n\r\n// Extends itself\r\nbizagi.rendering.columns.column.extend(\"bizagi.rendering.smartphone.columns.column\", {}, {\r\n\r\n    /*\r\n    *   Apply custom overrides to each decorated instance\r\n    */\r\n    applyOverrides: function(decorated) {\r\n        // Hacks the getControl method in the decorated render to add features\r\n        if (decorated && decorated.getControl) {\r\n            this.originalGetControl = decorated.getControl;\r\n            decorated.getControl = this.getControl;\r\n            decorated.properties.displayType = \"normal\";\r\n        }\r\n    },\r\n\r\n    getContainerMessage: function(surrogateKey){\r\n        var decorated = this.getDecorated(surrogateKey);\r\n        return $(\".bz-form-cell-message__text\", decorated.element);\r\n    },\r\n\r\n    /*\r\n    *   Template method to get the control element\r\n    *   This code runs under the decorated element context\r\n    */\r\n    getControl: function() {\r\n        return $(\".bz-control\", this.element || this.observableElement);\r\n    },\r\n\r\n    isValueValid: function(surrogateKey, value, messages, propertyOverrides){\r\n        var isValid = this._super(surrogateKey, value, messages, propertyOverrides);\r\n        var decorated = this.getDecorated(surrogateKey);\r\n        var $message = this.getContainerMessage(surrogateKey);\r\n\r\n        if (!isValid) {\r\n            var message = messages.join(\",\").replace(/<\\w+>([^<]*)<\\/\\w+>/g, \"$1\");\r\n            $message.text(message);\r\n            decorated.element.addClass(\"bz-form-item--error\");\r\n        }\r\n        else {\r\n            $message.text(\"\");\r\n            decorated.element.removeClass(\"bz-form-item--error\");\r\n        }\r\n        return isValid;\r\n    },\r\n\r\n\r\n    /*\r\n    *   Apply column styles to a specified element\r\n    */\r\n    applyColumnStyles: function(element) {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Set cell back color\r\n        if (properties.textFormat.background) {\r\n            element.css(\"background-color\", properties.textFormat.background);\r\n            element.css(\"background-image\", \"none\");\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Post process the element after it has been rendered\r\n    */\r\n    postRenderReadOnly: function(surrogateKey, cell) {\r\n        var self = this;\r\n\r\n        // Call base        \r\n        self._super(key, cell);\r\n\r\n        // Just draw render if the cell layout has been filled\r\n        if (cell && cell.length > 0) {\r\n            var cellIcon = $(\".ui-bizagi-cell-icon\", cell);\r\n            if (!self.properties.editable) cellIcon.detach();\r\n\r\n            // Apply styles to cell\r\n            self.applyColumnStyles(cell);\r\n\r\n            if (self.properties.align == \"left\") {\r\n                cellIcon.addClass(\"ui-bizagi-cell-icon-right\");\r\n            }\r\n        }\r\n    }\r\n\r\n});","/*\r\n*   Name: Bizagi Smartphone Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the column decorator class to adjust to smartphone devices\r\n*/\r\n\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.combo\", {}, bizagi.rendering.columns.combo.prototype );\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.combo.extend(\"bizagi.rendering.smartphone.columns.combo\", {}, {\r\n    applyOverrides: function(decorated) {\r\n        // Hacks the getControl method in the decorated render to add features\r\n        var self = this;\r\n        self._super(decorated);\r\n\r\n        if (decorated && decorated.getControl) {\r\n            self.originalGetControl = decorated.getControl;\r\n            decorated.getControl = self.getControl;\r\n            decorated.properties.displayType = \"normal\";\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Template method to get the control element\r\n    *   This code runs under the decorated element context\r\n    */\r\n    getControl: function() {\r\n        var self = this;\r\n        var result = self._super();\r\n\r\n        if (!result || result.length == 0) {\r\n            result = $(\".ui-bizagi-cell-readonly\", self.element || self.observableElement);\r\n        }\r\n\r\n        return result;\r\n    },\r\n     /*\r\n    *   Sets the internal value\r\n    */\r\n   setValue: function(surrogateKey, value) {\r\n    var self = this;\r\n    \r\n    // Check is offline form\t    \r\n    var isOfflineForm = bizagi.util.isOfflineForm({ context: self });\r\n    if(isOfflineForm && (typeof (value) == \"number\" || typeof (value) == \"string\")){\r\n        var newValue =  typeof (self.properties.data) == \"object\" ? self.properties.data.find(function(item){ return item.id == value }) : value;\r\n        var decorated = self.getDecorated(surrogateKey);\r\n        if (decorated !== null) {\r\n            decorated.selectedValue = value;\r\n        }\r\n        return self._super(surrogateKey, newValue);\r\n    }\r\n    else {\r\n        return self._super(surrogateKey, value);\r\n    }\r\n}\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Render Document Generator Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the document generator render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.document\", {}, {\r\n\r\n    /**\r\n     * Apply custom overrides to each decorated instance\r\n     * @param decorated\r\n     */\r\n    applyOverrides: function (decorated) {\r\n        var self = this;\r\n        var mode = self.getMode();\r\n\r\n        self._super(decorated);\r\n\r\n        if (mode !== \"design\") {\r\n            self.surrogateKey = decorated.surrogateKey;\r\n\r\n            decorated.getXpath = this.getXpath;\r\n            decorated.getDocumentXpath = this.getDocumentXpath;\r\n            decorated.getContextXpath = this.getContextXpath;\r\n            decorated.documentTemplateGenerate = this.documentTemplateGenerate;\r\n            decorated.preRenderControl = this.preRenderControl;\r\n            decorated.deleteDocumentTemplate = this.deleteDocumentTemplate;\r\n            decorated.properties.xpathContext = self.getContextXpath();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This method tries to get the HTML template an render the current object inside\r\n     * @return {jQuery} $.Deferred()\r\n     */\r\n    renderControl: function () {\r\n        this.preRenderControl();\r\n\r\n        return this._super();\r\n    },\r\n\r\n    /**\r\n     * Creates the event of generation of templates.\r\n     */\r\n    documentTemplateGenerate: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        self.startLoading();\r\n\r\n        // Get the context xPath\r\n        properties.xpathcontext = self.getContextXpath();\r\n        properties.xpath = self.getDocumentXpath(properties.xpath);\r\n\r\n        var grid = self.parent;\r\n        var form = self.getFormContainer();\r\n\r\n        $.when(form.submitData()).done(function () {\r\n            $.when(self.dataService.generateDocumentTemplate(properties)).done(function (response) {\r\n                $.when(grid.refresh()).done(function () {\r\n                    self.autoOpenDocuments();\r\n                });\r\n\r\n                self.endLoading();\r\n\r\n            }).fail(function () {\r\n                self.showErrorMessage();\r\n                self.endLoading();\r\n            });\r\n        }).fail(function (message) {\r\n            // Add error messages\r\n            self.getFormContainer().addErrorMessage(message);\r\n\r\n            self.endLoading();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Apply custom overrides to each decorated instance\r\n     * @param xpath\r\n     * @returns {string}\r\n     */\r\n    getXpath: function (xpath) {\r\n        var xpathPath = xpath;\r\n        var index = xpathPath.indexOf(this.grid.properties.xpath);\r\n\r\n        if (index !== -1) {\r\n            xpathPath = xpathPath.substr(index + this.grid.properties.xpath.length + 1);\r\n        }\r\n\r\n        return this.grid.properties.xpath + \"[id=\" + this.surrogateKey + \"].\" + xpathPath;\r\n    },\r\n\r\n    /**\r\n     * Returns the xpath to be used\r\n     * @param xpath\r\n     * @returns {*|string}\r\n     */\r\n    getDocumentXpath: function (xpath) {\r\n        var xpathPath = xpath;\r\n        var index = xpathPath.indexOf(this.grid.properties.xpath);\r\n\r\n        if (index !== -1) {\r\n            xpathPath = xpathPath.substr(index + this.grid.properties.xpath.length + 1);\r\n        }\r\n\r\n        return xpathPath;\r\n    },\r\n\r\n    /**\r\n     * Post process the element after it has been rendered\r\n     * @param surrogateKey\r\n     * @param cell\r\n     * @param tableCell\r\n     */\r\n    postRenderReadOnly: function (surrogateKey, cell, tableCell) {\r\n        // Call base\r\n        this._super(surrogateKey, cell, tableCell);\r\n    },\r\n\r\n    /**\r\n     * Returns the xpath to be used\r\n     * @returns {string}\r\n     */\r\n    getContextXpath: function () {\r\n        var self = this;\r\n        var form = self.getFormContainer();\r\n        var xpathContext = (form.properties.xpathContext) ? form.properties.xpathContext + \".\" : \"\";\r\n        return xpathContext + this.grid.properties.xpath + \"[id=\" + this.surrogateKey + \"]\";\r\n    },\r\n\r\n    /**\r\n     * Template method to implement in each children to customize each control\r\n     */\r\n    preRenderControl: function () {\r\n        if (this.value != undefined && this.properties.value != undefined) {\r\n            this.properties.value = this.value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Creates the event of generation of templates.\r\n     * @param filename\r\n     */\r\n    deleteDocumentTemplate: function (filename) {\r\n        var self = this;\r\n        var grid = self.parent;\r\n        var params = {};\r\n\r\n        params.xpath = self.properties.xpath + \"[fileName='\" + filename + \"']\";\r\n        params.idRender = self.properties.id;\r\n        params.xpathContext = self.getContextXpath();\r\n        params.idPageCache = self.properties.idPageCache;\r\n\r\n        $.when(self.dataService.deleteUploadFile(params)).done(function () {\r\n            grid.refresh();\r\n        });\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Date Column Decorator Extension\r\n*   Author: Ricardo Pérez\r\n*   Comments:\r\n*   -   This script will redefine the date column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.date\", {}, {});","/*\r\n*   Name: Bizagi Smartphone Text Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the text column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.text\", {}, {\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Number Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the number column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.number\", {}, {});\r\n","/**\r\n *   Name: Bizagi Smartphone Column Decorator Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the column decorator class to adjust to smartphone devices\r\n */\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.image\", {}, {\r\n\r\n    applyOverrides: function (decorated) {\r\n        var self = this;\r\n\r\n        this._super(decorated);\r\n\r\n        var propertiesGrid = self.grid.properties != \"undefined\" ? self.grid.properties : decorated.grid.properties;\r\n        var xpath = propertiesGrid.xpath + \"[id=\" + decorated.surrogateKey + \"]\";\r\n        //decorated.getUploadXpath = this.getUploadXpath;\r\n        decorated.properties.xpathContext =\r\n            self.properties.xpathContext.length > 0 ? self.properties.xpathContext + \".\" + xpath : xpath;\r\n        decorated.setDisplayValue = function () {\r\n            return true;\r\n        };\r\n    },\r\n    /**\r\n     * Returns the xpath to be used  \r\n     * @returns {} \r\n     */\r\n    /*getUploadXpath: function() {\r\n        return this.grid.properties.xpath + \"[id=\" + this.surrogateKey + \"].\" + this.properties.xpath;\r\n    }*/\r\n\r\n});","/*\r\n*   Name: Bizagi smartphone Upload Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the upload column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.upload\", {}, {\r\n\r\n    applyOverrides: function(decorated) {\r\n        var self = this;\r\n        var mode = self.getMode();\r\n\r\n        self._super(decorated);\r\n\r\n        if (mode != \"design\" && mode != \"layout\") {\r\n\r\n            decorated.getUploadXpath = self.getUploadXpath;\r\n\r\n            decorated.getXpathContext = function() {\r\n\r\n                var surrogateKey = this.surrogateKey || \"\";\r\n                var columnXpath = self.getUploadXpath(decorated);\r\n                var columnXpathSplit = columnXpath.split(\".\");\r\n                var nameFile = columnXpathSplit[columnXpathSplit.length - 1];\r\n                var xpath = self.grid.properties.xpath + \"[id=\" + surrogateKey + \"]\";\r\n\r\n                var xpathContext = self.properties.xpathContext.length > 0 ? self.properties.xpathContext + \".\" + xpath : xpath;\r\n\r\n                return { xpathContext: xpathContext, nameFile: nameFile };\r\n            };\r\n\r\n            decorated.buildItemUrl = function(file) {\r\n                var that = this;\r\n                var form = that.getFormContainer();\r\n                var context = that.getXpathContext();\r\n\r\n                return that.dataService.getUploadFileUrl({\r\n                    idRender: that.properties.id,\r\n                    xpath: context.nameFile,\r\n                    xpathContext: context.xpathContext,\r\n                    idPageCache: that.properties.idPageCache,\r\n                    fileId: file.id,\r\n                    sessionId: form.properties.sessionId,\r\n                    contexttype: that.properties.contexttype\r\n                });\r\n            };\r\n\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the xpath to be used  \r\n     * @param {} decorated \r\n     * @returns {} \r\n     */\r\n    getUploadXpath: function(decorated) {\r\n        var self = decorated || this;\r\n\r\n        return self.grid.properties.xpath + \"[id=\" + self.surrogateKey + \"].\" + self.properties.xpath;\r\n    }\r\n\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone Link Column Decorator Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the number column decorator class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.link\", {}, {\r\n\r\n    applyOverrides: function (decorated) {\r\n        var self = this;\r\n        var mode = self.getMode();\r\n\r\n        self._super(decorated);\r\n\r\n        if (mode !== \"design\" && mode !== \"layout\") {\r\n            self.surrogateKey = decorated.surrogateKey;\r\n\r\n            decorated.getXpath = self.getXpath;\r\n            decorated.properties.xpathContext = self.grid.properties.xpath + \"[id=\" + self.surrogateKey + \"]\";\r\n\r\n            if (self.grid.properties.xpathContext && decorated.properties.xpathContext.indexOf(self.grid.properties.xpathContext) === -1) {\r\n                decorated.properties.xpathContext = self.grid.properties.xpathContext + \".\" + decorated.properties.xpathContext;\r\n            }\r\n\r\n        }\r\n\r\n        if (decorated.properties.type === \"columnFormLink\") {\r\n            decorated.getFormLinkXpath = this.getFormLinkXpath;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Apply custom overrides to each decorated instance\r\n     * @param {} xpath\r\n     * @returns {}\r\n     */\r\n    getXpath: function (xpath) {\r\n        var xpathPath = xpath;\r\n        var index = xpathPath.indexOf(this.grid.properties.xpath);\r\n\r\n        if (index !== -1) {\r\n            xpathPath = xpathPath.substr(index + this.grid.properties.xpath.length + 1);\r\n        }\r\n\r\n        return this.grid.properties.xpath + \"[id=\" + this.surrogateKey + \"].\" + xpathPath;\r\n    },\r\n\r\n    /**\r\n     * Returns the xpath to be used\r\n     * @returns {}\r\n     */\r\n    getContextXpath: function () {\r\n        return this.grid.properties.xpath + \"[id=\" + this.surrogateKey + \"]\";\r\n    },\r\n\r\n    /**\r\n     * Get Form Link xpath to use\r\n     * @returns {*}\r\n     */\r\n    getFormLinkXpath: function () {\r\n        // Calculate layout properties to maximized property\r\n        this.properties.maximized = bizagi.util.parseBoolean(this.properties.maximized) !== null ? bizagi.util.parseBoolean(this.properties.maximized) : false;\r\n        this.calculateInitialLayoutProperties();\r\n\r\n        if (!this.properties.xpath) return;\r\n        return this.properties.xpath;\r\n    }\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the column decorator class to adjust to smartphone devices\r\n*/\r\n\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.search\", {}, bizagi.rendering.columns.search.prototype );\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.search.extend(\"bizagi.rendering.smartphone.columns.search\", {}, {\r\n\r\n    applyOverrides: function (decorated) {\r\n        this._super(decorated);\r\n    },\r\n\r\n    render: function (surrogateKey, value) {\r\n        var self = this;\r\n        if (value && value.length > 0) {\r\n            value = [].concat(value[0]);\r\n            return self._super(surrogateKey, {\r\n                id: value[0],\r\n                label: value[1],\r\n                additionallabel: value[2] || undefined\r\n            });\r\n        }\r\n        else {\r\n            return self._super(surrogateKey, value);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Post process the element after it has been rendered\r\n    */\r\n   postRender: function (surrogateKey, cell) {\r\n    // Call base\r\n    this._super(surrogateKey, cell);\r\n    var decorated = this.getDecorated(surrogateKey);\r\n    decorated.refreshControl = this.refreshControl;\r\n   },\r\n\r\n    refreshControl: function () {\r\n        this.grid.refreshCell({key: this.surrogateKey, column: this.properties.xpath, xpathContext: this.getFormContainer().properties.xpathContext});\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone ECM Column Decorator Extension\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will redefine the ECM column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.uploadecm\", {}, {\r\n\r\n    /**\r\n     * Apply custom overrides to each decorated instance\r\n     * @param {} decorated      \r\n     */\r\n    applyOverrides: function(decorated) {\r\n        this._super(decorated);\r\n\r\n        if (decorated && decorated.getControl) {\r\n            this.originalGetControl = decorated.getControl;\r\n            decorated.getControl = this.getControl;\r\n        }\r\n\r\n        decorated.getUploadXpath = this.getUploadXpath;\r\n        decorated.getXpathContext = this.getECMXpathContext;\r\n\r\n        decorated.buildItemUrl = function(file) {\r\n            var self = this;\r\n            var properties = self.properties;\r\n            var form = self.getFormContainer();\r\n            var columnXpath = self.getUploadXpath(self.surrogateKey);\r\n\r\n            columnXpath = columnXpath.split(\".\");\r\n\r\n            var nameFile = columnXpath[columnXpath.length - 1];\r\n            var xpathContext = self.getXpathContext(self.surrogateKey);\r\n\r\n            return self.dataService.getUploadFileUrl({\r\n                idRender: properties.id,\r\n                xpath: nameFile,\r\n                xpathContext: xpathContext,\r\n                idPageCache: properties.idPageCache,\r\n                fileId: file.idFileUpload,\r\n                sessionId: form.properties.sessionId,\r\n                contexttype: properties.contexttype\r\n            });\r\n        };\r\n\r\n        decorated.buildAddParams = function() {\r\n            var self = this;\r\n            var properties = self.properties;\r\n            var form = self.getFormContainer();            \r\n            var columnXpath = self.getUploadXpath(self.surrogateKey);\r\n\r\n            columnXpath = columnXpath.split(\".\");\r\n            var nameFile = columnXpath[columnXpath.length - 1];\r\n            var xpathContext = self.getXpathContext(self.surrogateKey);\r\n\r\n            var data = {\r\n                url: properties.addUrl,\r\n                xpath: properties.xpath,\r\n                idAttrib: properties.idAttrib,\r\n                xpathContext: xpathContext,\r\n                metaValues: [],\r\n                idSession: form.properties.sessionId,\r\n                contexttype: \"entity\",\r\n                validExtensions: properties.validExtensions,\r\n                maxSize: properties.maxSize\r\n            };\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = properties.idPageCache;\r\n\r\n            return data;\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Post process the element after it has been rendered\r\n     * @param {} surrogateKey      \r\n     */\r\n    getUploadXpath: function(surrogateKey) {\r\n        surrogateKey = this.surrogateKey || surrogateKey || \"\";\r\n        return this.grid.properties.xpath + \"[id=\" + surrogateKey + \"].\" + this.properties.xpath;\r\n    },\r\n\r\n\r\n    getControl: function() {\r\n        var result = this._super();\r\n\r\n        if (!result || result.length == 0) {\r\n            return $(\".ui-bizagi-cell-readonly\", this.element || this.observableElement);\r\n        } else {\r\n            return $(\".bz-control\", this.element || this.observableElement);\r\n        }\r\n\r\n    },\r\n\r\n    getECMXpathContext: function() {\r\n        var xpath = this.grid.properties.xpath + \"[id=\" + this.surrogateKey + \"]\";\r\n\r\n        return this.column.properties.xpathContext ? this.column.properties.xpathContext + \".\" + xpath : xpath;\r\n    }\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.button\", {}, {\r\n});","/**\r\n *   Name: Bizagi Smartphone Radio Column Decorator Extension\r\n *   Author: Bizagi UI Forms\r\n *   Comments:\r\n *   -   This script will redefine the Radio column decorator class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.combo.extend(\"bizagi.rendering.smartphone.columns.radio\", {}, {});\r\n","/*\r\n*   Name: Bizagi Smartphone Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the column decorator class to adjust to Smartphone devices\r\n*/\r\n\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.combo.extend(\"bizagi.rendering.smartphone.columns.list\", {}, {\r\n\r\n});\r\n","/*\r\n*   Name: Bizagi Smartphone Date Column Decorator Extension\r\n*   Author: Ricardo Pérez\r\n*   Comments:\r\n*   -   This script will redefine the check column to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from column\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.exclusiveCheck\", {}, { \r\n\r\n    /*\r\n     *   Returns the in-memory processed element\r\n     *   so the caller could append it to any place\r\n     */\r\n    render: function (surrogateKey, value) {\r\n\r\n        var self = this;\r\n        // Set flag to check when a render has changed\r\n        self.changed = false;\r\n        var properties = self.properties;\r\n        // Set grid and id references to the control in order to render the content\r\n        var decorated = self.getDecorated(surrogateKey);\r\n        decorated.grid = self.grid;\r\n        decorated.column = this;\r\n        decorated.surrogateKey = surrogateKey;\r\n\r\n        // Set cell value\r\n\r\n        self.setValue(surrogateKey, value || false);\r\n        var tmpCheck = self.grid.enabledChecks[self.properties.xpath].find(function(el){ \r\n            return el.id == surrogateKey;\r\n        });\r\n        if(typeof tmpCheck == \"undefined\"){                         \r\n           self.grid.enabledChecks[self.properties.xpath].push({                \r\n               id: surrogateKey,\r\n               value : value || false,\r\n               originalValue : value || false,\r\n               changed : false\r\n           });    \r\n        }\r\n        \r\n        if (value == null){\r\n            self.changed = true;\r\n            var obj = {};\r\n            obj[self.properties.xpath] = self.getValue(surrogateKey);\r\n            self.grid.changes[surrogateKey] = obj;\r\n        }\r\n       \r\n        // Override render properties\r\n        self.overrideDecoratedRenderProperties(surrogateKey);\r\n\r\n\r\n        // If the render is not editable return the readonly version of the column\r\n        if (!properties.editable)\r\n            return self.renderReadOnly.apply(self, arguments);\r\n\r\n        // Returns the decorated render inside a custom layout for columns\r\n        self.readyDeferred = new $.Deferred();\r\n        var cell = decorated.render(\"cell\");\r\n\r\n        // If the render changes set the flag on\r\n        decorated.bind(\"renderchange\", function () {\r\n            self.changed = true;\r\n            var checkList = self.grid.enabledChecks[self.properties.xpath];\r\n\r\n            checkList.forEach(function (el) {\r\n                if (el.id == surrogateKey) {\r\n                    el.value = decorated.value;\r\n                    el.changed = true;\r\n                }\r\n                else if (decorated.value && el.value){\r\n                    var tmpDecorated = self.getDecorated(el.id);\r\n                    tmpDecorated.setDisplayValue(false);\r\n                    self.setValue(el.id, false);\r\n                    el.value = false;\r\n                    el.changed = true;\r\n                }\r\n            });                   \r\n\r\n            var simpleXpathArray = self.properties.xpath.split(\".\");\r\n            self.grid.exclusiveChanges[self.properties.xpath] = {\r\n                xpath: self.properties.xpath,\r\n                simpleXpath: simpleXpathArray[simpleXpathArray.length - 1],\r\n                value: self.getValue(surrogateKey),\r\n                key: surrogateKey\r\n            };\r\n        });\r\n\r\n        self.bind(\"rendered\", function () {\r\n            self.readyDeferred.resolve();\r\n        });\r\n\r\n\r\n        return cell;\r\n    },\r\n\r\n    /*\r\n     *   Post process the element after it has been rendered\r\n     */\r\n    postRender: function (surrogateKey, cell) {\r\n        // Call base\r\n        this._super(surrogateKey, cell);\r\n\r\n        var self = this;\r\n        var mode = self.getMode();\r\n\r\n        this.setSurrogateKey(surrogateKey);\r\n        if (mode == \"execution\") {\r\n\r\n            var decorated = this.getDecorated(surrogateKey);\r\n            var control = decorated.getControl();\r\n\r\n            // Check if its new row\r\n            if (control.parents(\"tr\").data(\"new-row\")) {\r\n                // Show a disabled check box\r\n                control.html('<input type=\"checkbox\" name=\"exclusiveCheck\" title=\"' + bizagi.localization.getResource('render-grid-column-button-mandatory-key') + '\" disabled=\"disabled\" style=\"width:16.5px;height:16.5px;\">');\r\n\r\n                //Set the column with this attribute, so when the control is evaluated in isValid(), validated\r\n                //also if it is required, and belongs from a new row\r\n                self.isNewRow = true;\r\n            } else {\r\n                self.isNewRow = false;\r\n            }\r\n        }\r\n    },\r\n\r\n    isValueValid: function(surrogateKey, value, invalidElements, propertyOverrides){\r\n        self = this;\r\n        self.grid.enabledChecks = self.grid.enabledChecks || {};\r\n        var checkedValues =  (self.grid.enabledChecks[self.properties.xpath] || []).filter(function (el){ \r\n            return el.value;\r\n        });\r\n\r\n        if (checkedValues.length > 1) {\r\n            var message = self.getResource(\"render-exclusive-column-check-error\").replaceAll(\"#label#\", self.properties.displayName);\r\n            /* var messageData = {xpath: self.properties.xpath, message: message}; */\r\n            invalidElements.push(message);\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n\r\n    }\r\n    \r\n});","/*\r\n*   Name: Bizagi Smartphone Column Decorator Extension\r\n*   Author: Bizagi UI Forms\r\n*   Comments:\r\n*   -   This script will redefine the column decorator class to adjust to smartphone devices\r\n*/\r\n\r\n// Extends from columns smartphone base\r\nbizagi.rendering.smartphone.columns.column.extend(\"bizagi.rendering.smartphone.columns.readonly\", bizagi.rendering.columns.readonly.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.columns.readonly.extend(\"bizagi.rendering.smartphone.columns.readonly\", {}, {\r\n\r\n    render: function(surrogateKey, value) {\r\n        var template = this.renderFactory.getTemplate(\"cell.readonlycontrol\");\r\n        var valueToDisplay = \"\";\r\n        if(value != null && value != undefined) {\r\n            value = bizagi.util.sanitizeHTML(value);\r\n            valueToDisplay = value.replaceAll(\"\\\\n\", \"<br/>\").replaceAll(\"\\n\", \"<br/>\");\r\n        }\r\n        // Support for multiline text\r\n        return $.fasttmpl(template, {value: valueToDisplay});\r\n    }\r\n});","/**\r\n *   Name: Bizagi smartphone Render Document Generator Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the document generator render class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from render smartphone base and document base\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.document\", bizagi.rendering.document.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.document.extend(\"bizagi.rendering.smartphone.document\", {\r\n    ACTION_SHOW: \"show\",\r\n    ACTION_DOWNLOAD: \"download\",\r\n    ACTION_DELETE: \"delete\"\r\n}, {\r\n\r\n    /**\r\n     * This method tries to get the HTML template an render the current object inside\r\n     * @return {jQuery} $.Deferred()\r\n     */\r\n    renderControl: function () {\r\n        var self = this;\r\n        var template = this.renderFactory.getTemplate(self.getTemplate());\r\n        var documents = this.properties.value || [];\r\n\r\n        var data = {\r\n            downloadalldocuments: this.properties.downloadalldocuments,\r\n            allowgenerate: this.properties.allowGenerate,\r\n            noFiles: documents ? (documents.length === 0) : true,\r\n            append: this.properties.append,\r\n            caption: this.properties.caption\r\n        };\r\n\r\n        // Render template\r\n        var html = $.fasttmpl(template, data);\r\n\r\n        // Render current children\r\n        var items = this.renderDocumentsHtml(documents);\r\n        html = this.replaceFilesHtml(html, items);\r\n\r\n        // Render current children\r\n        var actions = this.renderActionsHtml(documents, data.noFiles, data.downloadalldocuments);\r\n        html = this.replaceActionsHtml(html, actions);\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed\r\n     */\r\n    postRender: function () {\r\n        var $control = this.getControl();\r\n\r\n        this.$inputDocument = $(\".bz-document-template__container\", $control);\r\n        this.$listDocuments = $(\"[data-component=files]\", $control);\r\n        this.$listActions = $(\"[data-component=actions]\", $control);\r\n\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * Method to render non editable values\r\n     * @returns {*|jQuery}\r\n     */\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var template = this.renderFactory.getTemplate(self.getTemplateReadonly());\r\n        var documents = this.properties.value || [];\r\n        var noFiles = documents ? (documents.length === 0) : true;\r\n\r\n        // Render template\r\n        var html = $.fasttmpl(template, {noFiles: noFiles});\r\n\r\n        // Render current children\r\n        var items = this.renderDocumentsHtml(documents);\r\n        html = this.replaceFilesHtml(html, items);\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed in read-only mode\r\n     */\r\n    postRenderReadOnly: function () {\r\n        var $control = this.getControl();\r\n\r\n        this.$listDocuments = $(\"[data-component=files]\", $control);\r\n    },\r\n\r\n    /**\r\n     * TMethod to customize the render's behaviour to add handlers\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n\r\n        // Attach handler\r\n        this.$inputDocument.on(\"click\", function (evt) {\r\n            self.properties.buttonExecuted = true;\r\n\r\n            if (self.properties.validate) {\r\n                // Check if the form is valid, then generate\r\n                if (self.validateContainer()) self.documentTemplateGenerate();\r\n            } else {\r\n                // Just generate the form\r\n                self.documentTemplateGenerate();\r\n            }\r\n\r\n            self.properties.buttonExecuted = false;\r\n        });\r\n\r\n        // Configure delete and preview handler\r\n        this.$listDocuments.on(\"click\", \"[data-action]\", function (evt) {\r\n            var $context = $(this);\r\n\r\n            var item = $context.parent(\".bz-document\");\r\n            var documentFile = item.data();\r\n            var action = $context.data(\"action\");\r\n\r\n            self.processAction(action, documentFile);\r\n        });\r\n\r\n        // Configure delete and download handler\r\n        self.$listActions.on(\"click\", \"[data-action]\", function (evt) {\r\n            var $context = $(this);\r\n\r\n            var item = $context.parent(\".bz-document__download\");\r\n            var documentFile = item.data();\r\n            var action = $context.data(\"action\");\r\n\r\n            self.processAction(action, documentFile);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Method to customize the render's behaviour to add handlers when the control is readonly\r\n     */\r\n    configureHandlersReadOnly: function () {\r\n        var self = this;\r\n\r\n        // Configure delete and preview handler\r\n        this.$listDocuments.on(\"click\", \"[data-action]\", function (evt) {\r\n            var $context = $(this);\r\n\r\n            var item = $context.parent(\".bz-document\");\r\n            var documentFile = item.data();\r\n            var action = $context.data(\"action\");\r\n\r\n            self.processAction(action, documentFile);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * This method must be implemented by the specific class of each device. (Virtual method)\r\n     * @param file\r\n     * @returns {*|*|*}\r\n     */\r\n    renderAllDocumentDownload: function (file) {\r\n        var self = this;\r\n        var template = self.renderFactory.getTemplate(self.getTemplateDownload());\r\n        var url = self.buildAllDocumentsUrl();\r\n\r\n        // Don't render urls when not running in execution mode\r\n        if (!this.isExecutionMode()) url = \"javascript:void(0);\";\r\n\r\n        var html = $.fasttmpl(template, {\r\n            url: url,\r\n            filename: file.fileName,\r\n            joined: true\r\n        });\r\n\r\n        return html;\r\n    },\r\n\r\n    /**\r\n     * Redraw documents when needed\r\n     * @param documents\r\n     * @param noFiles\r\n     * @param downloadAllDocuments\r\n     */\r\n    redrawDocuments: function (documents, noFiles, downloadAllDocuments) {\r\n        var self = this;\r\n        var $control = self.getControl();\r\n        var $documentContainer = $(\"[data-component='files']\", $control);\r\n        var $actionContainer = $(\"[data-component='actions']\", $control);\r\n\r\n        // Clear current links\r\n        $documentContainer.empty();\r\n        $actionContainer.empty();\r\n\r\n        // Draw links again\r\n        var items = this.renderDocumentsHtml(documents);\r\n        $documentContainer.append(items);\r\n\r\n        // Check if there are documents and the flag to download all are available to show the link.\r\n        var actions = this.renderActionsHtml(documents, noFiles, downloadAllDocuments);\r\n        $actionContainer.append(actions);\r\n\r\n        //Set value\r\n        self.setValue(documents);\r\n    },\r\n\r\n    /**\r\n     * Method to customize each render after processed (Virtual method)\r\n     * @param url\r\n     * @param filename\r\n     */\r\n    showDocumentPreview: function (url, filename) {\r\n        bizagi.loading.start();\r\n\r\n        $.when(bizagi.util.media.downloadFile(url, filename))\r\n            .fail(function (error) {\r\n                if (error.responseText) {\r\n                    self.getFormContainer().failHandler(error.responseText);\r\n                }\r\n            }).always(function () {\r\n            bizagi.loading.stop();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Process request of DocumentTemplateGenerate action\r\n     * @param documents\r\n     * @param noFiles\r\n     * @param downloadAllDocuments\r\n     */\r\n    resolveDocumentTemplateGenerate: function (documents, noFiles, downloadAllDocuments) {\r\n        // Redraw documents\r\n        this.redrawDocuments(documents, noFiles, downloadAllDocuments);\r\n        this.value = documents;\r\n    },\r\n\r\n    /**\r\n     * Process request of DocumentTemplateGenerate action\r\n     * @param documents\r\n     * @param noFiles\r\n     * @param downloadAllDocuments\r\n     */\r\n    resolveDeleteDocumentTemplate: function (documents, noFiles, downloadAllDocuments) {\r\n        // Redraw documents\r\n        this.redrawDocuments(documents, noFiles, downloadAllDocuments);\r\n        this.value = documents;\r\n    },\r\n\r\n    processAction: function (action, documentFile) {\r\n        if (action === this.Class.ACTION_DELETE) {\r\n            this.deleteDocumentTemplate(documentFile.filename);\r\n        } else if (action === this.Class.ACTION_SHOW) {\r\n            this.showDocumentPreview(documentFile.url, documentFile.filename);\r\n        } else if (action === this.Class.ACTION_DOWNLOAD) {\r\n            this.showDocumentPreview(documentFile.url, documentFile.filename);\r\n        }\r\n    }\r\n});\r\n","/**\r\n *   Name: Bizagi Smartphone queryForm Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the container class to adjust to smartphone devices\r\n *   -   Will apply a desktop form template\r\n */\r\n\r\n// Extends from form smartphone base\r\nbizagi.rendering.smartphone.form.extend(\"bizagi.rendering.smartphone.queryForm\", {}, {});","/**\r\n *   Name: Bizagi Smartphone FormTemplate Extension\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script will redefine the form template class to adjust to smartphone devices\r\n */\r\n\r\n// Extends from form smartphone base\r\nbizagi.rendering.smartphone.form.extend(\"bizagi.rendering.smartphone.formTemplate\", bizagi.rendering.formTemplate.prototype);\r\n// Extends itself\r\nbizagi.rendering.smartphone.formTemplate.extend(\"bizagi.rendering.smartphone.formTemplate\", {}, {});\r\n","/**\r\n *   Name: Bizagi Rendering Users Form\r\n *   Author: UI Forms Team\r\n *   Comments:\r\n *   -   This script override rendering.form to create and update users\r\n */\r\n\r\n// Extends from container smartphone form base\r\nbizagi.rendering.smartphone.form.extend(\"bizagi.rendering.smartphone.usersForm\", {}, {});","/*\r\n *   Name: BizAgi Render Text Class\r\n *   Author: Ricardo Perez\r\n *   Comments:\r\n *   -   This script will define basic stuff for text renders\r\n */\r\n\r\nbizagi.rendering.smartphone.render.extend(\"bizagi.rendering.smartphone.specific_text\", {}, {\r\n    \r\n    /*\r\n    *   Update or init the element data\r\n    */\r\n    initializeData: function (data) {\r\n        var self = this;\r\n        // Call base\r\n        this._super(data);\r\n\r\n        // Fill default properties\r\n        var properties = this.properties;\r\n        if (properties.regularExpressionExpression) {\r\n            properties.regularExpression = {\r\n                \"expression\": properties.regularExpressionExpression,\r\n                \"message\": properties.regularExpressionMessage || this.getResource(\"render-text-regular-expression-default-message\")\r\n            };\r\n        }\r\n    },\r\n    /*\r\n    *   Template method to implement in each children to customize each control\r\n    */\r\n    renderControl: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var template = self.renderFactory.getTemplate(\"text\");\r\n        // Render template\r\n        var html = $.fasttmpl(template, { value: properties.value, \"isEmptyField\": typeof properties.value === \"undefined\", helpText: properties.helpText, editable: properties.editable });\r\n        return html;\r\n    },\r\n\r\n    renderReadOnly: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var template = self.renderFactory.getTemplate(\"text-read-only\");\r\n\r\n        // Render template\r\n        var html = $.fasttmpl(template, { value: self.getValue() });\r\n        return html;\r\n    },\r\n\r\n    /*\r\n    *   Template method to implement in each device to customize each render after processed\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        var control = self.getControl();\r\n        var properties = self.properties;\r\n\r\n        // Call base\r\n        self._super();\r\n\r\n        self.input = control.find(\"input\");\r\n        //Attach event for retype double\r\n        if (properties.retype == \"double\") {\r\n            self.attachRetypeDouble();\r\n        }\r\n\r\n    },\r\n    attachRetypeDouble: function () {\r\n        var self = this;\r\n        var element = self.element;\r\n\r\n        var input = $(\"input\", element);\r\n        if (!input || input.length == 0) return;\r\n\r\n        // Apply blur handler to check value\r\n        input.blur(function () {\r\n            var control = $(this);\r\n            if ($(control).attr(\"type\") != \"hidden\" &&\r\n                $(control).css(\"display\") != \"none\" &&\r\n                $(control).css(\"visibility\") != \"hidden\") {\r\n\r\n                if (!control.data(\"oldValue\") || $(this).data(\"oldValue\") == \"\") {\r\n\r\n                    // Check that there is something in the value\r\n                    if (control.val() == \"\")\r\n                        return;\r\n\r\n                    // Check if a value has already been set\r\n                    if (control.val() == control.attr(\"newValue\"))\r\n                        return;\r\n\r\n                    control.data(\"oldValue\", control.val());\r\n                    control.val(\"\");\r\n                    // Create new tooltip\r\n                    try {\r\n                        control.tooltip(\"destroy\");\r\n                    } catch (e) { }\r\n                    control.attr(\"title\", self.getResource(\"render-number-retype\")); //\"Re-escriba el valor\"\r\n                    control.tooltip();\r\n                    control.tooltip(\"open\");\r\n                    // Focus after 100ms to avoid bubbling\r\n                    setTimeout(function () { control.focus(); input.focus(); }, 100);\r\n\r\n                }\r\n\r\n                else {\r\n                    if (control.val() != control.data(\"oldValue\")) {\r\n                        self.setValue(\"\");\r\n                        control.val(\"\");\r\n                        control.data(\"oldValue\", \"\");\r\n                        control.tooltip(\"destroy\");\r\n                        control.attr(\"title\", self.getResource(\"render-text-retype-error\"));\r\n                        control.tooltip();\r\n                        control.tooltip(\"open\");\r\n                        setTimeout(function () { control.focus(); }, 100);\r\n                    } else {\r\n\r\n                        control.data(\"newValue\", control.val());\r\n                        control.data(\"oldValue\", \"\");\r\n                        // Destroy tooltips\r\n                        control.tooltip(\"destroy\");\r\n                    }\r\n\r\n                }\r\n            }\r\n        });\r\n\r\n    },\r\n    /*\r\n    *   Template method to implement in each device to customize the render's behaviour to add handlers\r\n    */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n        var control = self.getControl();\r\n        var input = self.input;\r\n\r\n        // Check mask property\r\n        if (properties.mask) {\r\n            self.input.mask({ mask: properties.mask });\r\n        }\r\n\r\n        // Attach change event\r\n        self.input.bind(\"change\", function () {\r\n\r\n            // Updates internal value\r\n            var oldValue = self.getValue();\r\n            self.setValue(self.input.val(), false);\r\n\r\n            // Check that the value is valid\r\n            var validationMessages = [];\r\n            if (properties.retype != \"duplicate\") {\r\n                if (self.isValid(validationMessages) || typeof (properties.regularExpression) == \"undefined\") {\r\n                    // Update value again triggering handlers\r\n                    self.setValue(self.input.val(), true);\r\n                } else {\r\n                    // Set error message\r\n                    message = validationMessages[0].message;\r\n                    //bizagi.showMessageBox(message, \"Bizagi\", \"error\");\r\n                }\r\n            }\r\n\r\n        }).keypress(function (e) {\r\n            e = window.event || e;\r\n            var keyUnicode = e.charCode || e.keyCode;\r\n            if (e !== undefined) {\r\n                if (keyUnicode == 13) {\r\n                    $(this).trigger(\"change\");\r\n                }\r\n            }\r\n        });\r\n    },\r\n    /* \r\n    * Public method to determine if a value is valid or not\r\n    */\r\n    isValid: function (invalidElements) {\r\n        var self = this,\r\n            properties = self.properties;\r\n\r\n        // Call base\r\n        var bValid = this._super(invalidElements);\r\n        var value = self.getValue();\r\n\r\n        //When the form have big data, block browser executing RegExp. QAF-1418.\r\n        // Check regular expression\r\n        if (typeof value == \"string\") {\r\n            if (properties.regularExpression) {\r\n                if (value && ((value.match(new RegExp(\".*?(<|\\\\u003C)(.+?)(>|\\\\u003E)(.?)|eval\\\\(|eval\\\\u0028\", \"g\"))) || (!value.match(new RegExp(properties.regularExpression.expression)) && self.properties && self.properties.xpath === \"userName\"))) {\r\n                    var message = properties.regularExpression.message;\r\n                    invalidElements.push({ xpath: properties.xpath, message: message });\r\n                    bValid = false;\r\n                } else {\r\n                    if (value && ((value.match(new RegExp(\".*?(<|\\\\u003C)(.+?)(>|\\\\u003E)(.?)|eval\\\\(|eval\\\\u0028\", \"g\"))) || (!value.match(new RegExp(properties.regularExpression.expression))))) {\r\n                        var message = properties.regularExpression.message;\r\n                        invalidElements.push({ xpath: properties.xpath, message: message });\r\n                        bValid = false;\r\n                    }\r\n                }\r\n            } else {\r\n                //strange behavior on IE. When matchs are united on IE have is very slow\r\n                //solution, divide matchs\r\n                //.*? means for more information search: \"Lazy matching regexp\"\r\n                if (value && (value.match(new RegExp(\".*?eval\\\\(\", \"g\"))) && (value.match(new RegExp(\".*?eval\\\\u0028\", \"g\")))) {\r\n                    if (properties.editable) {\r\n                        var message = this.getResource(\"render-text-regular-expression-default-message\");\r\n                        invalidElements.push({ xpath: properties.xpath, message: message });\r\n                        bValid = false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return bValid;\r\n    },\r\n    /*\r\n    *   Sets the value in the rendered control\r\n    */\r\n    setDisplayValue: function (value) {\r\n        var self = this;\r\n        var control = self.getControl();\r\n         var displayValue = self.getDisplayValue();\r\n         var decodedValue = bizagi.util.decodeURI(value);\r\n         var decodedDisplayValue = bizagi.util.decodeURI(displayValue);\r\n        \r\n        if (!bizagi.util.parseBoolean(self.properties.editable)) {\r\n            // Render as simple value\r\n            if (typeof (value) == \"string\") {\r\n                // Replace line breaks for html line breaks\r\n                var valueToDisplay = decodedDisplayValue.replaceAll(\"&\", \"&amp;\");\r\n                valueToDisplay = valueToDisplay.replaceAll(\"<\", \"&lt;\").replaceAll(\">\", \"&gt;\");\r\n                valueToDisplay = valueToDisplay.replaceAll(\"\\\"\", \"&#34;\").replaceAll(\"'\", \"&#39;\").replaceAll(\"/\", \"&#47;\");\r\n                valueToDisplay = valueToDisplay.replaceAll(\"\\\\n\", \"<br/>\");\r\n                valueToDisplay = valueToDisplay.replaceAll(\"\\n\", \"<br/>\");\r\n                control.html(\"<input class='readonly-control bz-form-control' readonly='readonly' value=\"+valueToDisplay+\" >\");\r\n                \r\n            } else {\r\n                if (bizagi.util.isNull(value)) {\r\n                    control.html(\"\");\r\n                }\r\n            }\r\n        }\r\n        // Set internal value\r\n        self.setValue(decodedValue, false);\r\n    },\r\n    /**\r\n    * Extend setValue to fix all encode data from database\r\n    * More information SUITE-9407\r\n    */\r\n    setValue: function (value) {\r\n        /*ISUPP-4116/*\r\n        /*var decodedValue = bizagi.util.decodeURI(value);*/\r\n        var self = this;\r\n        self._super(value);\r\n    },\r\n    /*\r\n*   Execute design only methods\r\n*/\r\n    performDesignModeMethods: function () {\r\n        var self = this;\r\n        var properties = self.properties;\r\n\r\n        // Set all controls read-only\r\n        var control = self.getControl();\r\n        //Valid control\r\n        if (control !== null) {\r\n            $(\"select, button, textarea\", control).attr(\"readonly\", true);\r\n        }\r\n        // Execute custom code for each render\r\n        self.configureDesignView();\r\n\r\n        // Set initial value\r\n        self.internalSetInitialValue();\r\n    }\r\n});","/*\r\n*   Name: Bizagi Smartphone Render Factory\r\n*   Author: UI Forms Team\r\n*   Comments:\r\n*   -   This script will define a render factory to create smartphone versions of each render type\r\n*/\r\n\r\nbizagi.rendering.base.factory.extend(\"bizagi.rendering.smartphone.factory\", {}, {\r\n\r\n    /**\r\n     * Load all the templates used for rendering\r\n     * @returns {} \r\n     */\r\n    loadTemplates: function () {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        $.when(\r\n            // Icons\r\n            self.loadTemplate(\"icons\", self.getFileTemplate(\"common.bizagi.rendering.icons\")),\r\n\r\n            // Containers\r\n            self.loadTemplate(\"form\", self.getFileTemplate(\"bizagi.rendering.smartphone.form\") + \"#bz-form-container\"),\r\n            self.loadTemplate(\"complexgateway\", self.getFileTemplate(\"bizagi.rendering.smartphone.form\") + \"#bz-form-complex-gateway\"),\r\n\r\n            self.loadTemplate(\"panel\", self.getFileTemplate(\"bizagi.rendering.smartphone.panel\")),\r\n            self.loadTemplate(\"tab\", self.getFileTemplate(\"bizagi.rendering.smartphone.tab\")),\r\n            self.loadTemplate(\"tabItem\", self.getFileTemplate(\"bizagi.rendering.smartphone.tabItem\")),\r\n            self.loadTemplate(\"horizontal\", self.getFileTemplate(\"bizagi.rendering.smartphone.horizontal\")),\r\n            self.loadTemplate(\"group\", self.getFileTemplate(\"bizagi.rendering.smartphone.group\")),\r\n            self.loadTemplate(\"searchForm\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchForm\")),\r\n            self.loadTemplate(\"accordion\", self.getFileTemplate(\"bizagi.rendering.smartphone.accordion\")),\r\n            self.loadTemplate(\"accordionItem\", self.getFileTemplate(\"bizagi.rendering.smartphone.accordionItem\")),\r\n            self.loadTemplate(\"contentPanel\", self.getFileTemplate(\"bizagi.rendering.smartphone.contentPanel\")),\r\n\r\n            // Renders\r\n            self.loadTemplate(\"render\", self.getFileTemplate(\"bizagi.rendering.smartphone.render\")),\r\n            self.loadTemplate(\"readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.readonly\")),\r\n            self.loadTemplate(\"text\", self.getFileTemplate(\"bizagi.rendering.smartphone.text\") + \"#bz-render-text\"),\r\n            self.loadTemplate(\"text-read-only\", self.getFileTemplate(\"bizagi.rendering.smartphone.text\") + \"#bz-render-text-readonly\"),\r\n\r\n\r\n            self.loadTemplate(\"number\", self.getFileTemplate(\"bizagi.rendering.smartphone.number\")),\r\n            self.loadTemplate(\"extendedText\", self.getFileTemplate(\"bizagi.rendering.smartphone.extendedText\") + \"#bz-render-extended-text\"),\r\n            self.loadTemplate(\"extendedText-readOnly\", self.getFileTemplate(\"bizagi.rendering.smartphone.extendedText\") + \"#bz-render-extended-text-readonly\"),\r\n            self.loadTemplate(\"date\", self.getFileTemplate(\"bizagi.rendering.smartphone.date\")),\r\n            self.loadTemplate(\"yesno\", self.getFileTemplate(\"bizagi.rendering.smartphone.yesno\")),\r\n            self.loadTemplate(\"check\", self.getFileTemplate(\"bizagi.rendering.smartphone.check\")),\r\n            self.loadTemplate(\"checkList\", self.getFileTemplate(\"bizagi.rendering.smartphone.checkList\")),\r\n            self.loadTemplate(\"button\", self.getFileTemplate(\"bizagi.rendering.smartphone.button\")),\r\n            self.loadTemplate(\"link\", self.getFileTemplate(\"bizagi.rendering.smartphone.link\")),\r\n            self.loadTemplate(\"formLink\", self.getFileTemplate(\"bizagi.rendering.smartphone.formLink\")),\r\n            self.loadTemplate(\"geolocation\", self.getFileTemplate(\"bizagi.rendering.smartphone.geolocation\")),\r\n            self.loadTemplate(\"radio\", self.getFileTemplate(\"bizagi.rendering.smartphone.radio\")),\r\n\r\n            self.loadTemplate('association', self.getFileTemplate('bizagi.rendering.smartphone.association')),\r\n\r\n            self.loadTemplate(\"ecm\", self.getFileTemplate(\"bizagi.rendering.smartphone.ecm\") + \"#bz-render-ecm\"),\r\n            self.loadTemplate(\"ecm-item\", self.getFileTemplate(\"bizagi.rendering.smartphone.ecm\") + \"#bz-render-ecm-item\"),\r\n            self.loadTemplate(\"ecm-readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.ecm\") + \"#bz-render-ecm-readonly\"),\r\n\r\n            self.loadTemplate(\"image\", self.getFileTemplate(\"bizagi.rendering.smartphone.image\") + \"#bz-render-image\"),\r\n            self.loadTemplate(\"image-item\", self.getFileTemplate(\"bizagi.rendering.smartphone.image\") + \"#bz-render-image-item\"),\r\n            self.loadTemplate(\"image-preview\", self.getFileTemplate(\"bizagi.rendering.smartphone.image\") + \"#bz-render-image-preview\"),\r\n            self.loadTemplate(\"image-readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.image\") + \"#bz-render-image-readonly\"),\r\n\r\n            self.loadTemplate(\"upload\", self.getFileTemplate(\"bizagi.rendering.smartphone.upload\") + \"#bz-render-upload\"),\r\n            self.loadTemplate(\"upload-readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.upload\") + \"#bz-render-upload-readonly\"),\r\n            self.loadTemplate(\"upload-item\", self.getFileTemplate(\"bizagi.rendering.smartphone.upload\") + \"#bz-render-upload-item\"),\r\n\r\n            self.loadTemplate(\"document\", self.getFileTemplate(\"bizagi.rendering.smartphone.document\") + \"#bz-document-generator\"),\r\n            self.loadTemplate(\"document-item\", self.getFileTemplate(\"bizagi.rendering.smartphone.document\") + \"#bz-document-generator-item\"),\r\n            self.loadTemplate(\"document-readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.document\") + \"#bz-document-generator-readonly\"),\r\n            self.loadTemplate(\"document-download\", self.getFileTemplate(\"bizagi.rendering.smartphone.document\") + \"#bz-document-generator-download\"),\r\n\r\n            self.loadTemplate(\"list-multiselect\", self.getFileTemplate(\"bizagi.rendering.smartphone.multiSelect\") + \"#bz-multiselect\"),\r\n            self.loadTemplate(\"multiselect-list\", self.getFileTemplate(\"bizagi.rendering.smartphone.multiSelect\") + \"#bz-multiselect-list\"),\r\n            \r\n            self.loadTemplate(\"combo\", self.getFileTemplate(\"bizagi.rendering.smartphone.combo\") + \"#bz-combo-control\"),\r\n            self.loadTemplate(\"combo-readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.combo\") + \"#bz-combo-control-readonly\"),\r\n            self.loadTemplate(\"combo-list\", self.getFileTemplate(\"bizagi.rendering.smartphone.combo\") + \"#bz-combo-control-list\"), \r\n\r\n            self.loadTemplate(\"modal-header-search\", self.getFileTemplate(\"bizagi.rendering.smartphone.modal\") + \"#bz-modal-view-header-search\"),\r\n            self.loadTemplate(\"modal-header-title\", self.getFileTemplate(\"bizagi.rendering.smartphone.modal\") + \"#bz-modal-view-header-title\"),\r\n            self.loadTemplate(\"modal-footer-done\", self.getFileTemplate(\"bizagi.rendering.smartphone.modal\") + \"#bz-modal-view-footer-done\"),\r\n\r\n            self.loadTemplate(\"list\", self.getFileTemplate(\"bizagi.rendering.smartphone.list\") + \"#bz-render-list\"),            \r\n            self.loadTemplate(\"list-items\", self.getFileTemplate(\"bizagi.rendering.smartphone.list\") + \"#bz-render-list-items\"),\r\n\r\n            self.loadTemplate(\"search\", self.getFileTemplate(\"bizagi.rendering.smartphone.search\") + \"#bz-render-search\"),\r\n            self.loadTemplate(\"search.item\", self.getFileTemplate(\"bizagi.rendering.smartphone.search\") + \"#bz-render-search-item\"),\r\n            self.loadTemplate(\"search.items\", self.getFileTemplate(\"bizagi.rendering.smartphone.search\") + \"#bz-render-search-items\"),            \r\n\r\n            self.loadTemplate('searchList', self.getFileTemplate('bizagi.rendering.smartphone.searchList') + \"#bz-render-search-list\"),\r\n            self.loadTemplate(\"searchList.item\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchList\") + \"#bz-render-search-list-item\"),\r\n            self.loadTemplate(\"searchList.items\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchList\") + \"#bz-render-search-list-items\"),            \r\n            self.loadTemplate(\"searchList.actions\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchList\") + \"#bz-render-search-list-actions\"),\r\n            self.loadTemplate(\"searchList.tag\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchList\") + \"#bz-render-search-list-tag\"),\r\n            self.loadTemplate(\"searchList.readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchList\") + \"#bz-render-search-list-readonly\"),\r\n            self.loadTemplate(\"searchList-modal-header\", self.getFileTemplate(\"bizagi.rendering.smartphone.searchList\") + \"#bz-render-search-list-modal-header\"),\r\n\r\n            self.loadTemplate(\"letter\", self.getFileTemplate(\"bizagi.rendering.smartphone.letter\")),\r\n\r\n            //Renders commons\r\n            self.loadTemplate(\"form-error\", self.getFileTemplate(\"bizagi.rendering.smartphone.form-error\")),\r\n            self.loadTemplate(\"form-waiting\", self.getFileTemplate(\"bizagi.rendering.smartphone.form-waiting\")),\r\n\r\n            // Action launcher\r\n            self.loadTemplate(\"render-actionLauncher\", self.getFileTemplate(\"bizagi.rendering.smartphone.actionLauncher\") + \"#bz-rendering-actionLauncher\"),\r\n            self.loadTemplate(\"render-actionLauncher-horizontal\", self.getFileTemplate(\"bizagi.rendering.smartphone.actionLauncher\") + \"#bz-rendering-actionLauncher-horizontal\"),\r\n            self.loadTemplate(\"render-actionLauncher-vertical\", self.getFileTemplate(\"bizagi.rendering.smartphone.actionLauncher\") + \"#bz-rendering-actionLauncher-vertical\"),\r\n            self.loadTemplate(\"render-actionLauncher-actions-to-execute\", self.getFileTemplate(\"bizagi.rendering.smartphone.actionLauncher\") + \"#bz-rendering-actionLauncher-actions-to-execute\"),\r\n            self.loadTemplate(\"render-actionLauncher-design\", self.getFileTemplate(\"bizagi.rendering.smartphone.actionLauncher\") + \"#bz-rendering-actionLauncher-design\"),\r\n\r\n            // Polymorphic launcher\r\n            self.loadTemplate(\"render-polymorphicLauncher\", self.getFileTemplate(\"bizagi.rendering.smartphone.polymorphicLauncher\") + \"#bz-rendering-polymorphicLauncher\"),\r\n            self.loadTemplate(\"render-polymorphicLauncher-vertical-tree\", self.getFileTemplate(\"bizagi.rendering.smartphone.polymorphicLauncher\") + \"#bz-rendering-polymorphicLauncher-vertical-tree\"),\r\n            self.loadTemplate(\"render-polymorphicLauncher-vertical-tree-item\", self.getFileTemplate(\"bizagi.rendering.smartphone.polymorphicLauncher\") + \"#bz-rendering-polymorphicLauncher-vertical-tree-item\"),\r\n            self.loadTemplate(\"render-polymorphicLauncher-actions-to-execute\", self.getFileTemplate(\"bizagi.rendering.smartphone.polymorphicLauncher\") + \"#bz-rendering-polymorphicLauncher-actions-to-execute\"),\r\n            self.loadTemplate(\"render-polymorphicLauncher-confirm\", self.getFileTemplate(\"bizagi.rendering.smartphone.polymorphicLauncher\") + \"#bz-rendering-polymorphicLauncher-confirm\"),\r\n            self.loadTemplate(\"render-polymorphicLauncher-design\", self.getFileTemplate(\"bizagi.rendering.smartphone.polymorphicLauncher\") + \"#bz-rendering-polymorphicLauncher-design\"),\r\n\r\n            //GRIDS SMARTPHONES\r\n            self.loadTemplate(\"grid\", self.getFileTemplate(\"bizagi.rendering.smartphone.grid\")),\r\n            self.loadTemplate(\"cell\", self.getFileTemplate(\"bizagi.rendering.smartphone.cell\")),\r\n            self.loadTemplate(\"cell.readonly\", self.getFileTemplate(\"bizagi.rendering.smartphone.cell.readonly\")),\r\n            self.loadTemplate(\"cell.readonlycontrol\", self.getFileTemplate(\"bizagi.rendering.smartphone.cell.readonlycontrol\")),\r\n\r\n            //grid items\r\n            self.loadTemplate(\"bizagi.grid.grid\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid\"),\r\n            self.loadTemplate(\"bizagi.grid.totalizer\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-totalizer\"),\r\n            self.loadTemplate(\"bizagi.grid.waiting\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-waiting\"),\r\n            self.loadTemplate(\"bizagi.grid.table\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-table\"),\r\n            self.loadTemplate(\"bizagi.grid.table.empty\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-table-empty\"),\r\n            self.loadTemplate(\"bizagi.grid.column\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-column\"),\r\n            self.loadTemplate(\"bizagi.grid.column.special\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-column-special\"),\r\n            self.loadTemplate(\"bizagi.grid.row\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-row\"),\r\n            self.loadTemplate(\"bizagi.grid.row.buttons\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-row-buttons\"),\r\n            self.loadTemplate(\"bizagi.grid.cell\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-cell\"),\r\n            self.loadTemplate(\"bizagi.grid.cell.special\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-cell-special\"),\r\n            self.loadTemplate(\"bizagi.grid.pager\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-pager\"),\r\n            self.loadTemplate(\"bizagi.grid.buttons\", self.getFileTemplate(\"bizagi.rendering.smartphone.bizagi.grid\") + \"#ui-bizagi-grid-buttons\"),\r\n\r\n            // Renders Layouts\r\n            self.loadTemplate(\"render-layout\", self.getFileTemplate(\"bizagi.rendering.smartphone.render.layout\")),\r\n\r\n            self.loadTemplate(\"layout-image\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.image\") + \"#ui-bizagi-render-layout-image\"),\r\n            self.loadTemplate(\"layout-image64\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.image\") + \"#ui-bizagi-render-layout-image64\"),\r\n            self.loadTemplate(\"layout-label\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.label\")),\r\n            self.loadTemplate(\"layout-link\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.link\")),\r\n            self.loadTemplate(\"layout-text\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.text\")),\r\n            self.loadTemplate(\"layout-date-time\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.dateTime\")),\r\n            self.loadTemplate(\"layout-money\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.money\")),\r\n            self.loadTemplate(\"layout-number\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.number\")),\r\n            self.loadTemplate(\"layout-upload\", self.getFileTemplate(\"bizagi.rendering.smartphone.layout.upload\"))\r\n\r\n        ).done(function () {\r\n            var tmplIcons = $.fasttmpl(self.getTemplate(\"icons\"));\r\n            var svgStoreCounter = $(\"head\").find('#genome-forms-icons').length;\r\n\r\n            if (svgStoreCounter === 0) {\r\n                $(\"head\").append(tmplIcons);\r\n            }\r\n\r\n            // Resolve when all templates are loaded\r\n            defer.resolve();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    getFileTemplate: function(src, onDemand){\r\n        var device = bizagi.detectDevice();\r\n        return bizagi.getTemplate(src, onDemand, device == \"desktop\" ? \"smartphone_ios\" : device);\r\n    },\r\n\r\n    /**\r\n     * Returns the appropiate container based on the container type\r\n     * @param {} params \r\n     * @returns {} \r\n     */\r\n    getContainer: function(params) {\r\n        var self = this;\r\n        var type = params.type;        \r\n        var containerParams = $.extend(params, {\r\n            renderFactory: this,\r\n            dataService: params.dataService || this.dataService\r\n        });\r\n\r\n        type = type.replace(/smartphone/, '');\r\n\r\n        if (type == \"form\")\r\n            return new bizagi.rendering.smartphone.form(containerParams);\r\n\r\n        if (type == \"template\")\r\n            return new bizagi.rendering.smartphone.formTemplate(containerParams);\r\n\r\n        if (type == \"queryForm\")\r\n            return new bizagi.rendering.smartphone.queryForm(containerParams);\r\n\r\n        if (type == \"layout\")\r\n            return new bizagi.rendering.smartphone.layout(containerParams);\r\n\r\n        if (type == \"usersForm\")\r\n            return new bizagi.rendering.smartphone.usersForm(containerParams);\r\n\r\n        if (type == \"panel\")\r\n            return new bizagi.rendering.smartphone.panel(containerParams);\r\n\r\n        if (type == \"contentPanel\" || type == \"contentpanel\")\r\n            return new bizagi.rendering.smartphone.contentPanel(containerParams);\r\n\r\n        if (type == \"nestedForm\")\r\n            return new bizagi.rendering.smartphone.nestedForm(containerParams);\r\n\r\n        if (type == \"tab\")\r\n            return new bizagi.rendering.smartphone.tab(containerParams);\r\n\r\n        if (type == \"tabItem\" || type == \"tabitem\")\r\n            return new bizagi.rendering.smartphone.tabItem(containerParams);\r\n\r\n        if (type == \"horizontal\")\r\n            return new bizagi.rendering.smartphone.horizontal(containerParams);\r\n\r\n        if (type == \"accordion\")\r\n            return new bizagi.rendering.smartphone.accordion(containerParams);\r\n\r\n        if (type == \"accordionItem\")\r\n            return new bizagi.rendering.smartphone.accordionItem(containerParams);\r\n\r\n        if (type == \"group\")\r\n            return new bizagi.rendering.smartphone.group(containerParams);\r\n\r\n        if (type == \"searchForm\") {\r\n            containerParams.context = \"search\";\r\n            containerParams.contexttype = \"metadata\";\r\n            return new bizagi.rendering.smartphone.searchForm(containerParams);\r\n        }\r\n\r\n        if (type == \"mobileform\")\r\n            return new bizagi.rendering.mobileform(containerParams);\r\n\r\n        if (type == \"mobilegroup\")\r\n            return new bizagi.rendering.mobilegroup(containerParams);        \r\n\r\n        // No type supported\r\n        bizagi.log(type + \" not supported in render factory\", params.data, \"error\");\r\n\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * Returns the appropiate column based on the render type\r\n     * @param {} params \r\n     * @returns {} \r\n     */\r\n    getColumn: function (params) {\r\n        var type = params.type;\r\n        var data = params.data;\r\n        var columnParams = $.extend(params, {\r\n            renderFactory: this,\r\n            dataService: params.dataService || this.dataService,\r\n            singleInstance: bizagi.util.isEmpty(params.singleInstance) ? true : params.singleInstance\r\n        });\r\n\r\n        type = type.replace(/smartphone/, '');\r\n\r\n        if (type == \"columnText\") {\r\n            var isExtended = bizagi.util.parseBoolean(data.properties.isExtended) || false;\r\n\r\n            if (isExtended) {\r\n                // Creates one extended render\r\n                columnParams.decorated = bizagi.rendering.smartphone.extendedText;\r\n            } else {\r\n                // Creates one normal text render\r\n                columnParams.decorated = bizagi.rendering.smartphone.text;\r\n            }\r\n\r\n            return new bizagi.rendering.smartphone.columns.text(columnParams);\r\n        }\r\n\r\n        if (type == \"columnSearchList\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.searchList;\r\n            return new bizagi.rendering.smartphone.columns.searchList(columnParams);\r\n        }\r\n\r\n        if (type == \"columnNumber\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.number;\r\n            return new bizagi.rendering.smartphone.columns.number(columnParams);\r\n        }\r\n\r\n        if (type == \"columnMoney\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.money;\r\n            return new bizagi.rendering.smartphone.columns.number(columnParams);\r\n        }\r\n\r\n        if (type == \"columnDate\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.date;\r\n            return new bizagi.rendering.smartphone.columns.date(columnParams);\r\n        }\r\n\r\n        if (type == \"columnBoolean\") {\r\n            var display = data.properties.display || \"option\";\r\n\r\n            if (display == \"check\") {\r\n                // Creates one check render\r\n                columnParams.decorated = bizagi.rendering.smartphone.check;\r\n                if (params.data.properties.isExclusive) {\r\n                    return new bizagi.rendering.smartphone.columns.exclusiveCheck(columnParams);\r\n                }\r\n            } else {\r\n                // Creates one yes-no render\r\n                columnParams.decorated = bizagi.rendering.smartphone.yesno;\r\n            }\r\n            return new bizagi.rendering.smartphone.columns.column(columnParams);\r\n        }\r\n\r\n        if (type == \"columnCombo\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.combo;\r\n            return new bizagi.rendering.smartphone.columns.combo(columnParams);\r\n        }\r\n\r\n        if (type == \"columnRadio\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.radio;\r\n            return new bizagi.rendering.smartphone.columns.radio(columnParams);\r\n        }\r\n\r\n        if (type == \"columnList\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.list;\r\n            return new bizagi.rendering.smartphone.columns.list(columnParams);\r\n        }\r\n\r\n        if (type == \"columnHidden\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.hidden;\r\n            return new bizagi.rendering.smartphone.columns.column(columnParams);\r\n        }\r\n\r\n        if (type == \"columnUpload\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.upload;\r\n            return new bizagi.rendering.smartphone.columns.upload(columnParams);\r\n        }\r\n\r\n        if (type == \"columnImage\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.image;\r\n            return new bizagi.rendering.smartphone.columns.image(columnParams);\r\n        }\r\n\r\n        if (type == \"columnUploadEcm\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.ecm;\r\n            return new bizagi.rendering.smartphone.columns.uploadecm(columnParams);\r\n        }\r\n\r\n        if (type == \"columnLink\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.link;\r\n            return new bizagi.rendering.smartphone.columns.link(columnParams);\r\n        }\r\n\r\n        if (type == \"columnFormLink\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.formLink;\r\n            return new bizagi.rendering.smartphone.columns.link(columnParams);\r\n        }\r\n\r\n        if (type == \"columnUserfield\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.userfieldWrapper;\r\n            return new bizagi.rendering.smartphone.columns.column(columnParams);\r\n        }\r\n\r\n        if (type == \"columnSearch\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.search;\r\n            return new bizagi.rendering.smartphone.columns.search(columnParams);\r\n        }\r\n\r\n        if (type == \"columnLabel\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.label;\r\n            return new bizagi.rendering.smartphone.columns.column(columnParams);\r\n        }\r\n\r\n        if (type == \"columnReadonly\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.label;\r\n            return new bizagi.rendering.smartphone.columns.readonly(columnParams);\r\n        }\r\n\r\n        if (type == \"columnDocument\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.document;\r\n            return new bizagi.rendering.smartphone.columns.document(columnParams);\r\n        }\r\n\r\n        /*\r\n        Not supported\r\n         if (type == \"columnLetter\") {\r\n            columnParams.decorated = bizagi.rendering.letter;\r\n            return new bizagi.rendering.columns.letter(columnParams);\r\n        } */\r\n\r\n        if (type == \"columnButton\") {\r\n            columnParams.decorated = bizagi.rendering.smartphone.button;\r\n            return new bizagi.rendering.smartphone.columns.button(columnParams);\r\n        }\r\n\r\n        // No type supported\r\n        bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        return null;\r\n    },\r\n\r\n    getRender: function (params) {\r\n        var self = this;\r\n        var type = params.type;\r\n        var data = params.data;\r\n        var properties = data.properties;\r\n        var renderParams = $.extend(params, {\r\n            renderFactory: this,\r\n            dataService: params.dataService || this.dataService\r\n        });\r\n\r\n        // Check is offline form        \r\n        var isOfflineForm = bizagi.util.isOfflineForm({ container: params.parent });\r\n\r\n        if (!type)\r\n            type = \"label\";\r\n\r\n        type = type.replace(/smartphone/, '');    \r\n\r\n        if (type == \"text\") {\r\n            var isExtended = bizagi.util.parseBoolean(data.properties.isExtended) || false;\r\n\r\n            // Creates one extended render\r\n            if (isExtended) {\r\n                return new bizagi.rendering.smartphone.extendedText(renderParams);\r\n            }\r\n\r\n            // Creates one normal text render\r\n            return new bizagi.rendering.smartphone.text(renderParams);\r\n        }\r\n\r\n        if (type == \"association\") {\r\n            return new bizagi.rendering.smartphone.association(renderParams);\r\n        }\r\n\r\n        if (type == \"label\") {\r\n            return new bizagi.rendering.smartphone.label(renderParams);\r\n        }\r\n\r\n        if (type == \"hidden\") {\r\n            return new bizagi.rendering.smartphone.hidden(renderParams);\r\n        }\r\n\r\n        if (type == \"number\") {\r\n            // Number Scientific Notation\r\n            if (properties && properties.dataType === 29) {\r\n                return new bizagi.rendering.smartphone.numberScientificNotation(renderParams);\r\n            }\r\n\r\n            return new bizagi.rendering.smartphone.number(renderParams);\r\n        }\r\n\r\n        if (type == \"money\") {\r\n            return new bizagi.rendering.smartphone.money(renderParams);\r\n        }\r\n\r\n        if (type == \"date\") {\r\n            return new bizagi.rendering.smartphone.date(renderParams);\r\n        }\r\n\r\n        if (type == \"boolean\") {\r\n            var display = data.properties.display || \"option\";\r\n\r\n            // Creates one check render\r\n            if (display == \"check\") {\r\n                return new bizagi.rendering.smartphone.check(renderParams);\r\n            }\r\n\r\n            // Creates one yes-no render\r\n            return new bizagi.rendering.smartphone.yesno(renderParams);\r\n        }\r\n\r\n        if (type == \"combo\") {\r\n            return new bizagi.rendering.smartphone.combo(renderParams);\r\n        }\r\n\r\n        if (/^cascadingcombo$/i.test(type)) {\r\n            return new bizagi.rendering.smartphone.cascadingCombo(renderParams);\r\n        }\r\n\r\n        if (type == \"list\") {\r\n            return new bizagi.rendering.smartphone.list(renderParams);\r\n        }\r\n\r\n        if (type == \"radio\") {\r\n            return new bizagi.rendering.smartphone.radio(renderParams);\r\n        }\r\n\r\n        if (type == \"image\") {\r\n            return new bizagi.rendering.smartphone.image(renderParams);\r\n        }\r\n\r\n        if (type == \"uploadecm\") {\r\n            return new bizagi.rendering.smartphone.ecm(renderParams);\r\n        }\r\n\r\n        if (type == \"upload\") {\r\n            if( isOfflineForm ){\r\n                return new bizagi.rendering.smartphone.upload.offline(renderParams);\r\n            }\r\n            else{\r\n                return new bizagi.rendering.smartphone.upload(renderParams);\r\n            }            \r\n        }\r\n\r\n        if (type == \"grid\") {\r\n            if (isOfflineForm) {\r\n                return new bizagi.rendering.smartphone.grid.offline(renderParams);\r\n            } else {\r\n                return new bizagi.rendering.smartphone.grid(renderParams);\r\n            }\r\n        }\r\n\r\n        if (type == \"groupedgrid\") {\r\n            // return new bizagi.rendering.smartphone.grid.grouped(renderParams);\r\n            return new bizagi.rendering.smartphone.grid(renderParams); // Not supported. Nonetheless, all entries are shown.\r\n        }\r\n\r\n        if (type == \"search\") {\r\n            return new bizagi.rendering.smartphone.search(renderParams);\r\n        }\r\n\r\n        if (type == \"suggest\") {\r\n            renderParams.data.properties.enableQuerySuggestBehavior = true;\r\n            return new bizagi.rendering.smartphone.search(renderParams);\r\n        }\r\n\r\n        if (type == \"searchList\") {\r\n            return new bizagi.rendering.smartphone.searchList(renderParams);\r\n        }\r\n\r\n        if (type == \"multiSelect\") {\r\n            return new bizagi.rendering.smartphone.multiSelect(renderParams);\r\n        }\r\n\r\n        if (type == \"button\") {\r\n            return new bizagi.rendering.smartphone.button(renderParams);\r\n        }\r\n\r\n        if (type == \"formLink\") {\r\n            return new bizagi.rendering.smartphone.formLink(renderParams);\r\n        }\r\n\r\n        if (type == \"link\") {\r\n            return new bizagi.rendering.smartphone.link(renderParams);\r\n        }\r\n\r\n        if (type == \"actionLauncher\") {\r\n            return new bizagi.rendering.smartphone.actionLauncher(renderParams);\r\n        }\r\n\r\n        if (type == \"entityTemplate\") {\r\n            return new bizagi.rendering.smartphone.entityTemplate(renderParams);\r\n        }\r\n\r\n        if (type == \"polymorphicLauncher\") {\r\n            return new bizagi.rendering.smartphone.polymorphicLauncher(renderParams);\r\n        }\r\n\r\n        if (type == \"userfield\") {\r\n            return new bizagi.rendering.smartphone.userfieldWrapper(renderParams);\r\n        }\r\n\r\n        // Check query renders (starts with \"query\")\r\n        //if (type.indexOf(\"query\") == 0) {\r\n        //    return this.getQueryRender(params);\r\n        //}\r\n\r\n        // Check search renders (starts with \"search\")\r\n        if (type.indexOf(\"search\") == 0) {\r\n            return this.getSearchRender(params);\r\n        }\r\n\r\n        if (type == \"document\") {\r\n            return new bizagi.rendering.smartphone.document(renderParams);\r\n        }\r\n\r\n        if (type == \"image\") {\r\n            return new bizagi.rendering.smartphone.image(renderParams);\r\n        }\r\n\r\n        if (type == \"fileprint\") {\r\n            return new bizagi.rendering.smartphone.fileprint(renderParams);\r\n        }\r\n\r\n        if (type == \"geolocation\") {\r\n            return new bizagi.rendering.smartphone.geolocation(renderParams);\r\n        }\r\n\r\n        if (type == \"collectionnavigator\") {\r\n            return new bizagi.rendering.smartphone.collectionnavigator(renderParams);\r\n        }\r\n\r\n        if (type == \"activityCheckList\") {\r\n           return new bizagi.rendering.smartphone.activityCheckList(renderParams);\r\n        }\r\n\r\n        // Check layout renders (starts with \"layout\")\r\n        if (type.indexOf(\"layout\") === 0) {\r\n            return self.getLayoutRender(params);\r\n        }\r\n\r\n        // Check range renders (starts with \"range\")\r\n        if (type.indexOf(\"range\") === 0) {\r\n            return self.getRangeRender(params);\r\n        }\r\n\r\n        if (type == \"mobiletext\") {\r\n            return new bizagi.rendering.smartphone.specific_text(renderParams);\r\n        }\r\n\r\n        // Deprecated control\r\n        if (type == \"letter\")\r\n            return new bizagi.rendering.smartphone.letter(renderParams);\r\n\r\n        // No type supported\r\n        //bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        //return null;\r\n\r\n        return this._super(params);\r\n    },\r\n\r\n    /**\r\n   * Returns the appropiatelayout render based on the type   \r\n   */\r\n    getLayoutRender: function(params) {\r\n        var type = params.type;\r\n        var renderParams = $.extend(params, {\r\n            renderFactory: this,\r\n            dataService: params.dataService || this.dataService\r\n        });\r\n\r\n        type = type.replace(/smartphone/, '');    \r\n\r\n        if (type == \"layoutImage\")\r\n            return new bizagi.rendering.smartphone.layoutImage(renderParams);\r\n\r\n        if (type == \"layoutLink\")\r\n            return new bizagi.rendering.smartphone.layoutLink(renderParams);\r\n\r\n        if (type == \"layoutLabel\")\r\n            return new bizagi.rendering.smartphone.layoutLabel(renderParams);\r\n\r\n        if (type == \"layoutText\")\r\n            return new bizagi.rendering.smartphone.layoutText(renderParams);\r\n\r\n        if (type == 'layoutDateTime')\r\n            return new bizagi.rendering.smartphone.layoutDateTime(renderParams);\r\n\r\n        if (type == \"layoutNumber\")\r\n            return new bizagi.rendering.smartphone.layoutNumber(renderParams);\r\n\r\n        if (type == \"layoutMoney\")\r\n            return new bizagi.rendering.smartphone.layoutMoney(renderParams);\r\n\r\n        if (type == \"layoutPlaceholder\")\r\n            return new bizagi.rendering.smartphone.layoutPlaceholder(renderParams);\r\n\r\n        if (type == \"layoutBoolean\")\r\n            return new bizagi.rendering.smartphone.layoutBoolean(renderParams);\r\n\r\n        if (type == \"layoutUpload\")\r\n            return new bizagi.rendering.smartphone.layoutUpload(renderParams);\r\n\r\n        return this._super(params);\r\n    },\r\n\r\n    /**\r\n     * Returns the appropiate search render based on the type     \r\n     */\r\n    getRangeRender: function (params) {\r\n        var type = params.type;        \r\n        var renderParams = $.extend(params, {\r\n            renderFactory: this,\r\n            dataService: params.dataService || this.dataService\r\n        });\r\n\r\n        type = type.replace(/smartphone/, '');    \r\n\r\n        if (type === \"rangeDate\")\r\n            return new bizagi.rendering.smartphone.rangeDate(renderParams);\r\n\r\n        if (type === \"rangeMoney\")\r\n            return new bizagi.rendering.smartphone.rangeMoney(renderParams);\r\n\r\n        if (type === \"rangeNumber\")\r\n            return new bizagi.rendering.smartphone.rangeNumber(renderParams);\r\n\r\n        // No type supported\r\n        bizagi.log(type + \" not supported in render factory\", params.data, \"error\");\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * Returns the appropiate search render based on the type     \r\n     */\r\n    getSearchRender: function(params) {\r\n        var type = params.type;\r\n        var data = params.data;\r\n        var searchParams = $.extend(params, {\r\n            renderFactory: this,\r\n            dataService: params.dataService || this.dataService\r\n        });\r\n\r\n        type = type.replace(/smartphone/, '');    \r\n\r\n        if (type == \"searchText\") {\r\n            var isExtended = bizagi.util.parseBoolean(data.properties.isExtended) || false;\r\n\r\n            // Creates one extended render\r\n            if (isExtended)\r\n                return new bizagi.rendering.smartphone.extendedText(searchParams);\r\n\r\n            // Creates one normal text render\r\n            return new bizagi.rendering.smartphone.text(searchParams);\r\n        }\r\n\r\n        if (type == \"searchBoolean\") {\r\n            var display = data.properties.display || \"option\";\r\n\r\n            // Creates one check render\r\n            if (display == \"check\")\r\n                return new bizagi.rendering.smartphone.check(searchParams);\r\n\r\n            // Creates one yes-no render\r\n            return new bizagi.rendering.smartphone.yesno(searchParams);\r\n        }\r\n\r\n        if (type == \"searchNumber\") {\r\n            // Creates a Scientific Notation render\r\n            if (data.properties.dataType == 29)\r\n                return new bizagi.rendering.smartphone.numberScientificNotation(searchParams);\r\n\r\n            return new bizagi.rendering.smartphone.number(searchParams);\r\n        }\r\n\r\n        if (type == \"searchMoney\")\r\n            return new bizagi.rendering.smartphone.money(searchParams);\r\n\r\n        if (type == \"searchDate\")\r\n            return new bizagi.rendering.smartphone.date(searchParams);\r\n\r\n        if (type == \"searchCombo\")\r\n            return new bizagi.rendering.smartphone.combo(searchParams);\r\n\r\n        if (type == \"searchSuggest\")\r\n            return new bizagi.rendering.smartphone.search(searchParams);\r\n\r\n        if (type == \"searchLabel\")\r\n            return new bizagi.rendering.smartphone.label(searchParams);\r\n\r\n        // No type supported\r\n        bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        return null;\r\n    }\r\n});\r\n"]}